/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import t from"../core/Accessor.js";import e from"../core/Collection.js";import{i as n,b as o}from"../core/lang.js";import{g as r}from"./metadata.js";const f=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function i(e){return e instanceof t}function c(t){return t instanceof e?Object.keys(t.items):i(t)?r(t).keys():t?Object.keys(t):[]}function s(t,n){return t instanceof e?t.items[n]:t[n]}function l(t){return t?t.declaredClass:null}function u(t,e){const o=t.diff;if(o&&"function"==typeof o)return o(t,e);const r=c(t),a=c(e);if(0===r.length&&0===a.length)return;if(!r.length||!a.length||function(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}(t,e))return{type:"complete",oldValue:t,newValue:e};const p=a.filter((t=>-1===r.indexOf(t))),y=r.filter((t=>-1===a.indexOf(t))),d=r.filter((n=>a.indexOf(n)>-1&&s(t,n)!==s(e,n))).concat(p,y).sort(),m=l(t);if(m&&f.indexOf(m)>-1&&d.length)return{type:"complete",oldValue:t,newValue:e};let h;const b=i(t)&&i(e);for(const r of d){const f=s(t,r),i=s(e,r);let c;(b||"function"!=typeof f&&"function"!=typeof i)&&(f!==i&&(null==f&&null==i||(c=o&&o[r]&&"function"==typeof o[r]?o[r](f,i):"object"==typeof f&&"object"==typeof i&&l(f)===l(i)?u(f,i):{type:"complete",oldValue:f,newValue:i},n(c)&&(n(h)?h.diff[r]=c:h={type:"partial",diff:{[r]:c}}))))}return h}function a(t,e){if(o(t))return!1;const n=e.split(".");let r=t;for(const t of n){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const e=r.diff[t];if(!e)return!1;r=e}}return!0}function p(t,e){for(const n of e)if(a(t,n))return!0;return!1}function y(t,e){if("function"!=typeof t&&"function"!=typeof e&&(t||e))return!t||!e||"object"==typeof t&&"object"==typeof e&&l(t)!==l(e)?{type:"complete",oldValue:t,newValue:e}:u(t,e)}function d(t){if(o(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const t of e.added)if(!d(t))return!1;for(const t of e.removed)if(!d(t))return!1;for(const t of e.changed)if(!d(t))return!1;return!0}case"partial":for(const e in t.diff){if(!d(t.diff[e]))return!1}return!0}}export{p as a,y as d,a as h,d as i};
