/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{p as n,u as i,b as t,j as a,d as o,l as r,f as e,g as c,e as u,w as g,D as b,i as l,s as f,z as p,t as m,n as d,A as h}from"./mathUtils.js";import{O as I,b as j}from"./vectorStacks.js";import{c as P,e as N,b as w,i as M}from"./mat4.js";import{c as v}from"./mat4f64.js";import{c as T,p as A,d as S}from"./lineSegment.js";import{c as _,g as y,n as V,h as x,w as E,a as O,j as k,k as B,l as F,m as L,p as U,o as Y}from"./plane.js";import{e as q}from"./ray.js";import{p as C}from"./sphere.js";const R=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class z{constructor(){this.plane=_(),this.origin=t(),this.basis1=t(),this.basis2=t()}}function D(s=fs){return{plane:_(s.plane),origin:i(s.origin),basis1:i(s.basis1),basis2:i(s.basis2)}}function G(s,n=D()){return H(s.origin,s.basis1,s.basis2,n)}function W(s,n){a(n.origin,s.origin),a(n.basis1,s.basis1),a(n.basis2,s.basis2),O(s.plane,n.plane)}function H(s,n,i,t=D()){return a(t.origin,s),a(t.basis1,n),a(t.basis2,i),J(t),function(s,n){Math.abs(o(s.basis1,s.basis2)/(r(s.basis1)*r(s.basis2)))>1e-6&&R.warn(n,"Provided basis vectors are not perpendicular");Math.abs(o(s.basis1,cs(s)))>1e-6&&R.warn(n,"Basis vectors and plane normal are not perpendicular");Math.abs(-o(cs(s),s.origin)-s.plane[3])>1e-6&&R.warn(n,"Plane offset is not consistent with plane origin")}(t,"fromValues()"),t}function J(s){y(s.basis2,s.basis1,s.origin,s.plane)}function K(s,n,i){s!==i&&G(s,i);const t=e(j.get(),cs(s),n);return c(i.origin,i.origin,t),i.plane[3]-=n,i}function Q(s,n=D()){const i=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return u(n.origin,s[0]+i,s[1]+t,0),u(n.basis1,i,0,0),u(n.basis2,0,t,0),k(0,0,1,0,n.plane),n}function X(s,n,i){return!!B(s.plane,n,i)&&us(s,i)}function Z(s,n,i){const t=ps.get();ls(s,n,t,ps.get());let r=Number.POSITIVE_INFINITY;for(const e of Is){const c=bs(s,e,ms.get()),u=j.get();if(F(t,c,u)){const s=b(j.get(),n.origin,u),t=Math.abs(l(o(n.direction,s)));t<r&&(r=t,a(i,u))}}return r===Number.POSITIVE_INFINITY?$(s,n,i):i}function $(s,n,i){if(X(s,n,i))return i;const t=ps.get(),o=ps.get();ls(s,n,t,o);let r=Number.POSITIVE_INFINITY;for(const e of Is){const c=bs(s,e,ms.get()),u=j.get();if(L(t,c,u)){const s=q(n,u);if(!x(o,u))continue;s<r&&(r=s,a(i,u))}}return is(s,n.origin)<r&&ss(s,n.origin,i),i}function ss(s,n,i){const t=U(s.plane,n,j.get()),a=A(gs(s,s.basis1),t,-1,1,j.get()),o=A(gs(s,s.basis2),t,-1,1,j.get());return f(i,c(j.get(),a,o),s.origin),i}function ns(s,n,i){const{origin:t,basis1:a,basis2:o}=s,r=f(j.get(),n,t),e=C(a,r),c=C(o,r),g=C(cs(s),r);return u(i,e,c,g)}function is(s,n){const i=ns(s,n,j.get()),{basis1:t,basis2:a}=s,o=r(t),e=r(a),c=Math.max(Math.abs(i[0])-o,0),u=Math.max(Math.abs(i[1])-e,0),g=i[2];return c*c+u*u+g*g}function ts(s,n){return Math.sqrt(is(s,n))}function as(s,n){return x(s.plane,n)&&us(s,n)}function os(s,n){const i=-s.plane[3];return C(cs(s),n)-i}function rs(s,n,i){return s!==i&&G(s,i),P(js,n),N(js,js),m(i.basis1,s.basis1,js),m(i.basis2,s.basis2,js),m(V(i.plane),V(s.plane),js),m(i.origin,s.origin,n),Y(i.plane,i.origin,i.plane),i}function es(s,n,i,t){return s!==t&&G(s,t),w(Ps,M(Ps),n,i),m(t.basis1,s.basis1,Ps),m(t.basis2,s.basis2,Ps),J(t),t}function cs(s){return V(s.plane)}function us(s,n){const i=f(j.get(),n,s.origin),t=h(s.basis1),a=h(s.basis2),r=o(s.basis1,i),e=o(s.basis2,i);return-r-t<0&&r-t<0&&-e-a<0&&e-a<0}function gs(s,n){const i=ms.get();return a(i.origin,s.origin),a(i.vector,n),i}function bs(s,n,i){const{basis1:t,basis2:a,origin:o}=s,r=e(j.get(),t,n.origin[0]),u=e(j.get(),a,n.origin[1]);c(i.origin,r,u),c(i.origin,i.origin,o);const g=e(j.get(),t,n.direction[0]),b=e(j.get(),a,n.direction[1]);return e(i.vector,c(g,g,b),2),i}function ls(s,n,i,t){const a=cs(s);y(a,n.direction,n.origin,i),y(V(i),a,n.origin,t)}const fs={plane:_(),origin:n(0,0,0),basis1:n(1,0,0),basis2:n(0,1,0)},ps=new I(_),ms=new I(T),ds=t(),hs=new I((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],js=v(),Ps=v();var Ns=Object.freeze({__proto__:null,BoundedPlaneClass:z,create:D,wrap:function(s,n,i){const t=hs.get();return t.origin=s,t.basis1=n,t.basis2=i,t.plane=E(0,0,0,0),J(t),t},copy:G,copyWithoutVerify:W,fromValues:H,updateUnboundedPlane:J,elevate:K,setExtent:function(s,n,i){return Q(n,i),K(i,os(s,s.origin),i),i},fromAABoundingRect:Q,intersectRay:X,intersectRayClosestSilhouette:function(s,n,i){if(X(s,n,i))return i;const t=Z(s,n,j.get());return c(i,n.origin,e(j.get(),n.direction,g(n.origin,t)/r(n.direction))),i},closestPointOnSilhouette:Z,closestPoint:$,projectPoint:ss,projectPointLocal:ns,distance2:is,distance:ts,distanceToSilhouette:function(s,n){let i=Number.NEGATIVE_INFINITY;for(const t of Is){const a=bs(s,t,ms.get()),o=S(a,n);o>i&&(i=o)}return Math.sqrt(i)},extrusionContainsPoint:as,axisAt:function(s,n,i,t){return function(s,n,i){switch(n){case 0:a(i,s.basis1),d(i,i);break;case 1:a(i,s.basis2),d(i,i);break;case 2:a(i,cs(s))}return i}(s,i,t)},altitudeAt:os,setAltitudeAt:function(s,n,i,t){const a=os(s,n),o=e(ds,cs(s),i-a);return c(t,n,o),t},equals:function(s,n){return p(s.basis1,n.basis1)&&p(s.basis2,n.basis2)&&p(s.origin,n.origin)},transform:rs,rotate:es,normal:cs,UP:fs});export{z as B,G as a,Ns as b,D as c,W as d,as as e,H as f,ts as g,Q as h,X as i,cs as n,es as r,rs as t,J as u};
