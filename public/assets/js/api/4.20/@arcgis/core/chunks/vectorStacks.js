/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{n as t}from"../core/lang.js";import{n as e}from"../core/scheduling.js";import{a as s,b as i}from"./quatf64.js";import{a as r}from"./mat4f64.js";import{c as h}from"./vec2f64.js";import{y as a}from"./mathUtils.js";import{c as f}from"./vec4f64.js";class m{constructor(t){this.allocator=t,this.items=[],this.itemsPtr=0,this.tickHandle=e.before((()=>this.reset())),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=t(this.tickHandle)),this.items=t(this.items)}get(){return 0===this.itemsPtr&&e((()=>{})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const t=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*c);this.items.length=Math.min(t,this.items.length),this.itemsPtr=0}grow(){for(let t=0;t<Math.max(8,Math.min(this.items.length,c));t++)this.items.push(this.allocator())}}const c=1024;class n{constructor(t,s,i){this.itemByteSize=t,this.itemCreate=s,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(i/this.itemByteSize),this.tickHandle=e.before((()=>this.reset()))}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=t(this.tickHandle)),this.itemsPtr=0,this.items=t(this.items),this.buffers=t(this.buffers)}get(){0===this.itemsPtr&&e((()=>{}));const t=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=t;){const t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let e=0;e<this.itemsPerBuffer;++e)this.items.push(this.itemCreate(t,e*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]}reset(){const t=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>t;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(t=o){return new n(16,h,t)}static createVec3f64(t=o){return new n(24,a,t)}static createVec4f64(t=o){return new n(32,f,t)}static createMat3f64(t=o){return new n(72,s,t)}static createMat4f64(t=o){return new n(128,r,t)}static createQuatf64(t=o){return new n(32,i,t)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const o=4096,u=n.createVec2f64(),l=n.createVec3f64(),P=n.createVec4f64();n.createMat3f64();const g=n.createMat4f64(),d=n.createQuatf64();export{m as O,P as a,l as b,u as c,d,g as s};
