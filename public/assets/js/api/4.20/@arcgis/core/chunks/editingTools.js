/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import t from"../Graphic.js";import{b as i,d as a,i as r,j as s,u as o,h as n,r as l,t as p}from"../core/lang.js";import{E as h}from"./Evented.js";import{HandleOwnerMixin as c,HandleOwner as u}from"../core/HandleOwner.js";import{init as d}from"../core/watchUtils.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./Logger.js";import{subclass as g}from"../core/accessorSupport/decorators/subclass.js";import y from"../layers/GraphicsLayer.js";import{e as v,d as f,b as M,a as _}from"./elevationInfoUtils.js";import{s as S,O as w,c as j}from"./OutlineVisualElement.js";import{b as x,S as E,E as G,c as O,P as D,e as A,f as R}from"./DrawTool.js";export{b as DrawOperation}from"./DrawTool.js";import{e as I,b as P,k as V,g as H,f as C,p as T,v as k,s as z,n as U,d as L,a as F,c as B,D as Z,A as N,l as Y,h as X,u as q,r as W,o as Q,ab as J,Z as K,j as $,a3 as ee}from"./mathUtils.js";import{e as te,c as ie}from"./vec4.js";import{O as ae}from"./Object3DVisualElement.js";import{E as re}from"./sdfPrimitives.js";import{g as se}from"./pointUtils.js";import{G as oe,C as ne}from"./ColorMaterial.js";import{S as le,M as pe,a as he,g as ce,e as ue,p as de,b as me}from"./manipulatorUtils.js";import{G as ge}from"./GraphicState.js";import{createSquare as ye,createRectangle as ve,createCircle as fe,createEllipse as Me,createPolygon as _e,createPolyline as be}from"./createUtils.js";import{c as Se}from"../views/draw/SegmentDrawAction.js";import{I as we,d as je,a as xe,c as Ee,b as Ge,e as Oe,f as De,E as Ae,g as Re,h as Ie,i as Pe}from"./InteractiveToolBase.js";import Ve from"../core/Collection.js";import He from"../core/Handles.js";import{h as Ce,d as Te,r as ke,m as ze}from"./handleUtils.js";import{m as Ue}from"./dehydratedFeatures.js";import{c as Le}from"./manipulatorUtils2.js";import{L as Fe}from"./LaserlineVisualElement.js";import{projectVectorToVector as Be,projectPointToVector as Ze}from"../geometry/projection.js";import{c as Ne,e as Ye,F as Xe}from"./aaBoundingBox.js";import{z as qe}from"./aaBoundingRect.js";import{e as We}from"./RibbonLineMaterial.js";import Qe from"../Color.js";import{k as Je,i as Ke,x as $e,m as et,b as tt,v as it,t as at,a as rt,s as st,r as ot}from"./mat4.js";import{c as nt,f as lt,I as pt}from"./mat4f64.js";import{b as ht,s as ct,c as ut}from"./vectorStacks.js";import{b as dt,c as mt,d as gt,e as yt,f as vt,g as ft,a as Mt}from"./dragEventPipeline3D.js";import{d as _t}from"./colorUtils2.js";import{G as bt}from"./GraphicManipulator.js";import{i as St,g as wt,a as jt}from"../widgets/Sketch/SketchViewModel.js";import{S as xt,E as Et,O as Gt,U as Ot,M as Dt,m as At,n as Rt}from"../views/draw/DrawAction.js";import It from"../geometry/Polyline.js";import{i as Pt}from"./utils2.js";import{d as Vt,b as Ht,s as Ct}from"./screenUtils.js";import{n as Tt,r as kt,c as zt,k as Ut}from"./plane.js";import Lt from"../geometry/Point.js";import{addFrameTask as Ft}from"../core/scheduling.js";import{w as Bt,e as Zt,c as Nt}from"./ray.js";import{f as Yt}from"./mathUtils2.js";import{r as Xt}from"../core/Accessor.js";import{b as qt,e as Wt}from"./axisAngleDegrees.js";import{a as Qt}from"./unitUtils.js";import{a as Jt,e as Kt,j as $t,p as ei,s as ti,u as ii,v as ai,g as ri,h as si}from"./vec2.js";import{a as oi}from"./vec2f64.js";import{c as ni,u as li,a as pi}from"./boundedPlane.js";import{B as hi,h as ci,C as ui,k as di,j as mi,E as gi,F as yi,H as vi,n as fi,b as Mi,w as _i,y as bi}from"./sliceToolUtils.js";import{h as Si}from"./heading-rotate-png.js";import{a as wi}from"./ray2.js";import{T as ji}from"./Texture2.js";import"../geometry.js";import"../geometry/Extent.js";import"./string.js";import"./object.js";import"../geometry/Geometry.js";import"./JSONSupport.js";import"./write.js";import"./metadata.js";import"./arrayUtils.js";import"../core/Error.js";import"./Message.js";import"../config.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./writer.js";import"./deprecate.js";import"./ArrayPool.js";import"../core/promiseUtils.js";import"../geometry/support/webMercatorUtils.js";import"./Ellipsoid.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./extentUtils.js";import"./typeUtils.js";import"./jsonMap.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"./enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"./date.js";import"./number.js";import"./locale.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"./chartMediaInfoUtils.js";import"./MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../core/accessorSupport/decorators/aliasOf.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"./Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"./colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils.js";import"../symbols/edges/Edges3D.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/StylePattern3D.js";import"./colors.js";import"./Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../core/urlUtils.js";import"./persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../portal/Portal.js";import"../intl.js";import"../request.js";import"../kernel.js";import"./assets.js";import"./Loadable.js";import"./Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"./Thumbnail.js";import"./Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"./uid.js";import"../layers/Layer.js";import"./BlendLayer.js";import"./ScaleRangeLayer.js";import"./GraphicsCollection.js";import"./ElevationInfo.js";import"./unitConversionUtils.js";import"./lengthUtils.js";import"./projectionEllipsoid.js";import"./vec4f64.js";import"./lineStippleUtils.js";import"./vec4f32.js";import"./lineUtils.js";import"./triangulationUtils.js";import"./earcut.js";import"./deduplicate.js";import"./MapUtils.js";import"./vec2f32.js";import"./VertexArrayObject.js";import"./Texture.js";import"./FramebufferObject.js";import"./VertexColor.glsl.js";import"./Program.js";import"./mat4f32.js";import"./Util.js";import"./utils4.js";import"./geometryDataUtils.js";import"./triangle.js";import"./lineSegment.js";import"./BufferView.js";import"./Camera.js";import"./frustum.js";import"./sphere.js";import"./Object3D.js";import"./Intersector.js";import"./verticalOffsetUtils.js";import"./mat3.js";import"./quatf64.js";import"./quat.js";import"./vec3f32.js";import"./glUtil.js";import"./PhysicallyBasedRendering.glsl.js";import"./PiUtils.glsl.js";import"./Scheduler.js";import"./PromiseQueue.js";import"./RenderGeometry.js";import"./dehydratedFeatureComparison.js";import"./RightAngleQuadVisualElement.js";import"./Settings.js";import"./AppendVertex.js";import"./VisualElement.js";import"./InterleavedLayout.js";import"./types.js";import"./VerticalOffset.glsl.js";import"./compilerUtils.js";import"./ElevationProvider.js";import"../geometry/Circle.js";import"../geometry/support/geodesicUtils.js";import"./geodesicConstants.js";import"../geometry/geometryEngine.js";import"./geometryEngineBase.js";import"./hydrated.js";import"./keybindings.js";import"./mat2d.js";import"./mat2df64.js";import"./InputManager.js";import"./Queue.js";import"./screenUtils2.js";import"./pe.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"./interactiveToolUtils.js";import"./domUtils.js";import"./projector.js";import"./widgetUtils.js";import"../widgets/Popup.js";import"./throttle.js";import"../widgets/Feature.js";import"../widgets/Widget.js";import"./uuid.js";import"./jsxWidgetSupport.js";import"../widgets/Attachments.js";import"../widgets/Attachments/AttachmentsViewModel.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"./messageBundle.js";import"./jsxFactory.js";import"../widgets/Feature/FeatureViewModel.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"./timeUtils.js";import"./DataLayerSource.js";import"../layers/support/Field.js";import"./fieldType.js";import"../rest/support/StatisticDefinition.js";import"../rest/support/RelationshipQuery.js";import"../tasks/QueryTask.js";import"./executeForTopCount.js";import"./utils5.js";import"./query.js";import"../geometry/support/normalizeUtils.js";import"./normalizeUtilsCommon.js";import"./pbfQueryUtils.js";import"./pbf.js";import"./OptimizedFeature.js";import"./OptimizedFeatureSet.js";import"./queryZScale.js";import"./zscale.js";import"../rest/support/FeatureSet.js";import"./featureConversionUtils.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../tasks/Task.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"./colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"./VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"./LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"./sizeVariableUtils.js";import"./visualVariableUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../symbols/support/jsonUtils.js";import"./symbolConversion.js";import"./commonProperties.js";import"../renderers/DictionaryRenderer.js";import"./LRUCache.js";import"./MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"./diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"./styleUtils.js";import"./devEnvironmentUtils.js";import"../renderers/support/jsonUtils.js";import"./MultiOriginJSONSupport.js";import"./ReadOnlyMultiOriginJSONSupport.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/support/elements.js";import"../geometry/HeightModelInfo.js";import"./FeatureIndex.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"./shared.js";import"./APIKeyMixin.js";import"./ArcGISService.js";import"./arcgisLayerUrl.js";import"./CustomParametersMixin.js";import"./OperationalLayer.js";import"./commonProperties2.js";import"./PortalLayer.js";import"./asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"./RefreshableLayer.js";import"./TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/LabelClass.js";import"./labelUtils.js";import"./defaults.js";import"./defaultsJSON.js";import"./featureReductionUtils.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"./fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../layers/support/GeometryFieldsInfo.js";import"./labelingInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"./styleUtils2.js";import"../support/popupUtils.js";import"./Heading.js";import"../widgets/support/widget.js";import"./accessibleHandler.js";import"./vmEvent.js";import"../widgets/Spinner/SpinnerViewModel.js";import"./AnchorElementViewModel.js";import"../widgets/Popup/PopupViewModel.js";import"../symbols/support/symbolUtils.js";import"./ItemCache.js";import"../symbols/support/cimSymbolUtils.js";import"./utils3.js";import"./layerViewUtils.js";import"./actions.js";import"./GoTo.js";import"./CameraSpace.glsl.js";import"./byteSizeEstimations.js";import"./quantizationUtils.js";import"./requestImageUtils.js";import"./drapedUtils.js";import"../views/draw/Draw.js";import"../views/draw/MultipointDrawAction.js";import"../views/draw/PointDrawAction.js";import"../views/draw/PolygonDrawAction.js";import"../views/draw/PolylineDrawAction.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"./LineVisualElement.js";import"./ImageMaterial.js";import"./NativeLineMaterial.js";import"../widgets/Slice/SlicePlane.js";import"./persistable.js";import"./multiOriginJSONSupportUtils.js";class xi extends ae{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=S.colorToVec4(S.reshapeManipulators.vertex.color),this._size=S.reshapeManipulators.vertex.size,this._outlineColor=S.colorToVec4(S.reshapeManipulators.vertex.outlineColor),this._outlineSize=S.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){te(e,this._color)||(ie(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){te(e,this._outlineColor)||(ie(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(i(e)||0===e.length)return[];const t=se(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,re.fromElevationInfo(this.elevationInfo)),a=[],r=t.numVertices,s=t.position;for(let e=0;e<r;++e){const t=I(Ei,s[3*e+0],s[3*e+1],s[3*e+2]),i=Gi(.5,t),r=Gi(.5,t);a.push({vertexGeometry:i,vertexOutlineGeometry:r})}return a}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new le({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new le({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Ei=P();function Gi(e,t){return oe.createSphereGeometry(e,16,16,{offset:t})}let Oi=class extends(c(h.EventedMixin(we))){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._activeVertexVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingManager=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}initialize(){const e=a(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new y({elevationInfo:e,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new x({view:this.view,manipulators:this.manipulators,geometryType:Di(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new E(this.view,e,[this._internalGraphicsLayer]),elevationDrawSurface:new G(e,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:e,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e))),this.complete()}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,a=i.slice();r(t)&&a.push(this.drawOperation.coordinateHelper.pointToArray(t));const s=r(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],o={regularVertices:null,activeVertex:null,full:null,outline:null},n=a.length,l=this.drawOperation.spatialReference,p="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":o.regularVertices=i,o.activeVertex=s,o.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":o.regularVertices=i,o.activeVertex=s,n>0&&(o.full=be([a],l,p));break;case"polygon":o.regularVertices=i,o.activeVertex=s,n>0&&(o.full=_e([a],l,p,!0));break;case"circle":if(n>0){const t=Se(this.view,a[0]);if(1===n&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+Ai*this.view.resolution,e[1]);o.full=fe([e,i],t,!0)}else 2===n&&(o.full=this.forceUniformSize?fe(a,t,this.centered):Me(a,t,this.centered))}break;case"rectangle":if(n>0){const t=Se(this.view,a[0]);if(1===n&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+Ai*this.view.resolution,e[1]);o.full=ye([e,i],t,!0)}else 2===n&&(o.full=this.forceUniformSize?ye(a,t,this.centered):ve(a,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":case"polygon":n>1&&(o.outline=be([a],l,p));break;case"circle":case"rectangle":r(o.full)&&"polygon"===o.full.type&&(o.outline=_e(o.full.rings,l,p))}return o}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){r(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic=s(this._createGraphic)),this._createGraphicState=null,this.handles.remove(Ri)}_destroyOutlineVisualElement(){this._outlineVisualElement=s(this._outlineVisualElement)}_destroyVerticesVisualElement(){this._verticesVisualElement=s(this._verticesVisualElement)}_destroyStagedVerticesVisualElement(){this._activeVertexVisualElement=s(this._activeVertexVisualElement)}_updateCreateGraphic(){const e=this._getCreateGeometry();if(i(e))return void this._destroyAllVisualisations();const a=this._internalGraphicsLayer.elevationInfo;r(e.outline)?i(this._outlineVisualElement)?(this._outlineVisualElement=new w({view:this.view,geometry:e.outline,elevationInfo:a,isDraped:r(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===v(this.hasZ,a),attached:!1}),S.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),S.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=e.outline:this._destroyOutlineVisualElement(),r(e.regularVertices)?i(this._verticesVisualElement)?(this._verticesVisualElement=new xi({view:this.view,spatialReference:this.view.spatialReference,vertices:e.regularVertices,elevationInfo:a,renderOccluded:S.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=e.regularVertices:this._destroyVerticesVisualElement(),r(e.activeVertex)?i(this._activeVertexVisualElement)?(this._activeVertexVisualElement=new xi({view:this.view,spatialReference:this.view.spatialReference,vertices:[e.activeVertex],elevationInfo:a,renderOccluded:S.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=S.colorToVec4(S.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0):this._activeVertexVisualElement.vertices=[e.activeVertex]:this._destroyStagedVerticesVisualElement(),r(e.full)?i(this._createGraphic)?(this._createGraphic=new t({geometry:e.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new ge({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),d(this._createGraphicState,"isDraped",(e=>{r(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))],Ri),this.notifyChange("createGraphic")):this._createGraphic.geometry=e.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let i=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry({operationComplete:!0});r(e)&&(i=new t({geometry:e.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:i,...e})}};function Di(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}e([m()],Oi.prototype,"drawOperation",void 0),e([m({readOnly:!0})],Oi.prototype,"updating",null),e([m({constructOnly:!0,nonNullable:!0})],Oi.prototype,"view",void 0),e([m()],Oi.prototype,"createGraphicSymbol",void 0),e([m()],Oi.prototype,"createGraphic",null),e([m({value:!0})],Oi.prototype,"enabled",null),e([m({value:!0})],Oi.prototype,"centered",null),e([m({value:!0})],Oi.prototype,"forceUniformSize",null),e([m({constructOnly:!0})],Oi.prototype,"graphicProperties",void 0),e([m({constructOnly:!0})],Oi.prototype,"hasZ",void 0),e([m({nonNullable:!0})],Oi.prototype,"defaultZ",void 0),e([m({constructOnly:!0})],Oi.prototype,"elevationInfo",void 0),e([m()],Oi.prototype,"snapToScene",void 0),e([m()],Oi.prototype,"snappingManager",void 0),e([m({constructOnly:!0})],Oi.prototype,"mode",void 0),e([m({constructOnly:!0})],Oi.prototype,"geometryType",void 0),e([m({readOnly:!0})],Oi.prototype,"type",void 0),Oi=e([g("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],Oi);const Ai=48,Ri="create-graphic";class Ii{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof pe&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),i(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}function Pi(e){const{view:t,graphic:i}=e,a=new ge({graphic:i}),s=function(e,t){const{view:i,graphic:a}=e,r=new w({view:i,geometry:Vi(a)?a.geometry:null,elevationInfo:f(a),attached:!1});S.visualElements.lineGraphics.shadowStyle.apply(r);const s=()=>{r.attached=t.displaying};S.visualElements.lineGraphics.outline.apply(r);const o=[t.watch("displaying",s),t.watch("isDraped",(e=>r.isDraped=e)),t.on("changed",(()=>r.geometry=Vi(a)?a.geometry:null)),Te(r)];return s(),{visualElement:r,remove:()=>Ce(o).remove()}}(e,a),o=[s,function(e,t,i){const{graphic:a,view:s}=e,o=[],n=f(a),l="on-the-ground"===n.mode||!n.offset&&"absolute-height"!==n.mode,p=new Ii,h=new O({view:s,extensionType:S.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});S.visualElements.pointGraphics.shadowStyle.apply(h);const c=V(S.visualElements.heightPlaneAngleCutoff),u=new Fe({view:s,attached:!1,angleCutoff:c});S.visualElements.heightPlane.apply(u);let d=1,m=1;const g=()=>{if(p.update(e),!i.displaying||l&&(i.isDraped||!Vi(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(u.attached=!1);t.laserlineEnabled=!0;{const e=4&p.grabbingState?S.visualElements.laserlineAlphaMultiplier:1;e!==d&&(d=e,S.visualElements.lineGraphics.shadowStyle.apply(t,e),S.visualElements.pointGraphics.shadowStyle.apply(h,e))}{const e=2&p.grabbingState?S.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,S.visualElements.heightPlane.apply(u,e))}!function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&r(t.firstGrabbedXY)?t.firstGrabbedXY:null;r(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(h,p),function(e,t,i,a){if(a.numSelected>0){I(Hi,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{1===i&&e.selected&&e instanceof pe&&(H(Hi,Hi,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=C(Hi,Hi,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;r(a)&&e.view.renderCoordsHelper.toRenderCoords(a,Hi)?(i.heightManifoldTarget=Hi,i.attached=!0):i.attached=!1}}(e,t,u,p)};S.visualElements.zVerticalLine.apply(h),o.push(i.on("changed",g),i.watch("displaying",g),t.events.on("attachment-origin-changed",g),Te(h),Te(u));const y=[],v=()=>{Ce(y).remove(),y.length=0,e.forEachManipulator((e=>y.push(e.events.on("grab-changed",g)))),e.forEachManipulator((e=>y.push(e.events.on("select-changed",g)))),g()};return v(),o.push(e.onManipulatorsChanged(v),ke((()=>Ce(y)))),Ce(o)}(e,s.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:s.visualElement,remove:()=>Ce(o).remove()}}function Vi(e){return r(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const Hi=P();function Ci(e){const{view:t,graphic:a}=e,s=new ge({graphic:a}),o=[],n=function(e,t,i){const{view:a,graphic:s}=e,o=new D({view:a,geometry:Ti(s),elevationInfo:f(s),attached:!1});return function(e,t,i,a){const s=()=>t.attached=i.displaying;(function(e,t,i,a){const{view:s,graphic:o}=e;let n=null;const l=e=>{r(n)&&(n.remove(),n=null),i.isDraped&&r(e)&&(n=function(e,t,i){const a=e.elevationProvider.spatialReference;Ze(t,ki,a);const r=ki[0],s=ki[1];return e.elevationProvider.on("elevation-change",(e=>{qe(e.extent,r,s)&&i()}))}(s,e,(()=>{t.geometry=e})))},p=()=>{const e=Ti(o);l(e),t.geometry=e};a.push(i.on("changed",p),ke((()=>n))),p()})(e,t,i,a),S.visualElements.pointGraphics.outline.apply(t),a.push(d(i,"displaying",s))}(e,o,t,i),i.push(Te(o)),o}(e,s,o);return function(e,t,a,s){const{view:o,graphic:n}=e,l=new O({view:o,extensionType:S.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});S.visualElements.zVerticalLine.apply(l);const p=new Fe({view:o,intersectsLineInfinite:!0,attached:!1});S.visualElements.pointGraphics.shadowStyle.apply(p);const h=V(S.visualElements.heightPlaneAngleCutoff),c=new Fe({view:o,attached:!1,angleCutoff:h});S.visualElements.heightPlane.apply(c);const u=f(e.graphic),d=re.fromElevationInfo(u),m="on-the-ground"===u.mode||!u.offset&&"absolute-height"!==u.mode,g=new Ii;let y=1,v=1;const M=()=>{g.update(e);const a=Ti(n),h=m&&(t.isDraped||i(a)||!a.hasZ);let u=!0;if(!h&&r(a)){const e=We(a,o.elevationProvider,d,o.renderCoordsHelper);I(ki,a.x,a.y,e),Be(ki,a.spatialReference,ki,o.renderCoordsHelper.spatialReference),l.setStartEndFromWorldDownAtLocation(ki),p.intersectsWorldUpAtLocation=ki}else u=!1;const f=2&g.grabbingState?S.visualElements.laserlineAlphaMultiplier:1;f!==y&&(y=f,S.visualElements.heightPlane.apply(c,f));const M=Ye(zi);!h&&t.displaying&&s.calculateMapBounds(M)&&Be(Xe(M,ki),o.spatialReference,ki,o.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=ki,c.attached=!0):c.attached=!1;const _=4&g.grabbingState?S.visualElements.laserlineAlphaMultiplier:1;_!==v&&(v=_,S.visualElements.pointGraphics.shadowStyle.apply(p,_));const b=u&&t.displaying&&!h;p.attached=b,l.attached=b};a.push(t.watch(["displaying","isDraped"],M),t.on("changed",M)),e.forEachManipulator((e=>{a.push(e.events.on("grab-changed",M))})),a.push(Te(p)),a.push(Te(l)),a.push(Te(c)),M()}(e,s,o,n),o.push(t.trackGraphicState(s)),{visualElement:n,remove(){Ce(o).remove()}}}function Ti(e){const t=e.geometry;return i(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const ki=P(),zi=Ne();function Ui(e){switch(o(e.graphic.geometry).type){case"point":case"mesh":return Ci(e);case"polygon":case"polyline":return Pi(e);default:return null}}const Li=[1,.5,0],Fi=Math.ceil(70/3*2),Bi=5*Math.PI/12,Zi=1*Math.PI/3;class Ni{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this.forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof pe&&e(t,i)}))}}function Yi(e,t,i,a){const r=e.graphic,s=(e,i)=>t({action:e,graphic:r,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const o=t.next((e=>("start"===e.action&&s("start",e),e))).next(je(r,a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&s("update",e);break;case"end":s("end",e)}return e}));return i.next(xe(r)).next((()=>{s("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function Xi(e){if(i(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const a=t[0],r=t[1];return Math.atan2(r[1]-a[1],r[0]-a[0])}class qi extends Ni{constructor(e){super(),this._handles=new He,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new h,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=f(a),s=o(a.geometry).spatialReference;return Yi(t,i,(t=>this.createDragPipeline(((i,a,r,s,o)=>t(i,e(i,a,r,s,o),r)),r,s,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){return Ce(this._arrowManipulatorInfos.map((({manipulator:r},s)=>Ee(r,((r,o,n,l,p)=>{const h=o.next((e=>({...e,manipulatorType:1}))).next(Ge(this._view,r.elevationAlignedLocation)).next(dt(this._view,r.elevationAlignedLocation,t,i,a)).next(Oe(r.location,this.angle+(s+1)*Math.PI*.5)).next(De());e(r,h,n,l,p)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/70,r=54*a,s=r*Math.sqrt(3)/2,o=oe.createExtrudedTriangle(s,r/2,r/2,.02);oe.transformInPlace(o,Je(ct.get(),I(ht.get(),0,-s/3,0))),e.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:2},{geometry:o,material:this._transparentMaterial,stateMask:1}],e.radius=s/3*2*1.2;const n=Ke(ct.get());$e(n,i*Math.PI/2);const l=Ke(ct.get());Je(l,I(ht.get(),0,100*a,0)),et(t,n,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Ke(ct.get());tt(t,t,e,T(0,0,1));const i=it(ct.get(),I(ht.get(),this.displayScale,this.displayScale,this.displayScale)),a=Ke(ct.get());et(a,i,t);for(const e of this._arrowManipulatorInfos){const t=et(ct.get(),a,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new pe({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:T(0,0,1)}}),i={manipulator:t,transform:nt()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){const t=Qe.toUnitRGBA(j.main);return t[3]*=e,new ne({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class Wi{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Ae,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&r(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(r(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){const t=r(this.view)?this.view.toMap(e,{exclude:[]}):null;return r(t)&&r(this.view)&&(t.z=M(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return r(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class Qi extends Ni{constructor(e){super(),this._handles=new He,this._snapToScene=new Wi,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=f(a),s=o(a.geometry).spatialReference;return Yi(t,i,(t=>this.createDragPipeline(((i,a,r,s,o)=>t(i,e(i,a,r,s,o),r)),r,s,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){const r=this._view;return Ee(this._manipulator,((s,o,n,l,p)=>{const h=o.next(Ge(r,s.elevationAlignedLocation)).next(dt(r,s.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(r,t),this._snapToScene.next).next((e=>({...e,manipulatorType:1}))).next(De());e(s,h,n,l,p)}))}_updateManipulatorTransform(){const e=it(ct.get(),I(ht.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new pe({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:T(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=oe.createCylinderGeometry(.02,1,128,T(0,0,1),T(0,0,0)),t=it(nt(),T(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/70*80}_createMaterial(e=1){const t=Qe.toUnitRGBA(j.main);return t[3]*=e,new ne({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class Ji extends Ni{constructor(e){super(),this._handles=new He,this._radius=70,this.events=new h,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const a=o(t.graphic.geometry).spatialReference;return Yi(t,i,(t=>this.createDragPipeline(((i,a,r,s,o)=>t(i,e(i,a,r,s,o),r)),a)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Ee(this._manipulator,((a,r,s,o,n)=>{const l=r.next((e=>({...e,manipulatorType:0}))).next(mt(i,a.renderLocation,t)).next(De());e(a,l,s,o,n)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/70,t=S.zManipulator.height*e,i=S.zManipulator.coneHeight*e,a=S.zManipulator.coneWidth*e,r=S.zManipulator.width*e,s=[T(0,0,0),T(0,0,t)],o=oe.createTubeGeometry(s,r/2,16,!1),n=oe.createConeGeometry(i,a/2,16,!1),l=[T(0,0,0),T(0,0,t+i)],p=(e=>{const i=nt();if(at(i,i,[0,0,t]),rt(i,i,Math.PI/2),e){const t=1+2*e/a;st(i,i,[t,t,t])}return i})(0),h=(e,t)=>{const i=_t(S.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,S.zManipulator.color.a*e]},c=he(h(1,.25),1),u=he(h(1,0),1),d=he(h(.7,0),S.zManipulator.renderOccluded),m=he(h(.85,0),S.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:n,transform:p,material:c,stateMask:1},{geometry:o,material:c,stateMask:1},{geometry:n,transform:p,material:u,stateMask:2},{geometry:o,material:u,stateMask:2},{geometry:n,transform:p,material:d,stateMask:1},{geometry:o,material:d,stateMask:1},{geometry:n,transform:p,material:m,stateMask:2},{geometry:o,material:m,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}createManipulator(){const e=new pe({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=Ki;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=k(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),s=z($i,i,t.eye);U(s,s);const o=ea;this._view.renderCoordsHelper.worldUpAtPosition(Ki,o);const n=Math.abs(L(s,o)),l=F($i,s,o),p=F($i,l,o),h=B(n,.01,1),c=1-Math.sqrt(1-h*h)/h/t.fullWidth,u=this._radius/70,d=S.zManipulator.width*u;C(p,U(p,p),(1/c-1)*a+r*d),e[12]-=$i[0],e[13]-=$i[1],e[14]-=$i[2]},this._manipulator=e,this.updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Ki=P(),$i=P(),ea=P();class ta extends Ni{constructor(e){super(),this._handles=new He,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new Qi({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new qi({tool:t,view:i,radius:r}),this.zManipulation=new Ji({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Ce([this.xyManipulation.createGraphicDragPipeline(((t,i,a,r,s)=>e(0,t,i,a,r,s)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,a,r,s)=>e(1,t,i,a,r,s)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,a,r,s)=>e(2,t,i,a,r,s)),t,i)])}createDragPipeline(e,t,i,a){return Ce([this.xyManipulation.createDragPipeline(((t,i,a,r,s)=>e(0,t,i,a,r,s)),t,i,a),this.xyAxisManipulation.createDragPipeline(((t,i,a,r,s)=>e(1,t,i,a,r,s)),t,i,a),this.zManipulation.createDragPipeline(((t,i,a,r,s)=>e(2,t,i,a,r,s)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(n("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this.xyAxisVisible?r(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(ia),this._handles.add(t,ia)};for(const e of i)this._handles.add(e.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=r(e)&&"point-3d"===e.type&&e.symbolLayers;return!!t&&t.length>0&&t.some((e=>"icon"===e.type))?Fi:70}}const ia="disable-xy-axis-display";class aa extends Ni{constructor(e){super(),this._handles=new He,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return Yi(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=r(i.geometry)?i.geometry.spatialReference:null;return Ee(this._manipulator,((r,s,o,n,l)=>{const p=s.next(gt(l,t,i,a)).next(Re()).next(De());e(r,p,o,n,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new bt({graphic:t,view:e,selectable:!0,cursor:"move"})}}class ra{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class sa{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class oa{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let na=class extends(c(h.EventedMixin(we))){constructor(e){super(e),this.graphics=new Ve,this.enableZ=!0,this.type="move-3d",this._toolHandles=new He,this.snappingPipeline=new A}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators(),this.complete()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>0===St(e))).map((e=>new la(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new aa({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,a,r)=>this.buildDragEventPipeline(e,0,t,i,a,r))))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new ta({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?ta.radiusForSymbol(e[0].graphic.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this.updateMoveManipulation(e);for(const t of e)this.handles.add([t.state.on("changed",i),t.state.watch("displaying",i)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",(()=>this.updateMoveManipulationAngle(a)))),this.handles.add(t.createDragPipeline(((t,i,a,r,s)=>this.buildDragEventPipeline(e,t,i,a,r,s)),f(a.graphic),o(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const a=t.graphic,r=Ui({view:this.view,graphic:a,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>ze()});i(r)||(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof w&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this.updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this.updateMoveManipulation(e)))]),this.handles.add(r))}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>Xi(e.graphic.geometry)}updateMoveManipulation(e){const t=Ue(0,0,0,this.view.spatialReference);let i=0,a=!1;const s=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&Le(e)&&(a=!0);const o=s.geometryRepresentation instanceof w&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:ce(this.view,e);r(o)&&(t.x+=o.x,t.y+=o.y,t.z+=o.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,s.location=t,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=a):s.available=!1}buildDragEventPipeline(e,t,i,a,r,s){const o=[],n=[];let l=null,p=null;const h=()=>{for(const e of o)e.dragging=!1;o.length=0,n.length=0,l=null,p=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;a=this.buildSnappingPipelineSteps(t,f(t),a,r,s)}const c=a.next((t=>{if("start"===t.action){o.length=0,n.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(o.push(t),n.push(t.graphic),t.dragging=!0);if(0!==n.length&&(this._moveManipulation.interactive=!1,l=Ie(n,this.view.state.viewingMode),p=Pe(n),this.emit("graphic-move-start",new ra(n)),this.destroyed))return null}return 0!==n.length?t:null})).next((e=>l(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,r=i.y-t.y;if(this.emit("graphic-move",new sa(a,r,n)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new oa(n)),this.destroyed)return null;h()}}));return r.next((e=>p(e))).next((()=>{if(this.emit("graphic-move-stop",new oa(n)),this.destroyed)return null;h()})),c}buildSnappingPipelineSteps(e,t,a,r,s){const o=e.geometry;if(i(o)||"point"!==o.type&&"mesh"!==o.type)return a;const n=("point"===o.type?o:o.anchor).clone(),l=new xt({elevationInfo:t,pointer:s,geometry:Et.fromGeometry(n,this.view.viewingMode),visualizer:new R,excludeFeature:e}),p=this.snappingManager;return a.next((t=>{n.z=_(this.view,n,f(e),{mode:"absolute-height",offset:0});return{...t,snapOrigin:l.coordinateHelper.fromPoint(n)}})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:p,cancel:r,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};e([m({constructOnly:!0,nonNullable:!0})],na.prototype,"view",void 0),e([m({readOnly:!0})],na.prototype,"graphics",void 0),e([m({constructOnly:!0,nonNullable:!0})],na.prototype,"enableZ",void 0),e([m({constructOnly:!0})],na.prototype,"snappingManager",void 0),e([m({readOnly:!0})],na.prototype,"type",void 0),e([m({readOnly:!0})],na.prototype,"updating",null),na=e([g("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],na);class la{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ge({graphic:e})}get graphic(){return this.state.graphic}}function pa(e,t,i){const a="on-the-ground"===i.mode?1:0;return new Gt(e,a,t,0)}function ha(e,t,a){const r=P();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;const s=ca(e,t,Tt(a.plane)),o=ca(e,t,a.edgeDirection);if(i(s)||i(o))return null;const n=F(P(),s,o);return kt(r,n,zt())}function ca(e,t,i){const a=Ue(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),r=P(),s=P();return e.renderCoordsHelper.toRenderCoords(t,r)&&e.renderCoordsHelper.toRenderCoords(a,s)?Z(s,r,s):null}let ua=class extends(h.EventedMixin(u)){constructor(e){super(e),this._vertexManipulatorMaterial=he(S.colorToVec4(S.reshapeManipulators.vertex.color),S.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=ue(S.colorToVec4(S.reshapeManipulators.vertex.outlineColor),S.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=ue(S.colorToVec4(S.reshapeManipulators.vertex.hoverOutlineColor),S.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=he(S.colorToVec4(S.reshapeManipulators.edge.color),S.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=ue(S.colorToVec4(S.reshapeManipulators.edge.outlineColor),S.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=he(S.colorToVec4(S.reshapeManipulators.edgeOffset.color),S.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=he(S.colorToVec4(S.reshapeManipulators.edgeOffset.hoverColor),S.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=he(S.colorToVec4(S.reshapeManipulators.selected.color),S.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=ue(S.colorToVec4(S.reshapeManipulators.selected.outlineColor),S.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=ue(S.colorToVec4(S.reshapeManipulators.selected.hoverOutlineColor),S.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new He,this._manipulatorInfos=[],this._editGeometryHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new A,this._snappingPipelineHandle=new A,this._vertexLaserLineVisualElement=null}initialize(){const e=new ge({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear()}get inputGeometry(){return r(this._editGeometryHelper)?this._editGeometryHelper.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._removeManipulators(),this._resetGrabbingDragging(),this._editGeometryHelper=s(this._editGeometryHelper)}_removeManipulators(){this._moveManipulation=s(this._moveManipulation),this._graphicMoveManipulation=s(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(i(this._editGeometryHelper))return;const e=f(this.graphic);for(const t of this._editGeometryHelper.editGeometry.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return r(this._editGeometryHelper)&&this._editGeometryHelper.canRedo}get canUndo(){return r(this._editGeometryHelper)&&this._editGeometryHelper.canUndo}redo(){if(i(this._editGeometryHelper))return null;const e=this._editGeometryHelper.redo();return r(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}undo(){if(i(this._editGeometryHelper))return null;this.emit("undo");const e=this._editGeometryHelper.undo();return r(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._clear(),i(e)||(s(this._editGeometryHelper),this._editGeometryHelper=Et.fromGeometry(e,this.view.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const a=[],r=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),s=1===e&&r;for(const e of this._manipulatorInfos)ma(e)&&(e.manipulator.grabbing||s&&!e.manipulator.selected||a.push(e),i++);if(0===a.length)return;this._moveVertices(a,t);if(a.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)ma(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const r=[];for(const t of this._manipulatorInfos)ma(t)&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&r.push(t);this._moveVertices(r,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new aa({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=o(this._editGeometryHelper).createUndoGroup()),t))).next((t=>{this._perGraphicManipulatorDragAction(0,t),"end"===t.action&&(e=l(e))})),a.next(this._cancelDragOperation((()=>e=l(e))))})))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))]))),this._moveManipulation=new ta({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Le(this.graphic),snapToScene:!1,radius:ta.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=o(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline(((t,i,a,r,s)=>{const n=a.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>ma(e)&&e.manipulator.selected));return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new xt({geometry:o(this._editGeometryHelper),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new R}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Re()).next((e=>(this._perGraphicManipulatorDragAction(1,e),e)));return r.next(this._cancelDragOperation()),n}),e,t,this.graphic),d(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),d(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.handles.remove(e)}))]),this._updateMoveManipulationPosition();const i=Ui({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){r(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});r(i)&&(this._outlineVisualElement=i.visualElement instanceof w?i.visualElement:null),r(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=f(this.graphic)){const a=S.reshapeManipulators.edgeOffset,r=a.size/2,s=r+a.collisionPadding;if(i(this._edgeOffsetManipulatorGeometryInside)||i(this._edgeOffsetManipulatorGeometryOutside)){const e=r/s,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=oe.createExtrudedTriangle(t,e/2,e/2,a.height,a.offset),this._edgeOffsetManipulatorGeometryOutside=oe.createExtrudedTriangle(-t,e/2,e/2,a.height,-a.offset)}const n=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],p=new pe({view:this.view,renderObjects:n,elevationInfo:"on-the-ground"!==t.mode||Pt(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,touchMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:T(0,0,1)},collisionPriority:1}),h=new pe({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:"default"});h.grabbable=!1;const c={manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,visibilityManipulator:h,elevationInfo:t,visibilityHandle:null},u=()=>{l(c.visibilityHandle);(!p.focused&&!h.focused||(()=>function(e,t,i){const a=i.projectToRenderScreen(e,Vt()),r=i.projectToRenderScreen(t,Vt());return N(z(a,a,r))}(this._getManipulatorInfoFromHandle(c.handle.left).manipulator.renderLocation,this._getManipulatorInfoFromHandle(c.handle.right).manipulator.renderLocation,this.view.state.camera)<a.minSquaredEdgeLength)())&&(p.grabbable=!1,c.visibilityHandle=Ce([p.disableDisplay(),{remove:()=>{p.grabbable=!0}}]))};this._manipulatorHandles.add([p.events.on("focus-changed",(()=>u())),h.events.on("focus-changed",(()=>u())),{remove:()=>{l(c.visibilityHandle),this.manipulators.remove(c.visibilityManipulator)}}],p),u(),this._updateEdgeOffsetManipulator(c);const d=this._getManipulatorInfoFromHandle(c.handle.left).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c))),m=this._getManipulatorInfoFromHandle(c.handle.right).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c)));c.locationUpdateHandle=Ce([d,m]),this._manipulatorHandles.add(c.locationUpdateHandle,p),this._manipulatorHandles.add(this._watchAndUpdateGrabState(p,!0),p);const g=Ee(p,((e,i,a)=>{this._clearSelection();const{step:r,cleanup:s}=this._initializeEdgeOffset(c,t);i.next((e=>this._trackNumDragging(e))).next(Ge(this.view,e.elevationAlignedLocation)).next(r).next(yt(this.view)).next(vt(this.view,o(this._editGeometryHelper).editGeometry.coordinateHelper.spatialReference)).next(Re()).next(this._applyEdgeOffsetStep(c)).next((e=>{"end"===e.action&&s()})),a.next((e=>(s(),e))).next(this._cancelDragOperation())}));return this._manipulatorHandles.add(g,p),this._manipulatorHandles.add([p.events.on("immediate-click",(e=>{e.shiftKey||this._clearSelection(),e.stopPropagation()})),h.events.on("immediate-click",(e=>this.emit("immediate-click",{...e,graphic:this.graphic})))],p),this._manipulatorInfos.push(c),this.manipulators.add(p),this.manipulators.add(h),this.emit("manipulators-changed"),c}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=o(this._editGeometryHelper).editGeometry.coordinateHelper,i=ha(this.view,e.manipulator.elevationAlignedLocation,pa(t,e.handle,o(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.renderLocation,s=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.renderLocation,n=r(i)?function(e,t,i){const a=Tt(e),r=Z(P(),t,i),s=F(P(),r,a),o=F(P(),r,s);return lt(r[0],r[1],r[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1)}(i,a,s):pt;e.manipulator.modelTransform=n,e.visibilityManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.visibilityManipulator.modelTransform=n;const l=Y(z(va,a,s))/2;e.visibilityManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_initializeEdgeOffset(e,t){const a=o(this._editGeometryHelper),r=pa(a.editGeometry.coordinateHelper,e.handle,t),s=a.createUndoGroup(),n=ha(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.left.left),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.right.right),0);const p=()=>new It({paths:[[e.handle.left.pos,e.handle.right.pos]],spatialReference:o(this._editGeometryHelper).editGeometry.coordinateHelper.spatialReference}),h=new w({view:this.view,isDraped:this._graphicState.isDraped,geometry:p(),elevationInfo:e.elevationInfo,width:S.visualElements.lineGraphics.outline.width,color:S.colorToVec4(j.main),attached:!0});let c;const u=()=>{this._cleanEdgeOffsetCollapsedEdges(e),c=l(c)},d=this.on("undo",u);return c=Ce([Te(h),this._graphicState.watch("isDraped",(e=>h.isDraped=e)),this._graphicState.on("changed",(()=>h.geometry=p())),s,d]),{step:e=>i(r)||i(n)?(u(),null):{...e,operation:r,plane:n},cleanup:u}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||i(t.operation))return t;this._updateEventState(2);const{mapDeltaX:a,mapDeltaY:r,mapDeltaZ:s}=t;return(a||r||s)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const a=null==(t=e.handle.left.left)?void 0:t.left,r=e.handle.left,s=null==(i=e.handle.right.right)?void 0:i.right,n=e.handle.right,l=o(this._editGeometryHelper).editGeometry.coordinateHelper,p=1e-6,h=[];a&&l.distance(a.pos,r.pos)<p&&h.push(this._getManipulatorInfoFromHandle(r)),(l.distance(r.pos,n.pos)<p||s&&l.distance(s.pos,n.pos)<p)&&h.push(this._getManipulatorInfoFromHandle(n)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=f(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(i(this._vertexManipulatorGeometry)||i(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(S.reshapeManipulators.vertex);this._vertexManipulatorGeometry=oe.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=oe.createSphereGeometry(t,16,16)}if(i(this._edgeManipulatorGeometry)||i(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(S.reshapeManipulators.edge);this._edgeManipulatorGeometry=oe.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=oe.createSphereGeometry(t,16,16)}const a=r(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|fa.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|fa.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|fa.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&a.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|fa.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|fa.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|fa.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|fa.Edge});const s=new pe({view:this.view,renderObjects:a,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(s,e,t);const n="edge"===e.type?{manipulator:s,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:s,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(n),this.manipulators.add(s),this._updateManipulatorPosition(n),"edge"===n.type){const e=this._getManipulatorInfoFromHandle(n.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(n))),t=this._getManipulatorInfoFromHandle(n.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(n)));n.locationUpdateHandle=Ce([e,t]),this._manipulatorHandles.add(n.locationUpdateHandle,s)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!0),s);const p=Ee(s,((e,i,a,r)=>{let s=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(s=o(this._editGeometryHelper).createUndoGroup()),ga(n)){const t=this._splitEdgeManipulator(n);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:n,snapOrigin:n.handle.pos}})).next(Ge(this.view,e.elevationAlignedLocation)).next(ft(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new xt({geometry:o(this._editGeometryHelper),elevationInfo:t,pointer:r,excludeFeature:this.graphic,visualizer:new R}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Re()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(s=l(s))})),a.next(this._cancelDragOperation((()=>s=l(s))))}));return this._manipulatorHandles.add(p,s),this._manipulatorHandles.add([s.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,n))),s.events.on("select-changed",(()=>{n.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))],s),this.emit("manipulators-changed"),n}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=r(this._editGeometryHelper)?this._editGeometryHelper.geometry:null,r(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=fa.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=S.reshapeManipulators.vertex.size/2+S.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=r(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=fa.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=S.reshapeManipulators.edge.size/2+S.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Pt(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=o(this._editGeometryHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,ya),e.manipulator.grabbing&&r(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(r(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=i.location,s=a.location,o=.5,n=r.x+o*(s.x-r.x),l=r.y+o*(s.y-r.y),p=r.hasZ&&s.hasZ?0:void 0;e.manipulator.location=Ue(n,l,p,t.geometry.spatialReference)}else X(va,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=va}}_splitEdgeManipulator(e,t=.5){const i=o(this._editGeometryHelper),a=o(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const r=f(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(a)):(s=e,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),a.left&&this._createVertexOrEdgeManipulator(a.left),a.right&&this._createVertexOrEdgeManipulator(a.right),this.outputGeometry=i.geometry,this._updateManipulatorPosition(s),this._updateSelection(e.manipulator);const n=this._updateEventState(2),l=i.editGeometry.coordinateHelper.toArray(s.handle.pos),p=i.editGeometry.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:p,vertexIndex:o(a.index)}],added:l}),n&&this._updateEventState(0),s}_updateMoveManipulationPosition(){const e=I(va,0,0,0);let t=0,a=!1,s=null,n=null;for(const r of this._manipulatorInfos)ma(r)&&(r.manipulator.selected?(t++,H(e,e,r.manipulator.renderLocation),i(s)||r.selectedIndex>s.selectedIndex?(n=s,s=r):(i(n)||r.selectedIndex>n.selectedIndex)&&(n=r)):a=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Le(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Le(this.graphic)}if(0!==t){let e=0;if(r(s)){const t=s.handle.pos,i=r(n)?n.handle.pos:s.handle.left&&s.handle.left.left?s.handle.left.left.pos:null,a=!r(n)&&s.handle.right&&s.handle.right.right?s.handle.right.right.pos:null;i&&a?this._moveManipulation.xyAxisManipulation.available=!1:i?e=da(i,t):a&&(e=da(t,a))}this._moveManipulation.angle=e,this._moveManipulation.radius=Fi}else this._moveManipulation.angleDeferred=()=>Xi(o(this.graphic.geometry)),this._moveManipulation.radius=ta.radiusForSymbol(this.graphic.symbol);0!==t&&a?(C(e,e,1/t),ya.spatialReference=o(this._editGeometryHelper).geometry.spatialReference,ya.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ya),this._moveManipulation.elevationAlignedLocation=ya):r(this._outlineVisualElement)&&!this._graphicState.isDraped&&r(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:de(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=o(this._editGeometryHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=o(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:o(e.index)}}));this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?0:1)){const a=o(this._editGeometryHelper);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.geometry;for(const t of e)this._updateManipulatorPosition(t)}_offsetEdge(e,t){if(i(t.operation))return;const a=o(this._editGeometryHelper),r=t.operation.clone();r.distance=t.operation.signedDistanceToPoint(t.mapEnd),a.updateVertices([e.handle.left,e.handle.right],r),this.outputGeometry=a.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.left)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.right))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),ga(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function da(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function ma(e){return"vertex"===e.handle.type}function ga(e){return"edge"===e.handle.type}e([m({constructOnly:!0})],ua.prototype,"tool",void 0),e([m()],ua.prototype,"inputGeometry",null),e([m()],ua.prototype,"outputGeometry",void 0),e([m({readOnly:!0})],ua.prototype,"updating",null),ua=e([g("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],ua);const ya=Ue(0,0,null,null),va=P();var fa;!function(e){e.Vertex=16,e.Edge=32}(fa||(fa={}));let Ma=class extends(h.EventedMixin(we)){constructor(e){super(e),this._handles=new He,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=s(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=wt(this.graphic);this._reshapeOperation.inputGeometry=r(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==jt(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){i(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new ua({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),d(this,"graphic",(()=>{this._updateGraphic()}),!0)]),this.complete()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){r(this.snappingManager)&&this.snappingManager.doneSnapping(),r(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){r(this.snappingManager)&&this.snappingManager.doneSnapping(),r(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};var _a;e([m()],Ma.prototype,"_reshapeOperation",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"view",void 0),e([m({constructOnly:!0})],Ma.prototype,"graphic",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"enableZShape",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"enableZVertex",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"enableMoveGraphic",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"enableMidpoints",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ma.prototype,"enableEdgeOffset",void 0),e([m({readOnly:!0})],Ma.prototype,"type",void 0),e([m({constructOnly:!0})],Ma.prototype,"snappingManager",void 0),e([m({readOnly:!0})],Ma.prototype,"updating",null),Ma=e([g("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Ma),function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(_a||(_a={}));class ba{constructor(e){this.mode=null,this._handles=new He,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new h,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>r(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){r(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Ft({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){r(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Ee(e,((e,i,a)=>{this._scaleRotateDragData=null,this.adapter.restart();const s={mode:"none",origin:q(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=s,this.updateDragState();const o=ht.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next(Mt(this.tool.view,kt(e.renderLocation,o,zt()))).next((e=>{const i=Tt(e.plane),a=me(e.renderStart,e.renderEnd,s.origin,i),o=Yt.shortestSignedDiff(s.angle,a);s.angleDir=B(s.angleDir+o,-.3,.3),s.angle=a;const n=function(e,t){const i=z(ht.get(),t.renderStart,e.origin),a=z(ht.get(),t.renderEnd,e.origin),r=Y(i),s=Y(a);if(0===r)return 0;return s/r}(s,e),l=n-this.adapter.scale;if(s.scaleDir=B(s.scaleDir+l,-.2,.2),this.onScaleChanged(),"none"===s.mode){const i=this.mode||function(e,t,i,a){const{renderStart:r,renderEnd:s}=e,o=Sa(r,a,ht.get()),n=Sa(s,a,ht.get());if(Q(o,n)<100)return null;const l=z(ht.get(),r,i),p=F(ht.get(),l,Tt(t)),h=r,c=H(ht.get(),h,p),u=Sa(i,a,ht.get()),d=o,m=Sa(c,a,ht.get()),g=z(ht.get(),m,d),y=z(ht.get(),o,u),v=Bt(d,g),f=Bt(u,y);if(Zt(v,n)<Zt(f,n))return"rotate";return"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if(r(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}s.mode=i}}switch(s.mode){case"rotate":this.adapter.angle=s.initialAngle+a;break;case"scale":this.adapter.scale=n,this.onScaleChanged()}switch(this.updateDragState(),this.updateManipulatorTransform(),e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:W(s.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:n,yScale:n})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:W(s.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:n,yScale:n});break;default:case"none":}}"end"===e.action&&(this.startAnimation(wa(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),a.next((()=>{if(this.adapter.cancel(),r(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(wa(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),d(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e))])}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(_a.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(_a.Unlocked,!(r(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),r(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(_a.ScaleIn|_a.ScaleOut,!1),this.ringManipulator.updateStateEnabled(_a.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(_a.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(_a.RotateLeft|_a.RotateRight,!1),this.ringManipulator.updateStateEnabled(_a.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(_a.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(_a.ScaleIn|_a.ScaleOut|_a.RotateLeft|_a.RotateRight,!1)}updateManipulatorTransform(){const e=Ke(ct.get()),t=this.adapter.angle;tt(e,e,t,T(0,0,1));const i=this.getScale(),a=it(ct.get(),I(ht.get(),i,i,i)),r=Ke(ct.get());et(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){const e=(e,t,i)=>{const a=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<r+1;s++){const o=e+s*(t-e)/r;a.push(T(i*Math.cos(o),i*Math.sin(o),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>oe.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(160),r=i(a,24),s={left:[],right:[]},o=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-Bi,n=a+r,l=a+Math.PI/2-r,p=e(n,l,190),h=i(p,9);o.push(p),o.push(e(n,l,201)),s.left.push(h),s.right.push(h);for(let e=0;e<2;e++){const t=0===e,i=nt();if(t){st(i,i,[1,-1,1]),tt(i,i,-n,[0,0,1]);const e=Math.round(.2*(p.length-1));i[12]=p[e][0],i[13]=p[e][1],i[14]=p[e][2]}else{tt(i,i,l,[0,0,1]);const e=Math.round(.8*(p.length-1));i[12]=p[e][0],i[13]=p[e][1],i[14]=p[e][2]}const a=oe.createExtrudedTriangle(60,0,23,.5);oe.transformInPlace(a,i),(t?s.left:s.right).push(a)}}const n=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,r=Math.PI/2-Zi,s=a+r,o=a+Math.PI/2-r,l=e(s,o,213);n.push(i(l,9))}const l=t(190),p=t(213),h=i(l,9),c=i(p,9),u=t(130),d=t(107),m=i(u,9),g=i(d,9),y=this.createMaterial(),v=this.createMaterial(.66),M=this.createMaterial(.5),_=this.createMaterial(.33);let b=[{geometry:r,material:y,stateMask:_a.DelayedFocused},{geometry:r,material:M,stateMask:0}];this.mode&&"scale"!==this.mode||(b=b.concat([{geometry:n,material:y,stateMask:_a.DelayedFocused|_a.Unlocked},{geometry:h,material:v,stateMask:_a.DelayedFocused|_a.ScaleIn},{geometry:c,material:_,stateMask:_a.DelayedFocused|_a.ScaleIn},{geometry:m,material:v,stateMask:_a.DelayedFocused|_a.ScaleOut},{geometry:g,material:_,stateMask:_a.DelayedFocused|_a.ScaleOut}])),this.mode&&"rotate"!==this.mode||(b=b.concat([{geometry:s.right,material:y,stateMask:_a.DelayedFocused|_a.Unlocked},{geometry:s.left,material:y,stateMask:_a.DelayedFocused|_a.RotateLeft},{geometry:s.right,material:y,stateMask:_a.DelayedFocused|_a.RotateRight}]));const S=[a,...o];return new pe({view:this.tool.view,renderObjects:b,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:f(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:S,direction:T(0,0,1)}})}createMaterial(e=1){const t=[...Li,e];return new ne({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{ringManipulator:this.ringManipulator}}}function Sa(e,t,i){return t.projectToScreen(e,ja),I(i,ja[0],ja[1],0)}function wa(e,t){let i=null,a=1;const r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const ja=Ht();function xa(e){return r(e.geometry)&&"mesh"===e.geometry.type?(t=e.geometry,r(t.transform)?function(e,t){let i=t.clone(),a=null;return{undo:t=>{a=r(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=r(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}(t,t.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(t)):function(e){let t=e.geometry,i=p;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e);var t}let Ea=class extends u{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(Ga);const e=this.geometry.transform;if(this.scale=1,r(e)){const t=qt(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=V(Wt(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Xt((()=>({angle:this.angle,scale:this.scale})),(e=>this.update(e))),Ga)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return xa(this.graphic)}update({scale:e,angle:t}){const i=this.geometry.anchor,a=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:i,geographic:a}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,W(t-this.previousAngle),{origin:i,geographic:a}),this.previousAngle=t,this.graphic.notifyGeometryChanged())}};e([m({constructOnly:!0})],Ea.prototype,"graphic",void 0),e([m({constructOnly:!0})],Ea.prototype,"geometry",void 0),e([m({constructOnly:!0})],Ea.prototype,"viewingMode",void 0),e([m()],Ea.prototype,"angle",void 0),e([m()],Ea.prototype,"scale",void 0),Ea=e([g("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ea);const Ga="scale-heading-update-key";let Oa=class extends u{constructor(e){super(e),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(Da);const e=r(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:p;if(this.symbol=r(e)?e.clone():null,this.initialSizes=[],r(e)){const t=this.findLayerView();r(t)&&(this.initialSizes=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray())}this.angle=0,r(e)&&e.symbolLayers.some((e=>!("object"!==e.type||!r(e.heading))&&(this.angle=-V(e.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(Xt((()=>({angle:this.angle,scale:this.scale})),(e=>this.updateSymbol(e))),Da)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e,this.restart()},redo:i=>{e=i.symbol,i.symbol=t,this.restart()}}}updateSymbol({scale:e,angle:t}){const s=this.graphic.symbol;if(i(this.symbol)||i(s)||"point-3d"!==s.type)return;const o=s.clone(),n=-W(t-this.initialAngle);let l=!1;this.forEachObjectSymbolLayerPair(this.symbol,o,((t,i,s)=>{const o=a(t.heading,0)+n;i.heading!==o&&(i.heading=o,l=!0);const p=this.initialSizes[s];if(r(p)&&"width"in p){p.width=this.sizeFilter(p.width),p.height=this.sizeFilter(p.height),p.depth=this.sizeFilter(p.depth);const t=p.width*e;i.width!==t&&(i.width=t,l=!0);const a=p.depth*e;i.depth!==a&&(i.depth=a,l=!0);const r=p.height*e;i.height!==r&&(i.height=r,l=!0)}})),l&&(this.graphic.symbol=o)}forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,a)=>{const r=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===r.type&&i(e,r,a)}))}};e([m()],Oa.prototype,"angle",void 0),e([m()],Oa.prototype,"scale",void 0),e([m({constructOnly:!0})],Oa.prototype,"graphic",void 0),e([m()],Oa.prototype,"symbol",void 0),e([m({constructOnly:!0})],Oa.prototype,"findLayerView",void 0),e([m({constructOnly:!0})],Oa.prototype,"sizeFilter",void 0),Oa=e([g("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Oa);const Da="scale-heading-update-key";let Aa=class extends(c(h.EventedMixin(we))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new A}initialize(){this.graphicState=new ge({graphic:this.graphic}),this.moveManipulation=new ta({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Le(this.graphic),radius:ta.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:this.graphicState.graphic}),e.stopPropagation()}))))),this.moveManipulation.elevationInfo=f(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((t,i,a,s,o)=>(r(e)&&0===t&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new xt({elevationInfo:f(this.graphic),pointer:o,geometry:Et.fromGeometry(new Lt({spatialReference:e.spatialReference}),this.view.viewingMode),visualizer:new R,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:s}),this.snappingPipeline.next)),a)),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,s={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",s),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this.moveManipulation.angle=r(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(()=>this.updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new ba({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([Ui({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>ze()}),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((e=>{e instanceof pe&&this.handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorsInteractive())))})),this.complete()}updateManipulatorsInteractive(){i(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}createScaleRotateAdapter(){return r(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Ea({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Oa({graphic:this.graphic,sizeFilter:e=>this.enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer))})}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),r(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Le(this.graphic)}))}createGeometryUndoRecord(){return xa(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=s(this.scaleRotate),this.scaleRotateAdapter=s(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this.moveManipulation.location=e,r(this.scaleRotate)&&(this.scaleRotate.location=e)}set elevationAlignedLocation(e){this.moveManipulation.elevationAlignedLocation=e,r(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}reset(){}onDetach(){r(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){r(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(i(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}onGeometryChanged(){de(this.view,this,this.graphic)}enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:r(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};e([m({constructOnly:!0,nonNullable:!0})],Aa.prototype,"view",void 0),e([m({constructOnly:!0,nonNullable:!0})],Aa.prototype,"graphic",void 0),e([m({constructOnly:!0,nonNullable:!0})],Aa.prototype,"enableZ",void 0),e([m()],Aa.prototype,"enableRotation",void 0),e([m()],Aa.prototype,"enableScaling",void 0),e([m({value:!1})],Aa.prototype,"snapToScene",null),e([m({constructOnly:!0})],Aa.prototype,"snappingManager",void 0),e([m({readOnly:!0})],Aa.prototype,"type",void 0),e([m({readOnly:!0})],Aa.prototype,"updating",null),Aa=e([g("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Aa);class Ra{constructor(){this.lastDragEvent=null,this.next=new Ae,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&r(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=hi(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}function Ia(e,t){return Va(e,t,!1)}function Pa(e,t){return Va(e,t,!0)}function Va(e,t,i){if(e instanceof Ot){if(e.operation instanceof Dt)return function(e,t,i=!1){const a=i?-1:1,r=T(a*e.dx,a*e.dy,a*e.dz);H(t.origin,t.origin,r)}(e.operation,t,i),!0;if(e.operation instanceof At)return function(e,t,i=!1){const a=i?-e.angle:e.angle;J(t.basis1,t.basis1,K,a),J(t.basis2,t.basis2,K,a)}(e.operation,t,i),!0;if(e.operation instanceof Rt)return function(e,t,i=!1){const a=i?1/e.factor1:e.factor1,r=i?1/e.factor2:e.factor2;C(t.basis1,t.basis1,a),C(t.basis2,t.basis2,r),Ha(t.origin,e.origin,e.axis1,a),Ha(t.origin,e.origin,e.axis2,r)}(e.operation,t,i),!0}return!1}function Ha(e,t,i,a){const r=ut.get(),s=Jt(r,e,t),o=Kt(r,i,$t(i,s));ei(e,e,o,a-1)}let Ca=class extends(h.EventedMixin(we)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new Ra,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new He,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=ni(),this.mapBoundsStart=ni(),this.displayBounds=ni(),this.displayBoundsStart=ni(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new ge({graphic:this.graphic});const e=this.graphic.geometry;this.editGeometryHelper=Et.fromGeometry(e,this.view.viewingMode),this.graphicMoveManipulation=new aa({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=ci(this.view,0),this.moveZManipulator.state|=ui,this.handles.add(this.watch("enableZ",(()=>this.updateManipulatorAvailability(this.moveZManipulator,0)))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((e=>{const t=di(this.view,e);return this.handles.add(this.watch("enableScaling",(()=>this.updateManipulatorAvailability(t,2)))),t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this.handles.add(this._createResizeDragPipeline(t,e)),t})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new ji(Si,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=mi(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(()=>this.updateManipulatorAvailability(this.rotateManipulator,3)))),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);const t=Ui({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>ze()});r(t)&&(this.outlineVisualElement=t.visualElement instanceof w?t.visualElement:null),r(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this.updateDisplayBounds(this.mapBounds)))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.graphicState.watch("displaying",(()=>this.updateAllManipulatorAvailability())),d(this.graphicState,"isDraped",(()=>this.graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",(()=>this.updateDisplayBounds(this.mapBounds))));const a=e=>{this.handles.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()})))};this.forEachManipulator(a),this.graphicMoveManipulation.forEachManipulator(a);const s=(e,t)=>{this.handles.add(e.events.on("immediate-click",(e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))};this.forEachManipulator(s),this.graphicMoveManipulation.forEachManipulator(s),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}graphicDrapedChanged(){this.handles.remove(Ta),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{r(this.attachmentOrigin)&&qe(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds(this.mapBounds)})),Ta)}updateAllManipulatorAvailability(){this.forEachManipulator(((e,t)=>this.updateManipulatorAvailability(e,t)))}updateManipulatorAvailability(e,t){const i=this.graphicState.displaying,a=this.grabbing&&!e.grabbing;e.interactive=!a;const r=this.enableZ&&Le(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!a&&this.enableScaling,e.state=this.enableScaling?gi:yi;break;case 0:e.available=i&&r;break;default:e.available=i}}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,2))),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryHelper.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds(this.mapBounds)}calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryHelper.editGeometry,i=t.components[0].edges[0],r=Jt(ut.get(),i.left.pos,i.right.pos);si(r,r);const s=a(ce(this.view,this.graphic),e.extent.center);let o=za*this.view.pixelSizeAt(s);const n=this.view.spatialReference;n!==e.spatialReference&&(o*=Qt(n)/Qt(e.spatialReference)),function(e,t,i,a){a||(a=ni());const r=ti(ut.get(),e[1],-e[0]),s=ti(ut.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=ti(ut.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),n=ut.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;ti(n,$t(e,i),$t(r,i)),ii(s,s,n),ai(o,o,n)}))));const l=1e-6,p=ti(ut.get(),o[0]-s[0]<l?i/2:0,o[1]-s[1]<l?i/2:0);Jt(s,s,p),ri(o,o,p),Kt(a.basis1,e,(o[0]-s[0])/2),Kt(a.basis2,r,(o[1]-s[1])/2),ti(a.origin,s[0]*e[0]+s[1]*r[0],s[0]*e[1]+s[1]*r[1]),ri(a.origin,a.origin,a.basis1),ri(a.origin,a.origin,a.basis2)}(r,t,o,this.mapBounds)}updateDisplayBounds(e){const t=this.graphic.geometry,i=r(this.outlineVisualElement)&&!this.graphicState.isDraped&&r(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:ce(this.view,this.graphic);this.attachmentOrigin=a(i,t.extent.center);const s=r(i)?i.z:We(e.origin,this.view.elevationProvider,re.fromElevationInfo(f(this.graphic)),this.view.renderCoordsHelper),o=pi(e);I(o.origin,e.origin[0],e.origin[1],s),function(e,t,i,a=0,r){r||(r=ni()),t.toRenderCoords(e.origin,i,r.origin);const s=ht.get();H(s,e.origin,e.basis1),H(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=ht.get();H(o,e.origin,e.basis1),z(o,o,e.basis2),t.toRenderCoords(o,i,o);const n=ht.get();z(n,e.origin,e.basis1),z(n,n,e.basis2),t.toRenderCoords(n,i,n);const l=ht.get();z(l,e.origin,e.basis1),H(l,l,e.basis2),t.toRenderCoords(l,i,l);const p=X(ht.get(),s,o,.5);z(p,p,r.origin);const h=X(ht.get(),n,l,.5);z(h,r.origin,h),X(r.basis1,p,h,.5);const c=X(ht.get(),l,s,.5);z(c,c,r.origin);const u=X(ht.get(),o,n,.5);z(u,r.origin,u),X(r.basis2,c,u,.5);const d=F(ht.get(),r.basis1,r.basis2),m=F(d,d,r.basis1);U(m,m),C(r.basis2,m,L(r.basis2,m)),C(r.basis1,r.basis1,1+a/Y(r.basis1)),C(r.basis2,r.basis2,1+a/Y(r.basis2)),li(r)}(o,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.focus.location:this.editGeometryHelper.geometry.extent.center;return ka*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this.applyGraphicMoveSteps(t,i)))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryHelper.geometry.spatialReference;return Ee(this.moveZManipulator,((i,a,r)=>{const s=q(i.renderLocation),o=a.next(mt(e,s,t)).next(De());this.applyGraphicMoveSteps(o,r)}))}applyGraphicMoveSteps(e,t){const i=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},pi(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(Re()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{r(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()})),i}_moveDragUpdateGeometry(){return e=>{if(i(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const e of this.editGeometryHelper.editGeometry.components)t.push(...e.vertices);const a="start"===e.action?0:1;return Ia(this.editGeometryHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,a),this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);Ut(this.displayBounds.plane,t,ht.get())&&(pi(this.displayBounds,this.displayBoundsStart),pi(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Ee(e,((e,a,s)=>{i(this.inputState)||(a.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next(Mt(this.view,this.displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),s.next((()=>{r(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin(),r=this.displayBoundsMarginStart,s=$(ht.get(),t.origin);ee(s,s,t.basis1,-i[0]),ee(s,s,t.basis2,-i[1]);const o=z(ht.get(),e.renderEnd,s),n=z(ht.get(),e.renderStart,s),l=hi(e.handle),p=vi(t),h=vi(this.displayBounds)/p,c=(e,t)=>{if(0===e)return 1;let i=Y(t),s=.5*e*L(t,o)/i;const p=s<0?-1:1;if(l){s+=(i-.5*e*L(t,n)/i)*p*h}const c=i<1.5*r?1:Ua;return i=Math.max(i-r,Ua),p>0&&(s-=a),p*Math.max(p*(s/i),c)};return{...e,factor1:c(i[0],t.basis1),factor2:c(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=$(P(),this.mapBoundsStart.origin);ee(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),ee(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=ti(oi(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);si(i,i);const a=[];for(const e of this.editGeometryHelper.editGeometry.components)a.push(...e.vertices);const r="start"===e.action?0:1,s=this.editGeometryHelper.scaleVertices(a,this.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(t),i,e.factor1,e.factor2,r,1);return pi(this.mapBoundsStart,this.mapBounds),Ia(s,this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=fi(this.displayBounds,this.view.renderCoordsHelper,1,zt()),i=this._calculatePickRay(e.screenPoint);Ut(t,i,ht.get())&&(pi(this.displayBounds,this.displayBoundsStart),pi(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Ee(e,((e,t,a)=>{const s=this.inputState;i(s)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next(Mt(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:W(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),a.next((()=>{r(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=Tt(e.rotatePlane),a=me(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=$(P(),this.mapBoundsStart.origin),i=[];for(const e of this.editGeometryHelper.editGeometry.components)i.push(...e.vertices);const a="start"===e.action?0:1,r=this.editGeometryHelper.rotateVertices(i,this.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(t),e.rotateAngle,a,1);return pi(this.mapBoundsStart,this.mapBounds),Ia(r,this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_calculatePickRay(e){const t=Nt(),i=Ct(e);return wi(this.view.state.camera,i,t),U(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=Mi(this.displayBounds,ct.get());_i(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{bi(t,this.resizeHandles[i],e,this.displayBounds)}))}updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:z(ht.get(),i.origin,i.basis1),edge:2},r=ct.get();ot(r,t,a.edge*Math.PI/2),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}cancel(){const e=this.editGeometryHelper.editGeometry.lastOperation;i(e)||(this.editGeometryHelper.undo(),this.graphic.geometry=this.editGeometryHelper.geometry,Pa(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}get canUndo(){return this.editGeometryHelper.canUndo}undo(){if(r(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryHelper.undo();this.graphic.geometry=this.editGeometryHelper.geometry,Pa(o(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}get canRedo(){return this.editGeometryHelper.canRedo}redo(){if(this.canRedo){const e=this.editGeometryHelper.redo();this.graphic.geometry=this.editGeometryHelper.geometry,Ia(o(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};e([m({constructOnly:!0,nonNullable:!0})],Ca.prototype,"view",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ca.prototype,"graphic",void 0),e([m({constructOnly:!0,nonNullable:!0})],Ca.prototype,"enableZ",void 0),e([m()],Ca.prototype,"enableRotation",void 0),e([m()],Ca.prototype,"enableScaling",void 0),e([m()],Ca.prototype,"preserveAspectRatio",null),e([m()],Ca.prototype,"grabbing",void 0),e([m()],Ca.prototype,"inputState",void 0),e([m({readOnly:!0})],Ca.prototype,"type",void 0),Ca=e([g("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ca);const Ta="draped-elevation-changes",ka=10,za=80,Ua=1e-6;export{Oi as DrawGraphicTool,Ca as ExtentTransformTool,na as GraphicMoveTool,Ma as GraphicReshapeTool,Aa as GraphicTransformTool};
