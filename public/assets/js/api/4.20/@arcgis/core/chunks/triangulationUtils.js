/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{e as n}from"./earcut.js";import{i as t}from"../geometry/Polygon.js";import{d as e}from"./deduplicate.js";function o(t){const o=r(t.rings,t.hasZ,1),l=[];let s=0,i=0;for(const t of o.polygons){const e=t.count,r=t.index,c=new Float64Array(o.position.buffer,3*r*o.position.BYTES_PER_ELEMENT,3*e),h=t.holeIndices.map((n=>n-r)),a=new Uint32Array(n(c,h,3));l.push({position:c,faces:a}),s+=c.length,i+=a.length}const c=function(n,t,e){if(1===n.length)return n[0];const o=new Float64Array(t),r=new Uint32Array(e);let l=0,s=0,i=0;for(const t of n){for(let n=0;n<t.position.length;n++)o[l++]=t.position[n];for(let n=0;n<t.faces.length;n++)r[s++]=t.faces[n]+i;i=l/3}return{position:o,faces:r}}(l,s,i),h=e(c.position.buffer,6,{originalIndices:c.faces});return c.position=new Float64Array(h.buffer),c.faces=h.indices,c}function r(n,e,o){const r=n.length,s=new Array(r),i=new Array(r),c=new Array(r);let h=0,a=0,f=0,g=0;for(let t=0;t<r;++t)g+=n[t].length;const p=new Float64Array(3*g);let u=0;for(let g=r-1;g>=0;g--){const y=n[g],d=1===o&&!t(y,!1,!1);if(d&&1!==r)s[h++]=y;else{let n=y.length;for(let t=0;t<h;++t)n+=s[t].length;const t={index:u,pathLengths:new Array(h+1),count:n,holeIndices:new Array(h)};t.pathLengths[0]=y.length,y.length>0&&(c[f++]={index:u,count:y.length}),u=d?l(y,y.length-1,-1,p,u,y.length,e):l(y,0,1,p,u,y.length,e);for(let n=0;n<h;++n){const o=s[n];t.holeIndices[n]=u,t.pathLengths[n+1]=o.length,o.length>0&&(c[f++]={index:u,count:o.length}),u=l(o,0,1,p,u,o.length,e)}h=0,t.count>0&&(i[a++]=t)}}for(let n=0;n<h;++n){const t=s[n];t.length>0&&(c[f++]={index:u,count:t.length}),u=l(t,0,1,p,u,t.length,e)}return a<r&&(i.length=a),f<r&&(c.length=f),{position:p,polygons:i,outlines:c}}function l(n,t,e,o,r,l,s){r*=3;for(let i=0;i<l;++i){const l=n[t];o[r++]=l[0],o[r++]=l[1],o[r++]=s?l[2]:0,t+=e}return r/3}export{r as p,o as t};
