/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{b as t}from"../core/lang.js";import{L as n}from"./Logger.js";import{d as r,l as e,i as s,n as o,a as i,b as a,f as c,j as u,s as f,g,w as l,t as m,A as h,B as p,e as d}from"./mathUtils.js";import{i as j,b as y}from"./mat4.js";import{c as M}from"./vec4.js";import{a as A,f as b}from"./vec4f64.js";import{d as R}from"./ray.js";import{b as v,s as S}from"./vectorStacks.js";function w(t,n,e){const s=r(t,n)/r(t,t);return c(e,t,s)}function x(t,n){return r(t,n)/e(t)}function P(t,n){const o=r(t,n)/(e(t)*e(n));return-s(o)}function _(t,n,e){o(C,t),o(L,n);const a=r(C,L),c=s(a),u=i(C,C,L);return r(u,e)<0?2*Math.PI-c:c}const C=a(),L=a(),k=n.getLogger("esri.geometry.support.sphere");function q(){return A()}function E(t,n=q()){return M(n,t)}function O(t,n){return b(t[0],t[1],t[2],n)}function T(t){return t}function z(t){t[0]=t[1]=t[2]=t[3]=0}function B(t){return t}function I(t){return Array.isArray(t)?t[3]:t}function U(t){return Array.isArray(t)?t:X}function V(t,n,r,e){return b(t,n,r,e)}function D(n,e,s){if(t(e))return!1;const o=f(v.get(),e.origin,U(n)),i=r(e.direction,e.direction),a=2*r(e.direction,o),u=a*a-4*i*(r(o,o)-n[3]*n[3]);if(u<0)return!1;const l=Math.sqrt(u);let m=(-a-l)/(2*i);const h=(-a+l)/(2*i);return(m<0||h<m&&h>0)&&(m=h),!(m<0)&&(s&&g(s,e.origin,c(v.get(),e.direction,m)),!0)}function F(t,n){return D(t,n,null)}function G(t,n,r){const s=v.get(),o=S.get();i(s,n.origin,n.direction);const a=I(t);i(r,s,n.origin),c(r,r,1/e(r)*a);const u=K(t,n.origin),f=P(n.origin,r);return j(o),y(o,o,f+u,s),m(r,r,o),r}function H(t,n,r){const s=f(v.get(),n,U(t)),o=c(v.get(),s,t[3]/e(s));return g(r,o,U(t))}function J(t,n){const r=f(v.get(),n,U(t)),e=h(r),s=t[3]*t[3];return Math.sqrt(Math.abs(e-s))}function K(t,n){const r=f(v.get(),n,U(t)),o=e(r),i=I(t),a=i+Math.abs(i-o);return s(i/a)}const N=a();function Q(t,n,r,e){const s=f(N,n,U(t));switch(r){case 0:{const t=p(s,N)[2];return d(e,-Math.sin(t),Math.cos(t),0)}case 1:{const t=p(s,N),n=t[1],r=t[2],o=Math.sin(n);return d(e,-o*Math.cos(r),-o*Math.sin(r),Math.cos(n))}case 2:return o(e,s);default:return}}function W(t,n){const r=f(Y,n,U(t));return e(r)-t[3]}const X=a(),Y=a();var Z=Object.freeze({__proto__:null,create:q,copy:E,fromCenterAndRadius:O,wrap:T,clear:z,fromRadius:B,getRadius:I,getCenter:U,fromValues:V,elevate:function(t,n,r){return t!==r&&u(r,t),r[3]=t[3]+n,r},setExtent:function(t,n,r){return k.error("sphere.setExtent is not yet supported"),t===r?r:E(t,r)},intersectRay:D,intersectsRay:F,intersectRayClosestSilhouette:function(t,n,r){if(D(t,n,r))return r;const s=G(t,n,v.get());return g(r,n.origin,c(v.get(),n.direction,l(n.origin,s)/e(n.direction))),r},closestPointOnSilhouette:G,closestPoint:function(t,n,r){return D(t,n,r)?r:(R(n,U(t),r),H(t,r,r))},projectPoint:H,distanceToSilhouette:J,angleToSilhouette:K,axisAt:Q,altitudeAt:W,setAltitudeAt:function(t,n,r,e){const s=W(t,n),o=Q(t,n,2,Y),i=c(Y,o,r-s);return g(e,n,i)}});export{z as a,G as b,q as c,B as d,P as e,O as f,U as g,V as h,D as i,J as j,_ as k,E as l,F as m,w as n,x as p,Z as s,T as w};
