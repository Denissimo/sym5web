/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import e from"../Color.js";import{L as t}from"./Logger.js";import{a as o}from"./screenUtils.js";import{n as i}from"./string.js";import{a as r,A as n}from"./arcadeOnDemand.js";import{R as a,p as l,C as s,O as f}from"./CIMSymbolHelper.js";import{isExtent as c}from"../geometry/support/jsonUtils.js";import{f as m,_ as u}from"./utils3.js";import{c as y}from"./callExpressionWithFeature.js";function p(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?p(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const o=t[0];if(!o)return null;const i=o.geometry;if(!i)return null;const r=o.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type?null:{geom:i,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function h(e){let t=1/0,o=-1/0,i=1/0,r=-1/0;for(const n of e)for(const e of n)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<i&&(i=e[1]),e[1]>r&&(r=e[1]);return[t,i,o,r]}function g(e,t,o,i,r){const[n,a,l,s]=e;if(l<n||s<a)return[0,0,0];const f=l-n,c=s-a,m=Math.floor(31.5),u=(128-2*(m+1))/Math.max(f,c),y=Math.round(f*u)+2*m,p=Math.round(c*u)+2*m;let h=1;if(t){h=p/u/(t.ymax-t.ymin)}let g=0,d=0;if(i)if(r){if(t&&o&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);g=i.x/(o*e),d=i.y/o}}else g=i.x,d=i.y;g=.5*(t.xmax+t.xmin)+g*(t.xmax-t.xmin),d=.5*(t.ymax+t.ymin)+d*(t.ymax-t.ymin),g-=n,d-=a,g*=u,d*=u,g+=m,d+=m;return[h,g/y-.5,-(d/p-.5)]}function d(e){const t=(o=e.geom)?o.rings?o.rings:o.paths?o.paths:void 0!==o.xmin&&void 0!==o.ymin&&void 0!==o.xmax&&void 0!==o.ymax?[[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]]]:null:null;var o;const i=function(e){let t=1/0,o=-1/0,i=1/0,r=-1/0;for(const n of e)for(const e of n)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<i&&(i=e[1]),e[1]>r&&(r=e[1]);return new a(t,i,o-t,r-i)}(t),r=Math.floor(31.5),n=(128-2*(r+1))/Math.max(i.width,i.height),l=Math.round(i.width*n)+2*r,s=Math.round(i.height*n)+2*r,f=[];for(const o of t)if(o&&o.length>1){const t=[];for(const e of o){let[o,a]=e;o-=i.x,a-=i.y,o*=n,a*=n,o+=r-.5,a+=r-.5,t.push([o,a])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}f.push(t)}const c=function(e,t,o,i){const r=t*o,n=new Array(r),a=i*i+1;for(let e=0;e<r;++e)n[e]=a;for(const r of e){const e=r.length;for(let a=1;a<e;++a){const e=r[a-1],l=r[a];let s,f,c,m;e[0]<l[0]?(s=e[0],f=l[0]):(s=l[0],f=e[0]),e[1]<l[1]?(c=e[1],m=l[1]):(c=l[1],m=e[1]);let u=Math.floor(s)-i,y=Math.floor(f)+i,p=Math.floor(c)-i,h=Math.floor(m)+i;u<0&&(u=0),y>t&&(y=t),p<0&&(p=0),h>o&&(h=o);const g=l[0]-e[0],d=l[1]-e[1],S=g*g+d*d;for(let i=u;i<y;i++)for(let r=p;r<h;r++){let a,s,f=(i-e[0])*g+(r-e[1])*d;f<0?(a=e[0],s=e[1]):f>S?(a=l[0],s=l[1]):(f/=S,a=e[0]+f*g,s=e[1]+f*d);const c=(i-a)*(i-a)+(r-s)*(r-s),m=(o-r-1)*t+i;c<n[m]&&(n[m]=c)}}}for(let e=0;e<r;++e)n[e]=Math.sqrt(n[e]);return n}(f,l,s,r);return e.asFill&&function(e,t,o,i,r){for(const n of e){const e=n.length;for(let a=1;a<e;++a){const e=n[a-1],l=n[a];let s,f,c,m;e[0]<l[0]?(s=e[0],f=l[0]):(s=l[0],f=e[0]),e[1]<l[1]?(c=e[1],m=l[1]):(c=l[1],m=e[1]);let u=Math.floor(s),y=Math.floor(f)+1,p=Math.floor(c),h=Math.floor(m)+1;u<i&&(u=i),y>t-i&&(y=t-i),p<i&&(p=i),h>o-i&&(h=o-i);for(let n=p;n<h;++n){if(e[1]>n==l[1]>n)continue;const a=(o-n-1)*t;for(let t=u;t<y;++t)t<(l[0]-e[0])*(n-e[1])/(l[1]-e[1])+e[0]&&(r[a+t]=-r[a+t]);for(let e=i;e<u;++e)r[a+e]=-r[a+e]}}}}(f,l,s,r,c),[S(c,r),l,s]}function S(e,t){const o=2*t,i=e.length,r=new Uint8Array(4*i);for(let t=0;t<i;++t){const i=.5-e[t]/o;l(i,r,4*t)}return r}const v=t.getLogger("esri.symbols.cim.cimAnalyzer");function b(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function N(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function k(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function O(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function C(e,t,o,i){let r;e[t]?r=e[t]:(r={},e[t]=r),r[o]=i}function x(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function M(e,t,o,i){const n=null!=o?o:[];if(!e)return n;let a,l;const c={};if("CIMSymbolReference"!==e.type)return v.error("Expect cim type to be 'CIMSymbolReference'"),n;if(a=e.symbol,l=e.primitiveOverrides,l){const e=[];for(const o of l){const i=o.valueExpressionInfo;if(i&&t){const n=i.expression,a=r(n,t.spatialReference,t.fields).then((e=>{e&&C(c,o.primitiveName,o.propertyName,e)}));e.push(a)}else null!=o.value&&C(c,o.primitiveName,o.propertyName,o.value)}await Promise.all(e)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,o,i,r,n){if(!e)return;const a=e.symbolLayers;if(!a)return;let l;const c=s.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(l=1);let m=a.length;for(;m--;){const s=a[m];if(!s||!1===s.enable)continue;const u=[];switch(f.findApplicableOverrides(s,t,u),s.type){case"CIMSolidFill":P(s,o,u,i,r);break;case"CIMPictureFill":L(s,o,u,i,r);break;case"CIMHatchFill":I(s,o,u,i,r);break;case"CIMGradientFill":X(s,o,u,i,r);break;case"CIMSolidStroke":w(s,o,u,i,r,"CIMPolygonSymbol"===e.type,c);break;case"CIMPictureStroke":z(s,o,u,i,r,"CIMPolygonSymbol"===e.type,c);break;case"CIMGradientStroke":J(s,o,u,i,r,"CIMPolygonSymbol"===e.type,c);break;case"CIMCharacterMarker":if(H(s,o,u,i,r))break;break;case"CIMPictureMarker":if(H(s,o,u,i,r))break;"CIMLineSymbol"===e.type&&(l=x(s)),Y(s,o,u,i,r,l,c);break;case"CIMVectorMarker":if(H(s,o,u,i,r))break;"CIMLineSymbol"===e.type&&(l=x(s)),R(s,o,u,i,r,l,c,n);break;default:v.error("Cannot analyze CIM layer",s.type)}}}(a,l,c,t,n,i)}return n}function P(e,t,o,r,n){const a=e.primitiveName,l=m(e.color),[s,f]=G(o,a),c=i(JSON.stringify(e)+f).toString();n.push({type:"fill",templateHash:c,materialHash:s?()=>c:c,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:T(a,t,"Color",r,l,W),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function L(e,t,o,r,n){const a=e.primitiveName,l=e.tintColor?m(e.tintColor):{r:255,g:255,b:255,a:1},[s,f]=G(o,a),c=i(JSON.stringify(e)+f).toString(),u=i(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();n.push({type:"fill",templateHash:c,materialHash:s?()=>u:u,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:T(a,t,"TintColor",r,l,W),height:T(a,t,"Height",r,e.height),scaleX:T(a,t,"ScaleX",r,e.scaleX),angle:T(a,t,"Rotation",r,e.rotation),offsetX:T(a,t,"OffsetX",r,e.offsetX),offsetY:T(a,t,"OffsetY",r,e.offsetY)})}function I(e,t,o,r,n){const a=["Rotation","OffsetX","OffsetY"],l=o.filter((t=>t.primitiveName!==e.primitiveName&&-1===a.indexOf(t.propertyName))),s=e.primitiveName,[f,c]=G(o,s),m=i(JSON.stringify(e)+c).toString(),u=i(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();n.push({type:"fill",templateHash:m,materialHash:f?U(u,t,l,r):u,cim:e,materialOverrides:l,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:T(s,t,"Separation",r,e.separation),scaleX:1,angle:T(s,t,"Rotation",r,e.rotation),offsetX:T(s,t,"OffsetX",r,e.offsetX),offsetY:T(s,t,"OffsetY",r,e.offsetY)})}function X(e,t,o,r,n){const a=e.primitiveName,[l,s]=G(o,a),f=i(JSON.stringify(e)+s).toString();n.push({type:"fill",templateHash:f,materialHash:l?U(f,t,o,r):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function w(e,t,o,r,n,a,l){const s=e.primitiveName,f=m(e.color),c=void 0!==e.width?e.width:4,u=b(e.capStyle),y=N(e.joinStyle),p=e.miterLimit,[h,g]=G(o,s),d=i(JSON.stringify(e)+g).toString();n.push({type:"line",templateHash:d,materialHash:h?()=>d:d,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:T(s,t,"Color",r,f,W),width:T(s,t,"Width",r,c),cap:T(s,t,"CapStyle",r,u),join:T(s,t,"JoinStyle",r,y),miterLimit:T(s,t,"MiterLimit",r,p),referenceWidth:l,zOrder:j(e.name),isDashed:!1})}function z(e,t,o,r,n,a,l){const s=i(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,c=m(e.tintColor),u=void 0!==e.width?e.width:4,y=b(e.capStyle),p=N(e.joinStyle),h=e.miterLimit,[g,d]=G(o,f),S=i(JSON.stringify(e)+d).toString();n.push({type:"line",templateHash:S,materialHash:g?()=>s:s,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:T(f,t,"TintColor",r,c,W),width:T(f,t,"Width",r,u),cap:T(f,t,"CapStyle",r,y),join:T(f,t,"JoinStyle",r,p),miterLimit:T(f,t,"MiterLimit",r,h),referenceWidth:l,zOrder:j(e.name),isDashed:!1})}function J(e,t,o,r,n,a,l){const s=e.primitiveName,f=void 0!==e.width?e.width:4,c=b(e.capStyle),m=N(e.joinStyle),u=e.miterLimit,[y,p]=G(o,s),h=i(JSON.stringify(e)+p).toString();n.push({type:"line",templateHash:h,materialHash:y?U(h,t,o,r):h,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:T(s,t,"Width",r,f),cap:T(s,t,"CapStyle",r,c),join:T(s,t,"JoinStyle",r,m),miterLimit:T(s,t,"MiterLimit",r,u),referenceWidth:l,zOrder:j(e.name),isDashed:!1})}function H(e,t,o,r,n){const a=e.markerPlacement;if(!a||"CIMMarkerPlacementInsidePolygon"!==a.type)return!1;const l=a,s=["Rotation","OffsetX","OffsetY"],f=o.filter((t=>t.primitiveName!==e.primitiveName&&-1===s.indexOf(t.propertyName))),[c,m]=G(o,l.primitiveName),u=i(JSON.stringify(e)+m).toString();return n.push({type:"fill",templateHash:u,materialHash:c?U(u,t,f,r):u,cim:e,materialOverrides:f,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:T(l.primitiveName,t,"StepY",r,l.stepY),scaleX:1,angle:T(l.primitiveName,t,"GridAngle",r,l.gridAngle),offsetX:T(l.primitiveName,t,"OffsetX",r,l.offsetX),offsetY:T(l.primitiveName,t,"OffsetY",r,l.offsetY)}),!0}function Y(e,t,o,r,n,a,l){const s=e.primitiveName,f=e.size,c=e.scaleX,u=e.rotation,y=e.offsetX,p=e.offsetY,h=m(e.tintColor),g=i(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[d,S]=G(o,s),v=i(JSON.stringify(e)+S).toString();n.push({type:"marker",templateHash:v,materialHash:d?()=>g:g,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:a,size:T(s,t,"Size",r,f),scaleX:T(s,t,"ScaleX",r,c),rotation:T(s,t,"Rotation",r,u),offsetX:T(s,t,"OffsetX",r,y),offsetY:T(s,t,"OffsetY",r,p),color:T(s,t,"TintColor",r,h,W),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:l,sizeRatio:1,markerPlacement:e.markerPlacement})}function R(e,t,o,i,r,n,a,l){const s=e.markerGraphics;if(!s)return;let f=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(f=t.ymax-t.ymin)}for(const c of s)if(c){const s=c.symbol;if(!s)continue;switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":$(e,c,o,t,i,r,n,a,f,l);break;case"CIMTextSymbol":A(e,c,t,o,i,r,n,a,f)}}}function A(e,t,o,r,n,a,l,c,y){f.findApplicableOverrides(t,r,[]);const p=t.geometry;if(!("x"in p)||!("y"in p))return;const h=t.symbol,g=(d=h).underline?"underline":d.strikethrough?"line-through":"none";var d;const S=function(e){let t="normal",o="normal";if(e){const i=e.toLowerCase();-1!==i.indexOf("italic")?t="italic":-1!==i.indexOf("oblique")&&(t="oblique"),-1!==i.indexOf("bold")?o="bold":-1!==i.indexOf("light")&&(o="lighter")}return{style:t,weight:o}}(h.fontStyleName);h.font={family:h.fontFamilyName,decoration:g,...S};const v=e.frame,b=p.x-.5*(v.xmin+v.xmax),N=p.y-.5*(v.ymin+v.ymax),C=e.size/y,x=e.primitiveName,M=(h.height||0)*C,P=h.angle||0,L=((h.offsetX||0)+b)*C,I=((h.offsetY||0)+N)*C,X=m(s.getFillColor(h));let w=m(s.getStrokeColor(h)),z=s.getStrokeWidth(h);z||(w=m(s.getFillColor(h.haloSymbol)),z=h.haloSize*C);let J="";for(const e of r)e.primitiveName===x&&void 0!==e.value&&(J+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const H=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),Y=i(JSON.stringify(t)+H+J).toString();a.push({type:"text",templateHash:Y,materialHash:()=>i(JSON.stringify(h.font)).toString(),cim:h,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:l,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:h.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:T(x,o,"Size",n,M),angle:T(x,o,"Rotation",n,P),offsetX:T(x,o,"OffsetX",n,L),offsetY:T(x,o,"OffsetY",n,I),horizontalAlignment:k(h.horizontalAlignment),verticalAlignment:O(h.verticalAlignment),text:T(t.primitiveName,o,"TextString",n,t.textString,u,h.textCase),color:X,outlineColor:w,outlineSize:z,referenceSize:c,sizeRatio:1,markerPlacement:e.markerPlacement})}function $(e,t,o,r,n,a,l,f,u,y){const p=t.symbol,d=t.geometry;if(!d)return;const S=p.symbolLayers;if(!S)return;if(y)return void F(e,t,r,o,n,a,l,f,u);let v=S.length;for(;v--;){const y=S[v];if(y&&!1!==y.enable)switch(y.type){case"CIMSolidFill":case"CIMSolidStroke":{const p=(b=d)?b.rings?h(b.rings):b.paths?h(b.paths):c(b)?[b.xmin,b.ymin,b.xmax,b.ymax]:null:null;if(!p)continue;const[S,v,N]=g(p,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),k="CIMSolidFill"===y.type,O={type:"sdf",geom:d,asFill:k},C=e.primitiveName,x=e.size,M=e.rotation||0,P=e.offsetX,L=e.offsetY,I=y.primitiveName,X=m(k?s.getFillColor(y):s.getStrokeColor(y)),w=k?{r:0,g:0,b:0,a:0}:m(s.getStrokeColor(y)),z=s.getStrokeWidth(y);if(!k&&!z)break;let J=!1,H="";for(const e of o)e.primitiveName!==I&&e.primitiveName!==C||(void 0!==e.value?H+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(J=!0));const Y=JSON.stringify({...e,markerGraphics:null}),R=i(JSON.stringify(O)).toString(),A={type:"marker",templateHash:i(JSON.stringify(t)+JSON.stringify(y)+Y+H).toString(),materialHash:J?()=>R:R,cim:O,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:v,y:N},isAbsoluteAnchorPoint:!1,size:T(e.primitiveName,r,"Size",n,x),rotation:T(e.primitiveName,r,"Rotation",n,M),offsetX:T(e.primitiveName,r,"OffsetX",n,P),offsetY:T(e.primitiveName,r,"OffsetY",n,L),scaleX:1,frameHeight:u,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:S,color:T(I,r,"Color",n,X,W),outlineColor:T(I,r,"Color",n,w,W),outlineWidth:T(I,r,"Width",n,z),markerPlacement:e.markerPlacement};a.push(A);break}default:F(e,t,r,o,n,a,l,f,u)}}var b}function F(e,t,r,n,a,l,f,c,m){const u=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t);let y=[];const p=["Rotation","OffsetX","OffsetY"];y=n.filter((t=>t.primitiveName!==e.primitiveName||-1===p.indexOf(t.propertyName)));let h="";for(const e of n)void 0!==e.value&&(h+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[g,d,S]=s.getTextureAnchor(u),v=e.primitiveName,b=e.rotation||0,N=e.offsetX||0,k=e.offsetY||0,O=i(JSON.stringify(u)+h).toString(),C={type:"marker",templateHash:O,materialHash:0===y.length?O:U(O,r,y,a),cim:u,materialOverrides:y,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:g,y:d},isAbsoluteAnchorPoint:!1,size:e.size,rotation:T(v,r,"Rotation",a,b),offsetX:T(v,r,"OffsetX",a,N),offsetY:T(v,r,"OffsetY",a,k),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:S/o(e.size),markerPlacement:e.markerPlacement};l.push(C)}function j(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function W(t){if(!t||0===t.length)return null;const o=new e(t).toRgba();return{r:o[0],g:o[1],b:o[2],a:o[3]}}function T(e,t,o,i,r,a,l){const s=t[e];if(s){const e=s[o];if("string"==typeof e||"number"==typeof e||e instanceof Array)return a?a.call(null,e,l):e;if(null!=e&&e instanceof n)return(t,o,n)=>{let s=y(e,t,{$view:n},i.geometryType,o);return null!==s&&a&&(s=a.call(null,s,l)),null!==s?s:r}}return r}function U(e,t,o,r){for(const e of o){if(e.valueExpressionInfo){const o=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];o instanceof n&&(e.fn=(e,t,i)=>y(o,e,{$view:i},r.geometryType,t))}}return(t,r,n)=>{for(const e of o)e.fn&&(e.value=e.fn(t,r,n));return i(e+f.buildOverrideKey(o)).toString()}}function D(e,t){if(!t||0===t.length)return e;const o=JSON.parse(JSON.stringify(e));return f.applyOverrides(o,t),o}function G(e,t){let o=!1,i="";for(const r of e)r.primitiveName===t&&(void 0!==r.value?i+=`-${r.primitiveName}-${r.propertyName}-${JSON.stringify(r.value)}`:r.valueExpressionInfo&&(o=!0));return[o,i]}export{M as a,D as b,d as c,p as g};
