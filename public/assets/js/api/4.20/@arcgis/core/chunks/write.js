/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{v as r,e}from"../core/accessorSupport/decorators/property.js";import{g as t,e as o}from"./metadata.js";import{o as n,b as i,c as s}from"../core/accessorSupport/decorators/subclass.js";import{e as a}from"./arrayUtils.js";import u from"../core/Error.js";import{L as f}from"./Logger.js";import{n as c,i as l}from"../core/Accessor.js";function d(r,t,o){if(!r||!r.read||!1===r.read.enabled||!r.read.source)return!1;const n=r.read.source;if("string"==typeof n){if(n===t)return!0;if(n.indexOf(".")>-1&&0===n.indexOf(t)&&e(n,o))return!0}else for(const r of n){if(r===t)return!0;if(r.indexOf(".")>-1&&0===r.indexOf(t)&&e(r,o))return!0}return!1}function g(r,e,t,o,i){let s=n(e[t],i);(function(r){return r&&(!r.read||!1!==r.read.enabled&&!r.read.source)})(s)&&(r[t]=!0);for(const a of Object.getOwnPropertyNames(e))s=n(e[a],i),d(s,t,o)&&(r[a]=!0)}function p(r,e,t,o){const n=t.metadatas,s=i(n[e],"any",o),a=s&&s.default;if(void 0===a)return;const u="function"==typeof a?a.call(r,e,o):a;void 0!==u&&t.set(e,u)}const m={origin:"service"};function O(e,o,i=m){if(!o||"object"!=typeof o)return;const s=t(e),a=s.metadatas,u={};for(const r of Object.getOwnPropertyNames(o))g(u,a,r,o,i);s.setDefaultOrigin(i.origin);for(const t of Object.getOwnPropertyNames(u)){const u=n(a[t],i).read,f=u&&u.source;let c;c=f&&"string"==typeof f?r(o,f):o[t],u&&u.reader&&(c=u.reader.call(e,c,o,i)),void 0!==c&&s.set(t,c)}if(!i||!i.ignoreDefaults)for(const r of Object.getOwnPropertyNames(a))u[r]||p(e,r,s,i);s.setDefaultOrigin("user")}function w(r,e,t,o=m){var n;const i={...o,messages:[]};t(i),null==(n=i.messages)||n.forEach((e=>{"warning"!==e.type||r.loaded?o&&o.messages&&o.messages.push(e):r.loadWarnings.push(e)}))}const y=f.getLogger("esri.core.accessorSupport.write");function v(r,e,t,o,n){var i,s;const a={};return null==(i=e.write)||null==(s=i.writer)||s.call(r,o,a,t,n),a}function b(r,e,t,o,n,i){if(!o||!o.write)return!1;const s=r.get(t);if(!n&&o.write.overridePolicy){const e=o.write.overridePolicy.call(r,s,t,i);void 0!==e&&(n=e)}if(n||(n=o.write),!n||!1===n.enabled)return!1;if((null===s&&!n.allowNull||void 0===s)&&n.isRequired){const e=new u("web-document-write:property-required",`Missing value for required property '${t}' on '${r.declaredClass}'`,{propertyName:t,target:r});return e&&i&&i.messages?i.messages.push(e):e&&!i&&y.error(e.name,e.message),!1}if(void 0===s)return!1;if(null===s&&!n.allowNull)return!1;if(function(r,e,t,o,n){const i=o.default;if(void 0===i)return!1;if(null!=o.defaultEquals)return o.defaultEquals(n);if("function"==typeof i){if(Array.isArray(n)){const o=i.call(r,e,t);return a(o,n)}return!1}return i===n}(r,t,i,o,s))return!1;if(void 0!==o.default)return!0;if(!n.ignoreOrigin&&i&&i.origin){if(e.store.originOf(t)<c(i.origin))return!1}return!0}function j(r,e,o,n){const i=t(r),a=i.metadatas,u=s(a[e],n);return!!u&&b(r,i,e,u,o,n)}function N(r,e,n){if(r&&"function"==typeof r.toJSON&&(!r.toJSON.isDefaultToJSON||!r.write))return o(e,r.toJSON());const i=t(r),a=i.metadatas;for(const t in a){const c=s(a[t],n);if(!b(r,i,t,c,void 0,n))continue;const d=r.get(t),g=v(r,c,c.write&&"string"==typeof c.write.target?c.write.target:t,d,n);var u,f;if(Object.keys(g).length>0)e=o(e,g),null!=n&&null!=(u=n.resources)&&null!=(f=u.pendingOperations)&&f.length&&Promise.all(n.resources.pendingOperations).then((()=>o(e,g))),n&&n.writtenProperties&&n.writtenProperties.push({target:r,propName:t,oldOrigin:l(i.store.originOf(t)),newOrigin:n.origin})}return e}export{w as a,j as b,O as r,N as w};
