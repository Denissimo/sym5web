/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as o}from"./tslib.es6.js";import t from"../core/Collection.js";import{HandleOwnerMixin as e}from"../core/HandleOwner.js";import{i as r,b as s}from"../core/lang.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import"./ensureType.js";import"./Logger.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{a as c}from"../core/Accessor.js";let l=class extends(e(t)){constructor(o){super(o),this.getCollections=null}initialize(){this.handles.add(c((()=>this.refresh())))}destroy(){this.getCollections=null}refresh(){const o=r(this.getCollections)?this.getCollections():null;if(s(o))return void this.removeAll();let t=0;for(const e of o)r(e)&&(t=this._processCollection(t,e));this.splice(t,this.length)}_createNewInstance(o){return new t(o)}_processCollection(o,t){if(!t)return o;const e=this.itemFilterFunction?this.itemFilterFunction:o=>!!o;for(const r of t)if(r){if(e(r)){const t=this.indexOf(r,o);t>=0?t!==o&&this.reorder(r,o):this.add(r,o),++o}if(this.getChildrenFunction){const t=this.getChildrenFunction(r);if(Array.isArray(t))for(const e of t)o=this._processCollection(o,e);else o=this._processCollection(o,t)}}return o}};o([i()],l.prototype,"getCollections",void 0),o([i()],l.prototype,"getChildrenFunction",void 0),o([i()],l.prototype,"itemFilterFunction",void 0),l=o([n("esri.core.CollectionFlattener")],l);var p=l;export{p as C};
