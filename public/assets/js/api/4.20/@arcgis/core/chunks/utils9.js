/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{u as e}from"./arrayUtils.js";import{L as n}from"./Logger.js";import{c as t,a as l}from"./number.js";import{f as i,r as a}from"./numberUtils.js";import o from"../renderers/visualVariables/support/ColorStop.js";const r=n.getLogger("esri.renderers.support.utils"),s="<",u=">",d="%",f="â€“",m={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},p={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"},c=t("short-date");function y(e){const{values:n,colors:t,labelIndexes:a,isDate:r,dateFormatOptions:d}=e;return n.map(((e,f)=>{let m=null;if(!a||a.indexOf(f)>-1){let t;t=r?l(e,d):i(e),t&&(m=function(e,n,t){let l="";return 0===n?l=s+" ":n===t&&(l=u+" "),l+e}(t,f,n.length-1))}return new o({value:e,color:t[f],label:m})}))}function h(e){let n=e.minValue,t=e.maxValue;const l=e.isFirstBreak?"":u+" ",a="percent-of-total"===e.normalizationType?d:"";return n=null==n?"":i(n),t=null==t?"":i(t),l+n+a+" "+f+" "+t+a}function g(e){const n=e.classBreakInfos,t=e.normalizationType;let l=[];if(n&&n.length)if("standard-deviation"!==e.classificationMethod)if(e.round){l.push(n[0].minValue);for(const e of n)l.push(e.maxValue);l=a(l),n.forEach(((e,n)=>{e.label=h({minValue:0===n?l[0]:l[n],maxValue:l[n+1],isFirstBreak:0===n,normalizationType:t})}))}else n.forEach(((e,n)=>{e.label=h({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===n,normalizationType:t})}));else r.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")}function b(e){const n=e.map((e=>new Date(e))),t=n.length;let l=1/0,i=null;for(let e=0;e<t-1;e++){const a=n[e];let o=1/0,r=null;for(let l=e+1;l<t;l++){const e=n[l],t=(a.getFullYear()!==e.getFullYear()?"year":a.getMonth()!==e.getMonth()&&"month")||a.getDate()!==e.getDate()&&"day"||a.getHours()!==e.getHours()&&"hour"||a.getMinutes()!==e.getMinutes()&&"minute"||a.getSeconds()!==e.getSeconds()&&"second"||"millisecond",i=m[t];i<o&&(o=i,r=t)}o<l&&(l=o,i=r)}return i}function x(e){const{value:n,domain:a,fieldInfo:o,dateFormatInterval:r}=e;let s=String(n);const u=a&&"codedValues"in a&&a.codedValues?a.getName(n):null;return u?s=u:"number"==typeof n&&(s=o&&"date"===o.type?l(n,r&&t(p[r])):i(n)),s}function F(e,n){return"normalizationField"in e&&e.normalizationField?(t=e.field,l=e.normalizationField,{type:"normalized-field",field:t,normalizationField:l}):"field"in e&&e.field?v(e.field):"valueExpression"in e&&e.valueExpression?(i=e.valueExpression,a=e.valueExpressionTitle,{type:"expression",expression:i,title:a,returnType:n}):null;var t,l,i,a}function v(e){return{type:"field",field:e}}function z(n,t){const l=[];if("class-breaks"===n.type||"heatmap"===n.type)l.push(F(n,"number"));else if("unique-value"===n.type){const e=n.authoringInfo;if(e&&"relationship"===e.type){if(e.field1&&e.field2){const n=e.field1.field,t=e.field2.field,i=e.field1.normalizationField,a=e.field2.normalizationField;l.push(F({field:n,normalizationField:i})),l.push(F({field:t,normalizationField:a}))}}else{const e=n.uniqueValueInfos[0];let t=null;if(e&&e.value){const e=typeof n.uniqueValueInfos[0].value;"string"!==e&&"number"!==e||(t=e)}l.push(F(n,t)),[n.field2,n.field3].forEach((e=>e&&l.push(v(e))))}}else"dot-density"===n.type&&n.attributes.forEach((e=>l.push(F(e,"number"))));const i=t?t(n):"visualVariables"in n?n.visualVariables:null;return i&&i.forEach((e=>l.push(F(e,"number")))),e(l.filter(Boolean),((e,n)=>"field"===e.type&&"field"===n.type?e.field===n.field:"normalized-field"===e.type&&"normalized-field"===n.type?e.field===n.field&&e.normalizationField===n.normalizationField:"expression"===e.type&&"expression"===n.type&&e.expression===n.expression))}export{x as a,b,y as c,z as g,g as s,c as t};
