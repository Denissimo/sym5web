/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import r from"../request.js";import{L as t}from"../chunks/Loadable.js";import{L as s}from"../chunks/Logger.js";import{i as o}from"../core/lang.js";import{M as i}from"../chunks/MultiOriginJSONSupport.js";import{isAbortError as n}from"../core/promiseUtils.js";import{urlToObject as a}from"../core/urlUtils.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import u from"../geometry/Extent.js";import c from"../geometry/SpatialReference.js";import{p as d}from"../chunks/arcgisLayerUrl.js";import"../config.js";import"../chunks/object.js";import"../kernel.js";import"../core/Error.js";import"../chunks/Message.js";import"../chunks/string.js";import"../chunks/Promise.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/ArrayPool.js";import"../chunks/arrayUtils.js";import"../core/scheduling.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/write.js";import"../geometry/Geometry.js";import"../chunks/JSONSupport.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/persistableUrlUtils.js";const m=s.getLogger("esri.networks.Network");let y=class extends(i(t)){constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null}initialize(){this.when().catch((e=>{var r,t;n(e)||m.error("#load()",`Failed to load layer (title: '${null!=(r=this.title)?r:"no title"}', id: '${null!=(t=this.id)?t:"no id"}')`,{error:e})}))}get datasetName(){var e;return null==(e=this.dataElement)?void 0:e.name}get owner(){var e;return null==(e=this.dataElement)?void 0:e.userIdentity}get schemaGeneration(){var e;return null==(e=this.dataElement)?void 0:e.schemaGeneration}get parsedUrl(){const e=this.layerUrl;return e?a(e):null}get featureServiceUrl(){const e=this.parsedUrl&&d(this.parsedUrl.path);return o(e)?e.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const e=this.parsedUrl&&d(this.parsedUrl.path);return o(e)?e.sublayer:null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const r=this.dataElement.domainNetworks;for(const t of r){for(const r of t.edgeSources?t.edgeSources:[])if(r.sourceId===e)return r.layerId;for(const r of t.junctionSources?t.junctionSources:[])if(r.sourceId===e)return r.layerId}return null}return null}async _fetchLayerMetaData(e,t){const s=await r(e,{responseType:"json",query:{f:"json"},...t});this.read(s.data,{origin:"service"})}async _fetchDataElement(e,t,s){if(this.dataElement)return;const o=await r(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...s}).then((e=>{var r;return null==(r=e.data.layerDataElements)?void 0:r[0]}));o&&this.read(o,{origin:"service"})}};e([l({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],y.prototype,"id",void 0),e([l({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],y.prototype,"title",void 0),e([l({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],y.prototype,"layerUrl",void 0),e([l({type:Object,json:{origins:{service:{read:!0}},read:!1}})],y.prototype,"dataElement",void 0),e([l({type:u,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],y.prototype,"fullExtent",void 0),e([l({type:c,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],y.prototype,"spatialReference",void 0),e([l({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],y.prototype,"type",void 0),e([l({readOnly:!0})],y.prototype,"datasetName",null),e([l({readOnly:!0})],y.prototype,"owner",null),e([l({readOnly:!0})],y.prototype,"schemaGeneration",null),e([l({readOnly:!0})],y.prototype,"parsedUrl",null),e([l({readOnly:!0})],y.prototype,"featureServiceUrl",null),e([l({readOnly:!0})],y.prototype,"networkServiceUrl",null),e([l({readOnly:!0})],y.prototype,"layerId",null),y=e([p("esri.networks.Network")],y);var h=y;export default h;
