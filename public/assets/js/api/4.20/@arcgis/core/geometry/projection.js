/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import n from"../core/Error.js";import{j as t,g as r,s as e,n as s,l as o,c as u,k as l,r as i,b as a,m as c}from"../chunks/mathUtils.js";import{b as f}from"../core/lang.js";import{throwIfAborted as p}from"../core/promiseUtils.js";import{a as h}from"../chunks/unitUtils.js";import{i as m,t as d,s as j}from"../chunks/mat4.js";import M from"./Extent.js";import R from"./Multipoint.js";import{l as k,p as g,i as w}from"../chunks/pe.js";import y from"./Point.js";import E from"./Polygon.js";import x from"./Polyline.js";import{S as P,W as S,a as T,b as I}from"../chunks/projectionEllipsoid.js";import{s as b}from"../chunks/aaBoundingRect.js";import{e as C,a as F,m as U}from"../chunks/Ellipsoid.js";import{e as q}from"../chunks/geodesicConstants.js";import z from"./support/GeographicTransformation.js";import{e as A,j as G,a as v,i as W,f as Z,h as _}from"./SpatialReference.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/Message.js";import"../chunks/jsonMap.js";import"../chunks/tslib.es6.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"./Geometry.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/ArrayPool.js";import"../chunks/arrayUtils.js";import"../core/scheduling.js";import"../chunks/write.js";import"../chunks/reader.js";import"../chunks/writer.js";import"./support/webMercatorUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/zmUtils.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/extentUtils.js";import"./support/GeographicTransformationStep.js";let B=null,L=null,N=null,J={};function K(){return!!B&&w()}function O(){return!0}function V(n){return f(N)&&(N=Promise.all([k(),import("../chunks/geometryEngineBase.js").then((function(n){return n.g})),import("../chunks/hydrated.js")])),N.then((([,t,{hydratedAdapter:r}])=>{p(n),L=r,B=t.default,B._enableProjection(g)}))}function X(n,t,r=null){return Array.isArray(n)?0===n.length?[]:D(L,n,n[0].spatialReference,t,r):D(L,[n],n.spatialReference,t,r)[0]}function D(n,t,r,e,s=null){if(f(r)||f(e))return t;if(nn(r,e,s))return t.map((n=>function(n,t,r){if(!n)return n;if("x"in n){const e=new y;return sn(n,t,e,r)?e:null}if("xmin"in n){const e=new M;return hn(n,t,e,r)?e:null}if("rings"in n){const e=new E;return fn(n,t,e,r)?e:null}if("paths"in n){const e=new x;return an(n,t,e,r)?e:null}if("points"in n){const e=new R;return un(n,t,e,r)?e:null}return null}(n,r,e)));if(f(s)){const n=z.cacheKey(r,e);void 0!==J[n]?s=J[n]:(s=H(r,e,null),f(s)&&(s=new z),J[n]=s)}if(f(B))throw new Y;return B._project(n,t,r,e,s)}function H(n,t,r=null){if(f(B))throw new Y;if(f(n)||f(t))return null;const e=B._getTransformation(L,n,t,r,null==r?void 0:r.spatialReference);return null!==e?z.fromGE(e):null}function Q(n,t,r=null){if(f(B))throw new Y;const e=B._getTransformationBySuitability(L,n,t,r,null==r?void 0:r.spatialReference);if(null!==e){const n=[];for(const t of e)n.push(z.fromGE(t));return n}return[]}class Y extends n{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function $(){B=null,L=null,N=null,J={}}function nn(n,t,r){return!r&&(!!A(n,t)||G(n)&&G(t)&&!!nt(n,t,ot))}async function tn(n,t,r,e){if(!K())if(Array.isArray(n)){for(const{source:t,dest:r,geographicTransformation:s}of n)if(!nn(t,r,s))return V(e)}else if(!nn(n,t,r))return V(e)}function rn(n,t){switch(nt(n,t,ot)){case Fn:return"copy3";case Ln:return"wgs84ToSphericalECEF";case Gn:return"wgs84ToWebMercator";case Dn:return"wgs84ToWGS84ECEF";case Un:return"webMercatorToWGS84";case qn:return"webMercatorToSphericalECEF";case zn:return"webMercatorToWGS84ECEF";case Hn:return"wgs84ECEFToWGS84";case Qn:return"wgs84ECEFToSphericalECEF";case Yn:return"wgs84ECEFToWebMercator";case On:return"sphericalECEFToWGS84";case Vn:return"sphericalECEFToWebMercator";case Kn:return"sphericalMarsPCPFToMars2000";case Jn:return"sphericalMoonPCPFToMoon2000";case Xn:return"sphericalECEFToWGS84ECEF";case Bn:return"mars2000ToSphericalPCPF";case _n:return"moon2000ToSphericalPCPF";default:return null}}function en(n,t,r=t.spatialReference,e=0){return!f(r)&&sn(n,n.spatialReference,t,r,e)}function sn(n,t,r,e,s=0){pt[0]=n.x,pt[1]=n.y;const o=n.z;return pt[2]=void 0!==o?o:s,!!wn(pt,t,0,pt,e,0,1)&&(r.x=pt[0],r.y=pt[1],r.spatialReference=e,void 0===o?(r.z=void 0,r.hasZ=!1):(r.z=pt[2],r.hasZ=!0),void 0===n.m?(r.m=void 0,r.hasM=!1):(r.m=n.m,r.hasM=!0),!0)}function on(n,t,r=t.spatialReference,e=0){return!f(r)&&un(n,n.spatialReference,t,r,e)}function un(n,t,r,e,s=0){const{points:o,hasZ:u,hasM:l}=n,i=[],a=o.length,c=[];for(const n of o)c.push(n[0],n[1],u?n[2]:s);if(!wn(c,t,0,c,e,0,a))return!1;for(let n=0;n<a;++n){const t=3*n,r=c[t],e=c[t+1];u&&l?i.push([r,e,c[t+2],o[n][3]]):u?i.push([r,e,c[t+2]]):l?i.push([r,e,o[n][2]]):i.push([r,e])}return r.points=i,r.spatialReference=e,r.hasZ=u,r.hasM=l,!0}function ln(n,t,r=t.spatialReference,e=0){return!f(r)&&an(n,n.spatialReference,t,r,e)}function an(n,t,r,e,s=0){const{paths:o,hasZ:u,hasM:l}=n,i=[];return!!En(o,u,l,t,i,e,s)&&(r.paths=i,r.spatialReference=e,r.hasZ=u,r.hasM=l,!0)}function cn(n,t,r=t.spatialReference,e=0){return!f(r)&&fn(n,n.spatialReference,t,r,e)}function fn(n,t,r,e,s=0){const{rings:o,hasZ:u,hasM:l}=n,i=[];return!!En(o,u,l,t,i,e,s)&&(r.rings=i,r.spatialReference=e,r.hasZ=u,r.hasM=l,!0)}function pn(n,t,r=t.spatialReference,e=0){return!f(r)&&hn(n,n.spatialReference,t,r,e)}function hn(n,t,r,e,s=0){const{xmin:o,ymin:u,xmax:l,ymax:i,hasZ:a,hasM:c}=n;if(!Mn(o,u,a?n.zmin:s,t,pt,e))return!1;r.xmin=pt[0],r.ymin=pt[1],a&&(r.zmin=pt[2]);return!!Mn(l,i,a?n.zmax:s,t,pt,e)&&(r.xmax=pt[0],r.ymax=pt[1],a&&(r.zmax=pt[2]),c&&(r.mmin=n.mmin,r.mmax=n.mmax),r.spatialReference=e,!0)}function mn(n,t,r){if(f(t)||f(r))return null;const e=new y({spatialReference:r});return wn(n,t,0,pt,r,0,1)?(e.x=pt[0],e.y=pt[1],e.z=pt[2],e):null}function dn(n,t,r){return wn(n,t,0,pt,r.spatialReference,0,1)?(r.x=pt[0],r.y=pt[1],r.z=pt[2],r):null}function jn(n,t,r,e=0){pt[0]=n.x,pt[1]=n.y;const s=n.z;return pt[2]=void 0!==s?s:e,wn(pt,n.spatialReference,0,t,r,0,1)}function Mn(n,t,r,e,s,o){return at[0]=n,at[1]=t,at[2]=r,wn(at,e,0,s,o,0,1)}function Rn(n,t,r,e){return!(f(t)||f(e)||n.length<2)&&(2===n.length&&(at[0]=n[0],at[1]=n[1],at[2]=0,n=at),wn(n,t,0,r,e,0,1))}function kn(n,t){pt[0]=n.x,pt[1]=n.y;const r=n.z;return pt[2]=void 0!==r?r:0,gn(pt,n.spatialReference,t)}function gn(n,t,r){return function(n,t,r){if(f(t))return!1;const e=Cn(t,et),s=$n[e][6];if(f(s))return!1;s(n,0,at,0),r!==at&&(r[0]=at[0],r[1]=at[1],r.length>2&&(r[2]=at[2]));return!0}(n,t,r)}function wn(n,t,r,e,s,o,u=1){const l=nt(t,s,ot);if(f(l))return!1;if(l===Fn){if(n===e&&r===o)return!0;const t=r+3*u;for(let s=r,u=o;s<t;s++,u++)e[u]=n[s];return!0}const i=r+3*u;for(let t=r,s=o;t<i;t+=3,s+=3)l(n,t,e,s);return!0}function yn(n,o,u,l,i){t(pt,n),r(ht,n,o),Rn(pt,u,pt,i),Rn(ht,u,ht,i),e(l,ht,pt),s(l,l)}function En(n,t,r,e,s,o,u=0){const l=new Array;for(const r of n)for(const n of r)l.push(n[0],n[1],t?n[2]:u);if(!wn(l,e,0,l,o,0,l.length/3))return!1;let i=0;s.length=0;for(const e of n){const n=new Array;for(const s of e)t&&r?n.push([l[i++],l[i++],l[i++],s[3]]):t?n.push([l[i++],l[i++],l[i++]]):r?(n.push([l[i++],l[i++],s[2]]),i++):(n.push([l[i++],l[i++]]),i++);s.push(n)}return!0}function xn(n,t,r,e){if(f(t)||f(e))return!1;const s=tt(t,e,ut);if(s.projector===Fn)return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],!0;if(f(s.projector))return!1;const{source:o,dest:u}=s;if(3===u.spatialReferenceId){const t=$n[o.spatialReferenceId][2];if(f(t))return!1;t(n,0,ct,0);const e=Math.abs(lt*ct[1])+Math.asin(n[3]/(C.radius+n[2]));if(Gn(ct,0,r,0),e>.9999*Math.PI)r[3]=Number.MAX_VALUE;else{const t=1/Math.cos(e);r[3]=t*n[3]}return!0}return s.projector(n,0,r,0),r[3]=n[3]*o.metersPerUnit/u.metersPerUnit,!0}function Pn(n,t,r,e){return null!=n&&(A(t,e)?(b(r,n),!0):(at[0]=n[0],at[1]=n[1],at[2]=0,!!wn(at,t,0,at,e,0,1)&&(r[0]=at[0],r[1]=at[1],at[0]=n[2],at[1]=n[3],at[2]=0,!!wn(at,t,0,at,e,0,1)&&(r[2]=at[0],r[3]=at[1],!0))))}function Sn(n,t,r,e){if(f(t)||f(e))return!1;const s=Cn(t,et),u=Cn(e,st);if(s===u&&0!==s||A(t,e))return r[0]=1,r[1]=1,r[2]=1,!0;if(1===s){const t=o(n),e=t/Math.sqrt(n[0]*n[0]+n[1]*n[1]),s=t/C.radius;if(3===u)return r[0]=e*s,r[1]=e*s,r[2]=1,!0;if(2===u||5===u){const n=180/(C.radius*Math.PI);return r[0]=n*e*s,r[1]=n*s,r[2]=1,!0}}return!1}function Tn(n,t,r,e){if(f(n)||f(e))return!1;const s=Cn(n,et),o=Cn(e,st);if(s===o&&!In(o)&&(0!==s||A(n,e)))return m(r),d(r,r,t),!0;if(In(o)){let n=0,e=0;const u=$n[s][11],l=$n[11][o];return!f(u)&&!f(l)&&(u(t,0,ct,0),l(ct,0,ft,0),n=lt*ct[0],e=lt*ct[1],bn(e,n,r),r[12]=ft[0],r[13]=ft[1],r[14]=ft[2],!0)}if(3===o&&(2===s||1===s)){const n=$n[s][11];if(f(n))return!1;n(t,0,ct,0);const e=lt*ct[1];Gn(ct,0,ft,0),m(r),d(r,r,ft);const o=1/Math.cos(e);return j(r,r,[o,o,1]),!0}return!1}function In(n){return 1===n||7===n||9===n}function bn(n,t,r){const e=Math.sin(t),s=Math.cos(t),o=Math.sin(n),u=Math.cos(n),l=r;return l[0]=-e,l[4]=-o*s,l[8]=u*s,l[12]=0,l[1]=s,l[5]=-o*e,l[9]=u*e,l[13]=0,l[2]=0,l[6]=u,l[10]=o,l[14]=0,l[3]=0,l[7]=0,l[11]=0,l[15]=1,l}function Cn(n,t){return t.spatialReference===n?t.spatialReferenceId:(t.spatialReference=n,"metersPerUnit"in t&&(t.metersPerUnit=h(n,1)),n.wkt===P.wkt?t.spatialReferenceId=1:v(n)?t.spatialReferenceId=2:W(n)?t.spatialReferenceId=3:n.wkt===S.wkt?t.spatialReferenceId=4:4490===n.wkid?t.spatialReferenceId=5:n.wkt===T.wkt?t.spatialReferenceId=7:n.wkt===I.wkt?t.spatialReferenceId=9:Z(n)?t.spatialReferenceId=8:_(n)?t.spatialReferenceId=10:t.spatialReferenceId=0)}function Fn(n,t,r,e){n!==r&&(r[e++]=n[t++],r[e++]=n[t++],r[e]=n[t])}function Un(n,t,r,e){r[e++]=it*(n[t++]/C.radius),r[e++]=it*(Math.PI/2-2*Math.atan(Math.exp(-1*n[t++]/C.radius))),r[e]=n[t]}function qn(n,t,r,e){Un(n,t,r,e),Ln(r,e,r,e)}function zn(n,t,r,e){Un(n,t,r,e),Dn(r,e,r,e)}function An(n,t,r,e,s){const o=.4999999*Math.PI,l=u(lt*n[t+1],-o,o),i=Math.sin(l);r[e++]=lt*n[t]*s.radius,r[e++]=s.halfSemiMajorAxis*Math.log((1+i)/(1-i)),r[e]=n[t+2]}function Gn(n,t,r,e){An(n,t,r,e,C)}function vn(n){if(f(n))return!1;const t=Cn(n,et);return!!$n[t][6]}function Wn(n,t,r,e,s=0){const o=e+s,u=Math.cos(r);n[0]=Math.cos(t)*u*o,n[1]=Math.sin(t)*u*o,n[2]=Math.sin(r)*o}function Zn(n,t,r,e,s){const o=s+n[t+2],u=lt*n[t+1],l=lt*n[t],i=Math.cos(u);r[e++]=Math.cos(l)*i*o,r[e++]=Math.sin(l)*i*o,r[e]=Math.sin(u)*o}function _n(n,t,r,e){Zn(n,t,r,e,F.radius)}function Bn(n,t,r,e){Zn(n,t,r,e,U.radius)}function Ln(n,t,r,e){Zn(n,t,r,e,C.radius)}function Nn(n,t,r,e,s){const o=n[t],u=n[t+1],l=n[t+2],i=Math.sqrt(o*o+u*u+l*l),a=c(l/(0===i?1:i)),f=Math.atan2(u,o);r[e++]=it*f,r[e++]=it*a,r[e]=i-s}function Jn(n,t,r,e){Nn(n,t,r,e,F.radius)}function Kn(n,t,r,e){Nn(n,t,r,e,U.radius)}function On(n,t,r,e){Nn(n,t,r,e,C.radius)}function Vn(n,t,r,e){On(n,t,r,e),Gn(r,e,r,e)}function Xn(n,t,r,e){On(n,t,r,e),Dn(r,e,r,e)}function Dn(n,t,r,e){!function(n,t,r,e,s){const o=lt*n[t],u=lt*n[t+1],l=n[t+2],i=Math.sin(u),a=Math.cos(u),c=s.radius/Math.sqrt(1-s.eccentricitySquared*i*i);r[e++]=(c+l)*a*Math.cos(o),r[e++]=(c+l)*a*Math.sin(o),r[e++]=(c*(1-s.eccentricitySquared)+l)*i}(n,t,r,e,C)}function Hn(n,t,r,e){const s=q,o=n[t],u=n[t+1],l=n[t+2];let i,a,c,f,p,h,m,d,j,M,R,k,g,w,y,E,x,P,S,T,I;i=Math.abs(l),a=o*o+u*u,c=Math.sqrt(a),f=a+l*l,p=Math.sqrt(f),T=Math.atan2(u,o),h=l*l/f,m=a/f,w=s.a2/p,y=s.a3-s.a4/p,m>.3?(d=i/p*(1+m*(s.a1+w+h*y)/p),S=Math.asin(d),M=d*d,j=Math.sqrt(1-M)):(j=c/p*(1-h*(s.a5-w-m*y)/p),S=Math.acos(j),M=1-j*j,d=Math.sqrt(M)),R=1-C.eccentricitySquared*M,k=C.radius/Math.sqrt(R),g=s.a6*k,w=c-k*j,y=i-g*d,x=j*w+d*y,E=j*y-d*w,P=E/(g/R+x),S+=P,I=x+E*P/2,l<0&&(S=-S),r[e++]=it*T,r[e++]=it*S,r[e]=I}function Qn(n,t,r,e){Hn(n,t,r,e),Ln(r,e,r,e)}function Yn(n,t,r,e){Hn(n,t,r,e),Gn(r,e,r,e)}const $n={2:{5:null,8:null,10:null,11:Fn,6:Fn,1:Ln,7:null,9:null,0:null,3:Gn,2:Fn,4:Dn},5:{5:Fn,8:null,10:null,11:Fn,6:Fn,1:Ln,7:null,9:null,0:null,3:null,2:null,4:Dn},8:{5:null,8:Fn,10:null,11:Fn,6:null,1:null,7:Bn,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:Fn,11:Fn,6:null,1:null,7:null,9:_n,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,11:Un,6:Un,1:qn,7:null,9:null,0:null,3:Fn,2:Un,4:zn},4:{5:Hn,8:null,10:null,11:Hn,6:Hn,1:Qn,7:null,9:null,0:null,3:Yn,2:Hn,4:Fn},1:{5:On,8:null,10:null,11:On,6:On,1:Fn,7:null,9:null,0:null,3:Vn,2:On,4:Xn},7:{5:null,8:Kn,10:null,11:Kn,6:null,1:null,7:Fn,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:Jn,11:Jn,6:null,1:null,7:null,9:Fn,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:Fn,3:null,2:null,4:null},11:{5:Fn,8:Fn,10:Fn,11:Fn,6:Fn,1:Ln,7:Bn,9:_n,0:null,3:Gn,2:Fn,4:Dn},6:{5:null,8:null,10:null,11:Fn,6:Fn,1:Ln,7:null,9:null,0:null,3:null,2:Fn,4:Dn}};function nt(n,t,r=rt()){return f(n)||f(t)?null:tt(n,t,r).projector}function tt(n,t,r){if(f(n)||f(t)||r.source.spatialReference===n&&r.dest.spatialReference===t)return r;const e=Cn(n,r.source),s=Cn(t,r.dest);return 0===e&&0===s?A(n,t)?r.projector=Fn:r.projector=null:r.projector=$n[e][s],r}function rt(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Fn}}const et={spatialReference:null,spatialReferenceId:0},st={spatialReference:null,spatialReferenceId:0},ot=rt(),ut=rt(),lt=l(1),it=i(1),at=a(),ct=a(),ft=a(),pt=a(),ht=a();export{vn as canProjectToWGS84ComparableLonLat,nn as canProjectWithoutEngine,bn as computeLatLonToENURotation,Tn as computeLinearTransformation,rn as getProjectorName,H as getTransformation,Q as getTransformations,tn as initializeProjection,K as isLoaded,O as isSupported,V as load,Sn as localLinearScaleFactors,Wn as lonLatToSphericalPCPF,An as lonLatToWebMercatorComparable,X as project,Pn as projectBoundingRect,xn as projectBoundingSphere,wn as projectBuffer,yn as projectDirection,pn as projectExtent,D as projectMany,on as projectMultipoint,en as projectPoint,jn as projectPointToVector,kn as projectPointToWGS84ComparableLonLat,cn as projectPolygon,ln as projectPolyline,dn as projectVectorToDehydratedPoint,mn as projectVectorToPoint,Rn as projectVectorToVector,gn as projectVectorToWGS84ComparableLonLat,Mn as projectXYZToVector,Nn as sphericalPCPFtoLonLatElevation,$ as unload};
