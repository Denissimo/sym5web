/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import s from"../../core/Collection.js";import{E as e}from"../../chunks/Evented.js";import o from"../../core/Handles.js";import{init as i,on as r,watch as a}from"../../core/watchUtils.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/ensureType.js";import"../../chunks/Logger.js";import{subclass as m}from"../../core/accessorSupport/decorators/subclass.js";import{b as n}from"../../chunks/layerListUtils.js";import c from"./ListItem.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/arrayUtils.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../chunks/Message.js";import"../../chunks/object.js";import"../../config.js";import"../../chunks/string.js";import"../../core/Accessor.js";import"../../chunks/deprecate.js";import"../../chunks/metadata.js";import"../../chunks/handleUtils.js";import"../../core/HandleOwner.js";import"../../chunks/Identifiable.js";import"../../core/accessorSupport/decorators/aliasOf.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../chunks/ActionSlider.js";import"../../support/actions/ActionToggle.js";const p="map",d="tables",h="layer-list-mode",u=s.ofType(c);let j=class extends e.EventedAccessor{constructor(t){super(t),this._handles=new o,this.listItemCreatedFunction=null,this.tableItems=new u,this.map=null}initialize(){this._handles.add([i(this,["map","map.loaded"],(()=>this._mapHandles()))],p)}destroy(){this._handles.destroy(),this._handles=null,this.map=null,this.tableItems.removeAll()}get state(){var t;const s=null==(t=this.map)?void 0:t.loadStatus;return"string"==typeof s?"loaded"===s?"ready":"loading"===s?"loading":"disabled":"ready"}triggerAction(t,s){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:s})}_mapHandles(){const{_handles:t,map:s}=this;t.remove(d),this._compileList(),s&&t.add([r(this,"map.allTables","change",(()=>this._compileList())),i(this,"map.allTables",(()=>this._compileList())),i(this,"listItemCreatedFunction",(()=>this._compileList()))],d)}_modifyListItem(t){if("function"==typeof this.listItemCreatedFunction){const s={item:t};this.listItemCreatedFunction.call(null,s)}}_removeAllItems(){this.tableItems.removeAll()}_getViewableTables(t){if(t)return t.filter((t=>"hide"!==n(t)))}_watchTablesListMode(t){const{_handles:s}=this;s.remove(h),t&&t.forEach((t=>{s.add(a(t,"listMode",(()=>this._compileList())),h)}))}_compileList(){var t;const s=null==(t=this.map)?void 0:t.tables;this._watchTablesListMode(s);const e=this._getViewableTables(s);e&&e.length?(this._createNewItems(e),this._modifyOrRemoveItems(e),this._sortItems(e)):this._removeAllItems()}_createNewItems(t){const{tableItems:s}=this;t.forEach((t=>{s.find((s=>s.layer===t))||s.add(new c({layer:t}))}))}_modifyOrRemoveItems(t){const{tableItems:s}=this;s.forEach((e=>{if(!e)return;t&&t.find((t=>e.layer===t))?this._modifyListItem(e):s.remove(e)}))}_sortItems(t){const{tableItems:s}=this;s.sort(((s,e)=>{const o=t.indexOf(s.layer),i=t.indexOf(e.layer);return o>i?-1:o<i?1:0}))}};t([l()],j.prototype,"listItemCreatedFunction",void 0),t([l({type:u})],j.prototype,"tableItems",void 0),t([l()],j.prototype,"map",void 0),t([l({readOnly:!0})],j.prototype,"state",null),j=t([m("esri.widgets.TableList.TableListViewModel")],j);var f=j;export default f;
