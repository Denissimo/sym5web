/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{g as t}from"../../chunks/assets.js";import s from"../../config.js";import o from"../../Graphic.js";import r from"../../PopupTemplate.js";import i from"../../core/Accessor.js";import l from"../../core/Collection.js";import n from"../../core/Error.js";import{E as a}from"../../chunks/Evented.js";import u from"../../core/Handles.js";import{h as p,u as c,i as m,c as h}from"../../core/lang.js";import{L as d}from"../../chunks/Logger.js";import{eachAlways as g,after as y,createAbortController as S}from"../../core/promiseUtils.js";import{on as j,init as f,whenFalseOnce as b,whenOnce as v}from"../../core/watchUtils.js";import{property as _}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/ensureType.js";import{subclass as w}from"../../core/accessorSupport/decorators/subclass.js";import k from"../../geometry/Point.js";import I from"../../geometry/SpatialReference.js";import{o as P}from"../../chunks/locale.js";import{fetchMessageBundle as x}from"../../intl.js";import L from"../../portal/Portal.js";import{getSchemes as T}from"../../smartMapping/symbology/location.js";import C from"../../symbols/PictureMarkerSymbol.js";import R from"../../symbols/SimpleFillSymbol.js";import E from"../../symbols/SimpleLineSymbol.js";import D from"../../symbols/SimpleMarkerSymbol.js";import F from"../../symbols/TextSymbol.js";import{h as O}from"../../chunks/layerViewUtils.js";import M from"./LayerSearchSource.js";import A,{i as U,m as G,a as N,b as V}from"./LocatorSearchSource.js";import B from"./SearchSource.js";import{g as J,a as z}from"../../chunks/geometryUtils2.js";import{s as Q,g as H,p as q}from"../../chunks/geolocationUtils.js";import{G as W}from"../../chunks/GoTo.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/object.js";import"../../chunks/Message.js";import"../../chunks/string.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/JSONSupport.js";import"../../chunks/write.js";import"../../chunks/metadata.js";import"../../chunks/handleUtils.js";import"../../chunks/arrayUtils.js";import"../../chunks/reader.js";import"../../chunks/deprecate.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/writer.js";import"../../geometry/support/webMercatorUtils.js";import"../../chunks/Ellipsoid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../chunks/jsonMap.js";import"../../geometry/support/jsonUtils.js";import"../../symbols.js";import"../../symbols/CIMSymbol.js";import"../../chunks/enumeration.js";import"../../layers/support/fieldUtils.js";import"../../chunks/domains.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/arcadeOnDemand.js";import"../../symbols/Symbol.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/colors.js";import"../../chunks/Symbol3DOutline.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../chunks/persistableUrlUtils.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../chunks/Thumbnail.js";import"../../chunks/number.js";import"../../chunks/Loadable.js";import"../../chunks/Promise.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../../chunks/Symbol3DVerticalOffset.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/uid.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/content/CustomContent.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../popup/support/FieldInfoFormat.js";import"../../chunks/date.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../chunks/chartMediaInfoUtils.js";import"../../chunks/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../core/accessorSupport/decorators/aliasOf.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/TextContent.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../support/actions/ActionBase.js";import"../../chunks/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../chunks/symbologyUtils.js";import"../../chunks/utils7.js";import"../../chunks/basemapUtils.js";import"../../Basemap.js";import"../../chunks/loadAll.js";import"../../chunks/asyncUtils.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../chunks/writeUtils.js";import"../../chunks/utils11.js";import"../../chunks/unitUtils.js";import"../../chunks/projectionEllipsoid.js";import"../../tasks/Locator.js";import"../../chunks/suggestLocations.js";import"../../chunks/utils5.js";import"../../rest/support/AddressCandidate.js";import"../../chunks/commonProperties3.js";import"../../tasks/Task.js";import"../../chunks/scaleUtils.js";import"../../chunks/trimExtend.js";import"../../rest/support/ProjectParameters.js";import"../../rest/support/GeneralizeParameters.js";import"../../rest/support/LengthsParameters.js";import"../../rest/support/OffsetParameters.js";import"../../rest/support/RelationParameters.js";import"../../rest/support/TrimExtendParameters.js";function Z(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const K=d.getLogger("esri.widgets.Search.SearchViewModel"),X=l.ofType({key:e=>e.layer?"layer":"locator",base:B,typeMap:{layer:M,locator:A}}),Y=I.WGS84,$=/<(?:.|\s)*?>/g;let ee=class extends(W(a.EventedMixin(i))){constructor(e){super(e),this._handles=new u,this._gotoController=null,this._searching=null,this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new X,this.defaultSymbol=new C({url:t(p("trident")?"esri/images/search/search-symbol-32.png":"esri/images/search/search-symbol-32.svg"),size:24,width:24,height:24}),this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=1,this.popupEnabled=!0,this.popupTemplate=null,this.portal=L.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new X,this.suggestionDelay=150,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await x("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new r({title:e.searchResult,content:"{Match_addr}"})};e(),this._handles.add([j(this,["defaultSources","sources"],"change",(()=>this.notifyChange("allSources"))),f(this,["includeDefaultSources","view","portal"],(()=>this._update())),P(e)])}destroy(){this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1===this.allSources.length||!this.searchAllEnabled?0:-1}set activeSourceIndex(e){void 0!==e?this._override("activeSourceIndex",e):this._clearOverride("activeSourceIndex")}get allPlaceholder(){var e;return null==(e=this.messages)?void 0:e.allPlaceholder}set allPlaceholder(e){e?this._override("allPlaceholder",e):this._clearOverride("allPlaceholder")}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,o="function"==typeof s?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,r=this._get("allSources")||new X;return r.removeAll(),r.addMany(o.filter(Boolean)),r}get locationEnabled(){return this._get("locationEnabled")||Q()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=Q();if(e&&!t){const e=new n("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});K.error(e)}this._override("locationEnabled",e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(-1===t)return s;const o=e.getItemAt(t);return o?o.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),o=this.when().then((()=>this._getResultsFromSources(s,t).then((e=>{var o;if(null!=(o=c(null==t?void 0:t.signal))&&o.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(r,e,s);const i=this._getFirstResult(r.results),l=(s.location&&i?i.name:s.text).replace($,"");return this._set("searchTerm",l),(s.key&&"number"==typeof s.sourceIndex||s.location)&&this._set("selectedSuggestion",s),this._set("results",r.results),this._set("resultCount",r.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("search-complete",r),this._selectFirstResult(i).then((()=>r))})))).then((e=>(this._clearSearching(),e)),(e=>{throw this._clearSearching(),e}));return this._searching=o,this.notifyChange("state"),o}searchNearby(e){if(!this.locationEnabled){const e=new n("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return K.error(e),Promise.reject(e)}const t=H().then((t=>q({position:t,view:this.view},e))).then((t=>this.search(t,e)));return this._searching=t,this.notifyChange("state"),t.catch((()=>{})).then((()=>this._clearSearching())),t}select(e){if(this.clearGraphics(),!e){const t=new n("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return K.error(t),Promise.reject(t)}const{view:t}=this,s=Z(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=this.allSources.getItemAt(s);if(!r){const e=new n("select:missing-source","Cannot select without a source.",{source:r});return K.error(e),Promise.reject(e)}const i=r instanceof M?this._getLayerSourcePopupTemplate(r):r.popupTemplate,l=r.resultSymbol||this._getDefaultSymbol(e),a=Z(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,u=Z(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,p=Z(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,c=p?i||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const e=new n("select:missing-feature","Cannot select without a feature.",{feature:h});return K.error(e),Promise.reject(e)}const{attributes:d,geometry:y,layer:S,sourceLayer:j}=h,f=J(y),b={layerViewQuery:this._getLayerView(h),elevationQuery:t&&m(f)?z(f,t).catch((()=>f)):Promise.resolve(f)};return g(b).then((i=>{const n=i.layerViewQuery.value,g=i.elevationQuery.value;l instanceof F&&(l.text=e.name);const f=t&&u?e.target||e.extent:null;return(m(f)?this._goToSearchResult(f):Promise.resolve()).then((()=>{var i;const u=n?h:new o({geometry:y,symbol:l,attributes:d,layer:S,sourceLayer:j,popupTemplate:c}),m=p&&(null==(i=this.view)?void 0:i.popup),f=m&&u.getEffectivePopupTemplate(m.defaultPopupTemplateEnabled);return f&&t.popup.open({features:[u],location:g}),n&&O(n)&&!f&&this._highlightFeature({graphic:u,layerView:n}),!n&&a&&t&&t.graphics.push(u),this._set("selectedResult",e),this._set("resultGraphic",u),this.emit("select-result",{result:e,source:r,sourceIndex:s}),e}))}))}suggest(e,t,s){const o=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:o}),this._suggestTimer(t,s).then((()=>this._suggestImmediate(o,s).then((e=>(this._set("suggestions",e.results),this._set("suggestionCount",e.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("suggest-complete",e),e)))))}async when(){await b(this,"updating")}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=g([null==e?void 0:e.load(),null==t?void 0:t.when()]);if(this.destroyed)return;if(this.notifyChange("updating"),await s,s!==this._updatingPromise)return}this._updatingPromise=null,this.notifyChange("updating");const s=v(this,"messages");this.destroyed||(this._handles.add(s),await s,this._updateDefaultSources())}_clearSearching(){this._searching=null,this.notifyChange("state")}_convertHelperServices(){var e,t;const o=null==(e=this.portal)||null==(t=e.helperServices)?void 0:t.geocode;if(!o)return[];return o.map((e=>{var t;if(!1===e.placefinding)return;const o=s.apiKey&&U(e.url)?{url:G}:null,r=A.fromJSON({...e,...o}),i=null==(t=r.locator)?void 0:t.url;if(U(i)||N(i)||V(i)){const e=r.outFields||["Addr_type","Match_addr","StAddr","City"],t=r.placeholder||this.messages.placeholder,s="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.set({singleLineFieldName:"SingleLine",outFields:e,placeholder:t,defaultZoomScale:s})}return r.singleLineFieldName?r:void 0})).filter(Boolean)}_getLayerSources(e,t){var s;const o=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=o.findLayerById(e.id);if(!s)return;const r=this._getLayerJSON(e),i=M.fromJSON(r);return i.placeholder=t,this._getLayer(s,r).then((e=>{i.layer=e})),i})).filter(Boolean).toArray()}_getTableSources(e,t){var s;const o=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=o.findTableById(e.id);if(!s)return;const r=this._getLayerJSON(e),i=M.fromJSON(r);return i.placeholder=t,this._getLayer(s,r).then((e=>{i.layer=e})),i})).filter(Boolean).toArray()}_convertApplicationProperties(){var e,t,s;const o=null==(e=this.view)?void 0:e.map,r=null==o||null==(t=o.applicationProperties)||null==(s=t.viewing)?void 0:s.search;if(!r)return[];const{enabled:i,hintText:l,layers:n,tables:a}=r;if(!i)return[];return[...this._getLayerSources(n,l),...this._getTableSources(a,l)]}_getSubLayer(e,t){return e.load().then((()=>{if(!e.allSublayers)return Promise.reject();const s=e.allSublayers.find((e=>e.id===t.subLayer));return s?s.createFeatureLayer():Promise.reject()}))}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find((e=>e.id===t.subLayer));return"building-component"!==(null==s?void 0:s.type)?Promise.reject():(await s.load(),null==s.associatedLayer?Promise.reject():(await s.associatedLayer.load(),s))}_getLayer(e,t){return"feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type?Promise.resolve(e):"map-image"===e.type?this._getSubLayer(e,t).catch((()=>{const t=new n("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return K.error(t),null})):"building-scene"===e.type?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()]),this.notifyChange("allSources")}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var e;const t=null==(e=this.view)?void 0:e.popup,{resultGraphic:s}=this;if(!t||!s)return;const{selectedFeature:o}=t;o&&o===s&&t.close()}_suggestTimer(e,t){const s=null!=e?e:this.suggestionDelay;return y(s,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof o?J(e.geometry):e instanceof k?e:Array.isArray(e)&&2===e.length?new k({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&Z(e,"key")&&Z(e,"text")&&Z(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s="string"==typeof e?e:this.searchTerm,{selectedSuggestion:o,selectedResult:r}=this,i=!e&&o&&r,l=i&&o.key===r.key&&o.sourceIndex===r.sourceIndex,n=i&&o.location;return l||n?o:{location:c(t),text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:s}=e,o=s[0],r=!!o;return r&&(t=o),r})),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then((()=>this._getSuggestionsFromSources(e,t))).then((s=>{var o;if(null!=(o=c(null==t?void 0:t.signal))&&o.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r}))}_formatSourceResponse(e,t,s){const o=t&&t.value||[],r=t&&t.error,i=this.allSources.getItemAt(s);if(r){const t={sourceIndex:s,source:i,error:r};e.errors.push(t),K.error(r),e.numErrors++}else{const t={sourceIndex:s,source:i,results:o};e.results.push(t),e.numResults+=o.length}}_formatResponse(e,t,s){if(t)if(-1===e.activeSourceIndex){const o=s&&Z(s,"sourceIndex")&&-1!==s.sourceIndex?s.sourceIndex:void 0;t.forEach(((t,s)=>{const r=void 0!==o?o:s;this._formatSourceResponse(e,t,r)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:s}=this,o=!e.location&&Z(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,r=[];if(!s.length){const e=new n("search:no-sources-defined","At least one source is required.",{allSources:s});return K.error(e),Promise.reject(e)}return-1===o?s.forEach(((s,o)=>{r.push(this._getResultsFromSource(e,o,t))})):r.push(this._getResultsFromSource(e,o,t)),g(r)}_getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:o}=this,r=[];if(!s.length){const e=new n("suggest:no-sources-defined","At least one source is required.",{allSources:s});return K.error(e),Promise.reject(e)}return-1===o?s.forEach(((s,o)=>{r.push(this._getSuggestionsFromSource(e,o,t))})):r.push(this._getSuggestionsFromSource(e,o,t)),g(r)}_getResultsFromSource(e,t,s){var o;const r=this.allSources.getItemAt(t),{location:i=null}=e,l=(null==(o=this.view)?void 0:o.spatialReference)||Y,n=Z(r,"maxResults")?r.maxResults:this.maxResults,a=!!(r instanceof M&&Z(r,"exactMatch"))&&r.exactMatch,{view:u}=this;return r.getResults({view:u,sourceIndex:t,location:i,suggestResult:e,spatialReference:l,exactMatch:a,maxResults:n},s)}_getSuggestionsFromSource(e,t,s){const o=this.allSources.getItemAt(t),r=Z(o,"suggestionsEnabled")?o.suggestionsEnabled:this.suggestionsEnabled,i=e.length,l=Z(o,"minSuggestCharacters")?o.minSuggestCharacters:this.minSuggestCharacters;if(r&&e.trim()&&i>=l){var n;const r=(null==(n=this.view)?void 0:n.spatialReference)||Y,i=Z(o,"maxSuggestions")?o.maxSuggestions:this.maxSuggestions,{view:l}=this;return o.getSuggestions({view:l,sourceIndex:t,suggestTerm:e,spatialReference:r,maxSuggestions:i},s)}return Promise.resolve(null)}createDefaultSymbol(e,t){if("point"===t){const t=e;return new D({color:e.color,size:t.size,outline:{color:t.outline.color,width:t.outline.width}})}if("polyline"===t){const t=e;return new E({color:t.color,width:t.width})}if("polygon"===t){const t=e;return new R({color:t.color,outline:{color:t.outline.color,width:t.outline.width}})}}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return Z(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let s=null;return t.some((t=>t.results.some((o=>o===e&&(s=t.sourceIndex,!0))))),s}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const s=S();this._gotoController=s;const o={target:{target:e},options:{animate:t,signal:s.signal}};await this.callGoTo(o),this._gotoController=null}_getDefaultSymbol(e){var t,s,o;const r=null==(t=this.view)||null==(s=t.map)||null==(o=s.basemap)?void 0:o.id,i=h(e,"feature","geometry","type");if(m(i)){const e=T({basemap:r,geometryType:i})||T({basemap:"topo",geometryType:i}),t=e&&e.primaryScheme;if(t)return t.color&&Z(t,"opacity")&&(t.color.a=t.opacity),this.createDefaultSymbol(t,i)}return this.defaultSymbol}_removeHighlight(){this._handles.remove("highlight")}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer.type||"subtype-sublayer"===e.layer.type)return Promise.resolve(null);const{layer:s}=e;return await t.when(),t.whenLayerView(s)}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:o,layer:r}=t,{objectIdField:i}=r,l=o&&o[i],n=s.highlight(l||t);this._handles.add(n,"highlight")}};ee.ALL_INDEX=-1,e([_({readOnly:!0,value:null})],ee.prototype,"activeSource",null),e([_()],ee.prototype,"activeSourceIndex",null),e([_()],ee.prototype,"allPlaceholder",null),e([_({readOnly:!0,dependsOn:["defaultSources.length","sources.length","includeDefaultSources"]})],ee.prototype,"allSources",null),e([_()],ee.prototype,"autoNavigate",void 0),e([_()],ee.prototype,"autoSelect",void 0),e([_()],ee.prototype,"defaultPopupTemplate",void 0),e([_({readOnly:!0})],ee.prototype,"defaultSources",void 0),e([_()],ee.prototype,"defaultSymbol",void 0),e([_()],ee.prototype,"includeDefaultSources",void 0),e([_()],ee.prototype,"locationEnabled",null),e([_()],ee.prototype,"maxInputLength",void 0),e([_()],ee.prototype,"maxResults",void 0),e([_()],ee.prototype,"maxSuggestions",void 0),e([_()],ee.prototype,"messages",void 0),e([_()],ee.prototype,"minSuggestCharacters",void 0),e([_({readOnly:!0})],ee.prototype,"placeholder",null),e([_()],ee.prototype,"popupEnabled",void 0),e([_({type:r})],ee.prototype,"popupTemplate",void 0),e([_({type:L})],ee.prototype,"portal",void 0),e([_()],ee.prototype,"resultCount",void 0),e([_()],ee.prototype,"resultGraphicEnabled",void 0),e([_({readOnly:!0})],ee.prototype,"resultGraphic",void 0),e([_({readOnly:!0})],ee.prototype,"results",void 0),e([_({readOnly:!0})],ee.prototype,"selectedSuggestion",void 0),e([_()],ee.prototype,"searchAllEnabled",void 0),e([_({readOnly:!0})],ee.prototype,"selectedResult",void 0),e([_()],ee.prototype,"searchTerm",null),e([_({type:X})],ee.prototype,"sources",void 0),e([_({readOnly:!0,dependsOn:["allSources.length","updating"]})],ee.prototype,"state",null),e([_()],ee.prototype,"suggestionDelay",void 0),e([_()],ee.prototype,"suggestionCount",void 0),e([_({readOnly:!0})],ee.prototype,"suggestions",void 0),e([_()],ee.prototype,"suggestionsEnabled",void 0),e([_({readOnly:!0})],ee.prototype,"updating",null),e([_()],ee.prototype,"view",void 0),e([_()],ee.prototype,"clear",null),ee=e([w("esri.widgets.Search.SearchViewModel")],ee);var te=ee;export default te;
