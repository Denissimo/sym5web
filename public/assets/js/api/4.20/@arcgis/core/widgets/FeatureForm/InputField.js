/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{substitute as e}from"../../intl.js";import i from"../../core/Accessor.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/ensureType.js";import"../../chunks/Logger.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import s from"../../layers/support/CodedValueDomain.js";import{v as n,D as l,g as a}from"../../chunks/domains.js";import{isNumericField as u,isStringField as p,isDateField as d,TypeValidationError as m,validateFieldValue as c,getFeatureEditFields as h,getFeatureGeometryFields as y,NumericRangeValidationError as g,getFieldRange as f}from"../../layers/support/fieldUtils.js";import"../../chunks/number.js";import"../../chunks/jsonMap.js";import"../../chunks/object.js";import"../../chunks/locale.js";import"../../chunks/string.js";import"../../core/Error.js";import"../../chunks/Message.js";import"../../config.js";import"../../core/promiseUtils.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../chunks/deprecate.js";import"../../chunks/metadata.js";import"../../chunks/handleUtils.js";import"../../chunks/ArrayPool.js";import"../../chunks/arrayUtils.js";import"../../core/scheduling.js";import"../../chunks/enumeration.js";import"../../chunks/JSONSupport.js";import"../../chunks/write.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/arcadeOnDemand.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../chunks/Ellipsoid.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";const v={type:"number"},j={type:"number",intlOptions:{notation:"scientific"}},b={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"}};let _=class extends i{constructor(t){super(t),this.arcade=null,this.config=null,this.feature=null,this.field=null,this.initialFeature=null,this.layer=null,this.description=null,this.editorType=null,this.error=null,this.format=null,this.group=null,this.hint=null,this.messages=null,this.name=null}get compiledFunc(){var t;const{arcade:e}=this;return e&&e.arcadeUtils.createFunction(null==(t=this.config)?void 0:t.visibilityExpression)}get compiledRequiredFunc(){var t;const{arcade:e}=this;return e&&e.arcadeUtils.createFunction(null==(t=this.config)?void 0:t.requiredExpression)}get evaluatedRequirement(){const t=this.compiledRequiredFunc;if(!t)return null;const{arcade:e}=this;return e.arcadeUtils.executeFunction(t,e.arcadeUtils.createExecContext(this.feature))}get evaluatedVisibility(){const t=this.compiledFunc;if(!t)return null;const{arcade:e}=this;return e.arcadeUtils.executeFunction(t,e.arcadeUtils.createExecContext(this.feature))}get domain(){var t,e;const{typeIdField:i}=this.layer,r=i===this.name,o=null==(t=this.field)?void 0:t.domain;if(r&&!o)return new s({name:"__internal-type-based-coded-value-domain__",codedValues:this.layer.types.map((({id:t,name:e})=>({code:t,name:e})))});const{feature:n}=this,l=i&&this.layer.getFieldDomain(this.name,{feature:n})||o,a=null==(e=this.config)?void 0:e.domain;return this._isDomainCompatible(a)?a:l}get editable(){var t;return this.layer.capabilities.operations.supportsEditing&&this.field.editable&&!1!==(null==(t=this.config)?void 0:t.editable)}get errorMessage(){return this._toErrorMessage()}get includeTime(){var t;const e=null==(t=this.config)?void 0:t.includeTime;return void 0===e||e}get label(){var t;return(null==(t=this.config)?void 0:t.label)||this.field.alias||this.field.name}get maxLength(){var t,e;if("date"===this.type)return-1;const i=null==(t=this.field)?void 0:t.length,r=null==(e=this.config)?void 0:e.maxLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:i}get minLength(){var t,e;if("date"===this.type)return-1;const i=null==(t=this.field)?void 0:t.length,r=null==(e=this.config)?void 0:e.minLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:-1}get required(){var t,e;if(!this.editable)return!1;if(!(null==(t=this.field)?void 0:t.nullable))return!0;if("boolean"==typeof this.evaluatedRequirement)return this.evaluatedRequirement;return!0===(null==(e=this.config)?void 0:e.required)}get type(){const{field:t}=this;return u(t)?"number":p(t)?"text":d(t)?"date":"unsupported"}get valid(){const t=this.editable?this._validate():null;return this._set("error",t),null===t}get value(){return this._get("value")}set value(t){this.notifyChange("evaluatedVisibility"),this._set("value",t)}get visible(){if(this._isEditorField())return!1;return"boolean"==typeof this.evaluatedVisibility?this.evaluatedVisibility:!!this.config||this._shownByDefault()}_isDomainCompatible(t){const{field:e}=this;if("coded-value"===(null==t?void 0:t.type)){const i=typeof t.codedValues[0].code;if("string"===i&&p(e)||"number"===i&&u(e))return!0}return!!("range"===(null==t?void 0:t.type)&&u(e)||d(e))}_validate(){const{domain:t,field:e,initialFeature:i,minLength:r,required:o,type:s,value:l}=this,a=o&&null===l;return a||i.getAttribute(e.name)!==l?"text"===s&&r>-1&&"string"==typeof l&&l.length<r?"length-validation-error::too-short":t?null!==l||o?n(t,l):null:a?m.INVALID_TYPE:c(e,l):null}_shownByDefault(){var t;const e=null==(t=this.field)?void 0:t.type;return"oid"!==e&&"global-id"!==e&&!this._isGeometryField()}_isEditorField(){return h(this.layer).indexOf(this.name)>-1}_isGeometryField(){return y(this.layer).indexOf(this.name)>-1}_toErrorMessage(){const{domain:t,field:i,messages:r,minLength:o,value:s,required:n,type:u}=this,p=this.error;if(n&&null===s)return r.validationErrors.cannotBeNull;if(p===l.VALUE_OUT_OF_RANGE||p===g.OUT_OF_RANGE){const o=a(t)||f(i);return e(r.validationErrors.outsideRange,o,{format:{max:"date"===u?b:o.isInteger?v:j,min:"date"===u?b:o.isInteger?v:j}})}return p===l.INVALID_CODED_VALUE?r.validationErrors.invalidCodedValue:p===m.INVALID_TYPE?r.validationErrors.invalidType:"length-validation-error::too-short"===p?e(r.validationErrors.tooShort,{min:o}):null}};t([r()],_.prototype,"arcade",void 0),t([r()],_.prototype,"compiledFunc",null),t([r()],_.prototype,"compiledRequiredFunc",null),t([r()],_.prototype,"config",void 0),t([r()],_.prototype,"evaluatedRequirement",null),t([r()],_.prototype,"evaluatedVisibility",null),t([r()],_.prototype,"feature",void 0),t([r()],_.prototype,"field",void 0),t([r()],_.prototype,"initialFeature",void 0),t([r()],_.prototype,"layer",void 0),t([r({aliasOf:"config.description"})],_.prototype,"description",void 0),t([r()],_.prototype,"domain",null),t([r()],_.prototype,"editable",null),t([r({aliasOf:"config.editorType"})],_.prototype,"editorType",void 0),t([r({readOnly:!0})],_.prototype,"error",void 0),t([r({dependsOn:["error","messages","value"]})],_.prototype,"errorMessage",null),t([r({aliasOf:"config.format"})],_.prototype,"format",void 0),t([r()],_.prototype,"group",void 0),t([r({aliasOf:"config.hint"})],_.prototype,"hint",void 0),t([r()],_.prototype,"includeTime",null),t([r()],_.prototype,"label",null),t([r()],_.prototype,"maxLength",null),t([r()],_.prototype,"minLength",null),t([r()],_.prototype,"messages",void 0),t([r({aliasOf:"field.name"})],_.prototype,"name",void 0),t([r()],_.prototype,"required",null),t([r()],_.prototype,"type",null),t([r()],_.prototype,"valid",null),t([r({value:null})],_.prototype,"value",null),t([r()],_.prototype,"visible",null),_=t([o("esri.widgets.FeatureForm.InputField")],_);var k=_;export default k;
