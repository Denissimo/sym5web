/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{f as e,i as s,j as i,r as o,b as r,d as n,o as a}from"../core/lang.js";import{F as l,N as p,a as c,M as m,m as u,E as d,L as h,P as g}from"../chunks/ElevationProfileLine.js";import{o as j,throwIfAborted as f,createTask as b}from"../core/promiseUtils.js";import{init as v}from"../core/watchUtils.js";import{aliasOf as y}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import"../chunks/Logger.js";import{property as k}from"../core/accessorSupport/decorators/property.js";import{subclass as _}from"../core/accessorSupport/decorators/subclass.js";import{R as C}from"../chunks/ResizeObserver.js";import x from"./Widget.js";import S from"./ElevationProfile/ElevationProfileViewModel.js";import w from"../core/Accessor.js";import P from"../core/Collection.js";import{substitute as M}from"../intl.js";import{t as L}from"../chunks/throttle.js";import{f as E,i as T,u as U}from"./Attachments.js";import{h as I,i as A}from"../chunks/widgetUtils.js";import{m as B}from"../chunks/messageBundle.js";import{t as F}from"../chunks/jsxFactory.js";import{o as z,c as D}from"../chunks/unitUtils.js";import{P as V}from"../chunks/Popover.js";import{k as O}from"../chunks/arrayUtils.js";import{h as R,m as $}from"../chunks/handleUtils.js";import{l as W}from"./Feature.js";import{f as G}from"../chunks/number.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/Evented.js";import"../chunks/uuid.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/metadata.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../geometry/Geometry.js";import"../chunks/JSONSupport.js";import"../chunks/write.js";import"../core/Error.js";import"../chunks/Message.js";import"../geometry/SpatialReference.js";import"../chunks/deprecate.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/vec4f64.js";import"../chunks/_commonjsHelpers.js";import"../chunks/domUtils.js";import"../core/Handles.js";import"../chunks/Promise.js";import"../chunks/projector.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/jsonMap.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../chunks/enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../chunks/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/uid.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/vec2.js";import"../geometry/projection.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/projectionEllipsoid.js";import"../chunks/aaBoundingRect.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../geometry/support/geodesicUtils.js";import"../chunks/QueueProcessor.js";import"../chunks/Queue.js";import"../chunks/Scheduler.js";import"../chunks/PromiseQueue.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../Ground.js";import"../chunks/compilerUtils.js";import"../chunks/loadAll.js";import"../chunks/asyncUtils.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery2.js";import"../layers/support/ElevationSampler.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/ray.js";import"../chunks/vectorStacks.js";import"../chunks/quatf64.js";import"../chunks/mat4f64.js";import"../chunks/vec2f64.js";import"../chunks/Intersector.js";import"../chunks/vec4.js";import"../chunks/boundedPlane.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/sphere.js";import"../chunks/Object3D.js";import"../chunks/mathUtils2.js";import"../chunks/utils4.js";import"../chunks/Util.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/mat3.js";import"../chunks/quat.js";import"../chunks/vec3f32.js";import"../chunks/intersectorUtilsConversions.js";import"../layers/GraphicsLayer.js";import"../layers/Layer.js";import"../chunks/BlendLayer.js";import"../chunks/ScaleRangeLayer.js";import"../chunks/GraphicsCollection.js";import"../chunks/ElevationInfo.js";import"../chunks/interactiveToolUtils.js";import"../core/HandleOwner.js";import"./Popup.js";import"./Spinner/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"./Popup/PopupViewModel.js";import"../symbols/support/symbolUtils.js";import"../chunks/utils2.js";import"../chunks/ItemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils3.js";import"../chunks/InputManager.js";import"../chunks/layerViewUtils.js";import"./Feature/FeatureViewModel.js";import"./Attachments/AttachmentsViewModel.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../rest/support/StatisticDefinition.js";import"../rest/support/RelationshipQuery.js";import"../tasks/QueryTask.js";import"../chunks/executeForTopCount.js";import"../chunks/utils5.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../chunks/featureConversionUtils.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../tasks/Task.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../chunks/commonProperties.js";import"../renderers/DictionaryRenderer.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/devEnvironmentUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/support/elements.js";import"../geometry/HeightModelInfo.js";import"../chunks/FeatureIndex.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"../chunks/shared.js";import"../chunks/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/CustomParametersMixin.js";import"../chunks/OperationalLayer.js";import"../chunks/commonProperties2.js";import"../chunks/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/RefreshableLayer.js";import"../chunks/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../chunks/featureReductionUtils.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../layers/support/GeometryFieldsInfo.js";import"../chunks/labelingInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/actions.js";import"../chunks/GoTo.js";import"../chunks/Heading.js";import"../chunks/accessibleHandler.js";import"../chunks/vmEvent.js";import"./support/widget.js";import"./Sketch/SketchViewModel.js";import"../geometry/Circle.js";import"../views/draw/Draw.js";import"../views/draw/MultipointDrawAction.js";import"../views/draw/DrawAction.js";import"../chunks/dehydratedFeatures.js";import"../chunks/byteSizeEstimations.js";import"../chunks/aaBoundingBox.js";import"../chunks/quantizationUtils.js";import"../chunks/Settings.js";import"../chunks/AppendVertex.js";import"../chunks/keybindings.js";import"../chunks/screenUtils2.js";import"../views/draw/PointDrawAction.js";import"../chunks/DrawTool.js";import"../chunks/dehydratedFeatureComparison.js";import"../chunks/InteractiveToolBase.js";import"../chunks/vec4f32.js";import"../chunks/frustum.js";import"../chunks/LaserlineVisualElement.js";import"../chunks/VisualElement.js";import"../chunks/glUtil.js";import"../chunks/InterleavedLayout.js";import"../chunks/BufferView.js";import"../chunks/types.js";import"../chunks/VertexColor.glsl.js";import"../chunks/Program.js";import"../chunks/Texture.js";import"../chunks/VertexArrayObject.js";import"../chunks/mat4f32.js";import"../chunks/geometryDataUtils.js";import"../chunks/triangle.js";import"../chunks/CameraSpace.glsl.js";import"../chunks/ColorMaterial.js";import"../chunks/Object3DVisualElement.js";import"../chunks/RibbonLineMaterial.js";import"../chunks/ElevationProvider.js";import"../chunks/PiUtils.glsl.js";import"../chunks/sdfPrimitives.js";import"../chunks/Texture2.js";import"../chunks/requestImageUtils.js";import"../chunks/FramebufferObject.js";import"../chunks/VerticalOffset.glsl.js";import"../chunks/RightAngleQuadVisualElement.js";import"../views/draw/PolygonDrawAction.js";import"../views/draw/PolylineDrawAction.js";import"../views/draw/SegmentDrawAction.js";import"../chunks/mat2d.js";import"../chunks/mat2df64.js";import"../chunks/MapUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";const H="esri-elevation-profile",Y={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-elevation-profile",base:`${H}`,portrait:`${H}--portrait`,refined:`${H}--refined`,mainContainer:`${H}__main-container`,promptContainer:`${H}__prompt-container`,header:`${H}__header`,zoomOutButton:`${H}__zoom-out-button esri-icon-zoom-out-magnifying-glass`,clearButton:`${H}__clear-button esri-icon-trash`,actionButton:`${H}__action-button esri-button`,sketchButton:`${H}__sketch-button esri-button--primary`,sketchCancelButton:`${H}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${H}__sketch-done-button esri-button--primary`,selectButton:`${H}__select-button esri-button--secondary`,selectCancelButton:`${H}__select-cancel-button esri-button--secondary`,chartContainer:`${H}__chart-container`,chartSpinner:`${H}__chart-spinner esri-icon-loading-indicator esri-rotating`,chartSpinnerVisible:`${H}__chart-spinner--visible`,chartSpinnerSmall:`${H}__chart-spinner--small`,footer:`${H}__footer`},X={line:"amcharts-LineSeries",cursorEnabled:"amcharts-cursor--enabled",axisTooltip:"amcharts-axis-tooltip",seriesTooltip:"amcharts-series-tooltip"},q="esri-elevation-profile-legend",N="esri-elevation-profile-legend-item",Q={base:N,disabled:`${N}--disabled`,expanded:`${N}--expanded`,colorIndicator:`${N}__color-indicator`,header:`${N}__header`,content:`${N}__content`,collapseToggle:`${N}__collapse-toggle esri-button esri-button--tertiary`,collapseToggleIcon:`${N}__collapse-toggle__icon esri-icon-down`,label:`${N}__label`,labelDisabled:`${N}__label--disabled`,checkbox:`${N}__checkbox`},Z="esri-elevation-profile-statistics",J={base:Z,statistic:`${Z}__statistic`,statisticLabel:`${Z}__statistic__label`,statisticValue:`${Z}__statistic__value`,slopeValue:`${Z}__slope-value`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down"},K="esri-elevation-profile-settings",tt={base:`${K} esri-icon-handle-vertical`,popoverContent:`${K}__popover-content`,select:`${K}__select esri-select`,selectLabel:`${K}__select-label`,checkboxLabel:`${K}__checkbox-label`,checkbox:`${K}__checkbox`,uniformChartScalingCheckbox:`${K}__uniform-chart-scaling-checkbox`};let et=class extends w{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([k()],et.prototype,"legend",void 0),t([k()],et.prototype,"chart",void 0),t([k()],et.prototype,"clearButton",void 0),t([k()],et.prototype,"settingsButton",void 0),t([k()],et.prototype,"sketchButton",void 0),t([k()],et.prototype,"selectButton",void 0),t([k()],et.prototype,"unitSelector",void 0),t([k()],et.prototype,"uniformChartScalingToggle",void 0),et=t([_("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],et);var st=et;let it=class extends x{constructor(t,e){super(t,e),this._messagesUnits=null,this._updateLayout=t=>{const e=t.parentElement,s=t.style.display;e.removeChild(t),document.body.appendChild(t),t.style.display="block";let i=80;for(const e of t.childNodes)e instanceof HTMLElement&&(i=Math.max(i,e.offsetWidth));document.body.removeChild(t),e.appendChild(t),t.style.display=s,t.style.setProperty("--max-width",`${i}px`)},this._updateLayoutThrottled=L(this._updateLayout,100)}initialize(){this.own(this._updateLayoutThrottled)}render(){return F("div",{bind:this,class:J.base,afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled},this._renderStatistics())}_renderStatistics(){var t;const e=null==(t=this._messages)?void 0:t.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(t,e){const s=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return E(this._messagesUnits,t,e,l)}));return this._renderStatistic(e,s)}_renderElevationStatistic(t,e){const s=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return E(this._messagesUnits,t,e,l)}));return this._renderStatistic(e,s)}_renderSlopeStatistic(t,e,s){const i=F("div",{key:"slope-up",class:J.slopeValue},F("div",{class:J.slopeUpIcon}),this._renderValue(t,(t=>T(t,"degrees",l))),F("div",{class:J.slopeDownIcon}),this._renderValue(e,(t=>T(t,"degrees",l))));return this._renderStatistic(s,i)}_renderStatistic(t,e){return F("div",{class:J.statistic},F("label",{class:J.statisticLabel},t),F("div",{class:J.statisticValue},e))}_renderValue(t,i){const o=this.line,r=1===o.progress?o.statistics:null,n=e(r,(e=>e[t]));return s(n)?i(n):p}};function ot(t,{profiles:e}){const i=t.title;if(s(i))return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([k()],it.prototype,"effectiveUnits",void 0),t([k()],it.prototype,"line",void 0),t([k(),B("esri/widgets/ElevationProfile/t9n/ElevationProfile")],it.prototype,"_messages",void 0),t([k(),B("esri/core/t9n/Units")],it.prototype,"_messagesUnits",void 0),it=t([_("esri.widgets.ElevationProfile.Statistics")],it);let rt=class extends x{constructor(t,e){super(t,e),this.expanded=!1,this.checkboxVisible=!0,this._messages=null}initialize(){this._statistics=new it(this._statisticsProps),this.own(this.watch("_statisticsProps",(t=>{this._statistics.set(t)})))}destroy(){this._statistics=i(this._statistics)}render(){const t=this.expanded;return F("div",{key:this,class:this.classes(Q.base,{[Q.disabled]:this.disabled,[Q.expanded]:t})},this._renderColorIndicator(),F("div",{key:"header",class:Q.header},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t&&F("div",{key:"content",class:Q.content},this._statistics.render()))}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return F("div",{key:"color-indicator",class:Q.colorIndicator,styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const t=this._messages,e=this.expanded?t.hideDetails:t.showDetails;return F("button",{key:"collapse-toggle",bind:this,class:Q.collapseToggle,onclick:this._onCollapseToggleClick,title:e,"aria-label":e,type:"button"},F("span",{class:Q.collapseToggleIcon}))}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:s}=this,i=`${Q.base}__check-${t.id}`;return F("label",{key:"id",for:i,class:this.classes(Q.label,{[Q.labelDisabled]:s||!e})},e&&this._renderCheckbox(i),F("span",null,ot(t,this._messages)))}_renderCheckbox(t){const e=this.line,s=e.visible,i=this.disabled,o=this._messages,r=s?o.hideProfile:o.showProfile,n=ot(e,this._messages),a=M(r,{name:n});return F("input",{key:"checkbox",id:t,type:"checkbox",class:Q.checkbox,title:a,checked:s,disabled:i,"aria-label":a,bind:this,onchange:t=>this._onCheckboxToggle(t,e)})}_onCheckboxToggle(t,e){t.stopPropagation(),e.toggleVisibility()}};t([k({nonNullable:!0})],rt.prototype,"effectiveUnits",void 0),t([k({nonNullable:!0})],rt.prototype,"line",void 0),t([k()],rt.prototype,"expanded",void 0),t([k()],rt.prototype,"disabled",null),t([k()],rt.prototype,"checkboxVisible",void 0),t([k()],rt.prototype,"onExpandedToggle",void 0),t([k()],rt.prototype,"_statistics",void 0),t([k(),B("esri/widgets/ElevationProfile/t9n/ElevationProfile")],rt.prototype,"_messages",void 0),rt=t([_("esri.widgets.ElevationProfile.LegendItem")],rt);let nt=class extends x{constructor(t,e){super(t,e),this._items=new P,this._expandedLine=null}initialize(){this.own([v(this,"profiles",(t=>{this._destroyItems(),this._items.addMany(t.map((t=>this._createItemForLine(t))))})),this.watch("effectiveUnits",(t=>{this._items.forEach((e=>{e.effectiveUnits=t}))}))])}destroy(){this._destroyItems()}render(){return F("div",{class:q},this._items.toArray().map((t=>t.render())))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t,this._items.forEach((t=>t.expanded=t.line===this._expandedLine))}_createItemForLine(t){return new rt({line:t,effectiveUnits:this.effectiveUnits,expanded:t===this._expandedLine,checkboxVisible:this.profiles.length>1,onExpandedToggle:()=>this._onExpandedToggle(t)})}_destroyItems(){this._items.drain((t=>t.destroy()))}};t([k()],nt.prototype,"profiles",void 0),t([k()],nt.prototype,"effectiveUnits",void 0),t([k()],nt.prototype,"_items",void 0),t([k()],nt.prototype,"_expandedLine",void 0),nt=t([_("esri.widgets.ElevationProfile.Legend")],nt);let at=class extends x{constructor(t,e){super(t,e),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;if(!t&&!e)return F("div",{key:`${this.id}-empty`});const i=s(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return F("button",{class:tt.base,title:i,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":i})}_initializePopover(t){this._destroyPopover(),this._buttonElement=t,this._popover=new V({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=o(this._focusOutElement),this._popover=i(this._popover)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return F("div",{class:tt.popoverContent,bind:this,afterCreate:this._onPopoverContentAfterCreate},t&&this._renderUnitSelector(),e&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:t,unitOptions:e}=this.viewModel,s=this._messagesUnits;return F("label",{key:"unit-selector-label",class:tt.selectLabel},this._messages.unitSelectLabel,F("select",{class:tt.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},e.map((t=>F("option",{key:t,value:t},z(t)?s.systems[t]:s.units[t].pluralCapitalized)))))}_onUnitChange(t){this.viewModel.unit=t.target.value}_onUnitSelectAfterCreate(t){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,t.focus())}_renderUniformChartScalingToggle(){const t=this._messages,e=this.viewModel.uniformChartScaling,s=e?t.uniformChartScalingDisable:t.uniformChartScalingEnable;return F("label",{key:"uniform-chart-scaling-label",class:tt.checkboxLabel,onmousedown:lt},F("input",{class:this.classes(tt.checkbox,tt.uniformChartScalingCheckbox),type:"checkbox",checked:e,title:s,"aria-label":s,bind:this,onchange:this._onUniformChartScalingChange}),t.uniformChartScalingLabel)}_onUniformChartScalingChange(t){this.viewModel.uniformChartScaling=t.target.checked}_togglePopover(t){s(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){e(this._popover,(t=>t.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:t=!0}={}){e(this._popover,(t=>t.open=!1)),t&&e(this._buttonElement,(t=>t.focus()))}_onPopoverContentAfterCreate(t){o(this._focusOutElement),this._focusOutElement=j(t,"focusout",(({relatedTarget:e})=>{const s=t.contains(e),i=e===this._buttonElement;s||i||this._closePopover({focusOnButton:!1})}))}};function lt(t){t.preventDefault()}function pt(t,e){const s=Math.floor(Math.log10(t)),i=t/10**s;let o;return o=e?i<1.5?1:i<3?2:i<5?2.5:i<7?5:10:i<=1?1:i<=2?2:i<=3?2.5:i<=5?5:10,o*10**s}t([k()],at.prototype,"viewModel",void 0),t([k()],at.prototype,"visibleElements",void 0),t([k(),B("esri/widgets/ElevationProfile/t9n/ElevationProfile")],at.prototype,"_messages",void 0),t([k(),B("esri/core/t9n/Units")],at.prototype,"_messagesUnits",void 0),at=t([_("esri.widgets.ElevationProfile.SettingsButton")],at);const ct={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:"#a9a9a9",axisTooltipFontSize:12,axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:"#f8f8f8",seriesTooltipLabelColor:"#323232",seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:Math.round(3.75),seriesTooltipPaddingHorizontal:Math.round(3.75),tooltipBorderRadius:0},mt={...ct,axisGridStroke:"#323232",axisLabelsColor:"#a9a9a9",axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",seriesTooltipBackgroundColor:"#323232",seriesTooltipLabelColor:"#f8f8f8",seriesFillLighten:-.75},ut={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};async function dt(t){const i=await W();f(t.abortOptions);const{am4core:o,am4charts:n}=i;o.options.minPolylineStep=.5,o.options.autoSetClassName=!0,o.options.animationsEnabled=!1;const a=I(),l=a?mt:ct;a&&o.useTheme(i.am4themes_dark);const p=o.create(t.container,n.XYChart);p.arrangeTooltips=!1,p.preloader.disabled=!0,p.zoomOutButton.disabled=!0;const u=A();p.rtl=u,p.padding(l.paddingTop,u?l.paddingLeft:l.paddingRight,l.paddingBottom,u?l.paddingRight:l.paddingLeft);const d=p.plotContainer.background;d.strokeWidth=0,d.strokeOpacity=0,d.stroke=null;const h=p.xAxes.push(new n.ValueAxis),g=p.yAxes.push(new n.ValueAxis),j={params:t,amCharts4Index:i,amChart:p,xAxis:h,yAxis:g,series:new Map,data:null,messages:null,theme:l,zooming:!1,pointerIsOver:!1};p.cursor=function(t){const e=new t.amCharts4Index.am4charts.XYCursor;return e.trackable=!0,e.lineY.disabled=!0,e.behavior="zoomXY",e}(j),function(t){const e=t.theme,s=t.amChart.tooltip,{am4core:i}=t.amCharts4Index;s.id="series-tooltip",s.fitPointerToBounds=!0,s.pointerOrientation="vertical",s.zIndex=-1,s.getFillFromObject=!1,s.label.fontSize=e.seriesTooltipFontSize,s.label.fill=i.color(e.seriesTooltipLabelColor),s.label.padding(e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal,e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal),s.background.cornerRadius=e.tooltipBorderRadius,s.background.stroke=null,s.background.fill=i.color(e.seriesTooltipBackgroundColor),s.background.padding(0,0,0,0),s.adapter.add("dy",(()=>e.seriesTooltipSpacing*(s.background.pointerY<=0?1:-1))),A()&&(s.label.textAlign="middle")}(j),function(t){const{xAxis:e,theme:s}=t,{am4core:i}=t.amCharts4Index;e.numberFormatter=St(t,"distance"),e.strictMinMax=!0,e.cursorTooltipEnabled=!1,e.title.visible=!1;const o=e.renderer;o.line.visible=!1,o.minGridDistance=s.xAxisMinGridDistance,o.minLabelPosition=s.xAxisMinLabelPosition,o.maxLabelPosition=s.xAxisMaxLabelPosition,o.fontWeight=s.axisFontWeight,o.fontSize=s.axisFontSize,o.baseGrid.disabled=!0;const r=o.labels.template;r.fontSize=s.axisLabelsFontSize,r.fontWeight=s.axisLabelsFontWeight,r.fill=i.color(s.axisLabelsColor),r.paddingTop=s.xAxisLabelsSpacing,r.horizontalCenter="left",r.paddingLeft=0;const n=e.tooltip;n.id="axis-tooltip",n.background.fill=i.color(s.axisTooltipBackgroundColor),n.background.stroke=null,n.background.padding(0,0,0,0),n.label.fontSize=s.axisTooltipFontSize,n.label.fill=i.color(s.axisTooltipLabelColor),n.label.padding(s.axisTooltipPaddingTop,s.axisTooltipPaddingHorizontal,s.axisTooltipPaddingBottom,s.axisTooltipPaddingHorizontal);const a=o.grid.template;a.strokeOpacity=1,a.stroke=i.color(s.axisGridStroke)}(j),function(t){const{yAxis:e,theme:s}=t,{am4core:i}=t.amCharts4Index;e.numberFormatter=St(t,"elevation"),e.title.visible=!1,e.cursorTooltipEnabled=!1,e.strictMinMax=!0,e.baseValue=c;const o=e.renderer;o.inside=!0,o.line.opacity=0,o.line.visible=!1,o.minGridDistance=s.yAxisMinGridDistance,o.minLabelPosition=s.yAxisMinLabelPosition,o.maxLabelPosition=s.yAxisMaxLabelPosition,o.fontWeight=s.axisFontWeight,o.fontSize=s.axisFontSize,o.baseGrid.disabled=!0;const r=o.labels.template;r.fontSize=s.axisLabelsFontSize,r.fontWeight=s.axisLabelsFontWeight,r.fill=i.color(s.axisLabelsColor),r.verticalCenter="bottom",r.paddingLeft=s.yAxisLabelSpacing,r.paddingBottom=0;const n=o.grid.template;n.strokeOpacity=1,n.stroke=i.color(s.axisGridStroke),A()&&(o.opposite=!0,r.textAlign="middle",r.paddingLeft=0,r.paddingRight=s.yAxisLabelSpacing)}(j);const b=[yt(j,t.onRangeChange),_t(j,t.onCursorPositionChange),kt(j)];let v=null,y=!1;const k=()=>{r(v)||("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(v):clearTimeout(v),v=null)};return{...j,destroy(){y=!0,k(),R(b).remove(),p.dispose()},update(t){if(t.data===j.data&&t.messages===j.messages)return;if(k(),y)return;const i=()=>{y||(v=null,function(t,{data:i,messages:o}){const n=s(i)&&i.refined;t.amChart.cursor.disabled=!n,t.amChart.htmlContainer.classList.toggle(X.cursorEnabled,n);const a=t.data!==i,l=e(t.data,(t=>t.effectiveUnits))!==e(i,(t=>t.effectiveUnits));t.data=i,t.messages=o,a&&(function(t){const{xAxis:s,yAxis:i}=t,{minX:o,maxX:n,minY:a,maxY:l}=function({data:t,pixelWidth:s,pixelHeight:i}){if(r(t))return ut;const o=t.statistics,n=0,a=e(o,(t=>t.maxDistance));let l=e(o,(t=>t.minElevation)),p=e(o,(t=>t.maxElevation));if(r(a)||r(l)||r(p))return ut;const c=Math.max(a-n,.001);let u=Math.max(p-l,.001);const d=t.effectiveUnits;if(t.dynamicElevationRange){const t=D(c,d.distance,d.elevation);u=Math.max(u,t/m)}if(l-=.02*u,p=l+u+.02*u,[l,p]=function(t,e,s=10){const i=pt(e-t,!1);if(0===i)return[t,e];const o=pt(i/(s-1),!0);return[Math.floor(t/o)*o,Math.ceil(e/o)*o]}(l,p,10),u=p-l,t.uniformScaling)return ht({data:t,bounds:{minX:n,maxX:a,minY:l,maxY:p},pixelWidth:s,pixelHeight:i,centered:!0});return{minX:n,maxX:n+c,minY:l,maxY:l+u}}({data:t.data,pixelWidth:s.pixelWidth,pixelHeight:i.pixelHeight});s.min=o,s.max=n,i.min=a,i.max=l}(t),function(t){const{amChart:s,data:i}=t;if(r(i)||0===i.lines.length)return void s.series.clear();const o=new Map,n=new Set(s.series.values),a=i.lines.length;for(let r=0;r<a;r++){const l=i.lines[r];let p=t.series.get(l.id);p?(e(p.fill,(t=>n.delete(t))),n.delete(p.line)):(p=bt(t,l),e(p.fill,(t=>s.series.push(t))),s.series.push(p.line)),o.set(p.id,p);const c=a-r-1;e(p.fill,(t=>t.zIndex=c)),p.line.zIndex=a+c,jt(t,p,l)}t.series=o;for(const t of n)s.series.removeValue(t)}(t));l&&(t.yAxis.invalidateLabels(),t.xAxis.invalidateLabels());Ct(t)}(j,t))};v="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(i,{timeout:30}):setTimeout(i,30)},zoomOut(){y||(j.yAxis.zoom({start:0,end:1},!1,!0),j.xAxis.zoom({start:0,end:1},!1,!0))}}}function ht({data:t,bounds:e,pixelWidth:s,pixelHeight:i,centered:o}){if(r(t))return e;let{minX:n,maxX:a,minY:l,maxY:p}=e;const c=a-n,m=p-l,u=t.effectiveUnits,d=D(m,u.elevation,u.distance)/i/(c/s);return d>=1?[n,a]=gt([n,a],d,o):[l,p]=gt([l,p],1/d,o),{minX:n,maxX:a,minY:l,maxY:p}}function gt([t,e],s,i){const o=(e-t)*s;if(i){const s=(t+e)/2-o/2;return[s,s+o]}return[t,t+o]}function jt(t,{line:s,fill:i},o){const{theme:r}=t,{am4core:a}=t.amCharts4Index,{r:l,g:p,b:c,a:m}=o.color,u=a.color({r:l,g:p,b:c,a:m}),d=n(o.samples,[]),h=d.length>0;s.stroke=u,s.visible=h,e(i,(t=>{t.visible=h,t.fill=u.lighten(r.seriesFillLighten)}));const g=d.length,j=s.data;if(j.length===g){for(let t=0;t<g;++t)ft(j[t],d[t]);s.invalidateRawData(),e(i,(t=>t.invalidateRawData()))}else s.data=d,e(i,(t=>t.data=d))}function ft(t,e){t.x=e.x,t.y=e.y,t.z=e.z,t.distance=e.distance,t.elevation=e.elevation}function bt(t,e){const{id:s}=e,i=vt(t,`line-${s}`);i.strokeWidth=e.chartStrokeWidth,i.dy=e.chartStrokeOffsetY;let o=null;return e.chartFillEnabled&&(o=vt(t,`fill-${s}`),o.fillOpacity=1),{id:s,line:i,fill:o}}function vt(t,e){const s=new t.amCharts4Index.am4charts.LineSeries;s.id=e,s.showOnInit=!1,s.simplifiedProcessing=!0,s.minDistance=.5,s.excludeFromTotal=!0,s.clickable=!1,s.contextMenuDisabled=!0,s.cursorHoverEnabled=!1,s.cursorTooltipEnabled=!1,s.connect=!1,s.fill=null,s.stroke=null;s.dataFields.valueX="distance";return s.dataFields.valueY="elevation",s}function yt(t,e){const{amChart:s,xAxis:i,yAxis:o}=t;let n=!1;const a=()=>{const{data:e}=t;if(!n||r(e)||!e.uniformScaling)return;n=!1;const{minX:a,maxX:l,minY:p,maxY:c}=ht({data:t.data,bounds:{minX:i.minZoomed,maxX:i.maxZoomed,minY:o.minZoomed,maxY:o.maxZoomed},pixelWidth:i.pixelWidth,pixelHeight:o.pixelHeight,centered:!0});i.zoomToValues(a,l,!0),o.zoomToValues(p,c,!0),s.validate(),Ct(t)},l=()=>{e(t.xAxis.zoomFactor,t.yAxis.zoomFactor)},p=e=>{t.zooming=e,Ct(t)},c=[s.events.on("down",(()=>p(!0))),s.events.on("up",(()=>p(!1))),s.cursor.events.on("zoomended",(()=>{n=!0})),i.events.on("startendchanged",a),o.events.on("startendchanged",a),i.events.on("rangechangeended",l),o.events.on("rangechangeended",l)];return $((()=>{c.forEach((t=>t.dispose()))}))}function kt({xAxis:t,yAxis:e}){const s=t=>()=>{t.renderer.grid.each((t=>{t.visible="none"!==t.dataItem.label.dom.getAttribute("display")}))},i=[t.events.on("rangechangeended",s(t)),t.events.on("validated",s(t)),e.events.on("rangechangeended",s(e)),e.events.on("validated",s(e))];return $((()=>{i.forEach((t=>t.dispose()))}))}function _t(t,e){const{amChart:s,xAxis:i,yAxis:o}=t,{cursor:r,events:n}=s,a=e=>{t.pointerIsOver=e,Ct(t)},l=()=>{a(!1),e(null,null)},p=[r.events.on("cursorpositionchanged",(()=>{if(!t.pointerIsOver)return;Ct(t);const s=i.toAxisPosition(r.xPosition),n=o.toAxisPosition(r.yPosition);e(s,n)})),n.on("over",(()=>a(!0))),n.on("out",l),n.on("blur",l)];return $((()=>{p.forEach((t=>t.dispose()))}))}function Ct(t){const{amChart:i,xAxis:o,data:n,theme:a,zooming:c,pointerIsOver:m}=t;if(t.amChart.tooltip.hide(),t.xAxis.hideTooltip(),!m)return;if(c)return;if(r(n)||!n.refined)return;const u=function(t){const{amChart:i,yAxis:o,data:n}=t;if(r(n))return null;const a=n.lines.map((s=>({line:s,y:e(wt(t,s),(t=>t.elevation))}))).sort(xt),c=a.length?a[0].y:null;if(r(c))return null;const m=i.cursor,u=o.measuredHeight,d=u+i.pixelPaddingTop;return{text:a.map((({y:e,line:i})=>function(t,e,i){const{data:o,messages:n}=t;if(r(o)||r(n))return"";const a=M(n.chartTooltip,{name:ot(e,n),elevation:s(i)?E(n,i,o.effectiveUnits.elevation,l):p});return`[${e.color.toHex()}]●[/] ${a}`}(t,i,e))).join("\n"),x:m.point.x+m.parent.pixelX+i.pixelPaddingLeft,y:d-o.valueToPosition(c)*u}}(t);if(s(u)){const{cursor:e,tooltip:n}=i;e.show(0),e.validate(),n.text=u.text,n.show(0),n.validate();const p=u.y-n.contentHeight-a.seriesTooltipSpacing;n.pointerOrientation=p<30?"up":"down",n.pointTo(u,!0),n.validate();const c=o.tooltip;c.text=function(t){const{data:e,messages:i}=t;if(r(e)||r(i))return"";const o=e.lines[0],n=o?wt(t,o):null;return s(n)?E(i,n.distance,e.effectiveUnits.distance,l):"-"}(t),c.show(0),c.validate()}}function xt({y:t},{y:e}){return r(t)?1:r(e)?-1:e-t}function St(t,e){const s=t.xAxis.numberFormatter.clone();return s.format=(s,i,o)=>{const{messages:n,data:a}=t;if(r(n)||r(a)||"string"==typeof s)return"";return`${G(s,{maximumFractionDigits:o})} ${U(n,a.effectiveUnits[e],"abbr")}`},s}function wt({amChart:t,xAxis:e},s){const i=n(s.samples,[]);if(0===i.length)return null;const o=e.toAxisPosition(t.cursor.xPosition),r=e.positionToValue(o);return O(i,r,(t=>t.distance))}const Pt=[{type:"select"},{type:"sketch"}],Mt={none:null,"no-valid-input":"noProfile","no-visible-profiles":"noProfile","refined-but-no-chart-data":"noProfile","too-complex":"tooComplex","unknown-error":"unknown","invalid-geometry":"invalidGeometry","invalid-elevation-info":"invalidElevationInfo"};let Lt=class extends x{constructor(t,e){super(t,e),this.viewModel=null,this.view=null,this.input=null,this.profiles=null,this.unitOptions=[],this.unit="metric",this.geodesicDistanceThreshold=1e5,this.visibleElements=new st,this.iconClass=Y.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._resizeObserver=null,this._portrait=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=u(((t,e,s,i)=>({chart:t,data:e,stationary:s,messages:i}))),this._getDetailsPropsMemoized=u(((t,e)=>({effectiveUnits:t,profiles:e}))),null!=t&&t.viewModel||(this._defaultViewModel=new S({view:null==t?void 0:t.view}),this.viewModel=this._defaultViewModel)}initialize(){this._legend=new nt(this._legendProps),this._settingsButton=new at(this._settingsButtonProps),this.own([this.watch("_legendProps",(t=>this._legend.set(t))),this.watch("_settingsButtonProps",(t=>this._settingsButton.set(t)))])}postInitialize(){this.own([v(this,"_chartContainer",(()=>{this._destroyChart();const t=this._chartContainer;r(t)||(this._chartInitTask=b((e=>this._initializeChart(t,e))))})),v(this,"_chartUpdateParams",(()=>this._updateChart(this._chartUpdateParams)))])}destroy(){this._destroyChart(),s(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._legend=i(this._legend),this._settingsButton=i(this._settingsButton),s(this._resizeObserver)&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,!s(t)||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _legendProps(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}get _profilesArray(){return this.profiles.toArray()}get _settingsButtonProps(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}render(){const{viewModel:t,visible:e}=this;return F("div",{key:this,class:this.classes({[Y.base]:e,[Y.esriWidget]:e,[Y.esriWidgetDisabled]:e&&"disabled"===t.state,[Y.portrait]:this._portrait,[Y.refined]:1===this.viewModel.progress}),bind:this,afterCreate:this._onAfterCreate,"aria-label":this.messages.widgetLabel},e&&this._renderContentForState())}_renderContentForState(){switch(this.viewModel.state){case d.Ready:return this._renderContentForReadyState();case d.Selecting:return this._renderContentForSelectingState();case d.Creating:return this._renderContentForCreatingState();case d.Selected:return this._renderContentForSelectedState();case d.Created:return this._renderContentForCreatedState();case d.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{sketchButton:t,selectButton:e}=this.visibleElements,s=this.messages;let i;if(t&&e)i=s.readyPrompt;else if(t)i=s.readyPromptCreateOnly;else if(e)i=s.readyPromptSelectOnly;else{var o;i=null==(o=s.errors)?void 0:o.noProfile}return this._renderContent({prompt:i,chart:!1,actions:Pt})}_renderContentForSelectingState(){const t=this.view;if(r(t))return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:"select-cancel"}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(r(t))return null;const s=e.hasVertices?[{type:"sketch-cancel"},{type:"sketch-done",disabled:!e.tool.interaction.canStopCreating}]:[{type:"select"},{type:"sketch",disabled:!0}];if("no-valid-input"===e.errorState){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:s,prompt:e})}const i=this._getErrorMessage();return i?this._renderContent({chart:!1,actions:s,prompt:i}):this._renderContent({chart:!0,actions:s})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Pt,prompt:t}):this._renderContent({chart:!0,actions:Pt})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Pt,prompt:t}):this._renderContent({chart:!0,actions:Pt})}_getErrorMessage(){var t,e;const s=Mt[this.viewModel.errorState];return null==(t=this.messages)||null==(e=t.errors)?void 0:e[s]}_renderContent(t){const e=s(t.prompt)?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),i=s(this.viewModel.input);return[F("header",{key:"header",class:Y.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&i&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),F("div",{class:Y.mainContainer},e),this.visibleElements.legend&&this._legend.render(),this._renderActions(t)]}_renderZoomOutButton(){return F("button",{key:"zoom-out",class:Y.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut})}_onZoomOutButtonClick(){e(this._chart,(t=>t.zoomOut()))}_renderClearButton(){return F("button",{key:"clear-profile",class:Y.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile})}_onClearButtonClick(){this.viewModel.clear()}_renderPrompt(t){return[F("div",{key:"prompt-container",bind:this,class:Y.promptContainer},F("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return[F("div",{key:"empty-chart-container",class:Y.chartContainer})];const t=this._chartIsRefined||this._canRenderChart();if(!t)return[this._renderSpinner({size:"large"}),F("div",{key:"chart-container-empty",class:Y.chartContainer})];const{chartData:e,progress:i}=this.viewModel;return[s(e)&&i>0&&i<1&&this._renderSpinner({size:t?"small":"large"}),F("div",{key:"chart-container",bind:this,class:Y.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]}_renderSpinner(t){return F("div",{key:"spinner",class:this.classes(Y.chartSpinner,{[Y.chartSpinnerSmall]:"small"===t.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})}_onSpinnerAfterCreate(t){requestAnimationFrame((()=>t.classList.add(Y.chartSpinnerVisible)))}_onSpinnerExit(t,e){t.classList.remove(Y.chartSpinnerVisible),setTimeout(e,200)}_canRenderChart(){const t=this.viewModel.chartData;if(r(t))return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:i}of t.lines)e+=s(i)?i.length:0;return t.refined||e<=h}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case"sketch":return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onSketchButtonClick,className:Y.sketchButton,label:this.messages.sketchButtonLabel});case"sketch-cancel":return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:Y.sketchCancelButton,label:this.messagesCommon.cancel});case"sketch-done":return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:Y.sketchDoneButton,label:this.messagesCommon.done});case"select":return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:Y.selectButton,label:this.messages.selectButtonLabel});case"select-cancel":return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:Y.selectCancelButton,label:this.messagesCommon.cancel})}})).filter(Boolean);return e.length?F("footer",{key:"footer",class:Y.footer},e):null}_renderAction({action:t,onClick:e,className:s,label:i}){return F("button",{key:`action-${t.type}`,class:this.classes(Y.actionButton,s,{[Y.buttonDisabled]:t.disabled}),bind:this,disabled:t.disabled,onclick:e},i)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(t){const{data:e,chart:i,messages:o,stationary:n}=t;!r(i)&&!r(o)&&n&&this._canRenderChart()&&(i.update(t),this._chartIsRefined=s(e)&&e.refined)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}async _initializeChart(t,e){this._chart=await dt({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}}),this._updateChart(this._chartUpdateParams)}_destroyChart(){this._chartInitTask=a(this._chartInitTask),this._chart=i(this._chart),this._chartIsRefined=!1}_onAfterCreate(t){const e=()=>{this._portrait=t.getBoundingClientRect().width<g};e(),this._resizeObserver=new C((()=>e())),this._resizeObserver.observe(t)}};t([k({type:S})],Lt.prototype,"viewModel",void 0),t([y("viewModel.view")],Lt.prototype,"view",void 0),t([y("viewModel.input")],Lt.prototype,"input",void 0),t([y("viewModel.profiles")],Lt.prototype,"profiles",void 0),t([y("viewModel.unitOptions")],Lt.prototype,"unitOptions",void 0),t([y("viewModel.unit")],Lt.prototype,"unit",void 0),t([y("viewModel.geodesicDistanceThreshold")],Lt.prototype,"geodesicDistanceThreshold",void 0),t([k({type:st,nonNullable:!0})],Lt.prototype,"visibleElements",void 0),t([k()],Lt.prototype,"iconClass",void 0),t([y("messages.widgetLabel",{overridable:!0})],Lt.prototype,"label",void 0),t([y("viewModel.visible")],Lt.prototype,"visible",void 0),t([k(),B("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Lt.prototype,"messages",void 0),t([k(),B("esri/t9n/common")],Lt.prototype,"messagesCommon",void 0),t([k(),B("esri/core/t9n/Units")],Lt.prototype,"messagesUnits",void 0),t([k()],Lt.prototype,"_chartContainer",void 0),t([k()],Lt.prototype,"_chart",void 0),t([k()],Lt.prototype,"_chartInitTask",void 0),t([k()],Lt.prototype,"_chartIsRefined",void 0),t([k()],Lt.prototype,"_settingsButton",void 0),t([k()],Lt.prototype,"_legend",void 0),t([k()],Lt.prototype,"_portrait",void 0),t([k()],Lt.prototype,"_zoomOutButtonVisible",void 0),t([k()],Lt.prototype,"_chartUpdateParams",null),t([k()],Lt.prototype,"_chartMessages",null),t([k()],Lt.prototype,"_legendProps",null),t([k()],Lt.prototype,"_profilesArray",null),t([k()],Lt.prototype,"_settingsButtonProps",null),Lt=t([_("esri.widgets.ElevationProfile")],Lt);var Et=Lt;export default Et;
