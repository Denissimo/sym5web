/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import s from"../core/Collection.js";import{p as r,o as i}from"../core/promiseUtils.js";import o from"../core/Handles.js";import{init as n,when as a,whenOnce as l,watch as c,on as p}from"../core/watchUtils.js";import{aliasOf as d}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/lang.js";import"../chunks/ensureType.js";import"../chunks/Logger.js";import{property as u}from"../core/accessorSupport/decorators/property.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import m from"./Search.js";import _ from"./Widget.js";import v,{i as g,f as y,a as j,g as S,u as b,t as M}from"./Directions/DirectionsViewModel.js";import k from"../core/Accessor.js";import{g as w}from"../chunks/assets.js";import{i as f,m as T}from"./Search/LocatorSearchSource.js";import D from"./support/DatePicker.js";import{H as C}from"../chunks/Heading.js";import R from"./support/TimePicker.js";import{a as P}from"../chunks/accessibleHandler.js";import{m as U}from"../chunks/messageBundle.js";import{t as I}from"../chunks/jsxFactory.js";import"../chunks/widgetUtils.js";import{S as L}from"../chunks/sortable.esm.js";import{a as x,f as E}from"../chunks/number.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/locale.js";import"../core/Error.js";import"../chunks/Message.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonMap.js";import"../chunks/ArrayPool.js";import"../chunks/Evented.js";import"../chunks/handleUtils.js";import"../core/scheduling.js";import"../chunks/arrayUtils.js";import"../chunks/metadata.js";import"../chunks/deprecate.js";import"./Search/SearchResultRenderer.js";import"./Search/SearchViewModel.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/JSONSupport.js";import"../chunks/write.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../chunks/enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../chunks/Loadable.js";import"../chunks/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/uid.js";import"../smartMapping/symbology/location.js";import"../chunks/symbologyUtils.js";import"../chunks/utils7.js";import"../chunks/basemapUtils.js";import"../Basemap.js";import"../chunks/loadAll.js";import"../chunks/asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/writeUtils.js";import"../chunks/utils11.js";import"../chunks/layerViewUtils.js";import"./Search/LayerSearchSource.js";import"./Search/SearchSource.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/geometryUtils2.js";import"../chunks/scaleUtils.js";import"../chunks/geolocationUtils.js";import"../chunks/trimExtend.js";import"../chunks/utils5.js";import"../rest/support/ProjectParameters.js";import"../rest/support/GeneralizeParameters.js";import"../rest/support/LengthsParameters.js";import"../rest/support/OffsetParameters.js";import"../rest/support/RelationParameters.js";import"../rest/support/TrimExtendParameters.js";import"../chunks/GoTo.js";import"../chunks/vmEvent.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../layers/GraphicsLayer.js";import"../layers/Layer.js";import"../chunks/BlendLayer.js";import"../chunks/ScaleRangeLayer.js";import"../chunks/GraphicsCollection.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../rest/networkService.js";import"../rest/support/TravelMode.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../rest/support/NAMessage.js";import"../rest/support/GPMessage.js";import"../rest/support/RouteResult.js";import"../rest/support/DirectionsFeatureSet.js";import"../rest/support/RouteParameters.js";import"../chunks/commonProperties3.js";import"../tasks/RouteTask.js";import"../rest/route.js";import"../chunks/queryUtils.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../tasks/Task.js";import"../tasks/Locator.js";import"../chunks/suggestLocations.js";import"../rest/support/AddressCandidate.js";import"../chunks/moment.js";import"./support/DatePickerViewModel.js";import"../chunks/MomentElementViewModel.js";import"../chunks/Popover.js";import"./support/TimePickerViewModel.js";let z=class extends k{constructor(){super(...arguments),this.messages=null,this.messagesUnits=null}get primary(){const e=this.get("directionsViewModel.lastRoute.routeResults.0.directions"),t=this.directionsViewModel.impedanceAttribute,s=this.get("directionsViewModel.routeParameters.directionsLengthUnits");return g(t.units)?y(e.totalTime,{unit:t.units.replace("esriNAU","")}):j(this.messages,this.messagesUnits,e.totalLength,{toUnits:s})}get secondary(){const e=this.get("directionsViewModel.lastRoute.routeResults.0.directions"),t=this.get("directionsViewModel.routeParameters.directionsLengthUnits"),{impedanceAttribute:s}=this.directionsViewModel;return g(s.units)?j(this.messages,this.messagesUnits,e.totalLength,{toUnits:t}):y(e.totalTime)}};e([u()],z.prototype,"directionsViewModel",void 0),e([u()],z.prototype,"messages",void 0),e([u()],z.prototype,"messagesUnits",void 0),e([u({readOnly:!0})],z.prototype,"primary",null),e([u({readOnly:!0})],z.prototype,"secondary",null),z=e([h("esri.widgets.Directions.support.CostSummary")],z);var A=z;const F={esriDMTBearLeft:"bear-left",esriDMTBearRight:"bear-right",esriDMTDoorPassage:"walk-through-door",esriDMTElevator:"elevator",esriDMTEndOfFerry:"disembark",esriDMTEscalator:"escalator",esriDMTFerry:"embark",esriDMTForkCenter:"fork-middle",esriDMTForkLeft:"fork-left",esriDMTForkRight:"fork-right",esriDMTHighwayChange:"highway-change",esriDMTHighwayExit:"exit-highway-right",esriDMTHighwayMerge:"merge-on-highway",esriDMTPedestrianRamp:"take-pedestrian-ramp",esriDMTRampLeft:"ramp-left",esriDMTRampRight:"ramp-right",esriDMTRoundabout:"roundabout-left",esriDMTSharpLeft:"sharp-left",esriDMTSharpRight:"sharp-right",esriDMTStairs:"stairs",esriDMTStraight:"straight",esriDMTTurnLeft:"left",esriDMTTurnLeftLeft:"left-left",esriDMTTurnLeftRight:"left-right",esriDMTTurnRight:"right",esriDMTTurnRightLeft:"right-left",esriDMTTurnRightRight:"right-right",esriDMTUnknown:"unknown",esriDMTUTurn:"u-turn-left"};const H="esri-directions esri-widget esri-widget--panel",O="esri-directions__clear-route-button",V="esri-directions__scroller",$="esri-directions__panel-content",B="esri-directions__panel-content--loading",N="esri-directions__panel-content--error",G="esri-directions__panel-content--sign-in",q="esri-directions__loader",K="esri-directions__message",W="esri-directions__travel-modes-select",Q="esri-directions__departure-time",J="esri-directions__departure-time-select",Y="esri-directions__directions-section",X="esri-directions__departure-time-controls",Z="esri-directions__section",ee="esri-directions__summary",te="esri-directions__stop-icon",se="esri-directions__stop-icon--interactive",re="esri-directions__remove-stop",ie="esri-directions__remove-stop-icon",oe="esri-directions__reverse-stops",ne="esri-directions__stop-icon-container",ae="esri-directions__stop-icon-container--last",le="esri-directions__stop-handle",ce="esri-directions__stop-input",pe="esri-directions__stop-options",de="esri-directions__stop-handle-icon",ue="esri-directions__vertical-splitter",he="esri-directions__stop-row",me="esri-directions__stop-row-ghost",_e="esri-directions__stop-row--valid",ve="esri-directions__stops",ge="esri-directions__add-stop",ye="esri-directions__add-stop-text",je="esri-directions__costs",Se="esri-directions__costs-details",be="esri-directions__costs-value",Me="esri-directions__other-costs-total",ke="esri-directions__route-actions",we="esri-directions__maneuvers",fe="esri-directions__maneuver-list",Te="esri-directions__maneuver-section",De="esri-directions__maneuver-section-header",Ce="esri-directions__maneuver-section-header-toggle-button",Re="esri-directions__maneuver-section-title",Pe="esri-directions__maneuver-section--collapsible",Ue="esri-directions__maneuver-section-toggle",Ie="esri-directions__maneuver",Le="esri-directions__maneuver--active",xe="esri-directions__maneuver-costs",Ee="esri-directions__maneuver-costs-container",ze="esri-directions__maneuver-icon",Ae="esri-directions__cost--cumulative",Fe="esri-directions__cost--intermediate",He="esri-directions__horizontal-splitter",Oe="esri-directions__section-splitter",Ve="esri-directions__disclaimer",$e="esri-directions__sign-in-content",Be="esri-directions__sign-in-button",Ne="esri-directions__content-title",Ge="esri-directions__warning-card",qe="esri-directions__warning-header",Ke="esri-directions__warning-heading",We="esri-directions__warning-message",Qe="esri-icon-radio-unchecked",Je="esri-icon-radio-checked",Ye="esri-icon-handle-vertical",Xe="esri-icon-plus",Ze="esri-icon-trash",et="esri-icon-up-down-arrows",tt="esri-icon-down",st="esri-icon-up",rt="esri-icon-notice-triangle",it="esri-icon-directions",ot="esri-widget__anchor",nt="esri-button",at="esri-button--secondary",lt="esri-button--tertiary",ct="esri-widget__content--empty",pt="esri-widget__content-illustration--empty",dt="esri-select",ut="esri-icon-font-fallback-text";let ht=class extends k{constructor(e){super(e),this.maneuvers=[],this.name=null,this.open=!1}};e([u()],ht.prototype,"maneuvers",void 0),e([u()],ht.prototype,"name",void 0),e([u()],ht.prototype,"open",void 0),ht=e([h("esri.widgets.Directions.support.RouteSection")],ht);var mt=ht;let _t=class extends k{constructor(e){super(e),this.routePath=null}get sections(){const e=this.routePath;return e?this._createSections(e):[]}_createSections(e){const t=(e=this._filterDuplicateStops(e)).map(((e,t)=>S(e)?t:-1)).filter((e=>e>-1));return t.map(((s,r)=>{const i=S(e[s]).attributes.Name,o=r===t.length-1?[]:e.slice(t[r]+1,t[r+1]);return new mt({name:i,maneuvers:o,open:0===r})}))}_filterDuplicateStops(e){let t;return e.filter((e=>{const s=S(e),r=s===t;return t=s,!s||!r}))}};e([u()],_t.prototype,"routePath",void 0),e([u({readOnly:!0})],_t.prototype,"sections",null),_t=e([h("esri.widgets.Directions.support.RouteSections")],_t);var vt=_t;const gt="awaiting-view-click-stop";const yt={hour:"numeric",minute:"numeric"},jt={minimumIntegerDigits:2};function St(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",r=Math.abs(Math.floor(t/60)),i=Math.abs(Math.floor(t)%60);return`GMT${s}${E(r,jt)}${E(i,jt)}`}function bt(e){return!(null==e.composedPath||!e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("esri-search__suggestions-list")})))}let Mt=class extends _{constructor(e,t){super(e,t),this._autoStopRemovalDelay=100,this._costSummary=new A,this._departureTime="now",this._datePicker=new D,this._handles=new o,this._newPlaceholderStop=null,this._pointerPressedSearchSuggestionStop=null,this._routeSections=new vt,this._stops=new s([{},{}]),this._stopsToSearches=new Map,this._timePicker=new R,this.apiKey=null,this.goToOverride=null,this.headingLevel=2,this.iconClass=it,this.label=void 0,this.lastRoute=null,this.maxStops=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.routeServiceUrl=void 0,this.routeSymbol=null,this.searchProperties=null,this.stopSymbols=null,this.view=null,this.viewModel=new v,this._setUpDragAndDropStops=e=>{this._sortable=L.create(e,{draggable:`.${_e}`,ghostClass:me,handle:`.${le}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this._stops.forEach((e=>this._acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:r}=s,i=r[t],o=r[e],n=t-e<0;s.insertBefore(i,n?o.nextElementSibling:o);const a=this._stops;a.reorder(a.getItemAt(e),t),this._processStops()}}initialize(){this.own([n(this,"viewModel.lastRoute",(()=>{this._routeSections.routePath=this.get("viewModel.directionLines"),this._activeManeuver=null,this._focusedManeuver=null,this.scheduleRender()})),n(this,"viewModel.selectedTravelMode, viewModel.departureTime",(()=>{this.get("viewModel.stops.length")>1&&this.getDirections()})),a(this,"view",((e,t)=>{if(t&&(this._viewClickHandle=null,this._handles.remove(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this._handles.add([i(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=500)),i(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=100)),t,s],this.view.surface),this._pointerDownUpHandle=t,this._viewClickHandle=s}})),l(this,"routeServiceUrl",(()=>this.viewModel.load())),c(this,"viewModel.stops.length",(e=>{0===e&&(this._stops.toArray().forEach((e=>this._removeStop(e,!0))),this._stops.addMany([{},{}]),this.scheduleRender())}))])}destroy(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((e=>e.destroy())),this._sortable&&this._sortable.destroy()}getDirections(){return null}zoomToRoute(){}render(){return I("div",{class:this.classes(H,V)},this._renderPanelContent())}_renderPanelContent(){const{viewModel:{state:e}}=this,t="initializing"===e,s="error"===e&&!this.viewModel.serviceDescription,r="unauthenticated"===e,i={[B]:t,[N]:s,[G]:r},o=t?"presentation":"group",n=r?this._renderSignIn():s?this._renderMessage(this._getErrorMessage()):t?this._renderLoader():this._renderReadyContent();return I("div",{class:this.classes($,i),role:o},n)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]}_renderSignIn(){return I("div",{key:"sign-in",class:$e},I(C,{class:Ne,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),I(C,{level:this.headingLevel+1},this.messages.signInRequired),I("button",{class:this.classes(nt,at,Be),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}))}_renderTravelModeOptions(){const{travelModes:e}=this.viewModel;if(0===e.length)return null;const{selectedTravelMode:t}=this.viewModel,s=t.name||this.messages.travelMode;return I("select",{"aria-label":s,bind:this,class:this.classes(W,dt),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},e.map((e=>{const s=e.id===t.id;return I("option",{key:e,"data-mode":e,selected:s,value:e.id},e.name)})))}_handleTravelModeChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"]}_renderStopsContainer(){return I("div",{class:Z,key:"esri-directions__stops-container",role:"group"},this._renderStops())}_renderDepartureTimeControls(){const e=this._departureTime,{messages:t}=this,s=t.departureTime;return I("div",{class:Q,key:"esri-directions__departure-time-controls",role:"group"},I("select",{"aria-label":s,bind:this,class:this.classes(J,dt),onchange:this._handleDepartureOptionChange,title:s},I("option",{value:"now",selected:"now"===e},t.leaveNow),I("option",{value:"depart-by",selected:"depart-by"===e},t.departBy),I("option",{value:"unspecified",selected:"unspecified"===e},t.timeUnspecified)),"depart-by"===e?this._renderTimeControls():null)}_renderStops(){const e=this._stops;let s=0;e.forEach((e=>{"none"!==this._acquireSearch(e).activeMenu&&(s+=1)}));const r=e.toArray().map(((r,i)=>{const o=e.length,n=i>1&&!r.result,a={[Qe]:i>=0&&i<o-1,[Je]:i===o-1},l={[ae]:i===o-1},c={[_e]:!n},p=e.getItemAt(o-1),d=p&&p.result,u=e.getItemAt(i+1),h=u&&u.result,m=i===o-1,_=i===o-2,v=2===o&&0===i||o>2&&!m&&!_||o>2&&_&&h||o>2&&m&&!r.result,g=2===o||3===o&&!d||n,y=this._acquireSearch(r),{messages:j}=this,{removeStop:S,reverseStops:b,unlocated:M}=j,k=t(j.stopLabelTemplate,{number:i+1,label:r.result?r.result.name:M}),w=`${this.id}__stop--${i}`,f=!!y.searchTerm&&!!y.selectedResult&&!!r.result&&y.selectedResult===r.result,T={zIndex:"none"!==y.activeMenu?""+s--:""};return I("li",{"aria-label":k,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(he,c),id:w,key:i,"data-stop-index":i,styles:T},I("div",{class:le},I("span",{"aria-hidden":"true",class:this.classes(te,Ye,de,se),onpointerdown:this._handleDragHandlePointerDown}),I("div",{bind:this,"aria-labelledby":w,class:this.classes(ne,l),"data-stop-index":i,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},I("span",{class:this.classes(te,a),tabindex:f?"0":null}))),I("div",{class:ce},y.render()),I("div",{class:pe,role:"group"},I("div",{"aria-label":S,class:re,bind:this,"data-stop-index":i,hidden:g,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:S},I("span",{"aria-hidden":"true",class:this.classes(te,ie,Ze,se)}),I("span",{class:ut},"removeStopTitle")),I("div",{"aria-label":b,class:oe,bind:this,hidden:v,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:b},I("span",{"aria-hidden":"true",class:this.classes(te,et,se)}),I("span",{class:ut},"removeStopTitle"))))})),i=e.every((e=>{const t=this._stopsToSearches.get(e);return e.result&&t.selectedResult===e.result})),o=this._stops.length>=this.maxStops,n=this.messages.addStop,a=e.length>=2&&i&&!o?I("div",{"aria-label":n,bind:this,class:ge,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},I("span",{"aria-hidden":"true",class:this.classes(Xe,te,se)}),I("div",{"aria-hidden":"true",class:ye},n)):null;return I("div",null,I("ol",{class:ve,role:"group",afterCreate:this._setUpDragAndDropStops},r),a)}_handleStopIconClick(e){const t=e.currentTarget["data-stop-index"],s=this._stops.getItemAt(t);s&&s.result&&this._centerAtStop(s)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e.result.feature)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],r=this._stops.getItemAt(s);if(t===r){const e=this._acquireSearch(r);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){this._handles.remove(gt),this.view.cursor=this._previousCursor;if(!e.selectedResult||!t.result||e.selectedResult!==t.result)return"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{if(this.destroyed)return;if(this._viewClickHandle.pause(),"searching"===e.viewModel.state)return void this._pointerDownUpHandle.pause();if(this._pointerPressedSearchSuggestionStop)return;this._removeStop(t);!!t.result&&(t.result=null,this._processStops()),this.scheduleRender()}),this._autoStopRemovalDelay))):(e.search(),void this._pointerDownUpHandle.pause());this._pointerDownUpHandle.pause()}_handleStopInputFocus(e,t){if(this._pointerDownUpHandle.resume(),this._handles.has(gt))return;const{view:s,view:{cursor:r}}=this;this._previousCursor=r,this._handles.add(n(e,"searchTerm",(e=>{s.cursor=0===e.length?"copy":r})),gt),this._activeStop=t}_prepViewClick(){const e=this.get("viewModel.view"),t=r(e,"click",this._handleViewClick.bind(this)),s=r(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=r(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=bt(e)?this._activeStop:null})),t=r(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=bt(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?this._activeStop:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=function(e){return e.results[0].results[0]}(e),r=this._activeStop;r.result=s,r.result.feature.attributes.Name=s.name,t.searchTerm=s.name})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_handleAddStopFocus(){this._addNewPlaceholder()}_addNewPlaceholder(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e={};this._stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){this._stops.reverse(),this._processStops()}_handleRemoveStop(e){const t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops()}_removeStop(e,t=!1){this._stops.length<=2&&!t||(this._disposeSearch(e),this._stops.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);"now"===s.value?(this._departureTime="now",this.viewModel.departureTime="now",this._handles.remove("departure-time-controls")):"depart-by"===s.value?(this._departureTime="depart-by",this._handles.add([n(this._datePicker,"value",(()=>this._updateDepartureTime())),n(this._timePicker,"value",(()=>this._updateDepartureTime()))],"departure-time-controls")):(this._departureTime="unspecified",this.viewModel.departureTime=null)}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes())}_renderTimeControls(){return I("div",{class:X,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return I("div",{class:Oe})}_renderDisclaimer(){const{messages:e}=this,s=`<a class="${ot}" href="http://www.esri.com/legal/software-license" rel="noreferrer" target="_blank">${e.esriTerms}</a>`,r=t(e.disclaimer,{esriTerms:s});return I("div",{class:Ve,innerHTML:r,key:"esri-directions__disclaimer"})}_renderDirectionsContainer(){return I("div",{class:this.classes(Y,Z),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return I("div",{class:q,key:"loader"})}_renderWarningCard(){return I("div",{class:Ge,role:"alert"},I("div",{class:qe},I("span",{class:rt,"aria-hidden":"true"}),I(C,{class:Ke,level:this.headingLevel},this.messagesCommon.warning)),I("div",{class:We},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{lastRoute:e,state:t}=this.viewModel,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():e?I("div",{class:ee,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):I("div",{key:"esri-directions__placeholder",class:ct},this._renderPlaceholder(),I(C,{class:K,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return I("svg",{class:pt,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},I("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))}_renderMessage(e){return I(C,{level:this.headingLevel},e)}_renderRouteActions(){return I("div",{class:ke},I("button",{"aria-label":this.messages.clearRoute,class:this.classes(O,nt,lt),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))}_renderManeuverSections(){const{sections:e}=this._routeSections;return I("div",{class:we,role:"group"},e.map(((t,s)=>{const{open:r}=t;let i;t.maneuvers.length>0&&r&&(i=I("ol",{class:fe},t.maneuvers.map((e=>this._renderManeuver(e)))));const o=e.length>2,n=s===e.length-1,a={[Pe]:o},l={[tt]:!r,[st]:r};let c;if(o&&!n){const e=r?this.messagesCommon.open:this.messagesCommon.close;c=I("header",{class:this.classes(De,Ue),key:"esri-directions__maneuver-section-header"},I("div",{"aria-expanded":r.toString(),"aria-label":e,bind:this,class:Ce,"data-maneuver-section":t,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:e},I(C,{class:Re,level:this.headingLevel},t.name),I("span",{"aria-hidden":"true",class:this.classes(l)})))}else c=I("header",{class:De,key:"esri-directions__maneuver-section-header"},I(C,{class:Re,level:this.headingLevel},t.name));return I("section",{class:this.classes(Te,a)},c,i)})))}_handleSectionToggle(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open}_renderCosts(){const e=this.get("viewModel.directionLines"),s=e[e.length-1],r=new Date(s.attributes.arriveTimeUTC),i=this._costSummary.set({directionsViewModel:this.viewModel,messages:this.messages,messagesUnits:this.messagesUnits}),{messages:o}=this,n=o.zoomToRoute,a=x(r,yt),l=t(o.etaTemplate,{time:`<strong>${a}</strong>`,gmt:`${St(r)}`}),c=o.primaryCosts,p=o.secondaryCosts,d=o.eta;return I("div",{"aria-label":n,bind:this,class:je,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:n},I("div",{class:Se,role:"group"},I("div",{"aria-label":c,class:be,title:c},i.primary),I("div",{class:ue}),I("div",{"aria-label":p,class:Me,title:p},i.secondary)),I("div",{"aria-label":d,innerHTML:l,title:d}))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){const{messages:e}=this,{error:t}=this.viewModel;return"directions-view-model:unable-to-route"===t.name?e.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===t.name?e.errors.unableToLoadServiceMetadata:e.errors.unknownError}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))}_applyLocatorSourceOverrides({allSources:e}){0!==e.length&&e.forEach((e=>{"locator"in e&&e.locator&&(null===e.locationType&&(e.locationType="street"),f(e.locator.url)&&this.apiKey&&null==e.apiKey&&(e.apiKey=this.apiKey,e.locator.url=T))}))}_acquireSearch(e){const t=this.get("viewModel.view");if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new m({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this._handles.add([p(s,"allSources","change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.result=s.selectedResult,e.result.feature.attributes.Name=s.selectedResult.name,this._processStops(),this.scheduleRender()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e)))],s),this._stopsToSearches.set(e,s),s}_disposeSearch(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)}_processStops(){const e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter((e=>!!e.result)).map((e=>e.result.feature))),e.stops.length>1&&e.getDirections()}_renderManeuver(e){let t;const{attributes:s}=e,r=this.get("viewModel.routeParameters.directionsLengthUnits"),{messages:i,messagesUnits:o}=this,n=j(i,o,s.length,{toUnits:r}),a=y(s.time),l=S(e);b(e,this.get("viewModel.routeParameters.startTime"))?t=M(i,s.arriveTimeUTC,s.ETA,"now"===this._departureTime):n&&(t=a?`${n}&nbsp;&middot;&nbsp;${a}`:n);const c=l,p=this._getFormattedManeuverText(e),d=this._getIconPath(s.maneuverType);if(c)return I("li",{class:Ie,key:e},I("header",null,l.attributes.Name));const u=`esri-directions__maneuver-${e.uid}`,h=`esri-directions__cumulative-costs-${e.uid}`,m=`esri-directions__intermediate-costs-${e.uid}`,_={[Le]:this._activeManeuver===e};return I("li",{"aria-labelledby":`${u} ${h} ${m}`,bind:this,class:this.classes(Ie,_),"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},I("img",{alt:"",class:ze,src:d}),I("div",{class:Ee},I("span",{id:u,innerHTML:p}),I("div",{class:xe},I("div",{class:He}),I("div",{id:h,"aria-label":i.cumulativeCosts,class:Ae,innerHTML:"",title:i.cumulativeCosts}),I("div",{id:m,"aria-label":i.intermediateCosts,class:Fe,innerHTML:t,title:i.intermediateCosts}))))}_getIconPath(e){const t=function(e){return F[e]}(e),s=2===window.devicePixelRatio?"@2x":"";return`${w("esri/themes/base/images/maneuvers/")}${t}${s}.png`}_handleManeuverClick(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t,this.viewModel.centerAt(t),this.viewModel.highlightSegment(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlightSegment(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlightSegment(t)}_getFormattedManeuverText(e){const{attributes:{text:t},strings:s}=e;if(!s)return t;let r=t;return s.forEach((e=>{r=r.replace(e.string,`<strong>${e.string}</strong>`)})),r}};e([d("viewModel.apiKey")],Mt.prototype,"apiKey",void 0),e([d("viewModel.goToOverride")],Mt.prototype,"goToOverride",void 0),e([u()],Mt.prototype,"headingLevel",void 0),e([u()],Mt.prototype,"iconClass",void 0),e([u({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Mt.prototype,"label",void 0),e([d("viewModel.lastRoute")],Mt.prototype,"lastRoute",void 0),e([d("viewModel.maxStops")],Mt.prototype,"maxStops",void 0),e([u(),U("esri/widgets/Directions/t9n/Directions")],Mt.prototype,"messages",void 0),e([u(),U("esri/t9n/common")],Mt.prototype,"messagesCommon",void 0),e([u(),U("esri/core/t9n/Units")],Mt.prototype,"messagesUnits",void 0),e([d("viewModel.routeServiceUrl")],Mt.prototype,"routeServiceUrl",void 0),e([d("viewModel.routeSymbol")],Mt.prototype,"routeSymbol",void 0),e([u()],Mt.prototype,"searchProperties",void 0),e([d("viewModel.stopSymbols")],Mt.prototype,"stopSymbols",void 0),e([d("viewModel.view")],Mt.prototype,"view",void 0),e([u({type:v})],Mt.prototype,"viewModel",void 0),e([d("viewModel.getDirections")],Mt.prototype,"getDirections",null),e([d("viewModel.zoomToRoute")],Mt.prototype,"zoomToRoute",null),e([P()],Mt.prototype,"_handleStopIconClick",null),e([P()],Mt.prototype,"_handleClearRouteClick",null),e([P()],Mt.prototype,"_handleReverseStops",null),e([P()],Mt.prototype,"_handleRemoveStop",null),e([P()],Mt.prototype,"_handleSectionToggle",null),e([P()],Mt.prototype,"_handleSummaryInteraction",null),e([P()],Mt.prototype,"_handleManeuverClick",null),Mt=e([h("esri.widgets.Directions")],Mt);var kt=Mt;export default kt;
