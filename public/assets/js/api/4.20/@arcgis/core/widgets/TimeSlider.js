/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../TimeInterval.js";import{e as i}from"../chunks/arrayUtils.js";import s from"../core/Collection.js";import{n as r}from"../chunks/compilerUtils.js";import{o}from"../core/promiseUtils.js";import{i as n,b as a,e as l}from"../core/lang.js";import{t as m}from"../chunks/throttle.js";import{t as u,o as c}from"../chunks/timeUtils.js";import{init as d}from"../core/watchUtils.js";import{aliasOf as p}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import"../chunks/Logger.js";import{property as h}from"../core/accessorSupport/decorators/property.js";import{subclass as v}from"../core/accessorSupport/decorators/subclass.js";import{a as y,c as w}from"../chunks/number.js";import f from"./Slider.js";import j from"./Widget.js";import{a as k}from"../chunks/accessibleHandler.js";import{m as _}from"../chunks/messageBundle.js";import{t as g}from"../chunks/jsxFactory.js";import"../chunks/widgetUtils.js";import b from"./TimeSlider/TimeSliderViewModel.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../core/Error.js";import"../chunks/Message.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/write.js";import"../chunks/jsonMap.js";import"../chunks/Evented.js";import"../chunks/locale.js";import"../intl.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/ResizeObserver.js";import"../chunks/_commonjsHelpers.js";import"./Slider/SliderViewModel.js";import"../chunks/domUtils.js";import"../core/Handles.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../TimeExtent.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../core/HandleOwner.js";import"../chunks/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../layers/support/fieldUtils.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../chunks/enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/Widgets.js";const x="esri-icon-time-clock",T="esri-widget",E="esri-widget--button",S="esri-button--disabled",M="esri-disabled",C="esri-time-slider",F="esri-time-slider--out-of-bounds",U="esri-time-slider__mode--",L="esri-time-slider__layout--",D="esri-time-slider__row",O="esri-time-slider__animation",V="esri-time-slider__animation-button",P="esri-icon-play",N="esri-icon-pause",R="esri-time-slider__time-extent",W="esri-time-slider__time-extent-group",A="esri-time-slider__time-extent-date",z="esri-time-slider__time-extent-time",H="esri-time-slider__time-extent-separator",I="esri-time-slider__min",$="esri-time-slider__min-date",q="esri-time-slider__slider",B="majorTick",G="minorTick",J="esri-time-slider__max",K="esri-time-slider__max-date",Q="esri-time-slider__previous",X="esri-time-slider__previous-button",Y="esri-icon-reverse",Z="esri-time-slider__next",ee="esri-time-slider__next-button",te="esri-icon-forward",ie="esri-time-slider__warning",se="esri-icon-notice-triangle",re="esri-time-slider__warning-text",oe=new s([{minor:new t({value:100,unit:"milliseconds"}),major:new t({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:500,unit:"milliseconds"}),major:new t({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:1,unit:"seconds"}),major:new t({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:2,unit:"seconds"}),major:new t({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:10,unit:"seconds"}),major:new t({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new t({value:15,unit:"seconds"}),major:new t({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"minutes"}),major:new t({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:5,unit:"minutes"}),major:new t({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:15,unit:"minutes"}),major:new t({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"hours"}),major:new t({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new t({value:6,unit:"hours"}),major:new t({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new t({value:1,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"long"}},{minor:new t({value:2,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:3,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:4,unit:"days"}),major:new t({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new t({value:1,unit:"weeks"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"months"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"months"}),major:new t({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"years"}),major:new t({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"years"}),major:new t({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:5,unit:"decades"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1,unit:"centuries"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:2,unit:"centuries"}),major:new t({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:5,unit:"centuries"}),major:new t({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:10,unit:"centuries"}),major:new t({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:20,unit:"centuries"}),major:new t({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:50,unit:"centuries"}),major:new t({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:100,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:200,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:500,unit:"centuries"}),major:new t({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1e3,unit:"centuries"}),major:new t({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let ne=class extends j{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new f({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1}),this._tickFormat=null,this.disabled=!1,this.effectiveStops=null,this.fullTimeExtent=null,this.iconClass=x,this.label=void 0,this.labelFormatFunction=null,this.loop=!1,this.messages=null,this.messagesCommon=null,this.mode="time-window",this.playRate=1e3,this.stops={count:10},this.tickConfigs=null,this.timeExtent=null,this.timeVisible=!1,this.values=null,this.view=null,this.viewModel=new b}initialize(){this.own([this._slider.watch("values",(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);n(this.timeExtent)?n(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:n(t)&&(this.timeExtent=t)})),o(window,"resize",m((()=>this.scheduleRender()),100)),d(this,"effectiveStops",(()=>this._updateSliderSteps()))])}destroy(){this._slider.destroy(),this._tickFormat=null}get interactive(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}set layout(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}next(){}play(){}previous(){}stop(){return null}render(){const{_slider:e,domNode:t,effectiveStops:s,fullTimeExtent:r,interactive:o,messagesCommon:m,mode:u,tickConfigs:c,timeExtent:d,timeVisible:p,viewModel:{state:h,timeExtentValues:v}}=this;if(n(r)){const{start:t,end:i}=r;if(n(t)&&n(i)){const s=t.getTime(),r=i.getTime(),o=e.min!==s||e.max!==r;if(o&&(e.min=s,e.max=r),n(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{var w;const t=(r-s)/((null==(w=e.trackElement)?void 0:w.offsetWidth)||400),i=oe.find((e=>e.minor.toMilliseconds()>3*t)),n=this._tickFormat!==i&&null!=i;if(n&&(this._tickFormat=i),o||n){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(G)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(B)},labelFormatFunction:e=>y(e,i.format)};e.tickConfigs=[t,s]}}}}const f=a(this.fullTimeExtent)||a(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||n(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||n(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(f)switch(this._ignoreNextSliderUpdate=!0,u){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else n(v)?i(e.values,v)||(e.values=v):e.values=null;e.disabled=!o;const j="ready"===h,k="playing"===h,_=f||!o||a(s)||0===s.length,b="auto"===this.layout?t.clientWidth<858?"compact":"wide":this.layout,x=g("div",{class:O},g("button",{"aria-disabled":_?"true":"false","aria-label":k?m.control.stop:m.control.play,bind:this,class:this.classes(E,V,_&&S),disabled:_,title:k?m.control.stop:m.control.play,onclick:this._playOrStopClick,type:"button"},g("div",{class:this.classes((j||_)&&P,k&&N)}))),ne=n(this.labelFormatFunction)?g("div",{key:"extent",bind:this,class:A,"data-type":"extent","data-layout":b,"data-date":l(d,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):a(d)||n(d)&&d.isAllTime?[g("div",{class:this.classes(ie,se)}),g("div",{key:"warning-text",class:re},this.messages.noTimeExtent)]:d.isEmpty?[g("div",{class:this.classes(ie,se)}),g("div",{key:"warning-text",class:re},this.messages.emptyTimeExtent)]:[n(d.start)&&g("div",{key:"start-date-group",class:W},g("div",{key:"start-date",class:A},this._formatDate(d.start)),p&&g("div",{key:"start-time",class:z},this._formatTime(d.start))),n(d.start)&&n(d.end)&&d.start.getTime()!==d.end.getTime()&&g("div",{key:"separator",class:H},"–"),n(d.end)&&(a(d.start)||d.start.getTime()!==d.end.getTime())&&g("div",{key:"end-date-group",class:W},g("div",{key:"end-date",class:A},this._formatDate(d.end)),p&&g("div",{key:"end-time",class:z},this._formatTime(d.end)))],ae=g("div",{class:this.classes(R,!o&&S)},[ne]),le=n(this.labelFormatFunction)?g("div",{key:"min-date",bind:this,class:$,"data-date":l(r,(e=>e.start)),"data-type":"min","data-layout":b,afterCreate:this._createLabel,afterUpdate:this._createLabel}):n(r)&&n(r.start)&&[g("div",{key:"min-date",class:$},this._formatDate(r.start)),p&&g("div",{key:"min-time"},this._formatTime(r.start))],me=g("div",{class:this.classes(I,!o&&S)},[le]),ue=g("div",{class:q},e.render()),ce=n(this.labelFormatFunction)?g("div",{key:"max-date",bind:this,class:K,"data-date":l(r,(e=>e.end)),"data-type":"max","data-layout":b,afterCreate:this._createLabel,afterUpdate:this._createLabel}):n(r)&&n(r.end)&&[g("div",{key:"max-date",class:K},this._formatDate(r.end)),p&&g("div",{key:"max-time"},this._formatTime(r.end))],de=g("div",{class:this.classes(J,!o&&S)},[ce]),pe=g("div",{class:Q},g("button",{"aria-disabled":_?"true":"false","aria-label":m.pagination.previous,bind:this,class:this.classes(E,X,(k||_)&&S),disabled:_,title:m.pagination.previous,onclick:this._previousClick,type:"button"},g("div",{class:Y}))),he=g("div",{class:Z},g("button",{"aria-disabled":_?"true":"false","aria-label":m.pagination.next,bind:this,class:this.classes(E,ee,(k||_)&&S),disabled:_,title:m.pagination.next,onclick:this._nextClick,type:"button"},g("div",{class:te})));return g("div",{class:this.classes(C,T,`${U}${u}`,`${L}${b}`,!o&&M,f&&F)},"wide"===b&&g("div",{class:D},[x,ae,me,ue,de,pe,he]),"compact"===b&&[g("div",{key:"time-slider-row-1",class:D},[ae]),g("div",{key:"time-slider-row-2",class:D},[ue]),g("div",{key:"time-slider-row-3",class:D},[me,pe,x,he,de])])}updateWebDocument(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)}_createLabel(e){if(a(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(a(t)||a(t.start)||a(t.end))return[];const{start:i,end:s}=t,r=[],{value:o,unit:n}=e;let l=u(i,n);for(;l.getTime()<=s.getTime();)l.getTime()>=i.getTime()&&r.push(l.getTime()),l=c(l,o,n);return r}_formatDate(e){return e?y(e,w("short-date")):null}_formatTime(e){return e?y(e,w("long-time")):null}_updateSliderSteps(){this._slider.steps=n(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:r(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([h()],ne.prototype,"disabled",void 0),e([p("viewModel.effectiveStops")],ne.prototype,"effectiveStops",void 0),e([p("viewModel.fullTimeExtent")],ne.prototype,"fullTimeExtent",void 0),e([h()],ne.prototype,"iconClass",void 0),e([h({readOnly:!0})],ne.prototype,"interactive",null),e([h({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ne.prototype,"label",void 0),e([h()],ne.prototype,"labelFormatFunction",void 0),e([h({value:"auto"})],ne.prototype,"layout",null),e([p("viewModel.loop")],ne.prototype,"loop",void 0),e([h(),_("esri/widgets/TimeSlider/t9n/TimeSlider")],ne.prototype,"messages",void 0),e([h(),_("esri/t9n/common")],ne.prototype,"messagesCommon",void 0),e([p("viewModel.mode")],ne.prototype,"mode",void 0),e([p("viewModel.playRate")],ne.prototype,"playRate",void 0),e([p("viewModel.stops")],ne.prototype,"stops",void 0),e([h()],ne.prototype,"tickConfigs",void 0),e([p("viewModel.timeExtent")],ne.prototype,"timeExtent",void 0),e([h({nonNullable:!0})],ne.prototype,"timeVisible",void 0),e([p("viewModel.values")],ne.prototype,"values",void 0),e([p("viewModel.view")],ne.prototype,"view",void 0),e([h({type:b})],ne.prototype,"viewModel",void 0),e([p("viewModel.next")],ne.prototype,"next",null),e([p("viewModel.play")],ne.prototype,"play",null),e([p("viewModel.previous")],ne.prototype,"previous",null),e([p("viewModel.stop")],ne.prototype,"stop",null),e([k()],ne.prototype,"_playOrStopClick",null),e([k()],ne.prototype,"_previousClick",null),e([k()],ne.prototype,"_nextClick",null),ne=e([v("esri.widgets.TimeSlider")],ne);var ae=ne;export default ae;
