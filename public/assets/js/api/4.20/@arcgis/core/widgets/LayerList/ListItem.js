/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../core/Accessor.js";import i from"../../core/Collection.js";import{HandleOwnerMixin as s}from"../../core/HandleOwner.js";import{I as r}from"../../chunks/Identifiable.js";import{init as o,watch as l}from"../../core/watchUtils.js";import{aliasOf as n}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/lang.js";import{cast as a}from"../../core/accessorSupport/decorators/cast.js";import"../../chunks/Logger.js";import{property as p}from"../../core/accessorSupport/decorators/property.js";import{subclass as h}from"../../core/accessorSupport/decorators/subclass.js";import c from"../../support/actions/ActionBase.js";import d from"../../support/actions/ActionButton.js";import{A as u}from"../../chunks/ActionSlider.js";import m from"../../support/actions/ActionToggle.js";import y from"./ListItemPanel.js";import{i as j,a as v,b as g,c as w,g as f}from"../../chunks/layerListUtils.js";import"../../chunks/deprecate.js";import"../../chunks/metadata.js";import"../../chunks/handleUtils.js";import"../../chunks/ArrayPool.js";import"../../chunks/arrayUtils.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../chunks/Message.js";import"../../chunks/object.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/ensureType.js";import"../../chunks/Evented.js";import"../../core/Handles.js";import"../Widget.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../chunks/Promise.js";import"../../chunks/uuid.js";import"../../chunks/projector.js";import"../../chunks/widgetUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../support/widget.js";import"../../chunks/accessibleHandler.js";import"../../chunks/messageBundle.js";import"../../chunks/vmEvent.js";import"../../chunks/jsxFactory.js";var k;const b=i.ofType({key:"type",defaultKeyValue:"button",base:c,typeMap:{button:d,toggle:m,slider:u}}),_=i.ofType(b);let L=k=class extends(r(s(e))){constructor(t){super(t),this.actionsSections=new _,this.actionsOpen=!1,this.children=new(i.ofType(k)),this.childrenSortable=!0,this.error=null,this.layer=null,this.layerView=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null,this.visible=null}initialize(){this.handles.add([o(this,"layer",(t=>this._watchLayerProperties(t))),o(this,"view",(t=>this._updateChildren(t))),o(this,"panel",(t=>this._setListItemOnPanel(t))),o(this,["layer","view"],(()=>this._getLayerView()))])}destroy(){this.view=null}castPanel(t){return this.get("panel.open")&&!t.hasOwnProperty("open")&&(t.open=!0),t?new y(t):null}get title(){const t=this.get("layer.layer");return(!t||t&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(t){void 0!==t?this._override("title",t):this._clearOverride("title")}get updating(){const t=this.layerView;return t?t.updating:this._isLayerUpdating(this.layer)}get visibleAtCurrentScale(){return!j(this.layer,this.get("view.scale"))}get visibilityMode(){return v(this.layer)}clone(){return new k({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,children:this.children.clone(),layer:this.layer,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildren(t){const e=this.children;e&&e.forEach((e=>e.view=t))}_addChildren(t){if(this.handles.remove("child-list-mode"),this.children.removeAll(),!t)return;t.forEach((e=>{this.handles.add(l(e,"listMode",(()=>this._addChildren(t))),"child-list-mode")}));const e=t.filter((t=>"hide"!==g(t)));this.children.addMany(this._makeChildren(e))}_watchSublayerChanges(t){t&&this.handles.add(t.on("change",(()=>{this._addChildren(t)})),"layer")}_initializeChildLayers(t){this._addChildren(t),this._watchSublayerChanges(t)}_makeChildren(t){return t.map((t=>w(t)?new k({layer:t,parent:this,view:this.view}):null)).reverse()}_watchLayerProperties(t){if(!this.handles)return;if(this.handles.remove("layer"),this.handles.remove("child-list-mode"),!t)return;this.handles.add(l(t,"listMode",(()=>this._watchLayerProperties(t))),"layer");if("hide-children"===g(t))return void this.children.removeAll();const e=f(t);e&&this.handles.add(o(t,e,(()=>{t.hasOwnProperty(e)&&this._initializeChildLayers(t[e])})),"layer")}async _getLayerView(){const{layer:t,view:e}=this;if(t&&e)try{const i=await e.whenLayerView(t);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}_isLayerUpdating(t){return t&&"loading"===t.loadStatus}};t([p({type:_})],L.prototype,"actionsSections",void 0),t([p()],L.prototype,"actionsOpen",void 0),t([p({type:i})],L.prototype,"children",void 0),t([p()],L.prototype,"childrenSortable",void 0),t([n("layer.loadError?")],L.prototype,"error",void 0),t([p()],L.prototype,"layer",void 0),t([p({readOnly:!0})],L.prototype,"layerView",void 0),t([p()],L.prototype,"open",void 0),t([p({type:y})],L.prototype,"panel",void 0),t([a("panel")],L.prototype,"castPanel",null),t([p()],L.prototype,"parent",void 0),t([p()],L.prototype,"sortable",void 0),t([p()],L.prototype,"title",null),t([p({readOnly:!0})],L.prototype,"updating",null),t([p({value:null})],L.prototype,"view",void 0),t([n("layer.visible")],L.prototype,"visible",void 0),t([p({readOnly:!0})],L.prototype,"visibleAtCurrentScale",null),t([p({readOnly:!0})],L.prototype,"visibilityMode",null),L=k=t([h("esri.widgets.LayerList.ListItem")],L);var S=L;export default S;
