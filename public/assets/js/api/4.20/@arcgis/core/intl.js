/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{f as t,a as e}from"./chunks/number.js";export{c as convertDateFormatToIntlOptions,b as convertNumberFormatToIntlOptions,a as formatDate,f as formatNumber}from"./chunks/number.js";import{L as n}from"./chunks/Logger.js";import{g as r}from"./chunks/object.js";import{r as i}from"./chunks/string.js";import{g as u,b as l}from"./chunks/locale.js";export{g as getLocale,o as onLocaleChange,p as prefersRTL,s as setLocale}from"./chunks/locale.js";import h from"./core/Error.js";import{createDeferred as d}from"./core/promiseUtils.js";import m from"./request.js";import{i as w,g as j}from"./core/lang.js";import{g as k}from"./chunks/assets.js";import"./chunks/jsonMap.js";import"./config.js";import"./chunks/Message.js";import"./kernel.js";import"./core/urlUtils.js";const _=n.getLogger("esri.intl");function L(n,s,o={}){const{format:a={}}=o;return i(n,(n=>function(n,s,o){let i,a;const c=n.indexOf(":");-1===c?i=n.trim():(i=n.slice(0,c).trim(),a=n.slice(c+1).trim());if(!i)return"";const u=r(i,s);if(null==u)return"";const l=o[a]||o[i];if(l)return function(n,r){switch(r.type){case"date":return e(n,r.intlOptions);case"number":return t(n,r.intlOptions);default:return _.warn("missing format descriptor for key {key}"),y(n)}}(u,l);if(a)return function(n,r){switch(r.toLowerCase()){case"dateformat":return e(n);case"numberformat":return t(n);default:return _.warn(`inline format is unsupported since 4.12: ${r}`),/^(dateformat|datestring)/i.test(r)?e(n):/^numberformat/i.test(r)?t(n):y(n)}}(u,a);return y(u)}(n,s,a)))}function y(n){switch(typeof n){case"string":return n;case"number":return t(n);case"boolean":return""+n;default:return n instanceof Date?e(n):""}}const $=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,x={ar:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function U(t){var e;return null!=(e=x[t])&&e}const v=[],R=new Map;function B(t){for(const e of R.keys())T(t.pattern,e)&&R.delete(e)}function A(t){return v.includes(t)||(B(t),v.unshift(t)),{remove(){const e=v.indexOf(t);e>-1&&(v.splice(e,1),B(t))}}}async function O(t){const e=u();R.has(t)||R.set(t,async function(t,e){const n=[];for(const r of v)if(T(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(t){n.push(t)}if(n.length)throw new h("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:n});throw new h("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}(t,e));const n=R.get(t);return await z.add(n),n}function M(t){if(!$.test(t))return null;const[,e,n]=$.exec(t),r=e+(n?"-"+n.toUpperCase():"");return U(r)?r:U(e)?e:null}function T(t,e){return"string"==typeof t?e.startsWith(t):t.test(e)}l((()=>{R.clear()}));const z=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=d())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}};async function N(t){if(w(F.fetchBundleAsset))return F.fetchBundleAsset(t);const e=await m(t,{responseType:"text"});return JSON.parse(e.data)}class C{constructor({base:t="",pattern:e,location:n=new URL(window.location.href)}){let r;r="string"==typeof n?t=>new URL(t,new URL(n,j.location)).href:n instanceof URL?t=>new URL(t,n).href:n,this.pattern="string"==typeof e?new RegExp(`^${e}`):e,this.getAssetUrl=r,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,e){return async function(t,e,n,r){const s=e.exec(n);if(!s)throw new h("esri-intl:invalid-bundle",`Bundle id "${n}" is not compatible with the pattern "${e}"`);const o=s[1]?`${s[1]}/`:"",i=s[2],a=M(r),c=`${o}${i}.json`,u=a?`${o}${i}_${a}.json`:c;let l;try{l=await N(t(u))}catch(e){if(u===c)throw new h("intl:unknown-bundle",`Bundle "${n}" cannot be loaded`,{error:e});try{l=await N(t(c))}catch(t){throw new h("intl:unknown-bundle",`Bundle "${n}" cannot be loaded`,{error:t})}}return l}(this.getAssetUrl,this.matcher,t,e)}}function E(t){return new C(t)}const F={};A(E({pattern:"esri/",location:k}));export{E as createJSONLoader,O as fetchMessageBundle,M as normalizeMessageBundleLocale,A as registerMessageBundleLoader,L as substitute};
