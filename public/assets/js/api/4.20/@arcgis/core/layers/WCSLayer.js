/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Error.js";import{i as o,u as i}from"../core/lang.js";import{M as s}from"../chunks/MultiOriginJSONSupport.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import"../chunks/Logger.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import l from"./Layer.js";import{C as p}from"../chunks/CustomParametersMixin.js";import{g as m,b as c,a as u,e as d,f as h,i as f,h as g,B as y,I as b}from"../chunks/xmlUtilities.js";import{O as v}from"../chunks/OperationalLayer.js";import{P as j}from"../chunks/PortalLayer.js";import{R as x}from"../chunks/RefreshableLayer.js";import{S as w}from"../chunks/ScaleRangeLayer.js";import{p as C}from"../chunks/commonProperties2.js";import S from"./support/Field.js";import"../geometry.js";import{isAbortError as I}from"../core/promiseUtils.js";import k from"./support/DimensionalDefinition.js";import{c as D}from"../chunks/wmsUtils.js";import L from"../geometry/Extent.js";import R from"../geometry/Polygon.js";import O from"./support/RasterInfo.js";import{k as T}from"../chunks/pixelUtils.js";import{createPopupTemplate as P}from"../support/popupUtils.js";import"../chunks/Message.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/ArrayPool.js";import"../chunks/arrayUtils.js";import"../core/scheduling.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/write.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/Evented.js";import"../chunks/Identifiable.js";import"../chunks/Loadable.js";import"../chunks/Promise.js";import"../geometry/SpatialReference.js";import"../chunks/JSONSupport.js";import"../chunks/writer.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Multipoint.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/zmUtils.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/jsonMap.js";import"../geometry/support/jsonUtils.js";import"../rasterRenderers.js";import"../renderers/ClassBreaksRenderer.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"./support/fieldUtils.js";import"../chunks/domains.js";import"./support/CodedValueDomain.js";import"./support/Domain.js";import"./support/InheritedDomain.js";import"./support/RangeDomain.js";import"../chunks/arcadeOnDemand.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../core/Collection.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../intl.js";import"../chunks/number.js";import"../chunks/locale.js";import"../chunks/assets.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/uid.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../renderers/support/ClassBreakInfo.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../chunks/commonProperties.js";import"../renderers/RasterColormapRenderer.js";import"../renderers/support/ColormapInfo.js";import"../chunks/colorRampUtils.js";import"../chunks/colorUtils2.js";import"../renderers/RasterShadedReliefRenderer.js";import"../renderers/RasterStretchRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/devEnvironmentUtils.js";import"../renderers/VectorFieldRenderer.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/vectorFieldUtils.js";import"./support/PixelBlock.js";import"../chunks/utils2.js";import"../chunks/asyncUtils.js";import"../chunks/ItemCache.js";import"../chunks/MemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils3.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/RasterJobHandler.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"./support/TileInfo.js";import"../chunks/aaBoundingRect.js";import"./support/LOD.js";import"../chunks/rasterRendererHelper.js";import"../chunks/generateRendererUtils.js";import"../chunks/RasterSymbolizer.js";import"../chunks/LercCodec.js";import"../chunks/RawBlockCache.js";import"../chunks/rasterProjectionHelper.js";import"../geometry/projection.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/fieldType.js";function M(e){const t=function(e){var t,o;const i=null==(t=e.getHeader("Content-Type"))?void 0:t.split(";");if(!(null!=(o=null==i?void 0:i[0].trim())?o:"").startsWith("multipart/"))return null;const s={boundary:"",start:"",type:""};for(let e=1;e<i.length;e++){const t=i[e].split("="),o=t[1].trim();s[t[0].trim()]=o.startsWith('"')?o.slice(1,t[1].length-1):o}return s}(e);if(!t)return{isMultipart:!1,data:null};return{isMultipart:!0,data:t.boundary?function(e,t,o=0){const i="--"+t.boundary,s=[];for(let e=0;e<i.length;e++)s.push(i.charCodeAt(e));const r=[],n="\n--"+t.boundary+"--";for(let e=0;e<n.length;e++)r.push(n.charCodeAt(e));const a=[10],l=[13,10],p=[],m=s.length,c=new Uint8Array(e,o),u=Math.min(5e4,c.length-m);let d=0,h=0;for(let e=0;e<u;e++){for(h=0;h<m&&c[e+h]===s[h];h++);h===m&&(d&&p.push(E(c.subarray(d,e),t)),e+=m-1,c[e+1]===a[0]?e+=1:c[e+1]===l[0]&&c[e+2]===l[1]&&(e+=2),d=e+1)}const f=r.length;for(let e=c.length-f-10;e<c.length-f;e++){for(h=0;h<f&&c[e+h]===r[h];h++);if(h===f){p.push(E(c.subarray(d,e),t));break}}return p}(e.data,t,0):null}}function E(e,t){const o=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),i=Math.min(o.length,7),s={contentDisposition:"inline"};let r=0;for(let a=0;a<i;a++){var n;if(o[a].length<4)r=r+o[a].length+1;else if("content"===o[a].slice(0,7).toLowerCase()){if(r=r+o[a].length+1,-1===o[a].indexOf(":"))continue;const e=o[a].substring(0,o[a].indexOf(":")).trim(),t=o[a].substring(o[a].indexOf(":")+1).trim();switch(e.toLowerCase()){case"content-type":s.contentType=t;break;case"content-description":s.contentDescription=t;break;case"content-transfer-encoding":s.contentTransferEncoding=t;break;case"content-id":s.contentID=t;break;case"content-disposition":s.contentDisposition=t;break;case"content-location":s.contentLocation=t}}else{if(s.contentDisposition.toLowerCase().indexOf("inline")>-1&&o[a].length>=4&&(null==(n=s.contentType)?void 0:n.toLowerCase().indexOf("image"))>-1){let t=!0;if(s.contentType.toLowerCase().indexOf("tif")>0&&(t=73===e[r]&&73===e[r+1]||77===e[r]&&77===e[r+1]),t){const t=new ArrayBuffer(e.length-r);new Uint8Array(t).set(e.subarray(r,e.length)),s.contentData=t}break}if((""===t.start||s.contentID===t.start)&&s.contentType){if(s.contentType.indexOf("text")>-1||s.contentType.indexOf("xml")>-1){s.contentData=String.fromCharCode.apply(null,e.subarray(r,e.length));break}s.contentData=e.subarray(r,e.length)}}}return s}function U(e){return e.indexOf("?")===e.length-1?e.substring(0,e.length-1):e}function A(e){const t={};for(let o=0;o<e.childNodes.length;o++){const i=e.childNodes[o];if(1!==i.nodeType)continue;const s=g(i).toLowerCase();switch(s){case"title":case"abstract":t[s]=m(i);break;case"identifier":t.id=m(i);break;case"wgs84boundingbox":{const e=d(i,"LowerCorner"),o=d(i,"UpperCorner");t.lonLatEnvelope=new L({xmin:e[0],ymin:e[1],xmax:o[0],ymax:o[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(A(i))}}return t}function F(e,t){if(e.coverageSummaries)for(let o=0;o<e.coverageSummaries.length;o++)e.coverageSummaries[o].abstract=e.coverageSummaries[o].abstract||e.abstract,e.coverageSummaries[o].lonLatEnvelope=e.coverageSummaries[o].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[o].title=e.coverageSummaries[o].title||e.title,F(e.coverageSummaries[o],t);null!=e.id&&t.push(e)}function $(e){const t=c(e.querySelector("Operation[name=GetCapabilities]"),"Get").getAttribute("xlink:href")||"",o=c(e.querySelector("Operation[name=DescribeCoverage]"),"Get").getAttribute("xlink:href")||"",i=c(e.querySelector("Operation[name=GetCoverage]"),"Get").getAttribute("xlink:href")||"";return{getCapabilities:U(t),describeCoverage:U(o),getCoverage:U(i)}}function V(e,o=null){let i=null;if("string"==typeof e){i=(new DOMParser).parseFromString(e,"text/xml")}else i=e;const s=i.documentElement.getAttribute("version"),r=(s||o||"1.0.0").slice(0,3);let n;if("2.0"===r)n=function(e){const t=c(e,"ServiceIdentification"),o=m(t,"Title"),i=h(t,"ServiceTypeVersion"),s=h(t,"Profile"),r=$(c(e,"OperationsMetadata")),n=u(e,"Contents/CoverageSummary"),a=[];for(let e=0;e<n.length;e++){const t=n[e],o=m(t,"CoverageId"),i=c(t,"WGS84BoundingBox");let s;if(i){const e=d(i,"LowerCorner"),t=d(i,"UpperCorner");s=new L({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}a.push({id:o,lonLatEnvelope:s})}const l=c(e,"ServiceMetadata");return{name:o,supportedVersions:i,supportedFormats:h(l,"formatSupported"),supportedInterpolations:h(l,"interpolationSupported"),onlineResources:r,profiles:s,coverages:a}}(i);else if("1.1"===r)n=function(e){const t=m(e,"ServiceIdentification/Title"),o=h(e,"ServiceIdentification/ServiceTypeVersion"),i=$(c(e,"OperationsMetadata")),s=[],r=c(e,"Contents");for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];1===t.nodeType&&f(t,"CoverageSummary")&&F(A(t),s)}return{name:t,onlineResources:i,coverages:s,supportedVersions:o,supportedFormats:h(r,"SupportedFormat")}}(i);else{if("1.0"!==r)throw new t("wcsraster:parsecapabilities","the capabilities version is not supported");n=function(e){var t,o,i;const s=m(e,"Service/name"),r=c(e,"Capability"),n=null!=(t=c(r,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"))?t:"",a=null!=(o=c(r,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"))?o:"",l=null!=(i=c(r,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"))?i:"",p={getCapabilities:U(n),describeCoverage:U(a),getCoverage:U(l)},h=u(e,"CoverageOfferingBrief"),f=[];for(let e=0;e<h.length;e++){const t=h[e],o=m(t,"name"),i=u(t,"pos"),s=d(i[0]),r=d(i[1]),n=new L({xmin:s[0],ymin:s[1],xmax:r[0],ymax:r[1],spatialReference:{wkid:4326}});f.push({id:o,lonLatEnvelope:n})}return{name:s,onlineResources:p,coverages:f,supportedVersions:["1.0.0"]}}(i)}return n.capabilitiesVersion=s,n}function G(e,t){const o=h(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),i="1.0.0"===t?e.getAttribute("default"):m(e,"InterpolationMethods/Default");return null!=i?[i].concat(o.filter((e=>e.toLowerCase()!==i.toLowerCase()))):o}function N(e){return null==e?["nearest"]:e.map((e=>{const t=e.toLowerCase();return t.indexOf("nearest")>-1?"nearest":t.indexOf("linear")>-1?"bilinear":t.indexOf("cubic")>-1?"cubic":null})).filter((e=>!!e))}function B(e){const t=u(e,"pos"),o=d(t[0]),i=d(t[1]);return new L({xmin:o[0],ymin:o[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}function _(e){const t=[],o=u(e,"RangeSet");let i=[];for(let e=0;e<o.length;e++){const s=m(o[e],"name"),r=m(o[e],"label"),n=[],a=u(o[e],"AxisDescription");for(let e=0;e<a.length;e++){const t=m(a[e],"name"),o=m(a[e],"label"),s=h(a[e],"singleValue");if(0===s.length){const t=m(a[e],"min"),o=m(a[e],"max"),i=Number(m(a[e],"res"))||1;if(null!==t&&null!==o)for(let e=parseInt(t,10);e<=parseInt(o,10);e+=i)s.push(e.toString())}"band"===t.toLowerCase()&&(i=s),n.push({name:t,label:o,values:s})}t.push({name:s,label:r,axis:n})}return{rangeSet:t,bandNames:i}}function q(e){const t=u(e,"timeposition");if(t.length>0){const e=[];for(let o=0;o<t.length;o++)e.push(new Date(m(t[o])));return{begin:e[0],end:e[e.length-1],values:e}}const o=c(e,"timePeriod")||c(e,"TimePeriod");if(o){return{begin:new Date(m(o,"beginPosition")||m(o,"BeginPosition")),end:new Date(m(o,"endPosition")||m(o,"EndPosition")),...function(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const o=["Y","M","D"],i=["H","M","S"],s=["Years","Months","Days","Hours","Minutes","Seconds"];let r,n,a;return-1===t.indexOf("PT")?(t=t.slice(1),a=o.findIndex((e=>t.indexOf(e)>-1)),a>-1&&(r=s[a]),n=parseFloat(t.substring(0,t.length-1))):(t=t.slice(2),a=i.findIndex((e=>t.indexOf(e)>-1)),r=s[3+a],n=parseFloat(t.substring(0,t.length-1))),{resolution:n,units:r}}(m(o,"timeResolution")||m(o,"TimeResolution"))}}return null}function W(e){const t=c(e,"spatialDomain"),o=c(t,"Envelope")||c(t,"EnvelopeWithTimePeriod"),i=o.getAttribute("srsName").split(":"),s=i[i.length-1],r=u(o,"pos"),n=d(r[0]),a=d(r[1]),l=parseInt(s,10),p=isNaN(l)?null:{wkid:l},h=new L({xmin:n[0],ymin:n[1],xmax:a[0],ymax:a[1],spatialReference:p}),f=c(t,"RectifiedGrid"),g=m(f,"low").split(" "),y=m(f,"high").split(" "),b=parseInt(y[0],10)-parseInt(g[0],10)+1,v=parseInt(y[1],10)-parseInt(g[1],10)+1,j=d(t,"origin/pos"),x=u(t,"offsetVector"),w={envelope:h,columns:b,rows:v,offset:{x:parseFloat(m(x[0]).split(" ")[0]),y:parseFloat(m(x[1]).split(" ")[1])},origin:{x:j[0],y:j[1]}},C=c(e,"temporalDomain")||c(e,"TemporalDomain");return{spatialDomain:w,temporalDomain:C?q(C):null}}function z(e){const t=[],o=u(e,"Field");let i=[];for(let e=0;e<o.length;e++){const s=m(o[e],"Identifier"),r=m(o[e],"Description"),n=m(o[e],"Definition"),a=m(o[e],"Abstract"),l=m(o[e],"Title"),p=G(o[e],"1.1.0"),c=[],d=u(o[e],"Axis");for(let e=0;e<d.length;e++){const t=d[e].getAttribute("identifier"),o=m(d[e],"UOM"),s=m(d[e],"DataType"),r=h(d[e],"Key");"band"===t.toLowerCase()&&(i=r),c.push({identifier:t,uom:o,dataType:s,values:r})}t.push({identifier:s,description:r,definition:n,abstract:a,title:l,supportedInterpolations:p,axis:c})}return{rangeSet:t,bandNames:i}}function H(e){var t;const o=c(e,"SpatialDomain"),i=c(o,"GridCRS"),s=m(i,"GridBaseCRS"),r=m(i,"GridOrigin"),n=null!=(t=null==r?void 0:r.split(" ").map((e=>parseFloat(e))))?t:[0,0],a=d(i,"GridOffsets"),l=u(o,"BoundingBox");let p,h,f,g;for(let e=0;e<l.length;e++){var y;const t=null==(y=l[e].getAttribute("crs"))?void 0:y.toLowerCase();if(null!=t)if(t.indexOf("imagecrs")>-1){const t=d(l[e],"LowerCorner"),o=d(l[e],"UpperCorner");p=o[0]-t[0]+1,h=o[1]-t[1]+1}else if(t.indexOf("epsg")>0){const o=t.split(":");f=parseInt(o[o.length-1],10);const i=d(l[e],"LowerCorner"),s=d(l[e],"UpperCorner");g=new L({xmin:i[0],ymin:i[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:f}})}}const b=p>h,v=g.xmax-g.xmin>g.ymax-g.ymin;let j=!1;D(f)&&(b===v?j=!1:(j=!0,g=new L({xmin:g.ymin,ymin:g.xmin,xmax:g.ymax,ymax:g.xmax,spatialReference:{wkid:f}})));const x={columns:p,rows:h,origin:{x:n[0],y:n[1]},offset:{x:a[0],y:a[1]},gridBaseCRS:s,envelope:g,useEPSGAxis:j},w=c(e,"temporalDomain")||c(e,"TemporalDomain");return{spatialDomain:x,temporalDomain:w?q(w):null}}function J(e,t){const o=[],i=[],s={supportedFormats:o,supportedCRSs:i,version:"1.1"};let r;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if(1!==n.nodeType)continue;const a=g(n).toLowerCase();switch(a){case"title":case"abstract":case"identifier":s[a]=m(n);break;case"supportedformat":{const e=m(n);-1===o.indexOf(e)&&o.push(e)}break;case"supportedcrs":{const e=m(n);-1===i.indexOf(e)&&i.push(e)}break;case"range":{const e=z(n);s.range=e.rangeSet,r=e.bandNames}break;case"domain":s.domain=H(n)}}const n=N(s.range[0].supportedInterpolations),{identifier:a,abstract:l,title:p,domain:c,range:u}=s,d={x:Math.abs(c.spatialDomain.offset.x),y:Math.abs(c.spatialDomain.offset.y)},h=function(e,t){const o=e.filter((e=>-1===e.identifier.toLowerCase().indexOf("field_1")&&!e.axis.some((e=>"band"===e.identifier.toLowerCase())))),i=[];if(o.length&&o.forEach((e=>{var t,o;const s=e.axis.map((e=>{const t=e.values.map((t=>"ISO8601"===e.uom?-1===(t=t.trim()).toLowerCase().indexOf("z")?new Date(t+"Z").getTime():new Date(t).getTime():parseFloat(t.trim()))),o=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:o}}));i.push({name:e.identifier.trim(),description:null!=(t=null==(o=e.description)?void 0:o.trim())?t:"",unit:"",dimensions:s})})),t.temporalDomain){const{begin:e,end:o,values:s,units:r,resolution:n}=t.temporalDomain;i.some((e=>e.dimensions.some((e=>"stdtime"===e.name.toLowerCase()))))||i.forEach((t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null==s?void 0:s.map((e=>e.getTime())),hasRegularIntervals:!s,interval:n,intervalUnit:r,extent:[e.getTime(),o.getTime()]})}))}return i.length?{variables:i}:null}(u,c),f=new O({width:c.spatialDomain.columns,height:c.spatialDomain.rows,pixelSize:d,extent:c.spatialDomain.envelope,spatialReference:c.spatialDomain.envelope.spatialReference,bandCount:r.length||1,multidimensionalInfo:h});return{id:a,title:s.title,description:l||p,lonLatEnvelope:null,bandNames:r,rasterInfo:f,supportedFormats:o,supportedInterpolations:n,coverageDescription:s,version:t,useEPSGAxis:c.spatialDomain.useEPSGAxis}}function Y(e){const t=c(e,"Envelope")||c(e,"EnvelopeWithTimePeriod"),o=t.getAttribute("srsName"),i=o.slice(o.lastIndexOf("/")+1),s=t.getAttribute("axisLabels").split(" ").map((e=>e.trim())).filter((e=>""!==e.trim())),r=d(t,"lowerCorner"),n=d(t,"upperCorner"),a=!["y","lat","latitude","north","nor","n","b"].some((e=>e===s[0].toLowerCase()));let l;const p=parseInt(i,10),u=isNaN(p)?null:{wkid:p};l=new L(a?{xmin:r[0],ymin:r[1],xmax:n[0],ymax:n[1],spatialReference:u}:{xmin:r[1],ymin:r[0],xmax:n[1],ymax:n[0],spatialReference:u});const h={mins:r,maxs:n},g=t.getAttribute("uomLabels").trim().split(" ");let y,b;return f(t,"EnvelopeWithTimePeriod")&&(y=new Date(m(e,"beginPosition")||m(e,"BeginPosition")),b=new Date(m(e,"endPosition")||m(e,"EndPosition"))),{envelope:l,axisLabels:s,uomLabels:g.length?g:null,envelopeAllDims:h,beginPosition:y,endPosition:b,isEastFirst:a}}function Q(e){const t=[],o=u(e,"DataRecord"),i=[];for(let e=0;e<o.length;e++){const r=u(o[e],"field"),n=[];for(let e=0;e<r.length;e++){var s;const t=r[e].getAttribute("name"),o=m(r[e],"description")||"",a=(null==(s=c(r[e],"uom"))?void 0:s.getAttribute("code"))||"",l=d(r[e],"interval");t.toLowerCase().indexOf("band")>-1&&i.push(t),n.push({name:t,description:o,uom:a,allowedValues:l})}t.push(n)}return{rangeType:t,bandNames:i}}function K(e){let t=1,o="";const i=.01;return Math.abs(e-1/24)<1/24*i?o="Hours":Math.abs(e-1)<.01?o="Days":e<1?(t=Math.round(24*e),o="Hours"):e>27.99&&e<31.01||Math.round(e/30)<12?o="Months":e>364.99&&e<366.01&&(o="Years"),{interval:t,intervalUnit:o}}function Z(e,t){const o=c(e,"RectifiedGrid"),i=d(o,"low"),s=d(o,"high"),r=[];for(let e=0;e<i.length;e++)r.push(s[e]-i[e]+1);const n=m(o,"axisLabels").split(" "),a=d(o,"origin/pos"),l=u(o,"offsetVector"),p=[];for(let e=0;e<l.length;e++){const t=d(l[e]),o=t.findIndex((e=>0!==e));p[o]=t[o]}const h=t||n;let f,g,y;return["y","lat","latitude","north","nor","n","b"].some((e=>e===h[0].toLowerCase()))?(f=r[1],g=r[0],y={y:Math.abs(p[0]),x:Math.abs(p[1])}):(f=r[0],g=r[1],y={x:Math.abs(p[0]),y:Math.abs(p[1])}),{columns:f,rows:g,origin:a,offset:p,resolution:y,gridSamples:r,axisLabels:n}}function X(e){const t=c(e,"EarthObservation");if(!t)return null;const o=c(t,"phenomenonTime"),i=o?q(o):null,s=c(t,"phenomenonTime"),r=s?q(s):null,n=m(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let a=null;if(n){const e=n.split(" ").map((e=>e.trim())).filter((e=>null!=e&&""!==e));if(e.length){const t=[];for(let o=0;o<e.length/2;o+=2)t.push(e[o],e[o+1]);a=new R({rings:[t],spatialReference:{wkid:4326}})}}return{observation:{phonomenonTime:i,resultTime:r,footprint:a,identifier:m(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:m(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:m(e,"metaDataProperty/EarthObservationMetaData/status")}}}function ee(e){const t={version:"2.0"};let o=[];for(let s=0;s<e.childNodes.length;s++){const r=e.childNodes[s];if(1===r.nodeType)if(f(r,"coverageId"))t.coverageId=m(r);else if(f(r,"ServiceParameters"))t.serviceParameters={supportedFormats:h(r,"nativeFormat")};else if(f(r,"boundedBy"))t.boundedBy=Y(r);else if(f(r,"rangeType")){const e=Q(r);t.rangeType=e.rangeType,o=e.bandNames}else if(f(r,"domainSet")){var i;t.domainSet=Z(r,null==(i=t.boundedBy)?void 0:i.axisLabels)}else if(f(r,"metadata")){const e=c(r,"EOMetadata");t.eoMetadata=e?X(e):null}}const{coverageId:s,boundedBy:r,domainSet:n,rangeType:a,serviceParameters:l}=t,p=function(e,t,o){const i=[];for(let t=0;t<e.length;t++){const o=e[t];for(let e=0;e<o.length;e++)-1===o[e].name.toLowerCase().indexOf("band")&&i.push(o[e])}const s=[];if(i.length){const e=[];for(let i=2;i<o.axisLabels.length;i++){const s=(t.uomLabels&&t.uomLabels.length)>i?t.uomLabels[i]:"",r=o.axisLabels[i].toLowerCase().indexOf("time")>-1||"iso8601"===s.toLowerCase()||"oledatetime"===s.toLowerCase();let n,a;if(r){const e=K(o.offset[i]);n=e.interval,a=e.intervalUnit}else n=o.offset[i],a=s;const l=[];r?(l.push((new Date).setTime(24*(t.envelopeAllDims.mins[i]-25569)*3600*1e3)),l.push((new Date).setTime(24*(t.envelopeAllDims.maxs[i]-25569)*3600*1e3))):(l.push(t.envelopeAllDims.mins[i]),l.push(t.envelopeAllDims.maxs[i])),e.push({name:o.axisLabels[i].trim(),description:o.axisLabels[i].trim(),unit:t.uomLabels&&t.uomLabels.length>i?t.uomLabels[i].trim():"",hasRegularIntervals:!0,extent:l,interval:n,intervalUnit:a})}if(i.forEach((t=>{var o,i;return s.push({name:t.name.trim(),description:null!=(o=null==(i=t.description)?void 0:i.trim())?o:"",unit:t.uom.trim(),dimensions:e})})),s.length)return{variables:s}}return null}(a,r,n);return{id:s,title:s,description:s,lonLatEnvelope:null,bandNames:o,rasterInfo:new O({width:n.columns,height:n.rows,pixelSize:n.resolution,extent:r.envelope,spatialReference:r.envelope.spatialReference,bandCount:o.length||1,multidimensionalInfo:p}),supportedFormats:l.supportedFormats,supportedInterpolations:null,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}function te(e,t){let o=null;if("string"==typeof e){o=(new DOMParser).parseFromString(e,"text/xml")}else o=e;if("1.0.0"===t){return u(o,"CoverageOffering").map((e=>function(e){const t={version:"1.0"};let o=[];for(let s=0;s<e.childNodes.length;s++){const r=e.childNodes[s];if(1===r.nodeType)if(f(r,"description"))t.description=m(r);else if(f(r,"name"))t.name=m(r);else if(f(r,"label"))t.label=m(r);else if(f(r,"supportedFormats"))t.supportedFormats=h(r,"formats");else if(f(r,"supportedCRSs"))t.supportedCRSs={requestResponseCRSs:h(i=r,"requestResponseCRSs").map((e=>e.split(":")[1])),nativeCRSs:h(i,"nativeCRSs").map((e=>e.split(":")[1]))};else if(f(r,"supportedInterpolations"))t.supportedInterpolations=G(r,"1.0.0");else if(f(r,"lonLatEnvelope"))t.lonLatEnvelope=B(r);else if(f(r,"rangeSet")){const e=_(r);t.rangeSet=e.rangeSet,o=e.bandNames}else f(r,"domainSet")&&(t.domainSet=W(r))}var i;const s=N(t.supportedInterpolations),{name:r,description:n,label:a,lonLatEnvelope:l,supportedFormats:p}=t,{spatialDomain:c}=t.domainSet,u={x:Math.abs(c.offset.x),y:Math.abs(c.offset.y)},d=new O({width:c.columns,height:c.rows,pixelSize:u,extent:c.envelope,spatialReference:c.envelope.spatialReference,bandCount:o.length||1});return{id:r,title:t.name,description:n||a,lonLatEnvelope:l,rasterInfo:d,bandNames:o,supportedFormats:p,supportedInterpolations:s,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}(e)))}const i=u(o,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?i.map((e=>J(e,t))):i.map((e=>ee(e)))}const oe=["nearest neighbor","bilinear","bicubic"],ie=["nearest","linear","cubic"];let se=class extends y{constructor(){super(...arguments),this.datasetFormat="WCSServer"}async open(e){await this.init();const o=null==e?void 0:e.signal,i=await this._getCapabilities(o);if(this.capabilities=i,!this.version){var s;let e=null==(s=i.capabilitiesVersion)?void 0:s.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=i.capabilitiesVersion:(e=i.supportedVersions.find((e=>"2.0.1"===e))||i.supportedVersions.find((e=>"2.0"===e.slice(0,3)))||i.supportedVersions.find((e=>"1.1"===e.slice(0,3)))||i.supportedVersions.find((e=>"1.0"===e.slice(0,3)))||"1.0.0",this.version=e)}null==this.coverageId&&(this.coverageId=i.coverages[0].id);const r=i.coverages.filter((e=>e.id===this.coverageId))[0];if(null==r)throw new t("wcsraster-open",`the coverageId ${this.coverageId} does not exist in capabilities`);const n=await this._describeCoverage(o);this.coverageInfo=n[0],"2.0"===this.version.slice(0,3)&&(this.coverageInfo.lonLatEnvelope=r.lonLatEnvelope,this.coverageInfo.supportedInterpolations=N(i.supportedInterpolations)),this.datasetName=this.coverageInfo.title;const{rasterInfo:a}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(a,512,512),this._set("rasterInfo",a),null==a.spatialReference)throw new t("wcsraster-open",`coverage without spatial referernce is not supported: ${this.coverageId}`);const{pixelType:l,bandCount:p}=await this._getPixelTypeAndBandCount(o);a.pixelType=l,1===a.bandCount&&p>1&&(a.bandCount=p),this.updateTileInfo()}async fetchRawTile(e,o,i,s={}){if(this.isBlockOutside(e,o,i))return null;const{nativePixelSize:r,spatialReference:n}=this.rasterInfo,a=2**e,l=r.x*a,p=r.y*a,{blockWidth:m,blockHeight:c}=this.getBlockWidthHeight(e),{origin:u}=this.rasterInfo.storageInfo.tileInfo,d=this.getTileExtent({x:l,y:p},o,i,u,n,[m,c]),h=this.rasterInfo.extent,f=d.xmax>h.xmax||d.ymin<h.ymin;let g=d,y=m,b=c;if(f&&(g=d.clone().intersection(h),y=Math.floor((g.xmax-g.xmin)/l),b=Math.floor((g.ymax-g.ymin)/p),g.xmax=g.xmin+l*y,g.ymin=g.ymax-p*b),y<=1||b<=1)return null;const v=await this._getCoverage(g,y,b,a,s);if(!v)return null;let j=await this.decodePixelBlock(v,{width:y,height:b,planes:null,pixelType:null});if(j&&(j.width!==y||j.height!==b))throw new t("wcsraster-fetch",`the reponse has unexpected dimension width: ${j.width}, height: {pixelBlock.height}`);return f&&(j=T(j,{x:0,y:0},{width:c,height:c})),j}async _getCapabilities(e){const o={service:"WCS",request:"GetCapabilities"};this.version&&(o.version=this.version,o.acceptVersions=this.version);try{const{data:t}=await this.request(this.url,{query:o,responseType:"xml",signal:e});return V(t)}catch(e){if(!I(e))throw new t("wcslayer:open","wcs capabilities is not valid or supported");throw e}}async _describeCoverage(e){const o={service:"WCS",request:"DescribeCoverage",version:this.version},i=this.version.slice(0,3);"1.0"===i?o.coverage=this.coverageId:"1.1"===i?o.identifiers=this.coverageId:"2.0"===i&&(o.coverageId=this.coverageId);try{const{data:t}=await this.request(this.url,{query:o,responseType:"xml",signal:e});return te(t,this.version)}catch(e){if(!I(e))throw new t("wcslayer:open","wcs coverage description is not valid or supported");throw e}}async _getPixelTypeAndBandCount(e){const{pixelSize:s,extent:r,multidimensionalInfo:n}=this.rasterInfo,a=r.center,l=new L({xmin:a.x-s.x,xmax:a.x+s.x,ymin:a.y-s.y,ymax:a.y+s.y,spatialReference:r.spatialReference});let p;if(o(n)){const e=n.variables[0];p=[],e.dimensions.forEach((t=>{p.push(new k({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent[0]:t.values[0],isSlice:!0}))}))}const m=await this._getCoverage(l,2,2,1,{multidimensionalDefinition:p,signal:i(e)});if(!m)throw new t("wcsraster-open","unable to determine pixel type");const c=await this.decodePixelBlock(m,{width:2,height:2,planes:null,pixelType:null});return{pixelType:c.pixelType,bandCount:c.getPlaneCount()}}async _getCoverage(e,o,i,s,r){const{coverageDescription:n}=this.coverageInfo,{version:a}=n,l="2.0"===n.version?this._getCoverage201Parameters(e,o,i,s,r,n):"1.1"===n.version?this._getCoverage110Parameters(e,o,i,r,n):this._getCoverage100Parameters(e,o,i,r),p="2.0"===n.version?await this.request(this._constructWCS201Url(l),{signal:r.signal,responseType:"array-buffer"}):await this.request(this.url,{query:l,signal:r.signal,responseType:"array-buffer"});if("1.0"===a)return p.data;const m=M(p);if(m.isMultipart&&m.data){const e=m.data.filter((e=>{var t;return(null==(t=e.contentType)?void 0:t.toLowerCase().includes("image"))&&null!=e.contentData}))[0];return null==e?void 0:e.contentData}if(this.ioConfig.allowAnyMediaType)return p.data;throw new t("wcsraster:getcoverage","response is not a valid coverage, multipart response is expected")}_getInterpolationIndex(e){return-1===this.coverageInfo.supportedInterpolations.indexOf(e)||"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0}_getCoverage100Parameters(e,t,o,i){const s=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,r=e.spatialReference.wkid,n=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"GEOTIFF",{bandIds:a,interpolation:l}=i,p=this._getInterpolationIndex(l),m=a?a.map((e=>this.coverageInfo.bandNames[e])):null,c=oe[p];return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:n,crs:`EPSG:${r}`,bbox:s,width:t,height:o,interpolation:c,band:null==m?void 0:m.join(",")}}_getCoverage110Parameters(e,t,o,i,s){var r;const{multidimensionalDefinition:n,bandIds:a,interpolation:l}=i,p=e.spatialReference.wkid,m=`urn:ogc:def:crs:EPSG::${p}`,c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",u=this._getInterpolationIndex(l),d=ie[u],h=null==l||0===(null==(r=this.coverageInfo.supportedInterpolations)?void 0:r.indexOf(l)),f=s.domain.spatialDomain,g=f.origin.x<=f.envelope.xmin&&f.origin.y<=f.envelope.ymin,y=e.width/t,b=e.height/o*(g?1:-1),v=g?[e.xmin,e.ymin]:[e.xmin,e.ymax],j=f.useEPSGAxis&&D(p),x=j?`${v[1]},${v[0]}`:`${v[0]},${v[1]}`,w=j?`${b},0,0,${y}`:`${y},0,0,${b}`,C=y/2,S=e.xmin+C,I=e.xmax-C,k=Math.abs(b)/2,L=e.ymin+k,R=e.ymax-k,O=j?`${L},${S},${R},${I},${m}`:`${S},${L},${I},${R},${m}`,T=s.range.filter((e=>e.axis.some((e=>e.identifier.toLowerCase().indexOf("band")>-1))))[0];let P,M=T&&d&&a?h?`${T.identifier}[${T.axis[0].identifier}[${a.join(",")}]]`:`${T.identifier}:${d}[${T.axis[0].identifier}[${a.join(",")}]]`:null;if(null!=n&&n.length)for(let e=0;e<n.length;e++){let t=n[e].values;const o=n[e].dimensionName.toLowerCase(),i=n[e].variableName.toLowerCase();if(t.length>0)if(t[0]instanceof Array&&(t=t[0]),"stdtime"===o)P=t.map((e=>this._convertToISOTime(e))).join(",");else{const e=s.range.filter((e=>e.identifier.toLowerCase()===i))[0];if(e){const i=e.axis.filter((e=>e.identifier.toLowerCase()===o))[0];i&&(M=h?e.identifier+"["+i.identifier+"["+t.join(",")+"]]":e.identifier+":"+d+"["+i.identifier+"["+t.join(",")+"]]")}}}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:c,crs:`EPSG:${p}`,boundingbox:O,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:x,gridOffsets:w,gridBaseCRS:m,timeSequence:P,rangeSubset:M}}_convertToISOTime(e,t=!1){return(t?new Date(24*(e-25569)*60*60*1e3):new Date(e)).toISOString()}_getCoverage201Parameters(e,t,o,i,s,r){const{multidimensionalDefinition:n,interpolation:a}=s,l=this._getInterpolationIndex(a);let p=null;const{supportedInterpolations:m}=this.capabilities;if(null!=m&&m.length)switch(l){case 0:p=m.find((e=>e.includes("nearest")));break;case 1:p=m.find((e=>e.includes("linear")));break;case 2:p=m.find((e=>e.includes("cubic")||e.includes("quadratic")))}const c=(this.coverageInfo.supportedFormats||[]).find((e=>e.toLowerCase().indexOf("tiff")>-1))||"image/tiff",{bandNames:u}=this.coverageInfo,{boundedBy:d,domainSet:h,rangeType:f}=r,g=d.isEastFirst?0:1,y=1-g,{axisLabels:b}=d,v=b[g],j=b[y],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,w=x,C=[];C.push(`${v}(${e.xmin},${e.xmax})`),C.push(`${j}(${e.ymin},${e.ymax})`);const S=[];if(b.length>2)for(let e=2;e<b.length;e++){const t=h.origin[e];if(b[e].toLowerCase().indexOf("time")>-1){let o=t.toString();d.uomLabels[e].toLowerCase().indexOf("ole")>-1&&(S.push(b[e]),o=this._convertToISOTime(t,!0)),C.push(b[e]+",http://www.opengis.net("+o+")")}else C.push(b[e]+",http://www.opengis.net("+t+")")}let I=null;if(null!=n&&n.length){const e=[];f.forEach((t=>t.forEach((t=>e.push(t.name)))));const t=[];for(let o=0;o<n.length;o++){const i=b.find((e=>e===n[o].dimensionName)),s=e.find((e=>e===n[o].variableName));if(-1===t.indexOf(s)&&t.push(s),i){let e=n[o].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=i.toLowerCase().indexOf("time")>-1?e.map((e=>this._convertToISOTime(e))).join(","):e.join(",");const o=C.findIndex((e=>0===e.indexOf(i+",http://www.opengis.net")));-1===o&&C.push(i+",http://www.opengis.net("+t+")"),-1!==o&&-1===C[o].indexOf("("+t+")")&&C.splice(o,1,i+",http://www.opengis.net("+t+")")}}}t.length&&(I=t.join(","))}else if(null!=u&&u.length){I=(s.bandIds?s.bandIds.map((e=>u[e])):u).join(",")}const k=C.join("&subset="),D=!(r.domainSet.axisLabels.join("")===r.boundedBy.axisLabels.join(""))&&!1!==this.ioConfig.allowScaleFactor,L=D?null:`${v}(${t}),${j}(${o})`,R=D?1/i:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:I,interpolation:p,scaleSize:L,scaleFactor:R,subset:k,format:c,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:w}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},o=[];Object.keys(t).forEach((e=>{const i=t[e];null!=i&&("subset"===e?i.split("&subset=").forEach((e=>{e&&o.push(`subset=${encodeURIComponent(e)}`)})):o.push(`${e}=${encodeURIComponent(i)}`))}));return`${encodeURI(this.url)}?${o.join("&")}`}};e([n({type:String,json:{write:!0}})],se.prototype,"datasetFormat",void 0),e([n()],se.prototype,"tileType",void 0),e([n({type:String,json:{write:!0}})],se.prototype,"version",void 0),e([n({type:String,json:{write:!0}})],se.prototype,"coverageId",void 0),se=e([a("esri.layers.support.rasterDatasets.ImageServerRaster")],se);var re=se;let ne=class extends(w(x(v(j(p(b(s(l)))))))){constructor(...e){super(...e),this.coverageId=null,this.coverageInfo=null,this.version=null,this.isReference=null,this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=o(e)?e.signal:null;return this.addResolvingPromise(this._openRaster(t)),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[new S({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}createPopupTemplate(e){return P({fields:this.rasterFields,title:this.title},e)}async _openRaster(e){const o=new re({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await o.open({signal:e}),!o.rasterInfo)throw o.destroy(),new t("wcs-layer:load","cannot load resources on "+this.url);null==this.title&&this.setAtOrigin("title",o.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",o.coverageInfo.id,"service"),this.raster=o,this._configDefaultSettings(),this.watch("customParameters",(e=>this.raster.ioConfig.customFetchParameters=e))}};e([n({json:{write:!0}})],ne.prototype,"coverageId",void 0),e([n({readOnly:!0}),r("raster.coverageInfo")],ne.prototype,"coverageInfo",void 0),e([n()],ne.prototype,"version",void 0),e([n()],ne.prototype,"isReference",void 0),e([n({readOnly:!0})],ne.prototype,"type",void 0),e([n(C)],ne.prototype,"popupEnabled",void 0),e([n()],ne.prototype,"popupTemplate",void 0),e([n({readOnly:!0})],ne.prototype,"defaultPopupTemplate",null),e([n({readOnly:!0,type:[S]})],ne.prototype,"fields",void 0),e([n({readOnly:!0,type:[S]})],ne.prototype,"rasterFields",null),ne=e([a("esri.layers.WCSLayer")],ne);var ae=ne;export default ae;
