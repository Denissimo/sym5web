/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
import{g as e,i as t,b as n,r,a as o}from"./lang.js";import i from"./Error.js";import{L as c}from"../chunks/Logger.js";import"../chunks/Message.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";var s,u=(s=e,{setTimeout:(e,t)=>{const n=s.setTimeout(e,t);return{remove:()=>s.clearTimeout(n)}}});function f(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function l(e,t,n){if(!f(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,n);if(Array.isArray(t)){const r=t.slice();for(const t of r)e.addEventListener(t,n);return{remove(){for(const t of r)e.removeEventListener(t,n)}}}return e.addEventListener(t,n),{remove(){e.removeEventListener(t,n)}}}function a(e,t,n){if(!f(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,n);const r=l(e,t,(t=>{r.remove(),n.call(e,t)}));return{remove(){r.remove()}}}function m(e,t,n){let r=!1;const o=l(e,t,(t=>{r||n.call(e,t)}));return{resume(){r=!1},pause(){r=!0},remove(){o.remove()}}}const h={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function p({key:e}){return h[e]||e}function v(e){return Promise.all(e)}function w(e,t){const n=e.slice();return Promise.all(e.map(((e,n)=>t(e,n)))).then((e=>n.filter(((t,n)=>e[n]))))}function b(e){return new Promise(((t,n)=>{try{e(t,n)}catch(e){Promise.resolve().then((()=>n(e)))}}))}function d(e="Aborted"){return new i("AbortError",e)}function g(){return new AbortController}function E(e,t="Aborted"){if(y(e))throw d(t)}function j(e){return t(e)?"aborted"in e?e:e.signal:e}function y(e){const n=j(e);return t(n)&&n.aborted}function T(e){if(D(e))throw e}function A(e){if(!D(e))throw e}function P(e,t){const r=j(e);if(!n(r)){if(!r.aborted)return a(r,"abort",(()=>t()));t()}}function L(e,t){const r=j(e);if(!n(r))return E(r),a(r,"abort",(()=>t(d())))}function k(e,t){const o=j(t);return n(o)?e:new Promise(((n,o)=>{let i=P(t,(()=>o(d())));const c=()=>i=r(i);e.then(c,c),e.then(n,o)}))}function D(e){return e&&"AbortError"===e.name}function M(e){return e.catch((e=>{if(!D(e))throw e}))}function S(e,t=c.getLogger("esri")){return e.catch((e=>{D(e)||t.error(e)}))}function U(){let e=null;const t=new Promise(((t,n)=>{e={promise:void 0,resolve:t,reject:n}}));return e.promise=t,e}function x(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e);return x(t.map((t=>e[t]))).then((e=>{const n={};return t.forEach(((t,r)=>n[t]=e[r])),n}))}const t=e;return b((e=>{const n=[];let r=t.length;0===r&&e(n),t.forEach((t=>{const o={promise:t||Promise.resolve(t)};n.push(o),o.promise.then((e=>{o.value=e})).catch((e=>{o.error=e})).then((()=>{--r,0===r&&e(n)}))}))}))}function C(e){return x(e).then((e=>e.filter((e=>!!e.value)).map((e=>e.value))))}function R(e){return Promise.reject(e)}function O(e){return Promise.resolve(e)}function W(e,t,n){const r=g();return P(n,(()=>r.abort())),new Promise(((n,o)=>{let i=setTimeout((()=>{i=0,n(t)}),e);P(r,(()=>{i&&(clearTimeout(i),o(d()))}))}))}function q(e,t,n,r){const o=n&&"abort"in n?n:null;null!=r||o||(r=n);let c=setTimeout((()=>{c=0,o&&o.abort()}),t);const s=()=>{throw r||new i("promiseUtils:timeout","The wrapped promise did not resolve within "+t+" ms")};return e.then((e=>{if(0===c)throw s();return clearTimeout(c),e}),(e=>{throw clearTimeout(c),0===c?s():e}))}function z(e){return e&&"function"==typeof e.then}function B(e){return F(e)?e:Promise.resolve(e)}function F(e){return e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function G(e,t=-1){let n,r,i,c,s=null;const u=(...f)=>{if(n){r=f,c&&c.reject(d()),c=U();const e=o(c.promise);if(s){const e=s;s=null,e.abort()}return e}if(i=c||U(),c=null,t>0){const r=g();n=B(e(...f,r.signal));const o=n;W(t).then((()=>{n===o&&(c?r.abort():s=r)}))}else n=1,n=B(e(...f));const l=()=>{const e=r;r=i=n=s=null,null!=e&&u(...e)},a=n,m=i;return a.then(l,l),a.then(m.resolve,m.reject),o(m.promise)};return u}function H(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r})),r=t=>{e(t)};return r.resolve=t=>e(t),r.reject=e=>t(e),r.timeout=(e,t)=>u.setTimeout((()=>r.reject(t)),e),r.promise=n,r}function I(e,t){return e.then(t,t)}function J(e){let t=g();const n=e(t.signal);let r={promise:n,finished:!1,abort:()=>{t&&(t.abort(),t=null)}};const o=()=>{r&&(r.finished=!0,r=null),t=null};return n.then(o,o),r}export{W as after,v as all,I as always,u as c,b as create,g as createAbortController,d as createAbortError,U as createDeferred,H as createResolver,J as createTask,G as debounce,p as e,x as eachAlways,C as eachAlwaysValues,w as filter,f as i,M as ignoreAbortErrors,D as isAbortError,y as isAborted,F as isPromise,z as isPromiseLike,S as logOnError,l as o,P as onAbort,L as onAbortOrThrow,m as p,R as reject,O as resolve,T as throwIfAbortError,E as throwIfAborted,A as throwIfNotAbortError,q as timeout,B as when,k as whenOrAbort};
