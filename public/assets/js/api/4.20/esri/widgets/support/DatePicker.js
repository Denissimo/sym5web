// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/events ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/aliasOf ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/trackingUtils ../../intl/moment ../Widget ./datePickerUtils ./DatePickerViewModel ./Popover ./decorators/accessibleHandler ./decorators/messageBundle ./jsxFactory ./widgetUtils ../../intl/date".split(" "),
function(t,k,h,u,F,G,H,S,T,U,p,I,J,K,L,M,y,N,v,O,g,n,l){const q={year:"numeric",month:"2-digit",day:"2-digit"},P=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),Q=F.getLogger("esri.widgets.support.DatePicker");h=function(z){function w(a,c){var b=z.call(this,a,c)||this;b._activeDate=null;b._calendarNode=null;b._calendarPopover=new N({owner:t._assertThisInitialized(b),placement:"bottom-start",anchorElement:()=>b._rootNode,renderContentFunction:b._renderCalendar});
b._inputOrButtonNode=null;b._isOpen=!1;b._requestDayPickerFocusOnCreate=!1;b._rootNode=null;b.dateInputEnabled=!1;b.label=void 0;b.messages=null;b.value=null;b.commitOnMonthChange=!1;b.viewModel=new y;b._toggle=b._toggle.bind(t._assertThisInitialized(b));return b}t._inheritsLoose(w,z);var d=w.prototype;d.initialize=function(){this.own(J.reaction(()=>{var a;return{viewModel:this.viewModel,value:null==(a=this.viewModel)?void 0:a.value}},({viewModel:a,value:c})=>{if(!this.destroyed&&a&&!G.isNone(this.onChange))this.onChange(c)}))};
d.loadLocale=function(){var a=t._asyncToGenerator(function*(){this._moment=yield K.loadMoment();this._isOpen&&(this._activeDate=this._moment(this._activeDate.toDate()))});return function(){return a.apply(this,arguments)}}();d.destroy=function(){this._calendarPopover.destroy()};d.render=function(){return g.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())};
d.renderButtonOnlyMode=function(){const a=l.formatDate(this.viewModel.value,q),{_isOpen:c,messages:b}=this;return g.tsx("div",{afterCreate:n.storeNode,"aria-controls":c?this._getCalendarId():null,"aria-expanded":c.toString(),"aria-haspopup":"true","aria-label":b.setDate,"aria-pressed":c.toString(),bind:this,class:this.classes("esri-widget--button","esri-select","esri-date-picker__calendar-toggle"),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",
tabIndex:0},g.tsx("span",{class:"esri-date-picker__date"},a))};d.renderInputAndButtonMode=function(){const a=l.formatDate(this.viewModel.value,q),{_isOpen:c,messages:b}=this;return g.tsx("div",{class:this.classes("esri-date-picker__input")},g.tsx("input",{afterCreate:n.storeNode,"data-node-ref":"_inputOrButtonNode","aria-controls":c?this._getCalendarId():null,"aria-haspopup":"true","aria-label":b.setDate,bind:this,class:this.classes("esri-date-picker__text-input","esri-input"),key:"date-input",onblur:this._handleDateInputBlur,
onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:a}),g.tsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading","esri-icon-calendar")}))};d._handleDateInputClick=function(){this._open(this.viewModel.value,!1)};d._handleDateInputKeyDown=function(a){const {key:c}=a;this._isOpen?"Enter"===c?this._handleDateText(a):"Escape"===c&&this._close():"ArrowDown"===c&&(this._open(this.viewModel.value),a.preventDefault())};d._handleDateButtonKeyDown=
function(a){const {key:c,shiftKey:b}=a;this._isOpen&&"Tab"===c&&b?this._close():n.isActivationKey(c)&&this._toggle()};d._handleDateInputBlur=function(a){this._isOpen||this._handleDateText(a)};d._handleDateText=function(a){a=a.currentTarget;try{var c=M.parseDateIntoParts(a.value,q)}catch(b){Q.warn(b);a.value=l.formatDate(this.viewModel.value,q);return}c=this._moment(c);c.isValid()?(this.viewModel.value=c.toDate(),this._activeDate=c):a.value=l.formatDate(this.viewModel.value,q)};d._handleDatePickerKeydown=
function(a){"Escape"===u.eventKey(a)&&(this._close(),a.preventDefault(),a.stopPropagation())};d._renderCalendar=function(){const a=this._activeDate,c=this._moment(this.viewModel.value);return g.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(a),this._renderDayPicker(a,c),this._renderYearPicker(a))};
d._getCalendarId=function(){return`date-picker__calendar--${this.id}`};d._renderMonthPicker=function(a){var c=n.isRTL();const b=c?"esri-icon-right":"esri-icon-left";c=c?"esri-icon-left":"esri-icon-right";const f=this._moment.months().map((m,r)=>{r=a.month()===r;return g.tsx("option",{selected:r},m)}),{messages:e}=this;return g.tsx("div",{class:"esri-date-picker__month-picker"},g.tsx("div",{"aria-label":e.goToPreviousMonth,bind:this,class:"esri-widget--button",onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,
role:"button",tabIndex:0,title:e.goToPreviousMonth},g.tsx("span",{"aria-hidden":"true",class:b})),g.tsx("select",{"aria-live":"assertive","aria-label":e.selectMonth,bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:e.selectMonth},f),g.tsx("div",{"aria-label":e.goToNextMonth,bind:this,class:"esri-widget--button",onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:0,
title:e.goToNextMonth},g.tsx("span",{"aria-hidden":"true",class:c})))};d._renderDayPicker=function(a,c){var b=a.clone().day(this._moment.localeData().firstDayOfWeek());b=this._getWeekLabels(b);const f=this._getDayId(a);a=this._renderMonth(a,c);return g.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":f,"aria-labelledby":`${this.id}__month-picker ${this.id}__selected-year`,bind:this,class:"esri-date-picker__day-picker",id:`${this.id}__day-picker`,onkeydown:this._handleDayPickerKeydown,
role:"grid",tabIndex:0},g.tsx("div",{class:"esri-date-picker__week-item",role:"row"},b.map(e=>g.tsx("div",{"aria-label":e.name,class:this.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:e.name},e.abbr))),a)};d._getDayId=function(a){return`${this.id}__${l.formatDate(a.valueOf(),q)}`};d._handleDayPickerCreate=function(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())};d._getWeekLabels=function(a){const c=[],
b={weekday:"long"},f={weekday:"narrow"};for(let e=0;7>e;e++)c.push({name:l.formatDate(a.valueOf(),b),abbr:l.formatDate(a.valueOf(),f)}),a.add(1,"day");return c};d._handleDayPickerKeydown=function(a){const {ctrlKey:c,shiftKey:b}=a,f=u.eventKey(a),e=this._activeDate;-1!==P.indexOf(f)&&("ArrowLeft"===f?e.subtract(1,"day"):"ArrowRight"===f?e.add(1,"day"):"ArrowUp"===f?e.subtract(1,"week"):"ArrowDown"===f?e.add(1,"week"):"PageUp"===f?e.subtract(1,b?"year":"month"):"PageDown"===f?e.add(1,b?"year":"month"):
"Home"===f?e.startOf(c?"year":"month"):"End"===f?e.endOf(c?"year":"month"):n.isActivationKey(f)&&(this.viewModel.value=e.toDate(),this._close()),a.preventDefault(),a.stopPropagation())};d._renderMonth=function(a,c){const b=this._moment(),f=a.clone().startOf("month"),e=a.clone().endOf("month"),m=f.clone().subtract(f.weekday(),"day"),r=[];for(let A=0;6>A;A++){const B=[];for(let C=0;7>C;C++){const D=m.date(),E=m.isSame(a,"day");var x=m.isSame(c,"day");const R=this._getDayId(m);x={["esri-date-picker__day-item--nearby-month"]:!m.isBetween(f,
e,null,"[]"),["esri-date-picker__day-item--today"]:m.isSame(b,"day"),["esri-date-picker__day-item--active"]:E,["esri-date-picker__day-item--selected"]:x};B.push(g.tsx("div",{"aria-label":D.toString(),"aria-selected":E.toString(),bind:this,class:this.classes("esri-date-picker__day-item",x),"data-iso-date":m.toISOString(),id:R,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},D));m.add(1,"day")}r.push(g.tsx("div",{class:"esri-date-picker__week-item",role:"row"},B))}return r};
d._renderYearPicker=function(a){var c={year:"numeric"},b=a.clone();a=l.formatDate(b.valueOf(),c);const f=l.formatDate(b.add(1,"year").valueOf(),c);c=l.formatDate(b.subtract(2,"year").valueOf(),c);({messages:b}=this);return g.tsx("div",{class:"esri-date-picker__year-picker"},g.tsx("div",{"aria-label":b.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:0,title:b.goToPreviousYear},c),g.tsx("div",{class:this.classes("esri-date-picker__year-picker-item",
"esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},a),g.tsx("div",{"aria-label":b.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:0,title:b.goToNextYear},f))};d._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value)};d._setMonth=function(a){this._activeDate.month(a.target.value);this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._close=
function(a=!0){this._activeDate=null;this._isOpen=!1;this._calendarPopover.open=!1;this.pageClickHandler.pause();a&&this._inputOrButtonNode.focus()};d._open=function(a,c=!0){this._activeDate=this._moment(a);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=c;this.pageClickHandler||(this.pageClickHandler=u.pausable(document,"click",({target:b})=>{var f,e;(null==(f=this._calendarNode)?0:f.contains(b))||(null==(e=this._rootNode)?0:e.contains(b))||this._close()}),this.own(this.pageClickHandler));
this.pageClickHandler.resume()};d._setPreviousMonth=function(){this._activeDate.subtract(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._handlePreviousMonthKeyDown=function(a){"Tab"===a.key&&a.shiftKey?(a.preventDefault(),this._close()):n.isActivationKey(a.key)&&this._setPreviousMonth()};d._setNextMonth=function(){this._activeDate.add(1,"month");this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toDate())};d._setPreviousYear=function(){this._activeDate.subtract(1,
"year")};d._setNextYear=function(){this._activeDate.add(1,"year")};d._handleNextYearKeyDown=function(a){"Tab"!==a.key||a.shiftKey?n.isActivationKey(a.key)&&this._setNextYear():(a.preventDefault(),this._close())};d._handleSelectedDate=function(a){this.viewModel.value=this._moment(a.target.getAttribute("data-iso-date")).toDate();this._close()};return w}(L);k.__decorate([p.property()],h.prototype,"dateInputEnabled",void 0);k.__decorate([p.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],
h.prototype,"label",void 0);k.__decorate([p.property(),O.messageBundle("esri/widgets/support/t9n/DatePicker")],h.prototype,"messages",void 0);k.__decorate([H.aliasOf("viewModel.value")],h.prototype,"value",void 0);k.__decorate([p.property()],h.prototype,"commitOnMonthChange",void 0);k.__decorate([p.property({type:y})],h.prototype,"viewModel",void 0);k.__decorate([p.property()],h.prototype,"onChange",void 0);k.__decorate([v.accessibleHandler()],h.prototype,"_setNextMonth",null);k.__decorate([v.accessibleHandler()],
h.prototype,"_setPreviousYear",null);k.__decorate([v.accessibleHandler()],h.prototype,"_handleSelectedDate",null);return h=k.__decorate([I.subclass("esri.widgets.support.DatePicker")],h)});