// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../assets ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../symbols/PictureMarkerSymbol ./geolocationUtils ./GoTo".split(" "),function(n,g,r,t,c,u,v,k,I,J,K,L,w,x,p,y){c=function(q){function m(){var a=q.apply(this,arguments)||
this;a._geolocationUsable=!0;a._iconPath=r.getAssetUrl("esri/images/support/sdk_gps_location.png");a.geolocationOptions=null;a.goToLocationEnabled=!0;a.graphic=new t({symbol:new x({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}n._inheritsLoose(m,q);var f=m.prototype;f.initialize=function(){p.supported()||(this._geolocationUsable=!1)};f.destroy=function(){this._clear();this.view=null};f._clear=function(){this.view&&this.view.graphics.remove(this.graphic)};
f._getScaleWithinConstraints=function(a,b){if(!b)return a;if("2d"===b.type){const {effectiveMaxScale:e,effectiveMinScale:d}=b.constraints;return Math.min(d,Math.max(e,a))}return a};f._getScale=function(a){const {scale:b}=this;return this._getScaleWithinConstraints("number"===typeof b?b:2500,a)};f._getHeading=function(a,b){b=b&&b.spatialReference;a=a.coords&&a.coords.heading;if(!(!b||!b.isWebMercator&&!b.isGeographic||"number"!==typeof a||isNaN(a)||0>a||360<a))return a};f._addHeading=function(a){const {heading:b,
target:e,view:d}=a;d&&"number"===typeof b&&!isNaN(b)&&("3d"===d.type?e.heading=b:"2d"===d.type&&(e.rotation=360-b))};f._animatePoint=function(a,b,e,d){const {view:h}=this;if(!this.goToLocationEnabled||!h)return Promise.resolve(b);const l=this.useHeadingEnabled?this._getHeading(b,h):void 0;a={target:a,scale:e};this._addHeading({heading:l,target:a,view:h});return this.callGoTo({target:a,options:d}).then(()=>b)};f._setPosition=function(){var a=n._asyncToGenerator(function*(b,e){try{const h=yield p.positionToPoint({position:b,
view:this.view},e),{graphic:l}=this;var {timestamp:d}=b;const {coords:z}=b,{accuracy:A,altitude:B,altitudeAccuracy:C,heading:D,latitude:E,longitude:F,speed:G}=z;d={timestamp:d,accuracy:A,altitude:B,altitudeAccuracy:C,heading:D,latitude:E,longitude:F,speed:G};l&&(l.geometry=h,l.attributes=d);const H=this._getScale(this.view);return this._animatePoint(h,b,H,e)}catch(h){throw new u("positioning:invalid-point","Cannot position invalid point",{error:h});}});return function(b,e){return a.apply(this,arguments)}}();
return m}(y.GoToMixin(v.EventedMixin(c)));g.__decorate([k.property()],c.prototype,"_geolocationUsable",void 0);g.__decorate([k.property()],c.prototype,"geolocationOptions",void 0);g.__decorate([k.property()],c.prototype,"goToLocationEnabled",void 0);g.__decorate([k.property()],c.prototype,"graphic",void 0);g.__decorate([k.property()],c.prototype,"scale",void 0);g.__decorate([k.property()],c.prototype,"useHeadingEnabled",void 0);g.__decorate([k.property()],c.prototype,"view",void 0);return c=g.__decorate([w.subclass("esri.widgets.support.GeolocationPositioning")],
c)});