// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../Color ../../../symbols ../../../renderers/support/numberUtils ../../../symbols/support/cimSymbolUtils ../../../symbols/support/utils ./utils".split(" "),function(K,A,w,S,L,r,T,E,U){function V(a,b){const c=a.length-1;return a.map((d,g)=>U.createStopLabel(d,g,c,b))}function F(){F=w._asyncToGenerator(function*(a,b,c,d,g,m){var k,f,h=b.legendOptions;h=h&&h.customValues;const l=W(a,c);var e=null!=b.minSize&&null!=b.maxSize;c=b.stops&&
1<b.stops.length;var n=!!b.target;if(l&&(h||e||c&&!n)){var q=E.isVolumetricSymbol(l),u=null,x=e=null;e=q&&!c?r.round([b.minDataValue,b.maxDataValue]):h||(yield X(b,l,d,g));h=null==a?void 0:a.authoringInfo;var y=(n="univariate-color-size"===(null==h?void 0:h.type))&&"above-and-below"===(null==h?void 0:h.univariateTheme);!e&&c&&(e=b.stops.map(p=>p.value),(u=b.stops.some(p=>!!p.label))&&(x=b.stops.map(p=>p.label)));q&&2<(null==(k=e)?void 0:k.length)&&!y&&(e=[e[0],e[e.length-1]]);if(!e)return null;n&&
5!==(null==(f=e)?void 0:f.length)&&(e=M({minSize:e[0],maxSize:e[e.length-1]}));var B=q?Y(a,e):null,C=E.getSymbolOutlineSize(l),G=u?null:V(e,m);return(yield Promise.all(e.map(function(){var p=w._asyncToGenerator(function*(t,z){const N=q?B[z]:yield v(b,l,t,d,g),ba=Z(y&&"class-breaks"===a.type?aa(a,z):l,N);return{value:t,symbol:ba,label:u?x[z]:G[z],size:N,outlineSize:C}});return function(t,z){return p.apply(this,arguments)}}()))).reverse()}});return F.apply(this,arguments)}function Y(a,b){a=null==a?
void 0:a.authoringInfo;const c="univariate-color-size"===(null==a?void 0:a.type);let d=[12,30];if(c){const g=b[0],m=b[b.length-1];d=b.map(k=>12+(k-g)/(m-g)*18)}c&&"below"===(null==a?void 0:a.univariateTheme)&&d.reverse();return d}function aa(a,b){const c=a.classBreakInfos,d=c.length;b=2>d||!(2<=b)?c[0].symbol.clone():c[d-1].symbol.clone();a.visualVariables.some(g=>"color"===g.type)&&(-1<b.type.indexOf("3d")?O(b):P(b));return b}function W(a,b){let c=null,d=null;"simple"===a.type?c=a.symbol:"class-breaks"===
a.type?(c=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,d=1<a.length):"unique-value"===a.type&&(c=(a=a.uniqueValueInfos)&&a[0]&&a[0].symbol,d=1<a.length);if(!c||ca(c))return null;c=c.clone();if(b||d)-1<c.type.indexOf("3d")?O(c):P(c);return c}function ca(a){return a?L.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(b=>b&&"fill"===b.type):!1:-1!==a.type.indexOf("fill"):!1}function O(a){"line-3d"===a.type?a.symbolLayers.forEach(b=>{b.material={color:D}}):a.symbolLayers.forEach(b=>{"icon"!==b.type||b.resource&&
b.resource.href?b.material={color:Q}:(b.material={color:R},b.outline={color:D,size:1.5})})}function P(a){"cim"===a.type?T.applyCIMSymbolColor(a,new S(Q)):-1!==a.type.indexOf("line")?a.color=D:(a.color=R,"simple-marker"===a.type&&(a.outline={color:D,width:1.5}))}function X(a,b,c,d){return H.apply(this,arguments)}function H(){H=w._asyncToGenerator(function*(a,b,c,d){const g=(yield new Promise(function(f,h){K(["../../../renderers/visualVariables/support/visualVariableUtils"],f,h)})).getSizeRangeAtScale(a,
c,d),m=g&&M(g);if(g||m){var k=m.map(f=>{{const h=g.minSize,l=g.maxSize,e=a.minDataValue,n=a.maxDataValue;let q=null;f=q=f<=h?e:f>=l?n:(f-h)/(l-h)*(n-e)+e}return f});k=r.round(k);for(let f=1;f<k.length-1;f++){const h=yield da(a,b,k[f],k[f-1],c,d);h&&(k[f]=h[0],m[f]=h[1])}return k}});return H.apply(this,arguments)}function M(a){const b=a.minSize;a=(a.maxSize-b)/4;const c=[];for(let d=0;5>d;d++)c.push(b+a*d);return c}function da(a,b,c,d,g,m){return I.apply(this,arguments)}function I(){I=w._asyncToGenerator(function*(a,
b,c,d,g,m){const k=yield v(a,b,c,g,m);d=yield v(a,b,d,g,m);var f=r.numDigits(c),h=f.fractional,l=f.integer;let e=f=null;0<c&&1>c&&(f=10**h,c*=f,l=r.numDigits(c).integer);for(h=l-1;0<=h;h--){var n=10**h;l=Math.floor(c/n)*n;n*=Math.ceil(c/n);null!=f&&(l/=f,n/=f);let q=(l+n)/2;[,q]=r.round([l,q,n],{indexes:[1]});const u=yield v(a,b,l,g,m),x=yield v(a,b,n,g,m),y=yield v(a,b,q,g,m),B=r.percentChange(k,u,d,null),C=r.percentChange(k,x,d,null),G=r.percentChange(k,y,d,null);let p=20>=B.previous,t=20>=C.previous;
p&&t&&(B.previous<=C.previous?(p=!0,t=!1):(t=!0,p=!1));p?e=[l,u]:t?e=[n,x]:20>=G.previous&&(e=[q,y]);if(e)break}return e});return I.apply(this,arguments)}function v(a,b,c,d,g){return J.apply(this,arguments)}function J(){J=w._asyncToGenerator(function*(a,b,c,d,g){const {getSize:m}=yield new Promise(function(k,f){K(["../../../renderers/visualVariables/support/visualVariableUtils"],k,f)});return m(a,c,{scale:d,view:g,shape:"simple-marker"===b.type?b.style:null})});return J.apply(this,arguments)}function Z(a,
b){a=a.clone();if(L.isSymbol3D(a))E.isVolumetricSymbol(a)||a.symbolLayers.forEach(c=>{"fill"!==c.type&&(c.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){const c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=b);return a}const R=[255,255,255],Q=[200,200,200],D=[128,128,128];A.REAL_WORLD_MAX_SIZE=
30;A.REAL_WORLD_MIN_SIZE=12;A.getRampStops=function(a,b,c,d,g,m){return F.apply(this,arguments)};Object.defineProperty(A,"__esModule",{value:!0})});