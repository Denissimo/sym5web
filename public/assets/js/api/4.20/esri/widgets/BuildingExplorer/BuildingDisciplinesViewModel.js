// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/collectionUtils ../../core/Handles ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./support/buildingLayerUtils ./support/LayerTreeNode ./support/layerUtils".split(" "),function(m,h,d,q,v,w,r,x,n,B,C,D,
E,y,z,p,A){d=function(t){function k(a){a=t.call(this,a)||this;a.root=new p.LayerTreeNode;a.state="disabled";a._handles=new w;a._loadLayers=A.createLoadLayersFunction();a.layers=new q;return a}m._inheritsLoose(k,t);var e=k.prototype;e.initialize=function(){this._handles.add(this.layers.on("change",()=>this._onLayersChange()));this._onLayersChange()};e.destroy=function(){this._set("state","disabled");this._handles.destroy();this.root.destroy()};e._updateLayerTree=function(){this.root.destroy();this._set("root",
new p.LayerTreeNode({collapsed:!1}));const a=new Map,b=1<this.layers.length?"modelName":"id";this.layers.forEach(c=>{c=z.findFullModelSublayer(c);r.isSome(c)&&this._addNodesForSublayers(c,this.root,a,b)});return this};e._addNodeForLayer=function(a,b,c,l){const g=String(a.get(l)).toLowerCase();if(r.isSome(g)&&!a.isEmpty){var u=`${b.id}/${g}`,f=c.get(u);f||(f=new p.LayerTreeNode({id:g,level:b.level+1}),c.set(u,f));f.layers.push(a);b.children.push(f);this._addNodesForSublayers(a,f,c,l)}};e._addNodesForSublayers=
function(a,b,c,l){"building-group"!==a.type||a.isEmpty||a.sublayers.forEach(g=>this._addNodeForLayer(g,b,c,l))};e._onLayersChange=function(){var a=m._asyncToGenerator(function*(){this._set("state","loading");if(0!==this.layers.length)try{yield this._loadLayers(this.layers),this._updateLayerTree(),this._set("state","ready")}catch(b){x.isAbortError(b)||this._set("state","failed")}});return function(){return a.apply(this,arguments)}}();m._createClass(k,[{key:"layers",set:function(a){const b=this._get("layers");
this._set("layers",v.referenceSetter(a,b))}}]);return k}(d);h.__decorate([n.property({readOnly:!0})],d.prototype,"root",void 0);h.__decorate([n.property({type:q,nonNullable:!0})],d.prototype,"layers",null);h.__decorate([n.property({readOnly:!0,nonNullable:!0})],d.prototype,"state",void 0);return d=h.__decorate([y.subclass("esri.widgets.BuildingExplorer.BuildingDisciplineViewModel")],d)});