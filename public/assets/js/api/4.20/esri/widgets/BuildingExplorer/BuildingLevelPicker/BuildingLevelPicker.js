// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/events ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../Widget ../BuildingLevel ../../../chunks/constants ./Label ./LevelItem ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(u,e,r,v,w,n,p,x,d,H,I,J,g,B,C,y,h,D,E,F,q){const G={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};d=function(z){function t(b,c){var a=z.call(this,b,c)||this;a._defaultViewModel=new y;a.viewModel=a._defaultViewModel;a.messages=G;a._levelHandles=new v;a._levelEventHandles=new v;a._levelWidgets=[];a._labelWidget=new D.Label({onClear:()=>a.viewModel.clear()});a._hoveredLevel=null;a._expandedLevelsHeight=void 0;
a._normalizedPointerPosition=0;a._hovering=!1;a._containerPosTop=null;a._levelsContainer=null;a._onPointerUp=()=>{window.getSelection().removeAllRanges();n.isSome(a._hoveredLevel)&&(a.viewModel.enabled&&a._hoveredLevel===a.viewModel.value?a.viewModel.clear():a.viewModel.select(a._hoveredLevel))};a._onPointerEnter=()=>{var k;!a._hovering&&n.isSome(a._levelsContainer)&&(a._hovering=!0,a._containerPosTop=null!=(k=a._levelsContainer.getBoundingClientRect().top)?k:0)};a._onPointerLeave=()=>{a._hovering&&
(a._normalizedPointerPosition=0,a._hoveredLevel=null,a._hovering=!1)};a._onPointerMove=k=>{if(!a._hovering)return!1;window.getSelection().removeAllRanges();if(n.isSome(a._containerPosTop)){let l=a._levelsHeight,m=a._containerPosTop+h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR+a._expandedLevelsMargin;const A=a._levelHeight/2;m+=A;l-=A;k=(k.clientY-m)/l;k+=h.LEVELS_POINTER_ADJUSTMENT;a._normalizedPointerPosition=k}return!1};return a}u._inheritsLoose(t,z);var f=t.prototype;f.postInitialize=function(){this.own(p.init(this,
"_levelsContainer",()=>this._onContainerChange()),p.init(this,"_levels",()=>this._createLevelWidgets()),p.init(this,"messages",()=>this._labelWidget.messages=this.messages))};f.destroy=function(){this._levelHandles.destroy();this._levelEventHandles.destroy();this._levelWidgets.forEach(b=>b.destroy());this._labelWidget.destroy();this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()};f.render=function(){const b=this._levelWidgets.length,c=1<b?this._levelWidgets.map(m=>m.render()):
null;var a=h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR;const k=-a/h.LEVELS_MARGIN_FACTOR,l=this._levelsHeight;a=l+2*a;return q.tsx("div",{bind:this,key:this,class:this.classes("esri-widget","esri-building-level-picker",{["esri-building-level-picker--animate-level"]:!this._hovering,["esri-building-level-picker--no-level"]:2>b}),onkeydown:this._onKeyDown},this._renderLabelContainer(),q.tsx("div",{bind:this,class:"esri-building-level-picker__levels-container",styles:{height:`${a}px`,marginTop:`${k}px`,marginBottom:`${k}px`},
onfocus:this._onFocus,afterCreate:F.storeNode,"data-node-ref":"_levelsContainer"},q.tsx("div",{styles:{height:`${l}px`,margin:`${h.LEVELS_PADDING-this._expandedLevelsMargin}px 0 0 0`},class:"esri-building-level-picker__inner-levels-container"},c)))};f._renderLabelContainer=function(){const b=this.messages.previousLevel,c=this.messages.nextLevel;return q.tsx("div",{class:"esri-building-level-picker__label-container",tabIndex:0},q.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-up",
disabled:!this.viewModel.hasNext,onclick:this._onArrowUpClick,"aria-label":c,title:c,type:"button"}),this._labelWidget.render(),q.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-down",disabled:!this.viewModel.hasPrevious,onclick:this._onArrowDownClick,"aria-label":b,title:b,type:"button"}))};f._updateComponents=function(){const b=this.viewModel.enabled?this.viewModel.value:null,c=n.isSome(this._hoveredLevel)?this._hoveredLevel:b;this._levelWidgets.forEach(a=>{var k,l;const m=this.viewModel.getValueLabel(a.level);
a.label=n.isSome(m)?m:null==(k=this.messages)?void 0:null==(l=k.currentLevel)?void 0:l.replace("{{level}}",String(a.level));a.active=a.level===b;a.hovering=a.level===this._hoveredLevel});this._labelWidget.level=c;this._labelWidget.active=c===b;this._labelWidget.hovering=n.isSome(this._hoveredLevel)};f._onWidthChange=function(){this._levelWidgets.forEach(b=>{b.width=this._levelWidth})};f._createLevelWidgets=function(){this._levelWidgets.forEach(b=>b.destroy());this._levelWidgets=this._levels.map(b=>
new E.LevelItem({level:b,onSelect:()=>this._onLevelToggle(b)}));this._levelHandles.removeAll();this._levelHandles.add([p.init(this,["messages","viewModel.value","viewModel.enabled","_hoveredLevel","_hovering"],()=>this._updateComponents()),p.init(this,["_normalizedPointerPosition","_hovering"],()=>this._onPointerPositionChange()),p.init(this,"_width",()=>this._onWidthChange())])};f._onContainerChange=function(){const b=this._levelsContainer;n.isSome(b)&&(this._levelEventHandles.removeAll(),this._levelEventHandles.add([r.on(b,
"pointerenter",this._onPointerEnter),r.on(b,"pointerover",this._onPointerEnter),r.on(b,"pointerleave",this._onPointerLeave),r.on(b,"pointerup",this._onPointerUp),r.on(b,"pointermove",this._onPointerMove)]))};f._onKeyDown=function(b){switch(b.key){case "ArrowDown":case "ArrowLeft":b.preventDefault();b.stopPropagation();this.viewModel.previous();this._focusCurrentLevel();break;case "ArrowUp":case "ArrowRight":b.preventDefault(),b.stopPropagation(),this.viewModel.next(),this._focusCurrentLevel()}};f._focusCurrentLevel=
function(){const b=this._levelWidgets.find(c=>c.level===this.viewModel.value);b&&b.focus()};f._onFocus=function(){this._hoveredLevel=0<this._levels.length?this._levels[0]:null};f._onLevelToggle=function(b){this.viewModel.enabled&&this.viewModel.value===b?this.viewModel.clear():this.viewModel.select(b)};f._onArrowUpClick=function(){this.viewModel.next()};f._onArrowDownClick=function(){this.viewModel.previous()};f._onPointerPositionChange=function(){let b=0;this._levelWidgets.forEach((a,k)=>{const {width:l,
height:m}=this._getLevelWidgetSize(k);a.height=m;a.width=l;b+=m});this._hoveredLevel=this._levelClosestToPointer;const c=this._expandedLevelsHeight;if(null==c||30<Math.abs(c-b))this._expandedLevelsHeight=b};f._getLevelWidgetSize=function(b){const c={width:this._levelWidth,height:this._levelHeight};this._hovering&&(b=this._getGaussianFactor(b,this._normalizedPointerPosition),c.width+=h.LEVEL_HOVERED_EXTRA_WIDTH*b,c.height+=h.LEVEL_HOVERED_EXTRA_HEIGHT*b);return c};f._getGaussianFactor=function(b,c){const a=
this._numLevels-1;return Math.exp(-((this._gaussianFactor*((a-b)/a-c))**2))};u._createClass(t,[{key:"_levelsHeight",get:function(){return Math.round(this._levelHeight*this._numLevels)}},{key:"_expandedLevelsMargin",get:function(){return Math.round((this._expandedLevelsHeight-this._levelsHeight)/2)}},{key:"_levelWidth",get:function(){const {LEVEL_WIDTH_NOMINATOR:b,LEVEL_WIDTH_CONSTANT:c}=h.constants;return Math.round(w.clamp(b/Math.sqrt(this._numLevels)+c,h.LEVEL_WIDTH_MIN,h.LEVEL_WIDTH_MAX))}},{key:"_levelHeight",
get:function(){const b=h.LEVEL_HEIGHT_DEFAULT;return Math.round(w.clamp(2*b/Math.sqrt(this._numLevels),2,b))}},{key:"_gaussianFactor",get:function(){const b=this._numLevels;return b/Math.log(h.ALPHA_LEVEL_DEPENDENCY_FACTOR*b)*h.ALPHA_SPREAD_FACTOR}},{key:"_levelClosestToPointer",get:function(){if(!this._hovering)return null;const b=this._numLevels-1,c=this._normalizedPointerPosition;return 0<=b&&n.isSome(c)?this._levels[Math.round((1-c)*b)]:null}}]);return t}(C);e.__decorate([g.property({type:y})],
d.prototype,"viewModel",void 0);e.__decorate([g.property()],d.prototype,"messages",void 0);e.__decorate([g.property()],d.prototype,"_levelWidgets",void 0);e.__decorate([g.property()],d.prototype,"_labelWidget",void 0);e.__decorate([g.property()],d.prototype,"_hoveredLevel",void 0);e.__decorate([x.aliasOf("viewModel.allowedValues")],d.prototype,"_levels",void 0);e.__decorate([x.aliasOf("_levels.length")],d.prototype,"_numLevels",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"_levelsHeight",
null);e.__decorate([g.property()],d.prototype,"_expandedLevelsHeight",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"_expandedLevelsMargin",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"_levelWidth",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"_levelHeight",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"_gaussianFactor",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"_levelClosestToPointer",null);e.__decorate([g.property({type:Number,
range:{min:0,max:1}})],d.prototype,"_normalizedPointerPosition",void 0);e.__decorate([g.property()],d.prototype,"_hovering",void 0);e.__decorate([g.property()],d.prototype,"_containerPosTop",void 0);e.__decorate([g.property()],d.prototype,"_levelsContainer",void 0);return d=e.__decorate([B.subclass("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],d)});