// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/decorators/cast ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(G,k,u,H,z,A,g,I,O,P,n,J,K,B,C,q,D,b){const E={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},v=window.CSS;g=function(F){function w(a,c){a=F.call(this,a,c)||this;a.abilities=null;a.displayType="list";a.graphic=null;a.label=void 0;a.messages=null;a.messagesUnits=null;a.selectedFile=null;a.submitting=!1;a.viewModel=new B;a.visibleElements={...E};a._supportsImageOrientation=v&&v.supports&&v.supports("image-orientation",
"from-image");a._addAttachmentForm=null;a._updateAttachmentForm=null;return a}G._inheritsLoose(w,F);var e=w.prototype;e.initialize=function(){this.own(z.on(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),z.init(this,"viewModel.mode",()=>this._modeChanged()))};e.castVisibleElements=function(a){return{...E,...a}};e.addAttachment=function(){const {_addAttachmentForm:a,viewModel:c}=this;this._set("submitting",!0);this._set("error",null);return c.addAttachment(a).then(d=>{this._set("submitting",
!1);this._set("error",null);c.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new u("attachments:add-attachment",this.messages.addErrorMessage,d));throw d;})};e.deleteAttachment=function(a){const {viewModel:c}=this;this._set("submitting",!0);this._set("error",null);return c.deleteAttachment(a).then(d=>{this._set("submitting",!1);this._set("error",null);c.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new u("attachments:delete-attachment",
this.messages.deleteErrorMessage,d));throw d;})};e.updateAttachment=function(){const {viewModel:a}=this,{_updateAttachmentForm:c}=this;this._set("submitting",!0);this._set("error",null);return a.updateAttachment(c).then(d=>{this._set("submitting",!1);this._set("error",null);a.mode="view";return d}).catch(d=>{this._set("submitting",!1);this._set("error",new u("attachments:update-attachment",this.messages.updateErrorMessage,d));throw d;})};e.render=function(){const {submitting:a,viewModel:c}=this,{state:d}=
c;return b.tsx("div",{class:this.classes("esri-attachments","esri-widget")},a?this.renderProgressBar():null,"loading"===d?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};e.renderErrorMessage=function(){const {error:a,visibleElements:c}=this;return a&&c.errorMessage?b.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},a.message):null};e.renderAttachments=function(){const {mode:a,activeAttachmentInfo:c}=this.viewModel;return"add"===a?this.renderAddForm():
"edit"===a?this.renderDetailsForm(c):this.renderAttachmentContainer()};e.renderLoading=function(){return b.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},b.tsx("div",{class:"esri-attachments__loader"}))};e.renderProgressBar=function(){return this.visibleElements.progressBar?b.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};e.renderAddForm=function(){const {submitting:a,selectedFile:c}=this;var d=a||!c,f=this.visibleElements.cancelAddButton?b.tsx("button",
{type:"button",bind:this,disabled:a,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",a&&"esri-button--disabled")},this.messages.cancel):null;d=this.visibleElements.addSubmitButton?b.tsx("button",{type:"submit",disabled:d,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:d})},this.messages.add):null;const h=c?b.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},
c.name):null;f=b.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},b.tsx("fieldset",{class:"esri-attachments__file-fieldset"},h,b.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},c?this.messages.changeFile:this.messages.selectFile,b.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),
d,f);return b.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},f)};e.renderDetailsForm=function(a){const {visibleElements:c,viewModel:d,selectedFile:f,submitting:h}=this,{contentType:l,size:p,url:r}=a;var {abilities:m}=d,t=h||!f,x=m.editing&&m.operations.delete&&c.deleteButton?b.tsx("button",{key:"delete-button",type:"button",disabled:h,bind:this,onclick:L=>this._submitDeleteAttachment(L,a),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",
{["esri-button--disabled"]:h})},this.messages.delete):null;t=m.editing&&m.operations.update&&c.updateButton?b.tsx("button",{disabled:t,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:t})},this.messages.update):null;const M=this.visibleElements.cancelUpdateButton?b.tsx("button",{disabled:h,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small",
"esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:h})},this.messages.cancel):null;var y=f?b.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},f.name):null;m=m.editing&&m.operations.update?b.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},y,b.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,b.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",
bind:this,onchange:this._handleFileInputChange}))):null;y=b.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},b.tsx("label",null,H.formatFileSize(this.messagesUnits,p)));const N=b.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},b.tsx("label",null,l));x=b.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},b.tsx("div",{class:"esri-attachments__metadata"},
y,N),m,b.tsx("div",{class:"esri-attachments__actions"},x,M,t));return b.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},b.tsx("a",{class:"esri-attachments__item-link",href:r,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:a,size:400}),b.tsx("div",{class:"esri-attachments__item-link-overlay"},b.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},b.tsx("path",
{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),b.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),x)};e.renderImageMask=function({attachmentInfo:a,size:c}){var {supportsResizeAttachments:d}=this.viewModel;const {contentType:f,name:h,url:l}=a,p=d&&C.isSupportedImage(f);a=(a=this._getCSSTransform(a,p))?{transform:a,"image-orientation":"none"}:{};const r=-1===l.indexOf("?")?"?":"\x26";c=p?`${l}${r}w=${c}`:C.getIconPath(f);d={["esri-attachments__image--resizable"]:d};
return b.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!p},"esri-attachments__item-mask")},b.tsx("img",{styles:a,alt:h,src:c,class:this.classes(d,"esri-attachments__image")}))};e.renderAttachmentInfo=function({attachmentInfo:a,displayType:c}){var {viewModel:d}=this;({abilities:d}=d);const {name:f,url:h}=a;c=this.renderImageMask({attachmentInfo:a,size:"list"===c?48:400});var l=d.editing?b.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
q.isRTL()?"esri-icon-left":"esri-icon-right")}):null;l=b.tsx("label",{class:"esri-attachments__label"},b.tsx("span",{class:"esri-attachments__filename"},f||this.messages.noTitle),l);c=[c,l];d=d.editing?b.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":a.id,onclick:()=>this._startEditAttachment(a),type:"button"},c):b.tsx("a",{key:"details-link",class:"esri-attachments__item-button",
href:h,target:"_blank"},c);return b.tsx("li",{class:"esri-attachments__item",key:a},d)};e.renderAttachmentContainer=function(){const {displayType:a,viewModel:c,visibleElements:d}=this,{attachmentInfos:f,abilities:h}=c;var l=f&&f.length;const p={["esri-attachments__container--list"]:"preview"!==a,["esri-attachments__container--preview"]:"preview"===a},r=h.editing&&h.operations.add&&d.addButton?b.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary",
"esri-attachments__add-attachment-button"),type:"button"},b.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;l=l?b.tsx("ul",{class:"esri-attachments__items"},f.toArray().map(m=>this.renderAttachmentInfo({attachmentInfo:m,displayType:a}))):b.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return b.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",p)},l,
r)};e._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};e._handleFileInputChange=function(a){a=(a=a.target)&&a.files&&a.files.item(0);this._set("selectedFile",a)};e._submitDeleteAttachment=function(a,c){a.preventDefault();this.deleteAttachment(c)};e._submitAddAttachment=function(a){a.preventDefault();this.addAttachment()};e._submitUpdateAttachment=function(a){a.preventDefault();this.updateAttachment()};e._startEditAttachment=function(a){const {viewModel:c}=this;c.activeAttachmentInfo=
a;c.mode="edit"};e._startAddAttachment=function(){this.viewModel.mode="add"};e._cancelForm=function(a){a.preventDefault();this.viewModel.mode="view"};e._getCSSTransform=function(a,c){({orientationInfo:a}=a);return!this._supportsImageOrientation&&c&&a?[a.rotation?`rotate(${a.rotation}deg)`:"",a.mirrored?"scaleX(-1)":""].join(" "):""};return w}(K);k.__decorate([A.aliasOf("viewModel.abilities")],g.prototype,"abilities",void 0);k.__decorate([n.property()],g.prototype,"displayType",void 0);k.__decorate([A.aliasOf("viewModel.graphic")],
g.prototype,"graphic",void 0);k.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);k.__decorate([n.property(),D.messageBundle("esri/widgets/Attachments/t9n/Attachments")],g.prototype,"messages",void 0);k.__decorate([n.property(),D.messageBundle("esri/core/t9n/Units")],g.prototype,"messagesUnits",void 0);k.__decorate([n.property({readOnly:!0})],g.prototype,"selectedFile",void 0);k.__decorate([n.property({readOnly:!0})],g.prototype,"submitting",
void 0);k.__decorate([n.property({readOnly:!0})],g.prototype,"error",void 0);k.__decorate([n.property({type:B})],g.prototype,"viewModel",void 0);k.__decorate([n.property()],g.prototype,"visibleElements",void 0);k.__decorate([I.cast("visibleElements")],g.prototype,"castVisibleElements",null);return g=k.__decorate([J.subclass("esri.widgets.Attachments")],g)});