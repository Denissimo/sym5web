// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../chunks/switch ../intl ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ../intl/moment ../layers/support/domains ../layers/support/fieldUtils ./Widget ./FeatureForm/FeatureFormViewModel ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ../intl/locale".split(" "),
function(r,p,n,N,t,O,P,Q,R,w,D,E,F,G,H,I,B,S,J,K,k,L){n=function(C){function z(a,b){var c=C.call(this,a,b)||this;c._activeDateEdit=null;c._activeInputName=null;c._fieldFocusNeeded=!1;c._fieldToInitialIncompatibleDomainValue=new Map;c._switchFieldsWithInitialIncompatibleValue=new Set;c._moment=null;c._userUpdatedInputFieldNames=new Set;c.description=null;c.feature=null;c.fieldConfig=null;c.formTemplate=null;c.groupDisplay="all";c.headingLevel=2;c.label=void 0;c.layer=null;c.messages=null;c.strict=
null;c.title=null;c.viewModel=new I;c._handleRadioInputChange=d=>{c._updateFieldValue(d.target)};c._handleFormKeyDown=c._handleFormKeyDown.bind(r._assertThisInitialized(c));c._handleInputBlur=c._handleInputBlur.bind(r._assertThisInitialized(c));c._handleInputFocus=c._handleInputFocus.bind(r._assertThisInitialized(c));c._handleNumberInputMouseDown=c._handleNumberInputMouseDown.bind(r._assertThisInitialized(c));c._handleInputKeyDown=c._handleInputKeyDown.bind(r._assertThisInitialized(c));c._handleOptionChange=
c._handleOptionChange.bind(r._assertThisInitialized(c));c._handleGroupClick=c._handleGroupClick.bind(r._assertThisInitialized(c));c._handleSubmit=c._handleSubmit.bind(r._assertThisInitialized(c));c._afterInputCreateOrUpdate=c._afterInputCreateOrUpdate.bind(r._assertThisInitialized(c));return c}r._inheritsLoose(z,C);var g=z.prototype;g.loadLocale=function(){var a=r._asyncToGenerator(function*(){this._moment=yield E.loadMoment()});return function(){return a.apply(this,arguments)}}();g.initialize=function(){this.own(this.watch("feature",
()=>{const a=this._getFocusableInput("forward");this._activeInputName=a&&a.name;this._userUpdatedInputFieldNames.clear();this._fieldToInitialIncompatibleDomainValue.clear();this._switchFieldsWithInitialIncompatibleValue.clear();this._fieldFocusNeeded=!0}),this.on("submit",a=>{if(0<a.invalid.length){const [b]=a.invalid;a.invalid.forEach(c=>this._userUpdatedInputFieldNames.add(c));this._activeInputName=b;this._fieldFocusNeeded=!0;this.scheduleRender()}}))};g.destroy=function(){this._userUpdatedInputFieldNames.clear();
this._userUpdatedInputFieldNames=null};g.getValues=function(){return null};g.submit=function(){return null};g.render=function(){const {state:a}=this.viewModel;return k.tsx("div",{class:this.classes("esri-feature-form","esri-widget","esri-widget--panel")},"ready"===a?this.renderForm():null)};g.renderForm=function(){var a=this.title?k.tsx(B.Heading,{key:"title",level:this.headingLevel},this.title):null;const b=this.description?k.tsx("p",{class:"esri-feature-form__description-text",key:"description"},
this.description):null;a=a||b?k.tsx("div",{class:"esri-feature-form__form-header"},a,b):null;return k.tsx("form",{class:"esri-feature-form__form",novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},a,this.renderFields())};g.renderFields=function(){const {viewModel:{inputFields:a}}=this;return a.map((b,c)=>b&&b.inputFields?this.renderGroup(b,c):this.renderLabeledField(b))};g.renderGroup=function(a,b){const {description:c,inputFields:d,label:f,state:h}=a;var e=this.viewModel.findField(this._activeInputName);
e=!(!e||e.group!==a);const m=`${this.id}_group_${b}`,l=`${this.id}_group-label_${b}`,q=`${this.id}_group-description_${b}`,x=c?k.tsx("p",{class:this.classes("esri-feature-form__group-description","esri-feature-form__description-text"),id:q},c):null,u="sequential"===this.groupDisplay,v=u?e:"expanded"===h,A=v?"esri-icon-up":"esri-icon-down";return k.tsx("fieldset",{"aria-expanded":v.toString(),"aria-labelledby":l,"aria-describedby":c?q:"",class:this.classes("esri-feature-form__group",u?"esri-feature-form__group--sequential":
null,v?null:"esri-feature-form__group--collapsed",e?"esri-feature-form__group--active":null),"data-group":a,id:m,key:b,onclick:this._handleGroupClick},k.tsx("button",{role:u?"presentation":void 0,class:"esri-feature-form__group-header",type:"button",tabIndex:u?-1:0},k.tsx("div",{class:"esri-feature-form__group-title"},k.tsx(B.Heading,{class:"esri-feature-form__group-label",id:l,level:this.headingLevel+(this.title?1:0)},f),x),u?null:k.tsx("span",{class:this.classes(A,"esri-feature-form__group-toggle-icon")})),
d.map(y=>this.renderLabeledField(y)))};g._getFocusableInput=function(a,b){var c=this.viewModel._allInputFields;c="forward"===a?c:c.slice().reverse();b?b&&b.inputFields?a=c.indexOf(b.inputFields[0]):(this._isFieldInClosedCollapsibleGroup(b)?({inputFields:b}=b.group,a="forward"===a?b[b.length-1]:b[0]):a=b,a=c.indexOf(a)+1):a=0;for(;a<c.length;a++)if(b=c[a],b.visible&&b.editable)return b;return null};g.renderLabeledField=function(a){const {label:b,layer:c,type:d}=a;return k.tsx("label",{key:`${c.id}-${a.name}`,
class:"esri-feature-form__label"},[b,"unsupported"!==d?this.renderInputField(a):this.renderUnsupportedField(a),this.renderAuxiliaryText(a)])};g.renderInputField=function(a){var {viewModel:b}=this;const {domain:c,editable:d,name:f,type:h}=a;b=b.getValue(f);const e=!d,m=this.getCommonInputProps(a);if("coded-value"===(null==c?void 0:c.type)&&!e){if("switch"===a.editorType)if(this._switchFieldsWithInitialIncompatibleValue.has(f)||null==b||a.config.onValue!==b&&a.config.offValue!==b)this._switchFieldsWithInitialIncompatibleValue.add(f);
else return this.renderSwitchInputField(b,m);return"radio-buttons"===a.editorType?this.renderRadioButtonsInputField(b,c.codedValues.map(({code:l,name:q})=>({value:l,name:q})),m):this.renderSelectInputField(b,c.codedValues.map(({code:l,name:q})=>({value:l,name:q})),m)}return"text"===h&&"text-area"===a.editorType||"rich-text"===a.editorType?k.tsx("textarea",{...m}):"datetime-picker"===a.editorType||"date"===h?this.renderDateInputField(b,m):k.tsx("input",{type:"text"===h?"text":"number",...m})};g.renderDateInputField=
function(a,b){const {date:c,time:d}=this._formatDate(0);var f=`${this.id}-${b.key}`;const h=`${f}-date`;f=`${f}-time`;const e=b["data-field"],{includeTime:m}=e,{date:l,time:q}=this._formatDate(a);return k.tsx("div",{key:`${b.key}-date`,class:"esri-feature-form__date-input-container"},k.tsx("div",{class:this.classes("esri-feature-form__date-input-part",m?null:"esri-feature-form__date-input-part--lone")},k.tsx("input",{"aria-label":e.label,"aria-describedby":h,type:"text",...b,"data-date-part":"date",
class:this.classes(b.class,"esri-feature-form__input--date"),value:l}),k.tsx("div",{class:"esri-feature-form__date-format-hint",id:h},c)),m?k.tsx("div",{class:"esri-feature-form__date-input-part",key:"time-input"},k.tsx("input",{"aria-describedby":f,"aria-label":e.label,type:"text",...b,"data-date-part":"time",class:this.classes(b.class,"esri-feature-form__input--time"),value:q}),k.tsx("div",{class:"esri-feature-form__date-format-hint",id:f},d)):null)};g.renderUnsupportedField=function(a){a=this.viewModel.getValue(a.name);
return k.tsx("input",{class:this.classes("esri-input","esri-feature-form__input","esri-feature-form__input--disabled"),disabled:!0,type:"text",value:`${a}`})};g.renderSelectInputField=function(a,b,c){const d=b.map(e=>k.tsx("option",{value:`${e.value}`,key:e.name},e.name)),f=c["data-field"];this.registerIncompatibleValue(a,b,f,e=>{d.unshift(k.tsx("option",{value:`${e}`,key:"incompatible-option",disabled:!0},e))});if(!f.required&&("combo-box"!==f.editorType||f.config.showNoValueOption)){var h;a=(null==
(h=f.config)?void 0:h.noValueOptionLabel)||this.messages.empty;d.unshift(k.tsx("option",{value:"",key:"empty-option"},a))}return k.tsx("select",{...c,class:this.classes(c.class,"esri-select"),onchange:this._handleOptionChange},d)};g.registerIncompatibleValue=function(a,b,c,d){const f=this._fieldToInitialIncompatibleDomainValue,h=f.has(c.name);if(h||null!=a&&""!==a&&!b.find(e=>e.value===a)||h)h||f.set(c.name,a),null==d?void 0:d(f.get(c.name))};g.renderRadioButtonsInputField=function(a,b,c){const d=
c["data-field"],f=b.map(e=>this.renderRadioButton({key:e.name,label:e.name,name:d.name,value:e.value,selected:e.value===a,props:c}));this.registerIncompatibleValue(a,b,d);if(!d.required&&(!d.config||d.config.showNoValueOption)){var h;b=(null==(h=d.config)?void 0:h.noValueOptionLabel)||this.messages.empty;f.unshift(this.renderRadioButton({key:"empty-option",label:b,name:d.name,value:"",selected:""===a||null===a,props:c}))}return k.tsx("div",{key:`${c.key}-radio`,class:"esri-feature-form__input--radio-group"},
f)};g.renderSwitchInputField=function(a,b){return k.tsx("calcite-switch",{...b,class:"esri-feature-form__input--switch",switched:a===b["data-field"].config.onValue,onCalciteSwitchChange:c=>{this._parseValue(c.currentTarget)}})};g.renderRadioButton=function({key:a,name:b,value:c,selected:d,label:f,props:h}){return k.tsx("label",{key:a,class:"esri-feature-form__input--radio-label"},k.tsx("input",{...h,class:"esri-feature-form__input--radio",name:b,type:"radio",value:c,checked:d,onchange:this._handleRadioInputChange}),
f)};g.renderAuxiliaryText=function(a){if(this._userUpdatedInputFieldNames.has(a.name)&&!a.valid)return k.tsx("div",{key:"error-message"},k.tsx("span",{class:this.classes("esri-feature-form__input-icon--invalid","esri-icon-notice-triangle")}),k.tsx("div",{class:"esri-feature-form__field-error-message"},a.errorMessage));if(a.description)return k.tsx("div",{key:"description",class:"esri-feature-form__description-text"},a.description)};g.getCommonInputProps=function(a){const {groupDisplay:b,viewModel:c}=
this,{editable:d,group:f,hint:h,maxLength:e,minLength:m,name:l,required:q,type:x,valid:u}=a,v=c.getValue(l),A=this._userUpdatedInputFieldNames.has(l),y=!d,M="all"===b&&"collapsed"===(null==f?void 0:f.state);return{afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":u?"false":"true","class":this.classes("esri-input","esri-feature-form__input",y?"esri-feature-form__input--disabled":null,A&&!u?"esri-feature-form__input--invalid":null),key:l,minlength:-1<
m?`${m}`:"",maxlength:-1<e?`${e}`:"",...this._getNumberFieldConstraints(a),disabled:y,value:null==v?"":`${v}`,"data-field":a,onfocus:this._handleInputFocus,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:"number"===x?this._handleNumberInputMouseDown:null,placeholder:"number"===x||"text"===x?h:"",required:q,tabIndex:M?-1:0}};g._isFieldInClosedCollapsibleGroup=function(a){var b;return"all"===this.groupDisplay&&!(a&&a.inputFields)&&"collapsed"===(null==a?void 0:null==(b=a.group)?
void 0:b.state)};g._handleNumberInputMouseDown=function({target:a}){a.disabled||a.focus();this.scheduleRender()};g._getNumberFieldConstraints=function(a){return(a=F.getDomainRange(a.domain)||G.getFieldRange(a.field))&&a.max!==Number.MAX_VALUE&&a.min!==Number.MIN_VALUE?a:{min:null,max:null}};g._afterInputCreateOrUpdate=function(a){const b=a["data-field"],c=this.viewModel.findField(this._activeInputName),d=this._fieldToInitialIncompatibleDomainValue.get(b.name)===b.value;b.editable&&this._fieldFocusNeeded&&
c===b&&("radio-buttons"!==b.editorType||d||a.checked)&&(this._fieldFocusNeeded=!1,a.focus())};g._handleInputFocus=function(a){this._activeInputName=a.target["data-field"].name};g._handleInputBlur=function(a){var b=a.target;const c=b["data-field"],d=(a=a.relatedTarget)&&a["data-field"];this._syncDateEditsBeforeValueCommit(b);if(d&&"date"===c.type&&"date"===d.type&&c.field===d.field)""!==b.value&&""===a.value&&(b=a.getAttribute("data-date-part"),a.value=this._formatDate(Date.now())[b]);else if("radio-buttons"!==
c.editorType||b.checked)this._commitValue(b),this.scheduleRender()};g._commitValue=function(a){var b=a["data-field"];if(this._activeDateEdit){const {date:d,time:f}=this._activeDateEdit;var c=this._getDateEditValue(b,"date");b=this._getDateEditValue(b,"time");const h=""===c||""===b;if(d){const {input:e}=d;e.value=h?"":c}f&&({input:c}=f,c.value=h?"":b);this._activeDateEdit=null;if(d&&f){this._updateDateFieldValue(d.input,f.input);return}}this._updateFieldValue(a)};g._getDateEditValue=function(a,b){var c=
this._activeDateEdit[b];if(c){var {value:d}=c;return""===d?"":(c=this._parseDate(c.value,b))?this._formatDate(c.getTime())[b]:this._formatDate(a.value)[b]}};g._handleInputKeyDown=function(a){const {key:b,altKey:c,ctrlKey:d,metaKey:f,shiftKey:h}=a;var e=a.target,m=e["data-field"];if("Tab"===b){var l=h?"backward":"forward",q=e.getAttribute("data-date-part");this._syncDateEditsBeforeValueCommit(e);"backward"===l&&"time"===q||"forward"===l&&"date"===q&&m.includeTime||(this._commitValue(e),e=this.viewModel.findField(m.name),
l=this._getFocusableInput(l,e),e=e.group===(null==l?void 0:l.group),this._activeInputName=null==l?void 0:l.name,l&&("sequential"===this.groupDisplay||e)?(a.preventDefault(),this._fieldFocusNeeded=!0):this.renderNow())}else"Enter"!==b?({type:e}=m.field,l="single"===e||"double"===e,"integer"!==e&&"small-integer"!==e&&!l||c||d||f||1!==b.length||(e=Number(b),m=["-","+"],q=["e","."],l=l?[...m,...q]:m,isNaN(e)&&-1===l.indexOf(b)&&a.preventDefault())):this._isFieldInClosedCollapsibleGroup(m)?m.group.state=
"expanded":(this._updateFieldValue(a.target),this.scheduleRender())};g._syncDateEditsBeforeValueCommit=function(a){if("date"===a["data-field"].type){var b=a.getAttribute("data-date-part");this._activeDateEdit={...this._activeDateEdit,[b]:{value:a.value,input:a}}}};g._updateFieldValue=function(a){const b=a["data-field"];this.viewModel.setValue(b.name,this._parseValue(a));this._userUpdatedInputFieldNames.add(b.name)};g._updateDateFieldValue=function(a,b){const c=a["data-field"];this.viewModel.setValue(c.name,
this._parseDateTimeValue(a,b));this._userUpdatedInputFieldNames.add(c.name)};g._parseValue=function(a){var b=a["data-field"],c=a.value;if("switch"===b.editorType&&!(a instanceof HTMLSelectElement))return a.switched?b.config.onValue:b.config.offValue;if("radio-buttons"===b.editorType&&"radio"===a.type&&!a.checked)return b.value;var {type:d}=b;if("number"===d)return c?parseFloat(c):null;if("date"===d){if(!c)return null;d=Number(c);if(!isNaN(d))return d;a=a.getAttribute("data-date-part");d=this._parseDate(c,
a);if(!d)return null;c=this._moment;d=c(d);var f=b.domain;const h=c();let e=h;f&&"range"===f.type&&(f=c(f.maxValue),h.isAfter(f)||(e=f));b=this.viewModel.getValue(b.name);b=c(null!=b?b:e);"date"===a?(d.hour(b.hour()),d.minutes(b.minutes()),d.seconds(b.seconds())):(d.date(b.date()),d.month(b.month()),d.year(b.year()));return d.valueOf()}return c};g._parseDateTimeValue=function(a,b){a=a.value;b=b.value;if(!a||!b)return null;a=this._parseDate(a,"date");b=this._parseDate(b,"time");if(!a||!b)return null;
a=this._moment(a);b=this._moment(b);a.hour(b.hour());a.minutes(b.minutes());a.seconds(b.seconds());return a.valueOf()};g._handleOptionChange=function(a){this._updateFieldValue(a.target);this.scheduleRender()};g._handleGroupClick=function(a){var b;const c=a.currentTarget["data-group"],d="expanded"===c.state,f="sequential"===this.groupDisplay;if(!d||a.target.closest(".esri-feature-form__group-header")){this._activeInputName=null==(b=this._getFocusableInput("forward",c))?void 0:b.name;if(f){a=a.target.closest(".esri-feature-form__group-header");
if(d&&!a)return;this.viewModel.inputFields.forEach(h=>{h&&h.inputFields&&h!==c&&(h.state="collapsed")})}c.state=d?"collapsed":"expanded";this._fieldFocusNeeded=f;this.scheduleRender()}};g._handleSubmit=function(a){a.preventDefault()};g._handleFormKeyDown=function(a){"Enter"===a.key&&this.viewModel.submit()};g._formatDate=function(a){if(null==a)return{date:"",time:""};a=this._moment(a);return{date:a.format("L"),time:a.format("LTS")}};g._parseDate=function(a,b){if(null==a||""===a)return null;a=this._moment(a,
"date"===b?"L":"LTS",L.getLocale(),!1);return a.isValid()?a.toDate():null};return z}(H);p.__decorate([t.aliasOf("viewModel.description")],n.prototype,"description",void 0);p.__decorate([t.aliasOf("viewModel.feature")],n.prototype,"feature",void 0);p.__decorate([t.aliasOf("viewModel.fieldConfig")],n.prototype,"fieldConfig",void 0);p.__decorate([t.aliasOf("viewModel.formTemplate")],n.prototype,"formTemplate",void 0);p.__decorate([w.property()],n.prototype,"groupDisplay",void 0);p.__decorate([w.property()],
n.prototype,"headingLevel",void 0);p.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);p.__decorate([t.aliasOf("viewModel.layer")],n.prototype,"layer",void 0);p.__decorate([w.property(),J.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],n.prototype,"messages",void 0);p.__decorate([t.aliasOf("viewModel.strict")],n.prototype,"strict",void 0);p.__decorate([t.aliasOf("viewModel.title")],n.prototype,"title",void 0);p.__decorate([w.property(),
K.vmEvent(["value-change","submit"])],n.prototype,"viewModel",void 0);p.__decorate([t.aliasOf("viewModel.getValues")],n.prototype,"getValues",null);p.__decorate([t.aliasOf("viewModel.submit")],n.prototype,"submit",null);return n=p.__decorate([D.subclass("esri.widgets.FeatureForm")],n)});