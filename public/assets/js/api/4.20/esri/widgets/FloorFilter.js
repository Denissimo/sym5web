// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/events ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ../chunks/ResizeObserver ./Widget ./FloorFilter/FloorFilterViewModel ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(x,l,k,C,D,p,I,J,K,L,u,E,F,G,y,v,q,z,f,A){const H=["ArrowUp","ArrowDown","End","Home"];k=function(B){function w(a,c){var b=B.call(this,a,c)||this;b._activeMenu=null;b._activeMenuIndex={levels:-1,menuItems:-1};b._baseNode=null;b._facilitiesListNode=null;b._levelsListNode=null;b._sitesListNode=null;b._searchInput=null;b.enabled=null;b.longNames=null;b.minimized=null;b.pinnedLevels=null;b.site=null;b.facility=null;b.level=null;b.view=null;b.viewModel=new y;b.messages=null;b.messagesCommon=null;
b.goToOverride=null;b.headingLevel=2;b._resizeObserver=new F.ResizeObserver(()=>b.scheduleRender());b.own(D.watch(x._assertThisInitialized(b),"_searchInput",()=>b._focusSearch()));return b}x._inheritsLoose(w,B);var g=w.prototype;g.destroy=function(){this._resizeObserver.disconnect()};g.updateWebDocument=function(){};g.render=function(){var a,{longNames:c}=this;c=c&&this.viewModel.isNormalMode?"expanded":"collapsed";var b=this.renderButtons();const e=this.renderFilterMenu(),d=f.tsx("div",{class:this.classes("esri-floor-filter__separator")});
var h=this._getComponentPosition();const m=this._getPosition(h),n="top-right"===h||"bottom-right"===h,r="top-left"===h||"bottom-left"===h,t=q.isRTL();h=t&&r||!t&&n?e:b;b=t&&r||!t&&n?b:e;return f.tsx("div",{afterCreate:this._afterBaseNodeCreate,key:"floor-filter-menu",class:this.classes("esri-floor-filter","esri-widget",`${"esri-floor-filter__layout--"}${c}`,`${"esri-floor-filter__position--"}${m}`)},h,(null==(a=this.viewModel)?void 0:a.filterMenuOpen)&&d,b)};g.renderButtons=function(){const a=this._getComponentPosition(),
c=[];"top"===this._getPosition(a)?(c.push(this.renderBrowseButton()),c.push(this.renderLevelButtons()),c.push(this.renderCloseLevelsButton()),c.push(this.renderZoomButton()),c.push(this.renderCollapseToggleButton())):(c.push(this.renderCollapseToggleButton()),c.push(this.renderZoomButton()),c.push(this.renderCloseLevelsButton()),c.push(this.renderLevelButtons()),c.push(this.renderBrowseButton()));return f.tsx("div",{key:"button-container",class:this.classes("esri-widget","esri-floor-filter__button-container")},
c)};g.renderBrowseButton=function(){var a;const {longNames:c,messages:b}=this;return f.tsx("button",{key:"browse-button",title:b.buttons.browse,bind:this,class:this.classes("esri-widget","esri-widget--button","esri-interactive",("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&"esri-button--disabled","esri-floor-filter__browse-button",(null==(a=this.viewModel)?void 0:a.filterMenuOpen)&&"esri-widget--button-active"),"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":b.buttons.browse,
onclick:this._toggleFilterMenu},f.tsx("div",{class:this.classes("esri-floor-filter__button-info")},f.tsx("span",{class:this.classes("esri-icon","esri-icon-urban-model")}),f.tsx("span",{class:this.classes("esri-floor-filter__button-label")},c&&this.viewModel.isNormalMode&&b.buttons.browse)))};g.renderLevelButtons=function(){var a,c,b,e,d;if(null==(a=this.viewModel)||null==(c=a.filterFeatures)||null==(b=c.levels)||!b.levelsInfo||!this.facility)return null;const {facility:h,messagesCommon:m,messages:n}=
this;a=null==(e=this.viewModel)?void 0:e.getFacility(h);e=(null==(d=this.viewModel)?void 0:d.getFacilityLevels(h)).map(r=>this.renderLevelButton(r));if(!e.length)return null;d=a&&A.substitute(n.selector.levelsLabel,{name:`"${a.name}"`});this._isWebScene(this.view.map)&&1<(null==e?void 0:e.length)&&(a=this.renderLevelButton({id:`all--${h}`,facilityId:h,shortName:m.all,longName:m.all,levelNumber:null,verticalOrder:null}),e.push(a));return f.tsx("ul",{key:"levels-button-container",class:this.classes("esri-floor-filter__levels-container"),
bind:this,"data-id":"levels",afterCreate:q.storeNode,"data-node-ref":"_levelsListNode","aria-label":d,onkeydown:this._handleListKeydown},e)};g.renderLevelButton=function(a){var {longNames:c}=this;const {shortName:b,longName:e,id:d}=a;a=this.level===d;c=c&&this.viewModel.isNormalMode?e:b;return this.viewModel.isNormalMode||a||this.viewModel.levelsExpanded?f.tsx("li",{key:`levels--${d}`},f.tsx("button",{"data-id":d,"data-list-id":"levels",bind:this,class:this.classes("esri-widget--button",a?"esri-widget--button-active":
null,"esri-interactive","esri-floor-filter__level-button"),onclick:this._levelSelected,onfocus:this._onItemFocus},c)):null};g.renderCloseLevelsButton=function(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const {messagesCommon:a}=this;return f.tsx("button",{key:"close-levels-button",title:a.close,bind:this,class:this.classes("esri-widget","esri-widget--button","esri-interactive","esri-floor-filter__close-levels-button"),"aria-label":a.close,onclick:this._closeLevels},
f.tsx("div",{class:this.classes("esri-floor-filter__button-info")},f.tsx("span",{class:this.classes("esri-icon","esri-icon-close")})))};g.renderZoomButton=function(){var a,c,b,e,d;const {longNames:h,messages:m,facility:n,site:r}=this,t=null==(a=this.viewModel)?void 0:a.filterMenuType;a=null==(c=this.viewModel)?void 0:c.filterMenuOpen;c=null==(b=this.viewModel)?void 0:b.getSite(r);b=null==(e=this.viewModel)?void 0:e.getFacility(n);return f.tsx("button",{key:"zoom-button",title:m.buttons.zoomTo,bind:this,
class:this.classes("esri-widget","esri-widget--button",("site"===t&&a?!c:!b)&&"esri-button--disabled","esri-interactive",0<(null==(d=this.viewModel)?void 0:d.getFacilityLevels(n).length)?"esri-floor-filter__zoom-button--levels":"esri-floor-filter__zoom-button"),"aria-label":m.buttons.zoomTo,onclick:this._zoomToClicked},f.tsx("div",{class:this.classes("esri-floor-filter__button-info")},f.tsx("span",{class:this.classes("esri-icon","esri-icon-zoom-to-object")}),f.tsx("span",{class:this.classes("esri-floor-filter__button-label")},
h&&this.viewModel.isNormalMode&&m.buttons.zoomTo)))};g.renderCollapseToggleButton=function(){const {longNames:a,messagesCommon:c}=this,b=this.classes("esri-icon",a?"esri-icon-collapse":"esri-icon-expand"),e=a?c.collapse:c.expand;return f.tsx("button",{key:"minimize-toggle-button",title:e,bind:this,class:this.classes("esri-widget","esri-widget--button","esri-interactive","esri-floor-filter__minimize-toggle-button"),"aria-label":e,onclick:this._toggleCollapsed},f.tsx("div",{class:this.classes("esri-floor-filter__button-info")},
f.tsx("span",{class:b}),f.tsx("span",{class:this.classes("esri-floor-filter__button-label")},a&&this.viewModel.isNormalMode&&c.collapse)))};g.renderFilterMenu=function(){var a,c,b;return null!=(a=this.viewModel)&&a.filterMenuOpen?"site"===(null==(c=this.viewModel)?void 0:c.filterMenuType)?this.renderSiteFilterMenu():"facility"===(null==(b=this.viewModel)?void 0:b.filterMenuType)?this.renderFacilityFilterMenu():null:null};g.renderSiteFilterMenu=function(){var a,c;const {messages:b,messagesCommon:e}=
this;var d=this.site?null==(a=this.viewModel)?void 0:null==(c=a.getSite(this.site))?void 0:c.name:b.selector.selectSite;a=f.tsx("div",{key:"filter-menu-site-header",class:this.classes("esri-floor-filter__filter-menu-header")},f.tsx("div",{class:this.classes("esri-floor-filter__filter-menu-header-text-group")},f.tsx(v.Heading,{level:this.headingLevel,class:this.classes("esri-floor-filter__filter-menu-header-text")},d)),f.tsx("button",{bind:this,title:e.close,class:this.classes("esri-icon","esri-icon-close"),
onclick:this._closeClicked}));c=this.renderSearchInput();d=this.renderSiteItems();return f.tsx("div",{key:"filter-menu-site",class:this.classes("esri-floor-filter__filter-menu")},a,c,d)};g.renderFacilityFilterMenu=function(){var a,c,b,e;const {messages:d,messagesCommon:h,site:m}=this;var n=null==(a=this.viewModel)?void 0:null==(c=a.getSite(m))?void 0:c.name;a=this.facility&&(null==(b=this.viewModel)?void 0:null==(e=b.getFacility(this.facility))?void 0:e.name)||d.selector.selectFacility;b=this.viewModel.hasMultipleSites?
f.tsx("button",{bind:this,title:h.back,class:this.classes("esri-floor-filter__filter-menu-header-back"),onclick:this._backClicked},f.tsx("span",{class:this.classes(q.isRTL()?"esri-icon-right":"esri-icon-left")})):null;n=this.viewModel.hasMultipleSites?f.tsx(v.Heading,{level:this.headingLevel+1,class:this.classes("esri-floor-filter__filter-menu-header-subtext")},n):null;n=f.tsx("div",{key:"filter-menu-site-header",class:this.classes("esri-floor-filter__filter-menu-header")},b,f.tsx("div",{class:this.classes("esri-floor-filter__filter-menu-header-text-group")},
f.tsx(v.Heading,{level:this.headingLevel,class:this.classes("esri-floor-filter__filter-menu-header-text")},a),n),f.tsx("button",{bind:this,title:h.close,class:this.classes("esri-icon","esri-icon-close"),onclick:this._closeClicked}));b=this.renderSearchInput();e=this.renderFacilityItems();return f.tsx("div",{key:"filter-menu-facility",class:this.classes("esri-floor-filter__filter-menu")},n,b,e)};g.renderSearchInput=function(){const {messagesCommon:a}=this;return f.tsx("div",{key:"filter-menu-search",
class:this.classes("esri-floor-filter__filter-menu-search")},f.tsx("span",{class:this.classes("esri-icon","esri-icon-search")}),f.tsx("input",{bind:this,key:"filter-menu-search__input",afterCreate:q.storeNode,"data-node-ref":"_searchInput",class:this.classes("esri-floor-filter__filter-menu-search-input"),placeholder:a.search,oninput:this._onSearchChange,onpaste:this._onSearchChange,value:this.viewModel.searchTerm}))};g.renderBlueCircle=function(){return f.tsx("span",{key:"floor-filter__selected-item-circle",
class:this.classes("esri-floor-filter__selected-item-circle")})};g.renderSiteItems=function(){var a,c,b,e;if(null==(a=this.viewModel)||null==(c=a.filterFeatures)||null==(b=c.sites)||!b.sitesInfo)return null;({messages:a}=this);c=this.viewModel.filterSites(this.viewModel.filterFeatures.sites.sitesInfo).map(d=>this.renderSiteItem(d));b=0===c.length&&(null==(e=this.viewModel)?void 0:e.searchTerm)&&f.tsx("div",{class:this.classes("esri-widget__content--empty")},a.noResults);return f.tsx("ul",{key:"filter-menu-items--sites",
class:this.classes("esri-floor-filter__filter-menu-items"),bind:this,afterCreate:q.storeNode,"data-node-ref":"_sitesListNode","data-id":"sites",onkeydown:this._handleListKeydown,tabIndex:-1,"aria-label":a.selector.sitesLabel},c,b)};g.renderSiteItem=function(a){const {name:c,id:b}=a;a=this.site===b;return f.tsx("li",{key:`filter-menu-site--${b}`},f.tsx("button",{"data-id":b,"data-list-id":"sites",bind:this,class:this.classes("esri-floor-filter__filter-menu-site"),onclick:this._siteSelected,onfocus:this._onItemFocus},
a&&this.renderBlueCircle(),f.tsx("span",{class:this.classes(a?"esri-floor-filter__filter-menu-item-name--selected":"esri-floor-filter__filter-menu-item-name")},c),f.tsx("span",{class:this.classes(q.isRTL()?"esri-icon-left":"esri-icon-right")})))};g.renderFacilityItems=function(){var a,c,b,e;if(null==(a=this.viewModel)||null==(c=a.filterFeatures)||null==(b=c.facilities)||!b.facilitiesInfo)return null;const {messages:d,site:h}=this;b=this.viewModel.getSite(h);a=this.viewModel.filterFacilities(this.viewModel.filterFeatures.facilities.facilitiesInfo).map(m=>
this.renderFacilityItem(m));c=0===a.length&&(null==(e=this.viewModel)?void 0:e.searchTerm)&&f.tsx("div",{class:this.classes("esri-widget__content--empty")},d.noResults);e=b?A.substitute(d.selector.siteFacilitiesLabel,{name:`"${b.name}"`}):d.selector.facilitiesLabel;return f.tsx("ul",{key:"filter-menu-items--facilities",class:this.classes("esri-floor-filter__filter-menu-items"),bind:this,afterCreate:q.storeNode,"data-node-ref":"_facilitiesListNode","data-id":"facilities",onkeydown:this._handleListKeydown,
tabIndex:-1,"aria-label":e},a,c)};g.renderFacilityItem=function(a){const {name:c,id:b}=a;a=this.facility===b;return f.tsx("li",{key:`filter-menu-facility--${b}`},f.tsx("button",{"data-id":b,"data-list-id":"facilities",bind:this,class:this.classes("esri-floor-filter__filter-menu-facility"),onclick:this._facilitySelected,onfocus:this._onItemFocus},a&&this.renderBlueCircle(),f.tsx("span",{class:this.classes(a?"esri-floor-filter__filter-menu-item-name--selected":"esri-floor-filter__filter-menu-item-name")},
c)))};g._afterBaseNodeCreate=function(a){var c;if(this._baseNode){var b;null==(b=this._resizeObserver)?void 0:b.unobserve(this._baseNode)}this._baseNode=a;null==(c=this._resizeObserver)?void 0:c.observe(this._baseNode)};g._toggleCollapsed=function(){this.longNames=!this.longNames};g._toggleFilterMenu=function(){var a,c;const b=null!=(a=null==(c=this.viewModel)?void 0:c.filterMenuOpen)?a:!1;this.viewModel.filterMenuOpen=!b};g._setFilterMenuType=function(a){this.viewModel.filterMenuType=a};g._zoomToClicked=
function(){var a,c;if(this.site&&"site"===(null==(a=this.viewModel)?void 0:a.filterMenuType)&&null!=(c=this.viewModel)&&c.filterMenuOpen){var b,e=null==(b=this.viewModel)?void 0:b.getSite(this.site);this.viewModel.goTo(e)}else if(this.facility)b=null==(e=this.viewModel)?void 0:e.getFacility(this.facility),this.viewModel.goTo(b);else if(this.site){var d;b=null==(d=this.viewModel)?void 0:d.getSite(this.site);this.viewModel.goTo(b)}};g._onSearchChange=function(a){var c;a=a.target;""===a.value?this.viewModel.searchTerm=
null:a.value&&(null==(c=this.viewModel)?void 0:c.searchTerm)!==a.value&&(this.viewModel.searchTerm=a.value.toLowerCase().trim())};g._closeClicked=function(){this.viewModel.searchTerm=null;this.viewModel.filterMenuOpen=!1};g._backClicked=function(){this._setFilterMenuType("site");this.viewModel.searchTerm=null};g._siteSelected=function(a){a=a.currentTarget.getAttribute("data-id");const c=this.viewModel.getSite(a);let b=!1;this.site!==a&&(this.level=this.facility=void 0,b=!0,this.viewModel.levelsExpanded=
!1);this.site=a;this.viewModel.searchTerm=null;this._setFilterMenuType("facility");this.viewModel.goTo(c);b&&this.viewModel.setFloors(null)};g._facilitySelected=function(a){a=a.currentTarget.getAttribute("data-id");const c=this.viewModel.getFacility(a);var b=!1;if(this.facility!==a){if("base-floors"===this.viewModel.filterMode){var e;this.level=(b=null==(e=this.viewModel)?void 0:e.getBaseLevel(c))?b.id:void 0}else this.level=void 0;b=!0;this.viewModel.levelsExpanded=!1}this.facility=a;this.viewModel.goTo(c);
b&&(e=this.viewModel.getLevel(this.level),this.viewModel.setFloors(e));this.viewModel.isNormalMode||(a=this.viewModel.getFacilityLevels(a),1<(null==a?void 0:a.length)&&(this.viewModel.levelsExpanded=!0));setTimeout(()=>{this._focusActiveLevel()},50)};g._levelSelected=function(a){this.level=a.currentTarget.getAttribute("data-id")};g._closeLevels=function(){this.viewModel.levelsExpanded=!1};g._isWebScene=function(a){return"esri.WebScene"===a.declaredClass};g._getComponentPosition=function(){var a,c;
return null==(a=this.view)?void 0:null==(c=a.ui)?void 0:c.getPosition(this.container)};g._getPosition=function(a){switch(a){case "bottom-right":case "bottom-left":return"bottom";default:return"top"}};g._handleListKeydown=function(a){var c=a.currentTarget.getAttribute("data-id");let b=null;"sites"===c||"facilities"===c?(this._activeMenu!==c&&(this._activeMenuIndex.menuItems=-1),this._activeMenu=c,b="menuItems"):"levels"===c&&(b="levels");var e="sites"===c?this._sitesListNode:"facilities"===c?this._facilitiesListNode:
"levels"===c?this._levelsListNode:null;c=C.eventKey(a);const d="Tab"===c,h=H.includes(c);h&&a.preventDefault();(e=null==e?void 0:e.getElementsByTagName("li"))&&0!==e.length&&(h||d)&&this.handleItemNavigation(c,a.shiftKey,e,d,b)};g.handleItemNavigation=function(a,c,b,e,d){if(d){this._activeMenuIndex[d]===b.length&&this._activeMenuIndex[d]--; -1===this._activeMenuIndex[d]&&this._activeMenuIndex[d]++;var h=this._activeMenuIndex[d];switch(a){case "Home":this._activeMenuIndex[d]=0;break;case "End":this._activeMenuIndex[d]=
b.length-1;break;case "ArrowUp":this._activeMenuIndex[d]=0>=this._activeMenuIndex[d]?b.length-1:this._activeMenuIndex[d]-1;break;case "ArrowDown":this._activeMenuIndex[d]=this._activeMenuIndex[d]===b.length-1?0:this._activeMenuIndex[d]+1}"Tab"===a&&c&&0<=this._activeMenuIndex[d]&&this._activeMenuIndex[d]--;"Tab"===a&&!c&&this._activeMenuIndex[d]<b.length&&this._activeMenuIndex[d]++;h!==this._activeMenuIndex[d]&&-1<this._activeMenuIndex[d]&&this._activeMenuIndex[d]<b.length&&!e&&(a=b[this._activeMenuIndex[d]].getElementsByTagName("button"),
a=1===(null==a?void 0:a.length)&&a[0],null==a?void 0:a.focus())}};g._focusSearch=function(){var a;null==(a=this._searchInput)?void 0:a.focus()};g._focusActiveLevel=function(){var a;const {level:c}=this;var b=this._levelsListNode;const e=null==b?void 0:b.getElementsByTagName("li");if(c&&b&&e){b=null==(a=this._facilitiesListNode)?void 0:a.getElementsByTagName("li");this._activeMenuIndex.menuItems=b?b.length-1:-1;a=[];for(b=0;b<e.length;b++){const d=e[b].getElementsByTagName("button");1===(null==d?void 0:
d.length)&&a.push(d[0])}a.forEach((d,h)=>{d.getAttribute("data-id")===c&&(d.focus(),this._activeMenuIndex.levels=h)})}};g._onItemFocus=function(a){var c=a.currentTarget;a=c.getAttribute("data-list-id");const b=c.getAttribute("data-id");if(c="sites"===a?this._sitesListNode:"facilities"===a?this._facilitiesListNode:"levels"===a?this._levelsListNode:null)if(c=null==c?void 0:c.getElementsByTagName("li")){var e=[];Array.from(c).forEach(h=>{h=h.getElementsByTagName("button");1===(null==h?void 0:h.length)&&
e.push(h[0])});var d=null;switch(a){case "sites":case "facilities":d="menuItems";break;case "levels":d="levels"}d&&e.forEach((h,m)=>{h.getAttribute("data-id")===b&&this._activeMenuIndex[d]!==m&&(this._activeMenuIndex[d]=m)})}};return w}(G);l.__decorate([u.property()],k.prototype,"_searchInput",void 0);l.__decorate([p.aliasOf("viewModel.enabled")],k.prototype,"enabled",void 0);l.__decorate([p.aliasOf("viewModel.longNames")],k.prototype,"longNames",void 0);l.__decorate([p.aliasOf("viewModel.minimized")],
k.prototype,"minimized",void 0);l.__decorate([p.aliasOf("viewModel.pinnedLevels")],k.prototype,"pinnedLevels",void 0);l.__decorate([p.aliasOf("viewModel.site")],k.prototype,"site",void 0);l.__decorate([p.aliasOf("viewModel.facility")],k.prototype,"facility",void 0);l.__decorate([p.aliasOf("viewModel.level")],k.prototype,"level",void 0);l.__decorate([p.aliasOf("viewModel.view")],k.prototype,"view",void 0);l.__decorate([u.property({type:y})],k.prototype,"viewModel",void 0);l.__decorate([u.property(),
z.messageBundle("esri/widgets/FloorFilter/t9n/FloorFilter")],k.prototype,"messages",void 0);l.__decorate([u.property(),z.messageBundle("esri/t9n/common")],k.prototype,"messagesCommon",void 0);l.__decorate([p.aliasOf("viewModel.goToOverride")],k.prototype,"goToOverride",void 0);l.__decorate([u.property()],k.prototype,"headingLevel",void 0);l.__decorate([p.aliasOf("viewModel.updateWebDocument")],k.prototype,"updateWebDocument",null);return k=l.__decorate([E.subclass("esri.widgets.FloorFilter")],k)});