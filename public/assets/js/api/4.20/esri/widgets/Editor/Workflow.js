// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/HandleOwner ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),function(d,f,n,c,p,g,r,t,u,v,q){c=function(m){function k(a){a=m.call(this,a)||this;a._indexHistory=[];a._lastStepIndex=-1;a._stepIndex=-1;a._handleKeys={afterCommit:"after-commit",
beforeCommit:"before-commit"};a.data=void 0;a.started=!1;a.steps=[];a.type=null;return a}d._inheritsLoose(k,m);var e=k.prototype;e.cancel=function(){var a=d._asyncToGenerator(function*(b={force:!0}){return!1!==b.force?this._cancel():new Promise((h,l)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel().then(h)},deny:()=>l(new n("workflow:cancel-denied","Request to cancel workflow was denied."))}})})});return function(){return a.apply(this,arguments)}}();e.commit=function(){var a=d._asyncToGenerator(function*(){this.handles.remove(this._handleKeys.beforeCommit);
yield this.onCommit(this.data);this.handles.remove(this._handleKeys.afterCommit);this.emit("commit");this.started&&(yield this.reset())});return function(){return a.apply(this,arguments)}}();e.go=function(){var a=d._asyncToGenerator(function*(b){var {steps:h}=this;h=h.findIndex(l=>l.id===b);this._indexHistory.push(this._stepIndex);yield this._go(h)});return function(b){return a.apply(this,arguments)}}();e.next=function(){var a=d._asyncToGenerator(function*(){this._indexHistory.push(this._stepIndex);
yield this._go(this._stepIndex+1)});return function(){return a.apply(this,arguments)}}();e.previous=function(){var a=d._asyncToGenerator(function*(b={cancelCurrentStep:!1}){yield this._go(this._indexHistory.pop(),b.cancelCurrentStep)});return function(){return a.apply(this,arguments)}}();e.reset=function(){var a=d._asyncToGenerator(function*(){yield this._cancel(!1);yield this.start()});return function(){return a.apply(this,arguments)}}();e.start=function(){var a=d._asyncToGenerator(function*(){this._set("started",
!0);yield this._go(-1===this._stepIndex?0:this._stepIndex)});return function(){return a.apply(this,arguments)}}();e._cancel=function(){var a=d._asyncToGenerator(function*(b=!0){this.started&&(this._set("started",!1),yield this.steps[this._stepIndex].tearDown({cancelled:!0}),this.data&&this.data.viewModel.sketchViewModel.layer.removeAll());this.handles.remove([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]);this._resetIndexing(b);b&&this.emit("cancel")});return function(){return a.apply(this,
arguments)}}();e._go=function(){var a=d._asyncToGenerator(function*(b=-1,h=!1){-1>=b||b>=this.steps.length||(this.started&&(-1<this._lastStepIndex&&(yield this.steps[this._lastStepIndex].tearDown({cancelled:h})),yield this.steps[b].setUp(),this._lastStepIndex=b),this._stepIndex=b,this._notifyStepProps())});return function(){return a.apply(this,arguments)}}();e._resetIndexing=function(a=!0){this._lastStepIndex=this._stepIndex=-1;this._indexHistory.length=0;a&&this._notifyStepProps()};e._notifyStepProps=
function(){this.notifyChange("stepId");this.notifyChange("hasPreviousStep");this.notifyChange("hasNextStep")};d._createClass(k,[{key:"hasNextStep",get:function(){const {steps:a}=this;return!!(a&&this._stepIndex<a.filter(b=>!b.parent).length-1)}},{key:"hasPreviousStep",get:function(){return 0<this._stepIndex}},{key:"stepId",get:function(){var {steps:a}=this;return(a=a&&a[this._stepIndex])&&a.id}}]);return k}(p.HandleOwnerMixin(c.EventedAccessor));f.__decorate([g.property()],c.prototype,"data",void 0);
f.__decorate([g.property()],c.prototype,"hasNextStep",null);f.__decorate([g.property()],c.prototype,"hasPreviousStep",null);f.__decorate([g.property()],c.prototype,"onCommit",void 0);f.__decorate([g.property()],c.prototype,"started",void 0);f.__decorate([g.property({readOnly:!0})],c.prototype,"stepId",null);f.__decorate([g.property()],c.prototype,"steps",void 0);f.__decorate([g.property({readOnly:!0})],c.prototype,"type",void 0);f.__decorate([g.property()],c.prototype,"commit",null);return c=f.__decorate([q.subclass("esri.widgets.Editor.Workflow")],
c)});