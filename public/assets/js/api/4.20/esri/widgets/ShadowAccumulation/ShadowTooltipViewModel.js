// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/trackingUtils".split(" "),function(c,r,e,v,w,x,m,y,t,u,f,D,E,F,G,z,
A){var g;(function(k){k.PointerMove="pointer-move";k.Main="main"})(g||(g={}));c.ShadowTooltipViewModel=function(k){function n(b){var a=k.call(this,b)||this;a._handles=new w;a._screenPoint=null;a._accumulatedShadowTime=null;a._shadowTimeTask=null;a._updateAccumulatedShadowTime=(l,h)=>{a._shadowTimeTask=m.abortMaybe(a._shadowTimeTask);a._shadowTimeTask=y.createTask(function(){var d=r._asyncToGenerator(function*(p){const {results:B,ground:C}=yield l.hitTest(h);0!==B.length||C.mapPoint?(p=yield a.getDuration(h,
p),a._accumulatedShadowTime=p):a._accumulatedShadowTime=null});return function(p){return d.apply(this,arguments)}}())};a._throttledUpdateAccumulatedShadowTime=u.throttle(a._updateAccumulatedShadowTime,300);return a}r._inheritsLoose(n,k);var q=n.prototype;q.initialize=function(){this._handles.add(A.reactionInit(()=>({enabled:this.enabled,view:this.view}),({enabled:b,view:a})=>{b&&m.isSome(a)?this._startTracking(a):this._stopTracking()}))};q.destroy=function(){this._handles=m.destroyMaybe(this._handles)};
q._startTracking=function(b){const a=this._handles;if(!a.has(g.Main)){var l=()=>{a.has(g.PointerMove)||a.add(b.on("pointer-move",d=>{this._screenPoint=d=t.createScreenPoint(d.x,d.y);this._throttledUpdateAccumulatedShadowTime(b,d)}),g.PointerMove)},h=()=>{a.remove(g.PointerMove);this._accumulatedShadowTime=this._screenPoint=null};a.add([this._throttledUpdateAccumulatedShadowTime,b.on("pointer-enter",l),b.on("pointer-leave",h),b.on("pointer-down",h),b.on("pointer-drag",h),b.on("pointer-up",l),b.on("click",
d=>{this._screenPoint=d=t.createScreenPoint(d.x,d.y);this._updateAccumulatedShadowTime(b,d)}),x.makeHandle(()=>{this._shadowTimeTask=m.abortMaybe(this._shadowTimeTask)})],g.Main);l()}};q._stopTracking=function(){this._handles.remove(g.Main)};r._createClass(n,[{key:"screenPoint",get:function(){return this.enabled?this._screenPoint:null}},{key:"accumulatedShadowTime",get:function(){return this.enabled?this._accumulatedShadowTime:null}},{key:"testData",get:function(){return{setThrottleDelay:b=>{this._throttledUpdateAccumulatedShadowTime.remove();
this._throttledUpdateAccumulatedShadowTime=u.throttle(this._updateAccumulatedShadowTime,b)}}}}]);return n}(v);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"getDuration",void 0);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"view",void 0);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"enabled",void 0);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"screenPoint",null);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"accumulatedShadowTime",
null);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"_screenPoint",void 0);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"_accumulatedShadowTime",void 0);e.__decorate([f.property()],c.ShadowTooltipViewModel.prototype,"_shadowTimeTask",void 0);c.ShadowTooltipViewModel=e.__decorate([z.subclass("esri.widgets.ShadowAccumulation.ShadowTooltipViewModel")],c.ShadowTooltipViewModel);Object.defineProperty(c,"__esModule",{value:!0})});