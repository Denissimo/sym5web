// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/handleUtils ../../core/maybe ../../core/memoize ../../core/SetUtils ../../core/unitUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../chunks/vec3 ../../chunks/vec4f64 ../../geometry/projectionEllipsoid ../../geometry/support/ray ../../layers/support/ElevationQuery ../../views/3d/webgl-engine/lib/Intersector ../../views/3d/webgl-engine/lib/intersectorUtilsConversions ./ElevationProfileLine".split(" "),
function(v,f,B,I,g,J,K,L,w,h,e,X,Y,Z,M,N,C,O,D,P,Q,R,S){function T({view:k,inputGraphicUid:l,maxIntersectionDistance:r},a){for(let b=0;b<a.length;b++){const c=a[b];if(c.distanceInRenderSpace>r)continue;const d=R.toGraphic(c,k);if(g.isNone(d)||E(d)!==l)return c}return null}function E(k){if(k.layer&&"objectIdField"in k.layer){const l=k.attributes[k.layer.objectIdField];if(l)return`o-${k.layer.id}-${l}`}return`u-${k.uid}`}e=function(k){function l(a){a=k.call(this,a)||this;a.type="view";a.color=new B("#cf4ccf");
a.viewVisualizationEnabled=!0;a.include=null;a.exclude=null;a.numSamplesForPreview=50;a.numSamplesPerChunk=25;a._getQueryElevationDependencies=J.memoize((b,c,d,m,x,t,n)=>({inputGraphicUid:g.isSome(b)?E(b):null,visibleLayers:c,maxIntersectionDistance:d,intersectOptions:m,view:x,stationary:t,spatialReference:n}));a._vecA=C.create();a._vecB=C.create();a._ray=D.create();return a}v._inheritsLoose(l,k);var r=l.prototype;r.queryElevation=function(){var a=v._asyncToGenerator(function*(b,{noDataValue:c,signal:d}){const m=
this.queryElevationDependencies;if(g.isNone(m))throw Error("ElevationProfileLineInput: no dependencies");const {intersectOptions:x,view:t,spatialReference:n}=m,y=t.renderCoordsHelper,U=t.sceneIntersectionHelper,F=this._intersector,G=this._vecA,u=this._vecA,p=this._vecB,V=this._ray;b=yield P.GeometryDescriptor.fromGeometry(b).project(n,d);d=b.coordinates;const W=d.length;for(let z=0;z<W;++z){var H;const q=d[z];N.set(p,q.x,q.y,null!=(H=q.z)?H:0);y.toRenderCoords(p,n,p);y.setAltitude(G,2E5,p);var A=
D.fromPoints(G,p,V);U.computeIntersection(A,F,x);(A=T(m,F.results.all))?(A.getIntersectionPoint(u),y.fromRenderCoords(u,u,n),q.z=u[2]):q.z=c}return{geometry:b.export(),noDataValue:c}});return function(b,c){return a.apply(this,arguments)}}();r.attach=function(a){const b=()=>this._onChange();return I.handlesGroup([k.prototype.attach.call(this,a),this.watch("queryElevationDependencies",b),w.on(this,"include","change",b,b,b),w.on(this,"exclude","change",b,b,b),w.on(a,"view.elevationProvider","elevation-change",
b)])};v._createClass(l,[{key:"minDemResolution",get:function(){var a,b,c;const d=null==(a=this._viewModel)?void 0:a.view;return g.isNone(d)||"3d"!==d.type?null:(a=null==(b=d.pointsOfInterest)?void 0:null==(c=b.focus)?void 0:c.renderLocation)?d.state.camera.computeRenderPixelSizeAt(a)*L.getMetersPerVerticalUnitForSR(d.spatialReference):null}},{key:"queryElevationDependencies",get:function(){return g.applySome(this._view,a=>this._getQueryElevationDependencies(this._viewModel.input,this._visibleLayers,
this._maxIntersectionDistance,this._intersectOptions,a,a.stationary,a.spatialReference))}},{key:"_visibleLayers",get:function(){const a=g.applySome(this._view,b=>{var c,d;return null==(c=b.map)?void 0:null==(d=c.allLayers)?void 0:d.filter(m=>m.visible).toArray()});return g.unwrapOr(a,[])}},{key:"_intersectOptions",get:function(){var a=this._view;if(g.isNone(a))return{};const b=a.externalToInternalIntersectOptions({include:this.include,exclude:this.exclude});a=a.externalToInternalIntersectOptions({exclude:this._pointCloudLayers});
b.exclude=K.union(b.exclude,a.exclude);return b}},{key:"_pointCloudLayers",get:function(){const a=this._view;return g.isNone(a)?[]:a.allLayerViews.toArray().filter(b=>{var c;return"point-cloud"===(null==(c=b.layer)?void 0:c.type)}).map(b=>b.layer)}},{key:"_view",get:function(){const a=this._viewModel.view;return g.isSome(a)&&"3d"===a.type?a:null}},{key:"_maxIntersectionDistance",get:function(){const a=this._view;return g.isNone(a)||!a.renderCoordsHelper?Number.POSITIVE_INFINITY:O.getReferenceEllipsoid(a.spatialReference).radius/
a.renderCoordsHelper.unitInMeters}},{key:"_intersector",get:function(){var a=this._view;if(g.isNone(a))return null;a=new Q.Intersector(a.state.viewingMode);const b=a.options;b.hud=!1;b.invisibleTerrain=!1;b.backfacesTerrain=!1;b.selectionMode=!1;b.store=2;return a}}]);return l}(S.ElevationProfileLine);f.__decorate([h.property({type:B,nonNullable:!0})],e.prototype,"color",void 0);f.__decorate([h.property()],e.prototype,"viewVisualizationEnabled",void 0);f.__decorate([h.property()],e.prototype,"include",
void 0);f.__decorate([h.property()],e.prototype,"exclude",void 0);f.__decorate([h.property({readOnly:!0})],e.prototype,"minDemResolution",null);f.__decorate([h.property()],e.prototype,"queryElevationDependencies",null);f.__decorate([h.property()],e.prototype,"_visibleLayers",null);f.__decorate([h.property()],e.prototype,"_intersectOptions",null);f.__decorate([h.property()],e.prototype,"_pointCloudLayers",null);f.__decorate([h.property()],e.prototype,"_view",null);f.__decorate([h.property()],e.prototype,
"_maxIntersectionDistance",null);f.__decorate([h.property()],e.prototype,"_intersector",null);return e=f.__decorate([M.subclass("esri.widgets.ElevationProfile.ElevationProfileLineView")],e)});