// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),function(A,m,h,n,F,G,H,I,C,D,E,l,x){h=function(B){function y(a){a=
B.call(this,a)||this;a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.expressionAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}A._inheritsLoose(y,B);var r=y.prototype;r.setActiveMedia=function(a){this._setContentElementMedia(a)};r.next=function(){this._pageContentElementMedia(1)};r.previous=function(){this._pageContentElementMedia(-1)};r._setContentElementMedia=function(a){const {formattedMediaInfoCount:b}=
this;this.activeMediaInfoIndex=(a+b)%b};r._pageContentElementMedia=function(a){const {activeMediaInfoIndex:b}=this;this._setContentElementMedia(b+a)};r._formatMediaInfos=function(){const {attributes:a,mediaInfos:b,formattedAttributes:d,expressionAttributes:k,fieldInfoMap:e,layer:f}=this;return null==b?void 0:b.map(c=>{if(!c)return null;c.title=l.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:e,globalAttributes:d,expressionAttributes:k,layer:f,text:c.title});c.caption=l.substituteFieldsInLinksAndAttributes({attributes:a,
fieldInfoMap:e,globalAttributes:d,expressionAttributes:k,layer:f,text:c.caption});c.altText=l.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:e,globalAttributes:d,expressionAttributes:k,layer:f,text:c.altText});if("image"===c.type){var {value:p}=c;this._setImageValue({value:p,formattedAttributes:d,layer:f});return c.value.sourceURL?c:void 0}return"pie-chart"===c.type||"line-chart"===c.type||"column-chart"===c.type||"bar-chart"===c.type?({value:p}=c,this._setChartValue({value:p,chartType:c.type,
attributes:a,formattedAttributes:d,layer:f}),c):null}).filter(Boolean)};r._setImageValue=function(a){const {fieldInfoMap:b}=this,{value:d,formattedAttributes:k,layer:e}=a,{linkURL:f,sourceURL:c}=d;c&&(a=l.fixTokens(c,e),d.sourceURL=l.substituteAttributes({formattedAttributes:k,template:a,fieldInfoMap:b}));f&&(a=l.fixTokens(f,e),d.linkURL=l.substituteAttributes({formattedAttributes:k,template:a,fieldInfoMap:b}))};r._setChartValue=function(a){const {value:b,attributes:d,formattedAttributes:k,chartType:e,
layer:f}=a,{popupTemplate:c,relatedInfos:p}=this,{fields:q,normalizeField:v}=b;b.fields=l.getFixedFieldNames(q,f);v&&(b.normalizeField=l.getFixedFieldName(v,f));if(q.some(g=>!!(null!=k[g]||l.isRelatedField(g)&&p.size))){var u=null==c?void 0:c.fieldInfos;q.forEach(g=>{l.isRelatedField(g)?b.series=[...b.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:g,formattedAttributes:k,chartType:e,value:b})]:(g=this._getChartOption({value:b,attributes:d,chartType:e,formattedAttributes:k,fieldName:g,
fieldInfos:u}),b.series.push(g))})}};r._getRelatedChartInfos=function(a){var b;const {fieldInfos:d,fieldName:k,formattedAttributes:e,chartType:f,value:c}=a,p=[];a=x.getRelatedFieldInfo(k);const {layerId:q,fieldName:v}=a;a=null==(b=this.relatedInfos)?void 0:b.get(q.toString());if(!a)return p;const {relatedFeatures:u,relation:g}=a;if(!g||!u)return p;({cardinality:b}=g);u.forEach(z=>{const {attributes:t}=z;t&&Object.keys(t).forEach(w=>{w===v&&p.push(this._getChartOption({value:c,attributes:t,formattedAttributes:e,
fieldName:k,chartType:f,relatedFieldName:w,fieldInfos:d}))})});return"one-to-many"===b||"many-to-many"===b?p:[p[0]]};r._getTooltip=function({label:a,value:b,chartType:d}){return"pie-chart"===d?a:`${a}: ${b}`};r._getChartOption=function(a){const {value:b,attributes:d,formattedAttributes:k,fieldName:e,relatedFieldName:f,fieldInfos:c,chartType:p}=a;var {layer:q}=this;const {normalizeField:v,tooltipField:u}=b;var g=v?l.isRelatedField(v)?d[x.getRelatedFieldInfo(v).fieldName]:d[v]:null;a=f&&void 0!==d[f]?
d[f]:void 0!==d[e]?d[e]:k[e];const z=void 0===a?null:a&&g?a/g:a;a=new E({value:z});if(l.isRelatedField(e)){var t=x.getRelatedFieldInfo(e);var w=x.getRelatedFieldInfo(u);w=w?w.fieldName:null;q=l.formatValueToFieldInfo(z,{fieldInfos:c,fieldName:f,layer:q,preventPlacesFormatting:!!g});t=t?t.label||t.fieldName:f;a.tooltip=this._getTooltip({label:w&&void 0!==d[w]?d[w]:t,value:q,chartType:p});return a}g=l.getFieldInfo(c,e);q=l.getFixedFieldName(e,q);g=u&&void 0!==k[u]?k[u]:l.getFieldInfoLabel(g||new D({fieldName:q}),
null==(t=this.popupTemplate)?void 0:t.expressionInfos);a.tooltip=this._getTooltip({label:g,value:k[q],chartType:p});return a};A._createClass(y,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return y}(h);m.__decorate([n.property()],h.prototype,"activeMediaInfoIndex",void 0);
m.__decorate([n.property({readOnly:!0})],h.prototype,"activeMediaInfo",null);m.__decorate([n.property()],h.prototype,"attributes",void 0);m.__decorate([n.property()],h.prototype,"description",void 0);m.__decorate([n.property()],h.prototype,"fieldInfoMap",void 0);m.__decorate([n.property()],h.prototype,"formattedAttributes",void 0);m.__decorate([n.property()],h.prototype,"expressionAttributes",void 0);m.__decorate([n.property({readOnly:!0})],h.prototype,"formattedMediaInfos",null);m.__decorate([n.property()],
h.prototype,"layer",void 0);m.__decorate([n.property({readOnly:!0})],h.prototype,"formattedMediaInfoCount",null);m.__decorate([n.property()],h.prototype,"mediaInfos",void 0);m.__decorate([n.property()],h.prototype,"popupTemplate",void 0);m.__decorate([n.property()],h.prototype,"relatedInfos",void 0);m.__decorate([n.property()],h.prototype,"title",void 0);return h=m.__decorate([C.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],h)});