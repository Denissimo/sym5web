// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),function(u,p,d,q,c,e,x,y,z,A,v,w,r){var n;c=n=function(t){function m(...a){a=t.call(this,...a)||this;a.access=null;a.created=null;a.culture=null;a.description=null;a.email=null;a.fullName=
null;a.modified=null;a.orgId=null;a.portal=null;a.preferredView=null;a.privileges=null;a.region=null;a.role=null;a.roleId=null;a.sourceJSON=null;a.units=null;a.username=null;a.userType=null;return a}p._inheritsLoose(m,t);var h=m.prototype;h.addItem=function(a){const b=a&&a.item;var g=a&&a.data;a=a&&a.folder;const f={method:"post"};b&&(f.query=b.createPostQuery(),null!=g&&("string"===typeof g?f.query.text=g:"object"===typeof g&&(f.query.text=JSON.stringify(g))));g=this.userContentUrl;a&&(g+="/"+("string"===
typeof a?a:a.id));return this.portal._request(g+"/addItem",f).then(l=>{b.id=l.id;b.portal=this.portal;return b.loaded?b.reload():b.load()})};h.deleteItem=function(a){let b=this.userContentUrl;a.ownerFolder&&(b+="/"+a.ownerFolder);return this.portal._request(b+`/items/${a.id}/delete`,{method:"post"}).then(()=>{a.id=null;a.portal=null})};h.deleteItems=function(a){const b=this.userContentUrl+"/deleteItems";var g=a.map(f=>f.id);return g.length?(g={method:"post",query:{items:g.join(",")}},this.portal._request(b,
g).then(()=>{a.forEach(f=>{f.id=null;f.portal=null})})):Promise.resolve(void 0)};h.fetchFolders=function(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then(a=>a&&a.folders?a.folders.map(b=>{b=w.fromJSON(b);b.portal=this.portal;return b}):[])};h.fetchGroups=function(){return this.portal._request(this.url).then(a=>a&&a.groups?a.groups.map(b=>{b=r.fromJSON(b);b.portal=this.portal;return b}):[])};h.fetchItems=function(a){a||(a={});let b=this.userContentUrl;a.folder&&(b+="/"+a.folder.id);
let g;return(new Promise(function(f,l){u(["./PortalItem"],function(k){f(Object.freeze({__proto__:null,"default":k}))},l)})).then(({default:f})=>{g=f;return this.portal._request(b,{query:{folders:!1,num:a.num||10,start:a.start||1,sortField:a.sortField||"created",sortOrder:a.sortOrder||"asc"}})}).then(f=>{let l;return f&&f.items?(l=f.items.map(k=>{k=g.fromJSON(k);k.portal=this.portal;return k}),Promise.all(l.map(k=>k.load())).catch(k=>k).then(()=>({items:l,nextStart:f.nextStart,total:f.total}))):{items:[],
nextStart:-1,total:0}})};h.fetchTags=function(){return this.portal._request(this.url+"/tags").then(a=>a.tags)};h.getThumbnailUrl=function(a){let b=this.thumbnailUrl;b&&a&&(b+=`&w=${a}`);return b};h.queryFavorites=function(a){return this.favGroupId?(this._favGroup||(this._favGroup=new r({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(a)):Promise.reject(new q("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))};h.toJSON=function(){throw new q("internal:not-yet-implemented",
"PortalGroup.toJSON is not yet implemented");};m.fromJSON=function(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");const b=new n;b.sourceJSON=a;b.read(a);return b};p._createClass(m,[{key:"thumbnailUrl",get:function(){const a=this.url,b=this.thumbnail;return a&&b?this.portal._normalizeUrl(`${a}/info/${b}?f=json`):null}},{key:"userContentUrl",get:function(){const a=this.get("portal.restUrl");return a?`${a}/content/users/${this.username}`:null}},{key:"url",get:function(){const a=
this.get("portal.restUrl");return a?`${a}/community/users/${this.username}`:null}}]);return m}(c.JSONSupport);d.__decorate([e.property()],c.prototype,"access",void 0);d.__decorate([e.property({type:Date})],c.prototype,"created",void 0);d.__decorate([e.property()],c.prototype,"culture",void 0);d.__decorate([e.property()],c.prototype,"description",void 0);d.__decorate([e.property()],c.prototype,"email",void 0);d.__decorate([e.property()],c.prototype,"favGroupId",void 0);d.__decorate([e.property()],
c.prototype,"fullName",void 0);d.__decorate([e.property({type:Date})],c.prototype,"modified",void 0);d.__decorate([e.property()],c.prototype,"orgId",void 0);d.__decorate([e.property()],c.prototype,"portal",void 0);d.__decorate([e.property()],c.prototype,"preferredView",void 0);d.__decorate([e.property()],c.prototype,"privileges",void 0);d.__decorate([e.property()],c.prototype,"region",void 0);d.__decorate([e.property()],c.prototype,"role",void 0);d.__decorate([e.property()],c.prototype,"roleId",void 0);
d.__decorate([e.property()],c.prototype,"sourceJSON",void 0);d.__decorate([e.property()],c.prototype,"thumbnail",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"thumbnailUrl",null);d.__decorate([e.property()],c.prototype,"units",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"userContentUrl",null);d.__decorate([e.property({readOnly:!0})],c.prototype,"url",null);d.__decorate([e.property()],c.prototype,"username",void 0);d.__decorate([e.property()],c.prototype,"userType",
void 0);return c=n=d.__decorate([v.subclass("esri.portal.PortalUser")],c)});