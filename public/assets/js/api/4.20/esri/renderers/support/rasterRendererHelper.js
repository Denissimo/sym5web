// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../rasterRenderers ../../core/maybe ../../core/unitUtils ../../layers/support/Field ../../layers/support/RasterInfo ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./UniqueValueInfo ../../rest/support/AlgorithmicColorRamp ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),
function(m,x,la,h,W,X,Y,H,Z,z,I,aa,ba,ca,B,da,ea,fa,ha,ia,ja){function J(a,b){var d,c,e,f;a=K(a,null==b?void 0:b.variableName);const {bandCount:l}=a;let {bandIds:n,stretchType:q}=b||{};null!=(d=n)&&d.some(u=>u>=l)&&(n=null);let t=h.unwrap(a.statistics),k=h.unwrap(a.histograms);if(1<l){var v;n=null!=(v=n)&&v.length?n:L(a);t=null==t?null:n.map(u=>t[u]);k=null==k?null:n.map(u=>k[u])}else n=[0];null==q&&(q=ka(a));d=!1;switch(q){case "none":d=!1;break;case "percent-clip":d=!(null!=(c=k)&&c.length);break;
default:d=!(null!=(e=t)&&e.length)}({dataType:c}=a);c=1===(null==(f=n)?void 0:f.length)&&M.has(c)?N:null;f=new da({stretchType:q,dynamicRangeAdjustment:d,colorRamp:c,outputMin:0,outputMax:255,gamma:1===n.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===q?f.maxPercent=f.minPercent=.25:"standard-deviation"===q&&(f.numberOfStandardDeviations=2);if(!d&&(h.isSome(a.multidimensionalInfo)||null!=b&&b.includeStatisticsInStretch))if("percent-clip"===q)f.histograms=k;else if("min-max"===q||"standard-deviation"===
q)f.statistics=t;return f}function K(a,b){if(null==b)return a;let d=h.unwrap(a.statistics),c=h.unwrap(a.histograms);const {multidimensionalInfo:e}=a;if(b&&h.isSome(e)){const {statistics:f,histograms:l}=e.variables.find(n=>n.name===b);null!=f&&f.length&&(d=f);null!=l&&l.length&&(c=l)}return Y.fromJSON({...a.toJSON(),statistics:d,histograms:c})}function L(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;let d;if(a&&a.length===b){const {red:c,
green:e,blue:f,nir:l}=O(a);null!=c&&null!=e&&null!=f?d=[c,e,f]:null!=l&&null!=c&&null!=e&&(d=[l,c,e])}!d&&3<=b&&(d=[0,1,2]);return d}function O(a){const b={};for(let f=0;f<a.length;f++){var d,c=a[f],e=null==(d=c.BandName)?void 0:d.toLowerCase();"red"===e?b.red=f:"green"===e?b.green=f:"blue"===e?b.blue=f:"nearinfrared"===e||"nearinfrared_1"===e||"nir"===e?b.nir=f:c.WavelengthMax&&c.WavelengthMin&&(e=c.WavelengthMin,c=c.WavelengthMax,null==b.blue&&410<=e&&480>=e&&480<=c&&540>=c?b.blue=f:null==b.green&&
490<=e&&560>=e&&560<=c&&610>=c?b.green=f:null==b.red&&595<=e&&670>=e&&660<=c&&730>=c?b.red=f:null==b.nir&&700<=e&&860>=e&&800<=c&&950>=c&&(b.nir=f))}return b}function ka(a){let b="percent-clip";const {pixelType:d,dataType:c,histograms:e,statistics:f}=a;"u8"!==d||"processed"!==c&&h.isSome(e)&&h.isSome(f)?"u8"===d||"elevation"===c||M.has(c)?b="min-max":h.isSome(e)?b="percent-clip":h.isSome(f)&&(b=b="min-max"):b="none";return b}function P(a,b,d,c){if(!C(a,b))return null;const {attributeTable:e,statistics:f}=
a,l=D(e,b),n=y(e,"red"),q=y(e,"green"),t=y(e,"blue");a=new H;const k=[],v=new Set,u=!!(n&&q&&t);if(h.isSome(e))e.features.forEach(p=>{var g=p.attributes[l.name];v.has(p.attributes[l.name])||null==g||(v.add(g),g=!u||"single"!==n.type&&"double"!==n.type||"single"!==q.type&&"double"!==q.type||"single"!==t.type&&"double"!==t.type||e.features.some(r=>1<r.attributes[n.name]||1<r.attributes[q.name]||1<r.attributes[t.name])?1:255,k.push(new I({value:p.attributes[l.name],label:p.attributes[l.name]+"",symbol:{type:"simple-fill",
style:"solid",outline:null,color:u?new x([p.attributes[n.name]*g,p.attributes[q.name]*g,p.attributes[t.name]*g,1]):new x([0,0,0,0])}})))});else if(null!=f&&f[0])for(b=f[0].min;b<=f[0].max;b++)k.push(new I({value:b,label:b.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new x([0,0,0,0])}}));k.sort((p,g)=>p.value&&"string"===typeof p.value.valueOf()?0:p.value>g.value?1:-1);if(!u){const p=z.convertColorRampToColormap(Q,k.length);k.forEach((g,r)=>g.symbol.color=new x(p[r].slice(1,
4)));a.colorRamp=Q}if(d||c){const p=d||z.convertColorRampToColormap(c,k.length).map(g=>g.slice(1));k.forEach((g,r)=>g.symbol.color=new x(p[r]));a.colorRamp=c}return new ea({field:l.name,uniqueValueInfos:k,authoringInfo:a})}function D(a,b){let d;h.isSome(a)?(d=b?a.fields.find(c=>b.toLowerCase()===c.name.toLowerCase()):a.fields.find(c=>"string"===c.type&&-1<c.name.toLowerCase().indexOf("class")),d||(d=a.fields.find(c=>"string"===c.type))||(d=y(a,"value"))):d=new X({name:"value"});return d}function y(a,
b){return h.isSome(a)?a.fields.find(d=>d.name.toLowerCase()===b):null}function C(a,b){const {attributeTable:d,bandCount:c}=a;return!h.isSome(d)&&R(a)?!0:!h.isSome(d)||1<c||b&&null==d.fields.find(e=>e.name.toLowerCase()===b.toLowerCase())?!1:!0}function E(a){const {bandCount:b,colormap:d}=a;return h.isSome(d)&&d.length&&1===b}function S(a){if(!E(a))return null;let b;const {attributeTable:d,colormap:c}=a;if(h.isSome(d)){const e=y(d,"value"),f=D(d);"string"===f.type&&(b={},d.features.forEach(l=>{l=l.attributes;
b[l[e.name]]=f?l[f.name]:l[e.name]}))}return fa.createFromColormap(h.unwrap(c),b)}function F(a){return"elevation"===a.dataType}function G(a){const {attributeTable:b,bandCount:d}=a;return 1===d&&(h.isSome(b)||h.isSome(a.histograms))}function R(a){var b,d,c;return-1<["u8","s8"].indexOf(a.pixelType)&&null!=(null==(b=a.statistics)?void 0:null==(d=b[0])?void 0:d.min)&&null!=(null==(c=a.statistics[0])?void 0:c.max)&&1===a.bandCount}function A(a){var b;const {dataType:d}=a;return!(null!=(b=a.storageInfo)&&
b.tileInfo)&&("vector-uv"===d||"vector-magdir"===d)}function T(a){if(!A(a))return null;let b;if(h.isSome(a.statistics)){var d,c;b=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:null==(d=a.statistics[0])?void 0:d.min,maxDataValue:null==(c=a.statistics[0])?void 0:c.max}]}a=new ja({visualVariables:b});a.visualVariables=[...a.sizeVariables,...a.rotationVariables];return a}function U(a){var b;return{color:null==(b=a.symbolLayers[0].material)?void 0:b.color,type:"esriSFS",style:"esriSFSSolid"}}
const N=B.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),Q=B.fromJSON(z.PREDEFINED_JSON_COLOR_RAMPS[0]),M=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" "));m.createClassBreaksRenderer=function(a,b){a=K(a,null==b?void 0:b.variableName);const {attributeTable:d}=a;if(!G(a))return null;const c=h.isSome(a.histograms)?
a.histograms[0]:null;var e=(null==b?void 0:b.numClasses)||5;const f=new H({classificationMethod:null==b?void 0:b.classificationMethod,colorRamp:null==b?void 0:b.colorRamp});let l=(null==b?void 0:b.field)||"value";const n=[],q=[];if(h.isSome(d)){const k=d.fields.find(g=>"count"===g.name.toLowerCase()),v=d.fields.find(g=>g.name.toLowerCase()===l.toLowerCase());l=v.name;const u=d.features.length;let p=0;d.features.forEach(g=>p+=g.attributes[k.name]/u);d.features.forEach(g=>{const r=g.attributes[v.name];
g=g.attributes[k.name];if(0<g){q.push(g);g=Math.max(1,Math.round(g/u/p*1E3));for(let w=0;w<g;w++)n.push(r)}})}else{({pixelType:a}=a);const k=(c.max-c.min)/c.size,v=(a=-1<a.indexOf("s")||-1<a.indexOf("u"))&&1===k?Math.floor(c.min+.5):c.min,u=a&&1===k?Math.floor(c.max-.5):c.max,p=c.size;let g=0;c.counts.forEach(r=>g+=r/p);c.counts.forEach((r,w)=>{if(0<r){q.push(r);r=Math.max(1,Math.round(r/p/g*1E3));w=0===w?v:w===p-1?u:c.min+k*(w+.5);for(let V=0;V<r;V++)n.push(w)}})}e=ca.createGenerateRendererClassBreaks({values:n,
valueFrequency:q,normalizationTotal:null,definition:new ba({classificationMethod:(null==b?void 0:b.classificationMethod)||"natural-breaks",breakCount:e,definedInterval:null==b?void 0:b.definedInterval})});let t=null==b?void 0:b.colors;t||(b=(null==b?void 0:b.colorRamp)||N,f.colorRamp=b,t=z.convertColorRampToColormap(b,e.classBreaks.length,!0).map(k=>k.slice(1)));b=e.classBreaks.map((k,v)=>new Z({minValue:k.minValue,maxValue:k.maxValue,label:k.label,symbol:{type:"simple-fill",color:t[v]}}));return new ia({field:l,
classBreakInfos:b,authoringInfo:f})};m.createColorRamp=function(a){const b=[];for(let d=0;d<a.length-1;d++)b[d]=new aa({algorithm:"hsv",fromColor:a[d],toColor:a[d+1]||new x({r:255,g:255,b:255,a:1})});return 2<a.length?new B({colorRamps:b}):b[0]};m.createColormapRenderer=S;m.createDefaultRenderer=function(a,b){const {attributeTable:d,colormap:c}=a;if(A(a)){var e=T(a);if(h.isSome(e))return e}return h.isSome(c)&&(e=S(a),h.isSome(e))||h.isSome(d)&&(e=P(a),h.isSome(e))?e:J(a,b)};m.createShadedReliefRenderer=
function(a,b){var d;if(!F(a))return null;({extent:a}=a);a=a.width*W.getMetersPerUnitForSR(a.spatialReference);b=null!=(d=b)?d:"multi-directional";return new ha({hillshadeType:b,scalingType:5E6<a?"adjusted":"none"})};m.createStretchRenderer=J;m.createUVRenderer=P;m.createVectorFieldRenderer=T;m.getBandNames=function(a,b){var d;const c=a.keyProperties&&a.keyProperties.BandProperties;b=null!=(d=b)&&d.length?b:Array.from(Array(a.bandCount).keys());return b.map(e=>c&&c.length===a.bandCount?c[e]&&c[e].BandName||
"band_"+(e+1):"band_"+(e+1))};m.getClassField=D;m.getDefaultBandCombination=L;m.getDefaultInterpolation=function(a,b,d){const c=["nearest","bilinear","cubic","majority"].find(e=>e===(null==d?void 0:d.toLowerCase()));return"Map"===b?null!=c?c:"bilinear":"standard-time"===a.dataType?null!=c?c:"nearest":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===c||"majority"===c?c:"nearest":null!=c?c:"bilinear"};m.getSupportedRendererTypes=function(a){const b=["raster-stretch"];E(a)&&b.push("raster-colormap");
C(a)&&b.push("unique-value");G(a)&&b.push("class-breaks");F(a)&&b.push("raster-shaded-relief");A(a)&&b.push("vector-field");return b};m.getWellKnownBandIndexes=O;m.isClassBreaksSupported=G;m.isColormapRendererSupported=E;m.isShadedReliefRendererSupported=F;m.isSingleBand8BitRasterWithStats=R;m.isUVRendererSupported=C;m.isVectorFieldRendererSupported=A;m.normalizeRendererJSON=function(a){if("uniqueValue"===a.type){var b,d=a.uniqueValueInfos,c=d[0].symbol;null!=c&&null!=(b=c.symbolLayers)&&b.length&&
(a.uniqueValueInfos=d.map(e=>({value:e.value,label:e.label,symbol:e.symbol?U(e.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,c=b[0].symbol,null!=c&&null!=(d=c.symbolLayers)&&d.length&&(a.classBreakInfos=b.map(e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?U(e.symbol):null}))));return a};Object.defineProperty(m,"__esModule",{value:!0})});