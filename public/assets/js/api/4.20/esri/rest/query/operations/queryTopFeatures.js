// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/maybe ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ./queryZScale ../../../tasks/operations/urlUtils".split(" "),function(h,m,u,k,r,v,w,x,y){function t(a,b){var c,d;const e=a.geometry;a=a.toJSON();k.isSome(e)&&(a.geometry=JSON.stringify(e),a.geometryType=v.getJsonType(e),a.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference));null!=(c=a.topFilter)&&
c.groupByFields&&(a.topFilter.groupByFields=a.topFilter.groupByFields.join(","));null!=(d=a.topFilter)&&d.orderByFields&&(a.topFilter.orderByFields=a.topFilter.orderByFields.join(","));a.topFilter&&(a.topFilter=JSON.stringify(a.topFilter));a.objectIds&&(a.objectIds=a.objectIds.join(","));a.orderByFields&&(a.orderByFields=a.orderByFields.join(","));!a.outFields||null!=b&&b.returnCountOnly||null!=b&&b.returnExtentOnly||null!=b&&b.returnIdsOnly?delete a.outFields:-1!==a.outFields.indexOf("*")?a.outFields=
"*":a.outFields=a.outFields.join(",");a.outSR?a.outSR=a.outSR.wkid||JSON.stringify(a.outSR):e&&a.returnGeometry&&(a.outSR=a.inSR);a.returnGeometry&&delete a.returnGeometry;if(a.timeExtent){const {start:g,end:f}=a.timeExtent;if(null!=g||null!=f)a.time=g===f?g:`${null==g?"null":g},${null==f?"null":f}`;delete a.timeExtent}return a}function n(){n=m._asyncToGenerator(function*(a,b,c,d){a=yield l(a,b,"json",d);x.applyFeatureSetZUnitScaling(b,c,a.data);return a});return n.apply(this,arguments)}function p(){p=
m._asyncToGenerator(function*(a,b,c){return k.isSome(b.timeExtent)&&b.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):l(a,b,"json",c,{returnIdsOnly:!0})});return p.apply(this,arguments)}function q(){q=m._asyncToGenerator(function*(a,b,c){return k.isSome(b.timeExtent)&&b.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):l(a,b,"json",c,{returnExtentOnly:!0,returnCountOnly:!0}).then(d=>{const e=d.data;if(e.hasOwnProperty("extent"))return d;if(e.features)throw Error("Layer does not support extent calculation.");
if(e.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");return d})});return q.apply(this,arguments)}function l(a,b,c,d={},e={}){const g="string"===typeof a?r.urlToObject(a):a;a=b.geometry?[b.geometry]:[];d.responseType="pbf"===c?"array-buffer":"json";return w.normalizeCentralMeridian(a,null,d).then(f=>{f=f&&f[0];k.isSome(f)&&(b=b.clone(),b.geometry=f);f=y.mapParameters({...g.query,f:c,...e,...t(b,e)});return u(r.join(g.path,"queryTopFeatures"),{...d,query:{...f,...d.query}})})}
h.executeQueryForTopCount=function(a,b,c){return k.isSome(b.timeExtent)&&b.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):l(a,b,"json",c,{returnIdsOnly:!0,returnCountOnly:!0})};h.executeQueryForTopExtents=function(a,b,c){return q.apply(this,arguments)};h.executeQueryForTopIds=function(a,b,c){return p.apply(this,arguments)};h.executeTopFeaturesQuery=function(a,b,c,d){return n.apply(this,arguments)};h.queryToQueryStringParameters=t;Object.defineProperty(h,"__esModule",{value:!0})});