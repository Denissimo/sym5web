// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/has ../../core/jsonMap ../../core/JSONSupport ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/subclass ../utils ../geoprocessor/GPOptions ../geoprocessor/utils ./GPMessage".split(" "),function(z,u,h,q,x,A,e,v,l,F,G,B,m,C,r,D){var t;x=new A.JSONMap({esriJobCancelled:"job-cancelled",
esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"});e=t=function(y){function w(a){a=y.call(this,a)||this;a.jobId=null;a.jobStatus=null;a.messages=null;a.requestOptions=null;a.sourceUrl=null;a._timer=null;return a}u._inheritsLoose(w,y);var g=w.prototype;
g.cancelJob=function(a){const {jobId:b,sourceUrl:c}=this,{path:f}=m.parseUrl(c);a={...this.requestOptions,...a,query:{f:"json"}};this._clearTimer();return q(`${f}/jobs/${b}/cancel`,a).then(d=>{d=t.fromJSON(d.data);this.messages=d.messages;this.jobStatus=d.jobStatus;return this})};g.destroy=function(){clearInterval(this._timer)};g.checkJobStatus=function(a){const {path:b}=m.parseUrl(this.sourceUrl);return q(`${b}/jobs/${this.jobId}`,{...this.requestOptions,...a,query:{f:"json"}}).then(({data:c})=>
{c=t.fromJSON(c);this.messages=c.messages;this.jobStatus=c.jobStatus;return this})};g.fetchResultData=function(a,b,c){b=C.from(b||{});const {returnFeatureCollection:f,returnM:d,returnZ:n,outSpatialReference:p}=b;({path:b}=m.parseUrl(this.sourceUrl));const k=r.gpEncode({returnFeatureCollection:f,returnM:d,returnZ:n,outSR:p,returnType:"data",f:"json"},null);return q(`${b}/jobs/${this.jobId}/results/${a}`,{...this.requestOptions,...c,query:k}).then(E=>r.decode(E.data))};g.fetchResultImage=function(a,
b,c){const {path:f}=m.parseUrl(this.sourceUrl);b={...b.toJSON(),f:"json"};b=r.gpEncode(b);return q(`${f}/jobs/${this.jobId}/results/${a}`,{...this.requestOptions,...c,query:b}).then(d=>r.decode(d.data))};g.fetchResultMapImageLayer=function(){var a=u._asyncToGenerator(function*(){var {path:b}=m.parseUrl(this.sourceUrl);const c=b.indexOf("/GPServer/");b=`${b.substring(0,c)}/MapServer/jobs/${this.jobId}`;return new (yield new Promise(function(f,d){z(["../../layers/MapImageLayer"],function(n){f(Object.freeze({__proto__:null,
"default":n}))},d)})).default({url:b})});return function(){return a.apply(this,arguments)}}();g.waitForJobCompletion=function(){var a=u._asyncToGenerator(function*(b={}){const {interval:c=1E3,signal:f,statusCallback:d}=b;return new Promise((n,p)=>{v.onAbort(f,()=>{this._clearTimer();p(v.createAbortError())});this._clearTimer();this._timer=setInterval(()=>{this._timer||p(v.createAbortError());this.checkJobStatus(this.requestOptions).then(k=>{({jobStatus:k}=k);this.jobStatus=k;switch(k){case "job-succeeded":this._clearTimer();
n(this);break;case "job-submitted":case "job-executing":case "job-waiting":case "job-new":d&&d(this);break;case "job-cancelled":case "job-cancelling":case "job-deleted":case "job-deleting":case "job-timed-out":case "job-failed":this._clearTimer(),p(this)}})},c)})});return function(){return a.apply(this,arguments)}}();g._clearTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)};return w}(e.JSONSupport);h.__decorate([l.property()],e.prototype,"jobId",void 0);h.__decorate([l.property({json:{read:x.read}})],
e.prototype,"jobStatus",void 0);h.__decorate([l.property({type:[D]})],e.prototype,"messages",void 0);h.__decorate([l.property()],e.prototype,"requestOptions",void 0);h.__decorate([l.property({json:{write:!0}})],e.prototype,"sourceUrl",void 0);return e=t=h.__decorate([B.subclass("esri.rest.support.JobInfo")],e)});