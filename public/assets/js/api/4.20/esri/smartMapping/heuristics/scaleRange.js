// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ../../geometry/support/scaleUtils ../statistics/spatialStatistics ../support/adapters/support/layerUtils".split(" "),function(p,k,u,q,v,r){function w(a){return l.apply(this,arguments)}function l(){l=p._asyncToGenerator(function*(a){const {view:c,sampleSize:b}=a;if(!(a&&c&&a.layer))throw new k("scale-range:missing-parameters","'view' and 'layer' parameters are required");var e=[0,2,3,1,5];const {layer:f,...m}=a;a=r.createLayerAdapter(f,
e);const g={layerAdapter:a,...m};g.sampleSize=b||500;if(!a)throw new k("scale-range:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(e).join(", "));yield c.when();e=u.isSome(g.signal)?{signal:g.signal}:null;yield a.load(e);return g});return l.apply(this,arguments)}function t(a,c,b=!0){if(a.constraints&&"effectiveLODs"in a.constraints){a=a.constraints.effectiveLODs;a=b?a:a.slice(0).reverse();let e=null;for(const f of a)if(!(b?f.scale>c:f.scale<c)){e=f;break}return e}}
function n(){n=p._asyncToGenerator(function*(a){var c,b,e=yield w(a);const {view:f,sampleSize:m,layerAdapter:g,signal:x}=e;a=yield g.getSampleFeatures({view:f,sampleSize:m,returnGeometry:!0,signal:x});a=yield v({features:a,geometryType:g.geometryType});{let h=c=null;var d=b=null;switch(g.geometryType){case "point":case "multipoint":c=a.avgMinDistance;h=12;b=a.minDistance;d=320;break;case "polyline":c=a.avgLength;h=30;b=a.minLength;d=320;break;case "polygon":c=a.avgSize,h=15,b=a.minSize,d=640}c=0<
c?c/h:null;b=0<b?b/d:null}d=q.getScaleForResolution(c,f.spatialReference);b=q.getScaleForResolution(b,f.spatialReference);b={minScale:d,maxScale:b};const {minScale:y,maxScale:z}=b;{b=y;d=z;const {view:h,snapToLOD:A,layerAdapter:B}=e;A&&(e=t(h,b),c=t(h,d,!1),b=e?e.scale:b,d=c?c.scale:d);if(b<d)throw new k("scale-range:invalid","calculated minScale is less than maxScale.");d>b/2&&(d=Math.floor(d/2));1E8<b&&(b=0);"polygon"!==B.geometryType&&(d=0);a={minScale:Math.ceil(b),maxScale:Math.floor(d),spatialStatistics:a}}return a});
return n.apply(this,arguments)}return function(a){return n.apply(this,arguments)}});