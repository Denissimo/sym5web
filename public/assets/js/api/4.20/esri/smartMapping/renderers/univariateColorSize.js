// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ../../renderers/support/AuthoringInfo ../../renderers/support/ClassBreakInfo ../../renderers/visualVariables/support/SizeStop ../../renderers/visualVariables/support/visualVariableUtils ./color ./size ./support/utils ../support/utils ../support/adapters/support/layerUtils ../symbology/support/aboveAndBelowUtils ../../symbols/support/cimSymbolUtils ../../symbols/support/Symbol3DMaterial".split(" "),function(w,
q,m,F,O,G,n,r,P,H,t,I,x,Q,R,S){function T(a){return y.apply(this,arguments)}function y(){y=q._asyncToGenerator(function*(a){var b,c;if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new m("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-visual-variables:missing-parameters","View is required when 'valueExpression' is specified");
if("above-and-below"===a.theme&&null!=(b=a.sizeOptions)&&b.sizeOptimizationEnabled)throw new m("univariate-colorsize-visual-variables:invalid-parameters","sizeOptimizationEnabled cannot be true for 'above-and-below' theme");a={...a};const e=[0,2,1,3,5];b=x.createLayerAdapter(a.layer,e);a.layer=b;a.theme=a.theme||null!=(c=a.colorOptions)&&c.theme?a.theme:"high-to-low";if("90-10"===a.theme)throw new m("univariate-colorsize-visual-variables:not-supported","Only 'high-to-low', 'above-and-below', 'above', 'below' themes are supported.");
if(!b)throw new m("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+x.getLayerTypeLabels(e).join(", "));c=F.isSome(a.signal)?{signal:a.signal}:null;yield b.load(c);c=yield I.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(c=t.verifyBasicFieldValidity(b,c,"univariate-colorsize-visual-variables:invalid-parameters"))throw c;return a});return y.apply(this,arguments)}function U(a,b){var c;a={...a};
const {sizeOptions:e,theme:h}=a,d=a.legendOptions||(null==(c=a.sizeOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,theme:"above-and-below"===h?null:h,legendOptions:d}}function V(a,b){var c;a={...a};const e=a.colorOptions,h=a.theme||(null==e?void 0:e.theme),d=a.legendOptions||(null==(c=a.colorOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,theme:h,legendOptions:d}}
function W(a){return z.apply(this,arguments)}function z(){z=q._asyncToGenerator(function*(a){var b;if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new m("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a=
{...a};a.symbolType=a.symbolType||"2d";a.colorOptions||(a.colorOptions={});a.colorOptions.isContinuous=null!=(b=a.colorOptions.isContinuous)?b:!1;var c=[0,2,1,3,5];b=x.createLayerAdapter(a.layer,c);a.layer=b;if(!b)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+x.getLayerTypeLabels(c).join(", "));c=F.isSome(a.signal)?{signal:a.signal}:null;yield b.load(c);if("above-and-below"===a.theme&&a.symbolOptions){if(-1<a.symbolType.indexOf("3d-volumetric"))throw new m("univariate-colorsize-continuous-renderer:invalid-parameters",
"'symbolOptions' is applicable for '2d' and '3d-flat' 'symbolType' only");if("point"!==b.geometryType&&"polygon"!==b.geometryType)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' only apply to layers with 'point' or 'polygon' geometryType");}c=yield I.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(b=t.verifyBasicFieldValidity(b,c,"univariate-colorsize-continuous-renderer:invalid-parameters"))throw b;
return a});return z.apply(this,arguments)}function X(a){a={...a};const b={...a.sizeOptions};delete a.sizeOptions;delete a.colorOptions;delete b.sizeOptimizationEnabled;return{...a,...b}}function J(a,b){"type"in a&&"cim"===a.type?R.applyCIMSymbolColor(a,b):"type"in a&&-1<a.type.indexOf("3d")?a.symbolLayers.forEach(c=>{"material"in c&&"color"in c.material&&(c.material?c.material.color=b:c.material=new S["default"]({color:b}))}):"color"in a&&(a.color=b)}function K(a,b,c=!0){var e;const h=null==b?void 0:
null==(e=b.authoringInfo)?void 0:e.clone();e=b.size.visualVariables.map(d=>d.clone());c?e.push(b.color.visualVariable.clone()):h.visualVariables=h.visualVariables.filter(d=>"size"===d.type);e.push(...a.visualVariables.filter(d=>"target"in d&&"outline"===d.target).map(d=>d.clone()));a.authoringInfo=h;a.visualVariables=e}function Y(a,b,c,e){return A.apply(this,arguments)}function A(){A=q._asyncToGenerator(function*(a,b,c,e){const h=b[0];b=b[1];const d=Math.round((b-h)/2)+h,f=a.clone();f.stops=[new n({value:c[0],
size:b}),new n({value:c[1],size:d}),new n({value:c[2],size:h}),new n({value:c[3],size:d}),new n({value:c[4],size:b})];a.stops=[new n({value:e[0],size:r.getSize(f,e[0])}),new n({value:e[1],size:r.getSize(f,e[1])}),new n({value:e[2],size:r.getSize(f,e[2])}),new n({value:e[3],size:r.getSize(f,e[3])}),new n({value:e[4],size:r.getSize(f,e[4])})]});return A.apply(this,arguments)}function Z(a,b,c,e){return B.apply(this,arguments)}function B(){B=q._asyncToGenerator(function*(a,b,c,e){a=a.filter(f=>"width-and-depth"!==
f.axis&&!f.target)[0];const h="number"===typeof(null==a?void 0:a.minSize)?null==a?void 0:a.minSize:null,d="number"===typeof(null==a?void 0:a.maxSize)?null==a?void 0:a.maxSize:null;if(null!=(null==a?void 0:a.minDataValue)&&null!=h&&null!=d)if(e)if("above-and-below"===e){a.minDataValue=null;a.maxDataValue=null;a.minSize=null;a.maxSize=null;e=t.createStopValuesForAboveBelow(c);const f=t.clampAboveAndBelowStopValues(e,c);yield Y(a,[h,d],e,f);b.stops.forEach((k,l)=>k.value=f[l])}else{const {minDataValue:f,
maxDataValue:k}=a,l=t.createDefaultStopValues(f,k,5);b.stops.forEach((g,p)=>g.value=l[p]);a.minDataValue=l[0];a.maxDataValue=l[l.length-1]}else a.minDataValue=b.stops[0].value,a.maxDataValue=b.stops[b.stops.length-1].value});return B.apply(this,arguments)}function L(a){return C.apply(this,arguments)}function C(){C=q._asyncToGenerator(function*(a){var b=yield T(a),c=yield P.createVisualVariable(V(b));const {visualVariable:e,statistics:h}=c;var d=yield H.createVisualVariables(U(b,h)),f=d.visualVariables;
yield Z(f,e,h,b.theme);a=d.basemapId;var k=d.basemapTheme,l=c.defaultValuesUsed,g={visualVariable:e,colorScheme:c.colorScheme};f={visualVariables:f,sizeScheme:d.sizeScheme};{const {theme:p,minValue:u,maxValue:v}=b;b=c.authoringInfo.visualVariables[0].clone();d=d.authoringInfo.visualVariables[0].clone();"above-and-below"===p&&(c=c.visualVariable.stops,b.minSliderValue=d.minSliderValue=null!=u?u:c[0].value,b.maxSliderValue=d.maxSliderValue=null!=v?v:c[c.length-1].value,d.theme="above-and-below");c=
new O({type:"univariate-color-size",univariateTheme:p,visualVariables:[b,d]})}return{basemapId:a,basemapTheme:k,statistics:h,defaultValuesUsed:l,color:g,size:f,authoringInfo:c}});return C.apply(this,arguments)}function D(){D=q._asyncToGenerator(function*(a){return M(a)});return D.apply(this,arguments)}function M(a){return E.apply(this,arguments)}function E(){E=q._asyncToGenerator(function*(a){var b;a=yield W(a);const {renderer:c,statistics:e,defaultValuesUsed:h}=yield H.createContinuousRenderer(X(a));
var d={...a};var f=d.symbolType,k=-1<f.indexOf("3d-volumetric");delete d.symbolType;delete d.defaultSymbolEnabled;if(d.worldScale=k)d.sizeOptions={...d.sizeOptions},d.sizeOptions.axis="3d-volumetric-uniform"===f?"all":"height";d.statistics=e;d=yield L(d);if("above-and-below"===a.theme){var l,g=a.symbolOptions,p=a.layer;f=null!=g&&g.symbols?"custom":null==g?void 0:g.symbolStyle;k=null==(l=a.colorOptions)?void 0:l.isContinuous;K(c,d,k);if(f||!k){({stops:l}=d.size.visualVariables[0]);p=p.geometryType;
!(null!=g&&g.symbolStyle||null!=g&&g.symbols)||"point"!==p&&"polygon"!==p?(g=c.classBreakInfos[0].symbol,g={above:g.clone(),below:g.clone()}):g=g.symbols||Q.getAboveAndBelowSymbols(g.symbolStyle);const {above:u,below:v}=g;k||(k=d.color.colorScheme.colors,g=k[0],J(u,k[k.length-1]),J(v,g));c.classBreakInfos=[new G({minValue:-N,maxValue:l[2].value,symbol:v}),new G({minValue:l[2].value,maxValue:N,symbol:u})];f&&(c.authoringInfo.univariateSymbolStyle=f)}}else K(c,d);return{renderer:c,statistics:e,defaultValuesUsed:h,
color:null!=(b=a.colorOptions)&&b.isContinuous||"above-and-below"!==a.theme?d.color:null,size:d.size,basemapId:d.basemapId,basemapTheme:d.basemapTheme}});return E.apply(this,arguments)}const N=2**53-1;w.createContinuousRenderer=function(a){return D.apply(this,arguments)};w.createRenderer=M;w.createVisualVariables=L;Object.defineProperty(w,"__esModule",{value:!0})});