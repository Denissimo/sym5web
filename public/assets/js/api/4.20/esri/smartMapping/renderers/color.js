// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../renderers/PointCloudClassBreaksRenderer ../../renderers/PointCloudRenderer ../../renderers/PointCloudRGBRenderer ../../renderers/PointCloudStretchRenderer ../../renderers/PointCloudUniqueValueRenderer ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Error ../../core/maybe ../../intl/messages ../../intl/substitute ../../renderers/support/AuthoringInfo ../../renderers/support/AuthoringInfoVisualVariable ../../renderers/support/utils ../../renderers/visualVariables/ColorVariable ../heuristics/ageUnit ../heuristics/outline ../heuristics/sizeRange ./support/utils ../statistics/support/ageUtils ../support/utils ../support/adapters/support/layerUtils ../../chunks/color".split(" "),
function(y,p,ya,za,ea,fa,Aa,V,Ba,Ca,Da,Ea,Fa,Ga,Ha,l,w,E,ha,W,ia,X,ja,ka,Y,Z,d,B,C,t,x){function la(a){return F.apply(this,arguments)}function F(){F=p._asyncToGenerator(function*(a){if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new l("color-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new l("color-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");
a={...a};if("90-10"===a.theme)throw new l("color-visual-variable:not-supported","Only 'high-to-low', 'above-and-below', 'centered-on', 'extremes', 'above', 'below' themes are supported.");var b=[0,2,1,3,5],c=t.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new l("color-visual-variable:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(b).join(", "));b=w.isSome(a.signal)?{signal:a.signal}:null;yield c.load(b);if("mesh"!==c.geometryType&&a.worldScale&&(!a.view||"3d"!==
a.view.type))return Promise.reject(d.createError("color-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true"));b=yield C.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(c=d.verifyBasicFieldValidity(c,b,"color-visual-variable:invalid-parameters"))throw c;return a});return F.apply(this,arguments)}function ma(a){return G.apply(this,arguments)}function G(){G=p._asyncToGenerator(function*(a){if(!(a&&
a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new l("color-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new l("color-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a={...a};a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;var b=[0,2,1,3,5],c=
t.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new l("color-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(b).join(", "));b=w.isSome(a.signal)?{signal:a.signal}:null;yield c.load(b);b=c.geometryType;a.outlineOptimizationEnabled="polygon"===b?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===b||"multipoint"===b||"polyline"===b?a.sizeOptimizationEnabled:!1;if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||
"replace",a.edgesType=a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==b)throw new l("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new l("color-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}b=yield C.getFieldsList({field:a.field,
normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(c=d.verifyBasicFieldValidity(c,b,"color-continuous-renderer:invalid-parameters"))throw c;return a});return G.apply(this,arguments)}function na(a){return H.apply(this,arguments)}function H(){H=p._asyncToGenerator(function*(a){if(!a||!a.layer||!a.field&&!a.valueExpression)throw new l("color-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(a.valueExpression&&
!a.view)throw new l("color-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");a={...a};a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;a.classificationMethod=a.classificationMethod||"equal-interval";a.normalizationType=C.getNormalizationType(a);var b=[0,2,1,3,5],c=t.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new l("color-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+
t.getLayerTypeLabels(b).join(", "));if(!(null!=a.minValue&&null!=a.maxValue||null==a.minValue&&null==a.maxValue))throw new l("color-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");b=w.isSome(a.signal)?{signal:a.signal}:null;yield c.load(b);b=c.geometryType;a.outlineOptimizationEnabled="polygon"===b?a.outlineOptimizationEnabled:!1;if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=
a.edgesType||"none";else{if("3d-volumetric-uniform"===a.symbolType&&"point"!==b)throw new l("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new l("color-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");}b=yield C.getFieldsList({field:a.field,
normalizationField:a.normalizationField});if(c=d.verifyBasicFieldValidity(c,b,"color-class-breaks-renderer:invalid-parameters"))throw c;return a});return H.apply(this,arguments)}function oa(a){a={...a};delete a.basemap;delete a.colorScheme;delete a.legendOptions;delete a.symbolType;delete a.defaultSymbolEnabled;delete a.colorMixMode;delete a.edgesType;a.analyzeData=!(null!=a.minValue&&null!=a.maxValue);return a}function pa(a){if(!a||!a.layer)return Promise.reject(d.createError("color-point-cloud-true-color-renderer:missing-parameters",
"'layer' parameter is required"));const b={...a};var c=[4];a=t.createLayerAdapter(b.layer,c);b.layer=a;b.density=b.density||25;b.size=b.size||"100%";if(!d.isValidPointSize(b.size))return Promise.reject(d.createError("color-point-cloud-true-color-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"));if(!a)return Promise.reject(d.createError("color-point-cloud-true-color-renderer:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(c).join(", ")));
c=w.isSome(b.signal)?{signal:b.signal}:null;return a.load(c).then(()=>b)}function qa(a){if(!(a&&a.layer&&a.field))return Promise.reject(d.createError("color-point-cloud-continuous-renderer:missing-parameters","'layer' and 'field' parameters are required"));var b=a.field.toLowerCase();if("intensity"!==b&&"elevation"!==b)return Promise.reject(d.createError("color-point-cloud-continuous-renderer:invalid-parameters","'field' should be either 'intensity' or 'elevation'"));const c={...a};b=[4];a=t.createLayerAdapter(c.layer,
b);c.layer=a;c.density=c.density||25;c.size=c.size||"100%";if(!d.isValidPointSize(c.size))return Promise.reject(d.createError("color-point-cloud-continuous-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'"));if(!a)return Promise.reject(d.createError("color-point-cloud-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(b).join(", ")));b=w.isSome(c.signal)?{signal:c.signal}:null;return a.load(b).then(()=>
c)}function aa(a){a={...a};const b=-1<a.symbolType.indexOf("3d-volumetric");delete a.symbolType;delete a.defaultSymbolEnabled;delete a.colorMixMode;delete a.edgesType;a.worldScale=b;return a}function ra(a){return I.apply(this,arguments)}function I(){I=p._asyncToGenerator(function*(a){if(!(a&&a.layer&&a.view&&a.startTime&&a.endTime))throw new l("color-age-renderer:missing-parameters","'layer', 'view', startTime', 'endTime' parameters are required");a={...a};a.symbolType=a.symbolType||"2d";a.defaultSymbolEnabled=
null==a.defaultSymbolEnabled?!0:a.defaultSymbolEnabled;var b=[0,2,1,3,5],c=t.createLayerAdapter(a.layer,b);a.layer=c;if(!c)throw new l("color-age-renderer:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(b).join(", "));b=w.isSome(a.signal)?{signal:a.signal}:null;yield c.load(b);b=c.geometryType;a.outlineOptimizationEnabled="polygon"===b?a.outlineOptimizationEnabled:!1;a.sizeOptimizationEnabled="point"===b||"multipoint"===b||"polyline"===b?a.sizeOptimizationEnabled:!1;
if("mesh"===b)a.symbolType="3d-volumetric",a.colorMixMode=a.colorMixMode||"replace",a.edgesType=a.edgesType||"none";else if("3d-volumetric-uniform"===a.symbolType&&"point"!==b)throw new l("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(-1<a.symbolType.indexOf("3d-volumetric")&&(!a.view||"3d"!==a.view.type))throw new l("color-age-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");
if(c=B.verifyDates(c,a.startTime,a.endTime,"color-age-renderer:invalid-parameters"))throw c;if(a.unit&&-1===B.supportedAgeUnits.indexOf(a.unit))throw new l("color-age-renderer:invalid-unit",`Supported units are: ${B.supportedAgeUnits.join(", ")}`);return a});return I.apply(this,arguments)}function J(a,b){return K.apply(this,arguments)}function K(){K=p._asyncToGenerator(function*(a,b){let c=a.colorScheme,f=null;var e=null;e=yield d.getBasemapInfo(a.basemap,a.view);f=w.isSome(e.basemapId)?e.basemapId:
null;e=w.isSome(e.basemapTheme)?e.basemapTheme:null;if(c)return{scheme:x.cloneScheme(c),basemapId:f,basemapTheme:e};b=b||a.theme||"high-to-low";const g=x.getSchemes({theme:b,basemap:f,basemapTheme:e,geometryType:a.geometryType,worldScale:a.worldScale,view:a.view});g&&(f=g.basemapId,e=g.basemapTheme,c=a.schemeId?x.getSchemeById({id:b+"/"+f+"/"+a.schemeId,geometryType:a.geometryType}):g.primaryScheme);return{scheme:c,basemapId:f,basemapTheme:e}});return K.apply(this,arguments)}function sa(a,b){return L.apply(this,
arguments)}function L(){L=p._asyncToGenerator(function*(a,b){b=yield J({basemap:b.basemap,colorScheme:b.colorScheme,geometryType:b.layer.geometryType,schemeId:"elevation"===b.field.toLowerCase()?"point-cloud-elevation-scheme":"point-cloud-intensity-scheme"});const c=b.scheme;if(!c)throw d.createError("color-point-cloud-continuous-renderer:insufficient-info","Unable to find color scheme");const f=d.createColors(c.colors,5);if(5>f.length)throw d.createError("color-point-cloud-continuous-renderer:insufficient-info",
"Color scheme does not have enough colors");const e=d.getDefaultDataRange(a,!1,!0),g=e?d.createDefaultStopValues(e[0],e[1],5):d.createStopValues(a);return{stops:X.createColorStops({values:g,isDate:!1,dateFormatOptions:null,colors:f,labelIndexes:[0,2,4]}),basemapId:b.basemapId,basemapTheme:b.basemapTheme,statistics:a,defaultValuesUsed:!!e,colorScheme:x.cloneScheme(c)}});return L.apply(this,arguments)}function ta(a,b,c){return M.apply(this,arguments)}function M(){M=p._asyncToGenerator(function*(a,b,
c){var f=a.layer;const {field:e,theme:g}=a;var h=e&&"function"!==typeof e?f.getField(e):null,m=h&&"date"===h.type;f=yield J({basemap:a.basemap,theme:a.theme,geometryType:f.geometryType,colorScheme:a.colorScheme,worldScale:a.worldScale,view:a.view});h=f.scheme;if(!h)throw d.createError("color-visual-variable:insufficient-info","Unable to find color scheme");var k=d.createColors(h.colors,5);if(5>k.length)throw d.createError("color-visual-variable:insufficient-info","Color scheme does not have enough colors");
const r=-1<h.id.indexOf("seq-");c=d.getDataRange(b,c,g,m,"90-10"!==g);m=d.createDataValues(c,b,g,r);const n=d.createColors(k,5);k=new ja({field:e,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle,normalizationField:a.normalizationField,stops:m.map((u,q)=>({value:u,color:n[q]})),legendOptions:a.legendOptions});a=new ia({type:"color",minSliderValue:null!=a.minValue?a.minValue:b.min,maxSliderValue:null!=a.maxValue?a.maxValue:b.max,theme:h.theme});a=new W({visualVariables:[a]});
return{basemapId:f.basemapId,basemapTheme:f.basemapTheme,visualVariable:k,statistics:b,defaultValuesUsed:c.defaultValuesUsed,colorScheme:x.cloneScheme(h),authoringInfo:a}});return M.apply(this,arguments)}function ba(a,b,c,f,e,g){return N.apply(this,arguments)}function N(){N=p._asyncToGenerator(function*(a,b,c,f,e,g){const h=yield E.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),m=g.field,k=g.layer.geometryType,r=g.defaultSymbolEnabled,n=x.cloneScheme(a.colorScheme),u=b&&b.opacity,q=[a.visualVariable.clone()];
b&&b.visualVariables&&b.visualVariables.length&&q.push(...b.visualVariables.map(z=>z.clone()));c&&c.minSize&&q.push(c.minSize);return{renderer:new V({classBreakInfos:[{minValue:-ca,maxValue:ca,symbol:d.createSymbol(k,{type:g.symbolType,color:n.noDataColor,size:d.getSymbolSizeFromScheme(n,k),outline:d.getSymbolOutlineFromScheme(n,k,u),meshInfo:{colorMixMode:g.colorMixMode,edgesType:g.edgesType}})}],defaultLabel:r?h.other:null,defaultSymbol:r?d.createSymbol(k,{type:g.symbolType,color:n.noDataColor,
size:d.getSymbolSizeFromScheme(n,k),outline:d.getSymbolOutlineFromScheme(n,k,u),meshInfo:{colorMixMode:g.colorMixMode,edgesType:g.edgesType}}):null,field:m,normalizationType:f,normalizationField:e,valueExpression:g.valueExpression,valueExpressionTitle:g.valueExpressionTitle,visualVariables:q,authoringInfo:a.authoringInfo&&a.authoringInfo.clone()}),visualVariable:a.visualVariable.clone(),statistics:a.statistics,defaultValuesUsed:a.defaultValuesUsed,colorScheme:x.cloneScheme(a.colorScheme),basemapId:a.basemapId,
basemapTheme:a.basemapTheme}});return N.apply(this,arguments)}function O(a){return P.apply(this,arguments)}function P(){P=p._asyncToGenerator(function*(a){a=yield la(a);const {view:b,field:c,valueExpression:f,minValue:e,maxValue:g,layer:h,normalizationField:m,signal:k,statistics:r}=a,[n,u]=yield Promise.all([r?r:d.getSummaryStatistics({layer:h,field:c,valueExpression:f,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,normalizationType:m?"field":void 0,normalizationField:m,minValue:e,maxValue:g,view:b,
signal:k}),"90-10"===a.theme?d.getClassBreaks({layer:h,field:c,normalizationField:m,valueExpression:f,classificationMethod:"quantile",minValue:e,maxValue:g,view:b,numClasses:10,signal:k}):null]);return ta(a,n,null==u?void 0:u.result)});return P.apply(this,arguments)}function ua(a,b){a=a.colorsForClassBreaks;let c;if(a&&0<a.length&&(a.some(e=>{e.numClasses===b&&(c=e.colors);return!!c}),!c)){var f=a[a.length-1];a=b-f.numClasses;if(0<a){const e=f.colors[f.numClasses-1];c=f.colors.splice(0);for(f=1;f<=
a;f++)c.push(e)}}c&&(c=d.createColors(c,c.length));return c}function va(a,b){return Q.apply(this,arguments)}function Q(){Q=p._asyncToGenerator(function*(a,b){var c=yield E.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const f=a.defaultSymbolEnabled,e=a.layer.geometryType,g=yield J({basemap:a.basemap,geometryType:e,colorScheme:a.colorScheme,worldScale:-1<a.symbolType.indexOf("3d-volumetric"),view:a.view}),h=g.scheme,{result:m,outlineResult:k}=b,r=m.classBreakInfos,n=a.classificationMethod,
u="standard-deviation"===n,q=a.normalizationType;if(!h)throw new l("color-class-breaks-renderer:insufficient-info","Unable to find color scheme");const z=ua(h,r.length);if(!z||z.length!==r.length)throw new l("color-class-breaks-renderer:insufficient-info","Color scheme does not have enough colors");const D=k&&k.opacity;c=new V({classBreakInfos:r.map((A,v)=>({minValue:A.minValue,maxValue:A.maxValue,symbol:d.createSymbol(e,{type:a.symbolType,color:z[v],size:d.getSymbolSizeFromScheme(h,e),outline:d.getSymbolOutlineFromScheme(h,
e,D),meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}),label:A.label})),defaultLabel:f?c.other:null,defaultSymbol:f?d.createSymbol(e,{type:a.symbolType,color:h.noDataColor,size:d.getSymbolSizeFromScheme(h,e),outline:d.getSymbolOutlineFromScheme(h,e,D),meshInfo:{colorMixMode:a.colorMixMode,edgesType:a.edgesType}}):null,field:a.field,valueExpression:a.valueExpression,valueExpressionTitle:a.valueExpressionTitle,normalizationType:q,normalizationField:a.normalizationField,normalizationTotal:"percent-of-total"===
q?m.normalizationTotal:void 0,legendOptions:a.legendOptions,authoringInfo:new W({type:"class-breaks-color",classificationMethod:n,standardDeviationInterval:a.standardDeviationInterval})});u||X.setLabelsForClassBreaks({classBreakInfos:c.classBreakInfos,classificationMethod:n,normalizationType:q,round:!0});k&&k.visualVariables&&k.visualVariables.length&&(c.visualVariables=k.visualVariables.map(A=>A.clone()));return{renderer:c,colorScheme:x.cloneScheme(h),classBreaksResult:m,defaultValuesUsed:b.defaultValuesUsed,
basemapId:g.basemapId,basemapTheme:g.basemapTheme}});return Q.apply(this,arguments)}function R(){R=p._asyncToGenerator(function*(a){a=yield ma(a);const {layer:b,view:c,signal:f}=a,[e,g,h]=yield Promise.all([O(aa(a)),a.outlineOptimizationEnabled?Y({layer:b,view:c,signal:f}):null,a.sizeOptimizationEnabled?Z({layer:b,view:c,signal:f}):null]),m=a.normalizationField;return ba(e,g,h,m?"field":void 0,m,a)});return R.apply(this,arguments)}function S(){S=p._asyncToGenerator(function*(a){a=yield na(a);const b=
yield d.getClassBreaks(oa(a),a.outlineOptimizationEnabled);return va(a,b)});return S.apply(this,arguments)}function T(){T=p._asyncToGenerator(function*(a){a=yield qa(a);var b=a.statistics?a.statistics:yield d.getSummaryStatistics({layer:a.layer,field:a.field,signal:a.signal});b=yield sa(b,a);return{renderer:new fa({field:a.field,pointsPerInch:a.density,pointSizeAlgorithm:d.getPointSizeAlgorithm(a.size),stops:b.stops}),basemapId:b.basemapId,basemapTheme:b.basemapTheme,statistics:b.statistics,defaultValuesUsed:b.defaultValuesUsed,
colorScheme:b.colorScheme}});return T.apply(this,arguments)}function U(){U=p._asyncToGenerator(function*(a){var b=yield E.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");const c=yield ra(a),{defaultSymbolEnabled:f,view:e,startTime:g,endTime:h,symbolType:m,colorMixMode:k,edgesType:r,minValue:n,maxValue:u,signal:q}=c;a=c.layer;const [z,D,A]=yield Promise.all([c.unit?{unit:c.unit,statistics:null}:ka({view:e,layer:a,startTime:g,endTime:h,minValue:n,maxValue:u,signal:q}),c.outlineOptimizationEnabled?
Y({layer:a,view:e,signal:q}):null,c.sizeOptimizationEnabled?Z({layer:a,view:e,signal:q}):null]),{unit:v,statistics:wa}=z,da=B.getAgeExpressions({layer:a,startTime:g,endTime:h,unit:v}).valueExpression;b=ha.substitute(b[`ageInfo_${v}`],{unit:v,startTime:d.formatDate(g,v,a),endTime:d.formatDate(h,v,a)});b=yield O(aa({layer:a,basemap:c.basemap,valueExpression:da,symbolType:m,statistics:wa,legendOptions:{title:b},colorScheme:c.colorScheme,theme:c.theme,view:e,minValue:c.minValue,maxValue:c.maxValue,signal:q}));
a=yield ba(b,D,A,null,null,{layer:a,valueExpression:da,defaultSymbolEnabled:f,symbolType:m,colorMixMode:k,edgesType:r});a.renderer.authoringInfo.visualVariables.forEach(xa=>d.updateAgeRendererAuthoringInfoVV(xa,g,h,v));return{...a,unit:v}});return U.apply(this,arguments)}const ca=2**53-1;y.createAgeRenderer=function(a){return U.apply(this,arguments)};y.createClassBreaksRenderer=function(a){return S.apply(this,arguments)};y.createContinuousRenderer=function(a){return R.apply(this,arguments)};y.createPCContinuousRenderer=
function(a){return T.apply(this,arguments)};y.createPCTrueColorRenderer=function(a){return pa(a).then(b=>({renderer:new ea({field:"RGB",pointsPerInch:b.density,pointSizeAlgorithm:d.getPointSizeAlgorithm(b.size)})}))};y.createVisualVariable=O;Object.defineProperty(y,"__esModule",{value:!0})});