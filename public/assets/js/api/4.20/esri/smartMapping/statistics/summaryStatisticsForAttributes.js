// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ./support/utils ../support/utils ../support/adapters/support/layerUtils".split(" "),function(v,q,x,y,z,w){function A(a){return r.apply(this,arguments)}function r(){r=v._asyncToGenerator(function*(a){if(!(a&&a.layer&&a.attributes))throw new q("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(a.attributes.some(n=>!!n.valueExpression)&&!a.view)throw new q("summary-statistics-for-attributes:missing-parameters",
"View is required when 'valueExpression' is specified in attributes");var b=[0,2,1,5];const {layer:c,...h}=a,e=w.createLayerAdapter(c,b);a={layerAdapter:e,...h};a.includeZeros=null==a.includeZeros||a.includeZeros;a.includeNegatives=null==a.includeNegatives||a.includeNegatives;if(!e)throw new q("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+w.getLayerTypeLabels(b).join(", "));b=a.view;var k=x.isSome(a.signal)?{signal:a.signal}:null;yield Promise.all([b&&
b.when(),e.load(k)]);b=[];for(var f of a.attributes)k=yield z.getFieldsList({field:f.field,valueExpression:f.valueExpression}),Array.prototype.push.apply(b,k);if(f=y.verifyBasicFieldValidity(e,b,"summary-statistics-for-attributes:invalid-parameters"))throw f;return a});return r.apply(this,arguments)}function B(a,b,c){const h=[],e=[],k=[],f=[],n=[];a.forEach((l,d)=>{const m=l.field?"field":"expression",t=l.field||l.valueExpression;l.field?(n.push(t),e.push(`var ${m}${d} = Number($feature["${t}"]);`)):
(h.push(`function getValueForExpr${d}() {\n  ${t} \n}`),e.push(`var ${m}${d} = Number(getValueForExpr${d}());`));c||k.push(`${m}${d} = IIf(${m}${d} < 0, 0, ${m}${d});`);f.push(`${m}${d}`)});a="return sum;";const g=h.length?null:n.reduce((l,d)=>`${l} + ${d}`);let p=null;b||c?b?c||(a="return IIf(sum \x3e\x3d 0, sum, null);",g&&(p=`(( ${g} ) >= 0)`)):(a="return IIf(sum !\x3d 0, sum, null);",g&&(p=`(( ${g} ) <> 0)`)):(a="return IIf(sum \x3e 0, sum, null);",g&&(p=`(( ${g} ) > 0)`));return{valueExpression:[h.length?
h.join("\n"):"",e.join("\n"),k.join("\n"),`var sum = ${f.join(" + ")};`,a].filter(Boolean).join("\n\n"),sqlExpression:g,sqlWhere:p}}function u(){u=v._asyncToGenerator(function*(a){const {layerAdapter:b,...c}=yield A(a);a=B(c.attributes,c.includeZeros,c.includeNegatives);return b.summaryStatistics({valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,view:c.view,signal:c.signal})});return u.apply(this,arguments)}return function(a){return u.apply(this,arguments)}});