// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/Collection ./core/JSONSupport ./core/lang ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/decorators/cast ./core/has ./core/jsonMap ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/ensureType ./layers/support/fieldUtils ./popup/content ./popup/ExpressionInfo ./popup/FieldInfo ./popup/LayerOptions ./popup/RelatedRecordsInfo ./popup/content/AttachmentsContent ./popup/content/Content ./popup/content/CustomContent ./popup/content/FieldsContent ./popup/content/MediaContent ./popup/content/TextContent ./popup/content/support/mediaInfoTypes ./support/actions/ActionBase ./support/actions/ActionButton ./support/actions/ActionToggle".split(" "),
function(p,h,t,g,n,D,E,l,F,A,Y,G,H,q,I,B,J,K,L,M,N,u,O,P,v,w,x,Q,R,S,T){var y;A=t.ofType({key:"type",defaultKeyValue:"button",base:R,typeMap:{button:S,toggle:T}});const U={base:O,key:"type",typeMap:{media:w,custom:P,text:x,attachments:u,fields:v}},V=D.getLogger("esri.PopupTemplate"),W=["attachments","fields","media","text"];g=y=function(C){function z(){var a=C.apply(this,arguments)||this;a.actions=null;a.content="";a.expressionInfos=null;a.fieldInfos=null;a.layerOptions=null;a.lastEditInfoEnabled=
!0;a.outFields=null;a.overwriteActions=!1;a.returnGeometry=!1;a.title="";a.relatedRecordsInfo=null;return a}p._inheritsLoose(z,C);var f=z.prototype;f.castContent=function(a){if(Array.isArray(a))return a.map(b=>I.ensureOneOfType(U,b));if("string"===typeof a||"function"===typeof a||a instanceof HTMLElement||E.isPromiseLike(a))return a;V.error("content error","unsupported content value",{value:a});return null};f.readContent=function(a,b){({popupElements:a}=b);return Array.isArray(a)&&0<a.length?this._readPopupInfoElements(b):
this._readPopupInfo(b)};f.writeContent=function(a,b,c,d){"string"===typeof a?b.description=a:Array.isArray(a)&&(b.popupElements=a.filter(e=>-1!==W.indexOf(e.type)).map(e=>e&&e.toJSON(d)),b.popupElements.forEach(e=>{"attachments"===e.type?this._writeAttachmentContent(b):"media"===e.type?this._writeMediaContent(e,b):"text"===e.type&&this._writeTextContent(e,b)}))};f.writeFieldInfos=function(a,b,c,d){({content:c}=this);c=Array.isArray(c)?c:null;if(a){const e=c?c.filter(m=>"fields"===m.type):[],k=e.length&&
e.every(m=>{var r;return null==(r=m.fieldInfos)?void 0:r.length});b.fieldInfos=a.filter(Boolean).map(m=>{m=m.toJSON(d);k&&(m.visible=!1);return m})}if(c)for(const e of c)"fields"===e.type&&this._writeFieldsContent(e,b)};f.writeLayerOptions=function(a,b,c,d){b[c]=!a||null===a.showNoDataRecords&&null===a.returnTopmostRaster?null:a.toJSON(d)};f.writeTitle=function(a,b){b.title=a||""};f.clone=function(){var {actions:a}=this;a=a?n.clone(a.toArray()):[];return new y({actions:a,content:Array.isArray(this.content)?
n.clone(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?n.clone(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?n.clone(this.fieldInfos):null,layerOptions:this.layerOptions?n.clone(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?n.clone(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?
n.clone(this.relatedRecordsInfo):null})};f.collectRequiredFields=function(){var a=p._asyncToGenerator(function*(b,c){yield this._collectExpressionInfoFields(b,c,this.expressionInfos);B.collectFields(b,c,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])});return function(b,c){return a.apply(this,arguments)}}();f.getRequiredFields=function(){var a=p._asyncToGenerator(function*(b){const c=new Set;yield this.collectRequiredFields(c,
b);return[...c].sort()});return function(b){return a.apply(this,arguments)}}();f._writeFieldsContent=function(a,b){Array.isArray(a.fieldInfos)&&a.fieldInfos.length&&(a=n.clone(a.fieldInfos),Array.isArray(b.fieldInfos)?a.forEach(c=>{const d=b.fieldInfos.find(e=>e.fieldName.toLowerCase()===c.fieldName.toLowerCase());d?d.visible=!0:b.fieldInfos.push(c)}):b.fieldInfos=a)};f._writeAttachmentContent=function(a){a.showAttachments||(a.showAttachments=!0)};f._writeTextContent=function(a,b){!b.description&&
a.text&&(b.description=a.text)};f._writeMediaContent=function(a,b){Array.isArray(a.mediaInfos)&&a.mediaInfos.length&&(a=n.clone(a.mediaInfos),Array.isArray(b.mediaInfos)?b.mediaInfos=[...b.mediaInfos,...a]:b.mediaInfos=a)};f._readPopupInfoElements=function({description:a,mediaInfos:b,popupElements:c}){var d=!1,e=!1;return c.map(k=>{if("media"===k.type)return k.mediaInfos||!b||e||(k.mediaInfos=b,e=!0),w.fromJSON(k);if("text"===k.type)return k.text||!a||d||(k.text=a,d=!0),x.fromJSON(k);if("attachments"===
k.type)return u.fromJSON(k);if("fields"===k.type)return v.fromJSON(k)}).filter(Boolean)};f._readPopupInfo=function({description:a,mediaInfos:b,showAttachments:c}){const d=[];a?d.push(new x({text:a})):d.push(new v);Array.isArray(b)&&b.length&&d.push(w.fromJSON({mediaInfos:b}));c&&d.push(u.fromJSON({displayType:"list"}));return d.length?d:a};f._getContentElementFields=function(a){if(!a||"attachments"===a.type)return[];if("custom"===a.type)return a.outFields||[];if("fields"===a.type)return this._getFieldInfoFields(a.fieldInfos||
this.fieldInfos);if("media"===a.type)return(a.mediaInfos||[]).reduce((b,c)=>[...b,...this._getMediaInfoFields(c)],[]);if("text"===a.type)return this._extractFieldNames(a.text)};f._getMediaInfoFields=function(a){const {caption:b,title:c,value:d}=a,{fields:e=[],normalizeField:k,tooltipField:m,sourceURL:r,linkURL:X}=d||{};a=[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(r),...this._extractFieldNames(X),...e];k&&a.push(k);m&&a.push(m);return a};f._getContentFields=
function(a){return"string"===typeof a?this._extractFieldNames(a):Array.isArray(a)?a.reduce((b,c)=>[...b,...this._getContentElementFields(c)],[]):[]};f._collectExpressionInfoFields=function(){var a=p._asyncToGenerator(function*(b,c,d){d&&(yield Promise.all(d.map(e=>B.collectArcadeFieldNames(b,c,e.expression))))});return function(b,c,d){return a.apply(this,arguments)}}();f._getFieldInfoFields=function(a){return a?a.filter(b=>"undefined"===typeof b.visible?!0:!!b.visible).map(b=>b.fieldName).filter(b=>
-1===b.indexOf("relationships/")&&-1===b.indexOf("expression/")):[]};f._getActionsFields=function(a){return a?a.toArray().reduce((b,c)=>[...b,...this._getActionFields(c)],[]):[]};f._getActionFields=function(a){const {className:b,title:c,type:d}=a;a="button"===d||"toggle"===d?a.image:"";return[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(a)]};f._getTitleFields=function(a){return"string"===typeof a?this._extractFieldNames(a):[]};f._extractFieldNames=function(a){if(!a||
"string"!==typeof a)return[];a=a.match(/{[^}]*}/g);if(!a)return[];const b=/\{(\w+):.+\}/;return(a=a.filter(c=>!(0===c.indexOf("{relationships/")||0===c.indexOf("{expression/"))).map(c=>c.replace(b,"{$1}")))?a.map(c=>c.slice(1,-1)):[]};return z}(g.JSONSupport);h.__decorate([l.property({type:A})],g.prototype,"actions",void 0);h.__decorate([l.property()],g.prototype,"content",void 0);h.__decorate([F.cast("content")],g.prototype,"castContent",null);h.__decorate([G.reader("content",["description","fieldInfos",
"popupElements","mediaInfos","showAttachments"])],g.prototype,"readContent",null);h.__decorate([q.writer("content",{popupElements:{type:t.ofType(J.persistableTypes)},showAttachments:{type:Boolean},mediaInfos:{type:t.ofType(Q.types)},description:{type:String}})],g.prototype,"writeContent",null);h.__decorate([l.property({type:[K],json:{write:!0}})],g.prototype,"expressionInfos",void 0);h.__decorate([l.property({type:[L]})],g.prototype,"fieldInfos",void 0);h.__decorate([q.writer("fieldInfos")],g.prototype,
"writeFieldInfos",null);h.__decorate([l.property({type:M})],g.prototype,"layerOptions",void 0);h.__decorate([q.writer("layerOptions")],g.prototype,"writeLayerOptions",null);h.__decorate([l.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],g.prototype,"lastEditInfoEnabled",void 0);h.__decorate([l.property()],g.prototype,"outFields",void 0);h.__decorate([l.property()],g.prototype,"overwriteActions",void 0);h.__decorate([l.property()],g.prototype,
"returnGeometry",void 0);h.__decorate([l.property({json:{type:String}})],g.prototype,"title",void 0);h.__decorate([q.writer("title")],g.prototype,"writeTitle",null);h.__decorate([l.property({type:N,json:{write:!0}})],g.prototype,"relatedRecordsInfo",void 0);return g=y=h.__decorate([H.subclass("esri.PopupTemplate")],g)});