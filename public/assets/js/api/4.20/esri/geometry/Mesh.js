// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/Loadable ../core/Logger ../core/maybe ../core/Promise ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/jsonMap ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/loadExternal ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(K,x,f,L,e,U,g,V,W,l,ha,ia,ja,X,y,M,Y,r,Z,t,B,C,D,aa,ba,ca,da,q,ea,fa){var m;const h=U.getLogger("esri.geometry.Mesh");e=m=function(N){function k(a){a=N.call(this,a)||this;a.components=null;a.transform=null;a.external=null;a.hasZ=!0;a.hasM=!1;a.vertexAttributes=new D.MeshVertexAttributes;a.type="mesh";return a}x._inheritsLoose(k,N);var n=k.prototype;n.initialize=function(){if(g.isNone(this.external)||this.vertexAttributes.position.length)this.loadStatus="loaded"};n.addComponent=function(a){this.loaded?
(this.components||(this.components=[]),this.components.push(B.from(a)),this.notifyChange("components")):h.error("addComponent()","Mesh must be loaded before applying operations")};n.removeComponent=function(a){if(this.loaded){if(this.components&&(a=this.components.indexOf(a),-1!==a)){this.components.splice(a,1);this.notifyChange("components");return}h.error("removeComponent()","Provided component is not part of the list of components")}else h.error("removeComponent()","Mesh must be loaded before applying operations")};
n.rotate=function(a,b,c,d){t.fromAxisAndAngle(E.x,a,w);t.fromAxisAndAngle(E.y,b,O);t.fromAxisAndAngle(E.z,c,P);t.compose(w,O,w);t.compose(w,P,w);ea.rotate(this,w,d);return this};n.offset=function(a,b,c,d){if(!this.loaded)return h.error("offset()","Mesh must be loaded before applying operations"),this;z[0]=a;z[1]=b;z[2]=c;da.offset(this,z,d);return this};n.scale=function(a,b){if(!this.loaded)return h.error("scale()","Mesh must be loaded before applying operations"),this;fa.scale(this,a,b);return this};
n.centerAt=function(a,b){if(!this.loaded)return h.error("centerAt()","Mesh must be loaded before applying operations"),this;ba.centerAt(this,a,b);return this};n.load=function(a){g.isSome(this.external)&&this.addResolvingPromise(ca.loadExternal(this,this.external.source,a));return Promise.resolve(this)};n.clone=function(){const a=this.components?new Map:null,b=this.components?new Map:null,c={components:this.components?this.components.map(d=>d.cloneWithDeduplication(a,b)):null,spatialReference:this.spatialReference,
vertexAttributes:this.vertexAttributes.clone(),transform:g.isSome(this.transform)?this.transform.clone():null,external:g.isSome(this.external)?{source:this.external.source,extent:g.isSome(this.external.extent)?this.external.extent.clone():null}:null};return new m(c)};n.vertexAttributesChanged=function(){this.notifyChange("vertexAttributes")};n.toBinaryGLTF=function(){var a=x._asyncToGenerator(function*(b){const {toBinaryGLTF:c}=yield new Promise(function(d,p){K(["./support/meshUtils/exporters/gltf/gltfexport"],
d,p)});return c(this,b)});return function(b){return a.apply(this,arguments)}}();k.createBox=function(a,b){if(!(a instanceof r))return h.error(".createBox()","expected location to be a Point instance"),null;a=new m(q.convertUnitGeometry(q.createUnitSizeBox(),a,b));return b&&b.imageFace&&"all"!==b.imageFace?q.extractSingleFaceOfBox(a,b.imageFace):a};k.createSphere=function(a,b){return a instanceof r?new m(q.convertUnitGeometry(q.createUnitSizeSphere(b&&b.densificationFactor||0),a,b)):(h.error(".createSphere()",
"expected location to be a Point instance"),null)};k.createCylinder=function(a,b){return a instanceof r?new m(q.convertUnitGeometry(q.createUnitSizeCylinder(b&&b.densificationFactor||0),a,b)):(h.error(".createCylinder()","expected location to be a Point instance"),null)};k.createPlane=function(a,b){return a instanceof r?new m(q.convertUnitGeometry(q.createUnitSizePlane(b&&b.facing||"up"),a,b)):(h.error(".createPlane()","expected location to be a Point instance"),null)};k.createFromPolygon=function(a,
b){if(!(a instanceof Z))return h.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const c=aa.triangulate(a);return new m({vertexAttributes:new D.MeshVertexAttributes({position:c.position}),components:[new B({faces:c.faces,shading:"flat",material:b&&b.material||null})],spatialReference:a.spatialReference})};k.createFromGLTF=function(){var a=x._asyncToGenerator(function*(b,c,d){if(!(b instanceof r))throw h.error(".createfromGLTF()","expected location to be a Point instance"),
new L("invalid-input","Expected location to be a Point instance");const {loadGLTFMesh:p}=yield W.whenOrAbort(new Promise(function(u,v){K(["./support/meshUtils/loadGLTFMesh"],u,v)}),d);return new m(yield p(b,c,d))});return function(b,c,d){return a.apply(this,arguments)}}();k.createWithExternalSource=function(a,b,c){var d,p,u;const v=null!=(d=null==c?void 0:c.extent)?d:null;c=null!=(p=null==c?void 0:c.transform.clone())?p:new C;c.origin=[a.x,a.y,null!=(u=a.z)?u:0];return new m({external:{source:b,extent:v},
transform:c,spatialReference:a.spatialReference})};k.createIncomplete=function(a,b){var c,d;b=null!=(c=null==b?void 0:b.transform.clone())?c:new C;b.origin=[a.x,a.y,null!=(d=a.z)?d:0];a=new m({transform:b,spatialReference:a.spatialReference});a.addResolvingPromise(Promise.reject(new L("mesh-incomplete","Mesh resources are not complete")));return a};x._createClass(k,[{key:"hasExtent",get:function(){return!this.loaded&&g.isSome(this.external)&&g.isSome(this.external.extent)||this.loaded&&0<this.vertexAttributes.position.length&&
(!this.components||0<this.components.length)}},{key:"boundingInfo",get:function(){var a=this.vertexAttributes.position;const b=this.spatialReference;if(0===a.length||this.components&&0===this.components.length)return{extent:new M({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b}),center:new r({x:0,y:0,z:0,spatialReference:b})};a=g.isSome(this.transform)?this.transform.project(a,b):a;let c=Infinity,d=Infinity,p=Infinity,u=-Infinity,v=-Infinity,F=-Infinity,Q=0,R=0,S=0;const T=a.length,
G=1/(T/3);let A=0;for(;A<T;){const H=a[A++],I=a[A++],J=a[A++];c=Math.min(c,H);d=Math.min(d,I);p=Math.min(p,J);u=Math.max(u,H);v=Math.max(v,I);F=Math.max(F,J);Q+=G*H;R+=G*I;S+=G*J}return{extent:new M({xmin:c,ymin:d,zmin:p,xmax:u,ymax:v,zmax:F,spatialReference:b}),center:new r({x:Q,y:R,z:S,spatialReference:b})}}},{key:"anchor",get:function(){if(g.isSome(this.transform))return this.transform.getOriginPoint(this.spatialReference);const a=this.boundingInfo;return new r({x:a.center.x,y:a.center.y,z:a.extent.zmin,
spatialReference:this.spatialReference})}},{key:"origin",get:function(){return g.isSome(this.transform)?this.transform.getOriginPoint(this.spatialReference):this.boundingInfo.center}},{key:"extent",get:function(){return!this.loaded&&g.isSome(this.external)&&g.isSome(this.external.extent)?this.external.extent.clone():this.boundingInfo.extent}}]);return k}(e.LoadableMixin(V.EsriPromiseMixin(Y)));f.__decorate([l.property({type:[B],json:{write:!0}})],e.prototype,"components",void 0);f.__decorate([l.property({type:C,
json:{write:!0}})],e.prototype,"transform",void 0);f.__decorate([l.property({constructOnly:!0})],e.prototype,"external",void 0);f.__decorate([l.property({readOnly:!0})],e.prototype,"hasExtent",null);f.__decorate([l.property({readOnly:!0})],e.prototype,"boundingInfo",null);f.__decorate([l.property({readOnly:!0})],e.prototype,"anchor",null);f.__decorate([l.property({readOnly:!0})],e.prototype,"origin",null);f.__decorate([l.property({readOnly:!0,json:{read:!1}})],e.prototype,"extent",null);f.__decorate([l.property({readOnly:!0,
json:{read:!1,write:!0,default:!0}})],e.prototype,"hasZ",void 0);f.__decorate([l.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],e.prototype,"hasM",void 0);f.__decorate([l.property({type:D.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],e.prototype,"vertexAttributes",void 0);e=m=f.__decorate([X.subclass("esri.geometry.Mesh")],e);const E={x:y.fromValues(1,0,0),y:y.fromValues(0,1,0),z:y.fromValues(0,0,1)},w=t.create(),O=t.create(),P=t.create(),z=y.create();return e});