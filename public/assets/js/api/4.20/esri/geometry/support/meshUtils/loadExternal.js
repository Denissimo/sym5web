// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(v,w,h,z,m,k,x,A){function n(){n=h._asyncToGenerator(function*(a,b,c){const {loadGLTFMesh:e}=yield k.whenOrAbort(new Promise(function(p,q){v(["./loadGLTFMesh"],p,q)}),c),d=yield y(b,c);b=e(new A({x:0,y:0,z:0,spatialReference:a.spatialReference}),d.url,{resolveFile:B(d),useTransform:!0,signal:m.isSome(c)?c.signal:
null});b.then(()=>d.dispose(),()=>d.dispose());const {vertexAttributes:f,components:g}=yield b;a.vertexAttributes=f;a.components=g});return n.apply(this,arguments)}function B(a){const b=x.removeFile(a.url);return c=>{var e,d=x.makeRelative(c,b,b);d=d?d.replace(/^ *\.\//,""):null;return null!=(e=a.files.get(d))?e:c}}function y(a,b){return r.apply(this,arguments)}function r(){r=h._asyncToGenerator(function*(a,b){return a instanceof Blob?l.fromBlob(a):"string"===typeof a?new l(a):Array.isArray(a)?C(a,
b):D(a,b)});return r.apply(this,arguments)}function C(a,b){return t.apply(this,arguments)}function t(){t=h._asyncToGenerator(function*(a,b){const c=new Map;let e=null;a=yield k.eachAlwaysValues(a.map(function(){var f=h._asyncToGenerator(function*(g){return{name:g.name,source:yield y(g instanceof Blob?g:g.source,b)}});return function(g){return f.apply(this,arguments)}}()));const d=[];for(const f of a)f&&(k.isAborted(b)?f.source.dispose():d.push(f));k.throwIfAborted(b);for(const {name:f,source:g}of d){if(m.isNone(e)||
/\.(gltf|glb)/i.test(f))e=g.url;c.set(f,g.url);g.files&&g.files.forEach((p,q)=>c.set(q,p))}if(m.isNone(e))throw new z("mesh-load-external:missing-files","Missing files to load external mesh source");return new l(e,()=>d.forEach(({source:f})=>f.dispose()),c)});return t.apply(this,arguments)}function D(a,b){return u.apply(this,arguments)}function u(){u=h._asyncToGenerator(function*(a,b){const {default:c}=yield k.whenOrAbort(new Promise(function(e,d){v(["../../../request"],function(f){e(Object.freeze({__proto__:null,
"default":f}))},d)}),b);a="string"===typeof a.multipart[0]?yield Promise.all(a.multipart.map(function(){var e=h._asyncToGenerator(function*(d){return(yield c(d,{responseType:"array-buffer"})).data});return function(d){return e.apply(this,arguments)}}())):a.multipart;return l.fromBlob(new Blob(a))});return u.apply(this,arguments)}let l=function(){function a(b,c=()=>{},e=new Map){this.url=b;this.dispose=c;this.files=e}a.fromBlob=function(b){const c=URL.createObjectURL(b);return new a(c,()=>URL.revokeObjectURL(c))};
return a}();w.loadExternal=function(a,b,c){return n.apply(this,arguments)};Object.defineProperty(w,"__esModule",{value:!0})});