// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(B,J,K,L,ea,M,S,x,T,w,N,U,V,t,C,W,O){function A(a){const b=a.outline;var c=x.isSome(a.material)?a.material.color:null;c=x.isSome(c)?c.toHex():null;if(x.isNone(b))return"fill"===
a.type&&"#ffffff"===c?{color:"#bdc3c7",width:.75}:null;a=w.pt2px(b.size)||0;return{color:"rgba("+(x.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function X(a,b){var c=b&&b.resource;c=c&&c.href;if(a.thumbnail&&a.thumbnail.url)return Promise.resolve(a.thumbnail.url);if(c&&"object"!==b.type)return Promise.resolve(O.getIconHref(a,b));const e=K.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?
W.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(m=>m).then(m=>{var v;return(null==m?void 0:null==(v=m.thumbnail)?void 0:v.url)||e}):Promise.resolve(e)}function F(a,b=1){const c=a.a;a=L.toHSV(a);const {r:e,g:m,b:v}=L.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,m,v,c]}function D(a){return"water"===a.type?x.isNone(a.color)?null:a.color:x.isNone(a.material)||x.isNone(a.material.color)?null:a.material.color}function g(a,b=0){var c=D(a);if(!c){if("fill"===a.type)return null;
b=t.adjustColorComponentBrightness(N.defaultThematicColor.r,b);return[b,b,b,100]}a=c.toRgba();for(c=0;3>c;c++)a[c]=t.adjustColorComponentBrightness(a[c],b);return a}function P(a,b){return G.apply(this,arguments)}function G(){G=J._asyncToGenerator(function*(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:yield N.getPatternUrlWithColor(K.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,height:5}});return G.apply(this,arguments)}function Q(a){return a.outline?A(a):
{color:"rgba(0, 0, 0, 1)",width:1.5}}function R(a,b){a=D(a);if(!a)return null;let c;c="rgba("+(t.adjustColorComponentBrightness(a.r,b)+",");c+=t.adjustColorComponentBrightness(a.g,b)+",";c+=t.adjustColorComponentBrightness(a.b,b)+",";return c+a.a+");"}function H(a,b){b=R(a,b);if(!b)return{};a=Math.min(a.size?w.pt2px(a.size):.75,80);return{color:b,width:a}}function E(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function Y(a){const b=
a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function Z(a,b,c){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||U.defaultPrimitive){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:A(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:A(a)});break;case "triangle":e.push({shape:{type:"path",
path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:A(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:Q(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:Q(a)});
break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:A(a)})}break;case "object":switch(a.resource&&a.resource.primitive||V.defaultPrimitive){case "cone":var m=g(a,0);a=g(a,-.6);a=E(m,a,c?20:b);b=t.getConeShapes(b,c);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":c=g(a,0);a=g(a,-.6);a=E(c,a,b);b=t.getInvertedConeShapes(b);
e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:c});break;case "cube":b=t.getCubeShapes(b,c);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,-.5)});break;case "cylinder":{m=g(a,0);const v=g(a,-.6);m=E(m,v,c?20:b);b=t.getCylinderShapes(b,c);e.push({shape:b[0],fill:m});e.push({shape:b[1],fill:m});e.push({shape:b[2],fill:g(a,0)});break}case "diamond":b=t.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],
fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":c=g(a,0);a=g(a,-.6);a=E(c,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=t.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function aa(a,b){const c=b&&b.size?w.pt2px(b.size):null,e=b&&b.maxSize?w.pt2px(b.maxSize):null,m=b&&b.disableUpsampling,v=a.symbolLayers,q=[];let n=
0,r=0;const d=v.getItemAt(v.length-1);let p;d&&"icon"===d.type&&(p=d.size&&w.pt2px(d.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var h="icon"===f.type?f.size&&w.pt2px(f.size):0,k=c||h?Math.ceil(Math.min(c||h,e||120)):22;if(f&&f.resource&&f.resource.href){var u=X(a,f).then(function(l){const z=f.get("material.color");var y="icon"===f.type?"multiply":"tint";return C.tintImageWithColor(l,k,z,y,m)}).then(function(l){const z=l.width,y=l.height;n=Math.max(n,z);r=Math.max(r,y);return[{shape:{type:"image",
x:0,y:0,width:z,height:y,src:l.url},fill:null,stroke:null}]});q.push(u)}else{let l=k;"icon"===f.type&&p&&c&&(l=h/p*k);h="tall"===(null==b?void 0:b.symbolConfig)||(null==b?void 0:null==(u=b.symbolConfig)?void 0:u.isTall)||("object"===f.type?Y(f):!1);n=Math.max(n,h?20:l);r=Math.max(r,l);q.push(Promise.resolve(Z(f,l,h)))}}});return T.eachAlways(q).then(function(f){const h=[];f.forEach(function(k){k.value?h.push(k.value):k.error&&ba.warn("error while building swatchInfo!",k.error)});return C.renderSymbol(h,
[n,r],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function ca(a,b){const c=a.symbolLayers,e=[];a=O.isVolumetricSymbol(a);const m=b&&b.size?w.pt2px(b.size):null,v=(b&&b.maxSize?w.pt2px(b.maxSize):null)||80;let q=0,n=0,r;c.forEach((d,p)=>{if(d&&("line"===d.type||"path"===d.type)){var f=[];switch(d.type){case "line":var h=H(d,0),k=h&&h.width||0;0===p&&(r=k);var u=Math.min(m||k,v);p=0===p?u:m?k/r*u:u;k=20<p?2*p:40;n=Math.max(n,p);q=Math.max(q,k);h.width=p;f.push({shape:{type:"path",path:[{command:"M",
values:[0,.5*n]},{command:"L",values:[q,.5*n]}]},stroke:h});break;case "path":p=Math.min(m||22,v);h=g(d,0);k=g(d,-.2);var l=R(d,-.4);l=l?{color:l,width:1}:{};if("quad"===d.profile){var z;const y=null!=(z=d.width)?z:d.size;d=null!=(u=d.height)?u:d.size;u=t.getPathSymbolShapes(y&&d?y/d:1,0===d,0===y);d={...l,join:"bevel"};f.push({shape:u[0],fill:k,stroke:d});f.push({shape:u[1],fill:k,stroke:d});f.push({shape:u[2],fill:h,stroke:d})}else f.push({shape:t.shapes.pathSymbol3DLayer[0],fill:k,stroke:l}),f.push({shape:t.shapes.pathSymbol3DLayer[1],
fill:h,stroke:l});q=n=Math.max(n,p)}e.push(f)}});return Promise.resolve(C.renderSymbol(e,[q,n],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}function da(a,b){return I.apply(this,arguments)}function I(){I=J._asyncToGenerator(function*(a,b){const c="mesh-3d"===a.type;a=a.symbolLayers;var e=b&&b.size?w.pt2px(b.size):null;const m=b&&b.maxSize?w.pt2px(b.maxSize):null;e=e||22;const v=[];let q=0,n=0;var r=!1;for(let u=0;u<a.length;u++){var d=a.getItemAt(u);const l=[];if(!c||"fill"===d.type){var p=t.shapes.fill[0];
switch(d.type){case "fill":var f=A(d);r=Math.min(e,m||120);q=Math.max(q,r);n=Math.max(n,r);r=!0;var h=g(d,0),k="pattern"in d&&d.pattern;d=D(d);!c&&x.isSome(k)&&"style"===k.type&&"solid"!==k.style&&d&&(h=yield P(k,d));l.push({shape:p,fill:h,stroke:f});break;case "line":d={stroke:H(d,0),shape:p};q=Math.max(q,22);n=Math.max(n,22);l.push(d);break;case "extrude":p={join:"round",...H(d,-.4)};f=g(d,0);d=g(d,-.2);h=Math.min(e,m||120);k=t.getExtrudeSymbolShapes(h);p.width=1;l.push({shape:k[0],fill:d,stroke:p});
l.push({shape:k[1],fill:d,stroke:p});l.push({shape:k[2],fill:f,stroke:p});d=22*.7+.5*h;q=Math.max(q,22);n=Math.max(n,d);break;case "water":r=D(d),d=F(r),p=F(r,2),f=F(r,3),h=t.getWaterSymbolShapes(),r=!0,l.push({shape:h[0],fill:d}),l.push({shape:h[1],fill:p}),l.push({shape:h[2],fill:f}),d=Math.min(e,m||120),q=Math.max(q,d),n=Math.max(n,d)}v.push(l)}}return Promise.resolve(C.renderSymbol(v,[q,n],{node:b&&b.node,scale:r,opacity:b&&b.opacity}))});return I.apply(this,arguments)}const ba=S.getLogger("esri.symbols.support.previewSymbol3D");
B.getPatternDescriptor=P;B.getSymbolLayerFill=g;B.previewSymbol3D=function(a,b){if(0===a.symbolLayers.length)return Promise.reject(new M("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));let c=null;switch(a.type){case "point-3d":c=aa(a,b);break;case "line-3d":c=ca(a,b);break;case "polygon-3d":case "mesh-3d":c=da(a,b)}return c?c:Promise.reject(new M("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(B,"__esModule",{value:!0})});