// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../request ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/urlUtils ../../portal/Portal ../../portal/PortalQueryParams ../../support/featureFlags ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./Thumbnail".split(" "),function(m,C,D,q,n,h,E,F,G,u,v,w,x){function H(a,b){return r(a,b).then(c=>({data:c.data,baseUrl:h.removeFile(a),styleUrl:a}))}function I(a,b,c){b=b.portal||E.getDefault();let d;const e=`${b.url} - ${b.user&&b.user.username} - ${a}`;
t[e]||(t[e]=J(a,b,c).then(f=>{d=f;return f.fetchData()}).then(f=>({data:f,baseUrl:d.itemUrl,styleName:a})));return t[e]}function J(a,b,c){return b.load(c).then(()=>{const d=new F({disableExtraQuery:!0,query:`owner:${"esri_en"} AND type:${"Style"} AND typekeywords:"${a}"`});return b.queryItems(d,c)}).then(({results:d})=>{let e=null;const f=a.toLowerCase();if(d&&Array.isArray(d))for(const k of d)if(k.typeKeywords.some(l=>l.toLowerCase()===f)&&"Style"===k.type&&"esri_en"===k.owner){e=k;break}if(!e)throw new n("symbolstyleutils:style-not-found",
`The style '${a}' could not be found`,{styleName:a});return e.load(c)})}function y(a,b,c){return a.styleUrl?H(a.styleUrl,c):a.styleName?I(a.styleName,b,c):Promise.reject(new n("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function z(a,b,c,d,e){var f=a.data;const k={portal:c.portal,url:h.urlToObject(a.baseUrl),origin:"portal-item"};f=f.items.find(g=>g.name===b);if(!f)return Promise.reject(new n("symbolstyleutils:symbol-name-not-found",
`The symbol name '${b}' could not be found`,{symbolName:b}));let l=u.fromJSON(K(f,d),k),p=f.thumbnail&&f.thumbnail.href;const A=f.thumbnail&&f.thumbnail.imageData;q.isDevEnvironment()&&(l=q.adjustStaticAGOUrl(l),p=q.adjustStaticAGOUrl(p));const L={portal:c.portal,url:h.urlToObject(h.removeFile(l)),origin:"portal-item"};return r(l,e).then(g=>{g="cimRef"===d?B(g.data):g.data;if((g=v.fromJSON(g,L))&&D.isSymbol3D(g)){if(p){const M=u.fromJSON(p,k);g.thumbnail=new x["default"]({url:M})}else A&&(g.thumbnail=
new x["default"]({url:`data:image/png;base64,${A}`}));a.styleUrl?g.styleOrigin=new w({portal:c.portal,styleUrl:a.styleUrl,name:b}):a.styleName&&(g.styleOrigin=new w({portal:c.portal,styleName:a.styleName,name:b}))}return g})}function B(a){return null===a||"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a}}function K(a,b){if("cimRef"===b)return a.cimRef;if(a.formatInfos&&!G.enableWebStyleForceWOSR())for(const c of a.formatInfos)if("gltf"===c.type)return c.href;return a.webRef}function N(a,
b,c){const d="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f\x3djson".replace(/\{SymbolName\}/gi,a.name);return r(d,c).then(e=>{e=B(e.data);return v.fromJSON(e,{portal:b.portal,url:h.urlToObject(h.removeFile(d)),origin:"portal-item"})})}function r(a,b){b={responseType:"json",query:{f:"json"},...b};return C(h.normalize(a),b)}const t={};m.fetchStyle=y;m.fetchSymbolFromStyle=z;m.resolveWebStyleSymbol=function(a,b,c,d){return a.name?
a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName?N(a,b,d):y(a,b,d).then(e=>z(e,a.name,b,c,d)):Promise.reject(new n("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};m.styleNameFromItem=function(a){for(const b of a.typeKeywords)if(/^Esri.*Style$/.test(b)&&"Esri Style"!==b)return b};Object.defineProperty(m,"__esModule",{value:!0})});