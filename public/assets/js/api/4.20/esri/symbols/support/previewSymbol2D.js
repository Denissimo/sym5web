// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../core/Error ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(y,z,A,q,v,u,B){function C(f,a){const b=D.getContext("2d"),g=[];a&&(a.weight&&g.push(a.weight),a.size&&g.push(a.size+"px"),a.family&&g.push(a.family));b.font=g.join(" ");return b.measureText(f).width}function E(f){if(0===f.length)return 0;if(2<f.length){const a=q.px2pt(1),b=parseFloat(f);switch(f.slice(-2)){case "px":return b;case "pt":return b*a;case "in":return 72*b*a;
case "pc":return 12*b*a;case "mm":return b*F*a;case "cm":return b*G*a}}return parseFloat(f)}const D=document.createElement("canvas"),F=7.2/2.54,G=72/2.54;y.previewSymbol2D=function(f,a){var b,g,c=null!=(null==a?void 0:a.size)?q.pt2px(a.size):null,l=null!=(null==a?void 0:a.maxSize)?q.pt2px(a.maxSize):null;const H=null!=(null==a?void 0:a.opacity)?a.opacity:null,r=null!=(null==a?void 0:a.rotation)?a.rotation:"angle"in f?f.angle:null,m=v.getFill(f);var h=v.getStroke(f);if(m&&!h){const n="type"in m?null:
new z(m);"#ffffff"===(n?n.toHex():null)&&(h={color:"#bdc3c7",width:.75})}const k={shape:null,fill:null,stroke:h,offset:[0,0]};null!=(b=h)&&b.width&&(h.width=Math.min(h.width,80));b=(null==(g=h)?void 0:g.width)||0;let p=null==c?!1:null!=(null==a?void 0:a.scale)?null==a?void 0:a.scale:!0,d=0,e=0,t=!1;switch(f.type){case "simple-marker":h=f.style;e=d=c=Math.min(null!=c?c:q.pt2px(f.size),l||120);switch(h){case "circle":k.shape={type:"circle",cx:0,cy:0,r:.5*c};p||(d+=b,e+=b);break;case "cross":k.shape=
{type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[d,.5*e]},{command:"M",values:[.5*d,0]},{command:"L",values:[.5*d,e]}]};break;case "diamond":k.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,.5*e]},{command:"L",values:[.5*d,e]},{command:"Z",values:[]}]};p||(d+=b,e+=b);break;case "square":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[d,e]},{command:"L",values:[0,
e]},{command:"Z",values:[]}]};p||(d+=b,e+=b);r&&(t=!0);break;case "triangle":k.shape={type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[d,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};p||(d+=b,e+=b);r&&(t=!0);break;case "x":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,e]},{command:"M",values:[d,0]},{command:"L",values:[0,e]}]};r&&(t=!0);break;case "path":k.shape={type:"path",path:f.path||""},p||(d+=b,e+=b),r&&(t=!0),p=!0}break;case "simple-line":c=
Math.min(null!=c?c:b,l||80);l=22<c?2*c:40;h.width=c;d=l;e=c;k.shape={type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[d,e]}]};break;case "picture-fill":case "simple-fill":e=d=Math.min(null!=c?c:22,l||120)+b;p=!0;k.shape="object"===typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?u.shapes.squareFill[0]:u.shapes.fill[0];break;case "picture-marker":h=q.pt2px(f.width);b=q.pt2px(f.height);g=Math.max(h,b);b=h/b;h=1>=b?Math.ceil(g*b):g;b=1>=b?g:Math.ceil(g/b);
d=Math.min(null!=c?c:h,l||120);e=Math.min(null!=c?c:b,l||120);k.shape={type:"image",x:-Math.round(d/2),y:-Math.round(e/2),width:d,height:e,src:f.url||""};r&&(t=!0);break;case "text":h=f.text||"Aa",g=f.font,c=Math.min(null!=c?c:q.pt2px(g.size),l||120),b=C(h,{weight:g.weight,size:c,family:g.family}),d=(l=/[\uE600-\uE6FF]/.test(h))?c:b,e=c,b=.25*E((g?c:0).toString()),l&&(b+=5),k.shape={type:"text",text:h,x:0,y:b,align:"middle",decoration:g&&g.decoration,rotated:f.rotated,kerning:f.kerning},k.font=g&&
{size:c,style:g.style,decoration:g.decoration,weight:g.weight,family:g.family}}if(!k.shape)return Promise.reject(new A("symbolPreview: renderPreviewHTML2D","symbol not supported."));c=f.color;l=null;m&&"pattern"===m.type&&c&&"picture-fill"!==f.type?l=v.getPatternUrlWithColor(m.src,c.toCss(!0)).then(n=>{m.src=n;k.fill=m;return k}):(k.fill=m,l=Promise.resolve(k));return l.then(n=>{const w=[[n]];if("object"===typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const x=
.6*d;w.unshift([{...n,offset:[-x,0],fill:u.adjustColorBrightness(m,-.3)}]);w.push([{...n,offset:[x,0],fill:u.adjustColorBrightness(m,.3)}]);d+=2*x}return B.renderSymbol(w,[d,e],{node:a&&a.node,scale:p,opacity:H,rotation:r,useRotationSize:t})})};Object.defineProperty(y,"__esModule",{value:!0})});