// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["./CIMSymbolHelper","./Rect","./SDFHelper","./utils"],function(l,u,r,x){return function(){function v(){}var t=v.prototype;t.dispose=function(){this._rasterizationCanvas=null};t.rasterizeJSONResource=function(a,g,c){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type){const [f,h,k]=l.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style,g);return{size:[h,k],image:new Uint32Array(f.buffer),sdf:!1,
simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===a.type||"esriSLS"===a.type){const [f,h,k]=l.SymbolHelper.rasterizeSimpleLine(a.style,a.cap);return{size:[h,k],image:new Uint32Array(f.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let b,e;"simple-marker"===a.type||"esriSMS"===a.type||"line-marker"===a.type?(a=l.CIMSymbolHelper.fromSimpleMarker(a),e=r.getSDFInfo(a)):"CIMHatchFill"===a.type?(a=l.CIMSymbolHelper.fromCIMHatchFill(a),b=new u(a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,
a.frame.ymax-a.frame.ymin)):a.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===a.markerPlacement.type?(a=l.CIMSymbolHelper.fromCIMInsidePolygon(a),b=new u(a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):e=r.getSDFInfo(a);if(e&&!c){const [f,h,k]=r.buildSDF(e);return f?{size:[h,k],image:new Uint32Array(f.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const [d,m,n,p,q]=l.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a,b,!c);return d?{size:[m,n],image:new Uint32Array(d.buffer),
sdf:!1,simplePattern:!1,anchorX:p,anchorY:q}:null};t.rasterizeImageResource=function(a,g,c,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a;this._rasterizationCanvas.height=g;var e=this._rasterizationCanvas.getContext("2d");c instanceof ImageData?e.putImageData(c,0,0):(c.setAttribute("width",`${a}px`),c.setAttribute("height",`${g}px`),e.drawImage(c,0,0,a,g));c=e.getImageData(0,0,a,g);c=new Uint8Array(c.data);if(b)for(var d of b)if(d&&
d.oldColor&&4===d.oldColor.length&&d.newColor&&4===d.newColor.length){const [m,n,p,q]=d.oldColor,[f,h,k,w]=d.newColor;if(m!==f||n!==h||p!==k||q!==w)for(b=0;b<c.length;b+=4)m===c[b]&&n===c[b+1]&&p===c[b+2]&&q===c[b+3]&&(c[b]=f,c[b+1]=h,c[b+2]=k,c[b+3]=w)}for(b=0;b<c.length;b+=4)d=c[b+3]/255,c[b]*=d,c[b+1]*=d,c[b+2]*=d;e=c;d=a;b=g;if(512<=d||512<=b){e=d/b;1<e?(d=512,b=Math.round(512/e)):(b=512,d=Math.round(512*e));e=new Uint8Array(4*d*b);const m=new Uint8ClampedArray(e.buffer);x.resampleHermite(c,a,
g,m,d,b,!1)}return{size:[d,b],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return v}()});