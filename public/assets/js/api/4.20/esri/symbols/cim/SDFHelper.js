// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(z,D,E,F){function B(b){if(!b)return null;switch(b.type){case "CIMPointSymbol":b=b.symbolLayers;if(!b||1!==b.length)break;return B(b[0]);case "CIMVectorMarker":b=b.markerGraphics;if(!b||1!==b.length)break;var a=b[0];if(!a)break;b=a.geometry;if(!b)break;a=a.symbol;if(!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type)break;return{geom:b,asFill:"CIMPolygonSymbol"===a.type};case "sdf":return{geom:b.geom,asFill:b.asFill}}return null}
function C(b){let a=Infinity,e=-Infinity,f=Infinity,c=-Infinity;for(const d of b)for(const h of d)h[0]<a&&(a=h[0]),h[0]>e&&(e=h[0]),h[1]<f&&(f=h[1]),h[1]>c&&(c=h[1]);return[a,f,e,c]}z.buildSDF=function(b){var a=b.geom;var e=a?a.rings?a.rings:a.paths?a.paths:void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax?[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]:null:null;a=Infinity;var f=-Infinity;var c=Infinity,d=-Infinity;for(var h of e)for(var n of h)n[0]<
a&&(a=n[0]),n[0]>f&&(f=n[0]),n[1]<c&&(c=n[1]),n[1]>d&&(d=n[1]);f=new F(a,c,f-a,d-c);c=64/Math.max(f.width,f.height);h=Math.round(f.width*c)+62;n=Math.round(f.height*c)+62;a=[];for(var l of e)if(l&&1<l.length){e=[];for(var k of l){let [t,x]=k;t-=f.x;x-=f.y;t*=c;x*=c;t+=30.5;x+=30.5;e.push([t,x])}b.asFill&&(d=e.length-1,e[0][0]===e[d][0]&&e[0][1]===e[d][1]||e.push(e[0]));a.push(e)}var m;l=h*n;k=Array(l);for(e=0;e<l;++e)k[e]=962;for(m of a)for(e=m.length,f=1;f<e;++f){c=m[f-1];d=m[f];var r=void 0,p=void 0;
c[0]<d[0]?(r=c[0],p=d[0]):(r=d[0],p=c[0]);var g=void 0,y=void 0;c[1]<d[1]?(g=c[1],y=d[1]):(g=d[1],y=c[1]);var u=Math.floor(r)-31;p=Math.floor(p)+31;g=Math.floor(g)-31;y=Math.floor(y)+31;0>u&&(u=0);p>h&&(p=h);0>g&&(g=0);y>n&&(y=n);r=d[0]-c[0];const t=d[1]-c[1],x=r*r+t*t;for(;u<p;u++)for(let A=g;A<y;A++){var q=(u-c[0])*r+(A-c[1])*t,v=void 0;0>q?(v=c[0],q=c[1]):q>x?(v=d[0],q=d[1]):(q/=x,v=c[0]+q*r,q=c[1]+q*t);v=(u-v)*(u-v)+(A-q)*(A-q);q=(n-A-1)*h+u;v<k[q]&&(k[q]=v)}}for(m=0;m<l;++m)k[m]=Math.sqrt(k[m]);
m=k;if(b.asFill)for(var w of a)for(b=w.length,a=1;a<b;++a)for(l=w[a-1],k=w[a],l[0]<k[0]?(e=l[0],f=k[0]):(e=k[0],f=l[0]),l[1]<k[1]?(d=l[1],c=k[1]):(d=k[1],c=l[1]),e=Math.floor(e),f=Math.floor(f)+1,d=Math.floor(d),c=Math.floor(c)+1,31>e&&(e=31),f>h-31&&(f=h-31),31>d&&(d=31),c>n-31&&(c=n-31);d<c;++d)if(l[1]>d!==k[1]>d){p=(n-d-1)*h;for(g=e;g<f;++g)g<(k[0]-l[0])*(d-l[1])/(k[1]-l[1])+l[0]&&(m[p+g]=-m[p+g]);for(g=31;g<e;++g)m[p+g]=-m[p+g]}w=m.length;b=new Uint8Array(4*w);for(a=0;a<w;++a)E.packFloatRGBA(.5-
m[a]/62,b,4*a);w=b;return[w,h,n]};z.getExtent=function(b){return b?b.rings?C(b.rings):b.paths?C(b.paths):D.isExtent(b)?[b.xmin,b.ymin,b.xmax,b.ymax]:null:null};z.getSDFInfo=B;z.getSDFMetrics=function(b,a,e,f,c){const [d,h,n,l]=b;if(n<d||l<h)return[0,0,0];var k=n-d,m=l-h;b=64/Math.max(k,m);k=Math.round(k*b);m=Math.round(m*b)+62;let r=1;a&&(r=m/b/(a.ymax-a.ymin));let p=0,g=0;f&&(c?a&&e&&0<a.ymax-a.ymin&&(p=f.x/((a.xmax-a.xmin)/(a.ymax-a.ymin)*e),g=f.y/e):(p=f.x,g=f.y));p=.5*(a.xmax+a.xmin)+p*(a.xmax-
a.xmin);g=.5*(a.ymax+a.ymin)+g*(a.ymax-a.ymin);p=(p-d)*b+31;g=(g-h)*b+31;return[r,p/(k+62)-.5,-(g/m-.5)]};z.getSDFSymbol=function(b){b=b.markerGraphics;if(!b||1!==b.length)return null;b=b[0];if(!b)return null;b=b.symbol;return!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==b.type?null:b};Object.defineProperty(z,"__esModule",{value:!0})});