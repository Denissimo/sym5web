// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/jsonUtils ./CIMEffects ./CIMOperators ./CIMPlacements ./Rect".split(" "),function(q,z,r,C,D,m,E,A,F,G){const t=Math.PI/180,H=r.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let y=function(){function g(b){this._t=b}g.createIdentity=function(){return new g([1,0,0,0,1,0])};var k=g.prototype;k.clone=function(){return new g(this._t.slice())};
k.transform=function(b){const a=this._t;return[a[0]*b[0]+a[1]*b[1]+a[2],a[3]*b[0]+a[4]*b[1]+a[5]]};g.createScale=function(b,a){return new g([b,0,0,0,a,0])};k.scale=function(b,a){const c=this._t;c[0]*=b;c[1]*=b;c[2]*=b;c[3]*=a;c[4]*=a;c[5]*=a;return this};k.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};g.createTranslate=function(b,a){return new g([0,0,b,0,0,a])};k.translate=function(b,a){const c=this._t;c[2]+=b;c[5]+=a;return this};g.createRotate=function(b){const a=
Math.cos(b);b=Math.sin(b);return new g([a,-b,0,b,a,0])};k.rotate=function(b){return this.multiply(g.createRotate(b))};k.multiply=function(b){const a=this._t;b=b._t;const c=a[1]*b[0]+a[4]*b[1],d=a[2]*b[0]+a[5]*b[1]+b[2],f=a[0]*b[3]+a[3]*b[4],e=a[1]*b[3]+a[4]*b[4],h=a[2]*b[3]+a[5]*b[4]+b[5];a[0]=a[0]*b[0]+a[3]*b[1];a[1]=c;a[2]=d;a[3]=f;a[4]=e;a[5]=h;return this};return g}();r=function(){function g(b){this._transfos=[];this._sizeTransfos=[];this._transfos.push(b||y.createIdentity());this._sizeTransfos.push(b?
b.scaleRatio():1)}var k=g.prototype;k.transformPt=function(b){return this._transfos[this._transfos.length-1].transform(b)};k.transformSize=function(b){return b*this._sizeTransfos[this._sizeTransfos.length-1]};k.back=function(){return this._transfos[this._transfos.length-1]};k.push=function(b,a){a=a?b.scaleRatio():1;b.multiply(this.back());this._transfos.push(b);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*a)};k.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,
1)};k.drawSymbol=function(b,a){if(b)switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(b,a)}};k.drawMultiLayerSymbol=function(b,a){if(b){var c=b.symbolLayers;if(c)if(b=b.effects){if(a=this.executeEffects(b,a))for(b=a.next();b;)this.drawSymbolLayers(c,b),b=a.next()}else this.drawSymbolLayers(c,a)}};k.executeEffects=function(b,a){a=new E.SimpleGeometryCursor(a);for(const c of b)(b=A.getEffectOperator(c))&&(a=b.execute(a,c,1));return a};k.drawSymbolLayers=
function(b,a){let c=b.length;for(;c--;){const f=b[c];if(f&&!1!==f.enable){var d=f.effects;if(d){if(d=this.executeEffects(d,a)){let e=d.next();for(;e;)this.drawSymbolLayer(f,e),e=d.next()}}else this.drawSymbolLayer(f,a)}}};k.drawSymbolLayer=function(b,a){switch(b.type){case "CIMSolidFill":this.drawSolidFill(a,b.color);break;case "CIMHatchFill":this.drawHatchFill(b,a);break;case "CIMSolidStroke":this.drawSolidStroke(a,b.color,b.width,b.capStyle,b.joinStyle,b.miterLimit);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(b,
a)}};k.drawHatchFill=function(b,a){const c=this._buildHatchPolyline(b,a,1);c&&(this.pushClipPath(a),this.drawMultiLayerSymbol(b.lineSymbol,c),this.popClipPath())};k.drawMarkerLayer=function(b,a){var c=b.markerPlacement;if(c){const f=A.getPlacementOperator(c);if(f){var d="CIMMarkerPlacementInsidePolygon"===c.type;d&&this.pushClipPath(a);if(a=f.execute(a,c,1))for(c=a.next();c;)this.drawMarker(b,c),c=a.next();d&&this.popClipPath()}}else d=new F.Placement,d.tx=a.x,d.ty=a.y,this.drawMarker(b,d)};k.drawMarker=
function(b,a){switch(b.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(b,a);break;case "CIMVectorMarker":this.drawVectorMarker(b,a)}};k.drawPictureMarker=function(b,a){if(b){var c=b.size||10,d=y.createIdentity(),f=b.anchorPoint;if(f){let e=f.x;f=f.y;"Absolute"!==b.anchorPointUnits&&(e*=c,f*=c);d.translate(-e,-f)}b.rotation&&d.rotate(b.rotation*t);d.translate(b.offsetX||0,b.offsetY||0);d.translate(a.tx,a.ty);this.push(d,!1);this.drawImage(b.url,c,b.scaleX);this.pop()}};
k.drawVectorMarker=function(b,a){if(b){var c=b.markerGraphics;if(c){var d=b.size,f=b.frame,e=f?f.ymax-f.ymin:0;d=d&&e?d/e:1;e=y.createIdentity();f&&e.translate(.5*-(f.xmax+f.xmin),.5*-(f.ymax+f.ymin));var h=b.anchorPoint;if(h){let l=h.x;h=h.y;"Absolute"!==b.anchorPointUnits?f&&(l*=f.xmax-f.xmin,h*=f.ymax-f.ymin):(l/=d,h/=d);e.translate(-l,-h)}1!==d&&e.scale(d,d);b.rotation&&e.rotate(b.rotation*t);e.translate(b.offsetX||0,b.offsetY||0);e.translate(a.tx,a.ty);this.push(e,b.scaleSymbolsProportionally);
for(const l of c)l&&l.symbol&&l.geometry||H.error("Invalid marker graphic",l),this.drawSymbol(l.symbol,l.geometry);this.pop()}}};k._buildHatchPolyline=function(b,a,c){var d=(void 0!==b.separation?b.separation:4)*c,f=void 0!==b.rotation?b.rotation:0;if(0===d)return null;0>d&&(d=-d);for(var e=0,h=.5*d;e>h;)e-=d;for(;e<-h;)e+=d;e=C.create();D.getBoundsXY(e,a);e[0]-=h;e[1]-=h;e[2]+=h;e[3]+=h;for(var l=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]];180<f;)f-=180;for(;0>f;)f+=180;h=Math.cos(f*t);var n=
Math.sin(f*t);f=-d*n;a=d*h;e=(void 0!==b.offsetX?b.offsetX*c:0)*n-(void 0!==b.offsetY?b.offsetY*c:0)*h;let u;var p=b=Number.MAX_VALUE;u=c=-Number.MAX_VALUE;for(var v of l){var w=v[0];const B=v[1];l=h*w+n*B;w=-n*w+h*B;p=Math.min(p,l);b=Math.min(b,w);u=Math.max(u,l);c=Math.max(c,w)}b=Math.floor(b/d)*d;v=h*p-n*b-f*e/d;p=n*p+h*b-a*e/d;l=h*u-n*b-f*e/d;e=n*u+h*b-a*e/d;d=1+Math.round((c-b)/d);h=[];for(n=0;n<d;n++)v+=f,p+=a,l+=f,e+=a,h.push([[v,p],[l,e]]);return{paths:h}};return g}();let I=function(g){function k(){var a=
g.call(this)||this;a.reset();return a}z._inheritsLoose(k,g);var b=k.prototype;b.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0};b.envelope=function(){return new G(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};b.drawSolidFill=function(a){!a||0<this._clipCount||(m.isPolygon(a)?this._processPath(a.rings,0):m.isPolyline(a)?this._processPath(a.paths,0):m.isExtent(a)&&(a=x(a))&&this._processPath(a.rings,0))};b.drawSolidStroke=function(a,
c,d){!a||0<this._clipCount||(c=.5*this.transformSize(d),m.isPolygon(a)?this._processPath(a.rings,c):m.isPolyline(a)?this._processPath(a.paths,c):m.isExtent(a)&&(a=x(a))&&this._processPath(a.rings,c))};b.pushClipPath=function(a){this.drawSolidFill(a);++this._clipCount};b.popClipPath=function(){--this._clipCount};b.drawImage=function(a,c,d){a=c/2;this._merge(this.transformPt([0,0]),a)};b._processPath=function(a,c){if(a)for(const d of a)if(a=d?d.length:0,1<a){this._merge(this.transformPt(d[0]),c);for(let f=
1;f<a;++f)this._merge(this.transformPt(d[f]),c)}};b._merge=function(a,c){a[0]-c<this._xmin&&(this._xmin=a[0]-c);a[0]+c>this._xmax&&(this._xmax=a[0]+c);a[1]-c<this._ymin&&(this._ymin=a[1]-c);a[1]+c>this._ymax&&(this._ymax=a[1]+c)};return k}(r),J=function(g){function k(a,c){c=g.call(this,c)||this;c._ctx=a;return c}z._inheritsLoose(k,g);var b=k.prototype;b.drawSolidFill=function(a,c){if(a){if(m.isPolygon(a))this._buildPath(a.rings,!0);else if(m.isPolyline(a))this._buildPath(a.paths,!0);else if(m.isExtent(a))this._buildPath(x(a).rings,
!0);else return;a=this._ctx;a.fillStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/255+")";a.fill("evenodd")}};b.drawSolidStroke=function(a,c,d,f,e,h){if(a&&c&&0!==d){if(m.isPolygon(a))this._buildPath(a.rings,!0);else if(m.isPolyline(a))this._buildPath(a.paths,!1);else if(m.isExtent(a))this._buildPath(x(a).rings,!0);else return;a=this._ctx;a.strokeStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+
c[3]/255+")";a.lineWidth=this.transformSize(d)+.5;this._setCapStyle(f);this._setJoinStyle(e);a.miterLimit=h;a.stroke()}};b.pushClipPath=function(a){this._ctx.save();if(m.isPolygon(a))this._buildPath(a.rings,!0);else if(m.isPolyline(a))this._buildPath(a.paths,!0);else if(m.isExtent(a))this._buildPath(x(a).rings,!0);else return;this._ctx.clip("evenodd")};b.popClipPath=function(){this._ctx.restore()};b.drawImage=function(a,c,d){};b._buildPath=function(a,c){const d=this._ctx;d.beginPath();if(a)for(const f of a)if(a=
f?f.length:0,1<a){let e=this.transformPt(f[0]);d.moveTo(e[0],e[1]);for(let h=1;h<a;++h)e=this.transformPt(f[h]),d.lineTo(e[0],e[1]);c&&d.closePath()}};b._setCapStyle=function(a){switch(a){case "Butt":this._ctx.lineCap="butt";break;case "Round":this._ctx.lineCap="round";break;case "Square":this._ctx.lineCap="square"}};b._setJoinStyle=function(a){switch(a){case "Bevel":this._ctx.lineJoin="bevel";break;case "Round":this._ctx.lineJoin="round";break;case "Miter":this._ctx.lineJoin="miter"}};return k}(r);
const x=g=>g?{spatialReference:g.spatialReference,rings:[[[g.xmin,g.ymin],[g.xmin,g.ymax],[g.xmax,g.ymax],[g.xmax,g.ymin],[g.xmin,g.ymin]]]}:null;q.CIMSymbolDrawHelper=r;q.C_DEG_TO_RAD=t;q.CanvasDrawHelper=J;q.EnvDrawHelper=I;q.Transformation=y;Object.defineProperty(q,"__esModule",{value:!0})});