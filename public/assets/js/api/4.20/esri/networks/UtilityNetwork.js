// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ./Network ./support/NamedTraceConfiguration ./support/TerminalConfiguration".split(" "),function(m,h,x,n,f,B,C,D,y,z,A,u){f=function(r){function p(a){a=r.call(this,a)||this;a.sharedNamedTraceConfigurations=[];a.type="utility";return a}m._inheritsLoose(p,r);var q=
p.prototype;q.load=function(){var a=m._asyncToGenerator(function*(b){this.addResolvingPromise(r.prototype.load.call(this,b));this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(b));return this});return function(b){return a.apply(this,arguments)}}();q.getTerminalConfiguration=function(a){let b=null,d=null;var c=a.layer;let k=null;if("feature"===(null==c?void 0:c.type)){if(k=c.layerId,null===k)return null}else return null;c=a.attributes;if(null==c)return null;for(const e of Object.keys(c))"ASSETGROUP"===
e.toUpperCase()&&(b=a.getAttribute(e)),"ASSETTYPE"===e.toUpperCase()&&(d=a.getAttribute(e));if(!this.dataElement)return null;let t=null;a=this.dataElement.domainNetworks;for(const e of a){var g;if(a=null==(g=e.junctionSources)?void 0:g.find(l=>l.layerId===k)){var v;if(a=null==(v=a.assetGroups)?void 0:v.find(l=>l.assetGroupCode===b)){var w;if(a=null==(w=a.assetTypes)?void 0:w.find(l=>l.assetTypeCode===d)){t=a.terminalConfigurationId;break}}}}return null!=t?(g=this.dataElement.terminalConfigurations,
(g=null==g?void 0:g.find(e=>e.terminalConfigurationId===t))?u.fromJSON(g):null):null};q._loadNamedTraceConfigurationsFromNetwork=function(){var a=m._asyncToGenerator(function*(b){var d;if(0!==(null==(d=this.sharedNamedTraceConfigurations)?void 0:d.length)){d=this.sharedNamedTraceConfigurations.map(c=>c.globalId);b=yield this._fetchTraceConfigData(this.networkServiceUrl,d,b);for(const c of this.sharedNamedTraceConfigurations)(d=null==b?void 0:b.find(k=>k.globalId===c.globalId))&&c.read(d,{origin:"service"})}});
return function(b){return a.apply(this,arguments)}}();q._fetchTraceConfigData=function(a,b,d){return x(`${a}/traceConfigurations/query`,{responseType:"json",query:{globalIds:JSON.stringify(b),f:"json"},...d}).then(c=>c.data.traceConfigurations)};m._createClass(p,[{key:"serviceTerritoryFeatureLayerId",get:function(){var a;return null==(a=this.dataElement)?void 0:a.serviceTerritoryFeatureLayerId}},{key:"terminalConfigurations",get:function(){var a;return null==(a=this.dataElement)?void 0:a.terminalConfigurations.map(b=>
u.fromJSON(b))}}]);return p}(z);h.__decorate([n.property({type:[A],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],f.prototype,"sharedNamedTraceConfigurations",void 0);h.__decorate([n.property({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],f.prototype,"type",void 0);h.__decorate([n.property({readOnly:!0})],f.prototype,"serviceTerritoryFeatureLayerId",null);h.__decorate([n.property({readOnly:!0})],
f.prototype,"terminalConfigurations",null);return f=h.__decorate([y.subclass("esri.networks.UtilityNetwork")],f)});