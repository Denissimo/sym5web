// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils".split(" "),function(t,m,A,B,k,w,R,G,S,T,H,U,I){function C(c,b,d,g=H.createDirectionUp()){k.cross(q,c,J);0===k.dot(q,q)&&k.cross(q,c,K);A.identity(u);A.rotate(u,u,-m.deg2rad(b),c);A.rotate(u,u,-m.deg2rad(d),q);const {up:a,
direction:f}=g;k.cross(a,q,c);k.normalize(a,a);k.transformMat4(a,a,u);k.normalize(f,c);k.negate(f,f);k.transformMat4(f,f,u);return g}function L(c,b,d,g){const a=q,f=x;k.normalize(a,c);k.cross(x,a,J);0===k.dot(x,x)&&k.cross(x,a,K);k.cross(f,x,a);return H.directionToHeadingTilt(b,d,g,a,f)}function M(c,b,d,g){const a={eye:w.create(),up:null,tilt:g,heading:d},f=q;f[0]=c[0];f[1]=c[2];f[2]=-c[1];d=m.deg2rad(d);var e=m.deg2rad(g);g=Math.sin(d);d=Math.cos(d);var h=Math.sin(e),r=Math.cos(e);const l=k.length(f);
if(1E-8>Math.abs(e))e=b+l;else{var n=l/h,y=m.asinClamped(b/n);e=n*Math.sin(Math.PI-e-y)}r*=b;n=b*b*h*h;y=d*d*n;const z=e-r,D=z*z;var p=y*(y+D-f[1]*f[1]);if(0>p)return k.scale(a.eye,f,e/l),a.tilt=0,a;var v=Math.sqrt(p);const N=f[1]*z;p=y+D;v=0<d?-v+N:v+N;if(1E-8>Math.abs(p))return 1E-8>l?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=b):k.scale(a.eye,f,e/l),a.tilt=0,E(a.eye),F(a,c);a.eye[1]=v/p;b*=h;v=a.eye[1]*a.eye[1];h=1-v;p=Math.sqrt(h);n=y*v+g*g*n-2*d*b*a.eye[1]*p*z+h*D;if(1E-8>Math.abs(n))return k.scale(a.eye,
f,e/l),a.tilt=0,E(a.eye),F(a,c);a.eye[0]=(h*(e*f[0]-r*f[0])-b*p*(f[0]*a.eye[1]*d+f[2]*g))/n;a.eye[2]=(h*(e*f[2]-r*f[2])-b*p*(f[2]*a.eye[1]*d-f[0]*g))/n;k.scale(a.eye,a.eye,e);E(a.eye);return F(a,c)}function E(c){const b=c[1];c[1]=-c[2];c[2]=b}function F(c,b){b=C(b,c.heading,c.tilt);c.up=b.up;return c}function O(c,b,d){b=k.length(b);d=m.asinClamped(d/(Math.sqrt(d*d+b*b-2*d*b*Math.cos(Math.PI-c))/Math.sin(c)));return m.rad2deg(c-d)}function P(c,b,d){c=m.deg2rad(c);b=k.length(b);return m.asinClamped(d/
(b/Math.sin(c)))+c}function Q(c,b,d,g,a){function f(l){const n=Math.PI/2;l=I.cyclical2PI.normalize(l,-n);l>n&&(l=Math.PI-l);return l}var e=b.latitude;b=b.longitude;var h=U.getLonDeltaForDistance(e,d,G.getReferenceEllipsoid(c.spatialReference).radius)/2;d=b-h;b+=h;e=m.deg2rad(e);h=G.getReferenceEllipsoid(c.spatialReference).radius;e=(1+Math.sin(e))/(1-Math.sin(e));const r=(e+1)*Math.tan(g/h/2);e=1.5*Math.PI-2*Math.atan(.5*(r+Math.sqrt(4*e+r*r)));g=e+g/h;e=f(e);g=f(g);g<e&&(h=g,g=e,e=h);e=Math.max(m.rad2deg(e),
-90);g=Math.min(m.rad2deg(g),90);b=V.monotonic(d,b);180<b-d&&(h=(b-d-180)/2,d+=h,b-=h);h=c.spatialReference&&c.spatialReference.isGeographic?c.spatialReference:S.WGS84;a?(a.xmin=d,a.ymin=e,a.xmax=b,a.ymax=g,a.spatialReference=h):a=new R(d,e,b,g,h);c.spatialReference&&c.spatialReference.isWebMercator&&T.geographicToWebMercator(a,!1,a);return a}const J=w.fromValues(0,0,1),K=k.normalize(w.create(),w.fromValues(1,1,1)),V=new I.Cyclical(-180,180),u=B.create(),q=w.create(),x=w.create();B=Object.freeze({__proto__:null,
headingTiltToDirectionUp:C,directionToHeadingTilt:L,eyeForCenterWithHeadingTilt:M,lookAtTiltToEyeTilt:O,eyeTiltToLookAtTilt:P,toExtent:Q});t.cameraUtilsSpherical=B;t.directionToHeadingTilt=L;t.eyeForCenterWithHeadingTilt=M;t.eyeTiltToLookAtTilt=P;t.headingTiltToDirectionUp=C;t.lookAtTiltToEyeTilt=O;t.toExtent=Q});