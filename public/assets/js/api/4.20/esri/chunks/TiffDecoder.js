// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../layers/support/rasterDatasets/byteStreamUtils ./Jpg ../layers/support/rasterFormats/Lzw ../layers/support/rasterFormats/TiffTags ../layers/support/rasterFormats/utils ./Zlib".split(" "),function(O,sa,X,ea,S,fa,Y){function ha(h,n){let p="unknown";3===h?p="f32":1===h?1===n?p="u1":2===n?p="u2":4===n?p="u4":8>=n?p="u8":16>=n?p="u16":32>=n&&(p="u32"):2===h&&(8>=n?p="s8":16>=n?p="s16":32>=n&&(p="s32"));return p}function T(h){let n=null;switch(h?h.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":n=
Uint8Array;break;case "u16":n=Uint16Array;break;case "u32":n=Uint32Array;break;case "s8":n=Int8Array;break;case "s16":n=Int16Array;break;case "s32":n=Int32Array;break;default:n=Float32Array}return n}function ta(h,n){return{x:n[0]*h.x+n[1]*h.y+n[2],y:n[3]*h.x+n[4]*h.y+n[5]}}function ia(h,n){var p;return null==(p=h.get(n))?void 0:p.values}function Q(h,n){var p;return null==(p=h.get(n))?void 0:p.values}function Z(h,n){var p;return null==(p=h.get(n))?void 0:p.values[0]}function H(h,n){var p;return null==
(p=h.get(n))?void 0:p.values[0]}function aa(h,n,p,v=0,b=S.TIFF_TAGS,a=4){var c=8===a;const e=c?ba(new DataView(h,p,8),0,n):(new DataView(h,p,2)).getUint16(0,n),d=4+2*a;var k=c?8:2;c=k+e*d;if(p+c>h.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:c};const l=p+c+4<=h.byteLength?U(new DataView(h,p+c,8===a?8:4),0,n,8===a):null;p+=k;k=new Map;let f,g,q,m,t;for(let r=0;r<e;r++){var u=new DataView(h,p+d*r,d);f=u.getUint16(0,n);q=u.getUint16(2,n);g=S.getTagName(f,b);const w=[];2===a?
(m=u.getUint16(4,n),t=u.getUint16(6,n)):4===a?(m=u.getUint32(4,n),t=u.getUint32(8,n)):8===a&&(m=U(u,4,n,!0),t=U(u,12,n,!0),w.push(u.getUint32(12,n)),w.push(u.getUint32(16,n)));u={id:f,type:q,valueCount:m,valueOffset:t,valueOffsets:w,values:null};ja(h,n,u,v,!1,a);k.set(g,u)}return{success:!0,ifd:k,nextIFD:l,requiredBufferSize:c}}function ja(h,n,p,v=0,b=!1,a=4){if(p.values)return!0;var c=p.type,e=p.valueCount,d=p.valueOffset;let k=[];var l=ka[c],f=8*l,g=e*l,q=e*ka[c]*8,m=8===a?64:32;a=p.valueOffsets;
if(q>m&&g>(b?h.byteLength:h?h.byteLength-d+v:0))return p.offlineOffsetSize=[d,g],p.values=null,!1;if(q<=m)if(n||(32>=m?d>>>=32-q:(h=null!=a&&a.length?a[0]:d>>>0,n=null!=a&&a.length?a[1]:Math.round((d-h)/4294967296),32>=q?(d=h>>>32-q,a[0]=d):(d=h*2**(32-q)+(n>>>32-q),a[0]=h,a[1]=n>>>32-q))),1===e&&f===m)k=[d];else if(64===m)for(h=null!=a&&a.length?a[0]:d>>>0,d=null!=a&&a.length?a[1]:Math.round((d-h)/4294967296),n=h,l=32,h=1;h<=e;h++)g=32-f*h%32,l<f?(g=n<<g>>>32-l,q=d<<32-l>>>32-l,n=d,k.push(g+q*2**
(f-l)),l-=32-(f-l)):(k.push(n<<g>>>32-f),l-=f),0===l&&(l=32,n=d);else for(h=1;h<=e;h++)k.push(d<<32-f*h>>>32-f);else for(d-=v,b&&(d=0),e=d;e<d+g;e+=l){switch(c){case 1:f=(new DataView(h,e,1)).getUint8(0);break;case 2:f=(new DataView(h,e,1)).getUint8(0);break;case 3:f=(new DataView(h,e,2)).getUint16(0,n);break;case 4:case 13:f=(new DataView(h,e,4)).getUint32(0,n);break;case 5:f=(new DataView(h,e,4)).getUint32(0,n)/(new DataView(h,e+4,4)).getUint32(0,n);break;case 6:f=(new DataView(h,e,1)).getInt8(0);
break;case 7:f=(new DataView(h,e,1)).getUint8(0);break;case 8:f=(new DataView(h,e,2)).getInt16(0,n);break;case 9:f=(new DataView(h,e,4)).getInt32(0,n);break;case 10:f=(new DataView(h,e,4)).getInt32(0,n)/(new DataView(h,e+4,4)).getInt32(0,n);break;case 11:f=(new DataView(h,e,4)).getFloat32(0,n);break;case 12:f=(new DataView(h,e,8)).getFloat64(0,n);break;case 16:case 18:f=ba(new DataView(h,e,8),0,n);break;case 17:a=new DataView(h,e,8);q=(f=n)?a.getInt32(0,f):a.getUint32(0,f);a=f?a.getUint32(4,f):a.getInt32(4,
f);m=0<=(f?q:a)?1:-1;f?q*=m:a*=m;f=m*(f?4294967296*a+q:4294967296*q+a);break;default:f=null}k.push(f)}if(2===c){c="";d=k;k=[];for(h=0;h<d.length;h++)0===d[h]&&""!==c?(k.push(c),c=""):c+=String.fromCharCode(d[h]);""===c&&0!==k.length||k.push(c)}p.values=k;return!0}function V(h){var n,p,v=h[0];const b=H(v,"TILEWIDTH"),a=H(v,"TILELENGTH"),c=H(v,"IMAGEWIDTH"),e=H(v,"IMAGELENGTH");var d=H(v,"BITSPERSAMPLE");const k=H(v,"SAMPLESPERPIXEL");var l=null!=(n=H(v,"SAMPLEFORMAT"))?n:1;n=ha(l,d);const f=W(v);var g=
ia(v,"GDAL_NODATA");let q;null!=g&&g.length&&(q=g.map(D=>parseFloat(D)),q.some(D=>isNaN(D))&&(q=null));var m=null!=(p=H(v,"COMPRESSION"))?p:1;switch(m){case 1:p="NONE";break;case 2:case 3:case 4:case 32771:p="CCITT";break;case 5:p="LZW";break;case 6:case 7:p="JPEG";break;case 32773:p="PACKBITS";break;case 8:case 32946:p="DEFLATE";break;case 34712:p="JPEG2000";break;case 34887:p="LERC";break;default:p=String(m)}g=!0;let t="";ua.has(m)||(g=!1,t+="unsupported tag compression "+m);3<l&&(g=!1,t+="unsupported tag sampleFormat "+
l);0!==d%8&&(g=!1,t+="unsupported tag bitsPerSample "+d);d=Z(v,"GEOASCIIPARAMS");if(d){var u=(u=d.split("|").filter(D=>-1<D.indexOf("ESRI PE String \x3d "))[0])?u.replace("ESRI PE String \x3d ",""):"";u=u.startsWith("COMPD_CS")||u.startsWith("PROJCS")||u.startsWith("GEOGCS")?{wkid:null,wkt:u}:null}l=Q(v,"GEOTIEPOINTS");d=Q(v,"GEOPIXELSCALE");m=Q(v,"GEOTRANSMATRIX");var r=v.has("GEOKEYDIRECTORY")?v.get("GEOKEYDIRECTORY").data:null;v=!1;if(r){v=2===H(r,"GTRasterTypeGeoKey");var w=H(r,"GTModelTypeGeoKey");
2===w?(r=H(r,"GeographicTypeGeoKey"),1024<=r&&32766>=r&&(u={wkid:r})):1===w&&(r=H(r,"ProjectedCSTypeGeoKey"),1024<=r&&32766>=r&&(u={wkid:r}))}let y;d&&l&&6<=l.length?(y=[d[0],0,l[3]-l[0]*d[0],0,-Math.abs(d[1]),l[4]-l[1]*d[1]],v&&(y[2]-=.5*y[0]+.5*y[1],y[5]-=.5*y[3]+.5*y[4])):m&&16===m.length&&(y=v?[m[0],m[1],m[3]-.5*m[0],m[4],m[5],m[7]-.5*m[5]]:[m[0],m[1],m[3],m[4],m[5],m[7]]);if(y){v=[{x:0,y:e},{x:0,y:0},{x:c,y:e},{x:c,y:0}];r=m=Number.POSITIVE_INFINITY;let D=w=Number.NEGATIVE_INFINITY;for(let x=
0;x<v.length;x++)l=ta(v[x],y),m=l.x>m?m:l.x,w=l.x<w?w:l.x,r=l.y>r?r:l.y,D=l.y<D?D:l.y;u={xmin:m,xmax:w,ymin:r,ymax:D,spatialReference:u}}else u={xmin:-.5,ymin:.5-e,xmax:c-.5,ymax:.5,spatialReference:u};v=h.filter(D=>1===Z(D,"NEWSUBFILETYPE"));let A,F,C;if(0<v.length){A=Math.round(Math.log(c/H(v[0],"IMAGEWIDTH"))/Math.LN2);var z=v[v.length-1];F=Math.round(Math.log(c/H(z,"IMAGEWIDTH"))/Math.LN2);C=H(z,"TILEWIDTH");z=H(z,"TILELENGTH")}C=0<F?C||b:null;z=0<F?z||a:null;let E;b&&(E=[{maxCol:Math.ceil(c/
b)-1,maxRow:Math.ceil(e/a)-1,minRow:0,minCol:0}],v.forEach(D=>{E.push({maxCol:Math.ceil(H(D,"IMAGEWIDTH")/H(D,"TILEWIDTH"))-1,maxRow:Math.ceil(H(D,"IMAGELENGTH")/H(D,"TILELENGTH"))-1,minRow:0,minCol:0})}));v=Z(h[0],"GDAL_METADATA");v=va(v);t+=" "+la({width:c,height:e,tileWidth:b,tileHeight:a,planes:k,ifds:h});return{width:c,height:e,tileWidth:b,tileHeight:a,planes:k,isBSQ:f,pixelType:n,compression:p,noData:q,isSupported:g,message:t,extent:u,affine:d?null:y,firstPyramidLevel:A,maximumPyramidLevel:F,
pyramidBlockWidth:C,pyramidBlockHeight:z,tileBoundary:E,metadata:v}}function W(h,n){return(h=ia(h,"PLANARCONFIGURATION"))?2===h[0]:n?n.isBSQ:!1}function ma(h){const {littleEndian:n,isBigTiff:p,firstIFD:v}=na(h);var b=v;const a=[];do if(b=oa(h,n,b,0,S.TIFF_TAGS,p?8:4),b.success)a.push(b.ifd),b=b.nextIFD;else break;while(0<b);return{...V(a),littleEndian:n,isBigTiff:p,ifds:a}}function ba(h,n,p){const v=h.getUint32(n,p);h=h.getUint32(n+4,p);return p?4294967296*h+v:4294967296*v+h}function U(h,n,p,v){return v?
ba(h,n,p):h.getUint32(n,p)}function na(h){var n=new DataView(h,0,16),p=n.getUint16(0,!1);h=null;if(18761===p)h=!0;else if(19789===p)h=!1;else throw"unexpected endianess byte";var v=n.getUint16(2,h);if(42!==v&&43!==v)throw"unexpected tiff identifier";p=4;if(v=43===v){const b=n.getUint16(p,h);p+=2;if(8!==b)throw"unsupported bigtiff version";if(0!==n.getUint16(p,h))throw"unsupported bigtiff version";p+=2}n=U(n,p,h,v);return{littleEndian:h,isBigTiff:v,firstIFD:n}}function oa(h,n,p,v=0,b=S.TIFF_TAGS,a=
4){p=aa(h,n,p,v,b,a);let c;const e=p.ifd;e&&(S.ifdTags.forEach((d,k)=>{e.has(k)&&(c=e.get(k),c.data=aa(h,n,c.valueOffset-v,v,d).ifd)}),e.has("GEOKEYDIRECTORY")&&(c=e.get("GEOKEYDIRECTORY"),(b=c.values)&&4<b.length&&(b=b[0]+"."+b[1]+"."+b[2],c.data=aa(h,n,c.valueOffset+6-v,v,S.GEO_KEYS,2).ifd,c.data&&c.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[b]}))),e.has("XMP")&&(c=e.get("XMP"),b=c.values,"number"===typeof b[0]&&7===c.type&&(c.values=[sa.bytesToUTF8(new Uint8Array(b))])));
return p}function la(h){const {width:n,height:p,tileHeight:v,tileWidth:b}=h,a=h.planes,c=b?b*v:n*p;h=H(h.ifds[0],"BITSPERSAMPLE");let e="";c*a>2**30/(8<h?h/8:1)&&(e=b?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported");return e}var pa={exports:{}};(function(h){(function(n){n=n();void 0!==n&&(h.exports=n)})(function(){var n={unstuff:function(b,a,c,e,d,k,l,f){var g=(1<<c)-1,q=0,m,t=0;b[b.length-1]<<=8*(4*b.length-Math.ceil(c*e/8));if(d)for(m=
0;m<e;m++){if(0===t){var u=b[q++];t=32}if(t>=c){var r=u>>>t-c&g;t-=c}else t=c-t,r=(u&g)<<t&g,u=b[q++],t=32-t,r+=u>>>t;a[m]=d[r]}else for(d=Math.ceil((f-k)/l),m=0;m<e;m++)0===t&&(u=b[q++],t=32),t>=c?(r=u>>>t-c&g,t-=c):(t=c-t,r=(u&g)<<t&g,u=b[q++],t=32-t,r+=u>>>t),a[m]=r<d?k+r*l:f},unstuffLUT:function(b,a,c,e,d,k){var l=(1<<a)-1,f=0,g=0,q=0,m=q=0,t=[];b[b.length-1]<<=8*(4*b.length-Math.ceil(a*c/8));var u=Math.ceil((k-e)/d);for(g=0;g<c;g++){if(0===q){var r=b[f++];q=32}q>=a?(m=r>>>q-a&l,q-=a):(q=a-q,
m=(r&l)<<q&l,r=b[f++],q=32-q,m+=r>>>q);t[g]=m<u?e+m*d:k}t.unshift(e);return t},unstuff2:function(b,a,c,e,d,k,l,f){var g=(1<<c)-1,q=0,m,t=0,u=0;if(d)for(m=0;m<e;m++){if(0===t){var r=b[q++];t=32;u=0}if(t>=c){var w=r>>>u&g;t-=c;u+=c}else{var y=c-t;w=r>>>u&g;r=b[q++];t=32-y;w|=(r&(1<<y)-1)<<c-y;u=y}a[m]=d[w]}else for(d=Math.ceil((f-k)/l),m=0;m<e;m++)0===t&&(r=b[q++],t=32,u=0),t>=c?(w=r>>>u&g,t-=c,u+=c):(y=c-t,w=r>>>u&g,r=b[q++],t=32-y,w|=(r&(1<<y)-1)<<c-y,u=y),a[m]=w<d?k+w*l:f;return a},unstuffLUT2:function(b,
a,c,e,d,k){var l=(1<<a)-1,f=0,g=0,q=0,m=0,t=0,u=0,r=[],w=Math.ceil((k-e)/d);for(g=0;g<c;g++){if(0===m){var y=b[f++];m=32;u=0}m>=a?(t=y>>>u&l,m-=a,u+=a):(q=a-m,t=y>>>u&l,y=b[f++],m=32-q,t|=(y&(1<<q)-1)<<a-q,u=q);r[g]=t<w?e+t*d:k}r.unshift(e);return r},originalUnstuff:function(b,a,c,e){var d=(1<<c)-1,k=0,l,f=0;b[b.length-1]<<=8*(4*b.length-Math.ceil(c*e/8));for(l=0;l<e;l++){if(0===f){var g=b[k++];f=32}if(f>=c){var q=g>>>f-c&d;f-=c}else f=c-f,q=(g&d)<<f&d,g=b[k++],f=32-f,q+=g>>>f;a[l]=q}return a},originalUnstuff2:function(b,
a,c,e){var d=(1<<c)-1,k=0,l,f=0,g=0;for(l=0;l<e;l++){if(0===f){var q=b[k++];f=32;g=0}if(f>=c){var m=q>>>g&d;f-=c;g+=c}else{var t=c-f;m=q>>>g&d;q=b[k++];f=32-t;m|=(q&(1<<t)-1)<<c-t;g=t}a[l]=m}return a}},p={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(b){for(var a=65535,c=65535,e=b.length,d=Math.floor(e/2),k=0;d;){var l=359<=d?359:d;d-=l;do a+=b[k++]<<8,c+=a+=b[k++];while(--l);a=(a&65535)+(a>>>16);c=(c&65535)+(c>>>16)}e&1&&(c+=a+=b[k]<<8);return((c&65535)+(c>>>16)<<16|(a&65535)+(a>>>16))>>>
0},readHeaderInfo:function(b,a){var c=a.ptr,e=new Uint8Array(b,c,6),d={};d.fileIdentifierString=String.fromCharCode.apply(null,e);if(0!==d.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+d.fileIdentifierString;c+=6;e=new DataView(b,c,8);var k=e.getInt32(0,!0);d.fileVersion=k;c+=4;3<=k&&(d.checksum=e.getUint32(4,!0),c+=4);e=new DataView(b,c,12);d.height=e.getUint32(0,!0);d.width=e.getUint32(4,!0);c+=8;4<=k?(d.numDims=e.getUint32(8,!0),c+=4):d.numDims=
1;e=new DataView(b,c,40);d.numValidPixel=e.getUint32(0,!0);d.microBlockSize=e.getInt32(4,!0);d.blobSize=e.getInt32(8,!0);d.imageType=e.getInt32(12,!0);d.maxZError=e.getFloat64(16,!0);d.zMin=e.getFloat64(24,!0);d.zMax=e.getFloat64(32,!0);c+=40;a.headerInfo=d;a.ptr=c;if(3<=k&&(b=this.computeChecksumFletcher32(new Uint8Array(b,c-(4<=k?52:48),d.blobSize-14)),b!==d.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(b,a){var c=a.headerInfo,e=this.getDataTypeArray(c.imageType),d=c.numDims*
this.getDataTypeSize(c.imageType),k=this.readSubArray(b,a.ptr,e,d);b=this.readSubArray(b,a.ptr+d,e,d);a.ptr+=2*d;d=!0;for(a=0;a<c.numDims;a++)if(k[a]!==b[a]){d=!1;break}c.minValues=k;c.maxValues=b;return d},readSubArray:function(b,a,c,e){if(c===Uint8Array)b=new Uint8Array(b,a,e);else{var d=new ArrayBuffer(e);(new Uint8Array(d)).set(new Uint8Array(b,a,e));b=new c(d)}return b},readMask:function(b,a){var c=a.ptr,e=a.headerInfo,d=e.width*e.height,k=e.numValidPixel,l=new DataView(b,c,4);e={};e.numBytes=
l.getUint32(0,!0);c+=4;if((0===k||d===k)&&0!==e.numBytes)throw"invalid mask";if(0===k)k=new Uint8Array(Math.ceil(d/8)),e.bitset=k,l=new Uint8Array(d),a.pixels.resultMask=l,c+=e.numBytes;else if(0<e.numBytes){k=new Uint8Array(Math.ceil(d/8));l=new DataView(b,c,e.numBytes);b=l.getInt16(0,!0);var f=2,g=0,q=0;do{if(0<b)for(;b--;)k[g++]=l.getUint8(f++);else for(q=l.getUint8(f++),b=-b;b--;)k[g++]=q;b=l.getInt16(f,!0);f+=2}while(f<e.numBytes);if(-32768!==b||g<k.length)throw"Unexpected end of mask RLE encoding";
l=new Uint8Array(d);for(f=f=b=0;f<d;f++)f&7?(b=k[f>>3],b<<=f&7):b=k[f>>3],b&128&&(l[f]=1);a.pixels.resultMask=l;e.bitset=k;c+=e.numBytes}a.ptr=c;a.mask=e;return!0},readDataOneSweep:function(b,a,c,e){var d=a.ptr,k=a.headerInfo,l=k.numDims,f=k.width*k.height;k=k.numValidPixel*p.getDataTypeSize(k.imageType)*l;var g=a.pixels.resultMask;if(c===Uint8Array)b=new Uint8Array(b,d,k);else{var q=new ArrayBuffer(k);(new Uint8Array(q)).set(new Uint8Array(b,d,k));b=new c(q)}if(b.length===f*l)a.pixels.resultPixels=
e?p.swapDimensionOrder(b,f,l,c,!0):b;else{a.pixels.resultPixels=new c(f*l);var m=q=c=0,t=0;if(1<l)if(e)for(q=0;q<f;q++){if(g[q])for(t=q,m=0;m<l;m++,t+=f)a.pixels.resultPixels[t]=b[c++]}else for(q=0;q<f;q++){if(g[q])for(t=q*l,m=0;m<l;m++)a.pixels.resultPixels[t+m]=b[c++]}else for(q=0;q<f;q++)g[q]&&(a.pixels.resultPixels[q]=b[c++])}a.ptr=d+k;return!0},readHuffmanTree:function(b,a){var c=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(b,a.ptr,16);a.ptr+=16;if(2>e.getInt32(0,!0))throw"unsupported Huffman version";
var d=e.getInt32(4,!0),k=e.getInt32(8,!0);e=e.getInt32(12,!0);if(k>=e)return!1;var l=new Uint32Array(e-k);p.decodeBits(b,a,l);var f=[],g;for(g=k;g<e;g++){var q=g-(g<d?0:d);f[q]={first:l[g-k],second:null}}g=b.byteLength-a.ptr;l=new ArrayBuffer(4*Math.ceil(g/4));(new Uint8Array(l)).set(new Uint8Array(b,a.ptr,g));b=new Uint32Array(l);a=0;l=0;var m=b[0];for(g=k;g<e;g++){q=g-(g<d?0:d);var t=f[q].first;0<t&&(f[q].second=m<<a>>>32-t,32-a>=t?(a+=t,32===a&&(a=0,l++,m=b[l])):(a+=t-32,l++,m=b[l],f[q].second|=
m>>>32-a))}var u=m=0,r=new v;for(g=0;g<f.length;g++)void 0!==f[g]&&(m=Math.max(m,f[g].first));u=m>=c?c:m;c=[];var w;for(g=k;g<e;g++)if(q=g-(g<d?0:d),t=f[q].first,0<t)if(k=[t,q],t<=u){q=f[q].second<<u-t;var y=1<<u-t;for(t=0;t<y;t++)c[q|t]=k}else for(q=f[q].second,y=r,--t;0<=t;t--)(w=q>>>t&1)?(y.right||(y.right=new v),y=y.right):(y.left||(y.left=new v),y=y.left),0!==t||y.val||(y.val=k[1]);return{decodeLut:c,numBitsLUTQick:u,numBitsLUT:m,tree:r,stuffedData:b,srcPtr:l,bitPos:a}},readHuffman:function(b,
a,c,e){var d=a.headerInfo.numDims,k=a.headerInfo.height,l=a.headerInfo.width,f=l*k,g=this.readHuffmanTree(b,a);b=g.decodeLut;var q=g.tree,m=g.stuffedData,t=g.srcPtr,u=g.bitPos,r=g.numBitsLUTQick;g=g.numBitsLUT;var w=0===a.headerInfo.imageType?128:0,y=a.pixels.resultMask,A,F,C,z,E,D,x=0;0<u&&(t++,u=0);var J=m[t],I=1===a.encodeMode,M=new c(f*d),K=M,L;if(2>d||I)for(L=0;L<d;L++)if(1<d&&(K=new c(M.buffer,f*L,f),x=0),a.headerInfo.numValidPixel===l*k)for(C=E=0;C<k;C++)for(z=0;z<l;z++,E++){var G=0;var B=
A=J<<u>>>32-r;32-u<r&&(B=A|=m[t+1]>>>64-u-r);if(b[B])G=b[B][1],u+=b[B][0];else for(B=A=J<<u>>>32-g,32-u<g&&(B=A|=m[t+1]>>>64-u-g),B=q,D=0;D<g;D++)if(B=(F=A>>>g-D-1&1)?B.right:B.left,!B.left&&!B.right){G=B.val;u=u+D+1;break}32<=u&&(u-=32,t++,J=m[t]);G-=w;I?(G=0<z?G+x:0<C?G+K[E-l]:G+x,G&=255,x=K[E]=G):K[E]=G}else for(C=E=0;C<k;C++)for(z=0;z<l;z++,E++){if(y[E]){G=0;B=A=J<<u>>>32-r;32-u<r&&(B=A|=m[t+1]>>>64-u-r);if(b[B])G=b[B][1],u+=b[B][0];else for(B=A=J<<u>>>32-g,32-u<g&&(B=A|=m[t+1]>>>64-u-g),B=q,
D=0;D<g;D++)if(B=(F=A>>>g-D-1&1)?B.right:B.left,!B.left&&!B.right){G=B.val;u=u+D+1;break}32<=u&&(u-=32,t++,J=m[t]);G-=w;I?(G=0<z&&y[E-1]?G+x:0<C&&y[E-l]?G+K[E-l]:G+x,G&=255,x=K[E]=G):K[E]=G}}else for(C=E=0;C<k;C++)for(z=0;z<l;z++)if(E=C*l+z,!y||y[E])for(L=0;L<d;L++,E+=f){G=0;B=A=J<<u>>>32-r;32-u<r&&(B=A|=m[t+1]>>>64-u-r);if(b[B])G=b[B][1],u+=b[B][0];else for(B=A=J<<u>>>32-g,32-u<g&&(B=A|=m[t+1]>>>64-u-g),B=q,D=0;D<g;D++)if(B=(F=A>>>g-D-1&1)?B.right:B.left,!B.left&&!B.right){G=B.val;u=u+D+1;break}32<=
u&&(u-=32,t++,J=m[t]);G-=w;K[E]=G}a.ptr=a.ptr+4*(t+1)+(0<u?4:0);a.pixels.resultPixels=M;1<d&&!e&&(a.pixels.resultPixels=p.swapDimensionOrder(M,f,d,c))},decodeBits:function(b,a,c,e,d){var k=a.headerInfo,l=k.fileVersion,f=0,g=new DataView(b,a.ptr,5<=b.byteLength-a.ptr?5:b.byteLength-a.ptr),q=g.getUint8(0);f++;var m=q>>6,t=0===m?4:3-m,u=0<(q&32)?!0:!1;m=q&31;q=0;if(1===t)q=g.getUint8(f),f++;else if(2===t)q=g.getUint16(f,!0),f+=2;else if(4===t)q=g.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";
t=2*k.maxZError;d=1<k.numDims?k.maxValues[d]:k.zMax;if(u){a.counter.lut++;u=g.getUint8(f);f++;k=Math.ceil((u-1)*m/8);var r=Math.ceil(k/4);r=new ArrayBuffer(4*r);var w=new Uint8Array(r);a.ptr+=f;w.set(new Uint8Array(b,a.ptr,k));f=new Uint32Array(r);a.ptr+=k;for(g=0;u-1>>>g;)g++;k=Math.ceil(q*g/8);r=Math.ceil(k/4);r=new ArrayBuffer(4*r);w=new Uint8Array(r);w.set(new Uint8Array(b,a.ptr,k));b=new Uint32Array(r);a.ptr+=k;a=3<=l?n.unstuffLUT2(f,m,u-1,e,t,d):n.unstuffLUT(f,m,u-1,e,t,d);3<=l?n.unstuff2(b,
c,g,q,a):n.unstuff(b,c,g,q,a)}else a.counter.bitstuffer++,g=m,a.ptr+=f,0<g&&(k=Math.ceil(q*g/8),r=Math.ceil(k/4),r=new ArrayBuffer(4*r),w=new Uint8Array(r),w.set(new Uint8Array(b,a.ptr,k)),b=new Uint32Array(r),a.ptr+=k,3<=l?null==e?n.originalUnstuff2(b,c,g,q):n.unstuff2(b,c,g,q,!1,e,t,d):null==e?n.originalUnstuff(b,c,g,q):n.unstuff(b,c,g,q,!1,e,t,d))},readTiles:function(b,a,c,e){var d=a.headerInfo,k=d.width,l=d.height,f=k*l,g=d.microBlockSize,q=d.imageType,m=p.getDataTypeSize(q),t=Math.ceil(k/g),
u=Math.ceil(l/g);a.pixels.numBlocksY=u;a.pixels.numBlocksX=t;var r=a.pixels.ptr=0,w=0,y=0,A=0,F=0,C=0,z=0,E=0,D=r=0,x=0,J=0,I=z=0;z=z=0;var M=new c(g*g);l=l%g||g;var K=k%g||g,L=d.numDims,G,B=a.pixels.resultMask,N=a.pixels.resultPixels,qa=5<=d.fileVersion?14:15,ca=d.zMax;for(y=0;y<u;y++)for(F=y!==u-1?g:l,A=0;A<t;A++)for(C=A!==t-1?g:K,x=y*k*g+A*g,J=k-C,G=0;G<L;G++){1<L?(I=N,x=y*k*g+A*g,N=new c(a.pixels.resultPixels.buffer,f*G*m,f),ca=d.maxValues[G]):I=null;z=b.byteLength-a.ptr;w=new DataView(b,a.ptr,
Math.min(10,z));var R={};z=0;E=w.getUint8(0);z++;var P=5<=d.fileVersion?E&4:0;r=E>>6&255;D=E>>2&qa;if(D!==(A*g>>3&qa))throw"integrity issue";if(P&&0===G)throw"integrity issue";E&=3;if(3<E)throw a.ptr+=z,"Invalid block encoding ("+E+")";if(2===E){if(P)if(B)for(r=0;r<F;r++)for(w=0;w<C;w++)B[x]&&(N[x]=I[x]),x++;else for(r=0;r<F;r++)for(w=0;w<C;w++)N[x]=I[x],x++;a.counter.constant++;a.ptr+=z}else if(0===E){if(P)throw"integrity issue";a.counter.uncompressed++;a.ptr+=z;z=F*C*m;I=b.byteLength-a.ptr;z=z<
I?z:I;I=new ArrayBuffer(0===z%m?z:z+m-z%m);P=new Uint8Array(I);P.set(new Uint8Array(b,a.ptr,z));I=new c(I);z=0;if(B)for(r=0;r<F;r++){for(w=0;w<C;w++)B[x]&&(N[x]=I[z++]),x++;x+=J}else for(r=0;r<F;r++){for(w=0;w<C;w++)N[x++]=I[z++];x+=J}a.ptr+=z*m}else if(r=p.getDataTypeUsed(P&&6>q?4:q,r),R=p.getOnePixel(R,z,r,w),z+=p.getDataTypeSize(r),3===E)if(a.ptr+=z,a.counter.constantoffset++,B)for(r=0;r<F;r++){for(w=0;w<C;w++)B[x]&&(N[x]=P?Math.min(ca,I[x]+R):R),x++;x+=J}else for(r=0;r<F;r++){for(w=0;w<C;w++)N[x]=
P?Math.min(ca,I[x]+R):R,x++;x+=J}else if(a.ptr+=z,p.decodeBits(b,a,M,R,G),z=0,P)if(B)for(r=0;r<F;r++){for(w=0;w<C;w++)B[x]&&(N[x]=M[z++]+I[x]),x++;x+=J}else for(r=0;r<F;r++){for(w=0;w<C;w++)N[x]=M[z++]+I[x],x++;x+=J}else if(B)for(r=0;r<F;r++){for(w=0;w<C;w++)B[x]&&(N[x]=M[z++]),x++;x+=J}else for(r=0;r<F;r++){for(w=0;w<C;w++)N[x++]=M[z++];x+=J}}1<L&&!e&&(a.pixels.resultPixels=p.swapDimensionOrder(a.pixels.resultPixels,f,L,c))},formatFileInfo:function(b){return{fileIdentifierString:b.headerInfo.fileIdentifierString,
fileVersion:b.headerInfo.fileVersion,imageType:b.headerInfo.imageType,height:b.headerInfo.height,width:b.headerInfo.width,numValidPixel:b.headerInfo.numValidPixel,microBlockSize:b.headerInfo.microBlockSize,blobSize:b.headerInfo.blobSize,maxZError:b.headerInfo.maxZError,pixelType:p.getPixelType(b.headerInfo.imageType),eofOffset:b.eofOffset,mask:b.mask?{numBytes:b.mask.numBytes}:null,pixels:{numBlocksX:b.pixels.numBlocksX,numBlocksY:b.pixels.numBlocksY,maxValue:b.headerInfo.zMax,minValue:b.headerInfo.zMin,
noDataValue:b.noDataValue}}},constructConstantSurface:function(b,a){var c=b.headerInfo.zMax,e=b.headerInfo.zMin,d=b.headerInfo.maxValues,k=b.headerInfo.numDims,l=b.headerInfo.height*b.headerInfo.width,f=0,g=0,q=0,m=b.pixels.resultMask;b=b.pixels.resultPixels;if(m)if(1<k)if(a)for(f=0;f<k;f++)for(q=f*l,c=d[f],g=0;g<l;g++)m[g]&&(b[q+g]=c);else for(g=0;g<l;g++){if(m[g])for(q=g*k,f=0;f<k;f++)b[q+k]=d[f]}else for(g=0;g<l;g++)m[g]&&(b[g]=c);else if(1<k&&e!==c)if(a)for(f=0;f<k;f++)for(q=f*l,c=d[f],g=0;g<
l;g++)b[q+g]=c;else for(g=0;g<l;g++)for(q=g*k,f=0;f<k;f++)b[q+f]=d[f];else for(g=0;g<l*k;g++)b[g]=c},getDataTypeArray:function(b){switch(b){case 0:b=Int8Array;break;case 1:b=Uint8Array;break;case 2:b=Int16Array;break;case 3:b=Uint16Array;break;case 4:b=Int32Array;break;case 5:b=Uint32Array;break;case 6:b=Float32Array;break;case 7:b=Float64Array;break;default:b=Float32Array}return b},getPixelType:function(b){switch(b){case 0:b="S8";break;case 1:b="U8";break;case 2:b="S16";break;case 3:b="U16";break;
case 4:b="S32";break;case 5:b="U32";break;case 6:b="F32";break;case 7:b="F64";break;default:b="F32"}return b},isValidPixelValue:function(b,a){if(null==a)return!1;switch(b){case 0:b=-128<=a&&127>=a;break;case 1:b=0<=a&&255>=a;break;case 2:b=-32768<=a&&32767>=a;break;case 3:b=0<=a&&65536>=a;break;case 4:b=-2147483648<=a&&2147483647>=a;break;case 5:b=0<=a&&4294967296>=a;break;case 6:b=-3.4027999387901484E38<=a&&3.4027999387901484E38>=a;break;case 7:b=4.9E-324<=a&&1.7976931348623157E308>=a;break;default:b=
!1}return b},getDataTypeSize:function(b){var a=0;switch(b){case 0:case 1:a=1;break;case 2:case 3:a=2;break;case 4:case 5:case 6:a=4;break;case 7:a=8;break;default:a=b}return a},getDataTypeUsed:function(b,a){var c=b;switch(b){case 2:case 4:c=b-a;break;case 3:case 5:c=b-2*a;break;case 6:c=0===a?b:1===a?2:1;break;case 7:c=0===a?b:b-2*a+1;break;default:c=b}return c},getOnePixel:function(b,a,c,e){b=0;switch(c){case 0:b=e.getInt8(a);break;case 1:b=e.getUint8(a);break;case 2:b=e.getInt16(a,!0);break;case 3:b=
e.getUint16(a,!0);break;case 4:b=e.getInt32(a,!0);break;case 5:b=e.getUInt32(a,!0);break;case 6:b=e.getFloat32(a,!0);break;case 7:b=e.getFloat64(a,!0);break;default:throw"the decoder does not understand this pixel type";}return b},swapDimensionOrder:function(b,a,c,e,d){var k=0,l=0,f=0,g=0,q=b;if(1<c)if(q=new e(a*c),d)for(k=0;k<a;k++)for(g=k,f=0;f<c;f++,g+=a)q[g]=b[l++];else for(k=0;k<a;k++)for(g=k,f=0;f<c;f++,g+=a)q[l++]=b[g];return q}},v=function(b,a,c){this.val=b;this.left=a;this.right=c};return{decode:function(b,
a){a=a||{};var c=a.noDataValue,e=0,d={};d.ptr=a.inputOffset||0;d.pixels={};if(p.readHeaderInfo(b,d)){e=d.headerInfo;var k=e.fileVersion,l=p.getDataTypeArray(e.imageType);if(5<k)throw"unsupported lerc version 2."+k;p.readMask(b,d);e.numValidPixel===e.width*e.height||d.pixels.resultMask||(d.pixels.resultMask=a.maskData);var f=e.width*e.height;d.pixels.resultPixels=new l(f*e.numDims);d.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var g=!a.returnPixelInterleavedDims;
if(0!==e.numValidPixel)if(e.zMax===e.zMin)p.constructConstantSurface(d,g);else if(4<=k&&p.checkMinMaxRanges(b,d))p.constructConstantSurface(d,g);else{var q=new DataView(b,d.ptr,2),m=q.getUint8(0);d.ptr++;if(m)p.readDataOneSweep(b,d,l,g);else if(1<k&&1>=e.imageType&&1E-5>Math.abs(e.maxZError-.5)){q=q.getUint8(1);d.ptr++;d.encodeMode=q;if(2<q||4>k&&1<q)throw"Invalid Huffman flag "+q;q?p.readHuffman(b,d,l,g):p.readTiles(b,d,l,g)}else p.readTiles(b,d,l,g)}d.eofOffset=d.ptr;a.inputOffset?(b=d.headerInfo.blobSize+
a.inputOffset-d.ptr,1<=Math.abs(b)&&(d.eofOffset=a.inputOffset+d.headerInfo.blobSize)):(b=d.headerInfo.blobSize-d.ptr,1<=Math.abs(b)&&(d.eofOffset=d.headerInfo.blobSize));b={width:e.width,height:e.height,pixelData:d.pixels.resultPixels,minValue:e.zMin,maxValue:e.zMax,validPixelCount:e.numValidPixel,dimCount:e.numDims,dimStats:{minValues:e.minValues,maxValues:e.maxValues},maskData:d.pixels.resultMask};if(d.pixels.resultMask&&p.isValidPixelValue(e.imageType,c)){k=d.pixels.resultMask;for(e=0;e<f;e++)k[e]||
(b.pixelData[e]=c);b.noDataValue=c}d.noDataValue=c;a.returnFileInfo&&(b.fileInfo=p.formatFileInfo(d));return b}},getBandCount:function(b){for(var a=0,c=0,e={ptr:0,pixels:{}};c<b.byteLength-58;)p.readHeaderInfo(b,e),c+=e.headerInfo.blobSize,a++,e.ptr=c;return a}}})})(pa);var ra=pa.exports;const ka=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],ua=new Set([1,5,6,7,8,34712,34887]),da=function(h,n,p,v,b){var a,c,e=fa.isPlatformLittleEndian===n,d=H(p,"BITSPERSAMPLE");const k=null!=(a=H(p,"SAMPLEFORMAT"))?
a:1;a=ha(k,d);d=null!=(c=H(p,"COMPRESSION"))?c:1;c=T(a);if(34887===d)return ra.decode(h,{inputOffset:v,returnFileInfo:!0}).pixelData;if(1===d){var l=h.slice(v,v+b);var f=new Uint8Array(l)}else if(8===d||32946===d)f=new Uint8Array(h,v,b),f=new Y.Zlib(f),h=f.getBytes(),l=new ArrayBuffer(h.length),f=new Uint8Array(l),f.set(h);else if(6===d)f=new Uint8Array(h,v,b),l=new X.JpegImage,l.parse(f),h=l.getData(l.width,l.height,!0),l=new ArrayBuffer(h.length),f=new Uint8Array(l),f.set(h);else if(7===d){n=p.get("JPEGTABLES").values;
l=n.length-2;f=new Uint8Array(l+b-2);for(p=0;p<l;p++)f[p]=n[p];h=new Uint8Array(h,v+2,b-2);for(v=0;v<h.length;v++)f[l+v]=h[v];l=new X.JpegImage;l.parse(f);h=l.getData(l.width,l.height,!0);l=new ArrayBuffer(h.length);f=new Uint8Array(l);f.set(h)}else 5===d&&(f=ea.decode(h,v,b,n),l=f.buffer);if("u8"!==a&&"s8"!==a&&!e)switch(l=new ArrayBuffer(f.length),e=new Uint8Array(l),a){case "u16":case "s16":for(a=0;a<f.length;a+=2)e[a]=f[a+1],e[a+1]=f[a];break;case "u32":case "s32":case "f32":for(a=0;a<f.length;a+=
4)e[a]=f[a+3],e[a+1]=f[a+2],e[a+2]=f[a+1],e[a+3]=f[a]}return new c(l)},wa=function(h,n,p){if(!(h&&0<h.length&&n&&p))return null;let v,b,a;const c=h[0].length,e=h.length,d=new Uint8Array(c);for(let l=0;l<e;l++)if(v=h[l],b=n[l],a=p[l],0===l)for(var k=0;k<c;k++)d[k]=v[k]<b||v[k]>a?0:1;else for(k=0;k<c;k++)d[k]&&(d[k]=v[k]<b||v[k]>a?0:1);return d},va=function(h){if(!h)return null;var n=h.match(/<Item(.*?)Item>/gi);if(!n||0===n.length)return null;h=new Map;var p;for(var v=0;v<n.length;v++){var b=n[v];
var a=b.slice(6,b.indexOf("\x3e"));var c=b.indexOf("sample\x3d");-1<c&&(p=b.slice(c+8,b.indexOf('"',c+8)));c=b.indexOf("name\x3d");-1<c&&(a=b.slice(c+6,b.indexOf('"',c+6)));a&&(b=b.slice(b.indexOf("\x3e")+1,b.indexOf("\x3c/Item\x3e")).trim(),null!=p?h.has(a)?h.get(a)[p]=b:h.set(a,[b]):h.set(a,b));p=null}n=h.get("STATISTICS_MINIMUM");a=h.get("STATISTICS_MAXIMUM");v=h.get("STATISTICS_MEAN");b=h.get("STATISTICS_STDDEV");p=null;if(n&&a)for(p=[],c=0;c<n.length;c++)p.push({min:parseFloat(n[c]),max:parseFloat(a[c]),
avg:v&&parseFloat(v[c]),stddev:b&&parseFloat(b[c])});a=h.get("BandName");v=h.get("WavelengthMin");b=h.get("WavelengthMax");n=null;if(a)for(n=[],c=0;c<a.length;c++)n.push({BandName:a[c],WavelengthMin:v&&parseFloat(v[c]),WavelengthMax:b&&parseFloat(b[c])});a=h.get("DataType");return{statistics:p,bandProperties:n,dataType:a,rawMetadata:h}};O.Lerc2Codec=ra;O.decode=function(h,n=0,p){p=p||ma(h);const {ifds:v,noData:b}=p;if(0===v.length)throw"no valid image file directory";var a=la(p);if(a)throw a;a=-1===
n?v[v.length-1]:v[n];n=b?b[0]:null;if(p.tileWidth){var c=p,e,d=Q(a,"TILEOFFSETS");if(void 0===d)a=null;else{p=Q(a,"TILEBYTECOUNTS");var {width:k,height:l,pixelType:f,tileWidth:g,tileHeight:q}=V([a]),m=W(a,c),t=c.planes,u=k*l,r=H(a,"BITSPERSAMPLE"),w=34887===(null!=(e=H(a,"COMPRESSION"))?e:1),y=T(f);e=[];for(var A=0;A<t;A++)e.push(new y(u));var F,C;u=Math.ceil(k/g);if(0===r%8)if(w&&m&&1<t)for(m=Math.round(d.length/t),r=0;r<m;r++){var z=Math.floor(r/u)*q;var E=r%u*g;y=z*k+E;for(w=0;w<t;w++){A=r*t+w;
A=da(h,c.littleEndian,a,d[A],p[A]);var D=0;var x=y;var J=Math.min(g,k-E);var I=Math.min(q,l-z);var M=e[w];for(F=0;F<I;F++)for(x=y+F*k,D=F*g,C=0;C<J;C++,x++,D++)M[x]=A[D]}}else for(r=0;r<d.length;r++)for(z=Math.floor(r/u)*q,E=r%u*g,y=z*k+E,A=da(h,c.littleEndian,a,d[r],p[r]),D=0,x=y,J=Math.min(g,k-E),I=Math.min(q,l-z),z=0;z<t;z++)if(M=e[z],m||w)for(F=0;F<I;F++)for(x=y+F*k,D=g*q*z+F*g,C=0;C<J;C++,x++,D++)M[x]=A[D];else for(F=0;F<I;F++)for(x=y+F*k,D=F*g*t+z,C=0;C<J;C++,x++,D+=t)M[x]=A[D];a={width:k,height:l,
pixelType:f,pixels:e}}}else if(u=p,F=fa.isPlatformLittleEndian===u.littleEndian,C=Q(a,"STRIPOFFSETS"),void 0===C)a=null;else{var {width:K,height:L,pixelType:G}=V([a]);p=u.planes;t=K*L;r=H(a,"BITSPERSAMPLE");d=T(G);e=new d(t*p);y=Q(a,"STRIPBYTECOUNTS");A=H(a,"ROWSPERSTRIP");z=null!=(E=H(a,"COMPRESSION"))?E:1;x=A;if(0===r%8)for(a=0;a<C.length;a++){E=a*A*K*p;x=(a+1)*A>L?L-a*A:A;if("u8"===G||"s8"===G||F)8===z||32946===z?(m=new Uint8Array(h,C[a],y[a]),m=new Y.Zlib(m),D=m.getBytes(),w=new ArrayBuffer(D.length),
m=new Uint8Array(w),m.set(D),m.length!==x*K*p*r/8&&console.log("strip byte counts is different than expected")):6===z?(m=new Uint8Array(h,C[a],y[a]),w=new X.JpegImage,w.parse(m),x=w.getData(w.width,w.height,!0),w=new ArrayBuffer(x.length),m=new Uint8Array(w),m.set(x)):5===z?(m=ea.decode(h,C[a],y[a],u.littleEndian),w=m.buffer):1===z&&(y[a]!==x*K*p*r/8&&console.log("strip byte counts is different than expected"),w=h.slice(C[a],C[a]+y[a]));else switch(6===z||8===z||32946===z?(m=new Uint8Array(h,C[a],
y[a]),m=new Y.Zlib(m),m=m.getBytes(),w=new ArrayBuffer(m.length),c=new Uint8Array(w),m.length!==x*K*p*r/8&&console.log("strip byte counts is different than expected")):1===z&&(y[a]!==x*K*p*r/8&&console.log("strip byte counts is different than expected"),w=new ArrayBuffer(y[a]),m=new Uint8Array(h,C[a],y[a]),c=new Uint8Array(w)),G){case "u16":case "s16":for(x=0;x<m.length;x+=2)c[x]=m[x+1],c[x+1]=m[x];break;case "u32":case "s32":case "f32":for(x=0;x<m.length;x+=4)c[x]=m[x+3],c[x+1]=m[x+2],c[x+2]=m[x+
1],c[x+3]=m[x]}x=new d(w);e.set(x,E)}m=[];if(1===p)m.push(e);else for(a=0;a<p;a++){c=new d(t);for(h=0;h<t;h++)c[h]=e[h*p+a];m.push(c)}a={width:K,height:L,pixelType:G,pixels:m}}if(null!==n){a.mask=new Uint8Array(a.width*a.height);if(1E24<Math.abs(n))for(h=0;h<a.width*a.height;h++)a.mask[h]=1E-6>Math.abs((a.pixels[0][h]-n)/n)?0:1;else for(h=0;h<a.width*a.height;h++)a.mask[h]=a.pixels[0][h]===n?0:1;a.noDataValue=n}return a};O.decodeTileOrStrip=function(h,n){var p;const {headerInfo:v,ifd:b,offsets:a,
sizes:c}=n;var e=a.map((A,F)=>da(h,v.littleEndian,b,A,c[F]||h.byteLength)),d=W(b,v);const {pixelType:k,planes:l}=v;var f=T(k);const g=H(b,"TILEWIDTH"),q=H(b,"TILELENGTH");var m=null!=(p=H(b,"COMPRESSION"))?p:1;p=g*q;const t=[];let u=e[0];const r=34887===m;for(let A=0;A<l;A++){m=new f(p);if(d&&r){u=e[A];for(var w=0;w<p;w++)m[w]=u[A][w+A]}else if(d||r&&!d)m=u.slice(p*A,p*(A+1));else for(w=0;w<p;w++)m[w]=u[w*l+A];t.push(m)}e=v.noData?v.noData[0]:null;d=(f=v.metadata?v.metadata.statistics:null)?f.map(A=>
A.min):null;f=f?f.map(A=>A.max):null;let y;if(null!=e)if(y=new Uint8Array(p),1E24<Math.abs(e))for(n=0;n<p;n++)y[n]=1E-6>Math.abs((t[0][n]-e)/e)?0:1;else for(n=0;n<p;n++)y[n]=t[0][n]===e?0:1;else d&&f&&n.applyMinMaxConstraint&&(y=wa(t,d,f));return{pixelType:k,width:g,height:q,pixels:t,mask:y,noDataValue:e}};O.getImageInfo=V;O.isBSQConfig=W;O.parseFieldValues=ja;O.parseHeader=ma;O.parseIFD=oa;O.parseSignature=na});