// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../colorUtils ../../../core/Error ../../../core/lang ../../../core/Logger ./effects ./parser".split(" "),function(h,z,A,u,m,B,k,v){function w(b){if(!b)return[];if("string"===typeof b){var c=v.parse(b);return c.error?c.error:[{scale:-1,effects:c.effects}]}c=[];for(var a of b){if(!isFinite(a.scale)||0>=a.scale)return new u("effect:invalid-scale","scale must be finite and greater than 0",{stop:a});b=v.parse(a.value);if(b.error)return b.error;
c.push({scale:a.scale,effects:b.effects})}c.sort((d,e)=>e.effects.length-d.effects.length);for(a=0;a<c.length-1;a++){if(!q(c[a].effects,c[a+1].effects))return new u("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:c[a].effects,b:c[a+1].effects});r(c[a].effects,c[a+1].effects)}c.sort((d,e)=>e.scale-d.scale);return c}function C(b){switch(b.type){case "grayscale":case "sepia":case "invert":return new k.ColorMatrixEffect(b.type,0);case "saturate":case "brightness":case "contrast":return new k.ColorMatrixEffect(b.type,
1);case "opacity":return new k.OpacityEffect(1);case "hue-rotate":return new k.HueRotateEffect(0);case "blur":return new k.BlurEffect(0);case "drop-shadow":return new k.DropShadowEffect(0,0,0,[...A.getNamedColor("transparent")]);case "bloom":return new k.BloomEffect(0,0,0)}}function q(b,c){const a=b.length>c.length?b:c;return(b.length>c.length?c:b).every((d,e)=>d.type===a[e].type)}function r(b,c){const a=b.length>c.length?b:c;b=b.length>c.length?c:b;for(c=b.length;c<a.length;c++)b.push(C(a[c]))}function x(b,
c,a){var d,e,f,g;return null!=(d=b[0])&&d.effects&&null!=(e=c[0])&&e.effects?(-1===(null==(f=b[0])?void 0:f.scale)||-1===(null==(g=c[0])?void 0:g.scale))&&(1<b.length||1<c.length)&&0>=a?!1:q(b[0].effects,c[0].effects):!0}function y(b,c,a){var d,e;const f=b.length>c.length?b:c;b=b.length>c.length?c:b;const g=b[b.length-1];c=null!=(d=null==g?void 0:g.scale)?d:a;d=null!=(e=null==g?void 0:g.effects)?e:[];for(e=b.length;e<f.length;e++)b.push({scale:c,effects:[...d]});for(e=0;e<f.length;e++)b[e].scale=
-1===b[e].scale?a:b[e].scale,f[e].scale=-1===f[e].scale?a:f[e].scale,r(b[e].effects,f[e].effects)}let D=function(){function b(a=200){this.duration=a;this._final=this._to=this._from=null;this._current=[];this._time=0;this._effect="";this._effects=[];this._scale=0}var c=b.prototype;c.transitionStep=function(a,d){this._applyTimeTransition(a);this._updateForScale(d)};c._transitionTo=function(a){0<this.scale&&x(this._current,a,this.scale)?(this._final=a,this._to=m.clone(a),y(this._current,this._to,this.scale),
this._from=m.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=a);this._effects=this._current[0]?m.clone(this._current[0].effects):[]};c._applyTimeTransition=function(a){if(this._to){this._time+=a;a=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const f=this._current[e],g=this._from[e],l=this._to[e];var d=g.scale;f.scale=d+(l.scale-d)*a;for(d=0;d<f.effects.length;d++)f.effects[d].interpolate(g.effects[d],l.effects[d],a)}1===a&&(this._current=
this._final,this._effects=this._current[0]?m.clone(this._current[0].effects):[],this._from=this._to=this._final=null)}};c._updateForScale=function(a){if(0!==this._current.length){this._scale=a;var d=this._current,e=this._current.length-1,f,g=1;if(1===d.length||a>=d[0].scale)var l=f=d[0].effects;else if(a<=d[e].scale)l=f=d[e].effects;else for(let n=0;n<e;n++){const p=d[n],t=d[n+1];if(p.scale>=a&&t.scale<=a){g=(a-p.scale)/(t.scale-p.scale);f=p.effects;l=t.effects;break}}for(a=0;a<this._effects.length;a++)this._effects[a].interpolate(f[a],
l[a],g)}};z._createClass(b,[{key:"effect",get:function(){return this._effect},set:function(a){a=a||"";if(this._effect!==a){this._effect=a;var d=w(a);Array.isArray(d)?this._transitionTo(d):(this._transitionTo([]),B.getLogger("esri.views.layers.effects.EffectList").warn("Invalid Effect",{effect:a,error:d}))}}},{key:"hasEffects",get:function(){return this.transitioning||!!this._effects.length}},{key:"effects",get:function(){return this._effects}},{key:"scale",get:function(){return this._scale}},{key:"transitioning",
get:function(){return null!==this._to}}]);return b}();h.canInterpolateEffectStops=x;h.canInterpolateEffects=q;h.convertEffectToStops=w;h.default=D;h.normalizeEffectStops=y;h.normalizeEffects=r;Object.defineProperty(h,"__esModule",{value:!0})});