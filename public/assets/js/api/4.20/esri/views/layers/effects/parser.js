// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../colorUtils","../../../core/Error","./effects","../../../chunks/_commonjsHelpers"],function(W,R,z,K,ya){function za(g){try{switch(g.name){case "grayscale":case "sepia":case "saturate":case "invert":case "brightness":case "contrast":var q,e=1;L(g.parameters,1);1===g.parameters.length&&(e=B(g.parameters[0]));return q=new K.ColorMatrixEffect(g.name,e);case "opacity":var n;e=1;L(g.parameters,1);1===g.parameters.length&&(e=B(g.parameters[0]));return n=new K.OpacityEffect(e);
case "hue-rotate":var r;e=0;L(g.parameters,1);if(1===g.parameters.length){var v=g.parameters[0];if("quantity"!==v.type||(0!==v.value||null!==v.unit)&&null==S[v.unit])throw new z("effect:type-error",`Expected <angle>, Actual: ${P(v)}`,{term:v});e=v.value*S[v.unit]||0}return r=new K.HueRotateEffect(e);case "blur":var x;e=0;L(g.parameters,1);1===g.parameters.length&&(e=T(g.parameters[0]),M(e,g.parameters[0]));return x=new K.BlurEffect(e);case "drop-shadow":n=[];for(const t of g.parameters)if("color"===
t.type){n.length&&Object.freeze(n);if(m)throw new z("effect:type-error","Accepts only one color",{});a:{var E=void 0;q=t;switch(q.colorType){case "hex":var m=R.hex2rgba(q.value);break a;case "named":m=X(q.value);break a;case "function":var f=q.value;L(f.parameters,4);if(Aa.test(f.name))E=[B(f.parameters[0]),B(f.parameters[1]),B(f.parameters[2]),f.parameters[3]?B(f.parameters[3]):1];else if(Ba.test(f.name))E=R.hsla2rgba(Ca(f.parameters[0]),B(f.parameters[1]),B(f.parameters[2]),f.parameters[3]?B(f.parameters[3]):
1);else throw new z("effect:syntax-error",`Invalid color function '${f.name}'`,{colorFunction:f});m=E;break a}m=void 0}}else{const F=T(t);if(Object.isFrozen(n))throw new z("effect:type-error","\x3clength\x3e parameters not consecutive",{lengths:n});n.push(F);3===n.length&&M(F,t)}if(2>n.length||3<n.length)throw new z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${n.length}}`,{lengths:n});return e=new K.DropShadowEffect(n[0],n[1],n[2]||0,m||X("black"));case "bloom":return e=1,m=f=0,
L(g.parameters,3),g.parameters[0]&&(e=B(g.parameters[0])),g.parameters[1]&&(f=T(g.parameters[1]),M(f,g.parameters[1])),g.parameters[2]&&(m=B(g.parameters[2])),E=new K.BloomEffect(e,f,m)}}catch(t){throw t.details.filter=g,t;}throw new z("effect:unknown-effect",`Effect '${g.name}' is not supported`,{effect:g});}function L(g,q){if(g.length>q)throw new z("effect:type-error",`Function supports up to ${q} parameters, Actual: ${g.length}`,{parameters:g});}function P(g){return"color"===g.type?"\x3ccolor\x3e":
U[g.unit]?"\x3clength\x3e":S[g.unit]?"\x3cangle\x3e":"%"===g.unit?"\x3cpercentage\x3e":"\x3cdouble\x3e"}function M(g,q){if(0>g)throw new z("effect:type-error",`Negative values are not allowed, Actual: ${g}`,{term:q});}function B(g){if("quantity"!==g.type||null!==g.unit&&"%"!==g.unit)throw new z("effect:type-error",`Expected <double> or <percentage>, Actual: ${P(g)}`,{term:g});const q=g.value;M(q,g);return"%"===g.unit?.01*q:q}function Ca(g){if("quantity"!==g.type||null!==g.unit)throw new z("effect:type-error",
`Expected <double>, Actual: ${P(g)}`,{term:g});M(g.value,g);return g.value}function T(g){if("quantity"!==g.type||(0!==g.value||null!==g.unit)&&null==U[g.unit])throw new z("effect:type-error",`Expected <length>, Actual: ${P(g)}`,{term:g});return g.value*U[g.unit]||0}function X(g){const q=R.getNamedColorCopy(g);if(!q)throw new z("effect:unknown-color",`color '${g}' isn't valid`,{namedColor:g});return q}var Y={exports:{}};(function(g){(function(q,e){g.exports&&(g.exports=e())})(ya.commonjsGlobal,function(){function q(e,
n,r,v){this.message=e;this.expected=n;this.found=r;this.location=v;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,q)}(function(e,n){function r(){this.constructor=e}r.prototype=n.prototype;e.prototype=new r})(q,Error);q.buildMessage=function(e,n){function r(m){return m.charCodeAt(0).toString(16).toUpperCase()}function v(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+r(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+r(f)})}function x(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(f){return"\\x0"+r(f)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(f){return"\\x"+r(f)})}var E={literal:function(m){return'"'+v(m.text)+'"'},"class":function(m){var f=
"",t;for(t=0;t<m.parts.length;t++)f+=m.parts[t]instanceof Array?x(m.parts[t][0])+"-"+x(m.parts[t][1]):x(m.parts[t]);return"["+(m.inverted?"^":"")+f+"]"},any:function(m){return"any character"},end:function(m){return"end of input"},other:function(m){return m.description}};return"Expected "+function(m){var f=Array(m.length),t;for(t=0;t<m.length;t++){var F=t;var G=m[t];G=E[G.type](G);f[F]=G}f.sort();if(0<f.length){for(m=t=1;t<f.length;t++)f[t-1]!==f[t]&&(f[m]=f[t],m++);f.length=m}switch(f.length){case 1:return f[0];
case 2:return f[0]+" or "+f[1];default:return f.slice(0,-1).join(", ")+", or "+f[f.length-1]}}(e)+" but "+(n?'"'+v(n)+'"':"end of input")+" found."};return{SyntaxError:q,parse:function(e,n){function r(h,a){return{type:"literal",text:h,ignoreCase:a}}function v(h,a,d){return{type:"class",parts:h,inverted:a,ignoreCase:d}}function x(h){return{type:"other",description:h}}function E(h){var a=Q[h],d;if(!a){for(d=h-1;!Q[d];)d--;a=Q[d];for(a={line:a.line,column:a.column};d<h;)10===e.charCodeAt(d)?(a.line++,
a.column=1):a.column++,d++;Q[h]=a}return a}function m(h,a){var d=E(h),k=E(a);return{start:{offset:h,line:d.line,column:d.column},end:{offset:a,line:k.line,column:k.column}}}function f(h){c<D||(c>D&&(D=c,V=[]),V.push(h))}function t(){l++;var h=c;var a=w();a!==b?(e.substr(c,4)===Z?(a=Z,c+=4):(a=b,0===l&&f(Da)),a!==b?(a=w(),a!==b?(u=h,h=a=[]):(c=h,h=b)):(c=h,h=b)):(c=h,h=b);l--;h===b&&(a=b,0===l&&f(Ea));if(h===b)if(h=[],a=F(),a!==b)for(;a!==b;)h.push(a),a=F();else h=b;return h}function F(){var h=c;var a=
w();if(a!==b){l++;a=c;var d=aa();if(d!==b){if(40===e.charCodeAt(c)){var k=Fa;c++}else k=b,0===l&&f(Ga);k!==b?(u=a,a=d):(c=a,a=b)}else c=a,a=b;l--;a===b&&(d=b,0===l&&f(Ha));if(a!==b)if(d=w(),d!==b){k=c;var y=G();if(y!==b){d=[];var p=c;var J=w();if(J!==b){if(44===e.charCodeAt(c)){var C=ba;c++}else C=b,0===l&&f(ca);C===b&&(C=null);if(C!==b){var N=w();if(N!==b){var O=G();O!==b?p=J=[J,C,N,O]:(c=p,p=b)}else c=p,p=b}else c=p,p=b}else c=p,p=b;for(;p!==b;)d.push(p),p=c,J=w(),J!==b?(44===e.charCodeAt(c)?(C=
ba,c++):(C=b,0===l&&f(ca)),C===b&&(C=null),C!==b?(N=w(),N!==b?(O=G(),O!==b?p=J=[J,C,N,O]:(c=p,p=b)):(c=p,p=b)):(c=p,p=b)):(c=p,p=b);d!==b?(u=k,k=y,k=y=0<d.length?[k].concat(Ia(d,3)):[k]):(c=k,k=b)}else c=k,k=b;d=k;d===b&&(d=null);d!==b?(k=w(),k!==b?(41===e.charCodeAt(c)?(k=Ja,c++):(k=b,0===l&&f(Ka)),k!==b?(k=w(),k!==b?(u=h,h=a={type:"function",name:a,parameters:d||[]}):(c=h,h=b)):(c=h,h=b)):(c=h,h=b)):(c=h,h=b)}else c=h,h=b;else c=h,h=b}else c=h,h=b;return h}function G(){var h=c;l++;var a=c;var d=
w();if(d!==b)if(d=A(),d!==b){if(37===e.charCodeAt(c)){var k=La;c++}else k=b,0===l&&f(Ma);k!==b?(u=a,a=d={value:d,unit:"%"}):(c=a,a=b)}else c=a,a=b;else c=a,a=b;l--;a===b&&(d=b,0===l&&f(Na));a===b&&(l++,a=c,d=w(),d!==b?(d=A(),d!==b?(e.substr(c,2)===da?(k=da,c+=2):(k=b,0===l&&f(Oa)),k!==b?(u=a,a=d={value:d,unit:"px"}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=w(),d!==b?(d=A(),d!==b?(e.substr(c,2)===ea?(k=ea,c+=2):(k=b,0===l&&f(Pa)),k!==b?(u=a,a=d={value:d,unit:"cm"}):(c=a,a=b)):(c=a,a=b)):(c=a,
a=b),a===b&&(a=c,d=w(),d!==b?(d=A(),d!==b?(e.substr(c,2)===fa?(k=fa,c+=2):(k=b,0===l&&f(Qa)),k!==b?(u=a,a=d={value:d,unit:"mm"}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=w(),d!==b?(d=A(),d!==b?(e.substr(c,2)===ha?(k=ha,c+=2):(k=b,0===l&&f(Ra)),k!==b?(u=a,a=d={value:d,unit:"in"}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=w(),d!==b?(d=A(),d!==b?(e.substr(c,2)===ia?(k=ia,c+=2):(k=b,0===l&&f(Sa)),k!==b?(u=a,a=d={value:d,unit:"pt"}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=w(),d!==b?(d=A(),
d!==b?(e.substr(c,2)===ja?(k=ja,c+=2):(k=b,0===l&&f(Ta)),k!==b?(u=a,a=d={value:d,unit:"pc"}):(c=a,a=b)):(c=a,a=b)):(c=a,a=b)))))),l--,a===b&&(d=b,0===l&&f(Ua)),a===b&&(l++,a=c,d=A(),d!==b?(e.substr(c,3)===ka?(k=ka,c+=3):(k=b,0===l&&f(Va)),k!==b?(u=a,a=d={value:d,unit:"deg"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=A(),d!==b?(e.substr(c,3)===la?(k=la,c+=3):(k=b,0===l&&f(Wa)),k!==b?(u=a,a=d={value:d,unit:"rad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=A(),d!==b?(e.substr(c,4)===ma?(k=ma,c+=4):(k=b,0===l&&f(Xa)),
k!==b?(u=a,a=d={value:d,unit:"grad"}):(c=a,a=b)):(c=a,a=b),a===b&&(a=c,d=A(),d!==b?(e.substr(c,4)===na?(k=na,c+=4):(k=b,0===l&&f(Ya)),k!==b?(u=a,a=d={value:d,unit:"turn"}):(c=a,a=b)):(c=a,a=b)))),l--,a===b&&(d=b,0===l&&f(Za)),a===b&&(l++,a=c,d=w(),d!==b?(d=A(),d!==b?(u=a,a=d={value:d,unit:null}):(c=a,a=b)):(c=a,a=b),l--,a===b&&(d=b,0===l&&f($a)))));a!==b&&(u=h,a={type:"quantity",value:a.value,unit:a.unit});h=a;if(h===b){h=c;l++;a=c;35===e.charCodeAt(c)?(d=ab,c++):(d=b,0===l&&f(bb));if(d!==b){d=[];
oa.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&f(pa));if(k!==b)for(;k!==b;)d.push(k),oa.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&f(pa));else d=b;d!==b?(u=a,a=d={type:"hex",value:e.substring(u,c)}):(c=a,a=b)}else c=a,a=b;a===b&&(a=c,d=F(),d!==b&&(u=a,d={type:"function",value:d}),a=d,a===b&&(a=c,d=aa(),d!==b&&(u=a,d={type:"named",value:e.substring(u,c)}),a=d));l--;a===b&&(d=b,0===l&&f(cb));a!==b&&(u=h,a={type:"color",colorType:a.type,value:a.value});h=a}return h}function w(){l++;var h=
[];if(qa.test(e.charAt(c))){var a=e.charAt(c);c++}else a=b,0===l&&f(ra);for(;a!==b;)h.push(a),qa.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&f(ra));l--;h===b&&(a=b,0===l&&f(db));return h}function aa(){l++;var h=c;var a=[];if(sa.test(e.charAt(c))){var d=e.charAt(c);c++}else d=b,0===l&&f(ta);if(d!==b)for(;d!==b;)a.push(d),sa.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&f(ta));else a=b;a!==b&&(u=h,a=e.substring(u,c));h=a;l--;h===b&&(a=b,0===l&&f(eb));return h}function A(){var h=c;if(ua.test(e.charAt(c))){var a=
e.charAt(c);c++}else a=b,0===l&&f(va);a===b&&(a=null);if(a!==b){var d=c;a=[];if(H.test(e.charAt(c))){var k=e.charAt(c);c++}else k=b,0===l&&f(I);for(;k!==b;)a.push(k),H.test(e.charAt(c))?(k=e.charAt(c),c++):(k=b,0===l&&f(I));if(a!==b)if(46===e.charCodeAt(c)?(k=fb,c++):(k=b,0===l&&f(gb)),k!==b){var y=[];if(H.test(e.charAt(c))){var p=e.charAt(c);c++}else p=b,0===l&&f(I);if(p!==b)for(;p!==b;)y.push(p),H.test(e.charAt(c))?(p=e.charAt(c),c++):(p=b,0===l&&f(I));else y=b;y!==b?d=a=[a,k,y]:(c=d,d=b)}else c=
d,d=b;else c=d,d=b;if(d===b)if(d=[],H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&f(I)),a!==b)for(;a!==b;)d.push(a),H.test(e.charAt(c))?(a=e.charAt(c),c++):(a=b,0===l&&f(I));else d=b;if(d!==b){a=c;101===e.charCodeAt(c)?(k=hb,c++):(k=b,0===l&&f(ib));if(k!==b)if(ua.test(e.charAt(c))?(y=e.charAt(c),c++):(y=b,0===l&&f(va)),y===b&&(y=null),y!==b){p=[];H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&f(I));if(d!==b)for(;d!==b;)p.push(d),H.test(e.charAt(c))?(d=e.charAt(c),c++):(d=b,0===l&&f(I));
else p=b;p!==b?a=k=[k,y,p]:(c=a,a=b)}else c=a,a=b;else c=a,a=b;a===b&&(a=null);a!==b?(u=h,h=a=parseFloat(e.substring(u,c))):(c=h,h=b)}else c=h,h=b}else c=h,h=b;return h}function Ia(h,a){return h.map(function(d){return d[a]})}n=void 0!==n?n:{};var b={},wa={start:t},xa=t,Ea=x("none"),Z="none",Da=r("none",!1),Ja=")",Ka=r(")",!1),ba=",",ca=r(",",!1),db=x("whitespace"),qa=/^[ \t\n\r]/,ra=v([" ","\t","\n","\r"],!1,!1),Ha=x("function"),Fa="(",Ga=r("(",!1),eb=x("identifier"),sa=/^[a-z\-]/,ta=v([["a","z"],
"-"],!1,!1),Na=x("percentage"),La="%",Ma=r("%",!1),Ua=x("length"),da="px",Oa=r("px",!1),ea="cm",Pa=r("cm",!1),fa="mm",Qa=r("mm",!1),ha="in",Ra=r("in",!1),ia="pt",Sa=r("pt",!1),ja="pc",Ta=r("pc",!1),Za=x("angle"),ka="deg",Va=r("deg",!1),la="rad",Wa=r("rad",!1),ma="grad",Xa=r("grad",!1),na="turn",Ya=r("turn",!1),$a=x("number"),cb=x("color"),ab="#",bb=r("#",!1),oa=/^[0-9a-fA-F]/,pa=v([["0","9"],["a","f"],["A","F"]],!1,!1),ua=/^[+\-]/,va=v(["+","-"],!1,!1),H=/^[0-9]/,I=v([["0","9"]],!1,!1),fb=".",gb=
r(".",!1),hb="e",ib=r("e",!1),c=0,u=0,Q=[{line:1,column:1}],D=0,V=[],l=0;if("startRule"in n){if(!(n.startRule in wa))throw Error("Can't start parsing from rule \""+n.startRule+'".');xa=wa[n.startRule]}n=xa();if(n!==b&&c===e.length)return n;n!==b&&c<e.length&&f({type:"end"});throw function(h,a,d){return new q(q.buildMessage(h,a),h,a,d)}(V,D<e.length?e.charAt(D):null,D<e.length?m(D,D+1):m(D,D));}}})})(Y);const S={deg:1,grad:.9,rad:180/Math.PI,turn:360},U={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/
73},Aa=/^rgba?/i,Ba=/^hsla?/i;W.parse=function(g){let q;try{q=g?Y.exports.parse(g):[]}catch(e){return{input:g,parsedFunctions:[],effects:[],error:new z("effect:invalid-syntax","Invalid effect syntax",{input:g,error:e})}}g={input:g,parsedFunctions:q,effects:[],error:null};try{for(const e of q)g.effects.push(za(e))}catch(e){g.effects.length=0,g.error=e}return g};Object.defineProperty(W,"__esModule",{value:!0})});