// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(t,u,k,z,q,A,m,v,D,E,F,B,w,C){v=f=>{f=function(y){function r(){var a=y.apply(this,arguments)||
this;a._rasterFieldPrefix="Raster.";a.layer=null;a.view=null;a.fullExtent=null;a.tileInfo=null;a.datumTransformation=null;return a}u._inheritsLoose(r,y);var l=r.prototype;l.fetchPopupFeatures=function(){var a=u._asyncToGenerator(function*(b,c){const {layer:d}=this;if(!b)return Promise.reject(new q("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:d}));var {popupEnabled:e}=d;c=C.getFetchPopupTemplate(d,c);if(!e||!A.isSome(c))throw new q("imageryTileLayerView:fetchPopupFeatures",
"Missing required popupTemplate or popupEnabled",{popupEnabled:e,popupTemplate:c});e=[];({value:b}=yield d.identify(b));let x="";if(b&&b.length){var g,n;x="imagery-tile"===d.type&&d.hasStandardTime()&&null!=b[0]?b.map(p=>d.getStandardTimeValue(p)).join(", "):b.join(", ");b={ObjectId:0};b["Raster.ServicePixelValue"]=this._formatAttributeValue(x,"Raster.ServicePixelValue");if((c=null==(g=d.rasterInfo)?void 0:null==(n=g.attributeTable)?void 0:n.features)&&0<c.length&&(g=c.filter(p=>String(p.attributes.value||
p.attributes.Value||p.attributes.VALUE)===x),0<g.length&&(g=g[0])))for(var h in g.attributes)g.attributes.hasOwnProperty(h)&&(n=this._rasterFieldPrefix+h,b[n]=this._formatAttributeValue(g.attributes[h],n));h=new z(this.fullExtent.clone(),null,b);h.layer=d;h.sourceLayer=h.layer;e.push(h)}return e});return function(b,c){return a.apply(this,arguments)}}();l.updateFullExtent=function(){var a=this.layer.tileInfo;let b;a&&a.spatialReference||(b=new q("layerview:tiling-information-missing","The layer doesn't provide tiling information",
{layer:this.layer}));a=w.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!1);a=w.projectExtent(this.layer.fullExtent,this.view.spatialReference,a);null==a&&(b=new q("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",a);this.datumTransformation||(this.datumTransformation=w.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,
!0));return b?Promise.reject(b):Promise.resolve()};l._formatAttributeValue=function(a,b){if("string"===typeof a&&(b=(b=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,b))&&b.format)){let c,d;return-1<a.trim().indexOf(",")?(c=",",d=c+" ",this._formatDelimitedString(a,c,d,b)):-1<a.trim().indexOf(" ")?(c=d=" ",this._formatDelimitedString(a,c,d,b)):this._formatNumberFromString(a,b)}return a};l._getFieldInfo=function(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;
a.some(e=>!e.fieldName||e.fieldName.toLowerCase()!==c&&e.fieldName.toLowerCase()!==c.replace(/ /g,"_")?!1:(d=e,!0));return d}};l._formatDelimitedString=function(a,b,c,d){return a&&b&&c&&d?a.trim().split(b).map(e=>this._formatNumberFromString(e,d)).join(c):a};l._formatNumberFromString=function(a,b){if(!a||!b)return a;const c=Number(a);return isNaN(c)?a:b.format(c)};u._createClass(r,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);
return r}(f);k.__decorate([m.property()],f.prototype,"layer",void 0);k.__decorate([m.property()],f.prototype,"view",void 0);k.__decorate([m.property()],f.prototype,"fullExtent",void 0);k.__decorate([m.property()],f.prototype,"tileInfo",void 0);k.__decorate([m.property({readOnly:!0})],f.prototype,"hasTilingEffects",null);return f=k.__decorate([B.subclass("esri.views.layers.ImageryTileLayerView")],f)};t.ImageryTileLayerView=v;t.default=v;Object.defineProperty(t,"__esModule",{value:!0})});