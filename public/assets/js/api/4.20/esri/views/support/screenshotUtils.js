// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../core/has","../../core/mathUtils"],function(p,V,L){function D(b,a){const {format:d,quality:k,rotation:f,disableDecorations:h}=b||{};var c=B(b,a.padding);var e=a.width-c.left-c.right;a=a.height-c.top-c.bottom;c={x:0,y:0,width:e,height:a};if(b&&b.area){null!=b.area.x&&(c.x=Math.floor(b.area.x));null!=b.area.y&&(c.y=Math.floor(b.area.y));var g=null!=b.area.width?Math.floor(b.area.width):null,m=null!=b.area.height?Math.floor(b.area.height):null;c.width=e-c.x;c.height=a-c.y;null!=
g&&null!=m?(c.width=Math.min(c.width,g),c.height=Math.min(c.height,m)):null==g&&null!=m?(g=Math.min(c.width,g),c.height*=g/c.width,c.width=g):null!=g&&null==m&&(g=Math.min(c.height,m),c.width*=g/c.height,c.height=g)}c=M(c,b);g=Math.floor(Math.max(c.x,0));m=Math.floor(Math.max(c.y,0));e={x:g,y:m,width:Math.floor(Math.min(c.width,e-g)),height:Math.floor(Math.min(c.height,a-m))};a=e.width/e.height;c=c.width/c.height;c!==a&&(c>a?(a=Math.floor(e.width/c),e={x:e.x,y:Math.floor(e.y+(e.height-a)/2),width:e.width,
height:a}):(a=Math.floor(e.height*c),e={x:Math.floor(e.x+(e.width-a)/2),y:e.y,width:a,height:e.height}));const {width:n,height:r}=N(b,e);a:switch(d){case "png":case "jpg":case "jpeg":a=d;break a;case null:case void 0:a="png";break a;default:a="png"}c=O[a];c=L.clamp(null!=k?k:c,0,100);return{format:a,quality:c,area:e,width:n,height:r,rotation:f,disableDecorations:!!h,ignoreBackground:!(!b||!b.ignoreBackground),ignorePadding:!(!b||!b.ignorePadding)}}function E(b,a){return b.toDataURL(P[a.format],a.quality/
100)}function F(b,a,d){d||(v||(v=document.createElement("canvas"),v.width=1,v.height=1),d=v);return d.getContext("2d").createImageData(b,a)}function N(b,a){if(!b)return a;const d=b.width;b=b.height;if(null!=d&&null!=b)return{width:Math.floor(d),height:Math.floor(b)};if(null==d&&null==b)return a;a=a.width/a.height;return null==b?{width:Math.floor(d),height:Math.floor(d/a)}:{width:Math.floor(b*a),height:Math.floor(b)}}function M(b,a){if(!a||null==a.width||null==a.height)return b;a=a.width/a.height;
const d=b.width/b.height;if(d===a)return b;if(d<a)return a=Math.floor(b.height*a),b.x-=(a-b.width)/2,b.width=a,b;a=Math.floor(b.width/a);b.y-=(a-b.height)/2;b.height=a;return b}function B(b,a){return!a||b&&b.ignorePadding?Q:a}let v=null,w=!0;const P={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},O={png:100,jpg:98,jpeg:98},Q={top:0,right:0,bottom:0,left:0};p.completeUserSettings=D;p.createEmptyImageData=function(b,a,d){if(!b||!a)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(b,
a)}catch(k){w=!1}return F(b,a,d)};p.encodeResult=function(b,a,d,k){if(k.premultipliedAlpha){{var f=b.data;const c=f.length;for(let e=0;e<c;e+=4){var h=f[e+3];0<h&&(h/=255,f[e+0]/=h,f[e+1]/=h,f[e+2]/=h)}}}d.width=b.width;d.height=b.height;f=d.getContext("2d");f.putImageData(b,0,0);k.flipY&&(f.save(),f.globalCompositeOperation="copy",f.scale(1,-1),f.translate(0,-f.canvas.height),f.drawImage(f.canvas,0,0),f.restore());b=f.getImageData(0,0,b.width,b.height);a=E(d,a);d.width=0;d.height=0;return{dataUrl:a,
data:b}};p.resampleHermite=function(b,a,d,k=0,f=0,h=b.width-k,c=b.height-f,e=!1){const {data:g}=b,{width:m,height:n,data:r}=a;h/=m;c/=n;const R=Math.ceil(h/2),S=Math.ceil(c/2);b=b.width;for(let q=0;q<n;q++)for(let t=0;t<m;t++){const x=4*(t+(e?n-q-1:q)*m);let y=0,G=0,H=0,I=0,J=0,K=0;const T=(q+.5)*c;for(let z=Math.floor(q*c);z<(q+1)*c;z++){var C=Math.abs(T-(z+.5))/S;const U=(t+.5)*h;C*=C;for(let A=Math.floor(t*h);A<(t+1)*h;A++){var l=Math.abs(U-(A+.5))/R;l=Math.sqrt(C+l*l);if(1<=l)continue;l=2*l*l*
l-3*l*l+1;const u=4*(k+A+(f+z)*b);K+=l*g[u+3];G+=l;!d&&255>g[u+3]&&(l=l*g[u+3]/255);H+=l*g[u];I+=l*g[u+1];J+=l*g[u+2];y+=l}}r[x]=H/y;r[x+1]=I/y;r[x+2]=J/y;r[x+3]=K/G}return a};p.screenshotSuperSampleSettings=function(b,a,d){if(!a)return b;const {framebufferWidth:k,framebufferHeight:f,pixelRatio:h,region:c}=b;a=B(b,d);d=a.left+a.right;const e=a.top+a.bottom,g=k-d,m=f-e,n=Math.min(8,Math.min((2048-d)/g,(2048-e)/m));return 1.5>n?b:{...b,framebufferWidth:Math.round(g*n)+d,framebufferHeight:Math.round(m*
n)+e,pixelRatio:h*n,resample:{region:{x:Math.round((c.x-a.left)*n)+a.left,y:Math.round((c.y-a.top)*n)+a.top,width:Math.round(c.width*n),height:Math.round(c.height*n)},width:k,height:f}}};p.toDataUrl=E;p.toRenderSettings=function(b,a){const d=D(b,a),k=d.area,f=d.width/k.width,h=B(d,a.padding),c=h.left+h.right,e=h.top+h.bottom;return{framebufferWidth:Math.floor((a.width-c)*f+c),framebufferHeight:Math.floor((a.height-e)*f+e),region:{x:Math.floor(k.x*f)+h.left,y:Math.floor(k.y*f)+h.top,width:d.width,
height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:f,layers:b&&b.layers?b.layers:[],disableDecorations:d.disableDecorations,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};p.wrapImageData=function(b,a,d,k){if(!a||!d)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(b,a,d)}catch(f){w=!1}a=F(a,d,k);a.data.set(b,0);return a};Object.defineProperty(p,"__esModule",{value:!0})});