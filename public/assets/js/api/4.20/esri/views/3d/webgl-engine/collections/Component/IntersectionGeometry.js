// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),function(y,m,n,z,A,B,u,C,D,p){let K=function(){function q(a,b){this._indices=m.isSome(a.indices)?a.indices:D.generateDefaultIndexArray(a.positions.length/
3);this._positions=new B.BufferViewVec3f(a.positions);this._components=b;this._componentIntersectionData=Array(b.count)}var l=q.prototype;l.getComponentAabb=function(a,b){if(m.isSome(this._perComponentAabbs)){for(let d=0;6>d;d++)b[d]=this._perComponentAabbs[6*a+d];return b}this._computePerComponentAabbs();return this.getComponentAabb(a,b)};l.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];
b.endIndex=this._components.offsets[a+1]};l.intersect=function(a,b,d,c,e,r){const h={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},g=this._indices,v=this._components.offsets,F=p.computeInvDir(a,b,E);this._components.visibility.forEachComponent(f=>{if(!C.getVisibility(this._components.pickability,f))return!0;var k=this.getComponentAabb(f,G);m.isSome(e)&&e.applyToAabb(k);if(!p.intersectAabbInvDir(k,a,F,d))return!0;k=v[f]/3;const t=v[f+1]/3,x=(H,w,I)=>{r(f,H,n.transformMat3(w,
w,c),I)},J=t-k;m.isNone(e)&&J>u.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[f]&&(this._componentIntersectionData[f]=new u.ComponentIntersectionData(this._indices,k,t,h)),this._componentIntersectionData[f].intersectRay({r0:a,r1:b},x)):p.intersectTriangles(a,b,k,t,g,h,void 0,e,x);return!0})};l._computePerComponentAabbs=function(){const a=this._components.count;this._perComponentAabbs=new Float32Array(6*a);for(let b=0;b<a;b++)this._computeAABB(b)};l._computeAABB=function(a){const b=
this._indices,d=this._positions;var c=this._components.offsets,e=c[a];const r=c[a+1],h=[0,0,0];c=[Infinity,Infinity,Infinity];const g=[-Infinity,-Infinity,-Infinity];for(;e<r;e++)d.getVec(b[e],h),n.min(c,c,h),n.max(g,g,h);a*=6;this._perComponentAabbs[a++]=c[0];this._perComponentAabbs[a++]=c[1];this._perComponentAabbs[a++]=c[2];this._perComponentAabbs[a++]=g[0];this._perComponentAabbs[a++]=g[1];this._perComponentAabbs[a]=g[2]};y._createClass(q,[{key:"positions",get:function(){return this._positions}},
{key:"indices",get:function(){return this._indices}}]);return q}();const E=z.create(),G=A.create();return K});