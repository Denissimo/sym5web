// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./ManipulatorState ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState".split(" "),
function(z,p,F,t,G,H,I,v,w,J,A,K,l,L,B,M,N,O,P){function Q(a,e,d,f){const {view:b,graphic:h}=a,m=new L.ExtendedLineVisualElement({view:b,extensionType:l.settings.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});l.settings.visualElements.zVerticalLine.apply(m);const n=new B.LaserlineVisualElement({view:b,intersectsLineInfinite:!0,attached:!1});l.settings.visualElements.pointGraphics.shadowStyle.apply(n);var g=F.deg2rad(l.settings.visualElements.heightPlaneAngleCutoff);
const q=new B.LaserlineVisualElement({view:b,attached:!1,angleCutoff:g});l.settings.visualElements.heightPlane.apply(q);g=A.getGraphicEffectiveElevationInfo(a.graphic);const R=O.ElevationContext.fromElevationInfo(g),S="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,x=new K.ManipulatorState;let C=1,D=1;const u=()=>{x.update(a);var c=y(h),r=S&&(e.isDraped||t.isNone(c)||!c.hasZ);let E=!0;if(!r&&t.isSome(c)){const T=N.evaluateElevationAlignmentAtPoint(c,b.elevationProvider,R,b.renderCoordsHelper);
H.set(k,c.x,c.y,T);v.projectVectorToVector(k,c.spatialReference,k,b.renderCoordsHelper.spatialReference);m.setStartEndFromWorldDownAtLocation(k);n.intersectsWorldUpAtLocation=k}else E=!1;c=x.grabbingState&2?l.settings.visualElements.laserlineAlphaMultiplier:1;c!==C&&(C=c,l.settings.visualElements.heightPlane.apply(q,c));c=w.empty(U);!r&&e.displaying&&f.calculateMapBounds(c)&&v.projectVectorToVector(w.getMin(c,k),b.spatialReference,k,b.renderCoordsHelper.spatialReference)?(q.heightManifoldTarget=k,
q.attached=!0):q.attached=!1;c=x.grabbingState&4?l.settings.visualElements.laserlineAlphaMultiplier:1;c!==D&&(D=c,l.settings.visualElements.pointGraphics.shadowStyle.apply(n,c));r=E&&e.displaying&&!r;n.attached=r;m.attached=r};d.push(e.watch(["displaying","isDraped"],u),e.on("changed",u));a.forEachManipulator(c=>{d.push(c.events.on("grab-changed",u))});d.push(p.destroyHandle(n));d.push(p.destroyHandle(m));d.push(p.destroyHandle(q));u()}function V(a,e,d){const {view:f,graphic:b}=a,h=new M.PointVisualElement({view:f,
geometry:y(b),elevationInfo:A.getGraphicEffectiveElevationInfo(b),attached:!1});W(a,h,e,d);d.push(p.destroyHandle(h));return h}function y(a){a=a.geometry;return t.isNone(a)?null:"point"===a.type?a:"mesh"===a.type?a.anchor.clone():null}function W(a,e,d,f){X(a,e,d,f);l.settings.visualElements.pointGraphics.outline.apply(e);f.push(G.init(d,"displaying",()=>e.attached=d.displaying))}function X(a,e,d,f){const {view:b,graphic:h}=a;let m=null;const n=g=>{t.isSome(m)&&(m.remove(),m=null);d.isDraped&&t.isSome(g)&&
(m=Y(b,g,()=>{e.geometry=g}))};a=()=>{const g=y(h);n(g);e.geometry=g};f.push(d.on("changed",a),p.refHandle(()=>m));a()}function Y(a,e,d){v.projectPointToVector(e,k,a.elevationProvider.spatialReference);const f=k[0],b=k[1];return a.elevationProvider.on("elevation-change",h=>{J.containsXY(h.extent,f,b)&&d()})}const k=I.create(),U=w.create();z.createVisualElements=function(a){const {view:e,graphic:d}=a,f=new P.GraphicState({graphic:d}),b=[],h=V(a,f,b);Q(a,f,b,h);b.push(e.trackGraphicState(f));return{visualElement:h,
remove(){p.handlesGroup(b).remove()}}};Object.defineProperty(z,"__esModule",{value:!0})});