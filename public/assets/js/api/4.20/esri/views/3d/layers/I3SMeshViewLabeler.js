// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../../../symbols/PointSymbol3D".split(" "),
function(r,k,x,e,y,z,t,l,J,K,L,M,A,B,C,D,E,F,G,H,I){e=function(u){function n(a){a=u.call(this,a)||this;a.loadedGraphics=new H.LimitGraphicsMap(5E4);a.slicePlaneEnabled=!1;a._renderingInfo={symbol:new I};a._handles=new z;a._graphicsByNode=new Map;a._scaleVisibility=null;return a}r._inheritsLoose(n,u);var h=n.prototype;h.initialize=function(){this._graphicsCore=new E.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,
hasZ:!0,hasM:!1});var a=this.view.basemapTerrain;this._scaleVisibility=new F({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(b,c,f)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,c,f),this._graphicsCore,a);a=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});const d=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);
this._graphicsCore.setup({labeler:a,deconflictor:d,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(b,c)=>{B.diff(b,c)&&this._graphicsCore.updateLabelingInfo()})])};h.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),
this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};h.addNodeMeta=function(a,d){let b=0;const c=a.filteredIds,f=a.featureIds.map((m,p)=>{G.boundingBoxTop(p,this.collection,a.objectHandle,v);const w=D.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(v,w);p=d(p,a);let q=!1;t.isNone(c)?q=!0:b<c.length&&m===c[b]&&(q=!0,b++);return{objectId:m,uid:x.generateUID(),attributes:p,visible:q,geometry:w}});this.loadedGraphics.addMany(f);this._graphicsByNode.set(a.node.index,
f)};h.setNodeMetaAttributes=function(a,d){const b=this._graphicsByNode.get(a.node.index),c=Array(b.length);for(let f=0;f<b.length;f++){const m=b[f];m.attributes=d(f,a);c[f]=m.uid}this._graphicsCore.updateLabelingInfo(c)};h.applyFilterChange=function(a){var d=this._graphicsByNode.get(a.node.index);if(d)if(t.isNone(a.filteredIds))for(var b of d)b.visible||(b.visible=!0,g.graphic=b,g.property="visible",g.oldValue=!1,g.newValue=!0,this._graphicsCore.graphicUpdateHandler(g));else{b=0;for(const c of d)d=
c.visible,b<a.filteredIds.length&&c.objectId===a.filteredIds[b]?(c.visible=!0,b++):c.visible=!1,d!==c.visible&&(g.graphic=c,g.property="visible",g.oldValue=d,g.newValue=c.visible,this._graphicsCore.graphicUpdateHandler(g))}};h.removeNodeMeta=function(a){this.loadedGraphics.removeManyByObjectId(a.featureIds)};h.getRenderingInfo=function(){return this._renderingInfo};h.notifyGraphicGeometryChanged=function(){};h.notifyGraphicVisibilityChanged=function(){};r._createClass(n,[{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},
{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return n}(y);k.__decorate([l.property()],e.prototype,"view",void 0);k.__decorate([l.property()],e.prototype,"layer",void 0);k.__decorate([l.property()],e.prototype,"collection",void 0);k.__decorate([l.property()],e.prototype,"loadedGraphics",void 0);k.__decorate([l.property({aliasOf:"_graphicsCore.updating"})],
e.prototype,"updating",void 0);k.__decorate([l.property()],e.prototype,"slicePlaneEnabled",void 0);k.__decorate([l.property()],e.prototype,"_graphicsCore",void 0);e=k.__decorate([A.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],e);const g={graphic:null,property:null,oldValue:null,newValue:null},v=C.create();return e});