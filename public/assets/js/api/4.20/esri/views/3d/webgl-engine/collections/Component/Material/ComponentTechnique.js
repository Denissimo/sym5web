// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(y,m,r,g,l,z,A,t,B,u,C,D,E,F,e,n,f,p,G,v,q){n=function(k){function h(){return k.apply(this,arguments)||this}r._inheritsLoose(h,k);var d=h.prototype;d.bindPass=function(b){const c=this.program;u.VertexPosition.bindViewProjTransform(c,b.viewTransform);B.bindSliceUniforms(this.program,this.configuration,b.slicePlane);0===b.identifier&&(void 0!==b.ssrParams&&E.bindSSRUniforms(this.program,b.ssrParams),c.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",b.transformNormal_ViewFromGlobal),2===
b.subPass&&c.setUniform2fv("cameraNearFar",b.cameraNearFar),0===b.subPass&&b.lighting.setUniforms(this.program,b.integratedMesh));1===b.identifier&&this.program.setUniform2fv("cameraNearFar",b.cameraNearFar)};d.bindMaterial=function(b,c){const a=this.program;a.setUniform4fv("uBaseColor",b.baseColor);a.setUniform1f("uObjectOpacity",b.objectOpacity);a.setUniform1f("textureAlphaCutoff",b.alphaCutoff);1===b.componentParameters.type?b.componentParameters.texture.bind(a,"uComponentColorTex","uComponentColorTexInvDim"):
(a.setUniform4fv("uExternalColor",b.componentParameters.externalColor),a.setUniform1i("uExternalColorMixMode",b.componentParameters.externalColorMixMode));l.isSome(b.baseColorTexture)&&b.baseColorTexture.bind(a,"uBaseColorTexture","uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)D.bindPBRUniforms(this.program,b,this.configuration.isSchematic),l.isSome(b.metallicRoughnessTexture)&&b.metallicRoughnessTexture.bind(a,"texMetallicRoughness","texMetallicRoughnessSize"),
l.isSome(b.emissionTexture)&&b.emissionTexture.bind(a,"texEmission","texEmissionSize"),l.isSome(b.occlusionTexture)&&b.occlusionTexture.bind(a,"texOcclusion","texOcclusionSize"),l.isSome(b.normalTexture)&&b.normalTexture.bind(a,"normalTexture","normalTextureSize");b.isIntegratedMesh&&(0===c.identifier&&0===c.subPass?(a.bindTexture(b.overlayColor,"ovColorTex"),a.bindTexture(b.overlayNormal,"ovNormalTex")):2===c.identifier&&a.bindTexture(b.overlayHighlight,"ovColorTex"),a.setUniform1f("overlayOpacity",
1));2===c.identifier&&C.bindOutputHighlight(this.program,c);0===c.identifier&&0===c.subPass&&(c.ambientOcclusionEnabled&&c.bindAmbientOcclusion(a),c.shadowsEnabled&&c.bindShadowMap(a));0!==c.identifier||0!==c.subPass&&1!==c.subPass||!c.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",c.cameraNearFar),a.setUniform2fv("inverseViewport",c.inverseViewport),c.multipassTerrainParams.terrainLinearDepthTexture&&a.bindTexture(c.multipassTerrainParams.terrainLinearDepthTexture,
"terrainDepthTexture"))};d.bindDraw=function(b,c){u.VertexPosition.bindModelTransform(this.program,b);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",b.transformNormal_GlobalFromModel);this.program.rebindTextures();if(c.isIntegratedMesh){const a=c.overlayTexScale;c=c.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[b.toMapSpace[0]*a[0]+c[0],b.toMapSpace[1]*a[1]+c[1],b.toMapSpace[0]*a[2]+c[2],b.toMapSpace[1]*a[3]+c[3]]);this.program.setUniform4fv("overlayTexScale",
[b.toMapSpace[2]*a[0],b.toMapSpace[3]*a[1],b.toMapSpace[2]*a[2],b.toMapSpace[3]*a[3]])}};d.initializeProgram=function(b){const c=h.shader.get();var a=this.configuration;a=c.build({multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround,OITEnabled:0===a.transparencyPassType,output:a.output,normalType:0===a.integratedMeshMode?a.hasNormals?1:3:2,attributeColor:a.hasVertexColors,attributeTextureCoordinates:a.vertexTextureCoordinates,componentData:a.componentData,alphaDiscardMode:a.alphaDiscardMode,
baseColorTexture:a.baseColorTexture,doubleSidedMode:a.doubleSidedMode,receiveAmbientOcclusion:a.receiveAmbientOcclusion,receiveShadows:a.receiveShadows,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:b.viewingMode,vertexDiscardMode:a.vertexDiscardMode,pbrMode:3===a.integratedMeshMode?4:a.usePBR?a.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:a.hasMetalnessAndRoughnessTexture,hasEmissionTexture:a.hasEmissionTexture,hasOcclusionTexture:a.hasOcclusionTexture,
hasNormalTexture:a.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:F.doublePrecisionRequiresObfuscation(b.rctx),overlayEnabled:2===a.integratedMeshMode||3===a.integratedMeshMode,ssrEnabled:a.ssrEnabled,highStepCount:!1,ellipsoidMode:a.ellipsoidMode});return new G.Program(b.rctx,a,c.attributeLocations)};d.setPipelineState=function(b){const c=this.configuration,a=0!==c.integratedMeshMode,w=3===b,x=2===b;return q.makePipelineState({blending:0!==c.output&&
7!==c.output||!c.blendingEnabled?null:w?p.blendingDefault:p.OITBlending(b),culling:q.cullingParams(c.cullFace),depthTest:{func:p.OITDepthTest(b)},depthWrite:w||x?q.defaultDepthWriteParams:null,colorWrite:q.defaultColorWriteParams,stencilWrite:a||c.sceneHasOcludees?v.stencilWriteMaskOn:null,stencilTest:a?v.replaceBitWhenDepthTestPasses(1):c.sceneHasOcludees?v.stencilBaseAllZerosParams:null,polygonOffset:w||x?c.polygonOffsetEnabled?{factor:2,units:2}:null:p.OITPolygonOffset})};d.initializePipeline=
function(){return this.setPipelineState(this.configuration.transparencyPassType)};return h}(n.ShaderTechnique);n.shader=new e.ReloadableShaderModule(t.ComponentShader,()=>new Promise(function(k,h){y(["./shader/ComponentShader.glsl"],k,h)}));t=function(k){function h(){var d=k.apply(this,arguments)||this;d.transformNormal_GlobalFromModel=z.create();d.toMapSpace=A.create();return d}r._inheritsLoose(h,k);return h}(u.VertexPosition.ModelTransform);e=function(k){function h(){var d=k.apply(this,arguments)||
this;d.output=0;d.hasVertexColors=!1;d.hasNormals=!1;d.vertexTextureCoordinates=0;d.componentData=0;d.slicePlaneEnabled=!1;d.cullFace=2;d.baseColorTexture=!1;d.receiveAmbientOcclusion=!0;d.receiveShadows=!0;d.vertexDiscardMode=0;d.doubleSidedMode=2;d.blendingEnabled=!0;d.alphaDiscardMode=1;d.integratedMeshMode=0;d.ssrEnabled=!1;d.polygonOffsetEnabled=!1;d.usePBR=!1;d.isSchematic=!1;d.hasMetalnessAndRoughnessTexture=!1;d.hasEmissionTexture=!1;d.hasOcclusionTexture=!1;d.hasNormalTexture=!1;d.sceneHasOcludees=
!1;d.transparencyPassType=3;d.ellipsoidMode=1;d.multipassTerrainEnabled=!1;d.cullAboveGround=!1;return d}r._inheritsLoose(h,k);return h}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:8})],e.prototype,"output",void 0);g.__decorate([f.parameter()],e.prototype,"hasVertexColors",void 0);g.__decorate([f.parameter()],e.prototype,"hasNormals",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"vertexTextureCoordinates",void 0);g.__decorate([f.parameter({count:2})],e.prototype,"componentData",
void 0);g.__decorate([f.parameter()],e.prototype,"slicePlaneEnabled",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"cullFace",void 0);g.__decorate([f.parameter()],e.prototype,"baseColorTexture",void 0);g.__decorate([f.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);g.__decorate([f.parameter()],e.prototype,"receiveShadows",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"vertexDiscardMode",void 0);g.__decorate([f.parameter({count:3})],e.prototype,"doubleSidedMode",
void 0);g.__decorate([f.parameter()],e.prototype,"blendingEnabled",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"alphaDiscardMode",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"integratedMeshMode",void 0);g.__decorate([f.parameter()],e.prototype,"ssrEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"polygonOffsetEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"usePBR",void 0);g.__decorate([f.parameter()],e.prototype,"isSchematic",void 0);g.__decorate([f.parameter()],
e.prototype,"hasMetalnessAndRoughnessTexture",void 0);g.__decorate([f.parameter()],e.prototype,"hasEmissionTexture",void 0);g.__decorate([f.parameter()],e.prototype,"hasOcclusionTexture",void 0);g.__decorate([f.parameter()],e.prototype,"hasNormalTexture",void 0);g.__decorate([f.parameter()],e.prototype,"sceneHasOcludees",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"transparencyPassType",void 0);g.__decorate([f.parameter({count:4})],e.prototype,"ellipsoidMode",void 0);g.__decorate([f.parameter()],
e.prototype,"multipassTerrainEnabled",void 0);g.__decorate([f.parameter()],e.prototype,"cullAboveGround",void 0);m.ComponentDrawParameters=t;m.ComponentTechnique=n;m.ComponentTechniqueConfiguration=e;Object.defineProperty(m,"__esModule",{value:!0})});