// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry".split(" "),function(q,w,k,x,n,t,y,u,z,A,B,C){function v(a,b,e){const c=[];for(const {index:f,count:d}of a){if(1>=d)continue;a=3*f;const g=a+3*d;c.push({position:b.subarray(a,
g),mapPosition:e?e.subarray(a,g):void 0})}return c}const r=t.create(),p=t.create(),D=4/Math.PI;q.createGeometry=function(a){const b=[],e=[];{const {attributeData:{position:h},removeDuplicateStartEnd:E}=a;var c=h.length;c=(c=h[0]===h[c-3]&&h[1]===h[c-2]&&h[2]===h[c-1])&&1===E;var f=h.length/3-(c?1:0),d=new Uint32Array(2*(f-1)),g=c?x.slice(h,0,h.length-3):h,l=0;for(var m=0;m<f-1;m++)d[l++]=m,d[l++]=m+1;e.push(["position",{size:3,data:g,exclusive:c}]);b.push(["position",d])}c=e[0][1].data;f=new Uint16Array(b[0][1].length);
d=a.attributeData.mapPosition;k.isNone(d)||(b.push(["mapPos",b[0][1]]),e.push(["mapPos",{size:3,data:d}]));k.isSome(a.attributeData.colorFeature)||(e.push(["color",{size:4,data:k.unwrapOr(a.attributeData.color,z.WHITE_UNIT)}]),b.push(["color",f]));k.isSome(a.attributeData.sizeFeature)||(e.push(["size",{size:1,data:[k.unwrapOr(a.attributeData.size,1)]}]),b.push(["size",f]));d=a.attributeData.colorFeature;k.isNone(d)||(e.push(["colorFeatureAttribute",{size:1,data:new Float32Array([d])}]),b.push(["color",
f]));d=a.attributeData.sizeFeature;k.isNone(d)||(e.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([d])}]),b.push(["sizeFeatureAttribute",f]));d=a.attributeData.opacityFeature;k.isNone(d)||(e.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([d])}]),b.push(["opacityFeatureAttribute",f]));if("round"===a.join){f=c.length/3;d=new Float32Array(f);n.set(r,0,0,0);a=k.unwrapOr(a.uniformSize,1);for(g=-1;g<f;++g)l=0>g?f+g:g,m=(g+1)%f,n.set(p,c[3*m]-c[3*l],c[3*m+1]-c[3*l+1],c[3*m+2]-
c[3*l+2]),n.normalize(p,p),0<=g&&(l=(Math.PI-w.acosClamped(n.dot(r,p)))*D*(1.863798+-2.0062872/(1+a/18.2313)**.8856294),d[g]=Math.max(Math.floor(l),0)),n.scale(r,p,-1);e.push(["subdivisions",{size:1,data:d}]);b.push(["subdivisions",b[0][1]])}return new C.Geometry(e,b,2)};q.geometryToRenderInfo=function(a,b,e,c){const {position:f,outlines:d}=u.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,a.hasZ,"polygon"===a.type?1:0),g=new Float64Array(f.length);a=A.applyPerVertexElevationAlignment(f,
a.spatialReference,0,g,0,f,0,f.length/3,b,e,c);b=null!=a;return{lines:b?v(d,f,g):[],projectionSuccess:b,sampledElevation:a}};q.geometryToRenderInfoDraped=function(a,b){const {position:e,outlines:c}=u.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,!1,"polygon"===a.type?1:0);a=y.projectBuffer(e,a.spatialReference,0,e,b,0,e.length/3);for(b=2;b<e.length;b+=3)e[b]=B.DRAPED_Z;return{lines:a?v(c,e):[],projectionSuccess:a}};Object.defineProperty(q,"__esModule",{value:!0})});