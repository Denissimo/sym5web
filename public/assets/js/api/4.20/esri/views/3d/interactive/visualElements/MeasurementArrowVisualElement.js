// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/vectorStacks ./Object3DVisualElement ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),function(p,q,x,g,y,z,r,h,l,A,B){l=function(t){function k(a){var b=t.call(this,a)||this;b._parameters=C;b._handles=null;b._origin=r.create();b._originTransform=
y.create();b._arrowCenter=r.create();b._renderOccluded=4;b._geometry=null;b._stripeLength=1;b._stripesEnabled=!0;b.applyProps(a);return b}q._inheritsLoose(k,t);var d=k.prototype;d.createExternalResources=function(){this._arrowMaterial=new B.MeasurementArrowMaterial({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,
polygonOffset:!0});this._handles=new x;this._handles.add(this.view.state.watch("camera",()=>{this.viewChanged()}))};d.destroyExternalResources=function(){this._arrowMaterial=null;this._handles.destroy();this._handles=null};d.forEachExternalMaterial=function(a){a(this._arrowMaterial)};d.createGeometries=function(a){if(!(g.isNone(this._geometry)||g.isNone(this._geometry.startRenderSpace)||g.isNone(this._geometry.endRenderSpace))){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,
this._origin,this._geometry);a.addGeometry(b,this._arrowMaterial,this._originTransform);this.viewChanged()}};d._createArrowGeometry=function(a,b,D,c){const u=this.view.renderCoordsHelper,v=[],w=[],n=(m,e)=>{const f=h.sv3d.get();z.subtract(f,m,D);v.push(f);w.push(e)};if("euclidean"===c.type)c.eval(.5,this._arrowCenter),c=h.sv3d.get(),u.worldUpAtPosition(this._arrowCenter,c),n(a,c),n(b,c);else for(c.eval(.5,this._arrowCenter),a=this._parameters.arrowSubdivisions+1&-2,b=0;b<a;++b){const m=b/(a-1),e=
h.sv3d.get(),f=h.sv3d.get();c.eval(m,e);u.worldUpAtPosition(e,f);n(e,f)}return A.createPolylineGeometry(v,w)};d.geometryChanged=function(){this.recreateGeometry()};d.viewChanged=function(){if(this.view.ready&&this.attached&&g.isSome(this._geometry)){const a=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*a})}};q._createClass(k,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==
this._renderOccluded&&(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:a}))}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(a){this._stripeLength=a;this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(a){this._stripesEnabled=
a;this.attached&&this._arrowMaterial.setParameterValues({stripeEvenColor:this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor})}}]);return k}(l.Object3DVisualElement);const C={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};p.MeasurementArrowVisualElement=l;Object.defineProperty(p,"__esModule",{value:!0})});