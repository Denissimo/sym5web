// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports"],function(ha){function M(a,b,d,f,e,c){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(A(ia,d,b),A(ja,f,b),A(ka,e,b),P(a,b,l),Q[1]=l[0],R[1]=l[1],Y[1]=R[1]-Q[1],d=[d,f,e],f=[ia,ja,ka],e=0;3>e;++e){P(a,d[e],l);Q[0]=l[0];R[0]=l[1];P(a,f[e],l);Q[2]=l[0];R[2]=l[1];Y[0]=R[0]-Q[0];Y[2]=R[2]-Q[2];const m=da(Y);m<c.quality&&(v(c.b0,d[e]),v(c.b1,b),v(c.b2,f[e]),c.quality=m)}}function P(a,b,d){const {data:f,size:e}=a;d[0]=Number.POSITIVE_INFINITY;d[1]=Number.NEGATIVE_INFINITY;for(a=0;a<f.length;a+=
e){const c=f[a]*b[0]+f[a+1]*b[1]+f[a+2]*b[2];d[0]=Math.min(d[0],c);d[1]=Math.max(d[1],c)}}function la(a,b,d){v(d.center,a);N(d.halfSize,b,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=0;d.quaternion[3]=1}function ma(a,b,d,f,e,c){P(a,b,l);e[0]=l[0];c[0]=l[1];P(a,d,l);e[1]=l[0];c[1]=l[1];P(a,f,l);e[2]=l[0];c[2]=l[1]}function na(a,b,d,f,e,c,m){H[0]=a[0];H[1]=a[1];H[2]=a[2];H[3]=b[0];H[4]=b[1];H[5]=b[2];H[6]=d[0];H[7]=d[1];H[8]=d[2];var k=m.quaternion,g=H,h=g[0]+g[4]+g[8];if(0<h)h=Math.sqrt(h+
1),k[3]=.5*h,h=.5/h,k[0]=(g[5]-g[7])*h,k[1]=(g[6]-g[2])*h,k[2]=(g[1]-g[3])*h;else{h=0;g[4]>g[0]&&(h=1);g[8]>g[3*h+h]&&(h=2);const y=(h+1)%3,p=(h+2)%3;let t=Math.sqrt(g[3*h+h]-g[3*y+y]-g[3*p+p]+1);k[h]=.5*t;t=.5/t;k[3]=(g[3*y+p]-g[3*p+y])*t;k[y]=(g[3*y+h]+g[3*h+y])*t;k[p]=(g[3*p+h]+g[3*h+p])*t}Z(S,f,e);N(S,S,.5);N(m.center,a,S[0]);N(aa,b,S[1]);Z(m.center,m.center,aa);N(aa,d,S[2]);Z(m.center,m.center,aa);N(m.halfSize,c,.5)}function da(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function Z(a,b,d){a[0]=b[0]+
d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2]}function B(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2]}function N(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d}function v(a,b,d=0){a[0]=b[d+0];a[1]=b[d+1];a[2]=b[d+2]}function A(a,b,d){const f=b[0],e=b[1];b=b[2];const c=d[0],m=d[1];d=d[2];a[0]=e*d-b*m;a[1]=b*c-f*d;a[2]=f*m-e*c}function n(a,b){var d=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d)}function ea(a,b){const d=b[0]-a[0],f=b[1]-a[1];a=b[2]-a[2];return d*d+
f*f+a*a}const W=[0,0,0],ba=[0,0,0],O=[0,0,0],I=[0,0,0],C=[0,0,0],D=[0,0,0],E=[0,0,0],J=[0,0,0],K=[0,0,0],L=[0,0,0],F=[0,0,0],l=[0,0],ia=[0,0,0],ja=[0,0,0],ka=[0,0,0],R=[0,0,0],Q=[0,0,0],Y=[0,0,0],fa=[0,0,0],w=[0,0,0],T=[0,0,0],X=[0,0,0],U=[0,0,0],V=[0,0,0],oa=[0,0,0],aa=[0,0,0],H=[1,0,0,0,1,0,0,0,1],S=[0,0,0];let pa=function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,
b,7);b+=56;for(var d=0;7>d;++d)this.minVert[d]=new Float64Array(this.buffer,b,3),b+=24;for(d=0;7>d;++d)this.maxVert[d]=new Float64Array(this.buffer,b,3),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;b=Array(7);d=Array(7);const {data:f,size:e}=a;for(a=0;a<f.length;a+=e){var c=f[a];c<this.minProj[0]&&(this.minProj[0]=c,b[0]=a);c>this.maxProj[0]&&(this.maxProj[0]=c,d[0]=a);c=f[a+1];c<this.minProj[1]&&(this.minProj[1]=c,b[1]=a);c>this.maxProj[1]&&
(this.maxProj[1]=c,d[1]=a);c=f[a+2];c<this.minProj[2]&&(this.minProj[2]=c,b[2]=a);c>this.maxProj[2]&&(this.maxProj[2]=c,d[2]=a);c=f[a]+f[a+1]+f[a+2];c<this.minProj[3]&&(this.minProj[3]=c,b[3]=a);c>this.maxProj[3]&&(this.maxProj[3]=c,d[3]=a);c=f[a]+f[a+1]-f[a+2];c<this.minProj[4]&&(this.minProj[4]=c,b[4]=a);c>this.maxProj[4]&&(this.maxProj[4]=c,d[4]=a);c=f[a]-f[a+1]+f[a+2];c<this.minProj[5]&&(this.minProj[5]=c,b[5]=a);c>this.maxProj[5]&&(this.maxProj[5]=c,d[5]=a);c=f[a]-f[a+1]-f[a+2];c<this.minProj[6]&&
(this.minProj[6]=c,b[6]=a);c>this.maxProj[6]&&(this.maxProj[6]=c,d[6]=a)}for(a=0;7>a;++a)c=b[a],v(this.minVert[a],f,c),c=d[a],v(this.maxVert[a],f,c)},qa=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};ha.computeOBB=function(a,b){const {data:d,size:f}=a;var e=d.length/f;if(!(0>=e)){var c=new pa(a);Z(W,c.minProj,c.maxProj);N(W,W,.5);B(ba,c.maxProj,c.minProj);var m=da(ba),k=new qa;k.quality=m;14>e&&(a={data:new Float64Array(c.buffer,112,42),size:3});var g=[0,0,0],h=[0,0,0],
y=[0,0,0];e=[0,0,0];var p=[0,0,0],t=[0,0,0],q=[0,0,0];var x=a;var z=ea(c.maxVert[0],c.minVert[0]),u=0;for(var G=1;7>G;++G){const r=ea(c.maxVert[G],c.minVert[G]);r>z&&(z=r,u=G)}v(g,c.minVert[u]);v(h,c.maxVert[u]);if(1E-6>ea(g,h))x=1;else{B(e,g,h);n(e,e);{const {data:r,size:ca}=x;c=Number.NEGATIVE_INFINITY;z=0;for(u=0;u<r.length;u+=ca)F[0]=r[u]-g[0],F[1]=r[u+1]-g[1],F[2]=r[u+2]-g[2],G=e[0]*F[0]+e[1]*F[1]+e[2]*F[2],G=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-G*G/(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),G>c&&(c=G,z=u);v(y,
r,z)}1E-6>c?x=2:(B(p,h,y),n(p,p),B(t,y,g),n(t,t),A(q,p,e),n(q,q),M(x,q,e,p,t,k),x=0)}switch(x){case 1:la(W,ba,b);return;case 2:m=a;v(w,e);Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?w[0]=0:Math.abs(e[1])>Math.abs(e[2])?w[1]=0:w[2]=0;1E-6>w[0]*w[0]+w[1]*w[1]+w[2]*w[2]&&(w[0]=w[1]=w[2]=1);A(T,e,w);n(T,T);A(X,e,T);n(X,X);ma(m,e,T,X,U,V);B(oa,V,U);na(e,T,X,U,V,oa,b);return}x=a;{c=l;const {data:r,size:ca}=x;v(I,r);v(O,I);c[0]=fa[0]*q[0]+fa[1]*q[1]+fa[2]*q[2];c[1]=c[0];for(z=ca;z<r.length;z+=
ca)u=r[z]*q[0]+r[z+1]*q[1]+r[z+2]*q[2],u<c[0]&&(c[0]=u,v(I,r,z)),u>c[1]&&(c[1]=u,v(O,r,z))}q=g[0]*q[0]+g[1]*q[1]+g[2]*q[2];l[1]-1E-6<=q&&(O[0]=void 0);l[0]+1E-6>=q&&(I[0]=void 0);void 0!==O[0]&&(B(C,O,g),n(C,C),B(D,O,h),n(D,D),B(E,O,y),n(E,E),A(J,D,e),n(J,J),A(K,E,p),n(K,K),A(L,C,t),n(L,L),M(x,J,e,D,C,k),M(x,K,p,E,D,k),M(x,L,t,C,E,k));void 0!==I[0]&&(B(C,I,g),n(C,C),B(D,I,h),n(D,D),B(E,I,y),n(E,E),A(J,D,e),n(J,J),A(K,E,p),n(K,K),A(L,C,t),n(L,L),M(x,J,e,D,C,k),M(x,K,p,E,D,k),M(x,L,t,C,E,k));ma(a,k.b0,
k.b1,k.b2,U,V);a=[0,0,0];B(a,V,U);k.quality=da(a);k.quality<m?na(k.b0,k.b1,k.b2,U,V,a,b):la(W,ba,b)}};Object.defineProperty(ha,"__esModule",{value:!0})});