// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/debugFlags ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(f,t,u,p,h,k,v,m,w,x,y,q,z,A,B,C,n){const D={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let E=function(){function e(){this._value=0}var d=e.prototype;d.increment=function(){this._value++};d.decrement=function(){this._value--};t._createClass(e,[{key:"value",get:function(){return this._value}}]);return e}();const F={solid:0,sketch:1,uber:2};let I=function(){function e(a,b,c){this.rctx=a;this.shaderTechniqueRepository=b;this.config=new n.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new E;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new h,[2]:new h},[2]:{[1]:new h,[2]:new h}};this.renderablesDirty=!1;this.settings={...D,...c};this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:x.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES};this.config.legacy=this.settings.legacy;this.config.mode=F[this.settings.type];this.config.silhouette=
!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=B.doublePrecisionRequiresObfuscation(a)}var d=e.prototype;d.dispose=function(){this.technique=p.releaseMaybe(this.technique)};d.addRenderable=function(a){this.renderables.add(a);this.renderablesDirty=!0};d.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};d.setRenderablesDirty=function(){this.renderablesDirty=
!0};d.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forAll(a);this.sortedRenderables[b][2].forAll(a)};d.setMultipassParameters=function(a){this.config.multipassTerrainEnabled=a.multipassTerrainEnabled?a.multipassTerrainEnabled:!1;this.config.cullAboveGround=a.cullAboveGround?a.cullAboveGround:!1};d.bindRegularEdges=function(a,b){this.setMultipassParameters(a);this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(n.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass({bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.useProgram(this.technique.program)};d.bindSilhouetteEdges=function(a,b){this.setMultipassParameters(a);this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(n.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass({bindParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.useProgram(this.technique.program)};d.renderRegularEdges=function(a,b,c){this.render(a,a.regular.vao,b,c)};d.renderSilhouetteEdges=function(a,b,c){this.render(a,a.silhouette.vao,b,c)};d.render=function(a,b,c,l){this.setUniforms(a,c);this.rctx.bindVAO(b);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,l)};d.setUniforms=function(a,b){const c=this.technique.program;a.components.buffer.textureBuffer.bind(c,"uComponentDataTex","uComponentDataTexInvDim");b.multipassTerrainEnabled&&
(c.setUniform2fv("cameraNearFar",b.camera.nearFar),c.setUniform2fv("inverseViewport",b.inverseViewport),A.bindMultipassTerrainTexture(c,b));if("origin"in a.transform)c.setUniformMatrix4fv("uView",b.localViewMatrixForEdges),c.setUniformMatrix4fv("uModel",a.transform.modelMatrix),q.bindSliceUniforms(c,this.settings,b.slicePlane,a.transform.origin.vec3);else{const l=new C.TwoVectorPosition(a.transform.position),G=k.transpose(r,k.invert(r,a.transform.rotationScale)),g=new y.ComponentDrawParameters;m.copy(g.worldFromModel_TL,
l.low);m.copy(g.worldFromModel_TH,l.high);k.copy(g.worldFromModel_RS,a.transform.rotationScale);k.copy(g.transformNormal_GlobalFromModel,G);z.VertexPosition.bindModelTransform(c,g);c.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",g.transformNormal_GlobalFromModel);a=b.camera.viewInverseTransposeMatrix;a=m.set(H,a[3],a[7],a[11]);q.bindSliceUniforms(c,this.settings,b.slicePlane,a)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(c);c.setUniform1f("uWorldLineRadiusPerDistance",
Math.tan(b.camera.fovY/2)/(b.camera.fullViewport[3]/2))};d.setSketchUniforms=function(a){const b=this.settings.strokesTexture,c=b.texture;p.isNone(c)||(a.bindTexture(c,"uStrokesTexture"),a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height),a.setUniform1f("uStrokesLog2Resolution",u.log2(b.resolution)),a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale),a.setUniform1f("uStrokesAmplitude",b.amplitude),a.setUniform1f("uStrokeVariants",b.variants))};d.sortRenderables=
function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(b=>{0!==b.objectTransparency&&0!==b.edgeTransparency&&this.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)});const a=(b,c)=>"origin"in b.transform&&"origin"in c.transform?b.transform.origin.id<c.transform.origin.id?-1:b.transform.origin.id>c.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(a);
this.sortedRenderables[1][2].sort(a);this.sortedRenderables[2][1].sort(a);this.sortedRenderables[2][2].sort(a)};e.getKey=function(a,b,c){return`edges-t:${a}:${b}:${c}`};return e}();const r=v.create(),H=w.create();f.EXTENSION_LENGTH_OFFSET=128;f.EdgeRenderer=I;f.LINE_WIDTH_FRACTION_FACTOR=8;f.componentDataInvDimName="uComponentDataTexInvDim";f.componentDataTexName="uComponentDataTex";Object.defineProperty(f,"__esModule",{value:!0})});