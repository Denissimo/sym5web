// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(e,r,f,B,C,D,l,F,G,H,I,u,h,x,E,y,z){function A(c,b){c&&!c.spatialReference.equals(b)&&(c=x.canProject(c.spatialReference,b)?x.project(c,b):null);return c}e.SurfaceExtentHelper=function(c){function b(a){a=c.call(this,a)||this;a._handles=new C;return a}r._inheritsLoose(b,c);var g=b.prototype;g.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};g.destroy=function(){this._handles.destroy();this._handles=null};g._computeStencilEnabledExtents=
function(){const a=[];this.layerViews.forEach(d=>{d=d.layer;"IntegratedMeshLayer"===d.operationalLayerType&&null!=this.spatialReference&&(d=A(d.fullExtent,this.spatialReference),null!=d&&a.push(h.fromExtent(d)))});return a};r._createClass(b,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}},{key:"spatialReference",
set:function(a){this.tilingScheme||this._set("spatialReference",a)}},{key:"tilingScheme",set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)}}]);return b}(B);f.__decorate([l.property({readOnly:!0,dependsOn:[]})],e.SurfaceExtentHelper.prototype,"layerViewsExtent",null);f.__decorate([l.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],e.SurfaceExtentHelper.prototype,"tiledLayersExtent",null);f.__decorate([l.property({readOnly:!0,dependsOn:["spatialReference"]})],
e.SurfaceExtentHelper.prototype,"stencilEnabledExtents",null);f.__decorate([l.property()],e.SurfaceExtentHelper.prototype,"spatialReference",null);f.__decorate([l.property()],e.SurfaceExtentHelper.prototype,"tilingScheme",null);f.__decorate([l.property()],e.SurfaceExtentHelper.prototype,"defaultTiledLayersExtent",void 0);f.__decorate([l.property({constructOnly:!0})],e.SurfaceExtentHelper.prototype,"layers",void 0);f.__decorate([l.property({constructOnly:!0})],e.SurfaceExtentHelper.prototype,"layerViews",
void 0);e.SurfaceExtentHelper=f.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],e.SurfaceExtentHelper);let t=function(c){function b(){return c.apply(this,arguments)||this}r._inheritsLoose(b,c);var g=b.prototype;g._computeLayerViewsExtent=function(){return this._getGlobalExtent()};g._computeTiledLayersExtent=function(){return this._getGlobalExtent()};g._getGlobalExtent=function(){return this.spatialReference.isWebMercator?y.WEBMERCATOR_WORLD_EXTENT:y.GEOGRAPHIC_WORLD_EXTENT};
return b}(e.SurfaceExtentHelper);f.__decorate([l.property({dependsOn:["spatialReference"]})],t.prototype,"layerViewsExtent",void 0);t=f.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],t);let w=function(c){function b(){return c.apply(this,arguments)||this}r._inheritsLoose(b,c);var g=b.prototype;g.initialize=function(){this._handles.add([this.layers.on("change",a=>this._handleLayersChanged(a)),this.layerViews.on("change",()=>this.notifyChange("layerViewsExtent"))])};g._handleLayersChanged=
function(a){for(const d of a.removed)this._handles.remove(d.uid);for(const d of a.added)this._handles.add(D.init(d,"loaded",()=>this.notifyChange("tiledLayersExtent")),d.uid)};g._computeLayerViewsExtent=function(){const a=h.empty(),d=this.spatialReference;this.layerViews.forEach(k=>{const n=k.layer;!k.isResolved()||"graphics"===n.type&&n.internal||(k=A("fullExtentInLocalViewSpatialReference"in k&&k.fullExtentInLocalViewSpatialReference||k.layer.fullExtent,d))&&h.expand(a,k)});const m=h.allFinite(a)?
a:null,p=this._get("layerViewsExtent");return h.equals(m,p)?p:m};g._computeTiledLayersExtent=function(){const a=this.tilingScheme;if(!a)return null;const d=this.spatialReference,m=h.empty();this.layers.forEach(function(n){if(n.loaded&&E.isTiledLayer(n)){const {tileInfo:v,fullExtent:q}=z.getTiledLayerInfo(n,d,2);v&&z.isProjectableRasterLayer(n)&&q?h.expand(m,q):v&&a.compatibleWith(v)&&q&&q.spatialReference.equals(d)&&h.expand(m,q)}});this.defaultTiledLayersExtent&&h.expand(m,this.defaultTiledLayersExtent);
const p=h.allFinite(m)?m:null,k=this._get("tiledLayersExtent");return h.equals(p,k)?k:p};return b}(e.SurfaceExtentHelper);w=f.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],w);e.create=function(c,b){return 1===c?new t(b):new w(b)};Object.defineProperty(e,"__esModule",{value:!0})});