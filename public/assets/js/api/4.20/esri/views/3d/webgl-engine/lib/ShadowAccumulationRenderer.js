// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../chunks/vec4f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./glUtil3D ../shaders/ShadowAccumulationTechnique ../../../webgl/Util".split(" "),function(f,r,k,l,g,m,x,
y,z,A,B,C,t,D,u,h,v){function n(d){const c=d.length,a=new Uint8Array(4*c);for(let b=0;b<c;++b){const e=d[b];a[4*b]=255*e[0];a[4*b+1]=255*e[1];a[4*b+2]=255*e[2];a[4*b+3]=255*e[3]}return a}const p=[g.fromValues(.01,0,.25,0),g.fromValues(.01,0,.25,1)],q=1/512;m=function(){function d(a,b,e,w){this._techniqueRep=a;this._rctx=b;this._shadowAccumulator=e;this._requestRender=w;this._enabled=!1;this._vao=u.createQuadVAO(b);this._visualizationConfig=new h.ShadowAccumulationTechniqueConfiguration;this._visualizationConfig.pass=
1;this._visualizationConfig.visualization=0;this._visualizeAccumulationTechnique=a.acquire(h.ShadowAccumulationTechnique,this._visualizationConfig);a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:p.length,height:1};this._colorRampTexture=new t(this._rctx,a,n(p));this._visualizationParams={shadowAccumulationMap:this._accumulationTexture,sampleScale:0,colorRamp:this._colorRampTexture,rampSize:a.width,threshold:.5,bandSize:.1,colors:k.flatten([g.fromValues(0,1,0,
.5),g.fromValues(1,0,0,.5)]),opacityFromElevation:1}}var c=d.prototype;c.dispose=function(){this._stop();this._vao=l.disposeMaybe(this._vao);this._visualizeAccumulationTechnique=l.disposeMaybe(this._visualizeAccumulationTechnique);this._colorRampTexture=l.disposeMaybe(this._colorRampTexture);this._shadowAccumulator=null};c.render=function(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeAccumulationTechnique.program),
this._visualizeAccumulationTechnique.bindPipelineState(this._rctx),this._visualizeAccumulationTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeAccumulationTechnique.primitiveType,0,v.vertexCount(this._vao,"geometry")))};c.setOptions=function(a){void 0!==a.enabled&&this._setEnabled(a.enabled);void 0!==a.gradientColorRamp&&this._setColorRamp(a.gradientColorRamp);void 0!==a.threshold&&(this._threshold=a.threshold);void 0!==a.thresholdColors&&this._setThresholdColors(a.thresholdColors);
void 0!==a.visualization&&(this._visualization=a.visualization);void 0!==a.bandSize&&(this._bandSize=a.bandSize);void 0!==a.bandsEnabled&&(this._bandsEnabled=a.bandsEnabled)};c._setColorRamp=function(a){const b=a.length;a=n(a);this._colorRampTexture.resize(b,1);this._colorRampTexture.setData(a);this._visualizationParams.rampSize=b;this._requestRenderIfRunning()};c._setThresholdColors=function(a){const b=this._visualizationParams.colors;a=k.flatten(a);k.equals(b,a)||(this._visualizationParams.colors=
a,this._requestRenderIfRunning())};c._setEnabled=function(a){a!==this._enabled&&(a?this._start():this._stop())};c._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};c._start=function(){this._enabled=!0;this._requestRender()};c._stop=function(){this._enabled=!1;this._requestRender()};r._createClass(d,[{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(a){this._visualizationParams.opacityFromElevation=a}},{key:"_isRenderingVisualization",
get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>q}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_accumulationTexture",get:function(){return this._shadowAccumulator.accumulationTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(a){this._visualizationParams.sampleScale=a}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(a){this._threshold!==
a&&(this._visualizationParams.threshold=a,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._visualizationConfig.visualization},set:function(a){if(a!==this._visualization){var b=this._visualizationConfig;b.visualization=a;this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(h.ShadowAccumulationTechnique,b,this._visualizeAccumulationTechnique);this._requestRenderIfRunning()}}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},
set:function(a){a!==this._bandSize&&(this._visualizationParams.bandSize=a,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._visualizationConfig.bandsEnabled},set:function(a){if(a!==this._bandsEnabled){var b=this._visualizationConfig;b.bandsEnabled=a;this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(h.ShadowAccumulationTechnique,b,this._visualizeAccumulationTechnique);this._requestRenderIfRunning()}}}]);return d}();f.ShadowAccumulationRenderer=
m;f.shadowAccumulationDisableElevationMax=5E4;f.shadowAccumulationDisableElevationMin=4E4;f.shadowAccumulationDisabledElevationThreshold=q;Object.defineProperty(f,"__esModule",{value:!0})});