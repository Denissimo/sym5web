// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(p,c,b,v,l,e,D,E,F,G,w,x,k,y,z,A,B,m,q,g){b=function(r){function n(){var a=r.apply(this,arguments)||this;a._propertiesPool=new q.PropertiesPool({camera:g},p._assertThisInitialized(a));a._lastSeenCameraProjectionValues=new g;a.events=new v;a.viewingMode=1;a._cameraChanged=!1;a.updateQueue=[];a.processingUpdates=!1;return a}p._inheritsLoose(n,r);var h=n.prototype;h.init=function(a,d){this._set("viewingMode",a);this._set("spatialReference",d);this._set("constraints",new A["default"]({mode:this.viewingMode}))};
h.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new q.PropertiesPool({camera:g},this)};h.createInitialCamera=function(){if(1===this.viewingMode){const a=y.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new g(k.fromValues(4*a,0,0),k.fromValues(a,0,0),k.fromValues(0,0,1))}else this.camera=new g(k.fromValues(0,0,100),k.fromValues(0,0,0),k.fromValues(0,1,0))};h.switchCameraController=function(a){this.cameraController=a;return a.state!==
m.State.Rejected};h.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};h.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();f.copyFrom(this._get("camera"));a(f);this.camera=f;this.processingUpdates=!1;this.processUpdateQueue()}};h.cameraProjectionChanged=function(a,
d){return a.fov!==d.fov||a.fullViewport[0]!==d.fullViewport[0]||a.fullViewport[1]!==d.fullViewport[1]||a.fullViewport[2]!==d.fullViewport[2]||a.fullViewport[3]!==d.fullViewport[3]||a.padding[0]!==d.padding[0]||a.padding[1]!==d.padding[1]||a.padding[2]!==d.padding[2]||a.padding[3]!==d.padding[3]?!0:!1};p._createClass(n,[{key:"animation",get:function(){return this.cameraController instanceof B.AnimationController&&l.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},
{key:"camera",get:function(){return this._get("camera")},set:function(a){a!==f&&f.copyFrom(a);f.computeUp(this.viewingMode);t.camera=f;this.events.emit("before-camera-change",t);a=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,f)&&(this._lastSeenCameraProjectionValues.copyFrom(f),u.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",u));if(!a||!a.equals(f))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(f)),
this._cameraChanged=!a||!a.almostEquals(f)){const d=x.afterDispatch(()=>{this._cameraChanged=!1;d.remove()})}}},{key:"contentCamera",get:function(){return l.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(a){this._contentCamera=l.isSome(a)?a.clone():null}},{key:"fixedContentCamera",get:function(){return!!l.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return 1===this.viewingMode}},{key:"isLocal",get:function(){return 2===this.viewingMode}},{key:"navigating",
get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(a){this.stopActiveCameraController()?(a&&(a.watch("state",d=>{if(d===m.State.Finished||d===m.State.Stopped)this._set("cameraController",null),this.updateCamera(C=>a.onControllerEnd(C))},!0),a.onControllerStart(this.camera)),this._set("cameraController",
a)):a&&(a.state=m.State.Rejected)}}]);return n}(b);c.__decorate([e.property({readOnly:!0,type:z})],b.prototype,"animation",null);c.__decorate([e.property({type:g})],b.prototype,"camera",null);c.__decorate([e.property({})],b.prototype,"_contentCamera",void 0);c.__decorate([e.property({type:g})],b.prototype,"contentCamera",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"constraints",void 0);c.__decorate([e.property({readOnly:!0})],
b.prototype,"events",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"isGlobal",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"isLocal",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"viewingMode",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"navigating",null);c.__decorate([e.property({readOnly:!0})],b.prototype,"stationary",null);c.__decorate([e.property()],b.prototype,
"_cameraChanged",void 0);c.__decorate([e.property()],b.prototype,"cameraController",null);c=b=c.__decorate([w.subclass("esri.views.3d.state.ViewState")],b);const f=new g,t={camera:null},u={camera:null};return c});