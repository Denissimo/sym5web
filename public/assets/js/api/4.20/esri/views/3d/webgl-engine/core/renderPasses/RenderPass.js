// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray"],function(p,r,t,u){let w=function(){function m(d,c,e=0){this._rctx=d;this._techniqueRepository=c;this._sorting=e;this._draws=new u({initialSize:32,allocator:f=>f||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}
var g=m.prototype;g.submitDraw=function(d,c,e,f,b){const a=this._draws.pushNew();a.geometry=c;a.geometryRanges=e;a.material=d;a.bindDrawParams=f;a.depthSquaredHint=b;a.indexType=c.indexed?t.unwrap(c.vao.indexBuffer).indexType:0};g.dispatch=function(d){const c=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let e=null;const f=this._draws.length;for(let n=0;n<f;n++){var b=this._draws.data[n];const h=b.geometry;var a=b.material.getTechnique(this._techniqueRepository,
d,h.parameters);if(a!==e||3!==a.configuration.transparencyPassType)c.useProgram(a.program),c.setPipelineState(a.pipeline),e=a;this._passBoundTechniques.has(a)||(a.bindPass(d),this._passBoundTechniques.add(a));c.bindVAO(h.vao);this._previouslyBoundMaterials.get(a)!==b.material&&(a.bindMaterial(b.material,d),this._previouslyBoundMaterials.set(a,b.material));this._previouslyBoundDraw.get(a)!==b.bindDrawParams&&(a.bindDraw(b.bindDrawParams,b.material,d),this._previouslyBoundDraw.set(a,b.bindDrawParams));
a=b.geometryRanges;const q=a.length;if(0!==b.indexType){const v=k.get(b.indexType);for(let l=0;l<q;l+=2)c.drawElements(h.primitiveType,a[l+1],b.indexType,a[l]*v)}else for(b=0;b<q;b+=2)c.drawArrays(h.primitiveType,a[b],a[b+1])}};g.prepareSubmit=function(){this._draws.clear()};g.finishSubmit=function(){const d=0===this._sorting?1:-1;this._draws.sort((c,e)=>{const f=d*(c.depthSquaredHint-e.depthSquaredHint);return 0!==f?f:c.geometry.vao.size-e.geometry.vao.size})};r._createClass(m,[{key:"count",get:function(){return this._draws.length}}]);
return m}();const k=new Map;k.set(5121,1);k.set(5123,2);k.set(5125,4);p.RenderPass=w;Object.defineProperty(p,"__esModule",{value:!0})});