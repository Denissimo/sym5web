// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(u,x,r,y,v,z,A){function B(d,a,e,f=0){f=d[3]+f;const h=a[0]-d[0],c=a[1]-d[1];d=a[2]-d[2];a=e[0];const m=e[1];e=e[2];const k=a*h+m*c+e*d;return 0<=k*k-(a*a+m*m+e*e)*(h*h+c*c+d*d-f*f)}let G=function(){function d(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=
a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlane=a.slicePlaneEnabled;this.isGround=a.isGround}d.prototype.intersect=function(a,e,f,h){const c=a.results,m=2===a.options.store,k=a.ray.direction,n=a.tolerance;let w=b=>b,t=b=>b;const p=A.getVerticalOffsetI3S(a.verticalOffset);r.isSome(p)&&(w=b=>p.applyToMbs(b),t=b=>p.applyToObb(b));this.forEach((b,C)=>{if(r.isSome(b.geometryObb)){if(!v.intersectLine(t(b.geometryObb),f,k,n))return}else if(r.isSome(b.serviceObbInRenderSR)){if(!v.intersectLine(t(b.serviceObbInRenderSR),
f,k,n))return}else if(!B(w(b.renderMbs),f,k,n))return;this.collection.intersect(C,f,h,n,p,(D,l,E,F)=>{if(0<=l&&(null==e||e(f,h,l))){var q=g=>{g.intersector=this.type;g.target={type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:b.index,componentIndex:D}};g.dist=l;y.copy(g.normal,E);g.triangleNr=F};this.isGround&&(null==c.ground.dist||l<c.ground.dist)&&q(c.ground);if(!a.options.isFiltered&&((null==c.min.dist||l<c.min.dist)&&q(c.min),(null==c.max.dist||l>c.max.dist)&&
q(c.max),m)){const g=new z.IntersectorResult(a.ray);q(g);a.results.all.push(g)}}})})};x._createClass(d,[{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return d}();u.I3SIntersectionHandler=G;Object.defineProperty(u,"__esModule",{value:!0})});