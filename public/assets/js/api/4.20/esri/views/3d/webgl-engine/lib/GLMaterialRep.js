// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["../../../../core/Logger","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions","./Util"],function(h,k,g,l){const m=h.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let n=function(){function f(a){this.refCnt=0;this.glMaterial=a}var c=f.prototype;c.incRefCnt=function(){++this.refCnt};c.decRefCnt=function(){--this.refCnt;l.assert(0<=this.refCnt)};c.getRefCnt=function(){return this.refCnt};c.getGLMaterial=function(){return this.glMaterial};return f}();return function(){function f(a,
b,d){this._textureRep=a;this._techniqueRep=b;this.onMaterialChanged=d;this._id2glMaterialRef=new Map}var c=f.prototype;c.dispose=function(){this._textureRep.dispose()};c.acquire=function(a,b){this.ownMaterial(a);const d=g.getShaderOutputID(a.id,b);let e=this._id2glMaterialRef.get(d);if(null==e)return a=a.getGLMaterial({material:a,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:b}),e=new n(a),e.incRefCnt(),this._id2glMaterialRef.set(d,e),a;e.incRefCnt();return e.getGLMaterial()};
c.release=function(a,b){a=g.getShaderOutputID(a.id,b);b=this._id2glMaterialRef.get(a);b.decRefCnt();0===b.getRefCnt()&&((b=b.getGLMaterial())&&b.dispose(),this._id2glMaterialRef.delete(a))};c.materialChanged=function(a){for(const d of g.ShaderOutputTypes)if(5!==d.output&&6!==d.output){var b=this._id2glMaterialRef.get(g.getShaderOutputID(a.id,d.output));b&&b.getGLMaterial()&&(b=b.getGLMaterial(),b.updateParameters&&b.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(a)};c.ownMaterial=
function(a){k.isSome(a.materialRepository)&&a.materialRepository!==this&&m.error("Material is already owned by a different material repository");a.materialRepository=this};return f}()});