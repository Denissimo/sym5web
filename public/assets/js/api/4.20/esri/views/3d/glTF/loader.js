// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(w,p,q,z,A,x,B){function u(){u=p._asyncToGenerator(function*(f,a,d={},m=!0){const b=yield B.Resource.load(f,r,a,d),e=`gltf_${C++}`,g={lods:[],materials:new Map,textures:new Map,meta:D(b)};f=!(!b.json.asset.extras||"symbolResource"!==b.json.asset.extras.ESRI_type);yield E(b,function(){var l=p._asyncToGenerator(function*(c,
h,k,t){var n=void 0!==c.mode?c.mode:4;const y=4===n||5===n||6===n?n:null;q.isNone(y)?r.warnUnsupported("Unsupported primitive mode ("+F[n]+"). Skipping primitive."):b.hasPositions(c)?(n=yield b.getMaterial(c,d,m),h={transform:z.clone(h),attributes:{position:yield b.getPositionData(c,d),normal:null,texCoord0:null,color:null,tangent:null},indices:yield b.getIndexData(c,d),primitiveType:y,material:G(g,n,e)},b.hasNormals(c)&&(h.attributes.normal=yield b.getNormalData(c,d)),b.hasTangents(c)&&(h.attributes.tangent=
yield b.getTangentData(c,d)),b.hasTextureCoordinates(c)&&(h.attributes.texCoord0=yield b.getTextureCoordinates(c,d)),b.hasVertexColors(c)&&(h.attributes.color=yield b.getVertexColors(c,d)),c=null,q.isSome(g.meta)&&q.isSome(g.meta.ESRI_lod)&&"screenSpaceRadius"===g.meta.ESRI_lod.metric&&(c=g.meta.ESRI_lod.thresholds[k]),g.lods[k]=g.lods[k]||{parts:[],name:t,lodThreshold:c},g.lods[k].parts.push(h)):r.warn("Skipping primitive without POSITION vertex attribute.")});return function(c,h,k,t){return l.apply(this,
arguments)}}());return{model:g,meta:{isEsriSymbolResource:f,uri:b.uri},customMeta:{}}});return u.apply(this,arguments)}function D(f){let a=null;f.json.nodes.forEach(d=>{d=d.extras;q.isSome(d)&&(d.ESRI_proxyEllipsoid||d.ESRI_lod)&&(a=d)});return a}function E(f,a){return v.apply(this,arguments)}function v(){v=p._asyncToGenerator(function*(f,a){function d(l,c){return m.apply(this,arguments)}function m(){m=p._asyncToGenerator(function*(l,c){const h=b.nodes[l];l=f.getNodeTransform(l);r.warnUnsupportedIf(null!=
h.weights,"Morph targets are not supported.");if(null!=h.mesh){const k=b.meshes[h.mesh];for(const t of k.primitives)yield a(t,l,c,k.name)}for(const k of h.children||[])yield d(k,c)});return m.apply(this,arguments)}const b=f.json;var e=b.scenes[b.scene||0].nodes;const g=1<e.length;for(const l of e){e=b.nodes[l];const c=[d(l,0)];e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)&&!g&&c.push(...e.extensions.MSFT_lod.ids.map((h,k)=>d(h,k+1)));yield Promise.all(c)}});return v.apply(this,
arguments)}function G(f,a,d){const m=e=>{const g=`${d}_tex_${e&&e.id}${e&&e.name?"_"+e.name:""}`;if(e&&!f.textures.has(g)){const l=x.makeTextureSource(e.data,{wrap:{s:e.wrapS,t:e.wrapT},mipmap:H.some(c=>c===e.minFilter),noUnpackFlip:!0});f.textures.set(g,l)}return g},b=`${d}_mat_${a.id}_${a.name}`;f.materials.has(b)||(a=x.makeMaterialParameters({color:[a.color[0],a.color[1],a.color[2]],opacity:a.color[3],alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,colorMixMode:a.ESRI_externalColorMixMode,
textureColor:a.colorTexture?m(a.colorTexture):void 0,textureNormal:a.normalTexture?m(a.normalTexture):void 0,textureOcclusion:a.occlusionTexture?m(a.occlusionTexture):void 0,textureEmissive:a.emissiveTexture?m(a.emissiveTexture):void 0,textureMetallicRoughness:a.metallicRoughnessTexture?m(a.metallicRoughnessTexture):void 0,emissiveFactor:[a.emissiveFactor[0],a.emissiveFactor[1],a.emissiveFactor[2]],metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor}),f.materials.set(b,a));return b}
let C=0;const r=new A.DefaultErrorContext,H=[9987,9985],F="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");w.load=function(f,a){return u.apply(this,arguments)};Object.defineProperty(w,"__esModule",{value:!0})});