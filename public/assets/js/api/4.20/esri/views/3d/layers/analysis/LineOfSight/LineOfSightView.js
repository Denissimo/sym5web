// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Color ../../../../../core/Accessor ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/accessorSupport/trackingUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../interactive/visualElements/LineVisualElement".split(" "),
function(f,z,m,h,C,D,q,k,n,Q,R,S,T,E,A,F,r,c,t){f.LineOfSightView=function(B){function p(a){a=B.call(this,a)||this;a._handle=null;a._analysisHandles=new D;return a}z._inheritsLoose(p,B);var e=p.prototype;e.initialize=function(){this._handle=this._connectAnalyses()};e.destroy=function(){this._handle=k.removeMaybe(this._handle);this._analysisHandles=k.destroyMaybe(this._analysisHandles)};e.createLineOfSightVisualization=function(){var a=this._configuration;const b={view:this.view,attached:!0,width:a.outerWidth,
innerWidth:a.innerWidth},d=new t.LineVisualElement({...b,color:h.toUnitRGBA(a.visibleOuterColor),innerColor:h.toUnitRGBA(a.visibleInnerColor)}),u=new t.LineVisualElement({...b,color:h.toUnitRGBA(a.occludedOuterColor),innerColor:h.toUnitRGBA(a.occludedInnerColor)});a=new t.LineVisualElement({...b,color:h.toUnitRGBA(a.undefinedOuterColor),innerColor:h.toUnitRGBA(a.undefinedInnerColor)});return{visibleLineVisualElement:d,occludedLineVisualElement:u,undefinedLineVisualElement:a}};e.destroyLineOfSightVisualization=
function(a){a.visibleLineVisualElement=k.destroyMaybe(a.visibleLineVisualElement);a.occludedLineVisualElement=k.destroyMaybe(a.occludedLineVisualElement);a.undefinedLineVisualElement=k.destroyMaybe(a.undefinedLineVisualElement)};e.updateLineOfSightVisualization=function(a,b){const d=this._configuration,{computationResult:u,inputPoints:G}=a,{start:H,end:I,intersection:J,isValid:K,isTargetVisible:L}=u;var {observer:g}=G;a=M;a[12]=g[0];a[13]=g[1];a[14]=g[2];const v=r.subtract(N,H,g),w=r.subtract(O,I,
g);g=r.subtract(P,J,g);const {visibleLineVisualElement:l,occludedLineVisualElement:x,undefinedLineVisualElement:y}=b;l.geometry=null;x.geometry=null;y.geometry=null;K?L?(l.geometry=[[c.fromArray(v),c.fromArray(w)]],l.transform=a,l.color=h.toUnitRGBA(d.visibleOuterColor)):(l.geometry=[[c.fromArray(v),c.fromArray(g)]],l.transform=a,l.color=h.toUnitRGBA(d.occludedOuterColor),x.geometry=[[c.fromArray(g),c.fromArray(w)]],x.transform=a):(y.geometry=[[c.fromArray(v),c.fromArray(w)]],y.transform=a)};e.getLineOfSightVisualizationDependencies=
function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:d}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:d}};e._connectAnalysis=function(a){const b=this._analysisHandles;if(!b.has(a)){var d=this.createLineOfSightVisualization();b.add([A.reactionInit(()=>this.getLineOfSightVisualizationDependencies(a),()=>this.updateLineOfSightVisualization(a,d)),q.makeHandle(()=>this.destroyLineOfSightVisualization(d))])}};e._disconnectAnalysis=function(a){this._analysisHandles.remove(a)};
e._connectAnalyses=function(){let a=null;return q.handlesGroup([A.reactionInit(()=>this._analyses,b=>{a=k.removeMaybe(a);a=b.on("change",d=>this._onAnalysesCollectionChange(d));this._onAnalysesCollectionChange({target:b,added:b.items,removed:[],moved:[]})}),q.makeHandle(()=>a=k.removeMaybe(a))])};e._onAnalysesCollectionChange=function(a){a.added.forEach(b=>this._connectAnalysis(b));a.removed.forEach(b=>this._disconnectAnalysis(b))};z._createClass(p,[{key:"_analyses",get:function(){return this.layerViewData.analyses}},
{key:"_configuration",get:function(){return this.layerViewData.configuration}}]);return p}(C);m.__decorate([n.property({constructOnly:!0})],f.LineOfSightView.prototype,"layer",void 0);m.__decorate([n.property({constructOnly:!0})],f.LineOfSightView.prototype,"view",void 0);m.__decorate([n.property({constructOnly:!0})],f.LineOfSightView.prototype,"layerViewData",void 0);m.__decorate([n.property()],f.LineOfSightView.prototype,"_analyses",null);m.__decorate([n.property()],f.LineOfSightView.prototype,
"_configuration",null);f.LineOfSightView=m.__decorate([E.subclass("esri.views.3d.layers.analysis.LineOfSight.LineOfSightView")],f.LineOfSightView);const N=c.create(),O=c.create(),P=c.create(),M=F.create();Object.defineProperty(f,"__esModule",{value:!0})});