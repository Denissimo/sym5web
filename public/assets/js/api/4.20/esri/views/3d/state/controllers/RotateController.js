// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(k,t,p,A,u,B,v,I,J,K,C,q,D,E,w,c,g,F,G,x,H,m){k.RotateController=function(y){function n(a){a=y.call(this,a)||this;a.view=null;a.pivot=0;a.lastPoint=w.create();a.tmpWorldUp=g.create();a.tmpViewDir=g.create();a.tmpRotCurPoint=w.create();a.tmpTransf=D.create();a.tmpAxis=g.create();a.tmpPivotPoint=g.create();a.pivotPos=g.create();a.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return a}t._inheritsLoose(n,
y);var l=n.prototype;l.initialize=function(){this.rotScale=0===this.pivot?3:1.5};l.begin=function(a){if(this.active){switch(this.pivot){case 1:c.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||c.copy(this.pivotPos,this.startCamera.center),A("disable-feature:context-navigation")||this.constrainPivotPoint(a),
this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera;m.normalizeCoordinate(this.startCamera,a,this.lastPoint)}};l.constrainPivotPoint=function(a){const b=this.startCamera,d=g.create();c.subtract(d,this.pivotPos,b.eye);let f=c.length(d);this.view.camera.position.hasZ&&(f=Math.min(f,7*Math.abs(this.view.camera.position.z)));var h=F.getReferenceEllipsoid(this.view.spatialReference),
e=B.createScreenPointArray(b.width/b.pixelRatio*.5,b.height/b.pixelRatio*.5);h=m.decideNavigationMode(this.startCamera,e,!0,h);e=this.view._stage.renderView.getMinimalDepthForArea(b.fullWidth/b.pixelRatio*.5,b.fullHeight/b.pixelRatio*.5,b,225,90);a=this.view._stage.renderView.getMinimalDepthForArea(a[0],a[1],b,90);if(void 0!==e||void 0!==a)e=void 0===e?a:e,a=void 0===a||h===m.NavigationMode.Horizontal?e:a,f=e>a?a:e;c.normalize(d,d);c.copy(this.pivotPos,c.add(this.tmpPivotPoint,b.eye,c.scale(this.tmpPivotPoint,
d,f)))};l.update=function(a){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,a,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,a,this.currentCamera.eye,this.pivotPos)}G.applyAll(this.view,this.currentCamera,this.constraintOptions)}};l.end=function(){this.active&&this.finishController()};l.applyRotation=function(a,b,d,f){this.view.renderCoordsHelper.worldUpAtPosition(f,
this.tmpWorldUp);m.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let h=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;c.subtract(this.tmpViewDir,d,f);d=c.length(this.tmpViewDir);d=u.acosClamped(c.dot(this.tmpViewDir,this.tmpWorldUp)/d);if(1===this.pivot){const e=.5*Math.PI-d,z=.495*Math.PI;b=e-Math.max(-z,Math.min(z,e+-.5*b))}b=u.clamp(b+d,x.TiltDefault.min,x.TiltDefault.max)-d;q.identity(this.tmpTransf);c.cross(this.tmpAxis,a.up,
this.tmpViewDir);0===this.pivot&&(h=-h);q.rotate(this.tmpTransf,this.tmpTransf,h,this.tmpWorldUp);q.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);c.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);a.up=c.transformMat4(r,a.up,this.tmpTransf);c.add(r,f,this.tmpViewDir);E.copy(this.lastPoint,this.tmpRotCurPoint);return r};t._createClass(n,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return n}(H.InteractiveController);p.__decorate([v.property({constructOnly:!0})],
k.RotateController.prototype,"view",void 0);p.__decorate([v.property()],k.RotateController.prototype,"pivot",void 0);k.RotateController=p.__decorate([C.subclass("esri.views.3d.state.controllers.RotateController")],k.RotateController);const r=g.create();Object.defineProperty(k,"__esModule",{value:!0})});