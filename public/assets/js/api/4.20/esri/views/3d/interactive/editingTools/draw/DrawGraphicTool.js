// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Graphic ../../../../../core/has ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../layers/GraphicsLayer ../../../../../support/elevationInfoUtils ../settings ./DrawOperation ./drawSurfaces ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement ../../../layers/graphics/GraphicState ../../../../draw/support/createUtils ../../../../draw/support/surfaceCoordinateSystems ../../../../interactive/InteractiveToolBase".split(" "),
function(d,v,g,w,L,A,B,e,C,h,M,N,O,D,E,F,p,G,x,H,y,I,l,z,J){function K(q){switch(q){case "point":case "polyline":case "polygon":return q;case "circle":case "rectangle":return"segment";default:return null}}d.DrawGraphicTool=function(q){function u(a){a=q.call(this,a)||this;a.drawOperation=null;a._createGraphic=null;a._createGraphicState=null;a._outlineVisualElement=null;a._verticesVisualElement=null;a._activeVertexVisualElement=null;a.hasZ=!0;a.defaultZ=0;a.elevationInfo=null;a.snapToScene=!1;a.snappingManager=
null;a.mode=null;a.geometryType=null;a.type="draw-3d";return a}v._inheritsLoose(u,q);var c=u.prototype;c.initialize=function(){const a=e.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new E({elevationInfo:a,listMode:"hide",internal:!0});this.view.map.layers.add(this._internalGraphicsLayer);this.drawOperation=new G.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:K(this.geometryType),drawingMode:this.mode,
hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new x.SceneDrawSurface(this.view,a,[this._internalGraphicsLayer]),elevationDrawSurface:new x.ElevationDrawSurface(a,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:a,snappingManager:this.snappingManager});this.drawOperation.on("vertex-add",b=>this.onVertexAdd(b));this.drawOperation.on("vertex-remove",b=>this.onVertexRemove(b));this.drawOperation.on("vertex-update",b=>this.onVertexUpdate(b));
this.drawOperation.on("cursor-update",b=>this.onCursorUpdate(b));this.drawOperation.on("complete",b=>this.onComplete(b));this.complete()};c.destroy=function(){this.drawOperation.destroy();this.drawOperation=null;this._destroyAllVisualisations();this.view.map.remove(this._internalGraphicsLayer);this._set("view",null)};c.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};c._getCreateGeometry=function(a={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;
var b=this.drawOperation.stagedVertex,f=this.drawOperation.committedVertices;const k=f.slice();e.isSome(b)&&k.push(this.drawOperation.coordinateHelper.pointToArray(b));var n=e.isSome(b)?this.drawOperation.coordinateHelper.pointToArray(b):f.splice(-1)[0];b={regularVertices:null,activeVertex:null,full:null,outline:null};const m=k.length,r=this.drawOperation.spatialReference,t="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case "point":b.regularVertices=f;b.activeVertex=
n;b.full=this.drawOperation.coordinateHelper.createPointFromArray(k[0]);break;case "polyline":b.regularVertices=f;b.activeVertex=n;0<m&&(b.full=l.createPolyline([k],r,t));break;case "polygon":b.regularVertices=f;b.activeVertex=n;0<m&&(b.full=l.createPolygon([k],r,t,!0));break;case "circle":0<m&&(f=z.createViewAlignedCoordinateSystem(this.view,k[0]),1===m&&a.operationComplete?(a=k[0],n=f.makeMapPoint(a[0]+48*this.view.resolution,a[1]),b.full=l.createCircle([a,n],f,!0)):2===m&&(b.full=this.forceUniformSize?
l.createCircle(k,f,this.centered):l.createEllipse(k,f,this.centered)));break;case "rectangle":0<m&&(f=z.createViewAlignedCoordinateSystem(this.view,k[0]),1===m&&a.operationComplete?(a=k[0],n=f.makeMapPoint(a[0]+48*this.view.resolution,a[1]),b.full=l.createSquare([a,n],f,!0)):2===m&&(b.full=this.forceUniformSize?l.createSquare(k,f,this.centered):l.createRectangle(k,f,this.centered)));break;default:return null}switch(this.geometryType){case "polyline":1<m&&(b.outline=l.createPolyline([k],r,t));break;
case "polygon":1<m&&(b.outline=l.createPolyline([k],r,t));break;case "circle":case "rectangle":e.isSome(b.full)&&"polygon"===b.full.type&&(b.outline=l.createPolygon(b.full.rings,r,t))}return b};c._destroyAllVisualisations=function(){this._destroyCreateGraphic();this._destroyOutlineVisualElement();this._destroyVerticesVisualElement();this._destroyStagedVerticesVisualElement()};c._destroyCreateGraphic=function(){e.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),
this._createGraphic=e.destroyMaybe(this._createGraphic));this._createGraphicState=null;this.handles.remove("create-graphic")};c._destroyOutlineVisualElement=function(){this._outlineVisualElement=e.destroyMaybe(this._outlineVisualElement)};c._destroyVerticesVisualElement=function(){this._verticesVisualElement=e.destroyMaybe(this._verticesVisualElement)};c._destroyStagedVerticesVisualElement=function(){this._activeVertexVisualElement=e.destroyMaybe(this._activeVertexVisualElement)};c._updateCreateGraphic=
function(){const a=this._getCreateGeometry();if(e.isNone(a))this._destroyAllVisualisations();else{var b=this._internalGraphicsLayer.elevationInfo;e.isSome(a.outline)?e.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new H.OutlineVisualElement({view:this.view,geometry:a.outline,elevationInfo:b,isDraped:e.isSome(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===F.getEffectiveElevationMode(this.hasZ,b),attached:!1}),p.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),
p.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=a.outline:this._destroyOutlineVisualElement();e.isSome(a.regularVertices)?e.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new y.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a.regularVertices,elevationInfo:b,renderOccluded:p.settings.reshapeManipulators.vertex.renderOccluded,
attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=a.regularVertices:this._destroyVerticesVisualElement();e.isSome(a.activeVertex)?e.isNone(this._activeVertexVisualElement)?(this._activeVertexVisualElement=new y.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:[a.activeVertex],elevationInfo:b,renderOccluded:p.settings.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=p.settings.colorToVec4(p.settings.reshapeManipulators.selected.color),
this._activeVertexVisualElement.attached=!0):this._activeVertexVisualElement.vertices=[a.activeVertex]:this._destroyStagedVerticesVisualElement();e.isSome(a.full)?e.isNone(this._createGraphic)?(this._createGraphic=new w({geometry:a.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new I.GraphicState({graphic:this._createGraphic}),
this.handles.add([this.view.trackGraphicState(this._createGraphicState),C.init(this._createGraphicState,"isDraped",f=>{e.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=f)})],"create-graphic"),this.notifyChange("createGraphic")):this._createGraphic.geometry=a.full:this._destroyCreateGraphic()}};c.reset=function(){};c.redo=function(){this.drawOperation.redo()};c.undo=function(){this.drawOperation.undo()};c.completeCreateOperation=function(){this.drawOperation.complete()};c.activate=
function(){};c.deactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()};c.getVertexCoords=function(){return this.drawOperation.vertices};c.onVertexAdd=function(a){this._updateCreateGraphic();this.emit("vertex-add",a)};c.onVertexRemove=function(a){this._updateCreateGraphic();this.emit("vertex-remove",a)};c.onVertexUpdate=function(a){this._updateCreateGraphic();this.emit("vertex-update",a)};c.onCursorUpdate=function(a){this._updateCreateGraphic();this.emit("cursor-update",
a)};c.onComplete=function(a){this._updateCreateGraphic();let b=null;if(this.drawOperation.isCompleted){const f=this._getCreateGeometry({operationComplete:!0});e.isSome(f)&&(b=new w({geometry:f.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:b,...a})};v._createClass(u,[{key:"updating",get:function(){var a,b;return null!=(a=null==(b=this.drawOperation)?void 0:b.updating)?a:!1}},{key:"createGraphic",get:function(){return this._createGraphic}},
{key:"enabled",set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)}},{key:"centered",set:function(a){this._set("centered",a);this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(a){this._set("forceUniformSize",a);this._updateCreateGraphic()}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}}]);return u}(B.HandleOwnerMixin(A.EventedMixin(J.InteractiveToolBase)));g.__decorate([h.property()],
d.DrawGraphicTool.prototype,"drawOperation",void 0);g.__decorate([h.property({readOnly:!0})],d.DrawGraphicTool.prototype,"updating",null);g.__decorate([h.property({constructOnly:!0,nonNullable:!0})],d.DrawGraphicTool.prototype,"view",void 0);g.__decorate([h.property()],d.DrawGraphicTool.prototype,"createGraphicSymbol",void 0);g.__decorate([h.property()],d.DrawGraphicTool.prototype,"createGraphic",null);g.__decorate([h.property({value:!0})],d.DrawGraphicTool.prototype,"enabled",null);g.__decorate([h.property({value:!0})],
d.DrawGraphicTool.prototype,"centered",null);g.__decorate([h.property({value:!0})],d.DrawGraphicTool.prototype,"forceUniformSize",null);g.__decorate([h.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"graphicProperties",void 0);g.__decorate([h.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"hasZ",void 0);g.__decorate([h.property({nonNullable:!0})],d.DrawGraphicTool.prototype,"defaultZ",void 0);g.__decorate([h.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"elevationInfo",
void 0);g.__decorate([h.property()],d.DrawGraphicTool.prototype,"snapToScene",void 0);g.__decorate([h.property()],d.DrawGraphicTool.prototype,"snappingManager",void 0);g.__decorate([h.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"mode",void 0);g.__decorate([h.property({constructOnly:!0})],d.DrawGraphicTool.prototype,"geometryType",void 0);g.__decorate([h.property({readOnly:!0})],d.DrawGraphicTool.prototype,"type",void 0);d.DrawGraphicTool=g.__decorate([D.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],
d.DrawGraphicTool);Object.defineProperty(d,"__esModule",{value:!0})});