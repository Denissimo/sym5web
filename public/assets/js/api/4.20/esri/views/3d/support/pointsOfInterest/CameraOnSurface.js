// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(b,h,c,m,r,d,y,z,A,B,t,k,n,p,u,v,w){const x=Array;b.CameraOnSurface=function(q){function g(a){a=q.call(this,a)||this;a._dirty=!1;a._propertiesPool=new v.PropertiesPool({location:p,renderLocation:x},h._assertThisInitialized(a));a._estimatedSurfaceAltitude=0;a._pendingElevationQueryController=null;a.cameraName="camera";a.renderLocation=n.create();a.tmpPoint=new p;return a}h._inheritsLoose(g,q);var e=g.prototype;e.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const a=()=>this._setDirty();this.handles.add(r.on(this.map,"ground.layers","change",a,a,a))}this._updateRenderLocation()};e.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};e.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};e._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};e._cancelPendingRequest=function(){const a=this._pendingElevationQueryController;
a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};e.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var a=m.createAbortController();this.map.ground.queryElevation(this.tmpPoint,{signal:a.signal,cache:this.cache}).then(f=>this._updateSurfaceAltitude(f.geometry.z)).catch(f=>{m.isAbortError(f)||
this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===a&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));a=null});this._pendingElevationQueryController=a}else this._updateSurfaceAltitude(0)};e._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};e._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(l,this._estimatedSurfaceAltitude,
this._camera.eye);k.exactEquals(this._get("renderLocation"),l)||this._set("renderLocation",k.copy(this._propertiesPool.get("renderLocation"),l))};h._createClass(g,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a}},{key:"scale",get:function(){const a=this._camera,f=k.distance(a.eye,this.renderLocation);return u.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,
state:{camera:a}},f,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return g}(w.PointOfInterest);c.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"cache",void 0);c.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,
"task",void 0);c.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([d.property({readOnly:!0})],b.CameraOnSurface.prototype,"location",null);c.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"map",void 0);c.__decorate([d.property({readOnly:!0})],b.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([d.property({readOnly:!0})],b.CameraOnSurface.prototype,"scale",null);c.__decorate([d.property({readOnly:!0})],
b.CameraOnSurface.prototype,"updating",null);b.CameraOnSurface=c.__decorate([t.subclass("esri.views.3d.support.CameraOnSurface")],b.CameraOnSurface);const l=n.create();b.default=b.CameraOnSurface;Object.defineProperty(b,"__esModule",{value:!0})});