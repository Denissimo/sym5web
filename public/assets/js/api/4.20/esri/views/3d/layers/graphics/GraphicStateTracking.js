// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(g,k,f,l){let m=function(){function h(a){this.graphicsCore=a;this.idToState=new Map;this.states=new Set;const b=a.owner.layer&&a.owner.layer.objectIdField;b?(this.getGraphicId=c=>l.getObjectId(c,b),this.getGraphics3DGraphicById=c=>this.graphicsCore.getGraphics3DGraphicByObjectId(c)):(this.getGraphicId=c=>c.uid,this.getGraphics3DGraphicById=c=>this.graphicsCore.getGraphics3DGraphicById(c))}
var d=h.prototype;d.destroy=function(){this.idToState.clear();this.states.forEach((a,b)=>this.remove(b))};d.add=function(a){const b={remove:()=>this.remove(a)};if(this.states.has(a))return b;const c=this.getGraphicId(a.graphic),e=this.getGraphics3DGraphicById(c);this.states.has(a)||this.states.add(a);this.ensureStateList(c).push(a);a.displaying=f.isSome(e)?e.isVisible():!1;a.isDraped=f.isSome(e)?e.isDraped:!1;a.tracking=!0;f.isSome(e)&&a.emit("changed",{});return b};d.remove=function(a){if(this.states.has(a)){if(this.idToState.size){const b=
this.getGraphicId(a.graphic),c=this.idToState.get(b);c&&(k.remove(c,a),0===c.length&&this.idToState.delete(b))}this.states.delete(a);a.tracking=!1;a.displaying=!1}};d.addGraphic=function(a){this.forEachState(a,b=>{b.displaying=a.isVisible();b.isDraped=a.isDraped;b.emit("changed",{})})};d.removeGraphic=function(a){this.forEachState(a,b=>{b.displaying=!1;b.isDraped=!1})};d.updateGraphicGeometry=function(a){this.forEachState(a,b=>{b.emit("changed",{})})};d.updateGraphicVisibility=function(a){this.forEachState(a,
b=>{b.displaying=a.isVisible()})};d.allGraphicsDeleted=function(){this.states.forEach(a=>{a.displaying=!1})};d.ensureStateList=function(a){var b=this.idToState.get(a);if(b)return b;b=[];this.idToState.set(a,b);return b};d.forEachState=function(a,b){0!==this.states.size&&0!==this.idToState.size&&(a=this.getGraphicId(a.graphic),a=this.idToState.get(a),null!=a&&a.forEach(b))};return h}();g.GraphicStateTracking=m;Object.defineProperty(g,"__esModule",{value:!0})});