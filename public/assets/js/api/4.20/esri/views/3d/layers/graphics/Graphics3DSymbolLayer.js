// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),function(m,u,x,q,y,v,h,z,A,r,B,C,t,D,E){function n(k,l){k=null!=k?l.attributes[k]:0;return null!=k&&isFinite(k)?k:0}const p=y.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
q=function(k){function l(a,b,c,f){var e=k.call(this,c.schedule)||this;e._context=c;e._elevationInfoOverride=null;e.complexity=null;e.logger=p;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.symbol=a;e.symbolLayer=b;e._renderPriority=f.renderPriority;e._renderPriorityStep=f.renderPriorityStep;e._elevationContext=new B.ElevationContext;e.complexity=e.computeComplexity();e._updateDrivenProperties(f.ignoreDrivers);e._updateElevationContext();return e}u._inheritsLoose(l,k);var d=
l.prototype;d.getCachedSize=function(){return null};d._logGeometryCreationWarnings=function(a,b,c,f){const e="polygons"in a?a.polygons:null;f=`${f} geometry failed to be created`;let g=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?g=`${f} (no ${c} were defined)`:Array.isArray(b)&&Array.isArray(b[0])?e&&0===e.length&&"rings"===c&&0<b.length&&2<b[0].length&&(g=`${f} (filled rings should use clockwise winding - try reversing the order of vertices)`):g=`${f} (${c} should be defined as a 2D array)`:
g=`${f} (failed to project geometry to view spatial reference)`;g&&p.warnOncePerTick(g)};d._validateGeometry=function(a,b=null,c=null){return h.isSome(b)&&!b.includes(a.type)?(this.logger.warn("unsupported geometry type for "+c+` symbol: ${a.type}`),!1):"point"!==a.type||v.isFinite(a.x)&&v.isFinite(a.y)?!0:(p.warn("point coordinate is not a valid number, graphic skipped"),!1)};d._defaultElevationInfoNoZ=function(){return F};d._defaultElevationInfoZ=function(){return G};d._updateElevationContext=function(){h.isSome(this._elevationInfoOverride)?
(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};d.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};
d.getGeometryElevationMode=function(a,b=this.getDefaultElevationInfo(a)){return this._elevationContext.mode||b.mode};d.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};d.setGraphicElevationContext=function(a,b){var c=h.unwrap(a.geometry);const f=this.getDefaultElevationInfo(c);b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:f.unit;b.mode=this.getGeometryElevationMode(c,f);b.offsetMeters=h.unwrapOr(this._elevationContext.meterUnitOffset,
h.unwrapOr(f.offset,0));if(c=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode="relative-to-ground",b.offsetMeters=0;b.updateFeatureExpressionInfoContext(c?C.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};d.prepareSymbolLayerPatch=function(a){};d.updateGeometry=function(a,b){return!1};d.onRemoveGraphic=function(a){};d._updateDrivenProperties=function(a){const b={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&
"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(c=>{switch(c.type){case "color":b.color=!0;if(c.stops)for(let f=0;f<c.stops.length;f++){const e=c.stops[f].color;e&&(b.opacity=!0,1>e.a&&(b.opacityAlwaysOpaque=!1))}break;case "opacity":b.opacity=!0;b.opacityAlwaysOpaque=!1;break;case "size":b.size=!0}});this._drivenProperties=b};d._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const a=this._context.layer.opacity;
return null==a?1:a};d._getCombinedOpacity=function(a,b=w){let c=1;this.draped||(c*=this._getLayerOpacity());if(this._drivenProperties.opacity)return c;h.isSome(a)?c*=a.a:b.hasIntrinsicColor||(c=0);return c};d._getCombinedOpacityAndColor=function(a,b=w){b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return t.mixinColorAndOpacity(null,b);a=h.isSome(a)?x.toUnitRGB(a):z.ONES;return t.mixinColorAndOpacity(a,b)};d._getVertexOpacityAndColor=function(a,b=null){a=t.mixinColorAndOpacity(this._drivenProperties.color?
a.color:null,this._drivenProperties.opacity?a.opacity:null);h.isSome(b)&&(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b);return a};d.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};d.computeComplexity=function(){return E.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};d.destroy=function(){this.abortLoad()};d.globalPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return a=this._elevationContext.mode,
this._updateElevationContext(),this.layerElevationInfoChanged(b,c,a)===r.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,c);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};d.updateGraphics3DGraphicElevationInfo=function(a,b,c){let f=r.SymbolUpdateType.UPDATE;a.forEach(e=>{const g=b(e);h.isSome(g)?(this.setGraphicElevationContext(e.graphic,g.elevationContext),
g.needsElevationUpdates=c(g.elevationContext.mode)):f=r.SymbolUpdateType.RECREATE});return f};d.applyRendererDiff=function(a,b){return!1};d.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;const b=this._fastUpdates.visualVariables,c=b.size?n(b.size.field,a):0,f=b.color?n(b.color.field,a):0;a=b.opacity?n(b.opacity.field,a):0;return A.fromValues(c,f,a,0)};d.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&p.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};u._createClass(l,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return l}(D.Loadable);const F={mode:"on-the-ground",offset:0,unit:"meters"},G={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1};m.Graphics3DSymbolLayer=q;m.default=q;m.getAttributeValue=n;Object.defineProperty(m,"__esModule",
{value:!0})});