// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ./intersectionUtils".split(" "),function(q,F,v,G,w,d,m,x,H,r,I,y,l,z,J){const A=.5*Math.PI,K=A/
Math.PI*180;let E=function(){function B(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:m.create(),direction:m.create()};for(a=0;4>a;a++)this.extent[a]={origin:m.create(),direction:m.create(),cap:{next:null,direction:m.create()}},this.planes[a]=l.create();this.planes[4]=l.create();this.planes[5]=l.create();this.planesWithoutFar=this.planes.slice(0,5)}var n=B.prototype;n.update=function(a,b,c,e=!0){const k=this.extent;this.toRenderBoundingExtent(a,
b,c);d.add(this.center.origin,k[0].origin,k[2].origin);d.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||d.scale(this.center.direction,this.center.direction,-1);for(c=0;4>c;c++){const g=k[c];this.renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);const p=k[3===c?0:c+1];g.cap.next=p.origin;d.direction(g.cap.direction,g.origin,p.origin);l.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this.planes[c]);
e||d.scale(g.direction,g.direction,-1)}l.fromVectorsAndPoint(k[0].cap.direction,k[1].cap.direction,k[0].origin,this.planes[4]);e?l.negate(this.planes[4],this.planes[5]):(l.copy(this.planes[4],this.planes[5]),l.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b;this.minGlobalAltitude=.9*H.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};n.isVisibleInFrustum=function(a,b,c=!1){if(null==a)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>
(this.maxSpanSpatialReference.isGeographic?K:A*b))return!0;if(a.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan)return b=this.extent[0],!c&&a.intersectsRay(z.wrap(b.origin,b.direction))?!0:!1;for(b=0;b<this.extent.length;b++){var e=this.extent[b];if(!c&&a.intersectsRay(z.wrap(e.origin,e.direction))||a.intersectsLineSegment(y.fromPoints(e.origin,e.cap.next,L),e.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(b=0;b<a.lines.length;b++)if(e=
a.lines[b],J.frustumLineSegment(c,e.origin,e.endpoint,e.direction))return!0;return!1};n.toRenderBoundingExtentGlobal=function(a,b,c){I.center(a,h);h[2]=c;x.computeLinearTransformation(b,h,t,this.renderCoordsHelper.spatialReference);G.invert(C,t);r.empty(f);for(const {x0:e,x1:k,y0:g,y1:p}of M)for(let u=0;5>u;u++){const D=u/4;h[0]=v.lerp(a[e],a[k],D);h[1]=v.lerp(a[g],a[p],D);h[2]=c;x.projectVectorToVector(h,b,h,this.renderCoordsHelper.spatialReference);d.transformMat4(h,h,C);r.expandWithVec3(f,h)}d.set(this.extent[0].origin,
f[0],f[1],f[2]);d.set(this.extent[1].origin,f[3],f[1],f[2]);d.set(this.extent[2].origin,f[3],f[4],f[2]);d.set(this.extent[3].origin,f[0],f[4],f[2]);for(a=0;4>a;++a)d.transformMat4(this.extent[a].origin,this.extent[a].origin,t)};n.toRenderBoundingExtentLocal=function(a,b){d.set(this.extent[0].origin,a[0],a[1],b);d.set(this.extent[1].origin,a[2],a[1],b);d.set(this.extent[2].origin,a[2],a[3],b);d.set(this.extent[3].origin,a[0],a[3],b)};n.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(a,
b,c);break;case 2:this.toRenderBoundingExtentLocal(a,c);break;default:F.neverReached(this.renderCoordsHelper.viewingMode)}};n.isVisibleInFrustumGlobal=function(a){if(0>d.dot(this.center.direction,a.direction))return!0;for(let b=0;4>b;b++)if(0>d.dot(this.extent[b].direction,a.direction))return!0;return!1};return B}();const M=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],h=m.create(),t=w.create(),C=w.create(),f=r.create(),L=y.create();q.FrustumExtentIntersection=
E;q.default=E;Object.defineProperty(q,"__esModule",{value:!0})});