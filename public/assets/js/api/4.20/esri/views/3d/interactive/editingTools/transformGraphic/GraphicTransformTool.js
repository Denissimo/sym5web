// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../support/elevationInfoUtils ../../Manipulator3D ../../manipulatorUtils ../../SnappingDragPipelineStep ../../SnappingVisualizer3D ../manipulatorUtils ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ./GraphicScaleRotateTransform ./ScaleRotateMeshAdapter ./ScaleRotateObjectSymbol3DAdapter ./undoRecords ../../../layers/graphics/GraphicState ../../../../interactive/InteractiveToolBase ../../../../interactive/editGeometry/EditGeometryHelper ../../../../interactive/snapping/SnappingContext".split(" "),
function(d,p,f,v,w,x,e,g,O,P,Q,R,y,z,q,A,B,C,D,r,E,F,t,G,H,I,J,K,L,M,N){d.GraphicTransformTool=function(u){function l(a){a=u.call(this,a)||this;a.enableZ=!0;a.enableRotation=!0;a.enableScaling=!0;a.type="transform-3d";a.scaleRotate=null;a.snappingPipeline=new C.SnappingPipeline;return a}p._inheritsLoose(l,u);var c=l.prototype;c.initialize=function(){this.graphicState=new K.GraphicState({graphic:this.graphic});this.moveManipulation=new t.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,
xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&r.canMoveZ(this.graphic),radius:t.MoveManipulation.radiusForSymbol(this.graphic.symbol)});this.moveManipulation.forEachManipulator(b=>this.handles.add(b.events.on("immediate-click",h=>{this.emit("immediate-click",{...h,graphic:this.graphicState.graphic});h.stopPropagation()})));this.moveManipulation.elevationInfo=q.getGraphicEffectiveElevationInfo(this.graphic);const a=this.graphic.geometry;this.moveManipulation.createGraphicDragPipeline((b,
h,k,m,n)=>{e.isSome(a)&&0===b&&(k=k.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new N.SnappingContext({elevationInfo:q.getGraphicEffectiveElevationInfo(this.graphic),pointer:n,geometry:M.EditGeometryHelper.fromGeometry(new z({spatialReference:a.spatialReference}),this.view.viewingMode),visualizer:new D.SnappingVisualizer3D,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:m}),this.snappingPipeline.next));
return k},this.graphicState,b=>{const {action:h,graphic:k,dxScreen:m,dyScreen:n}=b;b={graphic:k,dxScreen:m,dyScreen:n};switch(h){case "start":this.emit("graphic-translate-start",b);this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case "update":this.emit("graphic-translate",b);break;case "end":this.emit("graphic-translate-stop",b)}});this.moveManipulation.angle=e.isSome(this.scaleRotate)?this.scaleRotate.angle:0;this.scaleRotateAdapter=this.createScaleRotateAdapter();this.handles.add(this.scaleRotateAdapter.watch("angle",
()=>this.updateMoveAngle()));if(this.enableScaling||this.enableRotation)this.scaleRotate=new G.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this.onScaleChanged()));this.handles.add([E.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:b=>this.forEachManipulator(b),onManipulatorsChanged:()=>x.makeHandle()}),
this.graphicState.on("changed",()=>this.onGeometryChanged()),this.hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this.updateMoveAngle())]);this.handles.add(this.view.trackGraphicState(this.graphicState));this.onGeometryChanged();this.updateMoveAngle();this.forEachManipulator(b=>{b instanceof A.Manipulator3D&&this.handles.add(b.events.on("grab-changed",()=>this.updateManipulatorsInteractive()))});this.complete()};c.updateManipulatorsInteractive=function(){e.isNone(this.scaleRotate)||
(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)};c.createScaleRotateAdapter=function(){return e.isSome(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new H.ScaleRotateMeshAdapter({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new I.ScaleRotateObjectSymbol3DAdapter({graphic:this.graphic,sizeFilter:a=>this.enforceNonZeroSize(a),findLayerView:()=>this.view.allLayerViews.find(a=>
a.layer===this.graphic.layer)})};c.forEachManipulator=function(a){this.moveManipulation.forEachManipulator(a);e.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(a)};c.hideManipulatorsForGraphicState=function(){return this.graphicState.watch("displaying",a=>{this.forEachManipulator(b=>b.available=a);this.moveManipulation.zManipulation.available=a&&this.enableZ&&r.canMoveZ(this.graphic)})};c.createGeometryUndoRecord=function(){return J.createGraphicGeometryUndoRecord(this.graphic)};c.destroy=
function(){this.moveManipulation.destroy();this.scaleRotate=e.destroyMaybe(this.scaleRotate);this.scaleRotateAdapter=e.destroyMaybe(this.scaleRotateAdapter);this._set("view",null);this._set("graphic",null)};c.reset=function(){};c.onDetach=function(){e.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};c.onHide=function(){e.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};c.onScaleChanged=function(){if(!e.isNone(this.scaleRotate)){var a=this.scaleRotate.getScale();
this.moveManipulation.displayScale=a}};c.updateMoveAngle=function(){this.moveManipulation.angle="local"===this.view.viewingMode||this.view.scale<F.ALIGN_ARROWS_SCALE_THRESHOLD?this.scaleRotateAdapter.angle:0};c.onGeometryChanged=function(){B.placeAtGraphic(this.view,this,this.graphic)};c.enforceNonZeroSize=function(a){return a||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)};p._createClass(l,[{key:"snapToScene",set:function(a){this.moveManipulation&&(this.moveManipulation.snapToScene=
a);this._set("snapToScene",a)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(a){this.moveManipulation.location=a;e.isSome(this.scaleRotate)&&(this.scaleRotate.location=a)}},{key:"elevationAlignedLocation",set:function(a){this.moveManipulation.elevationAlignedLocation=a;e.isSome(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=a)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,
zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:e.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]);return l}(w.HandleOwnerMixin(v.EventedMixin(L.InteractiveToolBase)));f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,"view",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,
"graphic",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,"enableZ",void 0);f.__decorate([g.property()],d.GraphicTransformTool.prototype,"enableRotation",void 0);f.__decorate([g.property()],d.GraphicTransformTool.prototype,"enableScaling",void 0);f.__decorate([g.property({value:!1})],d.GraphicTransformTool.prototype,"snapToScene",null);f.__decorate([g.property({constructOnly:!0})],d.GraphicTransformTool.prototype,"snappingManager",void 0);f.__decorate([g.property({readOnly:!0})],
d.GraphicTransformTool.prototype,"type",void 0);f.__decorate([g.property({readOnly:!0})],d.GraphicTransformTool.prototype,"updating",null);d.GraphicTransformTool=f.__decorate([y.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],d.GraphicTransformTool);Object.defineProperty(d,"__esModule",{value:!0})});