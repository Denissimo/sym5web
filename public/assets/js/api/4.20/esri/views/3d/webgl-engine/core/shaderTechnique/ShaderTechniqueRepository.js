// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(m,l,n){let q=function(g){this.technique=g;this.refZeroFrame=this.refCount=0},u=function(){function g(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}var f=g.prototype;f.dispose=function(){this._perConstructorInstances.forEach(a=>a.forEach(c=>c.technique.dispose()));this._perConstructorInstances.clear()};f.acquire=function(a,c){const b=
c.key;let d=this._perConstructorInstances.get(a);d||(d=new Map,this._perConstructorInstances.set(a,d));let e=d.get(b);if(void 0===e){const h=new a(this._context,c,()=>this.release(h));e=new q(h);d.set(b,e)}++e.refCount;return e.technique};f.releaseAndAcquire=function(a,c,b){if(n.isSome(b)){if(c.key===b.key)return b;b.release()}return this.acquire(a,c)};f.release=function(a){n.isNone(a)||(a=this._perConstructorInstances.get(a.constructor).get(a.key),--a.refCount,0===a.refCount&&(a.refZeroFrame=this._frameCounter))};
f.frameUpdate=function(){this._frameCounter++;this._perConstructorInstances.forEach((a,c)=>{a.forEach((b,d)=>{0===b.refCount&&b.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(b.technique.dispose(),a.delete(d))});0===a.size&&this._perConstructorInstances.delete(c)})};f.hotReload=function(){var a=l._asyncToGenerator(function*(){var c=this;const b=[];this._perConstructorInstances.forEach((d,e)=>{const h=function(){var t=l._asyncToGenerator(function*(p,k){if(k=k.shader)yield k.reload(),p.forEach(r=>
{r.technique.reload(c._context)})});return function(p,k){return t.apply(this,arguments)}}();b.push(h(d,e))});yield Promise.all(b)});return function(){return a.apply(this,arguments)}}();l._createClass(g,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return g}();m.ShaderTechniqueRepository=u;Object.defineProperty(m,"__esModule",{value:!0})});