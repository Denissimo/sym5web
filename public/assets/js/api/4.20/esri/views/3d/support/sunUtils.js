// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/SunCalc".split(" "),function(v,y,z,P,t,w,u){function K(g,e,f,b){b||(b=w.create());const d=Q,a=z.identity(R);if("global"===f)u.SunCalc.getPosition(g,0,0,d),t.set(b,0,0,-1),z.rotateX(a,a,-d.azimuth),z.rotateY(a,a,-d.altitude);else{var h=q.planarDirection;f=h.globalAngles;h=(Math.abs(e[2])-h.localAltitude)/(h.globalAltitude-h.localAltitude);h=y.clamp(h,0,1);
1>h?(u.SunCalc.getPosition(g,e[1],e[0],d),d.azimuth=(1-h)*d.azimuth+h*f.azimuth,d.altitude=(1-h)*d.altitude+h*f.altitude):(d.azimuth=f.azimuth,d.altitude=f.altitude);t.set(b,0,-1,0);z.rotateZ(a,a,-d.azimuth);z.rotateX(a,a,-d.altitude)}t.transformMat4(b,b,a);return b}function k(g,e,f,b){const d=[];for(let a=0;a<f.length;a++)d[a]=(b[a]-f[a])*g/e+f[a];return d}const q={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,
ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},R=P.create(),Q={azimuth:0,altitude:0},l={ambient:{color:w.create(),intensity:0},diffuse:{color:w.create(),intensity:0,directionToLightSource:w.create()},globalFactor:0,noonFactor:0},L=new Date(0);v.computeColorAndIntensity=function(g,e){var f=e[2];t.set(l.ambient.color,1,1,1);l.ambient.intensity=q.global.ambient;t.set(l.diffuse.color,1,1,1);l.diffuse.intensity=q.global.diffuse;
f=(Math.abs(f)-q.local.altitude)/(q.global.altitude-q.local.altitude);f=y.clamp(f,0,1);l.globalFactor=f;e=u.SunCalc.getTimes(g,e[1],e[0]);if(1>f){{var b=g.valueOf();if(e.polarException===u.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var d=b-36E5*(g.getHours()+48)-6E4*g.getMinutes();var a=d+432E6}else e.polarException===u.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(d=b-2,a=b-1):(d=e.sunrise.valueOf(),a=e.sunset.valueOf());var h=a-d;var n=d+h/2;var m=h/4;var r=n-m;m=n+m;var c=.06*h;h=d-c/2;d+=c/2;const x=a-c/2,
G=a+c/2;a=q.local;const H=[.01,a.ambientAtNight],I=[.8,.8,1],J=[.01,.01,.01],A=[a.diffuseAtTwilight,a.ambientAtTwilight],B=[1,.75,.75],C=[.8,.8,1],D=[.9*a.diffuseAtNoon,a.ambientAtNoon],E=[1,.98,.98],F=[.98,.98,1],M=[a.diffuseAtNoon,a.ambientAtNoon],N=[1,1,1],O=[1,1,1];a=[0,0];let p=[0,0,0];c=[0,0,0];b<h||b>G?(a=H,p=J,c=I):b<d?(c=d-h,a=k(b-h,c,H,A),p=k(b-h,c,J,B),c=k(b-h,c,I,C)):b<r?(c=r-d,a=k(b-d,c,A,D),p=k(b-d,c,B,E),c=k(b-d,c,C,F)):b<n?(c=n-r,a=k(b-r,c,D,M),p=k(b-r,c,E,N),c=k(b-r,c,F,O)):b<m?(c=
m-n,a=k(b-n,c,M,D),p=k(b-n,c,N,E),c=k(b-n,c,O,F)):b<x?(c=x-m,a=k(b-m,c,D,A),p=k(b-m,c,E,B),c=k(b-m,c,F,C)):b<G&&(c=G-x,a=k(b-x,c,A,H),p=k(b-x,c,B,J),c=k(b-x,c,C,I));b=a[0];n=w.fromValues(p[0],p[1],p[2]);r=a[1];m=w.fromValues(c[0],c[1],c[2])}t.lerp(l.ambient.color,m,l.ambient.color,f);l.ambient.intensity=y.lerp(r,l.ambient.intensity,f);t.lerp(l.diffuse.color,n,l.diffuse.color,f);l.diffuse.intensity=y.lerp(b,l.diffuse.intensity,f)}f=g.valueOf();e.polarException===u.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?
(g=f-36E5*(g.getHours()+48)-6E4*g.getMinutes(),e=g+432E6):e.polarException===u.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(g=f-2,e=f-1):(g=e.sunrise.valueOf(),e=e.sunset.valueOf());g=1-y.clamp(Math.abs(f-(g+(e-g)/2))/432E5,0,1);l.noonFactor=g;return l};v.computeDirection=K;v.computeDirectionsOverTime=function(g,e,f,b,d){const a=d.length;if(1>a)return d;g=g.getTime();e=(e.getTime()-g)/a;for(let h=0;h<a;++h)L.setTime(g+e*h),K(L,f,b,d[h]);return d};v.computeShadowsEnabled=function(g,e){return"global"===e?!0:
Math.abs(g[2])<q.planarDirection.localAltitude};v.settings=q;Object.defineProperty(v,"__esModule",{value:!0})});