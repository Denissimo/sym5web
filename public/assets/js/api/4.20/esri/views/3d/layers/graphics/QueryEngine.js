// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(d,g,h,F,q,r,k,G,H,I,J,t,u,v,n,w,x){const y=v["default"];d.QueryEngine=function(p){function l(b){b=p.call(this,b)||this;b._dataQueryEngineInstance=null;return b}g._inheritsLoose(l,p);var e=l.prototype;e.destroy=function(){this.clear()};e.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};e.executeQueryForIdSet=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a),
c)});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForCount=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForExtent=function(){var b=g._asyncToGenerator(function*(a,c){const {count:f,extent:m}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),c);a=u.fromJSON(m);return{count:f,extent:a}});return function(a,
c){return b.apply(this,arguments)}}();e.executeQueryForIds=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForLatestObservations=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),c);a=n.fromJSON(a);a.features.forEach(f=>{f.layer=this.layer;f.sourceLayer=this.layer});
return a});return function(a,c){return b.apply(this,arguments)}}();e.executeQuery=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(a),c);a=n.fromJSON(a);a.features.forEach(f=>{f.layer=this.layer;f.sourceLayer=this.layer});return a});return function(a,c){return b.apply(this,arguments)}}();e._ensureQueryJSON=function(b){if(r.isNone(b))return this.defaultQueryJSON;"outSpatialReference"in b&&!b.outSpatialReference&&(b.outSpatialReference=
this.spatialReference);return b.toJSON()};e.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const b="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,a=this.layer.objectIdField,c=x.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),f=this.layer.fields.map(z=>z.toJSON()),m=this.layerView.view.resourceController.scheduler,A=this.priority,B=this.spatialReference.toJSON(),C=this.layerView.graphics3d.graphicsCore.featureStore,
{hasZ:D,hasM:E}=this.layerView;return this._dataQueryEngineInstance=new y({hasZ:D,hasM:E,geometryType:c,fields:f,timeInfo:b,spatialReference:B,objectIdField:a,featureStore:C,scheduler:m,priority:A})};g._createClass(l,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return l}(q);h.__decorate([k.property({constructOnly:!0})],d.QueryEngine.prototype,"layerView",void 0);h.__decorate([k.property({constructOnly:!0})],d.QueryEngine.prototype,"priority",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],d.QueryEngine.prototype,"spatialReference",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"layerView.layer"})],d.QueryEngine.prototype,"layer",
void 0);h.__decorate([k.property({readOnly:!0})],d.QueryEngine.prototype,"queryGeometryType",null);h.__decorate([k.property({readOnly:!0})],d.QueryEngine.prototype,"defaultQueryJSON",null);d.QueryEngine=h.__decorate([t.subclass("esri.views.3d.layers.graphics.QueryEngine")],d.QueryEngine);d.default=d.QueryEngine;Object.defineProperty(d,"__esModule",{value:!0})});