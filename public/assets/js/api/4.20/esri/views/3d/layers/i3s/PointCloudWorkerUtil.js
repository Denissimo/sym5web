// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(q,v,A,B,C,w,D){function y(a,c){const h=new Float64Array(c);for(let l=0;l<c;l++)h[l]=a[3*l+2];return h}function x(a){return null==a||"none"===a?null:"low-four-bit"===a?c=>c&15:"high-four-bit"===a?c=>(c&240)>>4:"absolute-value"===a?c=>Math.abs(c):"modulo-ten"===a?c=>
c%10:null}function z(a){let c=0;for(const h of a?a:[])c|=1<<h;return c}q.elevationFromPositions=y;q.evaluateRenderer=function(a,c,h,l){const {rendererJSON:m,isRGBRenderer:n}=a;var f=a=null;if(c&&n)a=c;else if(c&&"pointCloudUniqueValueRenderer"===m.type){f=C.fromJSON(m);var b=f.colorUniqueValueInfos;a=new Uint8Array(3*l);var g=x(f.fieldTransformType);for(var e=0;e<l;e++){var k=(g?g(c[e]):c[e])+"";for(var d=0;d<b.length;d++)if(0<=b[d].values.indexOf(k)){a[3*e]=b[d].color.r;a[3*e+1]=b[d].color.g;a[3*
e+2]=b[d].color.b;break}}}else if(c&&"pointCloudStretchRenderer"===m.type)for(f=B.fromJSON(m),b=f.stops,a=new Uint8Array(3*l),g=x(f.fieldTransformType),e=0;e<l;e++)if(k=g?g(c[e]):c[e],d=b.length-1,k<b[0].value)a[3*e]=b[0].color.r,a[3*e+1]=b[0].color.g,a[3*e+2]=b[0].color.b;else if(k>=b[d].value)a[3*e]=b[d].color.r,a[3*e+1]=b[d].color.g,a[3*e+2]=b[d].color.b;else for(d=1;d<b.length;d++){if(k<b[d].value){k=(k-b[d-1].value)/(b[d].value-b[d-1].value);a[3*e]=b[d].color.r*k+b[d-1].color.r*(1-k);a[3*e+1]=
b[d].color.g*k+b[d-1].color.g*(1-k);a[3*e+2]=b[d].color.b*k+b[d-1].color.b*(1-k);break}}else if(c&&"pointCloudClassBreaksRenderer"===m.type)for(f=A.fromJSON(m),b=f.colorClassBreakInfos,a=new Uint8Array(3*l),g=x(f.fieldTransformType),e=0;e<l;e++)for(k=g?g(c[e]):c[e],d=0;d<b.length;d++){if(k>=b[d].minValue&&k<=b[d].maxValue){a[3*e]=b[d].color.r;a[3*e+1]=b[d].color.g;a[3*e+2]=b[d].color.b;break}}else for(a=new Uint8Array(3*l),c=0;c<a.length;c++)a[c]=255;if(h&&f&&f.colorModulation)for(c=f.colorModulation.minValue,
f=f.colorModulation.maxValue,b=0;b<l;b++)g=h[b],g=g>=f?1:g<=c?.3:.3+.7*(g-c)/(f-c),a[3*b]*=g,a[3*b+1]*=g,a[3*b+2]*=g;return a};q.filterInPlace=function(a,c,h,l,m){const n=a.length/3;let f=0;for(let p=0;p<n;p++){let r=!0;for(let t=0;t<l.length&&r;t++){var {filterJSON:b}=l[t],g=m[t].values[p];switch(b.type){case "pointCloudValueFilter":var e="exclude"===b.mode;-1!==b.values.indexOf(g)===e&&(r=!1);break;case "pointCloudBitfieldFilter":e=z(b.requiredSetBits);b=z(b.requiredClearBits);if((g&e)!==e||0!==
(g&b))r=!1;break;case "pointCloudReturnFilter":var k=g&15,d=g>>>4&15;g=1<d;e=1===k;k=k===d;d=!1;for(const u of b.includedReturns)if("last"===u&&k||"firstOfMany"===u&&e&&g||"lastOfMany"===u&&k&&g||"single"===u&&!g){d=!0;break}d||(r=!1)}}r&&(h[f]=p,a[3*f]=a[3*p],a[3*f+1]=a[3*p+1],a[3*f+2]=a[3*p+2],c[3*f]=c[3*p],c[3*f+1]=c[3*p+1],c[3*f+2]=c[3*p+2],f++)}return f};q.getAttributeValues=function(a,c,h){return v.isSome(a)&&a.attributeInfo.useElevation?y(c,h):v.isSome(a)?w.readBinaryAttribute(a.attributeInfo.storageInfo,
a.buffer,h):null};q.readGeometry=function(a,c){if(null==a.encoding||""===a.encoding){a=w.createGeometryIndexFromSchema(c,a);if(v.isNone(a.vertexAttributes.position))return;c=w.createTypedView(c,a.vertexAttributes.position);var h=a.header.fields;a=[h.offsetX,h.offsetY,h.offsetZ];h=[h.scaleX,h.scaleY,h.scaleZ];const l=c.length/3,m=new Float64Array(3*l);for(let n=0;n<l;n++)m[3*n]=c[3*n]*h[0]+a[0],m[3*n+1]=c[3*n+1]*h[1]+a[1],m[3*n+2]=c[3*n+2]*h[2]+a[2];return m}if("lepcc-xyz"===a.encoding)return D.decodeXYZ(c).result};
Object.defineProperty(q,"__esModule",{value:!0})});