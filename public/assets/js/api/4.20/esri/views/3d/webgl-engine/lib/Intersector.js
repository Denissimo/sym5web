// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),function(B,F,u,h,G,v,k,C,H,D,w,I){u=function(){function x(a){this.options=new H.IntersectorOptions;this.results=new D.IntersectorResults;this.transform=new w.IntersectorTransform;
this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:k.create(),direction:k.create()};this._rayEndPoint=k.create();this._rayStartPointTransformed=k.create();this._rayEndPointTransformed=k.create();this.viewingMode=null==a?1:a}var l=x.prototype;l.reset=function(a,b){this.resetWithRay(C.fromPoints(a,b,this._ray))};l.resetWithRay=function(a){a!==this._ray&&C.copy(a,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=
this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;v.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};l.intersect=function(a=null,b,y,m,n,f){this.point=b;this.camera=y;this.filterPredicate=n;this.tolerance=null==m?1E-5:m;b=w.getVerticalOffsetObject3D(this.verticalOffset);if(h.isSome(a)&&0<a.length){const e=f?c=>{f(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of a)a=
c.getSpatialQueryAccelerator&&c.getSpatialQueryAccelerator(),h.isSome(a)?(h.isSome(b)?a.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,e,b):a.forEachAlongRay(this._ray.origin,this._ray.direction,e),this.options.selectionMode&&this.options.hud&&a.forEachDegenerateObject(e)):c.objects.forAll(z=>e(z))}this.sortResults()};l.intersectObject=function(a){this._numObjectsTested++;const b=a.geometryRecords;if(b){var y=a.id,m=a.transformation,n=w.getVerticalOffsetObject3D(this.verticalOffset);
for(const e of b){const {geometry:c,material:z,instanceParameters:E}=e;if(I.isInstanceHidden(E))continue;var f=c.id;this.transform.setAndInvalidateLazyTransforms(m,e.getShaderTransformation());v.transformMat4(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse);v.transformMat4(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const A=this.transform.transform;h.isSome(n)&&(n.objectTransform=this.transform);z.intersect(c,E,this.transform.transform,this,this._rayStartPointTransformed,
this._rayEndPointTransformed,(d,p,q,g,r,J)=>{if(0<=d&&(!h.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEndPoint,d))){var t=`Object3D ${y}`;r?(null==this.results.hud.dist||d<this.results.hud.dist)&&this.results.hud.set(a,t,d,p,G.IDENTITY,g,J,f,q):((null==this.results.min.drapedLayerOrder||g>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||d<this.results.min.dist)&&this.results.min.set(a,t,d,p,A,g,null,f,q),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||
g<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||d>this.results.max.dist)&&this.results.max.set(a,t,d,p,A,g,null,f,q),2===this.options.store&&(r=new D.IntersectorResult(this._ray),r.set(a,t,d,p,A,g,null,f,q),this.results.all.push(r)))}},e.shaderTransformation)}}};l.sortResults=function(){this.results.all.sort((a,b)=>a.dist!==b.dist?a.dist-b.dist:a.drapedLayerOrder!==b.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==b.drapedLayerOrder?
b.drapedLayerOrder:Number.MAX_VALUE):(void 0!==b.drapedLayerGraphicOrder?b.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE))};F._createClass(x,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}}]);return x}();u.DEFAULT_TOLERANCE=1E-5;B.Intersector=u;Object.defineProperty(B,"__esModule",{value:!0})});