// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils".split(" "),function(w,y,n,v,x,q,B,C,D){function z(t){return t.isVisible?t.params.transparent?1:2:0}let A=function(){function t(a,b,c,f,h,d,k,l=null){this.graphics3DSymbolLayer=a;this.stageObject=b;this._uniqueGeometries=c;this._uniqueMaterials=f;this._uniqueTextures=
h;this.elevationAligner=d;this.elevationContext=k;this._edgeState=l;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.stageObject=b}var g=t.prototype;g.initialize=function(a,b){this.stageLayer=b;this.stage=a;a.addMany(this._uniqueMaterials);a.addMany(this._uniqueGeometries);a.addMany(this._uniqueTextures);a.add(this.stageObject)};
g.destroy=function(){var a=this.stage;this.stageLayer&&(a.removeMany(this._uniqueMaterials),a.removeMany(this._uniqueGeometries),a.removeMany(this._uniqueTextures));a.remove(this.stageObject);this._addedToStage&&(this.stageLayer.remove(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};g.layerOpacityChanged=function(a,b){if(!n.isNone(this._edgeState)){var c=
z(this._edgeState.baseMaterial),f=!1;for(const h of this._edgeState.edgeMaterials)h.objectTransparency!==c&&(h.objectTransparency=c,f=!0);f&&this.resetEdgeObject(b);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};g.slicePlaneEnabledChanged=function(a,b){n.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:a},!b),this._edgeState.properties.slicePlaneEnabled=
a)};g.setVisibility=function(a){if(null!=this.stage&&this._visible!==a&&((this._visible=a)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),n.isSome(this._edgeState))){const b=this.stage.renderView.ensureEdgeView();b.hasObject(this.stageObject)?b.updateObjectVisibility(this.stageObject,a):a&&this.addOrUpdateEdgeObject(b,!1)}};g.alignWithElevation=function(a,b,c,f){null!=this.elevationAligner&&(n.isSome(c)&&
C.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(f))};g.getCenterObjectSpace=function(a=x.create()){return v.copy(a,B.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};g.getBoundingBoxObjectSpace=function(a=q.create()){const b=this.stageObject.boundingVolumeObjectSpace;q.setMin(a,b.min);q.setMax(a,b.max);return a};g.computeAttachmentOrigin=function(a){if(this.useObjectOriginAsAttachmentOrigin){var b=
this.stageObject.transformation;a.render.origin[0]+=b[12];a.render.origin[1]+=b[13];a.render.origin[2]+=b[14];a.render.num++}else for(b of this.stageObject.geometryRecords)b.computeAttachmentOrigin(m)&&(v.transformMat4(m,m,this.stageObject.transformation),v.add(a.render.origin,a.render.origin,m),a.render.num++)};g.getProjectedBoundingBox=function(){var a=y._asyncToGenerator(function*(b,c,f,h,d){d=this.getBoundingBoxObjectSpace(d);var k=E,l=q.isPoint(d)?1:k.length;for(var e=0;e<l;e++){const u=k[e];
p[0]=d[u[0]];p[1]=d[u[1]];p[2]=d[u[2]];v.transformMat4(p,p,this.stageObject.transformation);r[3*e]=p[0];r[3*e+1]=p[1];r[3*e+2]=p[2]}if(!b(r,0,l))return null;q.empty(d);b=null;this.calculateRelativeScreenBounds&&(b=this.calculateRelativeScreenBounds());for(k=0;k<3*l;k+=3){for(e=0;3>e;e++)d[e]=Math.min(d[e],r[k+e]),d[e+3]=Math.max(d[e+3],r[k+e]);b&&f.push({location:r.slice(k,k+3),screenSpaceBoundingRect:b})}if(c&&c.service&&"absolute-height"!==this.elevationContext.mode){q.center(d,m);f="relative-to-scene"===
this.elevationContext.mode?"scene":"ground";l=0;if(c.useViewElevation)l=n.unwrapOr(c.service.getElevation(m[0],m[1],f),0);else try{const u=D.demResolutionForBoundingBox(d,c);l=n.unwrapOr(yield c.service.queryElevation(m[0],m[1],h,u,f),0)}catch(u){}q.offset(d,0,0,-this.alignedSampledElevation+l)}return d});return function(b,c,f,h,d){return a.apply(this,arguments)}}();g.addObjectState=function(a,b){0===a&&b.addObject(this.stageObject,this.stageObject.highlight());1===a&&b.addObject(this.stageObject,
this.stageObject.maskOccludee())};g.removeObjectState=function(a){a.removeObject(this.stageObject)};g.resetEdgeObject=function(a){if(!n.isNone(this._edgeState)){var b=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};g.addOrUpdateEdgeObject=function(a,b){const c=this._edgeState;if(!n.isNone(c)){var f=z(c.baseMaterial);for(const h of c.edgeMaterials)h.objectTransparency=f;a.addOrUpdateObject3D(this.stageObject,c.edgeMaterials,c.properties,
!b).then(()=>{var h;return null==(h=this.stageLayer)?void 0:h.sync()})}};y._createClass(t,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return t}();const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=x.create(),m=x.create(),E=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];w.Graphics3DObject3DGraphicLayer=A;w.default=A;Object.defineProperty(w,
"__esModule",{value:!0})});