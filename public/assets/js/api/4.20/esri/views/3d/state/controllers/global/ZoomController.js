// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(h,n,p,q,x,y,G,H,I,z,A,r,d,g,B,t,C,u,D,f,E,F){h.ZoomController=function(v){function k(a){a=v.call(this,a)||this;a.view=null;a.pickPoint=g.create();a.tmpP0=r.create();a.panAxisAngle=t.create();a.tmpRayDir=g.create();a.targetOnSphere=g.create();a.tmpRay={origin:g.create(),direction:g.create()};a.dragBeginPoint=x.createScreenPointArray();a.normalizedAnchorPoint=r.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};a.sphere=C.create();a.hasPickPoint=!1;return a}n._inheritsLoose(k,v);var m=k.prototype;m.begin=function(a){if(this.active){A.copy(this.dragBeginPoint,a);f.normalizeCoordinate(this.startCamera,a,this.normalizedAnchorPoint);var b=B.getReferenceEllipsoid(this.view.spatialReference),e=f.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,a,!1,b);this.navMode=f.decideNavigationMode(this.startCamera,a,e.hasGeometryIntersection,b);if(this.navMode===f.NavigationMode.Horizontal||q("disable-feature:context-navigation"))this.hasPickPoint=
!!e.scenePickPoint,this.pickPoint=e.scenePickPoint,this.sphere=e.sphere;else{E.fromScreenAtEye(this.startCamera,a,this.tmpRay);d.normalize(this.tmpRay.direction,this.tmpRay.direction);let c;this.view.camera.position.hasZ&&(c=Math.abs(this.view.camera.position.z));b=30*c;a=this.view._stage.renderView.getMinimalDepthForArea(a[0],a[1],this.view.state.camera,70);b=b>a?a:b;this.hasPickPoint=!0;d.scale(this.tmpRay.direction,this.tmpRay.direction,b);d.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=
this.startCamera}};m.update=function(a){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===f.NavigationMode.Horizontal||q("disable-feature:context-navigation")){d.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=d.length(this.tmpRayDir);f.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),c=b*
2**e;const w=this.view.state.constraints.minimumPoiDistance;0>e&&c<w&&(c=w);if(1E-6>Math.abs(b-c))return;this.hasPickPoint&&c<b&&(e=1-(1-c/b)*(1-this.sphere[3]/d.length(this.currentCamera.center)),this.currentCamera.center=d.scale(l,this.currentCamera.center,e));d.scale(this.tmpRayDir,this.tmpRayDir,-c/b);this.currentCamera.eye=d.add(l,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(this.dragBeginPoint,a);u.applyAll(this.view,this.currentCamera,
this.constraintOptions);this.hasPickPoint&&(f.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),t.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),f.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{b=d.length(this.tmpRay.direction);f.normalizeCoordinate(this.currentCamera,a,this.tmpP0);a=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);c=b*2**a;e=this.view.state.constraints.minimumPoiDistance;0>a&&c<e&&(c=
e);if(1E-6>Math.abs(b-c))return;d.scale(this.tmpRayDir,this.tmpRay.direction,1-c/b);this.currentCamera.eye=d.add(l,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=d.add(l,this.currentCamera.center,this.tmpRayDir)}F.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};m.end=function(){this.active&&this.finishController()};n._createClass(k,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return k}(D.InteractiveController);p.__decorate([y.property({constructOnly:!0})],
h.ZoomController.prototype,"view",void 0);h.ZoomController=p.__decorate([z.subclass("esri.views.3d.state.controllers.global.ZoomController")],h.ZoomController);const l=g.create();Object.defineProperty(h,"__esModule",{value:!0})});