// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingRect ./I3SMeshView3D ./LayerView3D ../support/updatingProperties ../../layers/LayerView".split(" "),function(n,d,t,l,e,c,A,B,C,
u,p,h,v,w,x,y){c=function(m){function k(){var a=m.apply(this,arguments)||this;a.type="integrated-mesh-3d";a.lodFactor=1;a._elevationContext="im";a._isIntegratedMesh=!0;a._supportsLabeling=!1;a.drapeTargetType=1;a._overlayTexOffset=p.fromValues(-1,-1,-1,-1);a._overlayTexScale=p.create();a._overlayColor=null;a._overlayHighlight=null;a._overlayNormal=null;return a}n._inheritsLoose(k,m);var g=k.prototype;g.setDrapingTextures=function(a){var b=a.index;const f=a.extent,q=a.needsColorWithoutRasterImage?
a.getValidTarget(1):a.hasDrapedFeatureSource?a.getValidTarget(0):null;l.isSome(q)&&0<h.area(f)?(this._overlayTexOffset[2*b]=-f[0]/h.width(f),this._overlayTexOffset[2*b+1]=-f[1]/h.height(f),this._overlayTexScale[2*b]=1/h.width(f),this._overlayTexScale[2*b+1]=1/h.height(f),b=a.getValidTarget(2),a=a.getValidTarget(3),this._overlayColor=q.getTexture(),this._overlayHighlight=b?b.getTexture():null,this._overlayNormal=a?a.getTexture():null):(this._overlayTexOffset[2*b]=-1,this._overlayTexOffset[2*b+1]=-1,
this._overlayTexScale[2*b]=0,this._overlayTexScale[2*b+1]=0,0===b&&(this._overlayNormal=this._overlayHighlight=this._overlayColor=null));this._forAllNodes(r=>l.isSome(r)&&this._collection.updateMaterial(r.objectHandle,z=>this._updateMaterialOverlay(z)))};g._updateMaterialOverlay=function(a){a.overlayColor=this._overlayColor;a.overlayHighlight=this._overlayHighlight;a.overlayNormal=this._overlayNormal;a.overlayTexOffset=this._overlayTexOffset;a.overlayTexScale=this._overlayTexScale};g.initialize=function(){this.updatingHandles.add(this.layer,
"modifications",()=>this._loadModifications(),2)};g._createLayerGraphic=function(){const a=new t;a.layer=this.layer;a.sourceLayer=this.layer;return a};g.canResume=function(){return m.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};g._loadModifications=function(){this.handles.remove("modifications");if(l.isNone(this.layer.modifications))this._modifications=[];else{var a=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(a,()=>
this._modifications=a.toArray(),2),"modifications")}};n._createClass(k,[{key:"progressiveLoadFactor",get:function(){return 1<=this.lodFactor?.2:1}}]);return k}(v.I3SMeshView3D(w.LayerView3D(y)));d.__decorate([e.property()],c.prototype,"layer",void 0);d.__decorate([e.property({aliasOf:"layer"})],c.prototype,"i3slayer",void 0);d.__decorate([e.property()],c.prototype,"suspended",void 0);d.__decorate([e.property(x.updatingProgress)],c.prototype,"updatingProgress",void 0);d.__decorate([e.property({readOnly:!0,
aliasOf:"_controller.updatingProgress"})],c.prototype,"updatingProgressValue",void 0);d.__decorate([e.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],c.prototype,"lodFactor",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"progressiveLoadFactor",null);return c=d.__decorate([u.subclass("esri.views.3d.layers.SceneLayerView3D")],c)});