// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineCalloutMaterial".split(" "),function(q,r,u,g,v,y,k,z,A,l,B,w,C,D,E,n){l=function(p){function m(a,b){a=p.call(this,
a,null,b,F)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}r._inheritsLoose(m,p);var e=m.prototype;e.doLoad=function(){var a=r._asyncToGenerator(function*(){this._material=new n.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return a.apply(this,arguments)}}();e.destroy=function(){p.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};e.perInstanceMaterialParameters=
function(a){const b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};e._defaultElevationInfoNoZ=function(){return G};e.createGraphics3DGraphic=function(a){const b=a.renderingInfo;a=a.graphic;const c=this.setGraphicElevationContext(a,new z.ElevationContext,b.elevationOffset||0);var d=b.symbol;const f="on-the-ground"===this._elevationContext.mode&&("cim"===d.type||!d.symbolLayers.some(h=>"object"===h.type||"text"===h.type));if("label-3d"!==
d.type&&f)return null;d=B.computeCentroid(a.geometry);return g.isNone(d)?null:this._createAs3DShape(d,c,b,a.uid)};e.layerOpacityChanged=function(){if(g.isNone(this._material))return!0;this._material.setParameterValues(this.materialParameters);return!0};e.layerElevationInfoChanged=function(a,b,c){c=k.elevationModeChangeUpdateType(m.elevationModeChangeTypes,c,this._elevationContext.mode);if(c!==k.SymbolUpdateType.UPDATE)return c;a.forEach(d=>{const f=b(d);g.isSome(f)&&this.updateGraphicElevationContext(d.graphic,
f)});return c};e.slicePlaneEnabledChanged=function(){if(g.isNone(this._material))return!0;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};e.physicalBasedRenderingChanged=function(){return!0};e.pixelRatioChanged=function(){return!0};e.setGraphicElevationContext=function(a,b,c=0){a=p.prototype.setGraphicElevationContext.call(this,a,b);a.addOffsetRenderUnits(c);return a};e.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,b.elevationContext,
b.metadata.elevationOffset);b.needsElevationUpdates=k.needsElevationUpdates2D(b.elevationContext.mode)};e.updateGeometry=function(a,b){return!1};e.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:C.emptySymbolComplexity.memory}};e.createVertexData=function(a){const {translation:b,centerOffset:c}=a;return[["position",b?{size:3,data:[b[0],b[1],b[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,
0,1],exclusive:!0}],["auxpos1",c?{size:4,data:[c[0],c[1],c[2],c[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};e._getOrCreateMaterial=function(a){const b=this.perInstanceMaterialParameters(a),c=n.LineCalloutMaterial.uniqueMaterialIdentifier(b);if(g.isSome(this._material)&&c===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){let d=a.materialCollection.get(c);g.isNone(d)&&(d=new n.LineCalloutMaterial(b),a.materialCollection.add(c,
d));return{material:d,isUnique:!1}}return{material:new n.LineCalloutMaterial(b),isUnique:!0}};e._createAs3DShape=function(a,b,c,d){var f=[new D.Geometry(this.createVertexData(c),H,1)];const h=this._getOrCreateMaterial(c);d=w.createStageObjectForHUD(this._context,a,f,[h.material],null,null,b,this._context.layer.uid,d);if(null===d)return null;f=new A.Graphics3DObject3DGraphicLayer(this,d.object,f,h.isUnique?[h.material]:null,null,y.perObjectElevationAligner,b);f.metadata={elevationOffset:c.elevationOffset||
0};f.alignedSampledElevation=d.sampledElevation;f.needsElevationUpdates=k.needsElevationUpdates2D(b.mode);w.extendPointGraphicElevationContext(f,a,this._context.elevationProvider);return f};r._createClass(m,[{key:"materialParameters",get:function(){const a=this.symbol;var b=a.callout;const c=g.isSome(b.color)?u.toUnitRGBA(b.color):[0,0,0,0];c[3]*=this._getLayerOpacity();const d=v.pt2px(b.size||0);let f=null;if(a.verticalOffset){const {screenLength:I,minWorldLength:J,maxWorldLength:x}=a.verticalOffset;
f={screenLength:v.pt2px(I),minWorldLength:J||0,maxWorldLength:null!=x?x:Infinity}}b=g.isSome(b.border)&&g.isSome(b.border.color)?u.toUnitRGBA(b.border.color):null;const h="object"===a.symbolLayers.getItemAt(0).type;return{color:c,size:d,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!h,shaderPolygonOffset:h?0:void 0,depthHUDAlignStart:"label-3d"===
a.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:E.materialParametersDefaults.renderOccluded}}}]);return m}(l.Graphics3DSymbolLayer);l.elevationModeChangeTypes={definedChanged:k.SymbolUpdateType.UPDATE,staysOnTheGround:k.SymbolUpdateType.UPDATE,onTheGroundChanged:k.SymbolUpdateType.RECREATE};const t=new Uint16Array([0]),H=[["position",t],["normal",t],["auxpos1",t]],G={mode:"relative-to-ground",offset:0},F={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};q.Graphics3DLineCalloutSymbolLayer=
l;q.default=l;Object.defineProperty(q,"__esModule",{value:!0})});