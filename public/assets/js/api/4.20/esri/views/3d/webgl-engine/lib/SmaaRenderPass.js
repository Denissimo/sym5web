// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),function(m,h,n,p,q,k,l,r){let t=function(){function g(b,a){this.rctx=b;this._techniqueRep=a;this.resourceLoadingPromise=null;this.isEnabled=!1}var e=g.prototype;e.loadResources=function(b){if(!this.data||!this.textureArea||!this.textureSearch){const a=this.resourceLoadingPromise||this.loadDataModule().then(()=>
this.loadTextures());b&&a.then(b);this.resourceLoadingPromise||(this.resourceLoadingPromise=a,a.then(()=>this.resourceLoadingPromise=null));return!1}return!0};e.loadDataModule=function(){return this.data?Promise.resolve():(new Promise(function(b,a){m(["./SmaaRenderPassData"],b,a)})).then(b=>{this.data=b})};e.loadTextures=function(){return Promise.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(([b,a])=>{this.textureArea=
b;this.textureSearch=a})};e.enable=function(){if(this.isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeights||!this._blur){const b=new k.SMAATechniqueConfiguration,a=(f,c)=>this._techniqueRep.releaseAndAcquire(k.SMAATechnique,f,c);b.output=0;this._edgeDetectTechnique=a(b,this._edgeDetectTechnique);b.output=1;this._blendWeights=a(b,this._blendWeights);b.output=2;this._blur=a(b,this._blur)}if(!this.loadResources())return!1;this.vao=q.createScreenSizeTriangleVAO(this.rctx);this.edges=
new l(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.blend=new l(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};e.disable=function(){this.isEnabled&&(this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=
null,this.blend.dispose(),this.blend=null,this.edges.dispose(),this.edges=null,this.isEnabled=!1)};e.render=function(b){this.enable();const a=this.rctx,f=a.getBoundFramebufferObject();var c=b.colorTexture.descriptor.width,d=b.colorTexture.descriptor.height;a.bindVAO(this.vao);a.setPipelineState(this._edgeDetectTechnique.pipeline);a.setViewport(0,0,c,d);this.edges.resize(c,d);a.bindFramebuffer(this.edges);a.setClearColor(0,0,0,1);a.clear(16384);a.useProgram(this._edgeDetectTechnique.program);this._edgeDetectTechnique.program.bindTexture(b.colorTexture,
"tColor");this._edgeDetectTechnique.program.setUniform4f("uResolution",1/c,1/d,c,d);a.drawArrays(4,0,3);this.blend.resize(c,d);a.bindFramebuffer(this.blend);a.setClearColor(0,0,1,1);a.clear(16384);a.useProgram(this._blendWeights.program);this._blendWeights.program.setUniform4f("uResolution",1/c,1/d,c,d);this._blendWeights.program.bindTexture(this.textureSearch,"tSearch");this._blendWeights.program.bindTexture(this.textureArea,"tArea");this._blendWeights.program.bindTexture(this.edges.colorTexture,
"tEdges");a.drawArrays(4,0,3);a.bindFramebuffer(f);a.setClearColor(0,1,0,1);a.clear(16384);a.useProgram(this._blur.program);this._blur.program.setUniform4f("uResolution",1/c,1/d,c,d);this._blur.program.bindTexture(b.colorTexture,"tColor");this._blur.program.bindTexture(this.blend.colorTexture,"tBlendWeights");a.drawArrays(4,0,3)};e.loadTextureFromBase64=function(b,a,f){const c=new r(this.rctx,{pixelFormat:f,dataType:5121,wrapMode:33071,samplingMode:a},null);return p.requestImage(b).then(d=>{c.resize(d.width,
d.height);c.setData(d);return c})};n._createClass(g,[{key:"isLoadingResources",get:function(){return null!=this.resourceLoadingPromise}}]);return g}();h.SmaaRenderPass=t;Object.defineProperty(h,"__esModule",{value:!0})});