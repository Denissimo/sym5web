// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/renderState".split(" "),
function(y,p,q,k,r,t,z,A,d,u,B,C,e,D,E,F,G,l){e=function(f){function c(){var b=f.apply(this,arguments)||this;b.opacityElevation=1;b.dayNightTerminator=1;b.highlightShadowMapSlot=0;b.defaultSnapshotSlot=1;return b}q._inheritsLoose(c,f);var m=c.prototype;m.initializeProgram=function(b){var a=c.shader.get();this._viewingMode=b.viewingMode;a=a.build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new E.Program(b.rctx,a,D.Default3D)};m.initializePipeline=function(b){return l.makePipelineState({blending:l.separateBlendingParams(770,
1,771,771),colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null})};m.bindPass=function(b,a){this.opacityElevation=1-k.smoothstep(4E4,5E4,a.camera.relativeElevation);var n=1===this._viewingMode?d.normalize(v,a.camera.center):d.set(v,0,0,1);n=d.dot(n,a.lighting.lightingMainDirection);this.dayNightTerminator=k.smoothstep(0,1,k.clamp(30*n,0,1));this.program.bindTexture(a.linearDepthTexture,"depthMap");this.program.bindTexture(a.highlightColorTexture,"highlightMap");d.transformMat4(g,a.lighting.lightingMainDirection,
a.camera.viewInverseTransposeMatrix);d.normalize(g,g);F.inverseProjectionInfo(a.camera.projectionMatrix,a.camera.fullWidth,a.camera.fullHeight,w,x);t.translate(h,a.camera.viewMatrix,a.camera.center);t.invert(h,h);this.program.setUniform4fv("color",b.shadowColor);this.program.setUniform1f("opacity",b.shadowOpacity);this.program.setUniform1f("occludedOpacity",b.occludedShadowOpacity);this.program.setUniform1f("terminationFactor",this.opacityElevation*this.dayNightTerminator);this.program.setUniform2fv("nearFar",
a.camera.nearFar);this.program.setUniformMatrix4fv("inverseView",h);this.program.setUniform4fv("projInfo",w);this.program.setUniform2fv("zScale",x);this.program.setUniform3fv("lightingMainDirectionView",g);this.program.setUniform2f("texelSize",1/a.linearDepthTexture.descriptor.width,1/a.linearDepthTexture.descriptor.height);a.shadowMap.bind(this.program);a.shadowMap.bindView(this.program,a.camera.center);b=a.shadowMap.getSnapshot(this.highlightShadowMapSlot);r.isSome(b)&&this.program.bindTexture(b,
"highlightDepthTex");b=a.shadowMap.getSnapshot(this.defaultSnapshotSlot);r.isSome(b)&&this.program.bindTexture(b,"defaultDepthTex")};q._createClass(c,[{key:"primitiveType",get:function(){return 5}}]);return c}(e.ShaderTechnique);e.shader=new C.ReloadableShaderModule(G.ShadowHighlightShader,()=>new Promise(function(f,c){y(["./ShadowHighlight.glsl"],f,c)}));const v=u.create(),g=u.create(),x=A.create(),w=B.create(),h=z.create();p.ShadowHighlightTechnique=e;Object.defineProperty(p,"__esModule",{value:!0})});