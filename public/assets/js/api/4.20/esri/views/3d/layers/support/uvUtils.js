// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView".split(" "),function(B,J,K,C,D,b,n,L,M,E,N){function F(x,d,a,g,l,c,h){b.set(x,d*l[0]+a*c[0]+g*h[0],d*l[1]+a*c[1]+g*h[1],d*l[2]+a*c[2]+g*h[2])}const G=n.create(),k=n.create(),I=E.create(),
m=n.create(),f=n.create(),w=n.create(),e=D.create(),t=D.create(),p=D.create(),r=n.create(),u=n.create(),v=n.create(),q=K.create(),y=n.create(),z=n.create(),H=n.create(),A=n.create();B.createMapSpaceUVCoords=function(x,d,a,g,l=1){b.set(m,1,0,0);b.set(f,0,1,0);b.set(w,0,0,1);b.set(A,0,0,0);for(var c=0;c<d.count-1;c++)d.getVec(c,k),b.add(A,A,k);b.scale(G,A,1/(d.count-1));c=d.count-1;if(c=E.fromManyPointsSampleAt(d,I,0,Math.floor(c/3),Math.floor(2/3*c))){J.isSome(a)?(a.basisMatrixAtPosition(G,q),b.set(y,
q[0],q[1],q[2]),b.set(z,q[4],q[5],q[6]),b.set(H,q[8],q[9],q[10])):(b.set(y,1,0,0),b.set(z,0,1,0),b.set(H,0,0,1));a=E.normal(I);0>b.dot(a,H)&&b.scale(a,a,-1);b.copy(w,a);c=b.dot(a,z);var h=b.dot(a,y);Math.abs(c)<Math.abs(h)?(b.scaleAndAdd(m,y,a,-h),b.normalize(m,m),b.cross(f,m,a),b.normalize(f,f),b.scale(f,f,-1)):(b.scaleAndAdd(f,z,a,-c),b.normalize(f,f),b.cross(m,f,a),b.normalize(m,m))}C.set(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);C.set(t,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);
for(a=0;a<d.count;a++)d.getVec(a,k),c=b.dot(m,k),h=b.dot(f,k),e[0]=Math.min(e[0],c),e[1]=Math.min(e[1],h),t[0]=Math.max(t[0],c),t[1]=Math.max(t[1],h);a=b.dot(w,G);F(r,e[0],e[1],a,m,f,w);F(u,t[0],e[1],a,m,f,w);F(v,e[0],t[1],a,m,f,w);b.subtract(u,u,r);b.scale(u,u,.5);b.subtract(v,v,r);b.scale(v,v,.5);b.add(r,r,u);b.add(r,r,v);a=e[1]%l;p[0]=e[0]-e[0]%l;p[1]=e[1]-a;for(a=0;a<d.count;a++)for(d.getVec(a,k),x.setValues(a,(b.dot(m,k)-p[0])/l,(b.dot(f,k)-p[1])/l,p[0]/l,p[1]/l),c=0;3>c;c++)g.set(a,c,r[c]),
g.set(a,c+3,u[c]),g.set(a,c+6,v[c])};B.createMapSpaceUVCoordsDraped=function(x,d,a,g=1){if(a.isGeographic){const l=new Float64Array(d.typedBuffer.length),c=3*d.count;for(let h=0;h<c;h+=3)L.lonLatToWebMercatorComparable(d.typedBuffer,h,l,h,M.getReferenceEllipsoid(a));d=N.BufferViewVec3f64.fromTypedArray(l)}C.set(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(a=0;a<d.count;a++)d.getVec(a,k),e[0]=Math.min(e[0],k[0]),e[1]=Math.min(e[1],k[1]);a=e[1]%g;p[0]=e[0]-e[0]%g;p[1]=e[1]-a;for(a=0;a<d.count;a++)d.getVec(a,
k),x.setValues(a,(k[0]-p[0])/g,(k[1]-p[1])/g,p[0]/g,p[1]/g)};Object.defineProperty(B,"__esModule",{value:!0})});