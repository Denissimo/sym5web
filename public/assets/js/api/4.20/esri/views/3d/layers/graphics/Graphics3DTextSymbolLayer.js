// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(w,A,E,e,F,G,H,I,x,J,K,t,y,u,L,M,N,B){function C(m,p,d){m&&m.forEach(a=>{const b=p(a);e.isSome(b)&&d(b,a.graphic)})}const O=[0,0,1];t=function(m){function p(a,b,f,c){a=m.call(this,a,b,f,c)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}A._inheritsLoose(p,m);var d=p.prototype;d.doLoad=function(){var a=A._asyncToGenerator(function*(){if(!this._drivenProperties.size){const b=y.validateSymbolLayerSize(this.symbolLayer.size);if(b)throw new E("graphics3dtextsymbollayer:invalid-size",
b);}this._createTextRenderParameters()});return function(){return a.apply(this,arguments)}}();d._createTextRenderParameters=function(){this._textRenderParameters=M.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};d.destroy=function(){m.prototype.destroy.call(this)};d.createGraphics3DGraphic=function(a){a=a.graphic;const b=u.placePointOnGeometry(a.geometry);if(e.isNone(b))return this.logger.warn(`unsupported geometry type for text symbol: ${a.geometry.type}`),
null;const f=this.symbolLayer.text;if(!f)return null;const c=H.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,b,f,c)};d.createLabel=function(a,b,f,c){a=a.graphic;const h=u.placePointOnGeometry(a.geometry);if(e.isNone(h))return this.logger.warn(`unsupported geometry type for label: ${a.geometry.type}`),null;const g=b.text;return!g||/^\s+$/.test(g)?null:this._createAs3DShape(a,h,g,b,b,f,c)};d.setGraphicElevationContext=function(a,
b,f=0){a=m.prototype.setGraphicElevationContext.call(this,a,b);a.addOffsetRenderUnits(f);return a};d.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};d.layerElevationInfoChanged=function(a,b){C(a,b,(f,c)=>{this.updateGraphicElevationContext(c,f)});return x.SymbolUpdateType.UPDATE};d.slicePlaneEnabledChanged=function(a,b){C(a,b,f=>{for(const c of f.stageObject.geometryRecords)c.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});
return!0};d.physicalBasedRenderingChanged=function(){return!0};d.pixelRatioChanged=function(){return!1};d.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,b.elevationContext,b.metadata.elevationOffset);b.needsElevationUpdates=x.needsElevationUpdates2D(b.elevationContext.mode)||"absolute-height"===b.elevationContext.mode};d._defaultElevationInfoNoZ=function(){return P};d._createAs3DShape=function(a,b,f,c,h=Q,g,l){const v=this.setGraphicElevationContext(a,new J.ElevationContext,
h.elevationOffset);var q="polyline"===e.get(a.geometry,"type"),r=a.uid;a=this._context.stage.renderView.renderingContext;var k=y.namedAnchorToHUDMaterialAnchorPos[h.anchor in y.namedAnchorToHUDMaterialAnchorPos?h.anchor:"center"];a=e.isNone(l)?new N(a,f,this._textRenderParameters):null;k={occlusionTest:!0,screenOffset:h.screenOffset,anchorPos:k,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:h.centerOffsetUnits,debugDrawBorder:h.debugDrawBorder,drawInSecondSlot:!0};e.isSome(a)&&(k.textureId=a.id,
k.texCoordScale=a.texcoordScale);e.isSome(l)&&(k.textureId=l.id);if(e.isSome(c)&&e.isSome(c.verticalOffset)){const {screenLength:n,minWorldLength:z,maxWorldLength:D}=c.verticalOffset;k.verticalOffset={screenLength:F.pt2px(n),minWorldLength:z||0,maxWorldLength:null!=D?D:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:n,screenSizePerspectiveSettingsLabels:z}=this._context.sharedResources;k.screenSizePerspective=z.overridePadding(this._textRenderParameters.haloSize);
k.screenSizePerspectiveAlignment=n}q&&(k.shaderPolygonOffset=1E-4);k.slicePlaneEnabled=this._context.slicePlaneEnabled;e.isSome(g)?(l=JSON.stringify(k),c=g.get(l),e.isNone(c)&&(c=new B.HUDMaterial(k),g.add(l,c))):c=new B.HUDMaterial(k);c=[c];l=h.translation;q=e.isSome(a)?[a.displayWidth,a.displayHeight]:[0,0];l=[L.createPointGeometry(O,l,null,q,h.centerOffset,[0,0],null)];r=u.createStageObjectForHUD(this._context,b,l,c,null,null,v,this._context.layer.uid,r);if(null===r)return null;q=I.perObjectElevationAligner;
g=new K.Graphics3DObject3DGraphicLayer(this,r.object,l,e.isNone(g)?c:null,e.isSome(a)?[a]:null,q,v);g.alignedSampledElevation=r.sampledElevation;g.needsElevationUpdates=x.needsElevationUpdates2D(v.mode)||"absolute-height"===v.mode;const {displayWidth:R,displayHeight:S}=e.isSome(a)?a:h;g.getScreenSize=(n=G.create())=>{n[0]=R;n[1]=S;return n};g.metadata={labelText:f,elevationOffset:h.elevationOffset};u.extendPointGraphicElevationContext(g,b,this._context.elevationProvider);return g};return p}(t.Graphics3DSymbolLayer);
const P={mode:"relative-to-ground",offset:0},Q={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};w.Graphics3DTextSymbolLayer=t;w.default=t;Object.defineProperty(w,"__esModule",{value:!0})});