// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../lib/localOrigin ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),function(h,n,p,u,v,E,F,G,H,w,x,y,z,q,r){const l=q.assert,A=q.logWithBase;
h.Model=function(t){function m(){var a=t.call(this)||this;a.dirtySet=new y({model:n._assertThisInitialized(a)});a._id2origin=new Map;a._content=new Map;return a}n._inheritsLoose(m,t);var d=m.prototype;d.getObject=function(a){return this._content.get(a)};d.add=function(a){const b=a.id;l(!this._content.has(b),"Model/Stage already contains object to be added");this._content.set(b,a);r.isWebGLLayer(a)&&this.dirtySet.layerAdded(a)};d.remove=function(a){l(this._content.has(a.id),"Model/Stage doesn't contain object to be removed");
this._content.delete(a.id);a.unload();r.isWebGLLayer(a)&&this.dirtySet.layerRemoved(a)};d.addMany=function(a){for(const b of a)l(!this._content.has(b.id),"Model/Stage already contains object to be added"),this._content.set(b.id,b)};d.removeMany=function(a){for(const b of a)l(this._content.has(b.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(b.id),b.unload()};d.forEachOfType=function(a,b){this._content.forEach(c=>{c.type===a&&b(c)})};d._getOrigin=function(a){var b=0,c=
10*a[3]/1E4;1<c&&(b=Math.ceil(A(c,2)));c=1E4*2**b;const e=Math.round(a[0]/c),f=Math.round(a[1]/c);a=Math.round(a[2]/c);b=b+"_"+e+"_"+f+"_"+a;let g=this._id2origin.get(b);null==g&&(g=x.fromValues(e*c,f*c,a*c,b),this._id2origin.set(b,g));return g};d.getRenderGeometry=function(a,b){const {geometry:c,material:e,id:f,shaderTransformation:g,origin:B,instanceParameters:C}=b,k=new z.RenderGeometry(c,e,null,null,f,c.boundingInfo,g,a.castShadow);k.updateTransformation(D=>a.getCombinedStaticTransformation(b,
D));k.origin=B||this._getOrigin(k.boundingSphere);k.instanceParameters=C;return k};d.updateRenderGeometryTransformation=function(a,b,c){c.updateTransformation(f=>a.getCombinedStaticTransformation(b,f));const e=this._getOrigin(c.boundingSphere);return c.origin!==e};d.getStats=function(){const a={},b=Array.from(this._content.values());for(let c=0;5>c;++c)a[c]=b.filter(e=>e.type===c).length;return{contentTypes:a,dirtySet:this.dirtySet.formatDebugInfo()}};n._createClass(m,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return m}(u);p.__decorate([v.property({constructOnly:!0})],h.Model.prototype,"dirtySet",void 0);h.Model=p.__decorate([w.subclass("esri.views.3d.webgl-engine.parts.Model")],h.Model);Object.defineProperty(h,"__esModule",{value:!0})});