// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(h,r,va,wa,p,P,xa,ya,d,n,G,E,H,Q,za,z,B,R,Y,Aa){function S(a,c,b){const e=z.sm4d.get();p.identity(e);p.rotate(e,e,b[3],G.axis(b));d.subtract(k,a.eye,c);d.transformMat4(k,k,e);a.eye=d.add(k,k,c);d.subtract(k,a.center,c);d.transformMat4(k,k,e);a.center=d.add(k,k,c);a.up=d.transformMat4(k,a.up,e)}function Z(a,c){d.set(c,0,0,0);for(const b of a)d.add(c,c,b);d.scale(c,c,1/a.length)}function aa(a,c,b,e){return Math.sin(a/d.length(c))*(b+e.radius)}function ba(a,c,b,e){b=R.fromScreenAtEye(c,b,ca);
if(va.isNone(b))return!1;Q.closestPointOnSilhouette(a,b,I);return Q.intersectRay(a,b,e)?d.squaredDistance(I,b.origin)<d.squaredDistance(e,b.origin)?(d.copy(e,I),!1):!0:(d.subtract(C,c.eye,c.center),d.normalize(C,C),H.fromNormalAndOffset(C,-d.dot(d.normalize(C,C),I),da),H.intersectRay(da,b,e),!1)}function ea(a,c,b,e,g,f){d.cross(J,a,c);d.subtract(K,a,c);d.length(a)<=g||!e.aboveGround?(d.cross(b,K,e.eye),a=d.dot(a,c)/(d.length(a)*d.length(c)),f=Math.cos(r.clamp(B.cyclicalPI.normalize(r.deg2rad(f)),
0,T)),c=-r.acosClamped(a)-Math.max(0,d.length(c)-g)/(f*g)):(d.subtract(fa,e.eye,e.center),d.cross(b,K,fa),c=-d.length(K)/g);d.normalize(b,b);d.scale(b,b,d.length(J));return c}function U(a,c,b,e){e=Math.cos(r.clamp(B.cyclicalPI.normalize(r.deg2rad(e)),0,T));c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):r.acosClamped(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):r.acosClamped(a/b))-c)*b}function ha(a,c,b,e,g,f,l,m,q,t){q=U(a[2],c[2],l[3],q);c=t?U(a[0],c[0],l[3],180):c[0]-a[0];a=Math.sin(m)*c-
Math.cos(m)*q;m=Math.cos(m)*c+Math.sin(m)*q;d.normalize(k,g);g=t?a/Math.sqrt(Math.abs(l[3]**2-d.dot(b,k)**2)):a/l[3];b=m/Math.sqrt(Math.abs(l[3]**2-d.dot(b,e)**2));xa.set(f,g,b)}function ia(a,c,b,e,g,f,l,m,q,t){d.cross(J,a,c);E.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,L,M,N);E.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,u,v,ja);d.copy(b,v);d.copy(e,u);d.normalize(b,b);d.scale(b,b,d.length(J));E.vectorCoordinates(a,d.normalize(M,M),d.normalize(N,N),d.normalize(L,L),ka);E.vectorCoordinates(c,
M,N,L,la);ha(ka,la,a,u,v,g,l,m,q,t)}function ma(a,c,b,e,g,f,l){p.identity(w);p.identity(x);p.identity(y);p.rotate(w,w,g,e);p.rotate(x,x,l,f);p.multiply(y,w,x);d.subtract(c,a,b);d.transformMat4(c,c,y);d.add(c,c,b)}function na(a,c,b,e,g,f){p.identity(w);p.identity(x);p.identity(y);p.rotate(w,w,e,b);p.rotate(x,x,f,g);p.multiply(y,w,x);d.subtract(k,a.eye,c);d.transformMat4(k,k,y);a.eye=d.add(k,k,c);d.subtract(k,a.center,c);d.transformMat4(k,k,y);a.center=d.add(k,k,c);d.subtract(k,a.up,c);d.transformMat4(k,
k,y);a.up=d.add(k,k,c)}function V(a,c,b,e,g,f,l=D.Pole,m=D.Angle){a=Math.abs(a[2])<b*l||Math.abs(c)>b;return(Math.abs(e)>Math.PI-m||Math.abs(e)<m)&&a&&f.aboveGround&&g<D.Tilt?!0:!1}function oa(a,c,b,e,g,f){f?(G.fromPoints(b,e,pa),S(c,a,pa)):(b=ea(b,e,qa,c,a[3],g),S(c,a,G.wrapAxisAngle(qa,b)))}function ra(a,c,b,e,g,f,l){const m=l?20:1;d.copy(A,e);O.copyFrom(c);let q;for(let t=0;t<m&&1E-12<d.squaredDistance(b,A);t++)if(e=d.squaredDistance(b,A),ia(b,A,v,u,F,O,a,g,f,l),na(O,a,u,F[1],v,F[0]),ma(A,A,a,
u,F[1],v,F[0]),q=d.squaredDistance(b,A),q<e||0===t)c.copyFrom(O);else break}const sa=wa.createScreenPointArray();h.NavigationMode=void 0;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(h.NavigationMode||(h.NavigationMode={}));const W={Elevation:3E4,Angle:r.deg2rad(6)},D={Pole:.95,Angle:r.deg2rad(18),Tilt:45},T=r.deg2rad(80),X=n.create(),I=n.create(),C=n.create(),da=H.create(),fa=n.create(),u=n.create(),v=n.create(),ja=n.create(),L=n.create(),M=n.create(),N=n.create(),ka=n.create(),
la=n.create(),F=ya.create(),pa=G.create(),w=P.create(),x=P.create(),y=P.create(),A=n.create(),k=n.create(),K=n.create(),O=new Aa,J=n.create(),qa=n.create(),ca={origin:n.create(),direction:n.create()},ta={origin:n.create(),direction:n.create()};h.PreservingHeadingThreshold=D;h.TiltThresholdPanningSpeed=T;h.VerticalPanTresholds=W;h.applyPanPlanar=function(a,c,b){d.subtract(X,b,c);a.eye=d.subtract(k,a.eye,X);a.center=d.subtract(k,a.center,X)};h.applyPanSphericalDirectRotation=oa;h.applyPanSphericalPreserveHeading=
ra;h.applyRotation=S;h.applyRotationWithTwoAxes=na;h.applyZoomOnSphere=function(a,c,b){c.getScreenCenter(sa);Y.intersectScreen(a,c,sa,k)&&(c.center=k);a=c.distance;b*=a;1E-6>Math.abs(a-b)||(b=d.scale(z.sv3d.get(),c.viewForward,b),c.eye=d.subtract(k,c.center,b))};h.applyZoomToPoint=function(a,c,b,e){const g=z.sv3d.get();b=1-b;d.subtract(g,c,a.eye);const f=d.length(g);let l=f*(1-b);0<=b&&l<e&&(l=e,b=-(l-f)/f);1E-6>Math.abs(f-l)||(d.scale(g,g,b),a.eye=d.add(k,a.eye,g),a.center=d.lerp(k,a.center,c,b))};
h.centroid=Z;h.centroidOnSphere=function(a,c,b){Z(c,b);d.normalize(b,b);d.scale(b,b,a)};h.decideNavigationMode=function(a,c,b,e){if(d.length(a.eye)-e.radius>W.Elevation)return h.NavigationMode.Horizontal;if(!b)return h.NavigationMode.Vertical;R.fromScreenAtEye(a,c,ta);return-r.sign(a.relativeElevation)*(.5*Math.PI+za.angle(a.eye,ta.direction))<W.Angle?h.NavigationMode.Vertical:h.NavigationMode.Horizontal};h.intersectPlaneFromScreenPoint=function(a,c,b,e){return H.intersectRay(a,R.fromScreen(c,b,ca),
e)};h.lengthFromPoints=U;h.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);b[1]=c[1]/(a.fullHeight/a.pixelRatio);return b};h.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};h.offSurfaceTiltToEyeTiltGlobal=function(a,c,b,e){return aa(Math.PI/2,c,b,e)+(a-Math.PI/2)};h.onSurfaceTiltToEyeTiltGlobal=aa;h.panMotionToRotationMatrix=function(a,c,b,e,g,f,l,m,q){if(V(a.center,d.dot(a.up,a.center),d.length(a.center),-B.cyclicalPI.normalize(r.deg2rad(f)),
l,c))switch(a=-B.cyclicalPI.normalize(r.deg2rad(g)),{eye:g}=c,E.coordinateSystemFromOneAxisAndNormalVector([0,0,1],g,u,v,ja),g=b.translation[0]*e.pan,f="zoom"===q.mode?0:b.translation[1]*e.pan,c=Math.max(Math.sqrt(Math.abs(1-d.dot(c.center,u)**2/d.length(c.center)**2)),.5),l=-Math.cos(a)*f+Math.sin(a)*g,p.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(a)*f+Math.cos(a)*g)/c,u),m.pan.enabled=!0,q.mode){case "pan":p.rotate(m.pan.matrix,m.pan.matrix,l,v);m.pan.enabled=!0;break;case "zoom":m.zoom=-b.translation[1]*
e.zoom}else{{const {eye:t,viewRight:ua}=c;c=d.cross(z.sv3d.get(),ua,t);a=b.translation[0]*e.pan;0!==a&&(p.rotate(m.pan.matrix,m.pan.matrix,-a,c),m.pan.enabled=!0);switch(q.mode){case "pan":b=b.translation[1]*e.pan;0!==b&&(p.rotate(m.pan.matrix,m.pan.matrix,b,ua),m.pan.enabled=!0);break;case "zoom":m.zoom=-b.translation[1]*e.zoom}}}};h.panToPosition=function(a,c,b,e,g,f,l){V(b,d.dot(c.up,b),a[3],-B.cyclicalPI.normalize(r.deg2rad(g)),f,c,D.Pole,D.Angle)?ra(a,c,b,e,-B.cyclicalPI.normalize(r.deg2rad(g)),
f,l):oa(a,c,b,e,f,l)};h.pickPointAndInitSphere=function(a,c,b,e,g){const f=n.create(),l=Q.create();let m=!0,q=!0;a.intersectScreen(b,f)?l[3]=d.length(f):(q=!1,l[3]=c.aboveGround?Math.max(d.length(c.center),.9*g.radius):d.length(c.eye)-c.relativeElevation,e?ba(l,c,b,f):m=Y.intersectScreen(l,c,b,f));return{sphere:l,scenePickPoint:m?f:null,hasGeometryIntersection:q}};h.preserveHeadingThreshold=V;h.rotatePointAroundTwoAxes=ma;h.rotationAngleAndAxisDirectRotation=ea;h.rotationAnglesAndAxesHeadingPreserving=
ia;h.rotationAnglesHeadingPreserving=ha;h.rotationFromPointsAroundAxis=function(a,c,b){const e=z.sv3d.get(),g=z.sv3d.get(),f=z.sv3d.get();d.copy(g,a);d.copy(f,c);a=d.dot(g,b);c=d.dot(f,b);d.scale(e,b,a);d.subtract(g,g,e);d.normalize(g,g);d.scale(e,b,c);d.subtract(f,f,e);d.normalize(f,f);a=d.dot(g,f);d.cross(e,b,g);b=d.dot(f,e);return Math.atan2(b,a)};h.sphereOrPlanePointFromScreenPoint=ba;Object.defineProperty(h,"__esModule",{value:!0})});