// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../Color ../../../../../core/Accessor ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/accessorSupport/trackingUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../visualElements/LineVisualElement".split(" "),
function(f,z,m,h,C,D,u,l,n,R,S,T,U,E,A,F,v,d,w){f.LineOfSightView=function(B){function p(a){a=B.call(this,a)||this;a._handle=null;a._analysisHandles=new D;a._lineOfSightVisualizations=[];return a}z._inheritsLoose(p,B);var e=p.prototype;e.initialize=function(){this._handle=this._connectAnalyses()};e.destroy=function(){this._handle=l.removeMaybe(this._handle);this._analysisHandles=l.destroyMaybe(this._analysisHandles)};e.createLineOfSightVisualization=function(){var a=this._configuration;const b=this.view;
var c=new w.LineVisualElement({view:b,attached:!0,width:a.outerWidth,color:h.toUnitRGBA(a.visibleOuterColor),innerWidth:a.innerWidth,innerColor:h.toUnitRGBA(a.visibleInnerColor)});const q=new w.LineVisualElement({view:b,attached:!0,width:a.outerWidth,color:h.toUnitRGBA(a.occludedOuterColor),innerWidth:a.innerWidth,innerColor:h.toUnitRGBA(a.occludedInnerColor)});a=new w.LineVisualElement({view:b,attached:!0,width:a.outerWidth,color:h.toUnitRGBA(a.undefinedOuterColor),innerWidth:a.innerWidth,innerColor:h.toUnitRGBA(a.undefinedInnerColor)});
c={visibleLineVisualElement:c,occludedLineVisualElement:q,undefinedLineVisualElement:a};this._lineOfSightVisualizations.push(c);return c};e.destroyLineOfSightVisualization=function(a){a.visibleLineVisualElement=l.destroyMaybe(a.visibleLineVisualElement);a.occludedLineVisualElement=l.destroyMaybe(a.occludedLineVisualElement);a.undefinedLineVisualElement=l.destroyMaybe(a.undefinedLineVisualElement);this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(a),1)};e.updateLineOfSightVisualization=
function(a,b){const c=this.model.visible,q=this._configuration,{computationResult:G,inputPoints:H}=a,{start:I,end:J,intersection:K,isValid:L,isTargetVisible:M}=G;var {observer:g}=H;a=N;a[12]=g[0];a[13]=g[1];a[14]=g[2];const x=v.subtract(O,I,g),y=v.subtract(P,J,g);g=v.subtract(Q,K,g);const {visibleLineVisualElement:k,occludedLineVisualElement:r,undefinedLineVisualElement:t}=b;k.geometry=null;r.geometry=null;t.geometry=null;L?M?(k.geometry=[[d.fromArray(x),d.fromArray(y)]],k.transform=a,k.color=h.toUnitRGBA(q.visibleOuterColor)):
(k.geometry=[[d.fromArray(x),d.fromArray(g)]],k.transform=a,k.color=h.toUnitRGBA(q.occludedOuterColor),r.geometry=[[d.fromArray(g),d.fromArray(y)]],r.transform=a):(t.geometry=[[d.fromArray(x),d.fromArray(y)]],t.transform=a);k.visible=c;r.visible=c;t.visible=c};e.getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,visible:this.model.visible}};
e.testData=function(){return{visualizations:this._lineOfSightVisualizations}};e._connectAnalysis=function(a){const b=this._analysisHandles;if(!b.has(a)){var c=this.createLineOfSightVisualization();b.add([A.reactionInit(()=>this.getLineOfSightVisualizationDependencies(a),()=>this.updateLineOfSightVisualization(a,c)),u.makeHandle(()=>this.destroyLineOfSightVisualization(c))])}};e._disconnectAnalysis=function(a){this._analysisHandles.remove(a)};e._connectAnalyses=function(){let a=null;return u.handlesGroup([A.reactionInit(()=>
this._analyses,b=>{a=l.removeMaybe(a);a=b.on("change",c=>this._onAnalysesCollectionChange(c));this._onAnalysesCollectionChange({target:b,added:b.items,removed:[],moved:[]})}),u.makeHandle(()=>a=l.removeMaybe(a))])};e._onAnalysesCollectionChange=function(a){a.added.forEach(b=>this._connectAnalysis(b));a.removed.forEach(b=>this._disconnectAnalysis(b))};z._createClass(p,[{key:"_viewData",get:function(){return this.model.viewData}},{key:"_analyses",get:function(){return this._viewData.analyses}},{key:"_configuration",
get:function(){return this._viewData.configuration.lineOfSight}}]);return p}(C);m.__decorate([n.property({constructOnly:!0})],f.LineOfSightView.prototype,"model",void 0);m.__decorate([n.property({constructOnly:!0})],f.LineOfSightView.prototype,"view",void 0);m.__decorate([n.property()],f.LineOfSightView.prototype,"_viewData",null);m.__decorate([n.property()],f.LineOfSightView.prototype,"_analyses",null);m.__decorate([n.property()],f.LineOfSightView.prototype,"_configuration",null);f.LineOfSightView=
m.__decorate([E.subclass("esri.views.3d.interactive.graphics.LineOfSight.LineOfSightView")],f.LineOfSightView);const O=d.create(),P=d.create(),Q=d.create(),N=F.create();Object.defineProperty(f,"__esModule",{value:!0})});