// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/colorUtils ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../Manipulator3D ../../manipulatorUtils ../dragEventPipeline3D ../settings ./config ./Manipulation ./moveUtils ../../../webgl-engine/lib/GeometryUtil ../../../../interactive/dragEventPipeline".split(" "),
function(A,B,H,I,J,K,L,x,M,m,p,N,u,O,l,y,z,P,C,D){z=function(E){function v(a){var b=E.call(this)||this;b._handles=new J;b._radius=y.DISC_RADIUS;b.events=new I;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b.createManipulator();b.forEachManipulator(e=>b._tool.manipulators.add(e));return b}B._inheritsLoose(v,E);var q=v.prototype;q.destroy=function(){this._handles.destroy();this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()})};q.forEachManipulator=function(a){a(this._manipulator,
0)};q.createGraphicDragPipeline=function(a,b,e){const d=L.unwrap(b.graphic.geometry).spatialReference;return P.createGraphicMoveDragPipeline(b,e,f=>this.createDragPipeline((k,g,c,r,w)=>f(k,a(k,g,c,r,w),c),d),this._view.state.viewingMode)};q.createDragPipeline=function(a,b){const e=this._view;return D.createManipulatorDragEventPipeline(this._manipulator,(d,f,k,g,c)=>{f=f.next(r=>({...r,manipulatorType:0})).next(O.screenToZConstrained(e,d.renderLocation,b)).next(D.addScreenDelta());a(d,f,k,g,c)})};
q.updateManipulator=function(){var a=this._radius/y.DISC_RADIUS;const b=l.settings.zManipulator.height*a;var e=l.settings.zManipulator.coneHeight*a;const d=l.settings.zManipulator.coneWidth*a;a*=l.settings.zManipulator.width;var f=[p.fromValues(0,0,0),p.fromValues(0,0,b)];f=C.createTubeGeometry(f,a/2,16,!1);const k=C.createConeGeometry(e,d/2,16,!1);e=[p.fromValues(0,0,0),p.fromValues(0,0,b+e)];const g=(n=>{const h=M.create();x.translate(h,h,[0,0,b]);x.rotateX(h,h,Math.PI/2);n&&(n=1+2*n/d,x.scale(h,
h,[n,n,n]));return h})(0);var c=(n,h)=>{h=H.darken(l.settings.zManipulator.color,h);return[h.r/255,h.g/255,h.b/255,l.settings.zManipulator.color.a*n]};const r=u.createManipulatorMaterial(c(1,.25),1),w=u.createManipulatorMaterial(c(1,0),1),F=u.createManipulatorMaterial(c(.7,0),l.settings.zManipulator.renderOccluded);c=u.createManipulatorMaterial(c(.85,0),l.settings.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:k,transform:g,material:r,stateMask:1},{geometry:f,material:r,stateMask:1},
{geometry:k,transform:g,material:w,stateMask:2},{geometry:f,material:w,stateMask:2},{geometry:k,transform:g,material:F,stateMask:1},{geometry:f,material:F,stateMask:1},{geometry:k,transform:g,material:c,stateMask:2},{geometry:f,material:c,stateMask:2}];this._manipulator.radius=a/2+2;this._manipulator.collisionType={type:"line",paths:[e]}};q.createManipulator=function(){const a=new N.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,
worldOriented:!0,collisionPriority:1.6});a.applyObjectTransform=b=>{var e=this._view.state.camera,d=G;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,d);const f=m.dist(e.eye,d),k=e.computeRenderPixelSizeAtDist(f);var g=m.subtract(t,d,e.eye);m.normalize(g,g);var c=Q;this._view.renderCoordsHelper.worldUpAtPosition(G,c);d=Math.abs(m.dot(g,c));g=m.cross(t,g,c);c=m.cross(t,g,c);d=K.clamp(d,.01,1);e=1-Math.sqrt(1-d*d)/d/e.fullWidth;d=this._radius/y.DISC_RADIUS*l.settings.zManipulator.width;
m.scale(c,m.normalize(c,c),(1/e-1)*f+k*d);b[12]-=t[0];b[13]-=t[1];b[14]-=t[2]};this._manipulator=a;this.updateManipulator()};B._createClass(v,[{key:"radius",get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this.updateManipulator())}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]);return v}(z.Manipulation);const G=p.create(),t=p.create(),Q=p.create();A.MoveZManipulation=z;Object.defineProperty(A,"__esModule",{value:!0})});