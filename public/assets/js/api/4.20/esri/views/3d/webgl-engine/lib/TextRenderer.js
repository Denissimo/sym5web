// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],function(p,w,r){function q(h,l,a){h.canvas||(h.canvas=document.createElement("canvas"));h.canvas.width=l;h.canvas.height=a;return h.canvas}let v=function(){function h(a,d,b=2048){this.text=a;this._parameters=d;this.maxSize=b;this._lineWidths=[];this._displayWidth=this._renderPixelRatio=null;this.key=`${this._parameters.key}--${a}`;this._lines=a.split(/\r?\n/);this._lineHeight=this.computeLineHeight()}var l=
h.prototype;l.getLineXOffset=function(a){return Math.round((this.renderedWidth-this._lineWidths[a]*this.renderPixelRatio)/2)};l.render=function(a,d=0,b=0){const e=this.renderedLineHeight;var f=this.renderedHaloSize,c=a.textAlign,g=this.renderedWidth;c=("center"===c?.5*g:"right"===c?g:0)+f;g=f+1;a.save();0<f&&this.renderHalo(a,c,g,d,b);this.setFontProperties(a,this.renderedFontSize);b+=g;d+=c;for(f=0;f<this._lines.length;++f)a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",c=
this._lines[f],g=this.getLineXOffset(f),a.fillText(c,d+g,b),a.globalCompositeOperation="source-over",a.fillStyle=this._parameters.fillStyle,a.fillText(c,d+this.getLineXOffset(f),b),b+=e;a.restore()};l.renderHalo=function(a,d,b,e,f){const c=this.renderedWidth,g=this.renderedHeight,n=q(t,Math.max(c,512),Math.max(g,512)),k=n.getContext("2d");k.clearRect(0,0,c,g);this.setFontProperties(k,this.renderedFontSize);k.fillStyle=this._parameters.haloStyle;k.strokeStyle=this._parameters.haloStyle;const m=3>this.renderedHaloSize;
k.lineJoin=m?"miter":"round";m?this.renderHaloEmulated(k,d,b):this.renderHaloNative(k,d,b);a.globalAlpha=this._parameters.definition.halo.color[3];a.drawImage(n,0,0,c,g,e,f,c,g);a.globalAlpha=1};l.renderHaloEmulated=function(a,d,b){const e=this.renderedLineHeight,f=this.renderedHaloSize;for(let c=0;c<this._lines.length;++c){const g=this._lines[c],n=this.getLineXOffset(c);for(const [k,m]of u)a.fillText(g,d+n+f*k,b+f*m);b+=e}};l.renderHaloNative=function(a,d,b){const e=this.renderedLineHeight,f=this.renderedHaloSize;
for(let c=0;c<this._lines.length;++c){const g=2*f,n=this._lines[c],k=this.getLineXOffset(c);for(let m=0;5>m;m++)a.lineWidth=(.6+.1*m)*g,a.strokeText(n,d+k,b);b+=e}};l.setFontProperties=function(a,d){const b=this._parameters.definition.font;a.font=`${b.style} ${b.weight} ${d}px ${b.family}, sans-serif`;a.textAlign="left";a.textBaseline="top"};l._ensureTextWidth=function(){if(r.isSome(this._displayWidth))return this._displayWidth;const a=q(t,512,512).getContext("2d");this.setFontProperties(a,this._parameters.definition.size);
let d=0,b=2*this._parameters.haloSize;this._lineWidths.length=0;var e=this._parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"string"===typeof e.weight&&("bold"===e.weight||"bolder"===e.weight)||"number"===typeof e.weight&&600<e.weight)b+=.3*a.measureText("A").width;for(const f of this._lines)e=Math.round(a.measureText(f).width+b),this._lineWidths.push(e),d=Math.max(d,e);return this._displayWidth=d};l.computeLineHeight=function(){return Math.ceil(1.275*this._parameters.definition.size+
2*this._parameters.haloSize)+1};w._createClass(h,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",
get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(r.isNone(this._renderPixelRatio)){const a=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio}}]);return h}();const u=[];for(let h=0;360>
h;h+=22.5)u.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);const t={canvas:null};p.TextRenderer=v;p.default=v;p.getTextHelperCanvas=q;Object.defineProperty(p,"__esModule",{value:!0})});