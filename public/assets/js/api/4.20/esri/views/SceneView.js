// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/projection":function(){define("require exports ../chunks/_rollupPluginBabelHelpers ../core/Error ../core/mathUtils ../core/maybe ../core/promiseUtils ../core/unitUtils ../chunks/mat4 ../chunks/vec3 ../chunks/vec3f64 ./Extent ./Multipoint ../chunks/pe ./Point ./Polygon ./Polyline ./projectionEllipsoid ./support/aaBoundingRect ./support/Ellipsoid ./support/geodesicConstants ./support/GeographicTransformation ./support/spatialReferenceUtils".split(" "),function(a,u,f,p,
t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){function C(){return!!ua&&z.isLoaded()}function B(oa){w.isNone(Ea)&&(Ea=Promise.all([z.load(),(new Promise(function(wa,za){a(["../chunks/geometryEngineBase"],wa,za)})).then(function(wa){return wa.geometryEngineBase}),new Promise(function(wa,za){a(["./geometryAdapters/hydrated"],wa,za)})]));return Ea.then(([,wa,{hydratedAdapter:za}])=>{e.throwIfAborted(oa);Ba=za;ua=wa.default;ua._enableProjection(z.pe)})}function v(oa,wa,za,Ia,Sa=null){if(w.isNone(za)||w.isNone(Ia))return wa;
if(F(za,Ia,Sa))return wa.map(Xa=>N(Xa,za,Ia));if(w.isNone(Sa)){const Xa=x.cacheKey(za,Ia);void 0!==Ga[Xa]?Sa=Ga[Xa]:(Sa=E(za,Ia,null),w.isNone(Sa)&&(Sa=new x),Ga[Xa]=Sa)}if(w.isNone(ua))throw new ma;return ua._project(oa,wa,za,Ia,Sa)}function E(oa,wa,za=null){if(w.isNone(ua))throw new ma;if(w.isNone(oa)||w.isNone(wa))return null;oa=ua._getTransformation(Ba,oa,wa,za,null==za?void 0:za.spatialReference);return null!==oa?x.fromGE(oa):null}function F(oa,wa,za){return za?!1:D.equals(oa,wa)?!0:D.isValid(oa)&&
D.isValid(wa)&&!!Ka(oa,wa,ea)}function L(){L=f._asyncToGenerator(function*(oa,wa,za,Ia){if(!C())if(Array.isArray(oa))for(const {source:Sa,dest:Xa,geographicTransformation:bb}of oa){if(!F(Sa,Xa,bb))return B(Ia)}else if(!F(oa,wa,za))return B(Ia)});return L.apply(this,arguments)}function N(oa,wa,za){if(!oa)return oa;if("x"in oa){var Ia=new r;return I(oa,wa,Ia,za)?Ia:null}return"xmin"in oa?(Ia=new l,J(oa,wa,Ia,za)?Ia:null):"rings"in oa?(Ia=new c,H(oa,wa,Ia,za)?Ia:null):"paths"in oa?(Ia=new d,K(oa,wa,
Ia,za)?Ia:null):"points"in oa?(Ia=new m,G(oa,wa,Ia,za)?Ia:null):null}function I(oa,wa,za,Ia,Sa=0){Pa[0]=oa.x;Pa[1]=oa.y;const Xa=oa.z;Pa[2]=void 0!==Xa?Xa:Sa;if(!S(Pa,wa,0,Pa,Ia,0,1))return!1;za.x=Pa[0];za.y=Pa[1];za.spatialReference=Ia;void 0===Xa?(za.z=void 0,za.hasZ=!1):(za.z=Pa[2],za.hasZ=!0);void 0===oa.m?(za.m=void 0,za.hasM=!1):(za.m=oa.m,za.hasM=!0);return!0}function G(oa,wa,za,Ia,Sa=0){const {points:Xa,hasZ:bb,hasM:ab}=oa;oa=[];const gb=Xa.length,$a=[];for(var Ja of Xa)$a.push(Ja[0],Ja[1],
bb?Ja[2]:Sa);if(!S($a,wa,0,$a,Ia,0,gb))return!1;for(wa=0;wa<gb;++wa){Sa=3*wa;Ja=$a[Sa];const Oa=$a[Sa+1];bb&&ab?oa.push([Ja,Oa,$a[Sa+2],Xa[wa][3]]):bb?oa.push([Ja,Oa,$a[Sa+2]]):ab?oa.push([Ja,Oa,Xa[wa][2]]):oa.push([Ja,Oa])}za.points=oa;za.spatialReference=Ia;za.hasZ=bb;za.hasM=ab;return!0}function K(oa,wa,za,Ia,Sa=0){const {paths:Xa,hasZ:bb,hasM:ab}=oa;oa=[];if(!V(Xa,bb,ab,wa,oa,Ia,Sa))return!1;za.paths=oa;za.spatialReference=Ia;za.hasZ=bb;za.hasM=ab;return!0}function H(oa,wa,za,Ia,Sa=0){const {rings:Xa,
hasZ:bb,hasM:ab}=oa;oa=[];if(!V(Xa,bb,ab,wa,oa,Ia,Sa))return!1;za.rings=oa;za.spatialReference=Ia;za.hasZ=bb;za.hasM=ab;return!0}function J(oa,wa,za,Ia,Sa=0){const {xmin:Xa,ymin:bb,xmax:ab,ymax:gb,hasZ:$a,hasM:Ja}=oa;if(!M(Xa,bb,$a?oa.zmin:Sa,wa,Pa,Ia))return!1;za.xmin=Pa[0];za.ymin=Pa[1];$a&&(za.zmin=Pa[2]);if(!M(ab,gb,$a?oa.zmax:Sa,wa,Pa,Ia))return!1;za.xmax=Pa[0];za.ymax=Pa[1];$a&&(za.zmax=Pa[2]);Ja&&(za.mmin=oa.mmin,za.mmax=oa.mmax);za.spatialReference=Ia;return!0}function M(oa,wa,za,Ia,Sa,Xa){va[0]=
oa;va[1]=wa;va[2]=za;return S(va,Ia,0,Sa,Xa,0,1)}function O(oa,wa,za,Ia){if(w.isNone(wa)||w.isNone(Ia)||2>oa.length)return!1;2===oa.length&&(va[0]=oa[0],va[1]=oa[1],va[2]=0,oa=va);return S(oa,wa,0,za,Ia,0,1)}function Q(oa,wa,za){if(w.isNone(wa))return!1;wa=W(wa,Ma);wa=ya[wa][6];if(w.isNone(wa))return!1;wa(oa,0,va,0);za!==va&&(za[0]=va[0],za[1]=va[1],2<za.length&&(za[2]=va[2]));return!0}function S(oa,wa,za,Ia,Sa,Xa,bb=1){wa=Ka(wa,Sa,ea);if(w.isNone(wa))return!1;if(wa===ba){if(oa===Ia&&za===Xa)return!0;
bb=za+3*bb;for(let ab=za,gb=Xa;ab<bb;ab++,gb++)Ia[gb]=oa[ab];return!0}bb=za+3*bb;for(let ab=za,gb=Xa;ab<bb;ab+=3,gb+=3)wa(oa,ab,Ia,gb);return!0}function V(oa,wa,za,Ia,Sa,Xa,bb=0){const ab=[];for(const gb of oa)for(const $a of gb)ab.push($a[0],$a[1],wa?$a[2]:bb);if(!S(ab,Ia,0,ab,Xa,0,ab.length/3))return!1;Ia=0;Sa.length=0;for(const gb of oa){oa=[];for(const $a of gb)wa&&za?oa.push([ab[Ia++],ab[Ia++],ab[Ia++],$a[3]]):wa?oa.push([ab[Ia++],ab[Ia++],ab[Ia++]]):(za?oa.push([ab[Ia++],ab[Ia++],$a[2]]):oa.push([ab[Ia++],
ab[Ia++]]),Ia++);Sa.push(oa)}return!0}function Y(oa,wa,za){const Ia=Math.sin(wa);wa=Math.cos(wa);const Sa=Math.sin(oa);oa=Math.cos(oa);za[0]=-Ia;za[4]=-Sa*wa;za[8]=oa*wa;za[12]=0;za[1]=wa;za[5]=-Sa*Ia;za[9]=oa*Ia;za[13]=0;za[2]=0;za[6]=oa;za[10]=Sa;za[14]=0;za[3]=0;za[7]=0;za[11]=0;za[15]=1;return za}function W(oa,wa){if(wa.spatialReference===oa)return wa.spatialReferenceId;wa.spatialReference=oa;"metersPerUnit"in wa&&(wa.metersPerUnit=n.getMetersPerUnitForSR(oa,1));return oa.wkt===g.SphericalECEFSpatialReference.wkt?
wa.spatialReferenceId=1:D.isWGS84(oa)?wa.spatialReferenceId=2:D.isWebMercator(oa)?wa.spatialReferenceId=3:oa.wkt===g.WGS84ECEFSpatialReference.wkt?wa.spatialReferenceId=4:4490===oa.wkid?wa.spatialReferenceId=5:oa.wkt===g.SphericalPCPFMars.wkt?wa.spatialReferenceId=7:oa.wkt===g.SphericalPCPFMoon.wkt?wa.spatialReferenceId=9:D.isMars(oa)?wa.spatialReferenceId=8:D.isMoon(oa)?wa.spatialReferenceId=10:wa.spatialReferenceId=0}function ba(oa,wa,za,Ia){oa!==za&&(za[Ia++]=oa[wa++],za[Ia++]=oa[wa++],za[Ia]=
oa[wa])}function ca(oa,wa,za,Ia){za[Ia++]=ra*(oa[wa++]/q.earth.radius);za[Ia++]=ra*(Math.PI/2-2*Math.atan(Math.exp(-1*oa[wa++]/q.earth.radius)));za[Ia]=oa[wa]}function da(oa,wa,za,Ia){ca(oa,wa,za,Ia);P(za,Ia,za,Ia)}function ha(oa,wa,za,Ia){ca(oa,wa,za,Ia);ta(za,Ia,za,Ia)}function fa(oa,wa,za,Ia,Sa){var Xa=.4999999*Math.PI;Xa=t.clamp(Qa*oa[wa+1],-Xa,Xa);Xa=Math.sin(Xa);za[Ia++]=Qa*oa[wa]*Sa.radius;za[Ia++]=Sa.halfSemiMajorAxis*Math.log((1+Xa)/(1-Xa));za[Ia]=oa[wa+2]}function R(oa,wa,za,Ia){fa(oa,wa,
za,Ia,q.earth)}function U(oa,wa,za,Ia,Sa){Sa+=oa[wa+2];const Xa=Qa*oa[wa+1];oa=Qa*oa[wa];wa=Math.cos(Xa);za[Ia++]=Math.cos(oa)*wa*Sa;za[Ia++]=Math.sin(oa)*wa*Sa;za[Ia]=Math.sin(Xa)*Sa}function Z(oa,wa,za,Ia){U(oa,wa,za,Ia,q.moon.radius)}function T(oa,wa,za,Ia){U(oa,wa,za,Ia,q.mars.radius)}function P(oa,wa,za,Ia){U(oa,wa,za,Ia,q.earth.radius)}function X(oa,wa,za,Ia,Sa){var Xa=oa[wa];const bb=oa[wa+1];wa=oa[wa+2];oa=Math.sqrt(Xa*Xa+bb*bb+wa*wa);wa=t.asinClamped(wa/(0===oa?1:oa));Xa=Math.atan2(bb,Xa);
za[Ia++]=ra*Xa;za[Ia++]=ra*wa;za[Ia]=oa-Sa}function aa(oa,wa,za,Ia){X(oa,wa,za,Ia,q.moon.radius)}function ja(oa,wa,za,Ia){X(oa,wa,za,Ia,q.mars.radius)}function ia(oa,wa,za,Ia){X(oa,wa,za,Ia,q.earth.radius)}function ka(oa,wa,za,Ia){ia(oa,wa,za,Ia);R(za,Ia,za,Ia)}function na(oa,wa,za,Ia){ia(oa,wa,za,Ia);ta(za,Ia,za,Ia)}function ta(oa,wa,za,Ia){{var Sa=q.earth;const bb=Qa*oa[wa];var Xa=Qa*oa[wa+1];oa=oa[wa+2];wa=Math.sin(Xa);Xa=Math.cos(Xa);const ab=Sa.radius/Math.sqrt(1-Sa.eccentricitySquared*wa*wa);
za[Ia++]=(ab+oa)*Xa*Math.cos(bb);za[Ia++]=(ab+oa)*Xa*Math.sin(bb);za[Ia++]=(ab*(1-Sa.eccentricitySquared)+oa)*wa}}function pa(oa,wa,za,Ia){var Sa=y.earthEllipsoidConstants,Xa=oa[wa],bb=oa[wa+1];oa=oa[wa+2];let ab;wa=Math.abs(oa);var gb=Xa*Xa+bb*bb;var $a=Math.sqrt(gb);var Ja=gb+oa*oa;var Oa=Math.sqrt(Ja);Xa=Math.atan2(bb,Xa);var Wa=oa*oa/Ja;Ja=gb/Ja;bb=Sa.a2/Oa;gb=Sa.a3-Sa.a4/Oa;.3<Ja?(Wa=wa/Oa*(1+Ja*(Sa.a1+bb+Wa*gb)/Oa),Oa=Math.asin(Wa),bb=Wa*Wa,Ja=Math.sqrt(1-bb)):(Ja=$a/Oa*(1-Wa*(Sa.a5-bb-Ja*gb)/
Oa),Oa=Math.acos(Ja),bb=1-Ja*Ja,Wa=Math.sqrt(bb));ab=1-q.earth.eccentricitySquared*bb;bb=q.earth.radius/Math.sqrt(ab);Sa=Sa.a6*bb;bb=$a-bb*Ja;gb=wa-Sa*Wa;wa=Ja*bb+Wa*gb;$a=Ja*gb-Wa*bb;Sa=$a/(Sa/ab+wa);Oa+=Sa;0>oa&&(Oa=-Oa);za[Ia++]=ra*Xa;za[Ia++]=ra*Oa;za[Ia]=wa+$a*Sa/2}function xa(oa,wa,za,Ia){pa(oa,wa,za,Ia);P(za,Ia,za,Ia)}function Da(oa,wa,za,Ia){pa(oa,wa,za,Ia);R(za,Ia,za,Ia)}function Ka(oa,wa,za=Ha()){return w.isNone(oa)||w.isNone(wa)?null:Fa(oa,wa,za).projector}function Fa(oa,wa,za){if(w.isNone(oa)||
w.isNone(wa)||za.source.spatialReference===oa&&za.dest.spatialReference===wa)return za;const Ia=W(oa,za.source),Sa=W(wa,za.dest);0===Ia&&0===Sa?D.equals(oa,wa)?za.projector=ba:za.projector=null:za.projector=ya[Ia][Sa];return za}function Ha(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:ba}}let ua=null,Ba=null,Ea=null,Ga={},ma=function(oa){function wa(){return oa.call(this,"projection:not-loaded",
"projection engine not fully loaded yet, please call load()")||this}f._inheritsLoose(wa,oa);return wa}(p);const ya={[2]:{[5]:null,[8]:null,[10]:null,[11]:ba,[6]:ba,[1]:P,[7]:null,[9]:null,[0]:null,[3]:R,[2]:ba,[4]:ta},[5]:{[5]:ba,[8]:null,[10]:null,[11]:ba,[6]:ba,[1]:P,[7]:null,[9]:null,[0]:null,[3]:null,[2]:null,[4]:ta},[8]:{[5]:null,[8]:ba,[10]:null,[11]:ba,[6]:null,[1]:null,[7]:T,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[10]:{[5]:null,[8]:null,[10]:ba,[11]:ba,[6]:null,[1]:null,[7]:null,[9]:Z,
[0]:null,[3]:null,[2]:null,[4]:null},[3]:{[5]:null,[8]:null,[10]:null,[11]:ca,[6]:ca,[1]:da,[7]:null,[9]:null,[0]:null,[3]:ba,[2]:ca,[4]:ha},[4]:{[5]:pa,[8]:null,[10]:null,[11]:pa,[6]:pa,[1]:xa,[7]:null,[9]:null,[0]:null,[3]:Da,[2]:pa,[4]:ba},[1]:{[5]:ia,[8]:null,[10]:null,[11]:ia,[6]:ia,[1]:ba,[7]:null,[9]:null,[0]:null,[3]:ka,[2]:ia,[4]:na},[7]:{[5]:null,[8]:ja,[10]:null,[11]:ja,[6]:null,[1]:null,[7]:ba,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[9]:{[5]:null,[8]:null,[10]:aa,[11]:aa,[6]:null,
[1]:null,[7]:null,[9]:ba,[0]:null,[3]:null,[2]:null,[4]:null},[0]:{[5]:null,[8]:null,[10]:null,[11]:null,[6]:null,[1]:null,[7]:null,[9]:null,[0]:ba,[3]:null,[2]:null,[4]:null},[11]:{[5]:ba,[8]:ba,[10]:ba,[11]:ba,[6]:ba,[1]:P,[7]:T,[9]:Z,[0]:null,[3]:R,[2]:ba,[4]:ta},[6]:{[5]:null,[8]:null,[10]:null,[11]:ba,[6]:ba,[1]:P,[7]:null,[9]:null,[0]:null,[3]:null,[2]:ba,[4]:ta}},Ma={spatialReference:null,spatialReferenceId:0},Ra={spatialReference:null,spatialReferenceId:0},ea=Ha(),Ua=Ha(),Qa=t.deg2rad(1),
ra=t.rad2deg(1),va=k.create(),La=k.create(),Ta=k.create(),Pa=k.create(),sa=k.create();u.canProjectToWGS84ComparableLonLat=function(oa){if(w.isNone(oa))return!1;oa=W(oa,Ma);return!!ya[oa][6]};u.canProjectWithoutEngine=F;u.computeLatLonToENURotation=Y;u.computeLinearTransformation=function(oa,wa,za,Ia){if(w.isNone(oa)||w.isNone(Ia))return!1;var Sa=W(oa,Ma),Xa=W(Ia,Ra);if(Sa===Xa&&1!==Xa&&7!==Xa&&9!==Xa&&(0!==Sa||D.equals(oa,Ia)))return b.identity(za),b.translate(za,za,wa),!0;if(1===Xa||7===Xa||9===
Xa){Ia=oa=0;Sa=ya[Sa][11];Xa=ya[11][Xa];if(w.isNone(Sa)||w.isNone(Xa))return!1;Sa(wa,0,La,0);Xa(La,0,Ta,0);oa=Qa*La[0];Ia=Qa*La[1];Y(Ia,oa,za);za[12]=Ta[0];za[13]=Ta[1];za[14]=Ta[2];return!0}if(3===Xa&&(2===Sa||1===Sa)){Xa=ya[Sa][11];if(w.isNone(Xa))return!1;Xa(wa,0,La,0);wa=Qa*La[1];R(La,0,Ta,0);b.identity(za);b.translate(za,za,Ta);wa=1/Math.cos(wa);b.scale(za,za,[wa,wa,1]);return!0}return!1};u.getProjectorName=function(oa,wa){switch(Ka(oa,wa,ea)){case ba:return"copy3";case P:return"wgs84ToSphericalECEF";
case R:return"wgs84ToWebMercator";case ta:return"wgs84ToWGS84ECEF";case ca:return"webMercatorToWGS84";case da:return"webMercatorToSphericalECEF";case ha:return"webMercatorToWGS84ECEF";case pa:return"wgs84ECEFToWGS84";case xa:return"wgs84ECEFToSphericalECEF";case Da:return"wgs84ECEFToWebMercator";case ia:return"sphericalECEFToWGS84";case ka:return"sphericalECEFToWebMercator";case ja:return"sphericalMarsPCPFToMars2000";case aa:return"sphericalMoonPCPFToMoon2000";case na:return"sphericalECEFToWGS84ECEF";
case T:return"mars2000ToSphericalPCPF";case Z:return"moon2000ToSphericalPCPF";default:return null}};u.getTransformation=E;u.getTransformations=function(oa,wa,za=null){if(w.isNone(ua))throw new ma;oa=ua._getTransformationBySuitability(Ba,oa,wa,za,null==za?void 0:za.spatialReference);if(null!==oa){wa=[];for(const Ia of oa)wa.push(x.fromGE(Ia));return wa}return[]};u.initializeProjection=function(oa,wa,za,Ia){return L.apply(this,arguments)};u.isLoaded=C;u.isSupported=function(){return!0};u.load=B;u.localLinearScaleFactors=
function(oa,wa,za,Ia){if(w.isNone(wa)||w.isNone(Ia))return!1;const Sa=W(wa,Ma);var Xa=W(Ia,Ra);if(Sa===Xa&&0!==Sa||D.equals(wa,Ia))return za[0]=1,za[1]=1,za[2]=1,!0;if(1===Sa){wa=h.length(oa);oa=wa/Math.sqrt(oa[0]*oa[0]+oa[1]*oa[1]);wa/=q.earth.radius;if(3===Xa)return za[0]=oa*wa,za[1]=oa*wa,za[2]=1,!0;if(2===Xa||5===Xa)return Xa=180/(q.earth.radius*Math.PI),za[0]=Xa*oa*wa,za[1]=Xa*wa,za[2]=1,!0}return!1};u.lonLatToSphericalPCPF=function(oa,wa,za,Ia,Sa=0){Ia+=Sa;Sa=Math.cos(za);oa[0]=Math.cos(wa)*
Sa*Ia;oa[1]=Math.sin(wa)*Sa*Ia;oa[2]=Math.sin(za)*Ia};u.lonLatToWebMercatorComparable=fa;u.project=function(oa,wa,za=null){return Array.isArray(oa)?0===oa.length?[]:v(Ba,oa,oa[0].spatialReference,wa,za):v(Ba,[oa],oa.spatialReference,wa,za)[0]};u.projectBoundingRect=function(oa,wa,za,Ia){if(null==oa)return!1;if(D.equals(wa,Ia))return A.set(za,oa),!0;va[0]=oa[0];va[1]=oa[1];va[2]=0;if(!S(va,wa,0,va,Ia,0,1))return!1;za[0]=va[0];za[1]=va[1];va[0]=oa[2];va[1]=oa[3];va[2]=0;if(!S(va,wa,0,va,Ia,0,1))return!1;
za[2]=va[0];za[3]=va[1];return!0};u.projectBoundingSphere=function(oa,wa,za,Ia){if(w.isNone(wa)||w.isNone(Ia))return!1;wa=Fa(wa,Ia,Ua);if(wa.projector===ba)return za[0]=oa[0],za[1]=oa[1],za[2]=oa[2],za[3]=oa[3],!0;if(w.isNone(wa.projector))return!1;const {source:Sa,dest:Xa}=wa;if(3===Xa.spatialReferenceId){wa=ya[Sa.spatialReferenceId][2];if(w.isNone(wa))return!1;wa(oa,0,La,0);wa=Math.abs(Qa*La[1])+Math.asin(oa[3]/(q.earth.radius+oa[2]));R(La,0,za,0);za[3]=wa>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(wa)*
oa[3];return!0}wa.projector(oa,0,za,0);za[3]=oa[3]*Sa.metersPerUnit/Xa.metersPerUnit;return!0};u.projectBuffer=S;u.projectDirection=function(oa,wa,za,Ia,Sa){h.copy(Pa,oa);h.add(sa,oa,wa);O(Pa,za,Pa,Sa);O(sa,za,sa,Sa);h.subtract(Ia,sa,Pa);h.normalize(Ia,Ia)};u.projectExtent=function(oa,wa,za=wa.spatialReference,Ia=0){return w.isNone(za)?!1:J(oa,oa.spatialReference,wa,za,Ia)};u.projectMany=v;u.projectMultipoint=function(oa,wa,za=wa.spatialReference,Ia=0){return w.isNone(za)?!1:G(oa,oa.spatialReference,
wa,za,Ia)};u.projectPoint=function(oa,wa,za=wa.spatialReference,Ia=0){return w.isNone(za)?!1:I(oa,oa.spatialReference,wa,za,Ia)};u.projectPointToVector=function(oa,wa,za,Ia=0){Pa[0]=oa.x;Pa[1]=oa.y;const Sa=oa.z;Pa[2]=void 0!==Sa?Sa:Ia;return S(Pa,oa.spatialReference,0,wa,za,0,1)};u.projectPointToWGS84ComparableLonLat=function(oa,wa){Pa[0]=oa.x;Pa[1]=oa.y;const za=oa.z;Pa[2]=void 0!==za?za:0;return Q(Pa,oa.spatialReference,wa)};u.projectPolygon=function(oa,wa,za=wa.spatialReference,Ia=0){return w.isNone(za)?
!1:H(oa,oa.spatialReference,wa,za,Ia)};u.projectPolyline=function(oa,wa,za=wa.spatialReference,Ia=0){return w.isNone(za)?!1:K(oa,oa.spatialReference,wa,za,Ia)};u.projectVectorToDehydratedPoint=function(oa,wa,za){return S(oa,wa,0,Pa,za.spatialReference,0,1)?(za.x=Pa[0],za.y=Pa[1],za.z=Pa[2],za):null};u.projectVectorToPoint=function(oa,wa,za){if(w.isNone(wa)||w.isNone(za))return null;const Ia=new r({spatialReference:za});return S(oa,wa,0,Pa,za,0,1)?(Ia.x=Pa[0],Ia.y=Pa[1],Ia.z=Pa[2],Ia):null};u.projectVectorToVector=
O;u.projectVectorToWGS84ComparableLonLat=function(oa,wa,za){return Q(oa,wa,za)};u.projectXYZToVector=M;u.sphericalPCPFtoLonLatElevation=X;u.unload=function(){Ea=Ba=ua=null;Ga={}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/mat4":function(){define(["exports","./vec3f64","./common"],function(a,u,f){function p(R,U){R[0]=U[0];R[1]=U[1];R[2]=U[2];R[3]=U[3];R[4]=U[4];R[5]=U[5];R[6]=U[6];R[7]=U[7];R[8]=U[8];R[9]=U[9];R[10]=U[10];R[11]=U[11];R[12]=U[12];R[13]=U[13];R[14]=U[14];R[15]=
U[15];return R}function t(R,U,Z,T,P,X,aa,ja,ia,ka,na,ta,pa,xa,Da,Ka,Fa){R[0]=U;R[1]=Z;R[2]=T;R[3]=P;R[4]=X;R[5]=aa;R[6]=ja;R[7]=ia;R[8]=ka;R[9]=na;R[10]=ta;R[11]=pa;R[12]=xa;R[13]=Da;R[14]=Ka;R[15]=Fa;return R}function w(R){R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=1;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function e(R,U){if(R===U){const Z=U[1],T=U[2],P=U[3],X=U[6],aa=U[7],ja=U[11];R[1]=U[4];R[2]=U[8];R[3]=U[12];R[4]=Z;R[6]=U[9];R[7]=U[13];R[8]=T;R[9]=X;
R[11]=U[14];R[12]=P;R[13]=aa;R[14]=ja}else R[0]=U[0],R[1]=U[4],R[2]=U[8],R[3]=U[12],R[4]=U[1],R[5]=U[5],R[6]=U[9],R[7]=U[13],R[8]=U[2],R[9]=U[6],R[10]=U[10],R[11]=U[14],R[12]=U[3],R[13]=U[7],R[14]=U[11],R[15]=U[15];return R}function n(R,U){const Z=U[0],T=U[1],P=U[2],X=U[3],aa=U[4],ja=U[5],ia=U[6],ka=U[7],na=U[8],ta=U[9],pa=U[10],xa=U[11],Da=U[12],Ka=U[13],Fa=U[14];U=U[15];const Ha=Z*ja-T*aa,ua=Z*ia-P*aa,Ba=Z*ka-X*aa,Ea=T*ia-P*ja,Ga=T*ka-X*ja,ma=P*ka-X*ia,ya=na*Ka-ta*Da,Ma=na*Fa-pa*Da,Ra=na*U-xa*Da,
ea=ta*Fa-pa*Ka,Ua=ta*U-xa*Ka,Qa=pa*U-xa*Fa;let ra=Ha*Qa-ua*Ua+Ba*ea+Ea*Ra-Ga*Ma+ma*ya;if(!ra)return null;ra=1/ra;R[0]=(ja*Qa-ia*Ua+ka*ea)*ra;R[1]=(P*Ua-T*Qa-X*ea)*ra;R[2]=(Ka*ma-Fa*Ga+U*Ea)*ra;R[3]=(pa*Ga-ta*ma-xa*Ea)*ra;R[4]=(ia*Ra-aa*Qa-ka*Ma)*ra;R[5]=(Z*Qa-P*Ra+X*Ma)*ra;R[6]=(Fa*Ba-Da*ma-U*ua)*ra;R[7]=(na*ma-pa*Ba+xa*ua)*ra;R[8]=(aa*Ua-ja*Ra+ka*ya)*ra;R[9]=(T*Ra-Z*Ua-X*ya)*ra;R[10]=(Da*Ga-Ka*Ba+U*Ha)*ra;R[11]=(ta*Ba-na*Ga-xa*Ha)*ra;R[12]=(ja*Ma-aa*ea-ia*ya)*ra;R[13]=(Z*ea-T*Ma+P*ya)*ra;R[14]=(Ka*
ua-Da*Ea-Fa*Ha)*ra;R[15]=(na*Ea-ta*ua+pa*Ha)*ra;return R}function b(R,U){const Z=U[0],T=U[1],P=U[2],X=U[3],aa=U[4],ja=U[5],ia=U[6],ka=U[7],na=U[8],ta=U[9],pa=U[10],xa=U[11],Da=U[12],Ka=U[13],Fa=U[14];U=U[15];R[0]=ja*(pa*U-xa*Fa)-ta*(ia*U-ka*Fa)+Ka*(ia*xa-ka*pa);R[1]=-(T*(pa*U-xa*Fa)-ta*(P*U-X*Fa)+Ka*(P*xa-X*pa));R[2]=T*(ia*U-ka*Fa)-ja*(P*U-X*Fa)+Ka*(P*ka-X*ia);R[3]=-(T*(ia*xa-ka*pa)-ja*(P*xa-X*pa)+ta*(P*ka-X*ia));R[4]=-(aa*(pa*U-xa*Fa)-na*(ia*U-ka*Fa)+Da*(ia*xa-ka*pa));R[5]=Z*(pa*U-xa*Fa)-na*(P*U-
X*Fa)+Da*(P*xa-X*pa);R[6]=-(Z*(ia*U-ka*Fa)-aa*(P*U-X*Fa)+Da*(P*ka-X*ia));R[7]=Z*(ia*xa-ka*pa)-aa*(P*xa-X*pa)+na*(P*ka-X*ia);R[8]=aa*(ta*U-xa*Ka)-na*(ja*U-ka*Ka)+Da*(ja*xa-ka*ta);R[9]=-(Z*(ta*U-xa*Ka)-na*(T*U-X*Ka)+Da*(T*xa-X*ta));R[10]=Z*(ja*U-ka*Ka)-aa*(T*U-X*Ka)+Da*(T*ka-X*ja);R[11]=-(Z*(ja*xa-ka*ta)-aa*(T*xa-X*ta)+na*(T*ka-X*ja));R[12]=-(aa*(ta*Fa-pa*Ka)-na*(ja*Fa-ia*Ka)+Da*(ja*pa-ia*ta));R[13]=Z*(ta*Fa-pa*Ka)-na*(T*Fa-P*Ka)+Da*(T*pa-P*ta);R[14]=-(Z*(ja*Fa-ia*Ka)-aa*(T*Fa-P*Ka)+Da*(T*ia-P*ja));
R[15]=Z*(ja*pa-ia*ta)-aa*(T*pa-P*ta)+na*(T*ia-P*ja);return R}function h(R){const U=R[0],Z=R[1],T=R[2],P=R[3],X=R[4],aa=R[5],ja=R[6],ia=R[7],ka=R[8],na=R[9],ta=R[10],pa=R[11],xa=R[12],Da=R[13],Ka=R[14];R=R[15];return(U*aa-Z*X)*(ta*R-pa*Ka)-(U*ja-T*X)*(na*R-pa*Da)+(U*ia-P*X)*(na*Ka-ta*Da)+(Z*ja-T*aa)*(ka*R-pa*xa)-(Z*ia-P*aa)*(ka*Ka-ta*xa)+(T*ia-P*ja)*(ka*Da-na*xa)}function k(R,U,Z){const T=U[0],P=U[1],X=U[2],aa=U[3],ja=U[4],ia=U[5],ka=U[6],na=U[7],ta=U[8],pa=U[9],xa=U[10],Da=U[11],Ka=U[12],Fa=U[13],
Ha=U[14];U=U[15];let ua=Z[0],Ba=Z[1],Ea=Z[2],Ga=Z[3];R[0]=ua*T+Ba*ja+Ea*ta+Ga*Ka;R[1]=ua*P+Ba*ia+Ea*pa+Ga*Fa;R[2]=ua*X+Ba*ka+Ea*xa+Ga*Ha;R[3]=ua*aa+Ba*na+Ea*Da+Ga*U;ua=Z[4];Ba=Z[5];Ea=Z[6];Ga=Z[7];R[4]=ua*T+Ba*ja+Ea*ta+Ga*Ka;R[5]=ua*P+Ba*ia+Ea*pa+Ga*Fa;R[6]=ua*X+Ba*ka+Ea*xa+Ga*Ha;R[7]=ua*aa+Ba*na+Ea*Da+Ga*U;ua=Z[8];Ba=Z[9];Ea=Z[10];Ga=Z[11];R[8]=ua*T+Ba*ja+Ea*ta+Ga*Ka;R[9]=ua*P+Ba*ia+Ea*pa+Ga*Fa;R[10]=ua*X+Ba*ka+Ea*xa+Ga*Ha;R[11]=ua*aa+Ba*na+Ea*Da+Ga*U;ua=Z[12];Ba=Z[13];Ea=Z[14];Ga=Z[15];R[12]=ua*
T+Ba*ja+Ea*ta+Ga*Ka;R[13]=ua*P+Ba*ia+Ea*pa+Ga*Fa;R[14]=ua*X+Ba*ka+Ea*xa+Ga*Ha;R[15]=ua*aa+Ba*na+Ea*Da+Ga*U;return R}function l(R,U,Z){const T=Z[0],P=Z[1];Z=Z[2];let X=void 0,aa=void 0,ja=void 0,ia=void 0,ka=void 0,na=void 0,ta=void 0,pa=void 0,xa=void 0,Da=void 0,Ka=void 0,Fa=void 0;U===R?(R[12]=U[0]*T+U[4]*P+U[8]*Z+U[12],R[13]=U[1]*T+U[5]*P+U[9]*Z+U[13],R[14]=U[2]*T+U[6]*P+U[10]*Z+U[14],R[15]=U[3]*T+U[7]*P+U[11]*Z+U[15]):(X=U[0],aa=U[1],ja=U[2],ia=U[3],ka=U[4],na=U[5],ta=U[6],pa=U[7],xa=U[8],Da=
U[9],Ka=U[10],Fa=U[11],R[0]=X,R[1]=aa,R[2]=ja,R[3]=ia,R[4]=ka,R[5]=na,R[6]=ta,R[7]=pa,R[8]=xa,R[9]=Da,R[10]=Ka,R[11]=Fa,R[12]=X*T+ka*P+xa*Z+U[12],R[13]=aa*T+na*P+Da*Z+U[13],R[14]=ja*T+ta*P+Ka*Z+U[14],R[15]=ia*T+pa*P+Fa*Z+U[15]);return R}function m(R,U,Z){const T=Z[0],P=Z[1];Z=Z[2];R[0]=U[0]*T;R[1]=U[1]*T;R[2]=U[2]*T;R[3]=U[3]*T;R[4]=U[4]*P;R[5]=U[5]*P;R[6]=U[6]*P;R[7]=U[7]*P;R[8]=U[8]*Z;R[9]=U[9]*Z;R[10]=U[10]*Z;R[11]=U[11]*Z;R[12]=U[12];R[13]=U[13];R[14]=U[14];R[15]=U[15];return R}function z(R,U,
Z,T){let P=T[0],X=T[1];T=T[2];let aa=Math.sqrt(P*P+X*X+T*T);var ja=void 0,ia=void 0;let ka=void 0,na=void 0,ta=void 0,pa=void 0,xa=void 0,Da=void 0,Ka=void 0,Fa=void 0,Ha=void 0,ua=void 0,Ba=void 0,Ea=void 0,Ga=void 0,ma=void 0,ya=void 0,Ma=void 0,Ra=void 0,ea=void 0,Ua=void 0,Qa=void 0;ia=ja=void 0;if(aa<f.EPSILON)return null;aa=1/aa;P*=aa;X*=aa;T*=aa;ja=Math.sin(Z);ia=Math.cos(Z);ka=1-ia;na=U[0];ta=U[1];pa=U[2];xa=U[3];Da=U[4];Ka=U[5];Fa=U[6];Ha=U[7];ua=U[8];Ba=U[9];Ea=U[10];Ga=U[11];ma=P*P*ka+
ia;ya=X*P*ka+T*ja;Ma=T*P*ka-X*ja;Ra=P*X*ka-T*ja;ea=X*X*ka+ia;Ua=T*X*ka+P*ja;Qa=P*T*ka+X*ja;ja=X*T*ka-P*ja;ia=T*T*ka+ia;R[0]=na*ma+Da*ya+ua*Ma;R[1]=ta*ma+Ka*ya+Ba*Ma;R[2]=pa*ma+Fa*ya+Ea*Ma;R[3]=xa*ma+Ha*ya+Ga*Ma;R[4]=na*Ra+Da*ea+ua*Ua;R[5]=ta*Ra+Ka*ea+Ba*Ua;R[6]=pa*Ra+Fa*ea+Ea*Ua;R[7]=xa*Ra+Ha*ea+Ga*Ua;R[8]=na*Qa+Da*ja+ua*ia;R[9]=ta*Qa+Ka*ja+Ba*ia;R[10]=pa*Qa+Fa*ja+Ea*ia;R[11]=xa*Qa+Ha*ja+Ga*ia;U!==R&&(R[12]=U[12],R[13]=U[13],R[14]=U[14],R[15]=U[15]);return R}function r(R,U,Z){const T=Math.sin(Z);
Z=Math.cos(Z);const P=U[4],X=U[5],aa=U[6],ja=U[7],ia=U[8],ka=U[9],na=U[10],ta=U[11];U!==R&&(R[0]=U[0],R[1]=U[1],R[2]=U[2],R[3]=U[3],R[12]=U[12],R[13]=U[13],R[14]=U[14],R[15]=U[15]);R[4]=P*Z+ia*T;R[5]=X*Z+ka*T;R[6]=aa*Z+na*T;R[7]=ja*Z+ta*T;R[8]=ia*Z-P*T;R[9]=ka*Z-X*T;R[10]=na*Z-aa*T;R[11]=ta*Z-ja*T;return R}function c(R,U,Z){const T=Math.sin(Z);Z=Math.cos(Z);const P=U[0],X=U[1],aa=U[2],ja=U[3],ia=U[8],ka=U[9],na=U[10],ta=U[11];U!==R&&(R[4]=U[4],R[5]=U[5],R[6]=U[6],R[7]=U[7],R[12]=U[12],R[13]=U[13],
R[14]=U[14],R[15]=U[15]);R[0]=P*Z-ia*T;R[1]=X*Z-ka*T;R[2]=aa*Z-na*T;R[3]=ja*Z-ta*T;R[8]=P*T+ia*Z;R[9]=X*T+ka*Z;R[10]=aa*T+na*Z;R[11]=ja*T+ta*Z;return R}function d(R,U,Z){const T=Math.sin(Z);Z=Math.cos(Z);const P=U[0],X=U[1],aa=U[2],ja=U[3],ia=U[4],ka=U[5],na=U[6],ta=U[7];U!==R&&(R[8]=U[8],R[9]=U[9],R[10]=U[10],R[11]=U[11],R[12]=U[12],R[13]=U[13],R[14]=U[14],R[15]=U[15]);R[0]=P*Z+ia*T;R[1]=X*Z+ka*T;R[2]=aa*Z+na*T;R[3]=ja*Z+ta*T;R[4]=ia*Z-P*T;R[5]=ka*Z-X*T;R[6]=na*Z-aa*T;R[7]=ta*Z-ja*T;return R}function g(R,
U){R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=1;R[11]=0;R[12]=U[0];R[13]=U[1];R[14]=U[2];R[15]=1;return R}function A(R,U){R[0]=U[0];R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=U[1];R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=U[2];R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function q(R,U,Z){let T=Z[0],P=Z[1];Z=Z[2];let X=Math.sqrt(T*T+P*P+Z*Z),aa=void 0,ja=void 0,ia=void 0;if(X<f.EPSILON)return null;X=1/X;T*=X;P*=X;Z*=X;aa=Math.sin(U);ja=Math.cos(U);ia=1-ja;R[0]=T*T*ia+ja;R[1]=P*
T*ia+Z*aa;R[2]=Z*T*ia-P*aa;R[3]=0;R[4]=T*P*ia-Z*aa;R[5]=P*P*ia+ja;R[6]=Z*P*ia+T*aa;R[7]=0;R[8]=T*Z*ia+P*aa;R[9]=P*Z*ia-T*aa;R[10]=Z*Z*ia+ja;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function y(R,U){const Z=Math.sin(U);U=Math.cos(U);R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=U;R[6]=Z;R[7]=0;R[8]=0;R[9]=-Z;R[10]=U;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function x(R,U){const Z=Math.sin(U);U=Math.cos(U);R[0]=U;R[1]=0;R[2]=-Z;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=Z;R[9]=0;R[10]=U;R[11]=
0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function D(R,U){const Z=Math.sin(U);U=Math.cos(U);R[0]=U;R[1]=Z;R[2]=0;R[3]=0;R[4]=-Z;R[5]=U;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=1;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function C(R,U,Z){var T=U[0],P=U[1],X=U[2],aa=U[3],ja=T+T,ia=P+P;const ka=X+X;U=T*ja;const na=T*ia;T*=ka;const ta=P*ia;P*=ka;X*=ka;ja*=aa;ia*=aa;aa*=ka;R[0]=1-(ta+X);R[1]=na+aa;R[2]=T-ia;R[3]=0;R[4]=na-aa;R[5]=1-(U+X);R[6]=P+ja;R[7]=0;R[8]=T+ia;R[9]=P-ja;R[10]=1-(U+ta);R[11]=0;R[12]=
Z[0];R[13]=Z[1];R[14]=Z[2];R[15]=1;return R}function B(R,U){const Z=fa,T=-U[0],P=-U[1],X=-U[2],aa=U[3],ja=U[4],ia=U[5],ka=U[6],na=U[7],ta=T*T+P*P+X*X+aa*aa;0<ta?(Z[0]=2*(ja*aa+na*T+ia*X-ka*P)/ta,Z[1]=2*(ia*aa+na*P+ka*T-ja*X)/ta,Z[2]=2*(ka*aa+na*X+ja*P-ia*T)/ta):(Z[0]=2*(ja*aa+na*T+ia*X-ka*P),Z[1]=2*(ia*aa+na*P+ka*T-ja*X),Z[2]=2*(ka*aa+na*X+ja*P-ia*T));C(R,U,Z);return R}function v(R,U){R[0]=U[12];R[1]=U[13];R[2]=U[14];return R}function E(R,U){const Z=U[0],T=U[1],P=U[2],X=U[4],aa=U[5],ja=U[6],ia=U[8],
ka=U[9];U=U[10];R[0]=Math.sqrt(Z*Z+T*T+P*P);R[1]=Math.sqrt(X*X+aa*aa+ja*ja);R[2]=Math.sqrt(ia*ia+ka*ka+U*U);return R}function F(R,U){const Z=U[0]+U[5]+U[10];let T=0;0<Z?(T=2*Math.sqrt(Z+1),R[3]=.25*T,R[0]=(U[6]-U[9])/T,R[1]=(U[8]-U[2])/T,R[2]=(U[1]-U[4])/T):U[0]>U[5]&&U[0]>U[10]?(T=2*Math.sqrt(1+U[0]-U[5]-U[10]),R[3]=(U[6]-U[9])/T,R[0]=.25*T,R[1]=(U[1]+U[4])/T,R[2]=(U[8]+U[2])/T):U[5]>U[10]?(T=2*Math.sqrt(1+U[5]-U[0]-U[10]),R[3]=(U[8]-U[2])/T,R[0]=(U[1]+U[4])/T,R[1]=.25*T,R[2]=(U[6]+U[9])/T):(T=2*
Math.sqrt(1+U[10]-U[0]-U[5]),R[3]=(U[1]-U[4])/T,R[0]=(U[8]+U[2])/T,R[1]=(U[6]+U[9])/T,R[2]=.25*T);return R}function L(R,U,Z,T){var P=U[0],X=U[1],aa=U[2],ja=U[3],ia=P+P,ka=X+X,na=aa+aa;U=P*ia;const ta=P*ka;P*=na;const pa=X*ka;X*=na;aa*=na;ia*=ja;ka*=ja;ja*=na;na=T[0];const xa=T[1];T=T[2];R[0]=(1-(pa+aa))*na;R[1]=(ta+ja)*na;R[2]=(P-ka)*na;R[3]=0;R[4]=(ta-ja)*xa;R[5]=(1-(U+aa))*xa;R[6]=(X+ia)*xa;R[7]=0;R[8]=(P+ka)*T;R[9]=(X-ia)*T;R[10]=(1-(U+pa))*T;R[11]=0;R[12]=Z[0];R[13]=Z[1];R[14]=Z[2];R[15]=1;return R}
function N(R,U,Z,T,P){var X=U[0],aa=U[1],ja=U[2],ia=U[3],ka=X+X,na=aa+aa,ta=ja+ja;U=X*ka;var pa=X*na,xa=X*ta;X=aa*na;aa*=ta;var Da=ja*ta;ja=ia*ka;na*=ia;const Ka=ia*ta;var Fa=T[0],Ha=T[1];ta=T[2];T=P[0];ia=P[1];P=P[2];ka=(1-(X+Da))*Fa;const ua=(pa+Ka)*Fa;Fa*=xa-na;pa=(pa-Ka)*Ha;Da=(1-(U+Da))*Ha;Ha*=aa+ja;xa=(xa+na)*ta;aa=(aa-ja)*ta;U=(1-(U+X))*ta;R[0]=ka;R[1]=ua;R[2]=Fa;R[3]=0;R[4]=pa;R[5]=Da;R[6]=Ha;R[7]=0;R[8]=xa;R[9]=aa;R[10]=U;R[11]=0;R[12]=Z[0]+T-(ka*T+pa*ia+xa*P);R[13]=Z[1]+ia-(ua*T+Da*ia+aa*
P);R[14]=Z[2]+P-(Fa*T+Ha*ia+U*P);R[15]=1;return R}function I(R,U){var Z=U[0],T=U[1],P=U[2];U=U[3];var X=Z+Z,aa=T+T;const ja=P+P;Z*=X;const ia=T*X;T*=aa;const ka=P*X,na=P*aa;P*=ja;X*=U;aa*=U;U*=ja;R[0]=1-T-P;R[1]=ia+U;R[2]=ka-aa;R[3]=0;R[4]=ia-U;R[5]=1-Z-P;R[6]=na+X;R[7]=0;R[8]=ka+aa;R[9]=na-X;R[10]=1-Z-T;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function G(R,U,Z,T,P,X,aa){const ja=1/(Z-U),ia=1/(P-T),ka=1/(X-aa);R[0]=2*X*ja;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=2*X*ia;R[6]=0;R[7]=0;R[8]=(Z+U)*ja;
R[9]=(P+T)*ia;R[10]=(aa+X)*ka;R[11]=-1;R[12]=0;R[13]=0;R[14]=aa*X*2*ka;R[15]=0;return R}function K(R,U,Z,T,P){U=1/Math.tan(U/2);let X=void 0;R[0]=U/Z;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=U;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[11]=-1;R[12]=0;R[13]=0;R[15]=0;null!=P&&Infinity!==P?(X=1/(T-P),R[10]=(P+T)*X,R[14]=2*P*T*X):(R[10]=-1,R[14]=-2*T);return R}function H(R,U,Z,T){const P=Math.tan(U.upDegrees*Math.PI/180),X=Math.tan(U.downDegrees*Math.PI/180),aa=Math.tan(U.leftDegrees*Math.PI/180);U=Math.tan(U.rightDegrees*
Math.PI/180);const ja=2/(aa+U),ia=2/(P+X);R[0]=ja;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=ia;R[6]=0;R[7]=0;R[8]=-((aa-U)*ja*.5);R[9]=(P-X)*ia*.5;R[10]=T/(Z-T);R[11]=-1;R[12]=0;R[13]=0;R[14]=T*Z/(Z-T);R[15]=0;return R}function J(R,U,Z,T,P,X,aa){const ja=1/(U-Z),ia=1/(T-P),ka=1/(X-aa);R[0]=-2*ja;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=-2*ia;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=2*ka;R[11]=0;R[12]=(U+Z)*ja;R[13]=(P+T)*ia;R[14]=(aa+X)*ka;R[15]=1;return R}function M(R,U,Z,T){let P=void 0,X=void 0;var aa=void 0,ja=void 0;
let ia=void 0,ka=void 0;var na=void 0,ta=void 0;let pa=void 0,xa=void 0;const Da=U[0],Ka=U[1];U=U[2];aa=T[0];ja=T[1];T=T[2];na=Z[0];ta=Z[1];Z=Z[2];if(Math.abs(Da-na)<f.EPSILON&&Math.abs(Ka-ta)<f.EPSILON&&Math.abs(U-Z)<f.EPSILON)return w(R);na=Da-na;ta=Ka-ta;pa=U-Z;xa=1/Math.sqrt(na*na+ta*ta+pa*pa);na*=xa;ta*=xa;pa*=xa;P=ja*pa-T*ta;X=T*na-aa*pa;aa=aa*ta-ja*na;(xa=Math.sqrt(P*P+X*X+aa*aa))?(xa=1/xa,P*=xa,X*=xa,aa*=xa):aa=X=P=0;ja=ta*aa-pa*X;ia=pa*P-na*aa;ka=na*X-ta*P;(xa=Math.sqrt(ja*ja+ia*ia+ka*ka))?
(xa=1/xa,ja*=xa,ia*=xa,ka*=xa):ka=ia=ja=0;R[0]=P;R[1]=ja;R[2]=na;R[3]=0;R[4]=X;R[5]=ia;R[6]=ta;R[7]=0;R[8]=aa;R[9]=ka;R[10]=pa;R[11]=0;R[12]=-(P*Da+X*Ka+aa*U);R[13]=-(ja*Da+ia*Ka+ka*U);R[14]=-(na*Da+ta*Ka+pa*U);R[15]=1;return R}function O(R,U,Z,T){const P=U[0],X=U[1];U=U[2];var aa=T[0];const ja=T[1];var ia=T[2];T=P-Z[0];let ka=X-Z[1];Z=U-Z[2];let na=T*T+ka*ka+Z*Z;0<na&&(na=1/Math.sqrt(na),T*=na,ka*=na,Z*=na);let ta=ja*Z-ia*ka;ia=ia*T-aa*Z;aa=aa*ka-ja*T;na=ta*ta+ia*ia+aa*aa;0<na&&(na=1/Math.sqrt(na),
ta*=na,ia*=na,aa*=na);R[0]=ta;R[1]=ia;R[2]=aa;R[3]=0;R[4]=ka*aa-Z*ia;R[5]=Z*ta-T*aa;R[6]=T*ia-ka*ta;R[7]=0;R[8]=T;R[9]=ka;R[10]=Z;R[11]=0;R[12]=P;R[13]=X;R[14]=U;R[15]=1;return R}function Q(R){return"mat4("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+", "+R[4]+", "+R[5]+", "+R[6]+", "+R[7]+", "+R[8]+", "+R[9]+", "+R[10]+", "+R[11]+", "+R[12]+", "+R[13]+", "+R[14]+", "+R[15]+")"}function S(R){return Math.sqrt(R[0]**2+R[1]**2+R[2]**2+R[3]**2+R[4]**2+R[5]**2+R[6]**2+R[7]**2+R[8]**2+R[9]**2+R[10]**2+R[11]**2+
R[12]**2+R[13]**2+R[14]**2+R[15]**2)}function V(R,U,Z){R[0]=U[0]+Z[0];R[1]=U[1]+Z[1];R[2]=U[2]+Z[2];R[3]=U[3]+Z[3];R[4]=U[4]+Z[4];R[5]=U[5]+Z[5];R[6]=U[6]+Z[6];R[7]=U[7]+Z[7];R[8]=U[8]+Z[8];R[9]=U[9]+Z[9];R[10]=U[10]+Z[10];R[11]=U[11]+Z[11];R[12]=U[12]+Z[12];R[13]=U[13]+Z[13];R[14]=U[14]+Z[14];R[15]=U[15]+Z[15];return R}function Y(R,U,Z){R[0]=U[0]-Z[0];R[1]=U[1]-Z[1];R[2]=U[2]-Z[2];R[3]=U[3]-Z[3];R[4]=U[4]-Z[4];R[5]=U[5]-Z[5];R[6]=U[6]-Z[6];R[7]=U[7]-Z[7];R[8]=U[8]-Z[8];R[9]=U[9]-Z[9];R[10]=U[10]-
Z[10];R[11]=U[11]-Z[11];R[12]=U[12]-Z[12];R[13]=U[13]-Z[13];R[14]=U[14]-Z[14];R[15]=U[15]-Z[15];return R}function W(R,U,Z){R[0]=U[0]*Z;R[1]=U[1]*Z;R[2]=U[2]*Z;R[3]=U[3]*Z;R[4]=U[4]*Z;R[5]=U[5]*Z;R[6]=U[6]*Z;R[7]=U[7]*Z;R[8]=U[8]*Z;R[9]=U[9]*Z;R[10]=U[10]*Z;R[11]=U[11]*Z;R[12]=U[12]*Z;R[13]=U[13]*Z;R[14]=U[14]*Z;R[15]=U[15]*Z;return R}function ba(R,U,Z,T){R[0]=U[0]+Z[0]*T;R[1]=U[1]+Z[1]*T;R[2]=U[2]+Z[2]*T;R[3]=U[3]+Z[3]*T;R[4]=U[4]+Z[4]*T;R[5]=U[5]+Z[5]*T;R[6]=U[6]+Z[6]*T;R[7]=U[7]+Z[7]*T;R[8]=U[8]+
Z[8]*T;R[9]=U[9]+Z[9]*T;R[10]=U[10]+Z[10]*T;R[11]=U[11]+Z[11]*T;R[12]=U[12]+Z[12]*T;R[13]=U[13]+Z[13]*T;R[14]=U[14]+Z[14]*T;R[15]=U[15]+Z[15]*T;return R}function ca(R,U){return R[0]===U[0]&&R[1]===U[1]&&R[2]===U[2]&&R[3]===U[3]&&R[4]===U[4]&&R[5]===U[5]&&R[6]===U[6]&&R[7]===U[7]&&R[8]===U[8]&&R[9]===U[9]&&R[10]===U[10]&&R[11]===U[11]&&R[12]===U[12]&&R[13]===U[13]&&R[14]===U[14]&&R[15]===U[15]}function da(R,U){const Z=R[0],T=R[1],P=R[2],X=R[3],aa=R[4],ja=R[5],ia=R[6],ka=R[7],na=R[8],ta=R[9],pa=R[10],
xa=R[11],Da=R[12],Ka=R[13],Fa=R[14];R=R[15];const Ha=U[0],ua=U[1],Ba=U[2],Ea=U[3],Ga=U[4],ma=U[5],ya=U[6],Ma=U[7],Ra=U[8],ea=U[9],Ua=U[10],Qa=U[11],ra=U[12],va=U[13],La=U[14];U=U[15];return Math.abs(Z-Ha)<=f.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ha))&&Math.abs(T-ua)<=f.EPSILON*Math.max(1,Math.abs(T),Math.abs(ua))&&Math.abs(P-Ba)<=f.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ba))&&Math.abs(X-Ea)<=f.EPSILON*Math.max(1,Math.abs(X),Math.abs(Ea))&&Math.abs(aa-Ga)<=f.EPSILON*Math.max(1,Math.abs(aa),Math.abs(Ga))&&
Math.abs(ja-ma)<=f.EPSILON*Math.max(1,Math.abs(ja),Math.abs(ma))&&Math.abs(ia-ya)<=f.EPSILON*Math.max(1,Math.abs(ia),Math.abs(ya))&&Math.abs(ka-Ma)<=f.EPSILON*Math.max(1,Math.abs(ka),Math.abs(Ma))&&Math.abs(na-Ra)<=f.EPSILON*Math.max(1,Math.abs(na),Math.abs(Ra))&&Math.abs(ta-ea)<=f.EPSILON*Math.max(1,Math.abs(ta),Math.abs(ea))&&Math.abs(pa-Ua)<=f.EPSILON*Math.max(1,Math.abs(pa),Math.abs(Ua))&&Math.abs(xa-Qa)<=f.EPSILON*Math.max(1,Math.abs(xa),Math.abs(Qa))&&Math.abs(Da-ra)<=f.EPSILON*Math.max(1,Math.abs(Da),
Math.abs(ra))&&Math.abs(Ka-va)<=f.EPSILON*Math.max(1,Math.abs(Ka),Math.abs(va))&&Math.abs(Fa-La)<=f.EPSILON*Math.max(1,Math.abs(Fa),Math.abs(La))&&Math.abs(R-U)<=f.EPSILON*Math.max(1,Math.abs(R),Math.abs(U))}function ha(R){const U=f.EPSILON,Z=R[0],T=R[1],P=R[2],X=R[4],aa=R[5],ja=R[6],ia=R[8],ka=R[9];R=R[10];return Math.abs(1-(Z*Z+X*X+ia*ia))<=U&&Math.abs(1-(T*T+aa*aa+ka*ka))<=U&&Math.abs(1-(P*P+ja*ja+R*R))<=U}const fa=u.create();u=Object.freeze({__proto__:null,copy:p,set:t,identity:w,transpose:e,
invert:n,adjoint:b,determinant:h,multiply:k,translate:l,scale:m,rotate:z,rotateX:r,rotateY:c,rotateZ:d,fromTranslation:g,fromScaling:A,fromRotation:q,fromXRotation:y,fromYRotation:x,fromZRotation:D,fromRotationTranslation:C,fromQuat2:B,getTranslation:v,getScaling:E,getRotation:F,fromRotationTranslationScale:L,fromRotationTranslationScaleOrigin:N,fromQuat:I,frustum:G,perspective:K,perspectiveFromFieldOfView:H,ortho:J,lookAt:M,targetTo:O,str:Q,frob:S,add:V,subtract:Y,multiplyScalar:W,multiplyScalarAndAdd:ba,
exactEquals:ca,equals:da,isOrthoNormal:ha,mul:k,sub:Y});a.add=V;a.adjoint=b;a.copy=p;a.determinant=h;a.equals=da;a.exactEquals=ca;a.frob=S;a.fromQuat=I;a.fromQuat2=B;a.fromRotation=q;a.fromRotationTranslation=C;a.fromRotationTranslationScale=L;a.fromRotationTranslationScaleOrigin=N;a.fromScaling=A;a.fromTranslation=g;a.fromXRotation=y;a.fromYRotation=x;a.fromZRotation=D;a.frustum=G;a.getRotation=F;a.getScaling=E;a.getTranslation=v;a.identity=w;a.invert=n;a.isOrthoNormal=ha;a.lookAt=M;a.mat4=u;a.mul=
k;a.multiply=k;a.multiplyScalar=W;a.multiplyScalarAndAdd=ba;a.ortho=J;a.perspective=K;a.perspectiveFromFieldOfView=H;a.rotate=z;a.rotateX=r;a.rotateY=c;a.rotateZ=d;a.scale=m;a.set=t;a.str=Q;a.sub=Y;a.subtract=Y;a.targetTo=O;a.translate=l;a.transpose=e})},"esri/chunks/pe":function(){define(["require","exports","./_rollupPluginBabelHelpers","../assets","../core/has"],function(a,u,f,p,t){function w(){return!!u._pe}function e(){return!!t("esri-wasm")}function n(){return z?z:z=(new Promise(function(c,
d){a(["./pe-wasm"],c,d)})).then(function(c){return c.peWasm}).then(({default:c})=>c({locateFile:d=>p.getAssetUrl(`esri/geometry/support/${d}`)})).then(c=>{b(c)})}function b(c){function d(q,y,x){q[y]=x(q[y])}u._pe=c;u.PeDefs.init();u.PeGTlistExtended.init();u.PeNotationMgrs.init();u.PeNotationUtm.init();u.PePCSInfo.init();u.PeGCSExtent=function(q){function y(){return q.apply(this,arguments)||this}f._inheritsLoose(y,q);y.prototype.destroy=function(){u._pe.destroy(this)};return y}(u._pe.PeGCSExtent);
c=[u._pe.PeDatum,u._pe.PeGeogcs,u._pe.PeGeogtran,u._pe.PeObject,u._pe.PeParameter,u._pe.PePrimem,u._pe.PeProjcs,u._pe.PeSpheroid,u._pe.PeUnit];for(var g of c)d(g.prototype,"getName",q=>function(){return q.call(this,Array(u.PeDefs.PE_NAME_MAX))});for(const q of[u._pe.PeGeogtran,u._pe.PeProjcs])d(q.prototype,"getParameters",y=>function(){const x=Array(u.PeDefs.PE_PARM_MAX);let D=y.call(this);for(let C=0;C<x.length;C++){const B=u._pe.getValue(D,"*");x[C]=B?u._pe.wrapPointer(B,u._pe.PeParameter):null;
D+=Int32Array.BYTES_PER_ELEMENT}return x});d(u._pe.PeHorizon.prototype,"getCoord",q=>function(){const y=this.getSize();if(!y)return null;const x=[],D=q.call(this);m(x,y,D);return x});d(u._pe.PeGTlistExtendedEntry.prototype,"getEntries",q=>{const y=u._pe._pe_getPeGTlistExtendedGTsSize();return function(){let x=null;var D=q.call(this);if(!u._pe.compare(D,u._pe.NULL)){x=[D];const C=this.getSteps();if(1<C){D=u._pe.getPointer(D);for(let B=1;B<C;B++)x.push(u._pe.wrapPointer(D+y*B,u._pe.PeGTlistExtendedGTs))}}return x}});
const A=u._pe._pe_getPeHorizonSize();g=q=>function(){let y=this._cache;y||(this._cache=y=new Map);if(y.has(q))return y.get(q);let x=null;var D=q.call(this);if(!u._pe.compare(D,u._pe.NULL)){x=[D];const C=D.getNump();if(1<C){D=u._pe.getPointer(D);for(let B=1;B<C;B++)x.push(u._pe.wrapPointer(D+A*B,u._pe.PeHorizon))}}y.set(q,x);return x};d(u._pe.PeProjcs.prototype,"horizonGcsGenerate",g);d(u._pe.PeProjcs.prototype,"horizonPcsGenerate",g);u._pe.PeObject.prototype.toString=function(q=u.PeDefs.PE_STR_OPTS_NONE){u._pe.ensureCache.prepare();
const y=u._pe.getPointer(this),x=u._pe.ensureInt8(Array(u.PeDefs.PE_BUFFER_MAX));return u._pe.UTF8ToString(u._pe._pe_object_to_string_ext(y,q,x))}}function h(c){if(c){var d=u._pe.getClass(c);d&&(d=u._pe.getCache(d))&&(c=u._pe.getPointer(c))&&delete d[c]}}function k(c,d){const g=[];d=Array(d);for(let A=0;A<c;A++)g.push(u._pe.ensureInt8(d));return g}function l(c){let d;Array.isArray(c[0])?(d=[],c.forEach(g=>{d.push(g[0],g[1])})):d=c;return d}function m(c,d,g,A=!1){if(A)for(A=0;A<2*d;A++)c[A]=u._pe.getValue(g+
A*Float64Array.BYTES_PER_ELEMENT,"double");else{A=0===c.length;for(let q=0;q<d;q++)A&&(c[q]=Array(2)),c[q][0]=u._pe.getValue(g,"double"),c[q][1]=u._pe.getValue(g+Float64Array.BYTES_PER_ELEMENT,"double"),g+=2*Float64Array.BYTES_PER_ELEMENT}}let z;u._pe=null;u.PeCSTransformations=void 0;(function(c){function d(q,y,x){u._pe.ensureCache.prepare();var D=l(x);const C=x===D;D=u._pe.ensureFloat64(D);(q=u._pe._pe_geog_to_proj(u._pe.getPointer(q),y,D))&&m(x,y,D,C);return q}function g(q,y,x){return A(q,y,x,
0)}function A(q,y,x,D){u._pe.ensureCache.prepare();var C=l(x);const B=x===C;C=u._pe.ensureFloat64(C);(q=u._pe._pe_proj_to_geog_center(u._pe.getPointer(q),y,C,D))&&m(x,y,C,B);return q}c.geogToProj=d;c.projGeog=function(q,y,x,D){switch(D){case u.PeDefs.PE_TRANSFORM_P_TO_G:return g(q,y,x);case u.PeDefs.PE_TRANSFORM_G_TO_P:return d(q,y,x)}return 0};c.projToGeog=g;c.projToGeogCenter=A})(u.PeCSTransformations||(u.PeCSTransformations={}));u.PeDefs=void 0;(function(c){c.init=function(){c.PE_BUFFER_MAX=u._pe.PeDefs.prototype.PE_BUFFER_MAX;
c.PE_NAME_MAX=u._pe.PeDefs.prototype.PE_NAME_MAX;c.PE_MGRS_MAX=u._pe.PeDefs.prototype.PE_MGRS_MAX;c.PE_USNG_MAX=u._pe.PeDefs.prototype.PE_USNG_MAX;c.PE_DD_MAX=u._pe.PeDefs.prototype.PE_DD_MAX;c.PE_DDM_MAX=u._pe.PeDefs.prototype.PE_DDM_MAX;c.PE_DMS_MAX=u._pe.PeDefs.prototype.PE_DMS_MAX;c.PE_UTM_MAX=u._pe.PeDefs.prototype.PE_UTM_MAX;c.PE_PARM_MAX=u._pe.PeDefs.prototype.PE_PARM_MAX;c.PE_TYPE_NONE=u._pe.PeDefs.prototype.PE_TYPE_NONE;c.PE_TYPE_GEOGCS=u._pe.PeDefs.prototype.PE_TYPE_GEOGCS;c.PE_TYPE_PROJCS=
u._pe.PeDefs.prototype.PE_TYPE_PROJCS;c.PE_TYPE_GEOGTRAN=u._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;c.PE_TYPE_COORDSYS=u._pe.PeDefs.prototype.PE_TYPE_COORDSYS;c.PE_TYPE_UNIT=u._pe.PeDefs.prototype.PE_TYPE_UNIT;c.PE_TYPE_LINUNIT=u._pe.PeDefs.prototype.PE_TYPE_LINUNIT;c.PE_STR_OPTS_NONE=u._pe.PeDefs.prototype.PE_STR_OPTS_NONE;c.PE_STR_AUTH_NONE=u._pe.PeDefs.prototype.PE_STR_AUTH_NONE;c.PE_STR_AUTH_TOP=u._pe.PeDefs.prototype.PE_STR_AUTH_TOP;c.PE_STR_NAME_CANON=u._pe.PeDefs.prototype.PE_STR_NAME_CANON;c.PE_PARM_X0=
u._pe.PeDefs.prototype.PE_PARM_X0;c.PE_PARM_ND=u._pe.PeDefs.prototype.PE_PARM_ND;c.PE_TRANSFORM_1_TO_2=u._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;c.PE_TRANSFORM_2_TO_1=u._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;c.PE_TRANSFORM_P_TO_G=u._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;c.PE_TRANSFORM_G_TO_P=u._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;c.PE_HORIZON_RECT=u._pe.PeDefs.prototype.PE_HORIZON_RECT;c.PE_HORIZON_POLY=u._pe.PeDefs.prototype.PE_HORIZON_POLY;c.PE_HORIZON_LINE=u._pe.PeDefs.prototype.PE_HORIZON_LINE;
c.PE_HORIZON_DELTA=u._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(u.PeDefs||(u.PeDefs={}));u.PeFactory=void 0;(function(c){function d(y,x){let D=null,C=g[y];C||(C={},g[y]=C);C.hasOwnProperty(String(x))?D=C[x]:(y=u._pe.PeFactory.prototype.factoryByType(y,x),u._pe.compare(y,u._pe.NULL)||(D=y,C[x]=D));return D=q(D)}const g={},A={},q=y=>{if(y){const x=y.getType();switch(x){case u.PeDefs.PE_TYPE_GEOGCS:y=u._pe.castObject(y,u._pe.PeGeogcs);break;case u.PeDefs.PE_TYPE_PROJCS:y=u._pe.castObject(y,u._pe.PeProjcs);
break;case u.PeDefs.PE_TYPE_GEOGTRAN:y=u._pe.castObject(y,u._pe.PeGeogtran);break;default:x&u.PeDefs.PE_TYPE_UNIT&&(y=u._pe.castObject(y,u._pe.PeUnit))}}return y};c.initialize=function(){u._pe.PeFactory.prototype.initialize(null)};c.coordsys=function(y){return d(u.PeDefs.PE_TYPE_COORDSYS,y)};c.factoryByType=d;c.fromString=function(y,x){let D=null,C=A[y];C||(C={},A[y]=C);C.hasOwnProperty(x)?D=C[x]:(y=u._pe.PeFactory.prototype.fromString(y,x),u._pe.compare(y,u._pe.NULL)||(D=y,C[x]=D));return D=q(D)};
c.geogcs=function(y){return d(u.PeDefs.PE_TYPE_GEOGCS,y)};c.geogtran=function(y){return d(u.PeDefs.PE_TYPE_GEOGTRAN,y)};c.getCode=function(y){return u._pe.PeFactory.prototype.getCode(y)};c.projcs=function(y){return d(u.PeDefs.PE_TYPE_PROJCS,y)};c.unit=function(y){return d(u.PeDefs.PE_TYPE_UNIT,y)}})(u.PeFactory||(u.PeFactory={}));u.PeGCSExtent=null;u.PeGTlistExtended=void 0;(function(c){let d;c.init=function(){c.PE_GTLIST_OPTS_COMMON=u._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;d=u._pe._pe_getPeGTlistExtendedEntrySize()};
c.getGTlist=function(g,A,q,y,x,D){let C=null;const B=new u._pe.PeInteger(D);try{const v=u._pe.PeGTlistExtended.prototype.getGTlist(g,A,q,y,x,B);if(D=B.val)if(C=[v],1<D){const E=u._pe.getPointer(v);for(g=1;g<D;g++)C.push(u._pe.wrapPointer(E+d*g,u._pe.PeGTlistExtendedEntry))}}finally{u._pe.destroy(B)}return C}})(u.PeGTlistExtended||(u.PeGTlistExtended={}));u.PeGTlistExtendedEntry=void 0;(function(c){c.destroy=function(d){if(d&&d.length){for(const g of d)h(g),g.getEntries().forEach(A=>{h(A);A=A.getGeogtran();
h(A);A.getParameters().forEach(h);[A.getGeogcs1(),A.getGeogcs2()].forEach(q=>{h(q);const y=q.getDatum();h(y);h(y.getSpheroid());h(q.getPrimem());h(q.getUnit())})});u._pe.PeGTlistExtendedEntry.prototype.Delete(d[0])}}})(u.PeGTlistExtendedEntry||(u.PeGTlistExtendedEntry={}));u.PeGTTransformations=void 0;(function(c){c.geogToGeog=function(d,g,A,q,y){u._pe.ensureCache.prepare();var x=l(A);const D=A===x;x=u._pe.ensureFloat64(x);let C=0;q&&(C=u._pe.ensureFloat64(q));(d=u._pe._pe_geog_to_geog(u._pe.getPointer(d),
g,x,C,y))&&m(A,g,x,D);return d}})(u.PeGTTransformations||(u.PeGTTransformations={}));u.PeNotationDms=void 0;(function(c){const d=(A,q,y,x,D,C)=>{u._pe.ensureCache.prepare();switch(A){case "dd":var B=u._pe._pe_geog_to_dd;var v=u.PeDefs.PE_DD_MAX;break;case "ddm":B=u._pe._pe_geog_to_ddm;v=u.PeDefs.PE_DDM_MAX;break;case "dms":B=u._pe._pe_geog_to_dms,v=u.PeDefs.PE_DMS_MAX}A=0;q&&(A=u._pe.getPointer(q));q=l(x);q=u._pe.ensureFloat64(q);v=k(y,v);x=u._pe.ensureInt32(v);if(D=B(A,y,q,D,x))for(B=0;B<y;B++)C[B]=
u._pe.UTF8ToString(v[B]);return D},g=(A,q,y,x,D)=>{u._pe.ensureCache.prepare();switch(A){case "dd":var C=u._pe._pe_dd_to_geog;break;case "ddm":C=u._pe._pe_ddm_to_geog;break;case "dms":C=u._pe._pe_dms_to_geog}A=0;q&&(A=u._pe.getPointer(q));q=x.map(B=>u._pe.ensureString(B));x=u._pe.ensureInt32(q);q=u._pe.ensureFloat64(Array(2*y));(C=C(A,y,x,q))&&m(D,y,q);return C};c.geog_to_dms=function(A,q,y,x,D){return d("dms",A,q,y,x,D)};c.dms_to_geog=function(A,q,y,x){return g("dms",A,q,y,x)};c.geog_to_ddm=function(A,
q,y,x,D){return d("ddm",A,q,y,x,D)};c.ddm_to_geog=function(A,q,y,x){return g("ddm",A,q,y,x)};c.geog_to_dd=function(A,q,y,x,D){return d("dd",A,q,y,x,D)};c.dd_to_geog=function(A,q,y,x){return g("dd",A,q,y,x)}})(u.PeNotationDms||(u.PeNotationDms={}));u.PeNotationMgrs=void 0;(function(c){c.init=function(){c.PE_MGRS_STYLE_NEW=u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;c.PE_MGRS_STYLE_OLD=u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;c.PE_MGRS_STYLE_AUTO=u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;
c.PE_MGRS_180_ZONE_1_PLUS=u._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;c.PE_MGRS_ADD_SPACES=u._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};c.geog_to_mgrs_extended=function(d,g,A,q,y,x,D){u._pe.ensureCache.prepare();let C=0;d&&(C=u._pe.getPointer(d));d=l(A);A=u._pe.ensureFloat64(d);d=k(g,u.PeDefs.PE_MGRS_MAX);const B=u._pe.ensureInt32(d);if(q=u._pe._pe_geog_to_mgrs_extended(C,g,A,q,y,x,B))for(y=0;y<g;y++)D[y]=u._pe.UTF8ToString(d[y]);return q};c.mgrs_to_geog_extended=function(d,g,A,q,
y){u._pe.ensureCache.prepare();let x=0;d&&(x=u._pe.getPointer(d));d=A.map(D=>u._pe.ensureString(D));A=u._pe.ensureInt32(d);d=u._pe.ensureFloat64(Array(2*g));(q=u._pe._pe_mgrs_to_geog_extended(x,g,A,q,d))&&m(y,g,d);return q}})(u.PeNotationMgrs||(u.PeNotationMgrs={}));u.PeNotationUsng=void 0;(function(c){c.geog_to_usng=function(d,g,A,q,y,x,D){u._pe.ensureCache.prepare();let C=0;d&&(C=u._pe.getPointer(d));d=l(A);A=u._pe.ensureFloat64(d);d=k(g,u.PeDefs.PE_MGRS_MAX);const B=u._pe.ensureInt32(d);if(q=u._pe._pe_geog_to_usng(C,
g,A,q,y,x,B))for(y=0;y<g;y++)D[y]=u._pe.UTF8ToString(d[y]);return q};c.usng_to_geog=function(d,g,A,q){u._pe.ensureCache.prepare();var y=0;d&&(y=u._pe.getPointer(d));d=A.map(x=>u._pe.ensureString(x));A=u._pe.ensureInt32(d);d=u._pe.ensureFloat64(Array(2*g));(y=u._pe._pe_usng_to_geog(y,g,A,d))&&m(q,g,d);return y}})(u.PeNotationUsng||(u.PeNotationUsng={}));u.PeNotationUtm=void 0;(function(c){c.init=function(){c.PE_UTM_OPTS_NONE=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;c.PE_UTM_OPTS_ADD_SPACES=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;
c.PE_UTM_OPTS_NS=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};c.geog_to_utm=function(d,g,A,q,y){u._pe.ensureCache.prepare();var x=0;d&&(x=u._pe.getPointer(d));d=l(A);A=u._pe.ensureFloat64(d);d=k(g,u.PeDefs.PE_UTM_MAX);const D=u._pe.ensureInt32(d);if(q=u._pe._pe_geog_to_utm(x,g,A,q,D))for(x=0;x<g;x++)y[x]=u._pe.UTF8ToString(d[x]);return q};c.utm_to_geog=function(d,g,A,q,y){u._pe.ensureCache.prepare();let x=0;d&&(x=u._pe.getPointer(d));d=A.map(D=>u._pe.ensureString(D));A=u._pe.ensureInt32(d);d=u._pe.ensureFloat64(Array(2*
g));(q=u._pe._pe_utm_to_geog(x,g,A,q,d))&&m(y,g,d);return q}})(u.PeNotationUtm||(u.PeNotationUtm={}));u.PePCSInfo=void 0;(function(c){const d=new Map;c.init=function(){c.PE_PCSINFO_OPTION_NONE=u._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;c.PE_PCSINFO_OPTION_DOMAIN=u._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;c.PE_POLE_OUTSIDE_BOUNDARY=u._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;c.PE_POLE_POINT=u._pe.PePCSInfo.prototype.PE_POLE_POINT};c.generate=function(g,A=c.PE_PCSINFO_OPTION_DOMAIN){let q,
y;d.has(g)&&(y=d.get(g),y[A]&&(q=y[A]));q||(q=u._pe.PePCSInfo.prototype.generate(g,A),y||(y=[],d.set(g,y)),y[A]=q);return q}})(u.PePCSInfo||(u.PePCSInfo={}));u.PeVersion=void 0;(function(c){c.version_string=function(){return u._pe.PeVersion.prototype.version_string()}})(u.PeVersion||(u.PeVersion={}));var r=Object.freeze({__proto__:null,get _pe(){return u._pe},isLoaded:w,isSupported:e,load:n,get PeCSTransformations(){return u.PeCSTransformations},get PeDefs(){return u.PeDefs},get PeFactory(){return u.PeFactory},
get PeGCSExtent(){return u.PeGCSExtent},get PeGTlistExtended(){return u.PeGTlistExtended},get PeGTlistExtendedEntry(){return u.PeGTlistExtendedEntry},get PeGTTransformations(){return u.PeGTTransformations},get PeNotationDms(){return u.PeNotationDms},get PeNotationMgrs(){return u.PeNotationMgrs},get PeNotationUsng(){return u.PeNotationUsng},get PeNotationUtm(){return u.PeNotationUtm},get PePCSInfo(){return u.PePCSInfo},get PeVersion(){return u.PeVersion},_init:b});u._init=b;u.isLoaded=w;u.isSupported=
e;u.load=n;u.pe=r})},"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../../core/maybe","../Extent"],function(a,u,f,p){function t(z=m){return[z[0],z[1],z[2],z[3]]}function w(z){return z[0]>=z[2]?0:z[2]-z[0]}function e(z){return z[1]>=z[3]?0:z[3]-z[1]}function n(z,r,c){return r>=z[0]&&c>=z[1]&&r<=z[2]&&c<=z[3]}function b(z,r){z[0]=r[0];z[1]=r[1];z[2]=r[2];z[3]=r[3];return z}function h(z){return 4===z.length}function k(z,r,c){return z<r?r:z>c?c:z}const l=[Infinity,
Infinity,-Infinity,-Infinity],m=[0,0,0,0];a.NEGATIVE_INFINITY=l;a.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];a.UNIT=[0,0,1,1];a.ZERO=m;a.allFinite=function(z){for(let r=0;4>r;r++)if(!isFinite(z[r]))return!1;return!0};a.area=function(z){return w(z)*e(z)};a.center=function(z,r=[0,0]){r[0]=(z[0]+z[2])/2;r[1]=(z[1]+z[3])/2;return r};a.clone=function(z){return[z[0],z[1],z[2],z[3]]};a.contains=function(z,r){return r[0]>=z[0]&&r[2]<=z[2]&&r[1]>=z[1]&&r[3]<=z[3]};a.containsPoint=function(z,
r){return n(z,r[0],r[1])};a.containsPointObject=function(z,r){return n(z,r.x,r.y)};a.containsPointWithMargin=function(z,r,c){return r[0]>=z[0]-c&&r[1]>=z[1]-c&&r[0]<=z[2]+c&&r[1]<=z[3]+c};a.containsXY=n;a.create=t;a.diameter=function(z){const r=w(z);z=e(z);return Math.sqrt(r*r+z*z)};a.distance=function(z,r){const c=(z[1]+z[3])/2,d=Math.max(Math.abs(r[0]-(z[0]+z[2])/2)-w(z)/2,0);z=Math.max(Math.abs(r[1]-c)-e(z)/2,0);return Math.sqrt(d*d+z*z)};a.empty=function(z){return z?b(z,l):t(l)};a.equals=function(z,
r,c){if(f.isNone(z)||f.isNone(r))return z===r;if(!h(z)||!h(r))return!1;if(c)for(let d=0;d<z.length;d++){if(!c(z[d],r[d]))return!1}else for(c=0;c<z.length;c++)if(z[c]!==r[c])return!1;return!0};a.expand=function(z,r,c=z){if("length"in r)if(h(r))c[0]=Math.min(z[0],r[0]),c[1]=Math.min(z[1],r[1]),c[2]=Math.max(z[2],r[2]),c[3]=Math.max(z[3],r[3]);else{if(2===r.length||3===r.length)c[0]=Math.min(z[0],r[0]),c[1]=Math.min(z[1],r[1]),c[2]=Math.max(z[2],r[0]),c[3]=Math.max(z[3],r[1])}else switch(r.type){case "extent":c[0]=
Math.min(z[0],r.xmin);c[1]=Math.min(z[1],r.ymin);c[2]=Math.max(z[2],r.xmax);c[3]=Math.max(z[3],r.ymax);break;case "point":c[0]=Math.min(z[0],r.x),c[1]=Math.min(z[1],r.y),c[2]=Math.max(z[2],r.x),c[3]=Math.max(z[3],r.y)}return c};a.expandPointInPlace=function(z,r){r[0]<z[0]&&(z[0]=r[0]);r[0]>z[2]&&(z[2]=r[0]);r[1]<z[1]&&(z[1]=r[1]);r[1]>z[3]&&(z[3]=r[1])};a.expandWithNestedArray=function(z,r,c=z){const d=r.length;let g=z[0],A=z[1],q=z[2];z=z[3];for(let y=0;y<d;y++){const x=r[y];g=Math.min(g,x[0]);A=
Math.min(A,x[1]);q=Math.max(q,x[0]);z=Math.max(z,x[1])}c[0]=g;c[1]=A;c[2]=q;c[3]=z;return c};a.fromExtent=function(z,r=t()){r[0]=z.xmin;r[1]=z.ymin;r[2]=z.xmax;r[3]=z.ymax;return r};a.fromValues=function(z,r,c,d,g=t()){g[0]=z;g[1]=r;g[2]=c;g[3]=d;return g};a.height=e;a.intersection=function(z,r,c=z){const d=r[0],g=r[1],A=r[2];r=r[3];c[0]=k(z[0],d,A);c[1]=k(z[1],g,r);c[2]=k(z[2],d,A);c[3]=k(z[3],g,r);return c};a.intersects=function(z,r){return Math.max(r[0],z[0])<=Math.min(r[2],z[2])&&Math.max(r[1],
z[1])<=Math.min(r[3],z[3])};a.is=h;a.isPoint=function(z){return(0===w(z)||!isFinite(z[0]))&&(0===e(z)||!isFinite(z[1]))};a.offset=function(z,r,c,d=z){d[0]=z[0]+r;d[1]=z[1]+c;d[2]=z[2]+r;d[3]=z[3]+c;return d};a.pad=function(z,r,c=z){c[0]=z[0]-r;c[1]=z[1]-r;c[2]=z[2]+r;c[3]=z[3]+r;return c};a.set=b;a.setMax=function(z,r,c=z){c[2]=r[0];c[3]=r[1];c!==z&&(c[0]=z[0],c[1]=z[1]);return z};a.setMin=function(z,r,c=z){c[0]=r[0];c[1]=r[1];c!==z&&(c[2]=z[2],c[3]=z[3]);return c};a.size=function(z,r){r[0]=z[2]-
z[0];r[1]=z[3]-z[1]};a.toExtent=function(z,r){return new p({xmin:z[0],ymin:z[1],xmax:z[2],ymax:z[3],spatialReference:r})};a.width=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/geodesicConstants":function(){define(["exports","./Ellipsoid"],function(a,u){const f=Math.PI/180;var p=u.earth.radius;const t=u.earth.eccentricitySquared;p={a1:p*t,a2:p*t*p*t,a3:p*t*t/2,a4:p*t*p*t*2.5,a5:p*t+p*t*t/2,a6:1-t};u={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},
4326:{a:u.earth.radius,f:u.earth.flattening},104900:{a:2439700,f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},104903:{a:u.moon.radius,f:u.moon.flattening},104904:{a:3393400,f:.005207166853303471},104905:{a:u.mars.radius,f:u.mars.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85E3,
f:0},104918:{a:1821460,f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},104922:{a:18E3,f:0},104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,f:0},104940:{a:764E3,f:0},104941:{a:11E3,
f:0},104942:{a:529800,f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},104945:{a:578900,f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},
104964:{a:29E3,f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,f:0},104968:{a:1352600,f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:u.mars.radius,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};a.WKT_SPHEROID_REGEX=/SPHEROID\[([^\]]+)]/i;a.earthEllipsoidConstants=p;a.spheroids=u;a.toRadians=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/GeographicTransformation":function(){define(["./GeographicTransformationStep"],function(a){return function(){function u(p){this.steps=
[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(p&&p.steps)for(const t of p.steps)t instanceof a?this.steps.push(t):this.steps.push(new a({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}u.cacheKey=function(p,t){return[void 0!==p.wkid&&null!==p.wkid?p.wkid.toString():"-1",void 0!==p.wkt&&null!==p.wkt?p.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join()};u.fromGE=function(p){const t=new u;let w="";for(const e of p.steps)p=
a.fromGE(e),t.steps.push(p),w+=p.uid.toString()+",";t._cached_projection={};t._gtlistentry=null;t._chain=w;return t};var f=u.prototype;f.getInverse=function(){const p=new u;p.steps=[];for(let t=this.steps.length-1;0<=t;t--)p.steps.push(this.steps[t].getInverse());return p};f.getGTListEntry=function(){let p="";for(const t of this.steps)p+=t.uid.toString()+",";p!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=p);return this._gtlistentry};f.assignCachedGe=function(p,t,w){this._cached_projection[u.cacheKey(p,
t)]=w};f.getCachedGeTransformation=function(p,t){let w="";for(const e of this.steps)w+=e.uid.toString()+",";w!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=w);p=this._cached_projection[u.cacheKey(p,t)];return void 0===p?null:p};return u}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(a){let u=0;return function(){function f(p=null){this.uid=u++;p?(this._wkt=void 0!==p.wkt?p.wkt:null,this._wkid=
void 0!==p.wkid?p.wkid:-1,this._isInverse=void 0!==p.isInverse?!0===p.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}f.fromGE=function(p){const t=new f;t._wkt=p.wkt;t._wkid=p.wkid;t._isInverse=p.isInverse;return t};f.prototype.getInverse=function(){const p=new f;p._wkt=this.wkt;p._wkid=this._wkid;p._isInverse=!this.isInverse;return p};a._createClass(f,[{key:"wkt",get:function(){return this._wkt},set:function(p){this._wkt=p;this.uid=u++}},{key:"wkid",get:function(){return this._wkid},
set:function(p){this._wkid=p;this.uid=u++}},{key:"isInverse",get:function(){return this._isInverse},set:function(p){this._isInverse=p;this.uid=u++}}]);return f}()})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,u,f,p,t,w,e,n,b,h,
k,l,m,z){function r(aa=ha){return{plane:k.create(aa.plane),origin:b.clone(aa.origin),basis1:b.clone(aa.basis1),basis2:b.clone(aa.basis2)}}function c(aa,ja,ia){const ka=Z.get();ka.origin=aa;ka.basis1=ja;ka.basis2=ia;ka.plane=k.wrap(0,0,0,0);q(ka);return ka}function d(aa,ja=r()){return A(aa.origin,aa.basis1,aa.basis2,ja)}function g(aa,ja){n.copy(ja.origin,aa.origin);n.copy(ja.basis1,aa.basis1);n.copy(ja.basis2,aa.basis2);k.copy(aa.plane,ja.plane)}function A(aa,ja,ia,ka=r()){n.copy(ka.origin,aa);n.copy(ka.basis1,
ja);n.copy(ka.basis2,ia);q(ka);1E-6<Math.abs(n.dot(ka.basis1,ka.basis2)/(n.length(ka.basis1)*n.length(ka.basis2)))&&da.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(n.dot(ka.basis1,V(ka)))&&da.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-n.dot(V(ka),ka.origin)-ka.plane[3])&&da.warn("fromValues()","Plane offset is not consistent with plane origin");return ka}function q(aa){k.fromVectorsAndPoint(aa.basis2,aa.basis1,aa.origin,
aa.plane)}function y(aa,ja,ia){aa!==ia&&d(aa,ia);aa=n.scale(z.sv3d.get(),V(aa),ja);n.add(ia.origin,ia.origin,aa);ia.plane[3]-=ja;return ia}function x(aa,ja,ia){D(ja,ia);y(ia,J(aa,aa.origin),ia);return ia}function D(aa,ja=r()){const ia=(aa[2]-aa[0])/2,ka=(aa[3]-aa[1])/2;n.set(ja.origin,aa[0]+ia,aa[1]+ka,0);n.set(ja.basis1,ia,0,0);n.set(ja.basis2,0,ka,0);k.fromValues(0,0,1,0,ja.plane);return ja}function C(aa,ja,ia){return k.intersectRay(aa.plane,ja,ia)?Y(aa,ia):!1}function B(aa,ja,ia){if(C(aa,ja,ia))return ia;
aa=v(aa,ja,z.sv3d.get());n.add(ia,ja.origin,n.scale(z.sv3d.get(),ja.direction,n.distance(ja.origin,aa)/n.length(ja.direction)));return ia}function v(aa,ja,ia){const ka=fa.get();var na=fa.get();ca(aa,ja,ka,na);na=Number.POSITIVE_INFINITY;for(const pa of T){var ta=ba(aa,pa,R.get());const xa=z.sv3d.get();k.intersectLineSegment(ka,ta,xa)&&(ta=n.direction(z.sv3d.get(),ja.origin,xa),ta=Math.abs(p.acosClamped(n.dot(ja.direction,ta))),ta<na&&(na=ta,n.copy(ia,xa)))}return na===Number.POSITIVE_INFINITY?E(aa,
ja,ia):ia}function E(aa,ja,ia){if(C(aa,ja,ia))return ia;const ka=fa.get(),na=fa.get();ca(aa,ja,ka,na);let ta=Number.POSITIVE_INFINITY;for(const xa of T){var pa=ba(aa,xa,R.get());const Da=z.sv3d.get();k.intersectLineSegmentClamp(ka,pa,Da)&&(pa=l.distance2(ja,Da),k.isPointInside(na,Da)&&pa<ta&&(ta=pa,n.copy(ia,Da)))}N(aa,ja.origin)<ta&&F(aa,ja.origin,ia);return ia}function F(aa,ja,ia){var ka=k.projectPoint(aa.plane,ja,z.sv3d.get());ja=h.projectPointClamp(W(aa,aa.basis1),ka,-1,1,z.sv3d.get());ka=h.projectPointClamp(W(aa,
aa.basis2),ka,-1,1,z.sv3d.get());n.subtract(ia,n.add(z.sv3d.get(),ja,ka),aa.origin);return ia}function L(aa,ja,ia){const {origin:ka,basis1:na,basis2:ta}=aa,pa=n.subtract(z.sv3d.get(),ja,ka);ja=m.projectPointSignedLength(na,pa);const xa=m.projectPointSignedLength(ta,pa);aa=m.projectPointSignedLength(V(aa),pa);return n.set(ia,ja,xa,aa)}function N(aa,ja){ja=L(aa,ja,z.sv3d.get());const {basis1:ia,basis2:ka}=aa;aa=n.length(ia);var na=n.length(ka);aa=Math.max(Math.abs(ja[0])-aa,0);na=Math.max(Math.abs(ja[1])-
na,0);ja=ja[2];return aa*aa+na*na+ja*ja}function I(aa,ja){return Math.sqrt(N(aa,ja))}function G(aa,ja){let ia=Number.NEGATIVE_INFINITY;for(const na of T){var ka=ba(aa,na,R.get());ka=h.distance2(ka,ja);ka>ia&&(ia=ka)}return Math.sqrt(ia)}function K(aa,ja){return k.isPointInside(aa.plane,ja)&&Y(aa,ja)}function H(aa,ja,ia,ka){switch(ia){case 0:n.copy(ka,aa.basis1);n.normalize(ka,ka);break;case 1:n.copy(ka,aa.basis2);n.normalize(ka,ka);break;case 2:n.copy(ka,V(aa))}return ka}function J(aa,ja){const ia=
-aa.plane[3];return m.projectPointSignedLength(V(aa),ja)-ia}function M(aa,ja,ia,ka){const na=J(aa,ja);aa=n.scale(U,V(aa),ia-na);n.add(ka,ja,aa);return ka}function O(aa,ja){return n.exactEquals(aa.basis1,ja.basis1)&&n.exactEquals(aa.basis2,ja.basis2)&&n.exactEquals(aa.origin,ja.origin)}function Q(aa,ja,ia){aa!==ia&&d(aa,ia);w.invert(P,ja);w.transpose(P,P);n.transformMat4(ia.basis1,aa.basis1,P);n.transformMat4(ia.basis2,aa.basis2,P);n.transformMat4(k.normal(ia.plane),k.normal(aa.plane),P);n.transformMat4(ia.origin,
aa.origin,ja);k.setOffsetFromPoint(ia.plane,ia.origin,ia.plane);return ia}function S(aa,ja,ia,ka){aa!==ka&&d(aa,ka);w.rotate(X,w.identity(X),ja,ia);n.transformMat4(ka.basis1,aa.basis1,X);n.transformMat4(ka.basis2,aa.basis2,X);q(ka);return ka}function V(aa){return k.normal(aa.plane)}function Y(aa,ja){const ia=n.subtract(z.sv3d.get(),ja,aa.origin);ja=n.squaredLength(aa.basis1);const ka=n.squaredLength(aa.basis2),na=n.dot(aa.basis1,ia);aa=n.dot(aa.basis2,ia);return 0>-na-ja&&0>na-ja&&0>-aa-ka&&0>aa-
ka}function W(aa,ja){const ia=R.get();n.copy(ia.origin,aa.origin);n.copy(ia.vector,ja);return ia}function ba(aa,ja,ia){const {basis1:ka,basis2:na,origin:ta}=aa;aa=n.scale(z.sv3d.get(),ka,ja.origin[0]);const pa=n.scale(z.sv3d.get(),na,ja.origin[1]);n.add(ia.origin,aa,pa);n.add(ia.origin,ia.origin,ta);aa=n.scale(z.sv3d.get(),ka,ja.direction[0]);ja=n.scale(z.sv3d.get(),na,ja.direction[1]);n.scale(ia.vector,n.add(aa,aa,ja),2);return ia}function ca(aa,ja,ia,ka){aa=V(aa);k.fromVectorsAndPoint(aa,ja.direction,
ja.origin,ia);k.fromVectorsAndPoint(k.normal(ia),aa,ja.origin,ka)}const da=f.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");u=function(){this.plane=k.create();this.origin=b.create();this.basis1=b.create();this.basis2=b.create()};const ha={plane:k.create(),origin:b.fromValues(0,0,0),basis1:b.fromValues(1,0,0),basis2:b.fromValues(0,1,0)},fa=new t.ObjectStack(k.create),R=new t.ObjectStack(h.create),U=b.create(),Z=new t.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),
T=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],P=e.create(),X=e.create();t=Object.freeze({__proto__:null,BoundedPlaneClass:u,create:r,wrap:c,copy:d,copyWithoutVerify:g,fromValues:A,updateUnboundedPlane:q,elevate:y,setExtent:x,fromAABoundingRect:D,intersectRay:C,intersectRayClosestSilhouette:B,closestPointOnSilhouette:v,closestPoint:E,projectPoint:F,projectPointLocal:L,distance2:N,distance:I,distanceToSilhouette:G,
extrusionContainsPoint:K,axisAt:H,altitudeAt:J,setAltitudeAt:M,equals:O,transform:Q,rotate:S,normal:V,UP:ha});a.BoundedPlaneClass=u;a.UP=ha;a.altitudeAt=J;a.axisAt=H;a.boundedPlane=t;a.closestPoint=E;a.closestPointOnSilhouette=v;a.copy=d;a.copyWithoutVerify=g;a.create=r;a.distance=I;a.distance2=N;a.distanceToSilhouette=G;a.elevate=y;a.equals=O;a.extrusionContainsPoint=K;a.fromAABoundingRect=D;a.fromValues=A;a.intersectRay=C;a.intersectRayClosestSilhouette=B;a.normal=V;a.projectPoint=F;a.projectPointLocal=
L;a.rotate=S;a.setAltitudeAt=M;a.setExtent=x;a.transform=Q;a.updateUnboundedPlane=q;a.wrap=c})},"esri/core/ObjectStack":function(){define(["exports","./maybe","./nextTick"],function(a,u,f){let p=function(){function t(e){this.allocator=e;this.items=[];this.itemsPtr=0;this.tickHandle=f.before(()=>this.reset());this.grow()}var w=t.prototype;w.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=u.nullifyNonnullableForDispose(this.tickHandle));this.items=u.nullifyNonnullableForDispose(this.items)};
w.get=function(){0===this.itemsPtr&&f(()=>{});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};w.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3072),this.items.length);this.itemsPtr=0};w.grow=function(){for(let e=0;e<Math.max(8,Math.min(this.items.length,1024));e++)this.items.push(this.allocator())};return t}();a.ObjectStack=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f64":function(){define(["exports"],
function(a){function u(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function f(n){return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]]}function p(n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){return[n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D]}function t(n,b){return new Float64Array(n,b,16)}const w=u();var e=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,IDENTITY:w});a.IDENTITY=w;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat4f64=e})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,u,f,p,t,w){function e(r){return r?{origin:t.clone(r.origin),vector:t.clone(r.vector)}:{origin:t.create(),vector:t.create()}}function n(r,c){const d=z.get();d.origin=r;d.vector=c;return d}function b(r,c,d=e()){p.copy(d.origin,r);p.copy(d.vector,c);return d}function h(r,c){c=p.subtract(w.sv3d.get(),c,r.origin);var d=p.dot(r.vector,c);const g=p.dot(r.vector,r.vector);d=u.clamp(d/g,0,1);r=p.subtract(w.sv3d.get(),p.scale(w.sv3d.get(),r.vector,d),c);return p.dot(r,r)}function k(r,c,d,g,A){const {vector:q,
origin:y}=r;c=p.subtract(w.sv3d.get(),c,y);c=p.dot(q,c)/p.squaredLength(q);p.scale(A,q,u.clamp(c,d,g));return p.add(A,A,r.origin)}function l(r,c,d,g){const A=r.origin;var q=p.add(w.sv3d.get(),A,r.vector);r=c.origin;var y=p.add(w.sv3d.get(),r,c.vector),x=w.sv3d.get();c=w.sv3d.get();x[0]=A[0]-r[0];x[1]=A[1]-r[1];x[2]=A[2]-r[2];c[0]=y[0]-r[0];c[1]=y[1]-r[1];c[2]=y[2]-r[2];if(1E-6>Math.abs(c[0])&&1E-6>Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;y=w.sv3d.get();y[0]=q[0]-A[0];y[1]=q[1]-A[1];y[2]=q[2]-
A[2];if(1E-6>Math.abs(y[0])&&1E-6>Math.abs(y[1])&&1E-6>Math.abs(y[2]))return!1;q=x[0]*c[0]+x[1]*c[1]+x[2]*c[2];var D=c[0]*y[0]+c[1]*y[1]+c[2]*y[2];const C=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],B=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*C-D*D;if(1E-6>Math.abs(B))return!1;x=(q*D-(x[0]*y[0]+x[1]*y[1]+x[2]*y[2])*C)/B;q=(q+D*x)/C;d&&(x=u.clamp(x,0,1),q=u.clamp(q,0,1));d=w.sv3d.get();D=w.sv3d.get();d[0]=A[0]+x*y[0];d[1]=A[1]+x*y[1];d[2]=A[2]+x*y[2];D[0]=r[0]+q*c[0];D[1]=r[1]+q*c[1];D[2]=r[2]+q*c[2];g.tA=x;g.tB=q;g.pA=d;
g.pB=D;g.distance2=p.squaredDistance(d,D);return!0}const m={tA:0,tB:0,pA:t.create(),pB:t.create(),distance2:0},z=new f.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(r,c){return l(r,c,!0,m)?m.distance2:null};a.closestLineSegmentPoint=function(r,c,d){return l(r,c,!0,m)?(p.copy(d,m.pA),!0):!1};a.closestRayDistance2=function(r,c){if(l(r,n(c.origin,c.direction),!1,m)){const {tA:d,pB:g,distance2:A}=m;if(0<=d&&1>=d)return A;if(0>d)return p.squaredDistance(r.origin,g);
if(1<d)return p.squaredDistance(p.add(w.sv3d.get(),r.origin,r.vector),g)}return null};a.copy=function(r,c=e()){return b(r.origin,r.vector,c)};a.create=e;a.distance=function(r,c){return Math.sqrt(h(r,c))};a.distance2=h;a.fromPoints=function(r,c,d=e()){p.copy(d.origin,r);p.subtract(d.vector,c,r);return d};a.fromValues=b;a.pointAt=function(r,c,d){return p.add(d,r.origin,p.scale(d,r.vector,c))};a.projectPoint=function(r,c,d){return k(r,c,0,1,d)};a.projectPointClamp=k;a.wrap=n;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,u){const f=u.VectorStack.createVec2f64(),p=u.VectorStack.createVec3f64(),t=u.VectorStack.createVec4f64(),w=u.VectorStack.createMat3f64(),e=u.VectorStack.createMat4f64();u=u.VectorStack.createQuatf64();a.sm3d=w;a.sm4d=e;a.sq4d=u;a.sv2d=f;a.sv3d=p;a.sv4d=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./maybe ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,u,f,p,t,w,e,n,b,h){let k=function(){function l(z,r,c){this.itemByteSize=z;this.itemCreate=r;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(c/this.itemByteSize);this.tickHandle=p.before(()=>this.reset())}var m=l.prototype;m.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=f.nullifyNonnullableForDispose(this.tickHandle));this.itemsPtr=0;this.items=f.nullifyNonnullableForDispose(this.items);this.buffers=f.nullifyNonnullableForDispose(this.buffers)};
m.get=function(){0===this.itemsPtr&&p(()=>{});const z=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=z;){const r=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let c=0;c<this.itemsPerBuffer;++c)this.items.push(this.itemCreate(r,c*this.itemByteSize));this.buffers.push(r)}return this.items[this.itemsPtr++]};m.reset=function(){const z=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>z;)this.buffers.pop(),this.items.length=this.buffers.length*
this.itemsPerBuffer;this.itemsPtr=0};l.createVec2f64=function(z=4096){return new l(16,n.createView,z)};l.createVec3f64=function(z=4096){return new l(24,b.createView,z)};l.createVec4f64=function(z=4096){return new l(32,h.createView,z)};l.createMat3f64=function(z=4096){return new l(72,t.createView,z)};l.createMat4f64=function(z=4096){return new l(128,w.createView,z)};l.createQuatf64=function(z=4096){return new l(32,e.createView,z)};u._createClass(l,[{key:"test",get:function(){return{size:this.buffers.length*
this.itemsPerBuffer*this.itemByteSize}}}]);return l}();a.VectorStack=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function u(){return[1,0,0,0,1,0,0,0,1]}function f(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function p(e,n,b,h,k,l,m,z,r){return[e,n,b,h,k,l,m,z,r]}function t(e,n){return new Float64Array(e,n,9)}var w=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t});a.clone=f;a.create=u;a.createView=
t;a.fromValues=p;a.mat3f64=w})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function u(){return[0,0,0,1]}function f(n){return[n[0],n[1],n[2],n[3]]}function p(n,b,h,k){return[n,b,h,k]}function t(n,b){return new Float64Array(n,b,4)}const w=u();var e=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,IDENTITY:w});a.IDENTITY=w;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.quatf64=e})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function u(){return[0,
0]}function f(c){return[c[0],c[1]]}function p(c,d){return[c,d]}function t(c){const d=[0,0],g=Math.min(2,c.length);for(let A=0;A<g;++A)d[A]=c[A];return d}function w(c,d){return new Float64Array(c,d,2)}function e(){return[0,0]}function n(){return[1,1]}function b(){return[1,0]}function h(){return[0,1]}const k=[0,0],l=[1,1],m=[1,0],z=[0,1];var r=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,fromArray:t,createView:w,zeros:e,ones:n,unitX:b,unitY:h,ZEROS:k,ONES:l,UNIT_X:m,UNIT_Y:z});a.ONES=
l;a.UNIT_X=m;a.UNIT_Y=z;a.ZEROS=k;a.clone=f;a.create=u;a.createView=w;a.fromArray=t;a.fromValues=p;a.ones=n;a.unitX=b;a.unitY=h;a.vec2f64=r;a.zeros=e})},"esri/chunks/vec4f64":function(){define(["exports"],function(a){function u(){return[0,0,0,0]}function f(q){return[q[0],q[1],q[2],q[3]]}function p(q,y,x,D){return[q,y,x,D]}function t(q){const y=u(),x=Math.min(4,q.length);for(let D=0;D<x;++D)y[D]=q[D];return y}function w(q,y){return new Float64Array(q,y,4)}function e(){return u()}function n(){return[1,
1,1,1]}function b(){return[1,0,0,0]}function h(){return[0,1,0,0]}function k(){return[0,0,1,0]}function l(){return[0,0,0,1]}const m=u(),z=n(),r=b(),c=h(),d=k(),g=l();var A=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,fromArray:t,createView:w,zeros:e,ones:n,unitX:b,unitY:h,unitZ:k,unitW:l,ZEROS:m,ONES:z,UNIT_X:r,UNIT_Y:c,UNIT_Z:d,UNIT_W:g});a.ONES=z;a.UNIT_W=g;a.UNIT_X=r;a.UNIT_Y=c;a.UNIT_Z=d;a.ZEROS=m;a.clone=f;a.create=u;a.createView=w;a.fromArray=t;a.fromValues=p;a.ones=n;a.unitW=
l;a.unitX=b;a.unitY=h;a.unitZ=k;a.vec4f64=A;a.zeros=e})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vectorStacks".split(" "),function(a,u,f,p,t,w,e){function n(B=C){return[B[0],B[1],B[2],B[3]]}function b(B,v=n()){return h(B[0],B[1],B[2],B[3],v)}function h(B,v,E,F,L=n()){L[0]=B;L[1]=v;L[2]=E;L[3]=F;return L}function k(B,v,E){p.copy(E,v);v=p.dot(v,v);1E-5<Math.abs(v-1)&&1E-12<v&&p.scale(E,
E,1/Math.sqrt(v));return z(E,B,E)}function l(B,v,E,F=n()){return r(p.subtract(e.sv3d.get(),B,v),p.subtract(e.sv3d.get(),E,v),B,F)}function m(B,v,E,F,L){if(3>B.count)return!1;B.getVec(E,A);let N=F,I=!1;for(;N<B.count-1&&!I;)B.getVec(N,q),N++,I=!p.exactEquals(A,q);if(!I)return!1;N=Math.max(N,L);for(I=!1;N<B.count&&!I;)B.getVec(N,y),N++,p.subtract(x,A,q),p.normalize(x,x),p.subtract(D,q,y),p.normalize(D,D),I=!p.exactEquals(A,y)&&!p.exactEquals(q,y)&&.99619469809>Math.abs(p.dot(x,D));if(!I)return 0===
E&&1===F&&2===L?!1:m(B,v,0,1,2);l(A,q,y,v);return!0}function z(B,v,E){B!==E&&b(B,E);E[3]=-p.dot(E,v);return E}function r(B,v,E,F){B=p.cross(y,v,B);return k(E,B,F)}function c(B,v,E){B=p.scale(e.sv3d.get(),B,p.dot(B,v));p.subtract(E,v,B);return E}function d(B,v){return p.dot(B,v)+B[3]}function g(B,v,E,F,L){const N=p.dot(B,E);if(0===N)return!1;B=-(p.dot(B,v)+B[3])/N;F&1&&(B=u.clamp(B,0,1));if(!(F&4)&&0>B||!(F&8)&&1<B)return!1;p.add(L,v,p.scale(L,E,B));return!0}const A=t.create(),q=t.create(),y=t.create(),
x=t.create(),D=t.create(),C=[0,0,1,0];a.UP=C;a.clip=function(B,v){const E=p.dot(B,v.ray.direction);B=-d(B,v.ray.origin);if(0>B&&0<=E)return!1;if(-1E-6<E&&1E-6>E)return 0<B;if((0>B||0>E)&&!(0>B&&0>E))return!0;B/=E;0<E?B<v.c1&&(v.c1=B):B>v.c0&&(v.c0=B);return v.c0<=v.c1};a.clipInfinite=function(B,v){const E=p.dot(B,v.ray.direction);B=-d(B,v.ray.origin);if(-1E-6<E&&1E-6>E)return 0<B;B/=E;0<E?B<v.c1&&(v.c1=B):B>v.c0&&(v.c0=B);return v.c0<=v.c1};a.copy=b;a.create=n;a.distance=function(B,v){return Math.abs(d(B,
v))};a.fromManyPoints=function(B,v){return m(B,v,0,1,2)};a.fromManyPointsSampleAt=m;a.fromNormalAndOffset=function(B,v,E){p.copy(E,B);E[3]=v;return E};a.fromPoints=l;a.fromPositionAndNormal=k;a.fromValues=h;a.fromVectorsAndPoint=r;a.intersectLine=function(B,v,E,F){E=p.subtract(e.sv3d.get(),E,v);return g(B,v,E,12,F)};a.intersectLineSegment=function(B,v,E){return g(B,v.origin,v.vector,0,E)};a.intersectLineSegmentClamp=function(B,v,E){return g(B,v.origin,v.vector,1,E)};a.intersectRay=function(B,v,E){return f.isSome(v)?
g(B,v.origin,v.direction,8,E):!1};a.isAABBFullyInside=function(B,v){const E=v[0],F=v[1],L=v[2],N=v[3],I=v[4];v=v[5];return 0<=B[0]*(0<B[0]?E:N)+B[1]*(0<B[1]?F:I)+B[2]*(0<B[2]?L:v)+B[3]};a.isPointInside=function(B,v){return 0<=d(B,v)};a.isPointOutside=function(B,v){return 0>d(B,v)};a.isSphereFullyInside=function(B,v){return 0<=d(B,w.getCenter(v))-v[3]};a.isSphereFullyOutside=function(B,v){return 0>d(B,w.getCenter(v))+v[3]};a.negate=function(B,v){v[0]=-B[0];v[1]=-B[1];v[2]=-B[2];v[3]=-B[3];return v};
a.normal=function(B){return B};a.projectPoint=function(B,v,E){const F=p.scale(e.sv3d.get(),B,-B[3]);v=p.subtract(e.sv3d.get(),v,F);B=c(B,v,e.sv3d.get());p.add(E,B,F);return E};a.projectVector=c;a.setOffsetFromPoint=z;a.signedDistance=d;a.wrap=function(B,v,E,F){return h(B,v,E,F,e.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(){return h.create()}function r(V,Y=z()){return b.copy(Y,V)}function c(V,Y){return h.fromValues(V[0],V[1],V[2],Y)}function d(V){return V}function g(V){V[0]=V[1]=V[2]=V[3]=0}function A(V){return V}function q(V){return Array.isArray(V)?V[3]:V}function y(V){return Array.isArray(V)?V:Q}function x(V,Y,W,ba){return h.fromValues(V,Y,W,ba)}function D(V,Y,W){V!==W&&e.copy(W,V);W[3]=V[3]+Y;return W}function C(V,Y,W){M.error("sphere.setExtent is not yet supported");
return V===W?W:r(V,W)}function B(V,Y,W){if(t.isNone(Y))return!1;var ba=e.subtract(m.sv3d.get(),Y.origin,y(V)),ca=e.dot(Y.direction,Y.direction);const da=2*e.dot(Y.direction,ba);V=e.dot(ba,ba)-V[3]*V[3];V=da*da-4*ca*V;if(0>V)return!1;ba=Math.sqrt(V);V=(-da-ba)/(2*ca);ca=(-da+ba)/(2*ca);if(0>V||ca<V&&0<ca)V=ca;if(0>V)return!1;W&&e.add(W,Y.origin,e.scale(m.sv3d.get(),Y.direction,V));return!0}function v(V,Y){return B(V,Y,null)}function E(V,Y,W){if(B(V,Y,W))return W;V=F(V,Y,m.sv3d.get());e.add(W,Y.origin,
e.scale(m.sv3d.get(),Y.direction,e.distance(Y.origin,V)/e.length(Y.direction)));return W}function F(V,Y,W){const ba=m.sv3d.get(),ca=m.sm4d.get();e.cross(ba,Y.origin,Y.direction);const da=q(V);e.cross(W,ba,Y.origin);e.scale(W,W,1/e.length(W)*da);V=G(V,Y.origin);Y=l.angle(Y.origin,W);w.identity(ca);w.rotate(ca,ca,Y+V,ba);e.transformMat4(W,W,ca);return W}function L(V,Y,W){if(B(V,Y,W))return W;k.closestPoint(Y,y(V),W);return N(V,W,W)}function N(V,Y,W){Y=e.subtract(m.sv3d.get(),Y,y(V));Y=e.scale(m.sv3d.get(),
Y,V[3]/e.length(Y));return e.add(W,Y,y(V))}function I(V,Y){Y=e.subtract(m.sv3d.get(),Y,y(V));Y=e.squaredLength(Y);return Math.sqrt(Math.abs(Y-V[3]*V[3]))}function G(V,Y){Y=e.subtract(m.sv3d.get(),Y,y(V));Y=e.length(Y);V=q(V);return p.acosClamped(V/(V+Math.abs(V-Y)))}function K(V,Y,W,ba){V=e.subtract(O,Y,y(V));switch(W){case 0:return W=p.cartesianToSpherical(V,O)[2],e.set(ba,-Math.sin(W),Math.cos(W),0);case 1:return V=p.cartesianToSpherical(V,O),W=V[1],V=V[2],Y=Math.sin(W),e.set(ba,-Y*Math.cos(V),
-Y*Math.sin(V),Math.cos(W));case 2:return e.normalize(ba,V)}}function H(V,Y){Y=e.subtract(S,Y,y(V));return e.length(Y)-V[3]}function J(V,Y,W,ba){const ca=H(V,Y);V=K(V,Y,2,S);W=e.scale(S,V,W-ca);return e.add(ba,Y,W)}const M=f.getLogger("esri.geometry.support.sphere"),O=n.create(),Q=n.create(),S=n.create();u=Object.freeze({__proto__:null,create:z,copy:r,fromCenterAndRadius:c,wrap:d,clear:g,fromRadius:A,getRadius:q,getCenter:y,fromValues:x,elevate:D,setExtent:C,intersectRay:B,intersectsRay:v,intersectRayClosestSilhouette:E,
closestPointOnSilhouette:F,closestPoint:L,projectPoint:N,distanceToSilhouette:I,angleToSilhouette:G,axisAt:K,altitudeAt:H,setAltitudeAt:J});a.altitudeAt=H;a.angleToSilhouette=G;a.axisAt=K;a.clear=g;a.closestPoint=L;a.closestPointOnSilhouette=F;a.copy=r;a.create=z;a.distanceToSilhouette=I;a.elevate=D;a.fromCenterAndRadius=c;a.fromRadius=A;a.fromValues=x;a.getCenter=y;a.getRadius=q;a.intersectRay=B;a.intersectRayClosestSilhouette=E;a.intersectsRay=v;a.projectPoint=N;a.setAltitudeAt=J;a.setExtent=C;
a.sphere=u;a.wrap=d})},"esri/chunks/vec4":function(){define(["exports","./common"],function(a,u){function f(G,K){G[0]=K[0];G[1]=K[1];G[2]=K[2];G[3]=K[3];return G}function p(G,K,H,J,M){G[0]=K;G[1]=H;G[2]=J;G[3]=M;return G}function t(G,K,H){G[0]=K[0]+H[0];G[1]=K[1]+H[1];G[2]=K[2]+H[2];G[3]=K[3]+H[3];return G}function w(G,K,H){G[0]=K[0]-H[0];G[1]=K[1]-H[1];G[2]=K[2]-H[2];G[3]=K[3]-H[3];return G}function e(G,K,H){G[0]=K[0]*H[0];G[1]=K[1]*H[1];G[2]=K[2]*H[2];G[3]=K[3]*H[3];return G}function n(G,K,H){G[0]=
K[0]/H[0];G[1]=K[1]/H[1];G[2]=K[2]/H[2];G[3]=K[3]/H[3];return G}function b(G,K){G[0]=Math.ceil(K[0]);G[1]=Math.ceil(K[1]);G[2]=Math.ceil(K[2]);G[3]=Math.ceil(K[3]);return G}function h(G,K){G[0]=Math.floor(K[0]);G[1]=Math.floor(K[1]);G[2]=Math.floor(K[2]);G[3]=Math.floor(K[3]);return G}function k(G,K,H){G[0]=Math.min(K[0],H[0]);G[1]=Math.min(K[1],H[1]);G[2]=Math.min(K[2],H[2]);G[3]=Math.min(K[3],H[3]);return G}function l(G,K,H){G[0]=Math.max(K[0],H[0]);G[1]=Math.max(K[1],H[1]);G[2]=Math.max(K[2],H[2]);
G[3]=Math.max(K[3],H[3]);return G}function m(G,K){G[0]=Math.round(K[0]);G[1]=Math.round(K[1]);G[2]=Math.round(K[2]);G[3]=Math.round(K[3]);return G}function z(G,K,H){G[0]=K[0]*H;G[1]=K[1]*H;G[2]=K[2]*H;G[3]=K[3]*H;return G}function r(G,K,H,J){G[0]=K[0]+H[0]*J;G[1]=K[1]+H[1]*J;G[2]=K[2]+H[2]*J;G[3]=K[3]+H[3]*J;return G}function c(G,K){const H=K[0]-G[0],J=K[1]-G[1],M=K[2]-G[2];G=K[3]-G[3];return Math.sqrt(H*H+J*J+M*M+G*G)}function d(G,K){const H=K[0]-G[0],J=K[1]-G[1],M=K[2]-G[2];G=K[3]-G[3];return H*
H+J*J+M*M+G*G}function g(G){const K=G[0],H=G[1],J=G[2];G=G[3];return Math.sqrt(K*K+H*H+J*J+G*G)}function A(G){const K=G[0],H=G[1],J=G[2];G=G[3];return K*K+H*H+J*J+G*G}function q(G,K){G[0]=-K[0];G[1]=-K[1];G[2]=-K[2];G[3]=-K[3];return G}function y(G,K){G[0]=1/K[0];G[1]=1/K[1];G[2]=1/K[2];G[3]=1/K[3];return G}function x(G,K){const H=K[0],J=K[1],M=K[2];K=K[3];let O=H*H+J*J+M*M+K*K;0<O&&(O=1/Math.sqrt(O),G[0]=H*O,G[1]=J*O,G[2]=M*O,G[3]=K*O);return G}function D(G,K){return G[0]*K[0]+G[1]*K[1]+G[2]*K[2]+
G[3]*K[3]}function C(G,K,H,J){const M=K[0],O=K[1],Q=K[2];K=K[3];G[0]=M+J*(H[0]-M);G[1]=O+J*(H[1]-O);G[2]=Q+J*(H[2]-Q);G[3]=K+J*(H[3]-K);return G}function B(G,K){K=K||1;let H,J,M,O;let Q;do{H=2*u.RANDOM()-1;J=2*u.RANDOM()-1;var S=H*H+J*J}while(1<=S);do M=2*u.RANDOM()-1,O=2*u.RANDOM()-1,Q=M*M+O*O;while(1<=Q);S=Math.sqrt((1-S)/Q);G[0]=K*H;G[1]=K*J;G[2]=K*M*S;G[3]=K*O*S;return G}function v(G,K,H){const J=K[0],M=K[1],O=K[2];K=K[3];G[0]=H[0]*J+H[4]*M+H[8]*O+H[12]*K;G[1]=H[1]*J+H[5]*M+H[9]*O+H[13]*K;G[2]=
H[2]*J+H[6]*M+H[10]*O+H[14]*K;G[3]=H[3]*J+H[7]*M+H[11]*O+H[15]*K;return G}function E(G,K,H){var J=K[0];const M=K[1],O=K[2],Q=H[0],S=H[1],V=H[2];H=H[3];const Y=H*J+S*O-V*M,W=H*M+V*J-Q*O,ba=H*O+Q*M-S*J;J=-Q*J-S*M-V*O;G[0]=Y*H+J*-Q+W*-V-ba*-S;G[1]=W*H+J*-S+ba*-Q-Y*-V;G[2]=ba*H+J*-V+Y*-S-W*-Q;G[3]=K[3];return G}function F(G){return"vec4("+G[0]+", "+G[1]+", "+G[2]+", "+G[3]+")"}function L(G,K){return G[0]===K[0]&&G[1]===K[1]&&G[2]===K[2]&&G[3]===K[3]}function N(G,K){const H=G[0],J=G[1],M=G[2];G=G[3];const O=
K[0],Q=K[1],S=K[2];K=K[3];return Math.abs(H-O)<=u.EPSILON*Math.max(1,Math.abs(H),Math.abs(O))&&Math.abs(J-Q)<=u.EPSILON*Math.max(1,Math.abs(J),Math.abs(Q))&&Math.abs(M-S)<=u.EPSILON*Math.max(1,Math.abs(M),Math.abs(S))&&Math.abs(G-K)<=u.EPSILON*Math.max(1,Math.abs(G),Math.abs(K))}var I=Object.freeze({__proto__:null,copy:f,set:p,add:t,subtract:w,multiply:e,divide:n,ceil:b,floor:h,min:k,max:l,round:m,scale:z,scaleAndAdd:r,distance:c,squaredDistance:d,length:g,squaredLength:A,negate:q,inverse:y,normalize:x,
dot:D,lerp:C,random:B,transformMat4:v,transformQuat:E,str:F,exactEquals:L,equals:N,sub:w,mul:e,div:n,dist:c,sqrDist:d,len:g,sqrLen:A});a.add=t;a.ceil=b;a.copy=f;a.dist=c;a.distance=c;a.div=n;a.divide=n;a.dot=D;a.equals=N;a.exactEquals=L;a.floor=h;a.inverse=y;a.len=g;a.length=g;a.lerp=C;a.max=l;a.min=k;a.mul=e;a.multiply=e;a.negate=q;a.normalize=x;a.random=B;a.round=m;a.scale=z;a.scaleAndAdd=r;a.set=p;a.sqrDist=d;a.sqrLen=A;a.squaredDistance=d;a.squaredLength=A;a.str=F;a.sub=w;a.subtract=w;a.transformMat4=
v;a.transformQuat=E;a.vec4=I})},"esri/geometry/support/ray":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","../../chunks/vec3f64","./vectorStacks"],function(a,u,f,p,t){function w(h){return h?{origin:p.clone(h.origin),direction:p.clone(h.direction)}:{origin:p.create(),direction:p.create()}}function e(h,k,l=w()){f.copy(l.origin,h);f.copy(l.direction,k);return l}function n(h,k){h=f.cross(t.sv3d.get(),f.normalize(t.sv3d.get(),h.direction),f.subtract(t.sv3d.get(),k,h.origin));
return f.dot(h,h)}const b=new u.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(h,k,l){k=f.dot(h.direction,f.subtract(l,k,h.origin));f.add(l,h.origin,f.scale(l,h.direction,k));return l};a.copy=function(h,k=w()){return e(h.origin,h.direction,k)};a.create=w;a.distance=function(h,k){return Math.sqrt(n(h,k))};a.distance2=n;a.fromPoints=function(h,k,l=w()){f.copy(l.origin,h);f.subtract(l.direction,k,h);return l};a.fromValues=e;a.wrap=function(h,k){const l=b.get();l.origin=
h;l.direction=k;return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,u,f,p){const t=p.create(),w=p.create();a.angle=function(e,n){e=f.dot(e,n)/(f.length(e)*f.length(n));return-u.acosClamped(e)};a.angleAroundAxis=function(e,n,b){f.normalize(t,e);f.normalize(w,n);e=f.dot(t,w);e=u.acosClamped(e);n=f.cross(t,t,w);return 0>f.dot(n,b)?2*Math.PI-e:e};a.projectPoint=
function(e,n,b){n=f.dot(e,n)/f.dot(e,e);return f.scale(b,e,n)};a.projectPointSignedLength=function(e,n){return f.dot(e,n)/f.length(e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(a,u){function f(p,t){t=u.getMetersPerUnitForSR(t);return p/(t*u.inchesPerMeter*96)}a.getExtentForScale=function(p,t){const w=p.extent;p=p.width;t=f(t,w.spatialReference);return w.clone().expand(t*p/w.width)};a.getResolutionForScale=
f;a.getScale=function(p,t){t=t||p.extent;p=p.width;const w=u.getMetersPerUnitForSR(t&&t.spatialReference);return t&&p?t.width/p*w*u.inchesPerMeter*96:0};a.getScaleForResolution=function(p,t){t=u.getMetersPerUnitForSR(t);return p*t*u.inchesPerMeter*96};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(a){a.areLabelsVisible=function(u){return!0===u.labelsVisible&&null!=u.labelingInfo&&0<u.labelingInfo.length};a.getLayersForScale=
function(u,f){const p=[];if(0<u&&f)for(let t=0;t<f.length;t++)if(!(0<=f[t].parentLayerId&&-1===p.indexOf(f[t].parentLayerId)&&f.some(function(w){return w.id===f[t].parentLayerId}))&&0<=f[t].id){let w=!0;const e=f[t].maxScale,n=f[t].minScale;if(0<e||0<n)0<e&&0<n?w=e<=u&&u<=n:0<e?w=e<=u:0<n&&(w=u<=n);w&&p.push(f[t].id)}return p};a.isBaseLayer=function(u){return u.parent&&"esri.Basemap"===u.parent.declaredClass&&-1<u.parent.baseLayers.indexOf(u)};a.isTiledLayer=function(u){return u&&"base-tile"===u.type||
"tile"===u.type||"elevation"===u.type||"imagery-tile"===u.type||"base-elevation"===u.type||"open-street-map"===u.type||"wcs"===u.type||"web-tile"===u.type||"wmts"===u.type||"vector-tile"===u.type};a.serializeLayerDefinitions=function(u){const f=/[:;]/,p=[];let t=!1;if(u&&(u.forEach(function(w,e){p.push([e,w]);!t&&f.test(w)&&(t=!0)}),0<p.length)){if(t){const w={};p.forEach(e=>{w[e[0]]=e[1]});u=JSON.stringify(w)}else{const w=[];p.forEach(e=>{w.push(e[0]+":"+e[1])});u=w.join(";")}return u}return null};
a.serializeTimeOptions=function(u){if(u){var f=[];u.forEach(function(p,t){f.push('"'+t+'":'+JSON.stringify(p))});if(f.length)return"{"+f.join(",")+"}"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){function m(c,d){return d?z[c].valueToClassName[d].split(" "):[]}const z={widthBreakpoint:{getValue(c){const d=c.viewSize[0];c=c.breakpoints;const g=this.values;return d<=c.xsmall?g.xsmall:d<=c.small?g.small:d<=c.medium?g.medium:d<=c.large?g.large:g.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(c){const d=c.viewSize[1];c=c.breakpoints;const g=this.values;return d<=c.xsmall?g.xsmall:d<=c.small?g.small:d<=c.medium?g.medium:d<=c.large?g.large:g.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(c){c=c.viewSize;const d=this.values;return c[1]>=c[0]?d.portrait:d.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},r={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
c=>{c=function(d){function g(...q){q=d.call(this,...q)||this;q._breakpointsHandles=new t;q.orientation=null;q.widthBreakpoint=null;q.heightBreakpoint=null;q.breakpoints=r;return q}u._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this._breakpointsHandles.add(w.init(this,["breakpoints","size"],this._updateClassNames))};A.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};A._updateClassNames=function(){if(this.container){var q=
p.acquire(),y=p.acquire(),x=!1,D;for(D in z){const C=this[D],B=z[D].getValue({viewSize:this.size,breakpoints:this.breakpoints});C!==B&&(x=!0,this[D]=B,m(D,C).forEach(v=>y.push(v)),m(D,B).forEach(v=>q.push(v)))}x&&(this._applyClassNameChanges(q,y),p.release(q),p.release(y))}};A._applyClassNameChanges=function(q,y){const x=this.container;x&&(y.forEach(D=>x.classList.remove(D)),q.forEach(D=>x.classList.add(D)))};A._removeActiveClassNames=function(){const q=this.container;if(q)for(var y in z)m(y,this[y]).forEach(x=>
q.classList.remove(x))};u._createClass(g,[{key:"breakpoints",set:function(q){var y=this._get("breakpoints");if(q!==y){y=(y=q)&&y.xsmall<y.small&&y.small<y.medium&&y.medium<y.large;if(!y){const x=JSON.stringify(r,null,2);console.warn("provided breakpoints are not valid, using defaults:"+x)}q=y?q:r;this._set("breakpoints",{...q})}}}]);return g}(c);f.__decorate([e.property()],c.prototype,"breakpoints",null);f.__decorate([e.property()],c.prototype,"orientation",void 0);f.__decorate([e.property()],c.prototype,
"widthBreakpoint",void 0);f.__decorate([e.property()],c.prototype,"heightBreakpoint",void 0);return c=f.__decorate([l.subclass("esri.views.BreakpointsOwner")],c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){f=function(z){function r(d){d=z.call(this,d)||this;d.handles=new t;d.view=null;d.layerViews=new p;return d}a._inheritsLoose(r,z);var c=r.prototype;c.initialize=function(){this.handles.add(w.when(this,"view.map.ground",d=>d.load()));this.handles.add(this.layerViews.on("after-changes",()=>this.layerViewsAfterChangesHandler()))};c.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};c.layerViewsAfterChangesHandler=function(){this.handles.remove("updating");
this.handles.add(this.layerViews.map(d=>d.watch("updating",()=>this.updateUpdating(),!0)).toArray(),"updating");this.updateUpdating()};c.updateUpdating=function(){this.notifyChange("updating")};a._createClass(r,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new m({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(d=>d.updating)}},{key:"suspended",
get:function(){return!this.view||this.view.suspended}}]);return r}(f);u.__decorate([e.property({readOnly:!0})],f.prototype,"elevationSampler",null);u.__decorate([e.property({type:Boolean,readOnly:!0})],f.prototype,"updating",null);u.__decorate([e.property({constructOnly:!0})],f.prototype,"view",void 0);u.__decorate([e.property({type:p,readOnly:!0})],f.prototype,"layerViews",void 0);u.__decorate([e.property({readOnly:!0})],f.prototype,"suspended",null);return f=u.__decorate([l.subclass("esri.views.GroundView")],
f)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){const c=p.getLogger("esri.views.support.GroundViewElevationSampler");f=function(d){function g(q){q=d.call(this,q)||this;q.demResolution={min:-1,max:-1};q.noDataValue=r.ELEVATION_NODATA_VALUE;return q}a._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};A.elevationAt=function(q){var y=q.spatialReference;const x=this.spatialReference;if(!l.canProject(y,x))return c.error(`Cannot sample elevation at a location with spatial reference (${y?
y.wkid:"unknown"}) different from the view (${x.wkid})`),null;k.extentContainsPoint(this.extent,q)||(y=this.extent,c.warn("#elevationAt()",`Point used to sample elevation (${q.x}, ${q.y}) is outside of the sampler extent (${`${y.xmin}, ${y.ymin}, ${y.xmax}, ${y.ymax}`})`));return z.getElevationAtPoint(this.view.elevationProvider,q)};A.queryElevation=function(q){return m.updateGeometryElevation(q.clone(),this)};a._createClass(g,[{key:"extent",get:function(){const q=this.view.basemapTerrain;return q.extent&&
q.spatialReference?h.toExtent(q.extent,q.spatialReference):null}}]);return g}(f.EventedAccessor);u.__decorate([t.property({readOnly:!0})],f.prototype,"demResolution",void 0);u.__decorate([t.property({readOnly:!0})],f.prototype,"extent",null);u.__decorate([t.property({readOnly:!0})],f.prototype,"noDataValue",void 0);u.__decorate([t.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],f.prototype,"spatialReference",void 0);u.__decorate([t.property({constructOnly:!0})],f.prototype,
"view",void 0);return f=u.__decorate([b.subclass("esri.views.support.GroundViewElevationSampler")],f)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(a,u,f,p,t,w,e,n,b,h,k){function l(g,A){const q=m(g,A.spatialReference);
if(!q)return null;switch(g.type){case "point":g.z=w.unwrapOr(A.elevationAt(q),0);break;case "polyline":c.spatialReference=q.spatialReference;var y=g.hasM&&!g.hasZ;for(var x=0;x<g.paths.length;x++){var D=g.paths[x],C=q.paths[x];for(let B=0;B<D.length;B++){const v=D[B],E=C[B];c.x=E[0];c.y=E[1];y&&(v[3]=v[2]);v[2]=w.unwrapOr(A.elevationAt(c),0)}}g.hasZ=!0;break;case "multipoint":c.spatialReference=q.spatialReference;y=g.hasM&&!g.hasZ;for(x=0;x<g.points.length;x++)D=g.points[x],C=q.points[x],c.x=C[0],
c.y=C[1],y&&(D[3]=D[2]),D[2]=w.unwrapOr(A.elevationAt(c),0);g.hasZ=!0}return g}function m(g,A){const q=g.spatialReference;return q.equals(A)?g:h.canProject(q,A)?h.project(g,A):(z.error(`Cannot project geometry spatial reference (wkid:${q.wkid}) to elevation sampler spatial reference (wkid:${A.wkid})`),null)}const z=t.getLogger("esri.layers.support.ElevationSampler");f=function(){function g(){}var A=g.prototype;A.queryElevation=function(q){return l(q.clone(),this)};A.on=function(){return d};A.projectIfRequired=
function(q,y){return m(q,y)};return g}();let r=function(g){function A(y,x,D){var C=g.call(this)||this;C.tile=y;C.noDataValue=D;C.extent=n.toExtent(y.tile.extent,x.spatialReference);D=e.getMetersPerUnitForSR(x.spatialReference);y=x.lodAt(y.tile.level).resolution*D;C.demResolution={min:y,max:y};return C}u._inheritsLoose(A,g);var q=A.prototype;q.contains=function(y){y=this.projectIfRequired(y,this.spatialReference);return b.extentContainsPoint(this.extent,y)};q.elevationAt=function(y){const x=this.projectIfRequired(y,
this.spatialReference);if(!x)return null;if(!this.contains(y)){const D=this.extent;z.warn("#elevationAt()",`Point used to sample elevation (${y.x}, ${y.y}) is outside of the sampler extent (${`${D.xmin}, ${D.ymin}, ${D.xmax}, ${D.ymax}`})`)}return this.tile.sample(x.x,x.y)};u._createClass(A,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return A}(f);p=function(g){function A(q,y,x){var D=g.call(this)||this;let C;"number"===typeof y?(D.noDataValue=y,C=null):(C=y,D.noDataValue=
x);D.samplers=C?q.map(B=>new r(B,C,D.noDataValue)):q;if(q=D.samplers[0]){D.extent=q.extent.clone();const {min:B,max:v}=q.demResolution;D.demResolution={min:B,max:v};for(q=1;q<D.samplers.length;q++)y=D.samplers[q],D.extent.union(y.extent),D.demResolution.min=Math.min(D.demResolution.min,y.demResolution.min),D.demResolution.max=Math.max(D.demResolution.max,y.demResolution.max)}else D.extent=n.toExtent(n.create(),C.spatialReference),D.demResolution={min:0,max:0};return D}u._inheritsLoose(A,g);A.prototype.elevationAt=
function(q){const y=this.projectIfRequired(q,this.spatialReference);if(!y)return null;for(const x of this.samplers)if(x.contains(y))return x.elevationAt(y);z.warn("#elevationAt()",`Point used to sample elevation (${q.x}, ${q.y}) is outside of the sampler`);return null};u._createClass(A,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return A}(f);const c=new k,d={remove(){}};a.ElevationSamplerBase=f;a.MultiTileElevationSampler=p;a.TileElevationSampler=r;a.updateGeometryElevation=
l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,u,f){function p(t){return"array"in t}a.SamplePosition=function(t,w=null,e=0){this.array=t;this.spatialReference=w;this.offset=e};a.getElevationAtPoint=function(t,w,e="ground"){if(f.isDehydratedPoint(w))return t.getElevation(w.x,w.y,w.z||0,w.spatialReference,e);if(p(w)){let n=w.offset;return t.getElevation(w.array[n++],
w.array[n++],w.array[n]||0,u.unwrapOr(w.spatialReference,t.spatialReference),e)}return t.getElevation(w[0],w[1],w[2]||0,t.spatialReference,e)};a.isSamplePosition=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(u){return"point"===u.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils",
"../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,u,f,p){u=u.clampFloat32(u.NUMBER_MAX_FLOAT32/10);const t=f.create();p.WebMercatorAuxiliarySphere.getExtent(0,0,0,t);f=f.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;a.ELEVATION_NODATA_VALUE=u;a.GEOGRAPHIC_WORLD_EXTENT=f;a.GEOMETRY_VERTEX_STRIDE=5;a.LayerClasses=[0,1];a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
a.WEBMERCATOR_WORLD_EXTENT=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){let m=function(){function r(d){var g=r.checkUnsupported(d);if(g)throw g;this.spatialReference=d.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=e.canProjectToWGS84ComparableLonLat(this.spatialReference)||h.isMars(this.spatialReference)||h.isMoon(this.spatialReference);this.origin=[d.origin.x,d.origin.y];this.pixelSize=d.size[0];this.dpi=d.dpi;var A=d.lods.reduce(function(x,D,C){D.level<x.min&&(x.min=D.level,x.minIndex=C);x.max=
Math.max(x.max,D.level);return x},{min:Infinity,minIndex:0,max:-Infinity}),q=d.lods[A.minIndex];const y=2**q.level;g=q.resolution*y;q=q.scale*y;this.levels=Array(A.max+1);for(A=0;A<this.levels.length;A++)this.levels[A]={resolution:g,scale:q,tileSize:[g*d.size[0],g*d.size[1]]},g/=2,q/=2}var c=r.prototype;c.clone=function(){return new r(this.toTileInfo())};c.toTileInfo=function(){return new l({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,
this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((d,g)=>({level:g,scale:d.scale,resolution:d.resolution}))})};c.getExtent=function(d,g,A,q){var y=this.levels[d];d=y.tileSize[0];y=y.tileSize[1];q[0]=this.origin[0]+A*d;q[2]=q[0]+d;q[3]=this.origin[1]-g*y;q[1]=q[3]-y};c.convertExtentToRadians=function(d,g){this._isWebMercator?(g[0]=k.x2lon(d[0]),g[1]=k.y2lat(d[1]),g[2]=k.x2lon(d[2]),g[3]=k.y2lat(d[3])):this._isGCS&&(g[0]=f.deg2rad(d[0]),g[1]=f.deg2rad(d[1]),g[2]=f.deg2rad(d[2]),
g[3]=f.deg2rad(d[3]))};c.getExtentGeometry=function(d,g,A,q=new w){this.getExtent(d,g,A,z);q.spatialReference=this.spatialReference;q.xmin=z[0];q.ymin=z[1];q.xmax=z[2];q.ymax=z[3];q.zmin=void 0;q.zmax=void 0;return q};c.ensureMaxLod=function(d){if(null==d)return!1;for(var g=!1;this.levels.length<=d;){g=this.levels[this.levels.length-1];const A=g.resolution/2;this.levels.push({resolution:A,scale:g.scale/2,tileSize:[A*this.pixelSize,A*this.pixelSize]});g=!0}return g};c.capMaxLod=function(d){this.levels.length>
d+1&&(this.levels.length=d+1)};c.getMaxLod=function(){return this.levels.length-1};c.scaleAtLevel=function(d){return this.levels[0].scale/2**d};c.levelAtScale=function(d){const g=this.levels[0].scale;return d>=g?0:Math.log(g/d)*Math.LOG2E};c.resolutionAtLevel=function(d){return this.levels[0].resolution/2**d};c.compatibleWith=function(d){if(!(d instanceof r)){if(r.checkUnsupported(d))return!1;d=new r(d)}if(!d.spatialReference.equals(this.spatialReference)||d.pixelSize!==this.pixelSize)return!1;const g=
Math.min(this.levels.length,d.levels.length)-1,A=this.levels[g].resolution;let q=.5*A;if(!f.floatEqualAbsolute(d.origin[0],this.origin[0],q)||!f.floatEqualAbsolute(d.origin[1],this.origin[1],q))return!1;q=.5*A/2**g/this.pixelSize*12;return f.floatEqualAbsolute(A,d.levels[g].resolution,q)};c.rootTilesInExtent=function(d,g=null,A=Infinity){const q=this.levels[0].tileSize;if(0===q[0]||0===q[1])return[];r.computeRowColExtent(d,q,this.origin,z);d=z[1];let y=z[3],x=z[0],D=z[2];var C=D-x,B=y-d;C*B>A&&(A=
Math.floor(Math.sqrt(A)),B>A&&(d=d+Math.floor(.5*B)-Math.floor(.5*A),y=d+A),C>A&&(x=x+Math.floor(.5*C)-Math.floor(.5*A),D=x+A));A=[];for(C=d;C<y;C++)for(B=x;B<D;B++)A.push([0,C,B]);p.isSome(g)&&(g[0]=this.origin[0]+x*q[0],g[1]=this.origin[1]-y*q[1],g[2]=this.origin[0]+D*q[0],g[3]=this.origin[1]-d*q[1]);return A};r.computeRowColExtent=function(d,g,A,q){const y=.001*(d[2]-d[0]+(d[3]-d[1]));q[0]=Math.max(0,Math.floor((d[0]+y-A[0])/g[0]));q[2]=Math.max(0,Math.ceil((d[2]-y-A[0])/g[0]));q[1]=Math.max(0,
Math.floor((A[1]-d[3]+y)/g[1]));q[3]=Math.max(0,Math.ceil((A[1]-d[1]-y)/g[1]))};r.isPowerOfTwo=function(d){d=d.lods;const g=d[0].resolution*2**d[0].level;return!d.some(function(A){return!f.floatEqualRelative(A.resolution,g/2**A.level)})};r.hasGapInLevels=function(d){d=d.lods.map(function(g){return g.level});d.sort(function(g,A){return g-A});for(let g=1;g<d.length;g++)if(d[g]!==d[0]+g)return!0;return!1};r.tileSizeSupported=function(d){const g=d.size[1];return g===d.size[0]&&0===(g&g-1)&&128<=g&&512>=
g};r.checkUnsupported=function(d){return d?1>d.lods.length?new u("tilingscheme:generic","Tiling scheme must have at least one level"):r.isPowerOfTwo(d)?r.hasGapInLevels(d)?new u("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):r.tileSizeSupported(d)?null:new u("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new u("tilingscheme:power-of-two","Tiling scheme must be power of two"):new u("tilingscheme:tile-info-missing",
"Tiling scheme must have tiling information")};r.fromExtent=function(d,g){const A=d[2]-d[0],q=d[3]-d[1],y=t.getMetersPerUnitForSR(g),x=1.2*Math.max(A,q);d=new r(new l({size:[256,256],origin:{x:d[0]-.5*(x-A),y:d[3]+.5*(x-q)},lods:[{level:0,resolution:x/256,scale:1/(256/96*.0254/(x*y))}],spatialReference:g}));d.ensureMaxLod(20);return d};r.makeWebMercatorAuxiliarySphere=function(d){const g=new r(r.WebMercatorAuxiliarySphereTileInfo);g.ensureMaxLod(d);return g};r.makeGCSWithTileSize=function(d,g=256,
A=16){const q=256/g;d=new r(new l({size:[g,g],origin:{x:-180,y:90,spatialReference:d},spatialReference:d,lods:[{level:0,resolution:.703125*q,scale:2.95497598570834E8*q}]}));d.ensureMaxLod(A);return d};a._createClass(r,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return r}();m.WebMercatorAuxiliarySphereTileInfo=new l({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:n.WebMercator},spatialReference:n.WebMercator,lods:[{level:0,
resolution:156543.03392800014,scale:5.91657527591555E8}]});m.WebMercatorAuxiliarySphere=m.makeWebMercatorAuxiliarySphere(19);const z=b.create();return m})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){var A;f=new f.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});p=A=function(q){function y(D){D=q.call(this,D)||this;D.dpi=96;D.format=null;D.origin=null;D.minScale=0;D.maxScale=0;D.size=null;D.spatialReference=null;return D}a._inheritsLoose(y,q);y.create=function(D=
{}){const {resolutionFactor:C=1,scales:B,size:v=256,spatialReference:E=z.WebMercator,numLODs:F=24}=D;if(!c.isValid(E)){D=[];if(B)for(var L=0;L<B.length;L++){var N=B[L];D.push({level:L,scale:N,resolution:N})}else for(L=5E-4,N=F-1;0<=N;N--)D.unshift({level:N,scale:L,resolution:L}),L*=2;return new A({dpi:96,lods:D,origin:new m(0,0,E),size:[v,v],spatialReference:E})}L=c.getInfo(E);D=D.origin?new m({x:D.origin.x,y:D.origin.y,spatialReference:E}):L?new m({x:L.origin[0],y:L.origin[1],spatialReference:E}):
new m({x:0,y:0,spatialReference:E});L=1/(39.37*t.getMetersPerUnitForSR(E)*96);N=[];if(B)for(var I=0;I<B.length;I++){var G=B[I];N.push({level:I,scale:G,resolution:G*L})}else{var K=c.isGeographic(E)?512/v*5.916575275917094E8:256/v*5.91657527591555E8;I=Math.ceil(F/C);N.push({level:0,scale:K,resolution:K*L});for(G=1;G<I;G++)K/=2**C,N.push({level:G,scale:K,resolution:K*L})}return new A({dpi:96,lods:N,origin:D,size:[v,v],spatialReference:E})};var x=y.prototype;x.readOrigin=function(D,C){return m.fromJSON({spatialReference:C.spatialReference,
...D})};x.readSize=function(D,C){return[C.cols,C.rows]};x.writeSize=function(D,C){C.cols=D[0];C.rows=D[0]};x.zoomToScale=function(D){const C=this.scales;if(0>=D)return C[0];if(D>=C.length-1)return C[C.length-1];{const B=Math.floor(D);return C[B]/(C[B]/C[B+1])**(D-B)}};x.scaleToZoom=function(D){const C=this.scales,B=C.length-1;let v=0;for(;v<B;v++){const E=C[v],F=C[v+1];if(E<=D)break;if(F===D)return v+1;if(E>D&&F<D)return v+Math.log(E/D)/Math.log(E/F)}return v};x.snapScale=function(D,C=.95){D=this.scaleToZoom(D);
return D%Math.floor(D)>=C?this.zoomToScale(Math.ceil(D)):this.zoomToScale(Math.floor(D))};x.tileAt=function(D,C,B,v){var E=this.lodAt(D);if(!E)return null;let F;if("number"===typeof C)F=C,C=B;else{if(c.equals(C.spatialReference,this.spatialReference))F=C.x,C=C.y;else{v=d.project(C,this.spatialReference);if(!v)return null;F=v.x;C=v.y}v=B}B=E.resolution*this.size[0];E=E.resolution*this.size[1];v||(v={id:null,level:0,row:0,col:0,extent:r.create()});v.level=D;v.row=Math.floor((this.origin.y-C)/E+.001);
v.col=Math.floor((F-this.origin.x)/B+.001);this.updateTileInfo(v);return v};x.updateTileInfo=function(D,C=0){var B=this.lodAt(D.level);B||1!==C||(C=this.lods[this.lods.length-1],C.level<D.level&&(B=C));if(B){var v=D.level-B.level;C=B.resolution*this.size[0]/2**v;B=B.resolution*this.size[1]/2**v;D.id=`${D.level}/${D.row}/${D.col}`;D.extent||(D.extent=r.create());D.extent[0]=this.origin.x+D.col*C;D.extent[1]=this.origin.y-(D.row+1)*B;D.extent[2]=D.extent[0]+C;D.extent[3]=D.extent[1]+B}};x.upsampleTile=
function(D){const C=this._upsampleLevels[D.level];if(!C||-1===C.parentLevel)return!1;D.level=C.parentLevel;D.row=Math.floor(D.row/C.factor+.001);D.col=Math.floor(D.col/C.factor+.001);this.updateTileInfo(D);return!0};x.getTileBounds=function(D,C){var {resolution:B}=this.lodAt(C.level);const v=B*this.size[0];B*=this.size[1];D[0]=this.origin.x+C.col*v;D[1]=this.origin.y-(C.row+1)*B;D[2]=D[0]+v;D[3]=D[1]+B;return D};x.lodAt=function(D){return this._levelToLOD&&this._levelToLOD[D]||null};x.clone=function(){return A.fromJSON(this.write({}))};
x._initializeUpsampleLevels=function(){const D=this.lods;this._upsampleLevels=[];let C=null;for(let B=0;B<D.length;B++){const v=D[B];this._upsampleLevels[v.level]={parentLevel:C?C.level:-1,factor:C?C.resolution/v.resolution:0};C=v}};a._createClass(y,[{key:"isWrappable",get:function(){const {spatialReference:D,origin:C}=this;if(D&&C){const B=c.getInfo(D);return D.isWrappable&&Math.abs(B.origin[0]-C.x)<=B.dx}return!1}},{key:"lods",set:function(D){let C=0,B=0;const v=[];this._levelToLOD={};D&&(C=-Infinity,
B=Infinity,D.forEach(E=>{v.push(E.scale);C=E.scale>C?E.scale:C;B=E.scale<B?E.scale:B;this._levelToLOD[E.level]=E}));this._set("scales",v);this._set("minScale",C);this._set("maxScale",B);this._set("lods",D);this._initializeUpsampleLevels()}}]);return y}(p.JSONSupport);u.__decorate([w.property({type:Number,json:{write:!0}})],p.prototype,"compressionQuality",void 0);u.__decorate([w.property({type:Number,json:{write:!0}})],p.prototype,"dpi",void 0);u.__decorate([w.property({type:String,json:{read:f.read,
write:f.write,origins:{"web-scene":{read:!1,write:!1}}}})],p.prototype,"format",void 0);u.__decorate([w.property({readOnly:!0})],p.prototype,"isWrappable",null);u.__decorate([w.property({type:m,json:{write:!0}})],p.prototype,"origin",void 0);u.__decorate([h.reader("origin")],p.prototype,"readOrigin",null);u.__decorate([w.property({type:[g],value:null,json:{write:!0}})],p.prototype,"lods",null);u.__decorate([w.property({readOnly:!0})],p.prototype,"minScale",void 0);u.__decorate([w.property({readOnly:!0})],
p.prototype,"maxScale",void 0);u.__decorate([w.property({readOnly:!0})],p.prototype,"scales",void 0);u.__decorate([w.property({cast:q=>Array.isArray(q)?q:"number"===typeof q?[q,q]:[256,256]})],p.prototype,"size",void 0);u.__decorate([h.reader("size",["rows","cols"])],p.prototype,"readSize",null);u.__decorate([l.writer("size",{cols:{type:n.Integer},rows:{type:n.Integer}})],p.prototype,"writeSize",null);u.__decorate([w.property({type:z,json:{write:!0}})],p.prototype,"spatialReference",void 0);return p=
A=u.__decorate([k.subclass("esri.layers.support.TileInfo")],p)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b){var h;f=h=function(k){function l(m){m=k.call(this,m)||this;m.level=0;m.levelValue=
null;m.resolution=0;m.scale=0;return m}a._inheritsLoose(l,k);l.prototype.clone=function(){return new h({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return l}(f.JSONSupport);u.__decorate([p.property({type:w.Integer,json:{write:!0}})],f.prototype,"level",void 0);u.__decorate([p.property({type:String,json:{write:!0}})],f.prototype,"levelValue",void 0);u.__decorate([p.property({type:Number,json:{write:!0}})],f.prototype,"resolution",void 0);u.__decorate([p.property({type:Number,
json:{write:!0}})],f.prototype,"scale",void 0);return f=h=u.__decorate([b.subclass("esri.layers.support.LOD")],f)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l){a.PopupView=
m=>{m=function(z){function r(){return z.apply(this,arguments)||this}u._inheritsLoose(r,z);var c=r.prototype;c.fetchPopupFeatures=function(){var d=u._asyncToGenerator(function*(g,A){yield this.when();const {location:q,queryArea:y,layerViewsAndGraphics:x,clientOnlyGraphics:D}=yield this._prepareFetchPopupFeatures(g,A);g=Promise.resolve(D);A=this._queryLayerPopupFeatures({queryArea:y,layerViewsAndGraphics:x,options:A});const C=A.map(B=>B.promise);g=w.eachAlwaysValues([g,...C]).then(p.flatten);return{location:q,
clientOnlyGraphics:D,allGraphicsPromise:g,promisesPerLayerView:A}});return function(g,A){return d.apply(this,arguments)}}();c._queryLayerPopupFeatures=function({queryArea:d,layerViewsAndGraphics:g,options:A}){return g.map(({layerView:q,graphics:y})=>{y={clientGraphics:y,event:t.isSome(A)?A.event:null,signal:t.isSome(A)?A.signal:null,defaultPopupTemplateEnabled:t.isSome(A)?!!A.defaultPopupTemplateEnabled:!1};y=q.fetchPopupFeatures(d,y);return{layerView:q,promise:y}})};c._isValidPopupGraphic=function(d,
g){return d&&!!d.getEffectivePopupTemplate(t.isSome(g)&&g.defaultPopupTemplateEnabled)};c._prepareFetchPopupFeatures=function(){var d=u._asyncToGenerator(function*(g,A){const {clientGraphics:q,queryArea:y,location:x}=yield this._popupHitTestGraphics(g,A);g=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:D,clientOnlyGraphics:C}=this._graphicsPerFetchPopupLayerView(q,g);return{clientOnlyGraphics:C,layerViewsAndGraphics:D,queryArea:y,location:x}});return function(g,A){return d.apply(this,
arguments)}}();c._popupHitTestGraphics=function(){var d=u._asyncToGenerator(function*(g,A){const {results:q,mapPoint:y}=yield this.popupHitTest(g);g=q.filter(D=>this._isValidPopupGraphic(D.graphic,A));const x=g.length?g[0].mapPoint:null;return{clientGraphics:g.map(D=>D.graphic),queryArea:y,location:y||x}});return function(g,A){return d.apply(this,arguments)}}();c._getFetchPopupLayerViews=function(){const d=[];this.allLayerViews.forEach(g=>{this._isValidPopupLayerView(g)&&d.push(g)});t.isSome(this.graphicsView)&&
this._isValidPopupLayerView(this.graphicsView)&&d.push(this.graphicsView);return d.reverse()};c._isValidPopupLayerView=function(d){return t.isSome(d)&&(!("layer"in d)||!d.suspended)&&"fetchPopupFeatures"in d};c._graphicsPerFetchPopupLayerView=function(d,g){const A=[],q=new Map;g=g.map(y=>{const x=[];"layer"in y?q.set(y.layer,x):q.set(y.graphics,x);return{layerView:y,graphics:x}});for(const y of d)(d=q.get(y.layer)||q.get(y.sourceLayer)||null)?d.push(y):A.push(y);return{layerViewsAndGraphics:g,clientOnlyGraphics:A}};
return r}(m);return m=f.__decorate([l.subclass("esri.views.PopupView")],m)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ViewingMode":function(){define(["exports"],function(a){a.stringFromViewingMode=function(u){return 1===u?"global":"local"};a.viewingModeFromString=function(u){return"global"===u?1:2};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,
u,f,p){function t(b){return Object.freeze({__proto__:null,"default":b})}const w=()=>new Promise(function(b,h){a(["./layers/TileLayerView3D"],function(k){b(t(k))},h)}),e=()=>new Promise(function(b,h){a(["./layers/ElevationLayerView3D"],function(k){b(t(k))},h)}),n={"base-dynamic":()=>new Promise(function(b,h){a(["./layers/BaseDynamicLayerView3D"],function(k){b(t(k))},h)}),"base-elevation":e,"base-tile":w,"bing-maps":w,"building-scene":()=>new Promise(function(b,h){a(["./layers/BuildingSceneLayerView3D"],
function(k){b(t(k))},h)}),csv:()=>new Promise(function(b,h){a(["./layers/CSVLayerView3D"],function(k){b(t(k))},h)}),"direct-line-measurement":()=>new Promise(function(b,h){a(["./layers/DirectLineMeasurementLayerView3D"],function(k){b(t(k))},h)}),"area-measurement":()=>new Promise(function(b,h){a(["./layers/AreaMeasurementLayerView3D"],function(k){b(t(k))},h)}),elevation:e,feature:()=>new Promise(function(b,h){a(["./layers/FeatureLayerView3D"],function(k){b(t(k))},h)}),geojson:()=>new Promise(function(b,
h){a(["./layers/GeoJSONLayerView3D"],function(k){b(t(k))},h)}),graphics:()=>new Promise(function(b,h){a(["./layers/GraphicsLayerView3D"],function(k){b(t(k))},h)}),group:()=>new Promise(function(b,h){a(["../layers/GroupLayerView"],function(k){b(t(k))},h)}),imagery:()=>new Promise(function(b,h){a(["./layers/ImageryLayerView3D"],function(k){b(t(k))},h)}),"integrated-mesh":()=>new Promise(function(b,h){a(["./layers/IntegratedMeshLayerView3D"],function(k){b(t(k))},h)}),"line-of-sight":()=>new Promise(function(b,
h){a(["./layers/LineOfSightLayerView3D"],b,h)}),"map-image":()=>new Promise(function(b,h){a(["./layers/MapImageLayerView3D"],function(k){b(t(k))},h)}),"ogc-feature":()=>new Promise(function(b,h){a(["./layers/OGCFeatureLayerView3D"],function(k){b(t(k))},h)}),"open-street-map":w,"point-cloud":()=>new Promise(function(b,h){a(["./layers/PointCloudLayerView3D"],function(k){b(t(k))},h)}),voxel:()=>new Promise(function(b,h){a(["./layers/VoxelLayerView3D"],function(k){b(t(k))},h)}),scene:b=>null==b.profile||
"mesh-pyramids"===b.profile?new Promise(function(h,k){a(["./layers/SceneLayerView3D"],function(l){h(t(l))},k)}):new Promise(function(h,k){a(["./layers/SceneLayerGraphicsView3D"],function(l){h(t(l))},k)}),stream:()=>new Promise(function(b,h){a(["./layers/StreamLayerView3D"],function(k){b(t(k))},h)}),tile:w,"imagery-tile":()=>new Promise(function(b,h){a(["./layers/ImageryTileLayerView3D"],function(k){b(t(k))},h)}),"vector-tile":()=>new Promise(function(b,h){a(["./layers/VectorTileLayerView3D"],function(k){b(t(k))},
h)}),wcs:()=>new Promise(function(b,h){a(["./layers/ImageryTileLayerView3D"],function(k){b(t(k))},h)}),"web-tile":w,wfs:()=>new Promise(function(b,h){a(["./layers/WFSLayerView3D"],function(k){b(t(k))},h)}),wms:()=>new Promise(function(b,h){a(["./layers/WMSLayerView3D"],function(k){b(t(k))},h)}),wmts:()=>new Promise(function(b,h){a(["./layers/WMTSLayerView3D"],function(k){b(t(k))},h)}),slice:()=>new Promise(function(b,h){a(["./layers/SliceLayerView3D"],b,h)}),"geo-rss":null,kml:null,"map-notes":null,
route:null,"subtype-group":null,unknown:null,unsupported:null};u.layerView3DImporter={hasLayerViewModule:b=>p.isSome(n[b.type]),importLayerView:b=>{var h=n[b.type];if(!p.isSome(h))throw b=b.declaredClass?b.declaredClass.slice(b.declaredClass.lastIndexOf(".")+1):"Unknown",h=b.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),b=new f(`${h}:view-not-supported`,`${b} is not supported in 3D`),b;return h(b)}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.Constraints=function(z){function r(){var c=z.apply(this,arguments)||this;c.tilt=new m["default"];c.altitude=new k["default"];c.clipDistance=new l["default"];return c}u._inheritsLoose(r,z);return r}(p);f.__decorate([t.property({type:m["default"]})],a.Constraints.prototype,"tilt",void 0);f.__decorate([t.property({type:k["default"]})],a.Constraints.prototype,"altitude",void 0);f.__decorate([t.property({type:l["default"]})],a.Constraints.prototype,"clipDistance",
void 0);a.Constraints=f.__decorate([h.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);a.default=a.Constraints;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){a.AltitudeConstraint=function(m){function z(){var r=m.apply(this,arguments)||this;r.min=l.earthAltitudeConstraint.min;r.max=l.earthAltitudeConstraint.max;return r}u._inheritsLoose(z,m);u._createClass(z,[{key:"mode",get:function(){t.deprecated(w.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},
set:function(r){t.deprecated(w.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}}]);return z}(p);f.__decorate([e.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);f.__decorate([e.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=f.__decorate([k.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);a.default=a.AltitudeConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../support/mathUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){const z=t.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(g){function A(y){y=g.call(this,y)||this;y.collision=new d;y.distance=Infinity;y.minimumPoiDistance=4;return y}u._inheritsLoose(A,g);var q=A.prototype;q.clampAltitude=function(y){return this.altitude?w.clamp(y,this.altitude.min,this.altitude.max):y};q.clampTilt=function(y,x){if(!this.tilt)return x;y=this.tilt(y);return w.clamp(x,y.min,y.max)};q.clampDistance=function(y){return Math.min(y,
this.distance)};q.createDefaultTilt=function(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};q.createConstantMaxTilt=function(y){return(x,D=c)=>{D.min=r.min;D.max=y;return D}};q.createDefaultTiltLocal=function(){const y=this.collision.enabled?m.makePiecewiseLinearFunction([[4E3,r.max],[1E4,w.deg2rad(88)],[6E6,w.deg2rad(88)]]):()=>r.max;return(x,D=c)=>{D.min=r.min;D.max=y(x);return D}};q.createDefaultTiltGlobal=function(){const y=this.collision.enabled?m.makePiecewiseLinearFunction([[4E3,
r.max],[5E4,w.deg2rad(88)],[6E6,w.deg2rad(88)],[2E7,r.min]]):m.makePiecewiseLinearFunction([[3E5,r.max],[3E6,w.deg2rad(88)],[6E6,w.deg2rad(88)],[2E7,r.min]]);return(x,D=c)=>{D.min=r.min;D.max=y(x);return D}};u._createClass(A,[{key:"altitude",get:function(){return 2===this.mode?null:this._get("altitude")||null},set:function(y){2===this.mode?z.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",y)}}]);return A}(p);f.__decorate([e.property()],a.Constraints.prototype,"altitude",
null);f.__decorate([e.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);f.__decorate([e.property()],a.Constraints.prototype,"distance",void 0);f.__decorate([e.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);f.__decorate([e.property()],a.Constraints.prototype,"tilt",void 0);f.__decorate([e.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=f.__decorate([k.subclass("esri.views.3d.state.Constraints")],a.Constraints);t={min:-2E5,
max:4*l.earth.radius};const r={min:w.deg2rad(.5),max:w.deg2rad(179.5)},c={min:0,max:0};let d=function(g){function A(){var q=g.apply(this,arguments)||this;q.enabled=!0;q.elevationMargin=5;return q}u._inheritsLoose(A,g);return A}(p);f.__decorate([e.property({type:Boolean})],d.prototype,"enabled",void 0);f.__decorate([e.property({type:Number})],d.prototype,"elevationMargin",void 0);d=f.__decorate([k.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],d);f=a.Constraints;a.TiltDefault=r;a.default=
f;a.earthAltitudeConstraint=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b,h){a.ClipDistanceConstraint=
function(k){function l(){var z=k.apply(this,arguments)||this;z.mode="auto";return z}u._inheritsLoose(l,k);var m=l.prototype;m.castNear=function(z){return Math.max(1E-8,z)};m.castFar=function(z){return Math.max(1E-8,z)};m.autoUpdate=function(z,r){"auto"===this.mode&&(this._get("near")!==z&&this._set("near",z),this._get("far")!==r&&this._set("far",r))};u._createClass(l,[{key:"near",get:function(){return this._get("near")},set:function(z){this._set("near",z);z>=this._get("far")&&(this.far=z+1E-9);this.mode=
"manual"}},{key:"far",get:function(){return this._get("far")},set:function(z){this._set("far",z);z<=this._get("near")&&(this.near=z-1E-9);this.mode="manual"}}]);return l}(p);f.__decorate([t.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);f.__decorate([e.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);f.__decorate([t.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);f.__decorate([e.cast("far")],a.ClipDistanceConstraint.prototype,
"castFar",null);f.__decorate([t.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=f.__decorate([h.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);a.default=a.ClipDistanceConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m=t.rad2deg(l.TiltDefault.min),z=t.rad2deg(l.TiltDefault.max);a.TiltConstraint=function(r){function c(){var g=r.apply(this,arguments)||this;g.mode="auto";return g}u._inheritsLoose(c,r);var d=c.prototype;d.castMax=function(g){return t.clamp(g,m,z)};d.autoUpdate=function(g){"auto"===this.mode&&this._get("max")!==g&&this._set("max",g)};u._createClass(c,[{key:"max",get:function(){return this._get("max")},set:function(g){this._set("max",g);this.mode="manual"}}]);return c}(p);
f.__decorate([w.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);f.__decorate([w.property({type:Number,value:z})],a.TiltConstraint.prototype,"max",null);f.__decorate([n.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=f.__decorate([k.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);a.default=a.TiltConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/has ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){var r;w=r=function(c){function d(A){A=c.call(this,A)||this;A.atmosphere=new k["default"];return A}a._inheritsLoose(d,c);d.fromWebsceneEnvironment=function(A){A=A.cloneConstructProperties();return new r({...A,lighting:l.SceneViewLighting.fromWebsceneLighting(A.lighting)})};var g=d.prototype;g.castLighting=function(A){return this.convertLighting(A)};g.applyLighting=function(A){this.lighting=this.convertLighting(A)};g.convertLighting=function(A){return A?A instanceof
l.SceneViewLighting?A:A instanceof z?this.lighting?this.lighting.cloneWithWebsceneLighting(A):l.SceneViewLighting.fromWebsceneLighting(A):h.ensureType(l.SceneViewLighting,A):new l.SceneViewLighting};g.clone=function(){return new r({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:f.clone(this.background)})};g.cloneWithWebsceneEnvironment=function(A){return new r({atmosphere:this.atmosphere.clone(),
atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:f.clone(this.background),...A.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(A.lighting):l.SceneViewLighting.fromWebsceneLighting(A.lighting)})};return d}(m);u.__decorate([p.property({type:k["default"],json:{read:!1}})],w.prototype,"atmosphere",void 0);u.__decorate([p.property()],w.prototype,"lighting",void 0);u.__decorate([t.cast("lighting")],w.prototype,"castLighting",
null);return w=r=u.__decorate([b.subclass("esri.views.3d.environment.SceneViewEnvironment")],w)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,
n,b,h){var k;a.SceneViewAtmosphere=k=function(l){function m(){return l.apply(this,arguments)||this}u._inheritsLoose(m,l);m.prototype.clone=function(){return new k({quality:this.quality})};u._createClass(m,[{key:"quality",set:function(z){-1!==["low","high"].indexOf(z)&&this._set("quality",z)}}]);return m}(p);f.__decorate([t.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=k=f.__decorate([h.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);a.default=a.SceneViewAtmosphere;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewLighting":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l({hours:r,minutes:c,seconds:d}){return Math.round(r+c/60+d/3600)}var m;a.SceneViewLighting=m=function(r){function c(g){g=r.call(this,g)||this;g.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};g.cameraTrackingEnabled=!0;g.ambientOcclusionEnabled=!1;g.waterReflectionEnabled=!1;var A=(new Date).getFullYear();A=new Date("March 15, "+A+" 12:00:00 UTC");g._set("defaultDate",A);g._set("date",A);return g}u._inheritsLoose(c,r);c.fromWebsceneLighting=
function(g){return new m({...g.cloneConstructProperties()})};var d=c.prototype;d.autoUpdate=function(g,A){const q=l(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=A.hours;this.positionTimezoneInfo.minutes=A.minutes;this.positionTimezoneInfo.seconds=A.seconds;A=null;null!=g&&(this.positionTimezoneInfo.autoUpdated=!0,A=this.date&&this.date.getTime(),this._set("date",new Date(g.getTime())));const y=l(this.positionTimezoneInfo);q!==y&&(z.target=this,z.timezoneOffset=y,this.emit("timezone-will-change",
z));if(null!=g)return A!==g.getTime()};d.clone=function(){const g=this._get("date")===this._get("defaultDate"),A=new m({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});g&&A._set("date",A._get("defaultDate"));A.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;A.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;
A.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;A.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return A};d.cloneWithWebsceneLighting=function(g){const A=this.clone();null!=g.date&&(A.date=g.date);A.directShadowsEnabled=g.directShadowsEnabled;A.displayUTCOffset=g.displayUTCOffset;return A};u._createClass(c,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(g){const A=this._get("date")===this._get("defaultDate");g=
new Date(g.getTime());this._set("defaultDate",g);A&&this._set("date",g)}},{key:"date",set:function(g){null!=g&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(g.getTime())))}}]);return c}(p.EventedMixin(k));f.__decorate([t.property({type:Boolean})],a.SceneViewLighting.prototype,"cameraTrackingEnabled",void 0);f.__decorate([t.property({type:Boolean})],a.SceneViewLighting.prototype,"ambientOcclusionEnabled",void 0);f.__decorate([t.property({type:Boolean})],a.SceneViewLighting.prototype,
"waterReflectionEnabled",void 0);f.__decorate([t.property({type:Date})],a.SceneViewLighting.prototype,"defaultDate",null);f.__decorate([t.property({type:Date})],a.SceneViewLighting.prototype,"date",null);a.SceneViewLighting=m=f.__decorate([h.subclass("esri.views.3d.environment.SceneViewLighting")],a.SceneViewLighting);const z={target:null,timezoneOffset:0};f=a.SceneViewLighting;a.calculateTimezoneOffset=l;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){var l;f=l=function(m){function z(c){c=m.call(this,c)||this;c.date=null;c.directShadowsEnabled=!1;c.displayUTCOffset=null;return c}a._inheritsLoose(z,m);var r=z.prototype;r.readDate=function(c,d){return null!=d.datetime&&new Date(d.datetime)||null};r.writeDate=function(c,d,g){d[g]=c.getTime()};r.readDirectShadowsEnabled=function(c,d){return!!d.directShadows};r.writedirectShadowsEnabled=function(c,d,g){c&&(d[g]=c)};r.writeDisplayUTCOffset=function(c,d){null!=c&&(d.displayUTCOffset=
c)};r.clone=function(){return new l(this.cloneConstructProperties())};r.cloneConstructProperties=function(){const c={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c};return z}(f.JSONSupport);u.__decorate([p.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],f.prototype,"date",void 0);u.__decorate([b.reader("date",["datetime"])],f.prototype,"readDate",
null);u.__decorate([k.writer("date")],f.prototype,"writeDate",null);u.__decorate([p.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],f.prototype,"directShadowsEnabled",void 0);u.__decorate([b.reader("directShadowsEnabled",["directShadows"])],f.prototype,"readDirectShadowsEnabled",null);u.__decorate([k.writer("directShadowsEnabled")],f.prototype,"writedirectShadowsEnabled",null);u.__decorate([p.property({type:Number,json:{write:!0}})],f.prototype,"displayUTCOffset",void 0);
u.__decorate([k.writer("displayUTCOffset")],f.prototype,"writeDisplayUTCOffset",null);return f=l=u.__decorate([h.subclass("esri.webscene.Lighting")],f)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ./Lighting ./background/utils".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k,l){var m;w=(z,r,c)=>({enabled:!c||!c.isPresentation});f=m=function(z){function r(d){d=z.call(this,d)||this;d.lighting=new k;d.background=null;d.atmosphereEnabled=!0;d.starsEnabled=!0;return d}a._inheritsLoose(r,z);var c=r.prototype;c.clone=function(){return new m(this.cloneConstructProperties())};c.cloneConstructProperties=function(){return{lighting:k.prototype.clone.call(this.lighting),background:p.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
return r}(f.JSONSupport);u.__decorate([t.property({type:k,json:{write:!0}})],f.prototype,"lighting",void 0);u.__decorate([t.property(l.backgroundProperty)],f.prototype,"background",void 0);u.__decorate([t.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:w}}})],f.prototype,"atmosphereEnabled",void 0);u.__decorate([t.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:w}}})],f.prototype,"starsEnabled",void 0);return f=m=u.__decorate([h.subclass("esri.webscene.Environment")],
f)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,u,f){u={base:u,key:"type",typeMap:{color:f}};u={types:u,json:{read:function(p){return(t,w,e)=>{if(!t)return t;for(const n in p.typeMap)if(t.type===n)return w=new p.typeMap[n],w.read(t,e),w}}(u),write:{overridePolicy:(p,t,w)=>({enabled:!w||!w.isPresentation})}}};a.backgroundProperty=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b){f=function(h){function k(l){return h.call(this,l)||this}a._inheritsLoose(k,h);k.prototype.clone=function(){};return k}(f.JSONSupport);u.__decorate([p.property({readOnly:!0,json:{read:!1}})],f.prototype,"type",void 0);return f=u.__decorate([b.subclass("esri.webscene.background.Background")],f)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){var l;t={...h.colorAndTransparencyProperty,nonNullable:!0};k=l=function(m){function z(c){c=m.call(this,c)||this;c.type="color";c.color=new f([0,0,0,1]);return c}a._inheritsLoose(z,m);var r=z.prototype;r.clone=function(){return new l(this.cloneProperties())};r.cloneProperties=function(){return{color:this.color.clone()}};return z}(k);u.__decorate([n.enumeration({color:"color"},{readOnly:!0})],k.prototype,"type",void 0);u.__decorate([p.property(t)],k.prototype,"color",
void 0);return k=l=u.__decorate([b.subclass("esri.webscene.background.ColorBackground")],k)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){const v=d.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);a.SceneViewEnvironmentManager=function(I){function G(...H){H=I.call(this,...H)||this;H._referencePointUpdateDelay=200;H._referencePointUpdateInterval=3E3;H._referencePointUpdateDistThreshold=1E6;H._referencePosUpdateQuery=null;H._referencePosMapCoordsRequested=null;H._viewHandles=new w;H._preserveAbsoluteDateTime=!1;H._trackingEnabled=!1;H._referencePosResetPreserveAbsoluteTime=
!1;H.referencePosUpdateTimer=null;H._referencePosMapCoords=null;H._mainLight=new C.MainLight;H._ambientLight=new C.AmbientLight;H._moonLight=new C.FillLight;H._renderer=null;H._referencePosWGS84Comparable=null;H._resetReferencePosition();return H}u._inheritsLoose(G,I);var K=G.prototype;K.destroy=function(){this.disconnectView();this._viewHandles.destroy()};K.connectView=function(H){this._renderer||(this._view=H,this._renderer=new y({view:H}),this._viewHandles.add([H.watch("environment.lighting.date",
J=>this._lightingDateHandler(J),!0),H.watch("stationary",()=>this._interactingStationaryHandler()),H.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],()=>this._updateRenderParamsHandler(),!0),H.watch("spatialReference",()=>this._resetReferencePosition(!0),!0),b.init(H,"viewingMode",()=>this._resetReferencePosition(!0),!0),b.init(H,"environment.lighting.cameraTrackingEnabled",
J=>this._updateCameraTracking(J),!0),b.init(H,"state.camera",()=>this._cameraHandler(null),!0),this.watch("disableQueries",()=>this._cameraHandler(null))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};K.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};K._updateCameraTracking=function(H){if(this._trackingEnabled=H)this._cameraHandler();
else if(H=this._view.environment.lighting)H.positionTimezoneInfo.autoUpdated=!1};K._lightingDateHandler=function(H){if(H){var J=this._view.environment.lighting;if(!J.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!A.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var M=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(M)){this._requestReferencePositionUpdate(M);return}}this._preupdateTracking(H);e.isSome(this._referencePosWGS84Comparable)&&
(M=x.positionToTimezoneInfo(this._referencePosWGS84Comparable,F),e.isSome(M)&&(J.autoUpdate(null,M),this._trackingEnabled&&(J.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(H)}};K._preupdateTracking=function(H){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(H)};K._cameraHandler=function(H=null){if(this._view.ready){var J=this._view.camera;J&&(this._cameraHandlerClientSide(J,H)||this._cameraHandlerServerSide(J))}};K._cameraHandlerClientSide=
function(H,J){const M=q.isEarth(this._view.spatialReference);if(M&&!A.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;H=H.position;e.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=d.create());M?A.projectPointToWGS84ComparableLonLat(H,this._referencePosWGS84Comparable):c.set(this._referencePosWGS84Comparable,H.longitude,H.latitude,H.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,
J)||this._updateLightParams(J);return!0};K._cameraHandlerServerSide=function(H){H=H.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(H))&&this._requestReferencePositionUpdate(H,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=H.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};K._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};
K._updateLightParams=function(H){var J=this._view.environment.lighting;H=H||J.date;J=this._view._stage;let M;e.isSome(this._referencePosWGS84Comparable)?(M=D.computeColorAndIntensity(H,this._referencePosWGS84Comparable),D.computeDirection(H,this._referencePosWGS84Comparable,this._view.viewingMode,M.diffuse.directionToLightSource)):M={diffuse:{color:[1,1,1],intensity:.55,directionToLightSource:v},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};c.scale(this._mainLight.intensity,
M.diffuse.color,M.diffuse.intensity*Math.PI);c.copy(this._mainLight.direction,M.diffuse.directionToLightSource);c.scale(this._ambientLight.intensity,M.ambient.color,M.ambient.intensity);c.lerp(this._moonLight.intensity,L,N,M.globalFactor);c.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*M.globalFactor)*(1-.4*M.noonFactor*(1-M.globalFactor)));c.copy(this._moonLight.direction,M.diffuse.directionToLightSource);J.renderView.updateLightSources([this._mainLight,this._ambientLight,this._moonLight],
1-M.noonFactor,M.globalFactor);this._updateRenderParamsHandler()};K._autoUpdateTimezone=function(H,J=null){if(!this._view.environment.lighting.cameraTrackingEnabled||e.isNone(H))return!1;const M=E;M.setTime((J||this._view.environment.lighting.date).getTime());H=x.positionToTimezoneInfo(H,F);if(e.isNone(H))return!1;var O=this._view.environment.lighting.positionTimezoneInfo;if(!O.autoUpdated)O=H;else if(O.hours===H.hours&&O.minutes===H.minutes&&O.seconds===H.seconds)return!1;const Q=M.getUTCHours()-
(H.hours-O.hours),S=M.getUTCMinutes()-(H.minutes-O.minutes);O=M.getUTCSeconds()-(H.seconds-O.seconds);M.setUTCHours(Q);M.setUTCMinutes(S);M.setUTCSeconds(O);return J?!1:this._view.environment.lighting.autoUpdate(M,H)};K._updateRenderParamsHandler=function(){const H=this._view._stage;if(H){var J=e.mapOr(this._referencePosWGS84Comparable,!0,O=>D.computeShadowsEnabled(O,this._view.viewingMode)),M=this._view.environment.background;M=M instanceof B?{type:"color",color:g.fromArray(p.toUnitRGBA(M.color))}:
{type:"color",color:g.fromValues(0,0,0,1)};H.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&J,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:M})}};K._resetReferencePosition=function(H=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=
null;this.notifyChange("updating");H&&this._cameraHandler(null)};K._requestReferencePositionUpdate=function(H,J=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(H):this._referencePosMapCoordsRequested=H.clone(),this._referencePosResetPreserveAbsoluteTime=!!J,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){const M=this._referencePosUpdateQuery=n.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===
M)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==M)}).catch(Q=>{"mapcoordshelper:missing-geometry-service"===Q.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===M&&(this._referencePosUpdateQuery=null,this.referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),O=this.referencePosUpdateTimer=n.after(this._referencePointUpdateInterval).then(()=>{this.referencePosUpdateTimer===O&&(this.referencePosUpdateTimer=
null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};K._doReferencePositionUpdateQuery=function(){var H=u._asyncToGenerator(function*(J){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=
null;const M=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);J()||isNaN(M[0])||isNaN(M[1])||(J=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=M[0],this._referencePosWGS84Comparable[1]=M[1],this._referencePosWGS84Comparable[2]=J):this._referencePosWGS84Comparable=[M[0],M[1],J],this._referencePosChanged())});return function(J){return H.apply(this,arguments)}}();K._executePendingReferencePositionUpdate=
function(){const H=this._referencePosMapCoordsRequested;H&&this._requestReferencePositionUpdate(H,this._referencePosResetPreserveAbsoluteTime)};K._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams();this.notifyChange("referencePositionWGS84Comparable")};K._exceedsReferencePosDistThreshold=function(H){return this._referencePosMapCoords?(H=this._referencePosMapCoords.distance(H),
this._view.mapCoordsHelper&&(H*=this._view.mapCoordsHelper.unitInMeters),H>this._referencePointUpdateDistThreshold):!0};K._cancelReferencePosUpdates=function(){const H=!!this._referencePosUpdateQuery;this.referencePosUpdateTimer=this._referencePosUpdateQuery=null;return H};u._createClass(G,[{key:"updating",get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)}},{key:"referencePositionWGS84Comparable",
get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const H=this;return{renderer:this._renderer,set referencePointUpdateInterval(J){H._referencePointUpdateInterval=J},set referencePointUpdateDistThreshold(J){H._referencePointUpdateDistThreshold=J},set referencePosUpdateTimer(J){H.referencePosUpdateTimer=J},set referencePointUpdateDelay(J){H._referencePointUpdateDelay=J}}}}]);return G}(t.EventedAccessor);a.SceneViewEnvironmentManager.FIXED_LIGHT_DIRECTION=v;f.__decorate([h.property({type:Boolean,
readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);f.__decorate([h.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);f.__decorate([h.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);f.__decorate([h.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);f.__decorate([h.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=f.__decorate([r.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],
a.SceneViewEnvironmentManager);const E=new Date,F={hours:0,minutes:0,seconds:0},L=d.fromValues(.22,.22,.33),N=d.fromValues(.22,.22,.22);a.default=a.SceneViewEnvironmentManager;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=[14,15];f=function(A){function q(){var x=A.apply(this,arguments)||this;x._handles=new t;x._context=null;x._pendingAtmosphere=null;x._atmosphere=null;x._stars=null;return x}a._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this.view._stage.addRenderPlugin(g,this)};y.destroy=function(){this._pendingAtmosphere=w.destroyMaybe(this._pendingAtmosphere);this._atmosphere=w.destroyMaybe(this._atmosphere);this._stars=w.destroyMaybe(this._stars);
this._handles=w.destroyMaybe(this._handles);this.view&&null!=this.view._stage&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};y.initializeRenderContext=function(x){this._context=x;this.setup()};y.setup=function(){this._handles.add(e.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0));this._handles.add([e.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],()=>this._updateAtmosphere(),!0),e.init(this.view,"environment.starsEnabled",
()=>this._updateStars(),!0)])};y.uninitializeRenderContext=function(){w.isSome(this._stars)&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);w.isSome(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};y.render=function(x){let D=!0;w.isSome(this._stars)&&this._stars.canRender&&(D=this._stars.render(x)&&D);w.isSome(this._atmosphere)&&this._atmosphere.canRender&&(D=this._atmosphere.render(x)&&D);return D};
y._setNeedsRender=function(){this._context&&this._context.requestRender()};y._updateStars=function(){var x,D,C;const B=null!=(x=null==(D=this.view)?void 0:null==(C=D.environment)?void 0:C.starsEnabled)?x:!1;B&&w.isNone(this._stars)?(this._stars=new d.Stars({view:this.view}),this._stars.initializeRenderContext(this._context),this._setNeedsRender()):!B&&w.isSome(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};y._updateAtmosphere=function(){var x=this._getAtmosphereType();
if(this.atmosphereType!==x)if(this.atmosphereType=x,w.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),x=this._getAtmosphereClass()){var D=new x(this.view);D.initializeRenderContext(this._context);w.isNone(this._atmosphere)&&(this._atmosphere=D,this._setNeedsRender());this._pendingAtmosphere=D;D.when().then(()=>{w.isSome(this._atmosphere)&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),
this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===D&&(this._pendingAtmosphere=null)})}else w.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};y._getAtmosphereClass=function(){const x=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(x);switch(x){case "none":return null;
case "realistic":return r.RealisticAtmosphere;case "panoramic":return z;case "simple":return c}};y._getAtmosphereType=function(){const x=this.view.get("environment.atmosphereEnabled"),D=this.view.get("environment.atmosphere.quality"),C=this.view.viewingMode;return!x||null==D||m.isMoon(this.view.spatialReference)?"none":"local"===C?"panoramic":"high"===D&&r.RealisticAtmosphere.isSupported(this._context)&&!m.isMars(this.view.spatialReference)?"realistic":"simple"};y._updateBasemapTerrain=function(){const x=
this.view.basemapTerrain;x&&(x.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};a._createClass(q,[{key:"canRender",get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"updating",get:function(){return w.isSome(this._pendingAtmosphere)||w.isSome(this._stars)&&this._stars.updating}},{key:"test",get:function(){return{atmosphere:this._atmosphere}}}]);return q}(f);u.__decorate([n.property({constructOnly:!0})],
f.prototype,"view",void 0);u.__decorate([n.property({constructOnly:!0})],f.prototype,"atmosphereClassFromType",void 0);u.__decorate([n.property()],f.prototype,"updating",null);u.__decorate([n.property()],f.prototype,"_pendingAtmosphere",void 0);u.__decorate([n.property()],f.prototype,"_stars",void 0);return f=u.__decorate([l.subclass("esri.views.3d.environment.EnvironmentRenderer")],f)})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){const A=u.getLogger("esri.views.3d.environment.PanoramicAtmosphere");u=function(){function x(){this.slot=14;this._atmosphereTechniqueConfig=new n.SimpleAtmosphereTechniqueConfiguration;this._readyResolver=p.createResolver();this._readyController=p.createAbortController()}var D=x.prototype;D.destroy=function(){this._readyResolver.reject();this._texture=f.disposeMaybe(this._texture);this._vao=f.disposeMaybe(this._vao);this._readyController=f.abortMaybe(this._readyController)};
D.when=function(){return this._readyResolver.promise};D.initializeRenderContext=function(C){this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=C.shaderTechniqueRep.acquire(n.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig);const B=C.renderContext.rctx;this._vao=this._createVertexArrayObject(B);this._vaoCount=d.vertexCount(this._vao,"geometry");e.requestImage(b,{signal:this._readyController.signal}).then(v=>{this._texture=new c(B,{pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,flipped:!0},v);C.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(v=>{p.isAbortError(v)||A.error("Unable to initialize atmosphere: image request failed",v);this._readyResolver.reject()})};D.uninitializeRenderContext=function(){this.destroy()};D.render=function(C){if(C.slot!==this.slot||0!==C.pass)return!1;const B=C.rctx,v=this._atmosphereTechnique.program;B.useProgram(v);this._atmosphereTechnique.bindPipelineState(B);v.bindTexture(this._texture,"tex");
l.bindProjectionMatrix(v,C.camera.projectionMatrix);var E=q;t.copy(E,C.camera.viewMatrix);E[12]=0;E[13]=0;E[14]=0;E[15]=1;v.setUniformMatrix4fv("view",q);v.setUniform4f("color",1,1,1,1);C.scenelightingData.setLightDirectionUniform(v);B.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao);B.drawArrays(4,0,this._vaoCount);return!0};D._createVertexArrayObject=function(C){var B=z.createPolySphereGeometry(1,2,!1);const v=B.indices.get("position");for(var E=0;E<v.length;E+=3){var F=
v[E];v[E]=v[E+2];v[E+2]=F}B=B.vertexAttributes.get("position").data;E=y.createBuffer(v.length);F=E.position;for(let L=0;L<v.length;++L){const N=3*v[L];F.set(L,0,B[N]);F.set(L,1,B[N+1]);F.set(L,2,B[N+2])}return new g(C,m.Default3D,{geometry:h.glLayout(y)},{geometry:r.createVertex(C,35044,E.buffer)})};a._createClass(x,[{key:"canRender",get:function(){return null!=this._texture}}]);return x}();const q=w.create(),y=k.newLayout().vec3f("position");return u})},"esri/support/requestImageUtils":function(){define(["exports",
"../chunks/_rollupPluginBabelHelpers","../request"],function(a,u,f){function p(){p=u._asyncToGenerator(function*(t,w){({data:t}=yield f(t,{responseType:"image",...w}));return t});return p.apply(this,arguments)}a.requestImage=function(t,w){return p.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){e=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build({geometry:this.configuration.geometry});return new h.Program(r.rctx,c,b.Default3D)};z.initializePipeline=function(){return 1===this.configuration.geometry?k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),culling:k.backFaceCullingParams,depthTest:{func:515},colorWrite:k.defaultColorWriteParams}):
k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:k.defaultColorWriteParams})};return m}(e.ShaderTechnique);e.shader=new w.ReloadableShaderModule(t.SimpleAtmosphereShader,()=>new Promise(function(l,m){a(["./SimpleAtmosphere.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.geometry=0;return z}f._inheritsLoose(m,l);return m}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter({count:3})],t.prototype,"geometry",
void 0);u.SimpleAtmosphereTechnique=e;u.SimpleAtmosphereTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f,p){function t(e){const n=new p.ShaderBuilder;2===e.geometry?(n.attributes.add("position","vec2"),n.varyings.add("color",
"vec4"),n.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),n.vertex.code.add(f.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),n.fragment.code.add(f.glsl`void main() {
gl_FragColor = color;
}`)):(n.include(u.Transform,{linearDepth:!1}),n.attributes.add("position","vec3"),n.varyings.add("vtc","vec2"),n.varyings.add("falloff","float"),e=1===e.geometry,n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),e||(n.varyings.add("innerFactor","float"),n.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float")),n.vertex.code.add(f.glsl`
		void main(void) {
      ${e?f.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:f.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${f.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${f.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),n.fragment.uniforms.add("tex","sampler2D"),e||n.fragment.uniforms.add("altitudeFade","float"),n.fragment.code.add(f.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${e?f.glsl`gl_FragColor = atmosphereColor;`:f.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return n}var w=Object.freeze({__proto__:null,build:t});a.SimpleAtmosphereShader=w;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,u){a.Transform=function(f,p){p.linearDepth?f.vertex.code.add(u.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):f.vertex.code.add(u.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function u(f,...p){let t="";for(let w=0;w<p.length;w++)t+=f[w]+p[w];return t+=f[f.length-1]}(function(f){f.int=function(p){return Math.round(p).toString()};f.float=function(p){return p.toPrecision(8)}})(u||(u={}));a.glsl=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(a,u,f){const p=f.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");f=function(){function m(){this.includedModules=new Map}m.prototype.include=function(z,r){this.includedModules.has(z)?this.includedModules.get(z)!==r&&p.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(z,r),z(this.builder,r))};return m}();let t=function(m){function z(){var r=
m.apply(this,arguments)||this;r.vertex=new n;r.fragment=new n;r.attributes=new b;r.varyings=new h;r.extensions=new k;r.constants=new l;return r}u._inheritsLoose(z,m);z.prototype.generateSource=function(r){const c=this.extensions.generateSource(r),d=this.attributes.generateSource(r),g=this.varyings.generateSource();var A="vertex"===r?this.vertex:this.fragment;const q=A.uniforms.generateSource(),y=A.code.generateSource();r="vertex"===r?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";
A=this.constants.generateSource().concat(A.constants.generateSource());return`
${c.join("\n")}

${r}

${A.join("\n")}

${q.join("\n")}

${d.join("\n")}

${g.join("\n")}

${y.join("\n")}`};u._createClass(z,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms}},{key:"builder",get:function(){return this}}]);return z}(f),w=function(){function m(){this._entries=new Map}var z=m.prototype;z.add=function(r,c,d){this._entries.set(`${r}_${c}_${d}`,{name:r,type:c,arraySize:d});return this};z.generateSource=function(){return Array.from(this._entries.values()).map(r=>{var c=r.arraySize;return`uniform ${r.type} ${r.name}${c?`[${c}]`:""};`})};u._createClass(m,[{key:"entries",
get:function(){return Array.from(this._entries.values())}}]);return m}(),e=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(r){this._entries.push(r)};z.generateSource=function(){return this._entries};return m}(),n=function(m){function z(){var r=m.apply(this,arguments)||this;r.uniforms=new w;r.code=new e;r.constants=new l;return r}u._inheritsLoose(z,m);u._createClass(z,[{key:"builder",get:function(){return this}}]);return z}(f),b=function(){function m(){this._entries=[]}var z=
m.prototype;z.add=function(r,c){this._entries.push([r,c])};z.generateSource=function(r){return"fragment"===r?[]:this._entries.map(c=>`attribute ${c[1]} ${c[0]};`)};return m}(),h=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(r,c){this._entries.push([r,c])};z.generateSource=function(){return this._entries.map(r=>`varying ${r[1]} ${r[0]};`)};return m}(),k=function(){function m(){this._entries=new Set}var z=m.prototype;z.add=function(r){this._entries.add(r)};z.generateSource=
function(r){const c="vertex"===r?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(d=>c.includes(d)).map(d=>`#extension ${d} : enable`)};return m}();k.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];k.ALLOWLIST_VERTEX=[];let l=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(r,c,d){let g="ERROR_CONSTRUCTOR_STRING";switch(c){case "float":g=m.numberToFloatStr(d);break;case "int":g=m.numberToIntStr(d);break;case "bool":g=
d.toString();break;case "vec2":g=`vec2(${m.numberToFloatStr(d[0])},\
                            ${m.numberToFloatStr(d[1])})`;break;case "vec3":g=`vec3(${m.numberToFloatStr(d[0])},\
                            ${m.numberToFloatStr(d[1])},\
                            ${m.numberToFloatStr(d[2])})`;break;case "vec4":g=`vec4(${m.numberToFloatStr(d[0])},\
                            ${m.numberToFloatStr(d[1])},\
                            ${m.numberToFloatStr(d[2])},\
                            ${m.numberToFloatStr(d[3])})`;break;case "ivec2":g=`ivec2(${m.numberToIntStr(d[0])},\
                             ${m.numberToIntStr(d[1])})`;break;case "ivec3":g=`ivec3(${m.numberToIntStr(d[0])},\
                             ${m.numberToIntStr(d[1])},\
                             ${m.numberToIntStr(d[2])})`;break;case "ivec4":g=`ivec4(${m.numberToIntStr(d[0])},\
                             ${m.numberToIntStr(d[1])},\
                             ${m.numberToIntStr(d[2])},\
                             ${m.numberToIntStr(d[3])})`;break;case "mat2":case "mat3":case "mat4":g=`${c}(${Array.prototype.map.call(d,A=>m.numberToFloatStr(A)).join(", ")})`}this._entries.push(`const ${c} ${r} = ${g};`);return this};m.numberToIntStr=function(r){return r.toFixed(0)};m.numberToFloatStr=function(r){return Number.isInteger(r)?r.toFixed(1):r.toString()};z.generateSource=function(){return Array.from(this._entries)};return m}();a.Code=e;a.Includes=f;a.ShaderBuilder=t;a.Stage=n;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w,e){this._module=w;this._loadModule=e}var t=p.prototype;t.get=function(){return this._module};t.reload=function(){var w=u._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return w.apply(this,arguments)}}();return p}();a.ReloadableShaderModule=
f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(a,u,f){let p=function(){function t(e,n,b=()=>this.dispose()){this.release=b;n&&(this._config=n.snapshot());this._program=this.initializeProgram(e);this._pipeline=this.initializePipeline(e)}var w=t.prototype;w.dispose=function(){this._program=f.disposeMaybe(this._program);
this._pipeline=this._config=null};w.reload=function(e){f.disposeMaybe(this._program);this._program=this.initializeProgram(e)};w.bindPass=function(e,n){};w.bindMaterial=function(e,n){};w.bindDraw=function(e,n,b){};w.bindPipelineState=function(e){e.setPipelineState(this.pipeline)};w.ensureAttributeLocations=function(e){this.program.assertCompatibleVertexAttributeLocations(e)};u._createClass(t,[{key:"program",get:function(){return this._program}},{key:"pipeline",get:function(){return this._pipeline}},
{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return 4}}]);return t}();a.ShaderTechnique=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/mathUtils"],function(a,u,f){let p=function(){function t(){this._key="";this._keyDirty=
!1;this._parameterBits=this._parameterBits.map(()=>0)}t.prototype.snapshot=function(){const w=this._parameterNames,e={key:this.key};for(const n of w)e[n]=this[n];return e};u._createClass(t,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return t}();a.ShaderTechniqueConfiguration=p;a.parameter=function(t={}){return(w,e)=>{var n,b;w._parameterNames=null!=(n=w._parameterNames)?n:[];w._parameterNames.push(e);
const h=w._parameterNames.length-1;n=Math.ceil(f.log2(t.count||2));const k=null!=(b=w._parameterBits)?b:[0];let l=0;for(;16<k[l]+n;)l++,l>=k.length&&k.push(0);w._parameterBits=k;const m=k[l],z=(1<<n)-1<<m;k[l]+=n;Object.defineProperty(w,e,{get(){return this[h]},set(r){if(this[h]!==r&&(this[h]=r,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~z|+r<<m&z,"number"!==typeof r&&"boolean"!==typeof r))throw"Configuration value for "+e+" must be boolean or number, got "+typeof r;}})}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports"],function(a){const u=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]]);a.Default3D=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../webgl/Program ../../../webgl/RenderingContext".split(" "),
function(a,u,f,p,t,w){t=function(e){function n(h,k,l){h=e.call(this,h,k.generateSource("vertex"),k.generateSource("fragment"),l)||this;h._textures=new Map;h._freeTextureUnits=new p({deallocator:null});h._fragmentUniforms=w.webglDebugEnabled()?k.fragmentUniforms.entries:null;return h}u._inheritsLoose(n,e);var b=n.prototype;b.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};b.bindTexture=function(h,k){if(f.isNone(h)||null==h.glName){if(h=this._textures.get(k))this._context.bindTexture(null,
h.unit),this._freeTextureUnit(h),this._textures.delete(k);return null}let l=this._textures.get(k);null==l?(l=this._allocTextureUnit(h),this._textures.set(k,l)):l.texture=h;this._context.useProgram(this);this.setUniform1i(k,l.unit);this._context.bindTexture(h,l.unit);return l.unit};b.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((h,k)=>{this._context.bindTexture(h.texture,h.unit);this.setUniform1i(k,h.unit)});f.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(h=>
{if(("sampler2D"===h.type||"samplerCube"===h.type)&&!this._textures.has(h.name))throw Error(`Texture sampler ${h.name} has no bound texture`);})};b._allocTextureUnit=function(h){return{texture:h,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};b._freeTextureUnit=function(h){this._freeTextureUnits.push(h.unit)};return n}(t.Program);a.Program=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./enums ./RenderingContext ./ShaderTranspiler".split(" "),
function(a,u,f,p,t,w,e){function n(l,m){if(p.isNone(l)||l.length!==m.length)return!0;for(let z=0;z<l.length;++z)if(l[z]!==m[z])return!0;return!1}function b(l,m,z){const r="webgl2"===l.webglVersion?e.transpileShader(z,m):z,c=l.gl,d=c.createShader(m);c.shaderSource(d,r);c.compileShader(d);w.webglValidateShadersEnabled()&&!c.getShaderParameter(d,c.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===m?"vertex":"fragment"," shader")),console.error(c.getShaderInfoLog(d)),console.error(h(r)),
"webgl2"===l.webglVersion&&(console.log("Shader source before transpilation:"),console.log(z)));return d}function h(l){let m=2;return l.replace(/\n/g,()=>{var z=m++;z=1E3<=z?z.toString():("  "+z).slice(-3);return"\n"+z+":"})}function k(l,m){for(let z=0;z<l.length;++z)m[z]=l[z]}f=function(){function l(z,r,c,d){this._context=z;this._locations=d;this._fShader=this._vShader=null;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3=
{};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};z||console.error("RenderingContext isn't initialized!");0===r.length&&console.error("Shaders source should not be empty!");this._vShader=b(this._context,35633,r);this._fShader=b(this._context,35632,c);this._vShader&&this._fShader||console.error("Error loading shaders!");const g=this._context.gl,A=g.createProgram();g.attachShader(A,this._vShader);g.attachShader(A,this._fShader);d.forEach((q,y)=>g.bindAttribLocation(A,
q,y));g.linkProgram(A);w.webglValidateShadersEnabled()&&!g.getProgramParameter(A,g.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+g.getProgramParameter(A,g.VALIDATE_STATUS)+", gl error ["+g.getError()+"]infoLog: "+g.getProgramInfoLog(A));this._glName=A;this._context.instanceCounter.increment(t.ResourceType.Program,this)}var m=l.prototype;m.dispose=function(){const z=this._context.gl;this._vShader&&(z.deleteShader(this._vShader),this._vShader=null);this._fShader&&(z.deleteShader(this._fShader),
this._fShader=null);this._glName&&(z.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(t.ResourceType.Program,this))};m._getUniformLocation=function(z){void 0===this._nameToUniformLocation[z]&&(this._nameToUniformLocation[z]=this._context.gl.getUniformLocation(this._glName,z));return this._nameToUniformLocation[z]};m.hasUniform=function(z){return null!==this._getUniformLocation(z)};m.setUniform1i=function(z,r){const c=this._nameToUniform1[z];if(void 0===c||r!==
c)this._context.useProgram(this),this._context.gl.uniform1i(this._getUniformLocation(z),r),this._nameToUniform1[z]=r};m.setUniform1iv=function(z,r){const c=this._nameToUniform1v[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform1iv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform1v[z]=Array.from(r):k(r,c))};m.setUniform2iv=function(z,r){const c=this._nameToUniform2[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform2iv(this._getUniformLocation(z),r),void 0===
c?this._nameToUniform2[z]=Array.from(r):k(r,c))};m.setUniform3iv=function(z,r){const c=this._nameToUniform3[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform3iv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform3[z]=Array.from(r):k(r,c))};m.setUniform4iv=function(z,r){const c=this._nameToUniform4[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform4iv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform4[z]=Array.from(r):k(r,c))};m.setUniform1f=
function(z,r){const c=this._nameToUniform1[z];if(void 0===c||r!==c)this._context.useProgram(this),this._context.gl.uniform1f(this._getUniformLocation(z),r),this._nameToUniform1[z]=r};m.setUniform1fv=function(z,r){const c=this._nameToUniform1v[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform1fv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform1v[z]=Array.from(r):k(r,c))};m.setUniform2f=function(z,r,c){const d=this._nameToUniform2[z];if(void 0===d||r!==d[0]||c!==d[1])this._context.useProgram(this),
this._context.gl.uniform2f(this._getUniformLocation(z),r,c),void 0===d?this._nameToUniform2[z]=[r,c]:(d[0]=r,d[1]=c)};m.setUniform2fv=function(z,r){const c=this._nameToUniform2[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform2fv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform2[z]=Array.from(r):k(r,c))};m.setUniform3f=function(z,r,c,d){const g=this._nameToUniform3[z];if(void 0===g||r!==g[0]||c!==g[1]||d!==g[2])this._context.useProgram(this),this._context.gl.uniform3f(this._getUniformLocation(z),
r,c,d),void 0===g?this._nameToUniform3[z]=[r,c,d]:(g[0]=r,g[1]=c,g[2]=d)};m.setUniform3fv=function(z,r){const c=this._nameToUniform3[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform3fv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform3[z]=Array.from(r):k(r,c))};m.setUniform4f=function(z,r,c,d,g){const A=this._nameToUniform4[z];if(void 0===A||r!==A[0]||c!==A[1]||d!==A[2]||g!==A[3])this._context.useProgram(this),this._context.gl.uniform4f(this._getUniformLocation(z),r,
c,d,g),void 0===A?this._nameToUniform4[z]=[r,c,d,g]:(A[0]=r,A[1]=c,A[2]=d,A[3]=g)};m.setUniform4fv=function(z,r){const c=this._nameToUniform4[z];n(c,r)&&(this._context.useProgram(this),this._context.gl.uniform4fv(this._getUniformLocation(z),r),void 0===c?this._nameToUniform4[z]=Array.from(r):k(r,c))};m.setUniformMatrix3fv=function(z,r,c=!1){const d=this._nameToUniformMatrix3[z];var g=p.isNone(d)?!0:9!==d.length?n(d,r):9!==d.length||d[0]!==r[0]||d[1]!==r[1]||d[2]!==r[2]||d[3]!==r[3]||d[4]!==r[4]||
d[5]!==r[5]||d[6]!==r[6]||d[7]!==r[7]||d[8]!==r[8];g&&(this._context.useProgram(this),this._context.gl.uniformMatrix3fv(this._getUniformLocation(z),c,r),void 0===d?this._nameToUniformMatrix3[z]=Array.from(r):k(r,d))};m.setUniformMatrix4fv=function(z,r,c=!1){const d=this._nameToUniformMatrix4[z];var g=p.isNone(d)?!0:16!==d.length?n(d,r):16!==d.length||d[0]!==r[0]||d[1]!==r[1]||d[2]!==r[2]||d[3]!==r[3]||d[4]!==r[4]||d[5]!==r[5]||d[6]!==r[6]||d[7]!==r[7]||d[8]!==r[8]||d[9]!==r[9]||d[10]!==r[10]||d[11]!==
r[11]||d[12]!==r[12]||d[13]!==r[13]||d[14]!==r[14]||d[15]!==r[15];g&&(this._context.useProgram(this),this._context.gl.uniformMatrix4fv(this._getUniformLocation(z),c,r),void 0===d?this._nameToUniformMatrix4[z]=Array.from(r):k(r,d))};m.assertCompatibleVertexAttributeLocations=function(z){z.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};m.stop=function(){};u._createClass(l,[{key:"glName",get:function(){return this._glName}}]);return l}();a.Program=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ResourceType=void 0;var u=a.ResourceType||(a.ResourceType={});u[u.Texture=0]="Texture";u[u.Buffer=1]="Buffer";u[u.VAO=2]="VAO";u[u.Program=3]="Program";u[u.Framebuffer=4]="Framebuffer";u[u.Renderbuffer=5]="Renderbuffer";u[u.COUNT=6]="COUNT";a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./enums ./InstanceCounter ./renderState ./Texture ./capabilities/isWebGL2Context ./capabilities/load".split(" "),
function(a,u,f,p,t,w,e,n,b,h){function k(r,c,d,g){c?g!==c&&r.bindBuffer(d,c.glName):r.bindBuffer(d,null);return c}function l(r,c){switch(r){case 0:return 2*c;case 4:return c/3;case 5:return c-2;case 6:return c-2;default:return 0}}let m=function(){function r(d,g={}){this.gl=d;this.instanceCounter=new w.InstanceCounter;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};
this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=[];this._numOfTriangles=this._numOfDrawCalls=0;this.webglVersion=b(d)?"webgl2":"webgl";d instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=h.loadCapabilities(d,g);this._parameters=
this._loadParameters(g);d=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:d[0],y:d[1],width:d[2],height:d[3]};this._stateTracker=new e.StateTracker({setBlending:A=>{A?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(A.opRgb,A.opAlpha),this.setBlendFunctionSeparate(A.srcRgb,A.dstRgb,A.srcAlpha,A.dstAlpha),A=A.color,this.setBlendColor(A.r,A.g,A.b,A.a)):this.setBlendingEnabled(!1)},setCulling:A=>{A?(this.setFaceCullingEnabled(!0),this.setCullFace(A.face),this.setFrontFace(A.mode)):
this.setFaceCullingEnabled(!1)},setPolygonOffset:A=>{A?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(A.factor,A.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:A=>{A?(this.setDepthTestEnabled(!0),this.setDepthFunction(A.func)):this.setDepthTestEnabled(!1)},setStencilTest:A=>{if(A){this.setStencilTestEnabled(!0);const q=A.function;this.setStencilFunction(q.func,q.ref,q.mask);A=A.operation;this.setStencilOp(A.fail,A.zFail,A.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:A=>
{A?(this.setDepthWriteEnabled(!0),this.setDepthRange(A.zNear,A.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:A=>{A?this.setColorMask(A.r,A.g,A.b,A.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:A=>{A?this.setStencilWriteMask(A.mask):this.setStencilWriteMask(0)}});this.enforceState()}var c=r.prototype;c.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap.length=0;z&&this.instanceCounter.printResourceCount()};c.setPipelineState=function(d){this._stateTracker.setPipeline(d)};
c.setBlendingEnabled=function(d){this._blendEnabled!==d&&(!0===d?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=d,this._stateTracker.invalidateBlending())};c.externalTextureUnitUpdate=function(d,g){for(let A=0;A<d.length;++A)this._textureUnitMap[d[A]]=null;0<=g&&(this._activeTextureUnit=g)};c.externalVertexArrayObjectUpdate=function(){const d=this.capabilities.vao;d&&(d.bindVertexArray(null),this._activeVertexArrayObject=null);this._activeIndexBuffer=this._activeVertexBuffer=
null};c.externalVertexBufferUpdate=function(){this._activeVertexBuffer=null};c.externalIndexBufferUpdate=function(){this._activeIndexBuffer=null};c.setBlendColor=function(d,g,A,q){if(d!==this._blendColorState.r||g!==this._blendColorState.g||A!==this._blendColorState.b||q!==this._blendColorState.a)this.gl.blendColor(d,g,A,q),this._blendColorState.r=d,this._blendColorState.g=g,this._blendColorState.b=A,this._blendColorState.a=q,this._stateTracker.invalidateBlending()};c.setBlendFunction=function(d,
g){if(d!==this._blendFunctionState.srcRGB||g!==this._blendFunctionState.dstRGB)this.gl.blendFunc(d,g),this._blendFunctionState.srcRGB=d,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=g,this._blendFunctionState.dstAlpha=g,this._stateTracker.invalidateBlending()};c.setBlendFunctionSeparate=function(d,g,A,q){if(this._blendFunctionState.srcRGB!==d||this._blendFunctionState.srcAlpha!==A||this._blendFunctionState.dstRGB!==g||this._blendFunctionState.dstAlpha!==q)this.gl.blendFuncSeparate(d,
g,A,q),this._blendFunctionState.srcRGB=d,this._blendFunctionState.srcAlpha=A,this._blendFunctionState.dstRGB=g,this._blendFunctionState.dstAlpha=q,this._stateTracker.invalidateBlending()};c.setBlendEquation=function(d){this._blendEquationState.mode!==d&&(this.gl.blendEquation(d),this._blendEquationState.mode=d,this._blendEquationState.modeAlpha=d,this._stateTracker.invalidateBlending())};c.setBlendEquationSeparate=function(d,g){if(this._blendEquationState.mode!==d||this._blendEquationState.modeAlpha!==
g)this.gl.blendEquationSeparate(d,g),this._blendEquationState.mode=d,this._blendEquationState.modeAlpha=g,this._stateTracker.invalidateBlending()};c.setColorMask=function(d,g,A,q){if(this._colorMaskState.r!==d||this._colorMaskState.g!==g||this._colorMaskState.b!==A||this._colorMaskState.a!==q)this.gl.colorMask(d,g,A,q),this._colorMaskState.r=d,this._colorMaskState.g=g,this._colorMaskState.b=A,this._colorMaskState.a=q,this._stateTracker.invalidateColorWrite()};c.setClearColor=function(d,g,A,q){if(this._clearColor.r!==
d||this._clearColor.g!==g||this._clearColor.b!==A||this._clearColor.a!==q)this.gl.clearColor(d,g,A,q),this._clearColor.r=d,this._clearColor.g=g,this._clearColor.b=A,this._clearColor.a=q};c.setFaceCullingEnabled=function(d){this._polygonCullingEnabled!==d&&(!0===d?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=d,this._stateTracker.invalidateCulling())};c.setPolygonOffsetFillEnabled=function(d){this._polygonOffsetFillEnabled!==d&&(!0===d?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):
this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=d,this._stateTracker.invalidatePolygonOffset())};c.setPolygonOffset=function(d,g){if(this._polygonOffset[0]!==d||this._polygonOffset[1]!==g)this._polygonOffset[0]=d,this._polygonOffset[1]=g,this.gl.polygonOffset(d,g),this._stateTracker.invalidatePolygonOffset()};c.setCullFace=function(d){this._cullFace!==d&&(this.gl.cullFace(d),this._cullFace=d,this._stateTracker.invalidateCulling())};c.setFrontFace=function(d){this._frontFace!==
d&&(this.gl.frontFace(d),this._frontFace=d,this._stateTracker.invalidateCulling())};c.setScissorTestEnabled=function(d){this._scissorTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=d)};c.setScissorRect=function(d,g,A,q){if(this._scissorRect.x!==d||this._scissorRect.y!==g||this._scissorRect.width!==A||this._scissorRect.height!==q)this.gl.scissor(d,g,A,q),this._scissorRect.x=d,this._scissorRect.y=g,this._scissorRect.width=
A,this._scissorRect.height=q};c.setDepthTestEnabled=function(d){this._depthTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=d,this._stateTracker.invalidateDepthTest())};c.setClearDepth=function(d){this._clearDepth!==d&&(this.gl.clearDepth(d),this._clearDepth=d)};c.setDepthFunction=function(d){this._depthFunction!==d&&(this.gl.depthFunc(d),this._depthFunction=d,this._stateTracker.invalidateDepthTest())};c.setDepthWriteEnabled=function(d){this._depthWriteEnabled!==
d&&(this.gl.depthMask(d),this._depthWriteEnabled=d,this._stateTracker.invalidateDepthWrite())};c.setDepthRange=function(d,g){if(this._depthRange.zNear!==d||this._depthRange.zFar!==g)this.gl.depthRange(d,g),this._depthRange.zNear=d,this._depthRange.zFar=g,this._stateTracker.invalidateDepthWrite()};c.setStencilTestEnabled=function(d){this._stencilTestEnabled!==d&&(!0===d?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=d,this._stateTracker.invalidateStencilTest())};
c.setClearStencil=function(d){d!==this._clearStencil&&(this.gl.clearStencil(d),this._clearStencil=d)};c.setStencilFunction=function(d,g,A){if(this._stencilFunction.func!==d||this._stencilFunction.ref!==g||this._stencilFunction.mask!==A)this.gl.stencilFunc(d,g,A),this._stencilFunction.face=1032,this._stencilFunction.func=d,this._stencilFunction.ref=g,this._stencilFunction.mask=A,this._stateTracker.invalidateStencilTest()};c.setStencilFunctionSeparate=function(d,g,A,q){if(this._stencilFunction.face!==
d||this._stencilFunction.func!==g||this._stencilFunction.ref!==A||this._stencilFunction.mask!==q)this.gl.stencilFuncSeparate(d,g,A,q),this._stencilFunction.face=d,this._stencilFunction.func=g,this._stencilFunction.ref=A,this._stencilFunction.mask=q,this._stateTracker.invalidateStencilTest()};c.setStencilWriteMask=function(d){this._stencilWriteMask!==d&&(this.gl.stencilMask(d),this._stencilWriteMask=d,this._stateTracker.invalidateStencilWrite())};c.setStencilOp=function(d,g,A){if(this._stencilOperation.fail!==
d||this._stencilOperation.zFail!==g||this._stencilOperation.zPass!==A)this.gl.stencilOp(d,g,A),this._stencilOperation.face=1032,this._stencilOperation.fail=d,this._stencilOperation.zFail=g,this._stencilOperation.zPass=A,this._stateTracker.invalidateStencilTest()};c.setStencilOpSeparate=function(d,g,A,q){if(this._stencilOperation.face!==d||this._stencilOperation.fail!==g||this._stencilOperation.zFail!==A||this._stencilOperation.zPass!==q)this.gl.stencilOpSeparate(d,g,A,q),this._stencilOperation.face=
d,this._stencilOperation.face=d,this._stencilOperation.fail=g,this._stencilOperation.zFail=A,this._stencilOperation.zPass=q,this._stateTracker.invalidateStencilTest()};c.setActiveTexture=function(d,g=!1){const A=this._activeTextureUnit;0<=d&&(g||d!==this._activeTextureUnit)&&(this.gl.activeTexture(t.BASE_TEXTURE_UNIT+d),this._activeTextureUnit=d);return A};c.clear=function(d){d&&this.gl.clear(d)};c.clearSafe=function(d,g=255){d&&(d&16384&&this.setColorMask(!0,!0,!0,!0),d&256&&this.setDepthWriteEnabled(!0),
d&1024&&this.setStencilWriteMask(g),this.gl.clear(d))};c.drawArrays=function(d,g,A){z&&(this._numOfDrawCalls++,this._numOfTriangles+=l(d,A));this.gl.drawArrays(d,g,A)};c.drawElements=function(d,g,A,q){z&&(this._numOfDrawCalls++,this._numOfTriangles+=l(d,g));this.gl.drawElements(d,g,A,q)};c.logIno=function(){z&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};c.setViewport=function(d,g,A,q){A=Math.max(Math.round(A),1);q=Math.max(Math.round(q),1);const y=this._viewport;
if(y.x!==d||y.y!==g||y.width!==A||y.height!==q)y.x=d,y.y=g,y.width=A,y.height=q,this.gl.viewport(d,g,A,q)};c.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.useProgram=function(d){var g;if(d)this._activeShaderProgram!==d&&(null==(g=this._activeShaderProgram)?void 0:g.stop(),this._activeShaderProgram=d,this.gl.useProgram(d.glName));else{var A;null==(A=this._activeShaderProgram)?void 0:A.stop();this._activeShaderProgram=
null;this.gl.useProgram(null)}};c.bindTexture=function(d,g,A=!1){(g>=this.parameters.maxTextureImageUnits||0>g)&&console.error("Input texture unit is out of range of available units!");const q=this._textureUnitMap[g];this.setActiveTexture(g,A);if(p.isNone(d)||null==d.glName)return p.isSome(q)&&this.gl.bindTexture(q.descriptor.target,null),this._textureUnitMap[g]=null,q;if(!A&&q===d)return d.applyChanges(),q;this.gl.bindTexture(d.descriptor.target,d.glName);d.applyChanges();this._textureUnitMap[g]=
d;return q};c.unbindTextureAllUnits=function(d){for(let g=0;g<this.parameters.maxTextureImageUnits;g++)this._textureUnitMap[g]===d&&(this.bindTexture(null,g),this._textureUnitMap[g]=null)};c.bindFramebuffer=function(d,g=!1){if(p.isNone(d))this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null;else if(g||this._activeFramebuffer!==d)d.initializeAndBind(),this._activeFramebuffer=d};c.bindBuffer=function(d){d&&(34962===d.bufferType?this._activeVertexBuffer=k(this.gl,d,d.bufferType,
this._activeVertexBuffer):this._activeIndexBuffer=k(this.gl,d,d.bufferType,this._activeIndexBuffer))};c.bindRenderbuffer=function(d){const g=this.gl;d||(g.bindRenderbuffer(g.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==d&&(g.bindRenderbuffer(g.RENDERBUFFER,d.glName),this._activeRenderbuffer=d)};c.unbindBuffer=function(d){34962===d?this._activeVertexBuffer=k(this.gl,null,d,this._activeVertexBuffer):this._activeIndexBuffer=k(this.gl,null,d,this._activeIndexBuffer)};c.bindVAO=
function(d=null){p.isNone(d)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null):this._activeVertexArrayObject!==d&&(d.bind(),this._activeVertexArrayObject=d)};c.getBoundFramebufferObject=function(){return this._activeFramebuffer};c.getBoundVAO=function(){return this._activeVertexArrayObject};c.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(let d=
0;d<this.parameters.maxTextureImageUnits;++d)this.bindTexture(null,d);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);
this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.enforceState=function(){const d=this.gl;var g=this.capabilities.vao;g&&g.bindVertexArray(null);for(var A=0;A<this.parameters.maxVertexAttributes;A++)d.disableVertexAttribArray(A);
this._activeVertexBuffer?d.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):d.bindBuffer(34962,null);this._activeIndexBuffer?d.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):d.bindBuffer(34963,null);if(g&&this._activeVertexArrayObject){if(g=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(g)}d.bindFramebuffer(d.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);d.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);d.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);d.bindRenderbuffer(d.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?d.enable(this.gl.BLEND):d.disable(this.gl.BLEND);d.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);d.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);d.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);d.clearDepth(this._clearDepth);d.clearStencil(this._clearStencil);d.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);d.cullFace(this._cullFace);d.depthFunc(this._depthFunction);d.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);d.depthMask(this._depthWriteEnabled);d.frontFace(this._frontFace);d.lineWidth(1);!0===this._polygonCullingEnabled?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE);d.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?d.enable(d.POLYGON_OFFSET_FILL):d.disable(d.POLYGON_OFFSET_FILL);d.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?d.enable(d.SCISSOR_TEST):
d.disable(d.SCISSOR_TEST);d.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);d.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST);d.stencilMask(this._stencilWriteMask);for(g=0;g<this.parameters.maxTextureImageUnits;g++)d.activeTexture(t.BASE_TEXTURE_UNIT+g),d.bindTexture(3553,null),b(d)&&d.bindTexture(32879,
null),A=this._textureUnitMap[g],p.isSome(A)&&d.bindTexture(A.descriptor.target,A.glName);d.activeTexture(t.BASE_TEXTURE_UNIT+this._activeTextureUnit);d.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height);z&&(this._numOfTriangles=this._numOfDrawCalls=0)};c._loadParameters=function(d){var g;const A=this.capabilities.textureFilterAnisotropic;d=null!=(g=d.maxAnisotropy)?g:Infinity;g={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:A?Math.min(this.gl.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY),d):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};n.TEXTURE_UNIT_FOR_UPDATES=g.maxTextureImageUnits-1;return g};u._createClass(r,[{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},
{key:"capabilities",get:function(){return this._capabilities}}]);return r}();const z=!!f("enable-feature:webgl-debug");a.default=m;a.webglDebugEnabled=function(){return z};a.webglValidateShadersEnabled=function(){return z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,u,f){let p=function(){function t(){this._current=[];this._max=[];for(this._allocations=new Map;this._current.length<
f.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var w=t.prototype;w.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};w.increment=function(e,n){n=++this._current[e];this._max[e]=Math.max(n,this._max[e])};w.decrement=function(e,n){--this._current[e]};w.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let e=0;e<f.ResourceType.COUNT;++e){const n=this._current[e];0<n&&console.log(`${f.ResourceType[e]}: ${n}`)}}if(0<
this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const e=new Map;this._allocations.forEach(n=>{var b;e.set(n,(null!=(b=e.get(n))?b:0)+1)});e.forEach((n,b)=>console.log(n," : ",b))}};u._createClass(t,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((e,n)=>e+n,0)}}]);return t}();a.InstanceCounter=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/renderState":function(){define(["exports"],
function(a){function u(I){return x.intern(I)}function f(I){return D.intern(I)}function p(I){return C.intern(I)}function t(I){return B.intern(I)}function w(I){return v.intern(I)}function e(I){return E.intern(I)}function n(I){return F.intern(I)}function b(I){return L.intern(I)}function h(I){return"["+I.join(",")+"]"}function k(I){return I?h([I.srcRgb,I.srcAlpha,I.dstRgb,I.dstAlpha,I.opRgb,I.opAlpha,I.color.r,I.color.g,I.color.b,I.color.a]):null}function l(I){return I?h([I.face,I.mode]):null}function m(I){return I?
h([I.factor,I.units]):null}function z(I){return I?h([I.func]):null}function r(I){return I?h([I.function.func,I.function.ref,I.function.mask,I.operation.fail,I.operation.zFail,I.operation.zPass]):null}function c(I){return I?h([I.zNear,I.zFar]):null}function d(I){return I?h([I.r,I.g,I.b,I.a]):null}function g(I){return I?h([I.mask]):null}const A={face:1029,mode:2305},q={face:1028,mode:2305};var y=function(){function I(G,K){this.makeKey=G;this.makeRef=K;this.interns=new Map}I.prototype.intern=function(G){if(!G)return null;
const K=this.makeKey(G),H=this.interns;H.has(K)||H.set(K,this.makeRef(G));return H.get(K)};return I}();const x=new y(k,I=>({__tag:"Blending",...I})),D=new y(l,I=>({__tag:"Culling",...I})),C=new y(m,I=>({__tag:"PolygonOffset",...I})),B=new y(z,I=>({__tag:"DepthTest",...I})),v=new y(r,I=>({__tag:"StencilTest",...I})),E=new y(c,I=>({__tag:"DepthWrite",...I})),F=new y(d,I=>({__tag:"ColorWrite",...I})),L=new y(g,I=>({__tag:"StencilWrite",...I})),N=new y(function(I){return I?h([k(I.blending),l(I.culling),
m(I.polygonOffset),z(I.depthTest),r(I.stencilTest),c(I.depthWrite),d(I.colorWrite),g(I.stencilWrite)]):null},I=>({blending:u(I.blending),culling:f(I.culling),polygonOffset:p(I.polygonOffset),depthTest:t(I.depthTest),stencilTest:w(I.stencilTest),depthWrite:e(I.depthWrite),colorWrite:n(I.colorWrite),stencilWrite:b(I.stencilWrite)}));y=function(){function I(K){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=
this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=K}var G=I.prototype;G.setPipeline=function(K){if(this._pipelineInvalid||K!==this._pipeline)this.setBlending(K.blending),this.setCulling(K.culling),this.setPolygonOffset(K.polygonOffset),this.setDepthTest(K.depthTest),this.setStencilTest(K.stencilTest),this.setDepthWrite(K.depthWrite),this.setColorWrite(K.colorWrite),this.setStencilWrite(K.stencilWrite),this._pipeline=K;this._pipelineInvalid=!1};G.invalidateBlending=
function(){this._pipelineInvalid=this._blendingInvalid=!0};G.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};G.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};G.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};G.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};G.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};G.invalidateColorWrite=
function(){this._pipelineInvalid=this._colorWriteInvalid=!0};G.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};G.setBlending=function(K){this._blending=this.setSubState(K,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};G.setCulling=function(K){this._culling=this.setSubState(K,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};G.setPolygonOffset=function(K){this._polygonOffset=
this.setSubState(K,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};G.setDepthTest=function(K){this._depthTest=this.setSubState(K,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};G.setStencilTest=function(K){this._stencilTest=this.setSubState(K,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};G.setDepthWrite=function(K){this._depthWrite=
this.setSubState(K,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};G.setColorWrite=function(K){this._colorWrite=this.setSubState(K,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};G.setStencilWrite=function(K){this._stencilWrite=this.setSubState(K,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};G.setSubState=function(K,H,J,M){if(J||
K!==H)M(K),this._pipelineInvalid=!0;return K};return I}();a.StateTracker=y;a.backFaceCullingParams=A;a.cullingParams=I=>2===I?A:1===I?q:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=q;a.makeBlending=u;a.makeColorWrite=n;a.makeCulling=f;a.makeDepthTest=t;a.makeDepthWrite=e;a.makePipelineState=function(I){return N.intern(I)};a.makePolygonOffset=p;a.makeStencilTest=w;a.makeStencilWrite=b;a.separateBlendingParams=function(I,G,
K,H,J=32774,M=32774,O=[0,0,0,0]){return{srcRgb:I,srcAlpha:G,dstRgb:K,dstAlpha:H,opRgb:J,opAlpha:M,color:{r:O[0],g:O[1],b:O[2],a:O[3]}}};a.simpleBlendingParams=function(I,G,K=32774,H=[0,0,0,0]){return{srcRgb:I,srcAlpha:I,dstRgb:G,dstAlpha:G,opRgb:K,opAlpha:K,color:{r:H[0],g:H[1],b:H[2],a:H[3]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Texture":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/mathUtils","../../core/maybe","./enums","./capabilities/isWebGL2Context"],
function(a,u,f,p,t){let w=function(){function e(b,h,k=null){this._context=b;this.type="texture";this._glName=null;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;b.instanceCounter.increment(p.ResourceType.Texture,this);this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...h};this.setData(k)}var n=e.prototype;n.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),
this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(p.ResourceType.Texture,this))};n.release=function(){this.dispose()};n.resize=function(b,h){const k=this._descriptor;if(k.width!==b||k.height!==h)k.width=b,k.height=h,this.setData(null)};n.setData=function(b){if(this._context&&this._context.gl){var h=this._context.gl;this._glName||(this._glName=h.createTexture());void 0===b&&(b=null);null===b&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=
this._descriptor.height||4);var k=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES),l=this._descriptor;e._validateTexture(this._context,l);h.pixelStorei(h.UNPACK_ALIGNMENT,l.unpackAlignment);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l.flipped?1:0);h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.preMultiplyAlpha?1:0);var m=l.pixelFormat,z=l.internalFormat?l.internalFormat:m;if(b instanceof ImageData||b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement){var r=
b.width,c=b.height;b instanceof HTMLVideoElement&&(r=b.videoWidth,c=b.videoHeight);h.texImage2D(h.TEXTURE_2D,0,z,m,l.dataType,b);l.hasMipmap&&this.generateMipmap();void 0===l.width&&(l.width=r);void 0===l.height&&(l.height=c)}else{null!=l.width&&null!=l.height||console.error("Width and height must be specified!");h.DEPTH24_STENCIL8&&z===h.DEPTH_STENCIL&&(z=h.DEPTH24_STENCIL8);r=l.width;c=l.height;var d=b;if(f.isSome(d)&&"type"in d&&"compressed"===d.type)for(m=Math.round(Math.log(Math.max(r,c))/Math.LN2)+
1,l.hasMipmap=l.hasMipmap&&m===b.levels.length,m=0;;++m){h.compressedTexImage2D(h.TEXTURE_2D,m,z,r,c,0,b.levels[Math.min(m,b.levels.length-1)]);if(1===r&&1===c||!l.hasMipmap)break;r=Math.max(1,r>>1);c=Math.max(1,c>>1)}else if(f.isSome(b))h.texImage2D(h.TEXTURE_2D,0,z,r,c,0,m,l.dataType,b),l.hasMipmap&&this.generateMipmap();else for(b=0;;++b){h.texImage2D(h.TEXTURE_2D,b,z,r,c,0,m,l.dataType,null);if(1===r&&1===c||!l.hasMipmap)break;r=Math.max(1,r>>1);c=Math.max(1,c>>1)}}e._applySamplingMode(h,this._descriptor);
e._applyWrapMode(h,this._descriptor);e._applyAnisotropicFilteringParameters(this._context,this._descriptor);this._context.bindTexture(k,e.TEXTURE_UNIT_FOR_UPDATES)}};n.updateData=function(b,h,k,l,m,z){z||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const r=this._context.gl,c=this._descriptor,d=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);(0>h||0>k||l>c.width||m>c.height||h+l>c.width||k+m>c.height)&&
console.error("An attempt to update out of bounds of the texture!");r.pixelStorei(r.UNPACK_ALIGNMENT,c.unpackAlignment);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha?1:0);z instanceof ImageData||z instanceof HTMLImageElement||z instanceof HTMLCanvasElement||z instanceof HTMLVideoElement?r.texSubImage2D(r.TEXTURE_2D,b,h,k,c.pixelFormat,c.dataType,z):r.texSubImage2D(r.TEXTURE_2D,b,h,k,l,m,c.pixelFormat,c.dataType,z);this._context.bindTexture(d,
e.TEXTURE_UNIT_FOR_UPDATES)};n.generateMipmap=function(){var b=this._descriptor;b.hasMipmap||(this._samplingModeDirty=b.hasMipmap=!0,e._validateTexture(this._context,b));9729===b.samplingMode?(this._samplingModeDirty=!0,b.samplingMode=9985):9728===b.samplingMode&&(this._samplingModeDirty=!0,b.samplingMode=9984);b=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);const h=this._context.gl;h.generateMipmap(h.TEXTURE_2D);this._context.bindTexture(b,e.TEXTURE_UNIT_FOR_UPDATES)};n.setSamplingMode=
function(b){b!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=b,this._samplingModeDirty=!0)};n.setWrapMode=function(b){b!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=b,e._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};n.applyChanges=function(){const b=this._context.gl,h=this._descriptor;this._samplingModeDirty&&(e._applySamplingMode(b,h),this._samplingModeDirty=!1);this._wrapModeDirty&&(e._applyWrapMode(b,h),this._wrapModeDirty=!1)};e._validateTexture=
function(b,h){(0>h.width||0>h.height)&&console.error("Negative dimension parameters are not allowed!");const k=u.isPowerOfTwo(h.width)&&u.isPowerOfTwo(h.height);t(b.gl)||k||("number"===typeof h.wrapMode?33071!==h.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(33071!==h.wrapMode.s||33071!==h.wrapMode.t)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),h.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};
e._applySamplingMode=function(b,h){let k=h.samplingMode,l=h.samplingMode;if(9985===k||9987===k)k=9729,h.hasMipmap||(l=9729);else if(9984===k||9986===k)k=9728,h.hasMipmap||(l=9728);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,k);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,l)};e._applyWrapMode=function(b,h){"number"===typeof h.wrapMode?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h.wrapMode),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h.wrapMode)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,
h.wrapMode.s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h.wrapMode.t))};e._applyAnisotropicFilteringParameters=function(b,h){var k;const l=b.capabilities.textureFilterAnisotropic;l&&(b=b.gl,b.texParameterf(b.TEXTURE_2D,l.TEXTURE_MAX_ANISOTROPY,null!=(k=h.maxAnisotropy)?k:1))};a._createClass(e,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]);return e}();w.TEXTURE_UNIT_FOR_UPDATES=0;return w})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&
a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("exports ./DisjointTimerQuery ./DrawBuffers ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(a,u,f,p,t,w,e){function n(b,h,k,l,m){if(l&&t(b))return!0;if(h[k])return!1;for(const z of m)if(b.getExtension(z))return!0;return!1}a.loadCapabilities=function(b,h){const k=h.disabledExtensions||{},l=h.debugWebGLExtensions||{};let m,z,r,c,d,g,A,q,y,x,D,C=null,B=null,v=null,
E=null;return{get drawBuffers(){D||(D=f.load(b,k));return D},get instancing(){m||(m=p.load(b));return m},get vao(){z||(z=e.load(b,k));return z},get compressedTextureETC(){if(!r)if(k.compressedTextureETC)r=null;else{var F=b.getExtension("WEBGL_compressed_texture_etc");r=F?{COMPRESSED_R11_EAC:F.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:F.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:F.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:F.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:F.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:F.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:F.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:F.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}return r},get compressedTextureS3TC(){if(!c)if(k.compressedTextureS3TC)c=null;else{var F=b.getExtension("WEBGL_compressed_texture_s3tc");c=F?{COMPRESSED_RGB_S3TC_DXT1:F.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:F.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:F.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:F.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return c},get textureFilterAnisotropic(){if(!d)if(k.textureFilterAnisotropic)d=null;else{var F=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");d=F?{MAX_TEXTURE_MAX_ANISOTROPY:F.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:F.TEXTURE_MAX_ANISOTROPY_EXT}:
null}return d},get disjointTimerQuery(){g||(g=u.createDisjointTimerQuery(b,k));return g},get textureFloat(){if(!A)if(t(b))A={textureFloat:!0,textureFloatLinear:!k.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!k.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b.HALF_FLOAT};else if(b instanceof WebGLRenderingContext){const F=!k.textureHalfFloat&&b.getExtension("OES_texture_half_float");A={textureFloat:!k.textureFloat&&
!!b.getExtension("OES_texture_float"),textureFloatLinear:!k.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!F,textureHalfFloatLinear:!k.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:F?F.HALF_FLOAT_OES:void 0}}else A=null;return A},get colorBufferFloat(){if(!q)if(t(b)){var F=!k.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),L=!k.colorBufferFloat&&b.getExtension("EXT_color_buffer_float"),N=!k.colorBufferFloat&&
b.getExtension("EXT_float_blend");q=F||L||N?{textureFloat:!!L,textureHalfFloat:!!F,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(F=!k.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),L=!k.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),N=!k.colorBufferFloat&&b.getExtension("EXT_float_blend"),q=F||L||N?{textureFloat:!!L,textureHalfFloat:!!F,
RGBA16F:F?F.RGBA16F_EXT:void 0,RGB16F:F?F.RGB16F_EXT:void 0,RGBA32F:L?L.RGBA32F_EXT:void 0}:null):q=null;return q},get blendMinMax(){if(!y)if(t(b))y={MIN:b.MIN,MAX:b.MAX};else if(k.blendMinMax)y=null;else{{const F=b.getExtension("EXT_blend_minmax");y=F?{MIN:F.MIN_EXT,MAX:F.MAX_EXT}:null}}return y},get depthTexture(){null===C&&(C=n(b,k,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return C},get standardDerivatives(){null===B&&(B=n(b,k,"standardDerivatives",
!0,["OES_standard_derivatives"]));return B},get shaderTextureLOD(){null===v&&(v=n(b,k,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return v},get fragDepth(){null===E&&(E=n(b,k,"fragDepth",!0,["EXT_frag_depth"]));return E},get loseContext(){x||(x=w.load(b,l));return x},enable(F){return this[F]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,u){let f=function(p,t,w,e,n,b,h,k){this.createQuery=
p;this.resultAvailable=t;this.getResult=w;this.disjoint=e;this.beginTimeElapsed=n;this.endTimeElapsed=b;this.createTimestamp=h;this.timestampBits=k};a.DisjointTimerQuery=f;a.createDisjointTimerQuery=function(p,t){if(t.disjointTimerQuery)return null;let w=p.getExtension("EXT_disjoint_timer_query_webgl2");return w&&u(p)?new f(()=>p.createQuery(),e=>p.getQueryParameter(e,p.QUERY_RESULT_AVAILABLE),e=>p.getQueryParameter(e,p.QUERY_RESULT),()=>p.getParameter(w.GPU_DISJOINT_EXT),e=>p.beginQuery(w.TIME_ELAPSED_EXT,
e),()=>p.endQuery(w.TIME_ELAPSED_EXT),e=>w.queryCounterEXT(e,w.TIMESTAMP_EXT),()=>p.getQuery(w.TIMESTAMP_EXT,w.QUERY_COUNTER_BITS_EXT)):(w=p.getExtension("EXT_disjoint_timer_query"))?new f(()=>w.createQueryEXT(),e=>w.getQueryObjectEXT(e,w.QUERY_RESULT_AVAILABLE_EXT),e=>w.getQueryObjectEXT(e,w.QUERY_RESULT_EXT),()=>p.getParameter(w.GPU_DISJOINT_EXT),e=>w.beginQueryEXT(w.TIME_ELAPSED_EXT,e),()=>w.endQueryEXT(w.TIME_ELAPSED_EXT),e=>w.queryCounterEXT(e,w.TIMESTAMP_EXT),()=>w.getQueryEXT(w.TIMESTAMP_EXT,
w.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,u){a.load=function(f,p){return p.disjointTimerQuery?null:u(f)?{drawBuffers:f.drawBuffers.bind(f),MAX_DRAW_BUFFERS:f.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:f.MAX_COLOR_ATTACHMENTS}:p.drawBuffers?null:(f=f.getExtension("WEBGL_draw_buffers"))?{drawBuffers:f.drawBuffersWEBGL.bind(f),MAX_DRAW_BUFFERS:f.MAX_DRAW_BUFFERS_WEBGL,
MAX_COLOR_ATTACHMENTS:f.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,u){a.load=function(f){return u(f)?{drawArraysInstanced:f.drawArraysInstanced.bind(f),drawElementsInstanced:f.drawElementsInstanced.bind(f),vertexAttribDivisor:f.vertexAttribDivisor.bind(f)}:(f=f.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:f.drawArraysInstancedANGLE.bind(f),
drawElementsInstanced:f.drawElementsInstancedANGLE.bind(f),vertexAttribDivisor:f.vertexAttribDivisorANGLE.bind(f)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(u,f){const p=f.loseContext&&u.getExtension("WEBGL_lose_context");return p?{loseRenderingContext:()=>p.loseContext()}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports",
"./isWebGL2Context"],function(a,u){a.load=function(f,p){return u(f)?{createVertexArray:f.createVertexArray.bind(f),deleteVertexArray:f.deleteVertexArray.bind(f),bindVertexArray:f.bindVertexArray.bind(f)}:p.vao?null:(f=f.getExtension("OES_vertex_array_object")||f.getExtension("MOZ_OES_vertex_array_object")||f.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:f.createVertexArrayOES.bind(f),deleteVertexArray:f.deleteVertexArrayOES.bind(f),bindVertexArray:f.bindVertexArrayOES.bind(f)}:
null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","./reservedWordsGLSL3"],function(a,u){function f(){function c(O){O.length&&L.push({type:z[B],data:O,position:G,line:N,column:I})}function d(){F=F.length?[]:F;if("/"===E&&"*"===v)return G=C+D-1,B=0,E=v,D+1;if("/"===E&&"/"===v)return G=C+D-1,B=1,E=v,D+1;if("#"===v)return B=2,G=C+D,D;if(/\s/.test(v))return B=9,G=C+D,D;K=/\d/.test(v);H=/[^\w_]/.test(v);G=C+D;B=K?4:H?3:9999;return D}
function g(){if(("\r"===v||"\n"===v)&&"\\"!==E)return c(F.join("")),B=999,D;F.push(v);E=v;return D+1}function A(){if("."===E&&/\d/.test(v))return B=5,D;if("/"===E&&"*"===v)return B=0,D;if("/"===E&&"/"===v)return B=1,D;if("."===v&&F.length){for(;q(F););B=5;return D}if(";"===v||")"===v||"("===v){if(F.length)for(;q(F););c(v);B=999;return D+1}var O=2===F.length&&"\x3d"!==v;if(/[\w_\d\s]/.test(v)||O){for(;q(F););B=999;return D}F.push(v);E=v;return D+1}function q(O){var Q=0;do{var S=l.indexOf(O.slice(0,
O.length+Q).join(""));var V=l[S];if(-1===S){if(0<Q--+O.length)continue;V=O.slice(0,1).join("")}c(V);G+=V.length;F=F.slice(V.length);return F.length}while(1)}function y(){if("."===v||/[eE]/.test(v))return F.push(v),B=5,E=v,D+1;if("x"===v&&1===F.length&&"0"===F[0])return B=11,F.push(v),E=v,D+1;if(/[^\d]/.test(v))return c(F.join("")),B=999,D;F.push(v);E=v;return D+1}function x(){"f"===v&&(F.push(v),E=v,D+=1);if(/[eE]/.test(v)||"-"===v&&/[eE]/.test(E))return F.push(v),E=v,D+1;if(/[^\d]/.test(v))return c(F.join("")),
B=999,D;F.push(v);E=v;return D+1}var D=0,C=0,B=999,v,E,F=[],L=[],N=1,I=0,G=0,K=!1,H=!1,J="",M;return function(O){L=[];if(null!==O){O=O.replace?O.replace(/\r\n/g,"\n"):O;D=0;J+=O;for(M=J.length;v=J[D],D<M;){O=D;switch(B){case 0:"/"===v&&"*"===E?(F.push(v),c(F.join("")),B=999):(F.push(v),E=v);D+=1;break;case 1:D=g();break;case 2:D=g();break;case 3:D=A();break;case 4:D=y();break;case 11:/[^a-fA-F0-9]/.test(v)?(c(F.join("")),B=999):(F.push(v),E=v,D+=1);break;case 5:D=x();break;case 9999:if(/[^\d\w_]/.test(v)){var Q=
F.join("");B=-1<k.indexOf(Q)?8:-1<m.indexOf(Q)?7:6;c(F.join(""));B=999}else F.push(v),E=v,D+=1;break;case 9:/[^\s]/g.test(v)?(c(F.join("")),B=999):(F.push(v),E=v,D+=1);break;case 999:D=d()}if(O!==D)switch(J[O]){case "\n":I=0;++N;break;default:++I}}C+=D;J=J.slice(D);return L}F.length&&c(F.join(""));B=10;c("(eof)");return L}}function p(c){return c.map(d=>"eof"!==d.type?d.data:"").join("")}function t(c,d="100",g="300 es"){const A=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const q of c)if("preprocessor"===
q.type){const y=A.exec(q.data);if(y){c=y[1].replace(/\s\s+/g," ");if(c===g)return c;if(c===d)return q.data="#version "+g,d;throw Error("unknown glsl version: "+c);}}c.splice(0,0,{type:"preprocessor",data:"#version "+g},{type:"whitespace",data:"\n"});return null}function w(c,d,g,A){A=A||g;for(const q of c)if("ident"===q.type&&q.data===g)return A in d?d[A]++:d[A]=0,w(c,d,A+"_"+d[A],A);return g}function e(c,d,g="afterVersion"){const A={data:"\n",type:"whitespace"},q=x=>x<c.length?/[^\r\n]$/.test(c[x].data):
!1;let y=function(x){let D=-1,C=0,B=-1;for(let E=0;E<x.length;E++){var v=x[E];"preprocessor"===v.type&&(v.data.match(/#(if|ifdef|ifndef)\s+.+/)?++C:v.data.match(/#endif\s*.*/)&&--C);("afterVersion"===g||"afterPrecision"===g)&&"preprocessor"===v.type&&/^#version/.test(v.data)&&(B=Math.max(B,E));if("afterPrecision"===g&&"keyword"===v.type&&"precision"===v.data){a:{for(v=E;v<x.length;v++){const F=x[v];if("operator"===F.type&&";"===F.data)break a}v=null}if(null===v)throw Error("precision statement not followed by any semicolons!");
B=Math.max(B,v)}D<B&&0===C&&(D=E)}return D+1}(c);q(y-1)&&c.splice(y++,0,A);for(const x of d)c.splice(y++,0,x);q(y-1)&&q(y)&&c.splice(y,0,A)}function n(c,d,g,A="lowp"){e(c,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:g},{type:"whitespace",data:" "},{type:"ident",data:d},{type:"operator",data:";"}],"afterPrecision")}function b(c,d,g,A,q="lowp"){e(c,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",
data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:A.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:q},{type:"whitespace",data:" "},{type:"keyword",data:g},{type:"whitespace",data:" "},{type:"ident",data:d},{type:"operator",data:";"}],"afterPrecision")}var h={exports:{}};(function(c){(function(d){d=d();void 0!==d&&(c.exports=
d)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(h);
var k=h.exports;h={exports:{}};(function(c){(function(d){d=d();void 0!==d&&(c.exports=d)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(h);var l=h.exports;h={exports:{}};(function(c){(function(d){d=d();void 0!==d&&(c.exports=d)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(h);
var m=h.exports,z="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const r=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(c,d){var g=f(),A=[];A=A.concat(g(c));c=A=A.concat(g(null));if("300 es"===t(c,"100","300 es"))throw Error("shader is already glsl 300 es");A=g=null;const q={},y={};for(let B=0;B<c.length;++B){const v=c[B];switch(v.type){case "keyword":35633===
d&&"attribute"===v.data?v.data="in":"varying"===v.data&&(v.data=35633===d?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(v.data.trim())&&(v.data=v.data.replace(/(2D|Cube|EXT)/g,""));35632===d&&"gl_FragColor"===v.data&&(g||(g=w(c,q,"fragColor"),n(c,g,"vec4")),v.data=g);if(35632===d&&"gl_FragData"===v.data){{var x=void 0;let E=void 0;var D=c;var C=B+1;let F=-1;for(;C<D.length;C++){const L=D[C];if("operator"===L.type&&("["===L.data&&(E=C),"]"===L.data)){x=C;break}"integer"===
L.type&&(F=parseInt(L.data,10))}E&&x&&D.splice(E,x-E+1);D=F}x=w(c,q,"fragData");b(c,x,"vec4",D,"mediump");v.data=x}else 35632===d&&"gl_FragDepthEXT"===v.data&&(A||(A=w(c,q,"gl_FragDepth")),v.data=A);break;case "ident":if(0<=u.indexOf(v.data)){if(D=35633===d)a:{for(D=B-1;0<=D;D--)if(x=c[D],"whitespace"!==x.type&&"block-comment"!==x.type)if("keyword"===x.type){if("attribute"===x.data||"in"===x.data){D=!0;break a}}else break;D=!1}if(D)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
v.data in y||(y[v.data]=w(c,q,v.data));v.data=y[v.data]}}}for(d=c.length-1;0<=d;--d)g=c[d],"preprocessor"===g.type&&((A=g.data.match(/#extension\s+(.*):/))&&A[1]&&0<=r.indexOf(A[1].trim())&&(A=c[d+1],c.splice(d,A&&"whitespace"===A.type?2:1)),(A=g.data.match(/#ifdef\s+(.*)/))&&A[1]&&0<=r.indexOf(A[1].trim())&&(g.data="#if 1"),(A=g.data.match(/#ifndef\s+(.*)/))&&A[1]&&0<=r.indexOf(A[1].trim())&&(g.data="#if 0"));return p(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports"],function(a){const u={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126};a.glLayout=function(f,p=0){const t=f.stride;return f.fieldNames.filter(w=>{w=f.fields.get(w).optional;return!(w&&w.glPadding)}).map(w=>{const e=f.fields.get(w),n=e.constructor.ElementCount;var b=u[e.constructor.ElementType];if(!b)throw Error("BufferType not supported in WebGL");return{name:w,stride:t,count:n,type:b,offset:e.offset,normalized:!(!e.optional||
!e.optional.glNormalized),divisor:p}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,u,f,p){let t=function(){function e(b,h){this.layout=b;this.buffer="number"===typeof h?new ArrayBuffer(h*b.stride):h;for(const k of b.fieldNames)h=b.fields.get(k),this[k]=new h.constructor(this.buffer,
h.offset,this.stride)}var n=e.prototype;n.getField=function(b,h){return(b=this[b])&&b.elementCount===h.ElementCount&&b.elementType===h.ElementType?b:null};n.slice=function(b,h){return new e(this.layout,this.buffer.slice(b*this.stride,h*this.stride))};n.copyFrom=function(b,h,k,l){const m=this.stride;0===m%4?(b=new Uint32Array(b.buffer,h*m,l*m/4),(new Uint32Array(this.buffer,k*m,l*m/4)).set(b)):(b=new Uint8Array(b.buffer,h*m,l*m),(new Uint8Array(this.buffer,k*m,l*m)).set(b))};u._createClass(e,[{key:"stride",
get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return e}(),w=function(){function e(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var n=e.prototype;n.vec2f=function(b,h){this.appendField(b,f.BufferViewVec2f,h);return this};n.vec2f64=function(b,h){this.appendField(b,f.BufferViewVec2f64,h);return this};n.vec3f=function(b,h){this.appendField(b,f.BufferViewVec3f,
h);return this};n.vec3f64=function(b,h){this.appendField(b,f.BufferViewVec3f64,h);return this};n.vec4f=function(b,h){this.appendField(b,f.BufferViewVec4f,h);return this};n.vec4f64=function(b,h){this.appendField(b,f.BufferViewVec4f64,h);return this};n.mat3f=function(b,h){this.appendField(b,f.BufferViewMat3f,h);return this};n.mat3f64=function(b,h){this.appendField(b,f.BufferViewMat3f64,h);return this};n.mat4f=function(b,h){this.appendField(b,f.BufferViewMat4f,h);return this};n.mat4f64=function(b,h){this.appendField(b,
f.BufferViewMat4f64,h);return this};n.vec4u8=function(b,h){this.appendField(b,f.BufferViewVec4u8,h);return this};n.f32=function(b,h){this.appendField(b,f.BufferViewFloat,h);return this};n.f64=function(b,h){this.appendField(b,f.BufferViewFloat64,h);return this};n.u8=function(b,h){this.appendField(b,f.BufferViewUint8,h);return this};n.u16=function(b,h){this.appendField(b,f.BufferViewUint16,h);return this};n.i8=function(b,h){this.appendField(b,f.BufferViewInt8,h);return this};n.vec2i8=function(b,h){this.appendField(b,
f.BufferViewVec2i8,h);return this};n.vec2i16=function(b,h){this.appendField(b,f.BufferViewVec2i16,h);return this};n.vec2u8=function(b,h){this.appendField(b,f.BufferViewVec2u8,h);return this};n.vec4u16=function(b,h){this.appendField(b,f.BufferViewVec4u16,h);return this};n.u32=function(b,h){this.appendField(b,f.BufferViewUint32,h);return this};n.appendField=function(b,h,k){const l=h.ElementCount*p.elementTypeSize(h.ElementType);this.fields.set(b,{size:l,constructor:h,offset:this.stride,optional:k});
this.stride+=l;this.fieldNames.push(b)};n.alignTo=function(b){this.stride=Math.floor((this.stride+b-1)/b)*b;return this};n.hasField=function(b){return 0<=this.fieldNames.indexOf(b)};n.createBuffer=function(b){return new t(this,b)};n.createView=function(b){return new t(this,b)};n.clone=function(){const b=new e;b.stride=this.stride;b.fields=new Map;this.fields.forEach((h,k)=>b.fields.set(k,h));b.fieldNames=this.fieldNames.slice();b.BufferType=this.BufferType;return b};return e}();a.InterleavedBuffer=
t;a.InterleavedLayout=w;a.newLayout=function(){return new w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,u,f,p,t,w,e,n){let b=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);
V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);b.ElementType="f32";let h=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);h.ElementType="f32";let k=
function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);k.ElementType="f32";let l=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,
W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);l.ElementType="f32";let m=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(f.BufferViewMat3Impl);
m.ElementType="f32";f=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType="f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(f.BufferViewMat3Impl);f.ElementType="f64";let z=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float32Array,Y,W,ba,ca)||this;Y.elementType="f32";return Y}u._inheritsLoose(V,S);
V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(p.BufferViewMat4Impl);z.ElementType="f32";p=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType="f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};
return V}(p.BufferViewMat4Impl);p.ElementType="f64";let r=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType="f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);r.ElementType="f64";let c=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType=
"f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);c.ElementType="f64";let d=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType="f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,
Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);d.ElementType="f64";let g=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Float64Array,Y,W,ba,ca)||this;Y.elementType="f64";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);g.ElementType="f64";let A=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint8Array,
Y,W,ba,ca)||this;Y.elementType="u8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);A.ElementType="u8";let q=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint8Array,Y,W,ba,ca)||this;Y.elementType="u8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,
W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);q.ElementType="u8";let y=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint8Array,Y,W,ba,ca)||this;Y.elementType="u8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);y.ElementType="u8";let x=function(S){function V(Y,W=0,ba,
ca){Y=S.call(this,Uint8Array,Y,W,ba,ca)||this;Y.elementType="u8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);x.ElementType="u8";let D=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint16Array,Y,W,ba,ca)||this;Y.elementType="u16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,
Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);D.ElementType="u16";let C=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint16Array,Y,W,ba,ca)||this;Y.elementType="u16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);C.ElementType="u16";
let B=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint16Array,Y,W,ba,ca)||this;Y.elementType="u16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);B.ElementType="u16";let v=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint16Array,Y,W,ba,ca)||this;Y.elementType="u16";return Y}u._inheritsLoose(V,S);V.prototype.slice=
function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);v.ElementType="u16";let E=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint32Array,Y,W,ba,ca)||this;Y.elementType="u32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);
E.ElementType="u32";let F=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint32Array,Y,W,ba,ca)||this;Y.elementType="u32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);F.ElementType="u32";let L=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint32Array,Y,W,ba,ca)||this;Y.elementType="u32";return Y}u._inheritsLoose(V,
S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);L.ElementType="u32";let N=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Uint32Array,Y,W,ba,ca)||this;Y.elementType="u32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};
return V}(n.BufferViewVec4Impl);N.ElementType="u32";let I=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int8Array,Y,W,ba,ca)||this;Y.elementType="i8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);I.ElementType="i8";let G=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int8Array,Y,W,ba,ca)||this;Y.elementType="i8";return Y}
u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);G.ElementType="i8";let K=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int8Array,Y,W,ba,ca)||this;Y.elementType="i8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+
Y.byteLength)};return V}(e.BufferViewVec3Impl);K.ElementType="i8";let H=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int8Array,Y,W,ba,ca)||this;Y.elementType="i8";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);H.ElementType="i8";let J=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int16Array,Y,W,ba,ca)||this;Y.elementType=
"i16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);J.ElementType="i16";let M=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int16Array,Y,W,ba,ca)||this;Y.elementType="i16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,
Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);M.ElementType="i16";let O=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int16Array,Y,W,ba,ca)||this;Y.elementType="i16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);O.ElementType="i16";let Q=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int16Array,
Y,W,ba,ca)||this;Y.elementType="i16";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);Q.ElementType="i16";t=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int32Array,Y,W,ba,ca)||this;Y.elementType="i32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,
W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(t.BufferViewScalarImpl);t.ElementType="i32";w=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int32Array,Y,W,ba,ca)||this;Y.elementType="i32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(w.BufferViewVec2Impl);w.ElementType="i32";e=function(S){function V(Y,W=0,ba,ca){Y=
S.call(this,Int32Array,Y,W,ba,ca)||this;Y.elementType="i32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(e.BufferViewVec3Impl);e.ElementType="i32";n=function(S){function V(Y,W=0,ba,ca){Y=S.call(this,Int32Array,Y,W,ba,ca)||this;Y.elementType="i32";return Y}u._inheritsLoose(V,S);V.prototype.slice=function(Y,W){return this.sliceBuffer(V,Y,W)};V.fromTypedArray=
function(Y,W){return new V(Y.buffer,Y.byteOffset,W,Y.byteOffset+Y.byteLength)};return V}(n.BufferViewVec4Impl);n.ElementType="i32";a.BufferViewFloat=b;a.BufferViewFloat64=r;a.BufferViewInt16=J;a.BufferViewInt32=t;a.BufferViewInt8=I;a.BufferViewMat3f=m;a.BufferViewMat3f64=f;a.BufferViewMat4f=z;a.BufferViewMat4f64=p;a.BufferViewUint16=D;a.BufferViewUint32=E;a.BufferViewUint8=A;a.BufferViewVec2f=h;a.BufferViewVec2f64=c;a.BufferViewVec2i16=M;a.BufferViewVec2i32=w;a.BufferViewVec2i8=G;a.BufferViewVec2u16=
C;a.BufferViewVec2u32=F;a.BufferViewVec2u8=q;a.BufferViewVec3f=k;a.BufferViewVec3f64=d;a.BufferViewVec3i16=O;a.BufferViewVec3i32=e;a.BufferViewVec3i8=K;a.BufferViewVec3u16=B;a.BufferViewVec3u32=L;a.BufferViewVec3u8=y;a.BufferViewVec4f=l;a.BufferViewVec4f64=g;a.BufferViewVec4i16=Q;a.BufferViewVec4i32=n;a.BufferViewVec4i8=H;a.BufferViewVec4u16=v;a.BufferViewVec4u32=N;a.BufferViewVec4u8=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w,e,n=0,b,h){this.TypedArrayConstructor=w;this.elementCount=9;w=this.TypedArrayConstructor;void 0===b&&(b=9*w.BYTES_PER_ELEMENT);const k=0===e.byteLength?0:n;this.typedBuffer=null==h?new w(e,k):new w(e,k,(h-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=b/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var t=p.prototype;t.sliceBuffer=function(w,e,n=this.count-e){e=this.typedBuffer.byteOffset+e*this.stride;return new w(this.buffer,e,this.stride,e+n*this.stride)};t.getMat=function(w,e){w*=this.typedBufferStride;for(let n=0;9>n;n++)e[n]=this.typedBuffer[w++];return e};t.setMat=function(w,e){w*=this.typedBufferStride;for(let n=0;9>n;n++)this.typedBuffer[w++]=e[n]};t.get=function(w,e){return this.typedBuffer[w*this.typedBufferStride+e]};t.set=function(w,e,n){this.typedBuffer[w*this.typedBufferStride+
e]=n};t.copyFrom=function(w,e,n){const b=this.typedBuffer,h=e.typedBuffer;w*=this.typedBufferStride;e=n*e.typedBufferStride;for(n=0;9>n;++n)b[w++]=h[e++]};u._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();f.ElementCount=9;a.BufferViewMat3Impl=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w,
e,n=0,b,h){this.TypedArrayConstructor=w;this.elementCount=16;w=this.TypedArrayConstructor;void 0===b&&(b=16*w.BYTES_PER_ELEMENT);const k=0===e.byteLength?0:n;this.typedBuffer=null==h?new w(e,k):new w(e,k,(h-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=b/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var t=p.prototype;t.sliceBuffer=function(w,e,n=this.count-e){e=this.typedBuffer.byteOffset+
e*this.stride;return new w(this.buffer,e,this.stride,e+n*this.stride)};t.getMat=function(w,e){w*=this.typedBufferStride;for(let n=0;16>n;n++)e[n]=this.typedBuffer[w++];return e};t.setMat=function(w,e){w*=this.typedBufferStride;for(let n=0;16>n;n++)this.typedBuffer[w++]=e[n]};t.get=function(w,e){return this.typedBuffer[w*this.typedBufferStride+e]};t.set=function(w,e,n){this.typedBuffer[w*this.typedBufferStride+e]=n};t.copyFrom=function(w,e,n){const b=this.typedBuffer,h=e.typedBuffer;w*=this.typedBufferStride;
e=n*e.typedBufferStride;for(n=0;16>n;++n)b[w++]=h[e++]};u._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();f.ElementCount=16;a.BufferViewMat4Impl=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w,e,n=0,b,h){this.TypedArrayConstructor=w;this.elementCount=1;w=this.TypedArrayConstructor;
void 0===b&&(b=w.BYTES_PER_ELEMENT);const k=0===e.byteLength?0:n;this.typedBuffer=null==h?new w(e,k):new w(e,k,(h-n)/w.BYTES_PER_ELEMENT);this.typedBufferStride=b/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var t=p.prototype;t.sliceBuffer=function(w,e,n=this.count-e){e=this.typedBuffer.byteOffset+e*this.stride;return new w(this.buffer,e,this.stride,e+n*this.stride)};t.get=function(w){return this.typedBuffer[w*
this.typedBufferStride]};t.set=function(w,e){this.typedBuffer[w*this.typedBufferStride]=e};u._createClass(p,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return p}();f.ElementCount=1;a.BufferViewScalarImpl=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,u,f){let p=function(){function t(e,n,b=0,h,k){this.TypedArrayConstructor=
e;this.elementCount=2;e=this.TypedArrayConstructor;void 0===h&&(h=2*e.BYTES_PER_ELEMENT);const l=0===n.byteLength?0:b;this.typedBuffer=null==k?new e(n,l):new e(n,l,(k-b)/e.BYTES_PER_ELEMENT);this.typedBufferStride=h/e.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=t.prototype;w.sliceBuffer=function(e,n,b=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new e(this.buffer,
n,this.stride,n+b*this.stride)};w.getVec=function(e,n){e*=this.typedBufferStride;return f.set(n,this.typedBuffer[e],this.typedBuffer[e+1])};w.setVec=function(e,n){e*=this.typedBufferStride;this.typedBuffer[e++]=n[0];this.typedBuffer[e]=n[1]};w.get=function(e,n){return this.typedBuffer[e*this.typedBufferStride+n]};w.set=function(e,n,b){this.typedBuffer[e*this.typedBufferStride+n]=b};w.setValues=function(e,n,b){e*=this.typedBufferStride;this.typedBuffer[e++]=n;this.typedBuffer[e]=b};w.copyFrom=function(e,
n,b){const h=this.typedBuffer,k=n.typedBuffer;e*=this.typedBufferStride;n=b*n.typedBufferStride;h[e++]=k[n++];h[e]=k[n]};u._createClass(t,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();p.ElementCount=2;a.BufferViewVec2Impl=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,u){function f(O,Q){O[0]=Q[0];O[1]=Q[1];return O}function p(O,Q,S){O[0]=Q;O[1]=S;return O}function t(O,Q,S){O[0]=Q[0]+S[0];O[1]=
Q[1]+S[1];return O}function w(O,Q,S){O[0]=Q[0]-S[0];O[1]=Q[1]-S[1];return O}function e(O,Q,S){O[0]=Q[0]*S[0];O[1]=Q[1]*S[1];return O}function n(O,Q,S){O[0]=Q[0]/S[0];O[1]=Q[1]/S[1];return O}function b(O,Q){O[0]=Math.ceil(Q[0]);O[1]=Math.ceil(Q[1]);return O}function h(O,Q){O[0]=Math.floor(Q[0]);O[1]=Math.floor(Q[1]);return O}function k(O,Q,S){O[0]=Math.min(Q[0],S[0]);O[1]=Math.min(Q[1],S[1]);return O}function l(O,Q,S){O[0]=Math.max(Q[0],S[0]);O[1]=Math.max(Q[1],S[1]);return O}function m(O,Q){O[0]=
Math.round(Q[0]);O[1]=Math.round(Q[1]);return O}function z(O,Q,S){O[0]=Q[0]*S;O[1]=Q[1]*S;return O}function r(O,Q,S,V){O[0]=Q[0]+S[0]*V;O[1]=Q[1]+S[1]*V;return O}function c(O,Q){const S=Q[0]-O[0];O=Q[1]-O[1];return Math.sqrt(S*S+O*O)}function d(O,Q){const S=Q[0]-O[0];O=Q[1]-O[1];return S*S+O*O}function g(O){const Q=O[0];O=O[1];return Math.sqrt(Q*Q+O*O)}function A(O){const Q=O[0];O=O[1];return Q*Q+O*O}function q(O,Q){O[0]=-Q[0];O[1]=-Q[1];return O}function y(O,Q){O[0]=1/Q[0];O[1]=1/Q[1];return O}function x(O,
Q){var S=Q[0];const V=Q[1];S=S*S+V*V;0<S&&(S=1/Math.sqrt(S),O[0]=Q[0]*S,O[1]=Q[1]*S);return O}function D(O,Q){return O[0]*Q[0]+O[1]*Q[1]}function C(O,Q,S){Q=Q[0]*S[1]-Q[1]*S[0];O[0]=O[1]=0;O[2]=Q;return O}function B(O,Q,S,V){const Y=Q[0];Q=Q[1];O[0]=Y+V*(S[0]-Y);O[1]=Q+V*(S[1]-Q);return O}function v(O,Q){Q=Q||1;const S=2*u.RANDOM()*Math.PI;O[0]=Math.cos(S)*Q;O[1]=Math.sin(S)*Q;return O}function E(O,Q,S){const V=Q[0];Q=Q[1];O[0]=S[0]*V+S[2]*Q;O[1]=S[1]*V+S[3]*Q;return O}function F(O,Q,S){const V=Q[0];
Q=Q[1];O[0]=S[0]*V+S[2]*Q+S[4];O[1]=S[1]*V+S[3]*Q+S[5];return O}function L(O,Q,S){const V=Q[0];Q=Q[1];O[0]=S[0]*V+S[3]*Q+S[6];O[1]=S[1]*V+S[4]*Q+S[7];return O}function N(O,Q,S){const V=Q[0];Q=Q[1];O[0]=S[0]*V+S[4]*Q+S[12];O[1]=S[1]*V+S[5]*Q+S[13];return O}function I(O,Q,S,V){const Y=Q[0]-S[0];Q=Q[1]-S[1];const W=Math.sin(V);V=Math.cos(V);O[0]=Y*V-Q*W+S[0];O[1]=Y*W+Q*V+S[1];return O}function G(O,Q){var S=O[0];O=O[1];const V=Q[0];Q=Q[1];let Y=S*S+O*O;0<Y&&(Y=1/Math.sqrt(Y));let W=V*V+Q*Q;0<W&&(W=1/
Math.sqrt(W));S=(S*V+O*Q)*Y*W;return 1<S?0:-1>S?Math.PI:Math.acos(S)}function K(O){return"vec2("+O[0]+", "+O[1]+")"}function H(O,Q){return O[0]===Q[0]&&O[1]===Q[1]}function J(O,Q){const S=O[0];O=O[1];const V=Q[0];Q=Q[1];return Math.abs(S-V)<=u.EPSILON*Math.max(1,Math.abs(S),Math.abs(V))&&Math.abs(O-Q)<=u.EPSILON*Math.max(1,Math.abs(O),Math.abs(Q))}var M=Object.freeze({__proto__:null,copy:f,set:p,add:t,subtract:w,multiply:e,divide:n,ceil:b,floor:h,min:k,max:l,round:m,scale:z,scaleAndAdd:r,distance:c,
squaredDistance:d,length:g,squaredLength:A,negate:q,inverse:y,normalize:x,dot:D,cross:C,lerp:B,random:v,transformMat2:E,transformMat2d:F,transformMat3:L,transformMat4:N,rotate:I,angle:G,str:K,exactEquals:H,equals:J,len:g,sub:w,mul:e,div:n,dist:c,sqrDist:d,sqrLen:A});a.add=t;a.angle=G;a.ceil=b;a.copy=f;a.cross=C;a.dist=c;a.distance=c;a.div=n;a.divide=n;a.dot=D;a.equals=J;a.exactEquals=H;a.floor=h;a.inverse=y;a.len=g;a.length=g;a.lerp=B;a.max=l;a.min=k;a.mul=e;a.multiply=e;a.negate=q;a.normalize=x;
a.random=v;a.rotate=I;a.round=m;a.scale=z;a.scaleAndAdd=r;a.set=p;a.sqrDist=d;a.sqrLen=A;a.squaredDistance=d;a.squaredLength=A;a.str=K;a.sub=w;a.subtract=w;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=L;a.transformMat4=N;a.vec2=M})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,u,f){let p=function(){function t(e,n,b=0,h,k){this.TypedArrayConstructor=e;this.elementCount=3;e=this.TypedArrayConstructor;
void 0===h&&(h=3*e.BYTES_PER_ELEMENT);const l=0===n.byteLength?0:b;this.typedBuffer=null==k?new e(n,l):new e(n,l,(k-b)/e.BYTES_PER_ELEMENT);this.typedBufferStride=h/e.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=t.prototype;w.sliceBuffer=function(e,n,b=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new e(this.buffer,n,this.stride,n+b*this.stride)};w.getVec=
function(e,n){e*=this.typedBufferStride;return f.set(n,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])};w.setVec=function(e,n){e*=this.typedBufferStride;this.typedBuffer[e++]=n[0];this.typedBuffer[e++]=n[1];this.typedBuffer[e]=n[2]};w.get=function(e,n){return this.typedBuffer[e*this.typedBufferStride+n]};w.set=function(e,n,b){this.typedBuffer[e*this.typedBufferStride+n]=b};w.setValues=function(e,n,b,h){e*=this.typedBufferStride;this.typedBuffer[e++]=n;this.typedBuffer[e++]=b;this.typedBuffer[e]=
h};w.copyFrom=function(e,n,b){const h=this.typedBuffer,k=n.typedBuffer;e*=this.typedBufferStride;n=b*n.typedBufferStride;h[e++]=k[n++];h[e++]=k[n++];h[e]=k[n]};u._createClass(t,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();p.ElementCount=3;a.BufferViewVec3Impl=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,
u,f){let p=function(){function t(e,n,b=0,h,k){this.TypedArrayConstructor=e;this.elementCount=4;e=this.TypedArrayConstructor;void 0===h&&(h=4*e.BYTES_PER_ELEMENT);const l=0===n.byteLength?0:b;this.typedBuffer=null==k?new e(n,l):new e(n,l,(k-b)/e.BYTES_PER_ELEMENT);this.typedBufferStride=h/e.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=t.prototype;w.sliceBuffer=function(e,
n,b=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new e(this.buffer,n,this.stride,n+b*this.stride)};w.getVec=function(e,n){e*=this.typedBufferStride;return f.set(n,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])};w.setVec=function(e,n){e*=this.typedBufferStride;this.typedBuffer[e++]=n[0];this.typedBuffer[e++]=n[1];this.typedBuffer[e++]=n[2];this.typedBuffer[e]=n[3]};w.get=function(e,n){return this.typedBuffer[e*this.typedBufferStride+n]};w.set=
function(e,n,b){this.typedBuffer[e*this.typedBufferStride+n]=b};w.setValues=function(e,n,b,h,k){e*=this.typedBufferStride;this.typedBuffer[e++]=n;this.typedBuffer[e++]=b;this.typedBuffer[e++]=h;this.typedBuffer[e]=k};w.copyFrom=function(e,n,b){const h=this.typedBuffer,k=n.typedBuffer;e*=this.typedBufferStride;n=b*n.typedBufferStride;h[e++]=k[n++];h[e++]=k[n++];h[e++]=k[n++];h[e]=k[n]};u._createClass(t,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();p.ElementCount=4;a.BufferViewVec4Impl=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,u){a.elementTypeSize=function(f){switch(f){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(f){switch(f){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=
function(f){switch(f){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(f){switch(f){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(a,u,f){function p(w,e,n){u.translate(t,n,e);w.setUniform3fv("localOrigin",e);w.setUniformMatrix4fv("view",t)}const t=f.create();a.bindCameraPosition=function(w,e,n){w.setUniform3f("camPos",n[3]-e[0],n[7]-e[1],n[11]-e[2])};a.bindNearFar=function(w,e){w.setUniform2fv("nearFar",e)};a.bindProjectionMatrix=function(w,e){w.setUniformMatrix4fv("proj",e)};a.bindView=function(w,e){p(w,e.origin,e.camera.viewMatrix)};a.bindViewCustomOrigin=
p;a.bindViewport=function(w,e){w.setUniform4fv("viewport",e.camera.fullViewport)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f32":function(){define(["exports"],function(a){function u(){const n=new Float32Array(16);n[0]=1;n[5]=1;n[10]=1;n[15]=1;return n}function f(n){const b=new Float32Array(16);b[0]=n[0];b[1]=n[1];b[2]=n[2];b[3]=n[3];b[4]=n[4];b[5]=n[5];b[6]=n[6];b[7]=n[7];b[8]=n[8];b[9]=n[9];b[10]=n[10];b[11]=n[11];b[12]=n[12];b[13]=n[13];b[14]=n[14];b[15]=n[15];return b}
function p(n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){const C=new Float32Array(16);C[0]=n;C[1]=b;C[2]=h;C[3]=k;C[4]=l;C[5]=m;C[6]=z;C[7]=r;C[8]=c;C[9]=d;C[10]=g;C[11]=A;C[12]=q;C[13]=y;C[14]=x;C[15]=D;return C}function t(n,b){return new Float32Array(n,b,16)}const w=u();var e=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,IDENTITY:w});a.IDENTITY=w;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat4f32=e})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util".split(" "),
function(a,u,f,p,t,w,e,n,b){const h=w.Vec3Compact;var k;(function(c){const d=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],g=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],q=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),y=new Uint16Array(36);for(var x=0;6>x;x++)for(let C=0;6>C;C++)y[6*x+C]=x;const D=new Uint16Array(36);for(x=0;6>x;x++)D[6*x]=0,D[6*x+1]=1,D[6*x+2]=2,D[6*x+3]=2,D[6*x+4]=
3,D[6*x+5]=0;c.createGeometry=function(C){Array.isArray(C)||(C=[C,C,C]);const B=Array(24);for(let v=0;8>v;v++)B[3*v]=d[v][0]*C[0],B[3*v+1]=d[v][1]*C[1],B[3*v+2]=d[v][2]*C[2];return new e.Geometry([["position",{size:3,data:B,exclusive:!0}],["normal",{size:3,data:g}],["uv0",{size:2,data:A}]],[["position",q],["normal",y],["uv0",D]])}})(k||(k={}));var l;(function(c){const d=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],g=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],A=new Uint16Array([5,
1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),q=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);c.createGeometry=function(y){Array.isArray(y)||(y=[y,y,y]);const x=Array(18);for(let D=0;6>D;D++)x[3*D]=d[D][0]*y[0],x[3*D+1]=d[D][1]*y[1],x[3*D+2]=d[D][2]*y[2];return new e.Geometry([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:g}]],[["position",A],["normal",q]])}})(l||(l={}));var m;(function(c){const d=u.fromValues(-.5,0,-.5),g=u.fromValues(.5,0,-.5),A=u.fromValues(0,
0,.5),q=u.fromValues(0,.5,0),y=u.create(),x=u.create(),D=u.create(),C=u.create(),B=u.create();a.subtract(y,d,q);a.subtract(x,d,g);a.cross(D,y,x);a.normalize(D,D);a.subtract(y,g,q);a.subtract(x,g,A);a.cross(C,y,x);a.normalize(C,C);a.subtract(y,A,q);a.subtract(x,A,d);a.cross(B,y,x);a.normalize(B,B);const v=[d,g,A,q],E=[0,-1,0,D[0],D[1],D[2],C[0],C[1],C[2],B[0],B[1],B[2]],F=[0,1,2,3,1,0,3,2,1,3,0,2],L=[0,0,0,1,1,1,2,2,2,3,3,3];c.createGeometry=function(N){Array.isArray(N)||(N=[N,N,N]);const I=Array(12);
for(let G=0;4>G;G++)I[3*G]=v[G][0]*N[0],I[3*G+1]=v[G][1]*N[1],I[3*G+2]=v[G][2]*N[2];return new e.Geometry([["position",{size:3,data:I,exclusive:!0}],["normal",{size:3,data:E}]],[["position",new Uint16Array(F)],["normal",new Uint16Array(L)]])}})(m||(m={}));var z;(function(c){function d(q,y,x,D,C){if(Math.abs(a.dot(y,q))>C)return!1;a.cross(x,q,y);a.normalize(x,x);a.cross(D,x,q);a.normalize(D,D);return!0}function g(q,y,x,D,C,B,v){return d(q,y,C,B,v)||d(q,x,C,B,v)||d(q,D,C,B,v)}c.createBoxGeometry=k.createGeometry;
c.createDiamondGeometry=l.createGeometry;c.createTetrahedronGeometry=m.createGeometry;c.createSphereGeometry=function(q,y,x,D={uv:!0}){var C=-Math.PI,B=2*Math.PI,v=-Math.PI/2,E=Math.PI;y=Math.max(3,Math.floor(y));const F=Math.max(2,Math.floor(x));var L=(y+1)*(F+1);x=new Float32Array(3*L);const N=new Float32Array(3*L);L=new Float32Array(2*L);const I=[];let G=0;for(var K=0;K<=F;K++){var H=[];const M=K/F,O=v+M*E,Q=Math.cos(O);for(let S=0;S<=y;S++){const V=S/y;var J=C+V*B;const Y=Math.cos(J)*Q,W=Math.sin(O);
J=-Math.sin(J)*Q;x[3*G]=Y*q;x[3*G+1]=W*q;x[3*G+2]=J*q;N[3*G]=Y;N[3*G+1]=W;N[3*G+2]=J;L[2*G]=V;L[2*G+1]=M;H.push(G);++G}I.push(H)}q=new Uint32Array(2*y*(F-1)*3);G=0;for(C=0;C<F;C++)for(B=0;B<y;B++)v=I[C][B],E=I[C][B+1],K=I[C+1][B+1],H=I[C+1][B],0===C?(q[G++]=v,q[G++]=K,q[G++]=H):C===F-1?(q[G++]=v,q[G++]=E,q[G++]=K):(q[G++]=v,q[G++]=E,q[G++]=K,q[G++]=K,q[G++]=H,q[G++]=v);y=[["position",q],["normal",q]];x=[["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:N,exclusive:!0}]];D.uv&&(x.push(["uv0",
{size:2,data:L,exclusive:!0}]),y.push(["uv0",q]));D.offset&&(y[0][0]="offset",x[0][0]="offset",y.push(["position",new Uint32Array(q.length)]),x.push(["position",{size:3,data:Float64Array.from(D.offset),exclusive:!0}]));return new e.Geometry(x,y)};c.createPolySphereGeometry=function(q,y,x){function D(E,F){E>F&&([E,F]=[F,E]);const L=E.toString()+"."+F.toString();if(v[L])return v[L];let N=C.length;C.length+=3;h.add(C,3*E,C,3*F,C,N);h.scale(C,N,q/h.length(C,N));N/=3;return v[L]=N}let C;x?(C=[0,-1,0,1,
0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],x=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(x=q*(1+Math.sqrt(5))/2,C=[-q,x,0,q,x,0,-q,-x,0,q,-x,0,0,-q,x,0,q,x,0,-q,-x,0,q,-x,x,0,-q,x,0,q,-x,0,-q,-x,0,q],x=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var B=0;B<C.length;B+=3)h.scale(C,B,q/h.length(C,B));let v={};for(B=0;B<y;B++){const E=x.length,F=new Uint32Array(4*E);for(let L=0;L<
E;L+=3){const N=x[L],I=x[L+1],G=x[L+2],K=D(N,I),H=D(I,G),J=D(G,N),M=4*L;F[M]=N;F[M+1]=K;F[M+2]=J;F[M+3]=I;F[M+4]=H;F[M+5]=K;F[M+6]=G;F[M+7]=J;F[M+8]=H;F[M+9]=K;F[M+10]=H;F[M+11]=J}x=F;v={}}y=new Float32Array(C);for(B=0;B<y.length;B+=3)h.normalize(y,B);x=[["position",x],["normal",x]];y=[["position",{size:3,data:new Float32Array(C),exclusive:!0}],["normal",{size:3,data:y,exclusive:!0}]];return new e.Geometry(y,x)};c.createPointGeometry=function(q,y,x,D,C,B,v){y=y?[y[0],y[1],y[2]]:[0,0,0];q=q?[q[0],
q[1],q[2]]:[0,0,1];B=B||[0,0];x=[["position",{size:3,data:y,exclusive:!0}],["normal",{size:3,data:q,exclusive:!0}],["uv0",{size:B.length,data:B}],["color",{size:4,data:x?[255*x[0],255*x[1],255*x[2],3<x.length?255*x[3]:255]:[255,255,255,255],exclusive:!0}],["size",{size:2,data:null!=D&&2===D.length?D:[1,1]}]];null!=C&&(C=new Float32Array([C[0],C[1],C[2],C[3]]),x.push(["auxpos1",{size:4,data:C}]));null!=v&&(v=new Float32Array([v[0],v[1],v[2],v[3]]),x.push(["auxpos2",{size:4,data:v}]));return new e.Geometry(x,
null,1)};c.updatePointGeometry=function(q,y,x,D,C,B,v,E){if(null!=q){const {data:F}=E.getMutableAttribute("normal");F[0]=q[0];F[1]=q[1];F[2]=q[2]}null!=y&&({data:q}=E.getMutableAttribute("position"),q[0]=y[0],q[1]=y[1],q[2]=y[2]);null!=x&&({data:y}=E.getMutableAttribute("color"),y[0]=x[0],y[1]=x[1],y[2]=x[2],y[3]=x[3]);null!=D&&({data:x}=E.getMutableAttribute("size"),x[0]=D[0],x[1]=D[1]);null!=C&&({data:D}=E.getMutableAttribute("auxpos1"),D[0]=C[0],D[1]=C[1],D[2]=C[2],D[3]=C[3]);null!=B&&({data:C}=
E.getMutableAttribute("uv0"),C[0]=B[0],C[1]=B[1]);null!=v&&({data:B}=E.getMutableAttribute("auxpos2"),B[0]=v[0],B[1]=v[1],B[2]=v[2],B[3]=v[3])};c.createPointArrayGeometry=function(q,y){const x=new Float32Array(3*q.length),D=new Float32Array(y?3*q.length:3),C=new Uint32Array(q.length),B=new Uint32Array(q.length);for(let v=0;v<q.length;v++)x[3*v]=q[v][0],x[3*v+1]=q[v][1],x[3*v+2]=q[v][2],y&&(D[3*v]=y[v][0],D[3*v+1]=y[v][1],D[3*v+2]=y[v][2]),C[v]=v,B[v]=0;y||(D[0]=0,D[1]=1,D[2]=0);return new e.Geometry([["position",
{size:3,data:x,exclusive:!0}],["normal",{size:3,data:D,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",C],["normal",y?C:B],["uv0",B]],1)};c.createTriangleGeometry=function(){const q=new Uint16Array([0,1,2]),y=new Uint16Array([0,0,0]),x=new Uint16Array([0,0,0]);return new e.Geometry([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",q],["normal",y],["uv0",x]])};const A=
[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];c.createSquareGeometry=function(q=A){const y=Array(12);for(var x=0;4>x;x++)for(let D=0;3>D;D++)y[3*x+D]=q[x][D];q=new Uint32Array([0,1,2,2,3,0]);x=new Uint32Array([0,0,0,0,0,0]);return new e.Geometry([["position",{size:3,data:y,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",q],["normal",x],["uv0",q],["color",x]])};c.createConeGeometry=
function(q,y,x,D,C=!0,B=!0){var v=0,E=u.fromValues(0,v,0),F=u.fromValues(0,v+q,0),L=u.fromValues(0,-1,0),N=u.fromValues(0,1,0);D&&(v=q,F=u.fromValues(0,0,0),E=u.fromValues(0,v,0),L=u.fromValues(0,1,0),N=u.fromValues(0,-1,0));E=[F,E];L=[L,N];N=x+2;F=Math.sqrt(q*q+y*y);if(D)for(D=x-1;0<=D;D--){var I=2*Math.PI/x*D,G=u.fromValues(Math.cos(I)*y,v,Math.sin(I)*y);E.push(G);I=u.fromValues(q*Math.cos(I)/F,-y/F,q*Math.sin(I)/F);L.push(I)}else for(D=0;D<x;D++)I=2*Math.PI/x*D,G=u.fromValues(Math.cos(I)*y,v,Math.sin(I)*
y),E.push(G),I=u.fromValues(q*Math.cos(I)/F,y/F,q*Math.sin(I)/F),L.push(I);q=new Uint32Array(6*(x+2));x=new Uint32Array(6*(x+2));v=y=0;if(C){for(C=3;C<E.length;C++)q[y++]=1,q[y++]=C-1,q[y++]=C,x[v++]=0,x[v++]=0,x[v++]=0;q[y++]=E.length-1;q[y++]=2;q[y++]=1;x[v++]=0;x[v++]=0;x[v++]=0}if(B){for(B=3;B<E.length;B++)q[y++]=B,q[y++]=B-1,q[y++]=0,x[v++]=B,x[v++]=B-1,x[v++]=1;q[y++]=0;q[y++]=2;q[y++]=E.length-1;x[v++]=1;x[v++]=2;x[v++]=L.length-1}B=new Float32Array(3*N);for(C=0;C<N;C++)B[3*C]=E[C][0],B[3*
C+1]=E[C][1],B[3*C+2]=E[C][2];E=new Float32Array(3*N);for(C=0;C<N;C++)E[3*C]=L[C][0],E[3*C+1]=L[C][1],E[3*C+2]=L[C][2];return new e.Geometry([["position",{size:3,data:B,exclusive:!0}],["normal",{size:3,data:E,exclusive:!0}]],[["position",q],["normal",x]])};c.createCylinderGeometry=function(q,y,x,D,C,B){D=D?u.clone(D):u.fromValues(1,0,0);C=C?u.clone(C):u.fromValues(0,0,0);B=null==B?!0:B;var v=u.create();a.normalize(v,D);const E=u.create();a.scale(E,v,Math.abs(q));const F=u.create();a.scale(F,E,-.5);
a.add(F,F,C);const L=u.fromValues(0,1,0);.2>Math.abs(1-a.dot(v,L))&&a.set(L,0,0,1);const N=u.create();a.cross(N,v,L);a.normalize(N,N);a.cross(L,N,v);q=2*x+(B?2:0);C=x+(B?2:0);D=new Float32Array(3*q);const I=new Float32Array(3*C),G=new Float32Array(2*q),K=new Uint32Array(3*x*(B?4:2)),H=new Uint32Array(3*x*(B?4:2));B&&(D[3*(q-2)]=F[0],D[3*(q-2)+1]=F[1],D[3*(q-2)+2]=F[2],G[2*(q-2)]=0,G[2*(q-2)+1]=0,D[3*(q-1)]=D[3*(q-2)]+E[0],D[3*(q-1)+1]=D[3*(q-2)+1]+E[1],D[3*(q-1)+2]=D[3*(q-2)+2]+E[2],G[2*(q-1)]=1,
G[2*(q-1)+1]=1,I[3*(C-2)]=-v[0],I[3*(C-2)+1]=-v[1],I[3*(C-2)+2]=-v[2],I[3*(C-1)]=v[0],I[3*(C-1)+1]=v[1],I[3*(C-1)+2]=v[2]);v=function(S,V,Y){K[S]=V;H[S]=Y};let J=0;const M=u.create(),O=u.create();for(let S=0;S<x;S++){var Q=2*Math.PI/x*S;a.scale(M,L,Math.sin(Q));a.scale(O,N,Math.cos(Q));a.add(M,M,O);I[3*S]=M[0];I[3*S+1]=M[1];I[3*S+2]=M[2];a.scale(M,M,y);a.add(M,M,F);D[3*S]=M[0];D[3*S+1]=M[1];D[3*S+2]=M[2];G[2*S]=S/x;G[2*S+1]=0;D[3*(S+x)]=D[3*S]+E[0];D[3*(S+x)+1]=D[3*S+1]+E[1];D[3*(S+x)+2]=D[3*S+2]+
E[2];G[2*(S+x)]=S/x;G[2*S+1]=1;Q=(S+1)%x;v(J++,S,S);v(J++,S+x,S);v(J++,Q,Q);v(J++,Q,Q);v(J++,S+x,S);v(J++,Q+x,Q)}if(B){for(y=0;y<x;y++)B=(y+1)%x,v(J++,q-2,C-2),v(J++,y,C-2),v(J++,B,C-2);for(y=0;y<x;y++)B=(y+1)%x,v(J++,y+x,C-1),v(J++,q-1,C-1),v(J++,B+x,C-1)}return new e.Geometry([["position",{size:3,data:D,exclusive:!0}],["normal",{size:3,data:I,exclusive:!0}],["uv0",{size:2,data:G,exclusive:!0}]],[["position",K],["normal",H],["uv0",K]])};c.createTubeGeometry=function(q,y,x,D,C){x=x||10;D=null!=D?
D:!0;b.assert(1<q.length);const B=[],v=[];for(let E=0;E<x;E++){B.push([0,-E-1,-((E+1)%x)-1]);const F=E/x*2*Math.PI;v.push([Math.cos(F)*y,Math.sin(F)*y])}return c.createPathExtrusionGeometry(v,q,[[0,0,0]],B,D,C)};c.createPathExtrusionGeometry=function(q,y,x,D,C,B=u.fromValues(0,0,0)){var v=q.length;const E=new Float32Array(y.length*v*3+(6*x.length||0)),F=new Float32Array(y.length*v*3+(x?6:0));var L=(y.length-1)*v*6+6*D.length;const N=new Uint32Array(L);L=new Uint32Array(L);let I=0;var G=0;let K=0,
H=0;const J=u.create(),M=u.create(),O=u.create(),Q=u.create(),S=u.create(),V=u.create(),Y=u.create(),W=f.create(),ba=u.create(),ca=u.create(),da=u.create(),ha=u.create(),fa=u.create(),R=p.create();a.set(ba,0,1,0);a.subtract(M,y[1],y[0]);a.normalize(M,M);C?(a.add(W,y[0],B),a.normalize(O,W)):a.set(O,0,0,1);g(M,O,ba,ba,S,O,.99619469809);a.copy(Q,O);a.copy(ha,S);for(var U=0;U<x.length;U++)a.scale(V,S,x[U][0]),a.scale(W,O,x[U][2]),a.add(V,V,W),a.add(V,V,y[0]),E[I++]=V[0],E[I++]=V[1],E[I++]=V[2];F[G++]=
-M[0];F[G++]=-M[1];F[G++]=-M[2];for(U=0;U<D.length;U++)N[K++]=0<D[U][0]?D[U][0]:-D[U][0]-1+x.length,N[K++]=0<D[U][1]?D[U][1]:-D[U][1]-1+x.length,N[K++]=0<D[U][2]?D[U][2]:-D[U][2]-1+x.length,L[H++]=0,L[H++]=0,L[H++]=0;U=x.length;const Z=x.length-1;for(let P=0;P<y.length;P++){let X=!1;0<P&&(a.copy(J,M),P<y.length-1?(a.subtract(M,y[P+1],y[P]),a.normalize(M,M)):X=!0,a.add(ca,J,M),a.normalize(ca,ca),a.add(da,y[P-1],Q),p.fromPositionAndNormal(y[P],ca,R),p.intersectRay(R,t.wrap(da,J),W)?(a.subtract(W,W,
y[P]),a.normalize(O,W),a.cross(S,ca,O),a.normalize(S,S)):g(ca,Q,ha,ba,S,O,.99619469809),a.copy(Q,O),a.copy(ha,S));C&&(a.add(W,y[P],B),a.normalize(fa,W));for(let aa=0;aa<v;aa++)if(a.scale(V,S,q[aa][0]),a.scale(W,O,q[aa][1]),a.add(V,V,W),a.normalize(Y,V),F[G++]=Y[0],F[G++]=Y[1],F[G++]=Y[2],a.add(V,V,y[P]),E[I++]=V[0],E[I++]=V[1],E[I++]=V[2],!X){var T=(aa+1)%v;N[K++]=U+aa;N[K++]=U+v+aa;N[K++]=U+T;N[K++]=U+T;N[K++]=U+v+aa;N[K++]=U+v+T;for(T=0;6>T;T++)L[H++]=N[K-6+T]-Z}U+=v}q=y[y.length-1];for(y=0;y<x.length;y++)a.scale(V,
S,x[y][0]),a.scale(W,O,x[y][1]),a.add(V,V,W),a.add(V,V,q),E[I++]=V[0],E[I++]=V[1],E[I++]=V[2];x=G/3;F[G++]=M[0];F[G++]=M[1];F[G++]=M[2];v=U-v;for(G=0;G<D.length;G++)N[K++]=0<=D[G][0]?U+D[G][0]:-D[G][0]-1+v,N[K++]=0<=D[G][2]?U+D[G][2]:-D[G][2]-1+v,N[K++]=0<=D[G][1]?U+D[G][1]:-D[G][1]-1+v,L[H++]=x,L[H++]=x,L[H++]=x;return new e.Geometry([["position",{size:3,data:E,exclusive:!0}],["normal",{size:3,data:F,exclusive:!0}]],[["position",N],["normal",L]])};c.createPolylineGeometry=function(q,y,x){b.assert(1<
q.length,"createPolylineGeometry(): polyline needs at least 2 points");b.assert(3===q[0].length,"createPolylineGeometry(): malformed vertex");b.assert(null==y||y.length===q.length,"createPolylineGeometry: need same number of points and normals");b.assert(null==y||3===y[0].length,"createPolylineGeometry(): malformed normal");var D=new Float64Array(3*q.length);const C=new Uint32Array(2*(q.length-1));var B=0,v=0;for(var E=0;E<q.length;E++){for(var F=0;3>F;F++)D[B++]=q[E][F];0<E&&(C[v++]=E-1,C[v++]=E)}B=
[];v=[];B.push(["position",C]);v.push(["position",{size:3,data:D,exclusive:!0}]);if(y){D=new Float32Array(3*y.length);E=0;for(F=0;F<q.length;F++)for(let L=0;3>L;L++)D[E++]=y[F][L];B.push(["normal",C]);v.push(["normal",{size:3,data:D,exclusive:!0}])}x&&(v.push(["color",{size:4,data:x}]),B.push(["color",n.generateDefaultIndexArray(x.length/4)]));return new e.Geometry(v,B,2)};c.createExtrudedTriangle=function(q,y,x,D,C=0){const B=Array(18);q=[[-y,C,D/2],[x,C,D/2],[0,q+C,D/2],[-y,C,-D/2],[x,C,-D/2],[0,
q+C,-D/2]];y=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(x=0;6>x;x++)B[3*x]=q[x][0],B[3*x+1]=q[x][1],B[3*x+2]=q[x][2];return new e.Geometry([["position",{size:3,data:B,exclusive:!0}]],[["position",y]])};c.transformInPlace=function(q,y){q=q.getMutableAttribute("position").data;for(let x=0;x<q.length;x+=3)a.set(r,q[x],q[x+1],q[x+2]),a.transformMat4(r,r,y),q[x]=r[0],q[x+1]=r[1],q[x+2]=r[2]};c.cgToGIS=function(q,y=q){var x=q.vertexAttributes;q=x.get("position").data;if(x=x.get("normal").data){var D=
y.getMutableAttribute("normal").data;for(var C=0;C<x.length;C+=3){const B=x[C+1];D[C+1]=-x[C+2];D[C+2]=B}}if(q)for(x=y.getMutableAttribute("position").data,D=0;D<q.length;D+=3)C=q[D+1],x[D+1]=-q[D+2],x[D+2]=C;return y};c.makeOrthoBasisDirUp=d;c.makeOrthoBasisDirUpFallback=g})(z||(z={}));const r=u.create();return z})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function u(){return new Float32Array(3)}function f(d){const g=new Float32Array(3);g[0]=d[0];g[1]=d[1];g[2]=d[2];return g}
function p(d,g,A){const q=new Float32Array(3);q[0]=d;q[1]=g;q[2]=A;return q}function t(d,g){return new Float32Array(d,g,3)}function w(){return u()}function e(){return p(1,1,1)}function n(){return p(1,0,0)}function b(){return p(0,1,0)}function h(){return p(0,0,1)}const k=u(),l=e(),m=n(),z=b(),r=h();var c=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,zeros:w,ones:e,unitX:n,unitY:b,unitZ:h,ZEROS:k,ONES:l,UNIT_X:m,UNIT_Y:z,UNIT_Z:r});a.ONES=l;a.UNIT_X=m;a.UNIT_Y=z;a.UNIT_Z=
r;a.ZEROS=k;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.ones=e;a.unitX=n;a.unitY=b;a.unitZ=h;a.vec3f32=c;a.zeros=w})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(u){u.length=function(f,p){const t=f[p],w=f[p+1];f=f[p+2];return Math.sqrt(t*t+w*w+f*f)};u.normalize=function(f,p){var t=f[p];const w=f[p+1],e=f[p+2];t=1/Math.sqrt(t*t+w*w+e*e);f[p]*=t;f[p+1]*=t;f[p+2]*=t};u.scale=function(f,p,t){f[p]*=t;f[p+1]*=t;f[p+
2]*=t};u.add=function(f,p,t,w,e,n=p){e=e||f;e[n]=f[p]+t[w];e[n+1]=f[p+1]+t[w+1];e[n+2]=f[p+2]+t[w+2]};u.subtract=function(f,p,t,w,e,n=p){e=e||f;e[n]=f[p]-t[w];e[n+1]=f[p+1]-t[w+1];e[n+2]=f[p+2]-t[w+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./BoundingInfo ./ContentObject ./geometryDataUtils ./Util".split(" "),function(a,
u,f,p,t,w,e){function n(b){if(b.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return b;for(const h of b)if(65536<=h)return b;return new Uint16Array(b)}t=function(b){function h(l,m=[],z=0,r=-1){var c=b.call(this)||this;c._primitiveType=z;c.edgeIndicesLength=r;c.type=2;c._vertexAttributes=new Map;c._indices=new Map;c._boundingInfo=null;for(const [d,g]of l)g&&c._vertexAttributes.set(d,{...g});if(null==m||0===m.length){l=c._vertexAttributes.values().next().value;l=null==l?0:l.data.length/l.size;m=
w.generateDefaultIndexArray(l);c.edgeIndicesLength=0>c.edgeIndicesLength?l:c.edgeIndicesLength;for(const d of c._vertexAttributes.keys())c._indices.set(d,m)}else for(const [d,g]of m)g&&(c._indices.set(d,n(g)),"position"===d&&(c.edgeIndicesLength=0>c.edgeIndicesLength?c._indices.get(d).length:c.edgeIndicesLength));return c}u._inheritsLoose(h,b);var k=h.prototype;k.getMutableAttribute=function(l){(l=this._vertexAttributes.get(l))&&!l.exclusive&&(l.data=Array.from(l.data),l.exclusive=!0);return l};k.computeAttachmentOrigin=
function(l){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(l):this.computeAttachmentOriginPoints(l)};k.computeAttachmentOriginTriangles=function(l){const m=this.indices.get("position"),z=this.vertexAttributes.get("position");return w.computeAttachmentOriginTriangles(z,m,l)};k.computeAttachmentOriginPoints=function(l){const m=this.indices.get("position"),z=this.vertexAttributes.get("position");return w.computeAttachmentOriginPoints(z,m,l)};k.invalidateBoundingInfo=function(){this._boundingInfo=
null};k._calculateBoundingInfo=function(){const l=this.indices.get("position");if(0===l.length)return null;const m=0===this.primitiveType?3:1;e.assert(0===l.length%m,"Indexing error: "+l.length+" not divisible by "+m);const z=w.generateDefaultIndexArray(l.length/m),r=this.vertexAttributes.get("position");return new p.BoundingInfo(z,m,l,r)};u._createClass(h,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",
get:function(){const l=this._indices.values().next().value;return l?l.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){f.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return h}(t.ContentObject);a.Geometry=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports",
"../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,u,f,p,t){let w=function(){function n(h,k,l,m){this.primitiveIndices=h;this._numIndexPerPrimitive=k;this.indices=l;this.position=m;this.center=p.create();t.assert(1<=h.length);t.assert(0===l.length%this._numIndexPerPrimitive);t.assert(l.length>=h.length*this._numIndexPerPrimitive);t.assert(3===m.size||4===m.size);const {data:z,size:r}=m;m=h.length;k=r*l[this._numIndexPerPrimitive*h[0]];e.clear();
e.push(k);this.bbMin=p.fromValues(z[k],z[k+1],z[k+2]);this.bbMax=p.clone(this.bbMin);for(var c=0;c<m;++c){var d=this._numIndexPerPrimitive*h[c];for(var g=0;g<this._numIndexPerPrimitive;++g){k=r*l[d+g];e.push(k);let A=z[k];this.bbMin[0]=Math.min(A,this.bbMin[0]);this.bbMax[0]=Math.max(A,this.bbMax[0]);A=z[k+1];this.bbMin[1]=Math.min(A,this.bbMin[1]);this.bbMax[1]=Math.max(A,this.bbMax[1]);A=z[k+2];this.bbMin[2]=Math.min(A,this.bbMin[2]);this.bbMax[2]=Math.max(A,this.bbMax[2])}}f.lerp(this.center,this.bbMin,
this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);h=this.radius*this.radius;for(l=0;l<e.length;++l)k=e.getItemAt(l),m=z[k]-this.center[0],c=z[k+1]-this.center[1],k=z[k+2]-this.center[2],d=m*m+c*c+k*k,d<=h||(d=Math.sqrt(d),g=.5*(d-this.radius),this.radius+=g,h=this.radius*this.radius,d=g/d,this.center[0]+=m*d,this.center[1]+=c*d,this.center[2]+=k*d);e.clear()}var b=n.prototype;b.getCenter=function(){return this.center};
b.getBSRadius=function(){return this.radius};b.getBBMin=function(){return this.bbMin};b.getBBMax=function(){return this.bbMax};b.getChildren=function(){if(this._children)return this._children;if(1<f.squaredDistance(this.bbMin,this.bbMax)){var h=f.lerp(p.create(),this.bbMin,this.bbMax,.5),k=this.primitiveIndices.length;const r=new Uint8Array(k),c=Array(8);for(var l=0;8>l;++l)c[l]=0;const {data:d,size:g}=this.position;for(l=0;l<k;++l){var m=0;const A=this._numIndexPerPrimitive*this.primitiveIndices[l];
var z=g*this.indices[A];let q=d[z],y=d[z+1],x=d[z+2];for(let D=1;D<this._numIndexPerPrimitive;++D){z=g*this.indices[A+D];const C=d[z],B=d[z+1];z=d[z+2];C<q&&(q=C);B<y&&(y=B);z<x&&(x=z)}q<h[0]&&(m|=1);y<h[1]&&(m|=2);x<h[2]&&(m|=4);r[l]=m;++c[m]}h=0;for(l=0;8>l;++l)0<c[l]&&++h;if(2>h)return;h=Array(8);for(l=0;8>l;++l)h[l]=0<c[l]?new Uint32Array(c[l]):void 0;for(l=0;8>l;++l)c[l]=0;for(l=0;l<k;++l)m=r[l],h[m][c[m]++]=this.primitiveIndices[l];this._children=Array(8);for(k=0;8>k;++k)void 0!==h[k]&&(this._children[k]=
new n(h[k],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};n.prune=function(){e.prune()};return n}();const e=new u({deallocator:null});a.BoundingInfo=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Util":function(){define("exports ../../../../core/mathUtils ../../../../chunks/mat4 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64".split(" "),function(a,
u,f,p,t,w,e,n){function b(g,A){if(!g)throw A=A||"assert",g=Error(A),g.stack&&console.log(g.stack),new z(A);}function h(g,A){g[12]=A[0];g[13]=A[1];g[14]=A[2]}function k(g,A=0){let q=0;for(let y=0;4>y;y++)q+=g[A+y]*c[y];return q}function l(g){return g-Math.floor(g)}const m=n.create();let z=function(){function g(A){this.message=A}g.prototype.toString=function(){return`AssertException: ${this.message}`};return g}();const r=[1,256,65536,16777216],c=[1/256,1/65536,1/16777216,1/4294967296],d=k(new Uint8ClampedArray([255,
255,255,255]));a.AssertException=z;a.assert=b;a.createTranslationMatrix=function(g,A){g=f.identity(g);h(g,A);return g};a.dec2hex=function(g){g=g.toString(16);return"00000000".substr(0,8-g.length)+g};a.encodeInt16=function(g){return u.clamp(Math.round(32767*g),-32767,32767)};a.encodeNormal=function(g,A){const q=Math.abs(g[0]),y=Math.abs(g[1]),x=1/(q+y+Math.abs(g[2])),D=Math.min(g[2]*x,0);A[0]=(0>g[0]?-1:1)*(q*x-D);A[1]=(0>g[1]?-1:1)*(y*x-D)};a.fallbackIfUndefined=function(g,A){return void 0===g?A:
g};a.fovd2fovx=function(g,A,q){return 2*Math.atan(A*Math.tan(.5*g)/Math.sqrt(A*A+q*q))};a.fovd2fovy=function(g,A,q){return 2*Math.atan(q*Math.tan(.5*g)/Math.sqrt(A*A+q*q))};a.fovx2fovd=function(g,A,q){return 2*Math.atan(Math.sqrt(A*A+q*q)*Math.tan(.5*g)/A)};a.fovx2fovy=function(g,A,q){return 2*Math.atan(q*Math.tan(.5*g)/A)};a.fovy2fovd=function(g,A,q){return 2*Math.atan(Math.sqrt(A*A+q*q)*Math.tan(.5*g)/q)};a.fovy2fovx=function(g,A,q){return 2*Math.atan(A*Math.tan(.5*g)/q)};a.getFirstObjectKey=function(g){for(const A in g)return A};
a.getMatrixTranslation=function(g,A=w.create()){A[0]=g[12];A[1]=g[13];A[2]=g[14];return A};a.hex2rgb=function(g){g=Math.floor(g);return[(g>>16&255)/255,(g>>8&255)/255,(g&255)/255]};a.inverseProjectionInfo=function(g,A,q,y,x){0===g[11]?(y[0]=2/(A*g[0]),y[1]=2/(q*g[5]),y[2]=(1+g[12])/g[0],y[3]=(1+g[13])/g[5],p.set(x,0,1)):(y[0]=-2/(A*g[0]),y[1]=-2/(q*g[5]),y[2]=(1-g[8])/g[0],y[3]=(1-g[9])/g[5],p.set(x,1,0))};a.isTranslationMatrix=function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&
1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&1===g[15]};a.logWithBase=function(g,A){return Math.log(g)/Math.log(A)};a.objectEmpty=function(g){for(const A in g)return!1;return!0};a.packFloatRGBA=function(g,A,q=0){g=u.clamp(g,0,d);for(let y=0;4>y;y++)A[q+y]=Math.floor(256*l(g*r[y]))};a.project=function(g,A,q,y,x){x||(x=g);m[0]=g[0];m[1]=g[1];m[2]=g[2];m[3]=1;e.transformMat4(m,m,A);2<x.length&&(x[2]=-m[2]);e.transformMat4(m,m,q);b(0!==m[3]);x[0]=m[0]/m[3];x[1]=m[1]/m[3];x[2]=
m[2]/m[3];x[0]=(.5*x[0]+.5)*y[2]+y[0];x[1]=(.5*x[1]+.5)*y[3]+y[1]};a.rayBoxTest=function(g,A,q,y){let x,D=(q[0]-g[0])/A[0],C=(y[0]-g[0])/A[0];D>C&&(x=D,D=C,C=x);let B=(q[1]-g[1])/A[1],v=(y[1]-g[1])/A[1];B>v&&(x=B,B=v,v=x);if(D>v||B>C)return!1;B>D&&(D=B);v<C&&(C=v);q=(q[2]-g[2])/A[2];g=(y[2]-g[2])/A[2];q>g&&(x=q,q=g,g=x);if(D>g||q>C)return!1;g<C&&(C=g);return 0>C?!1:!0};a.rayRay2D=function(g,A,q,y,x,D=t.create()){const C=(y[x]-q[x])*(A[0]-g[0])-(y[0]-q[0])*(A[x]-g[x]);if(0===C)return!1;q=((y[0]-q[0])*
(g[x]-q[x])-(y[x]-q[x])*(g[0]-q[0]))/C;D[0]=g[0]+q*(A[0]-g[0]);D[1]=g[x]+q*(A[x]-g[x]);return!0};a.rayTriangle3D=function(g,A,q,y,x,D,C,B,v=w.create()){var E=y[C]-q[D];const F=y[C+1]-q[D+1],L=y[C+2]-q[D+2];y=x[B]-q[D];C=x[B+1]-q[D+1];x=x[B+2]-q[D+2];const N=A[1]*x-C*A[2],I=A[2]*y-x*A[0],G=A[0]*C-y*A[1];B=E*N+F*I+L*G;if(-1E-5<B&&1E-5>B)return!1;B=1/B;const K=g[0]-q[D],H=g[1]-q[D+1];g=g[2]-q[D+2];v[1]=B*(K*N+H*I+g*G);if(0>v[1]||1<v[1])return!1;q=H*L-F*g;g=g*E-L*K;E=K*F-E*H;v[2]=B*(A[0]*q+A[1]*g+A[2]*
E);if(0>v[2]||1<v[1]+v[2])return!1;v[0]=B*(y*q+C*g+x*E);return!0};a.rgb2hex=function(g){const A=u.clamp(Math.round(255*g[0]),0,255),q=u.clamp(Math.round(255*g[1]),0,255);g=u.clamp(Math.round(255*g[2]),0,255);return"0x"+((A<<16)+(q<<8)+g).toString(16)};a.setMatrixTranslation=h;a.setMatrixTranslation3=function(g,A,q,y){g[12]=A;g[13]=q;g[14]=y};a.unpackFloatRGBA=k;a.verify=function(g,A){g||console.warn("Verify failed: "+(A||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,u){let f=function(){function p(){this.id=u.generateUID()}p.prototype.unload=function(){};return p}();a.ContentObject=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,u,f,p){let t=(()=>{const l=new Uint32Array(131072);
for(let m=0;m<l.length;++m)l[m]=m;return l})();const w=new Uint16Array([0]),e=(()=>{const l=new Uint16Array(65536);for(let m=0;m<l.length;++m)l[m]=m;return l})(),n=f.create(),b=f.create(),h=f.create(),k=f.create();a.computeAttachmentOriginLines=function(l,m,z,r){if(!l)return!1;const {size:c,data:d}=l;u.set(r,0,0,0);u.set(k,0,0,0);let g=l=0;const A=m?m.length-1:d.length/c-1;z=A+(z?2:0);for(let x=0;x<z;x+=2){var q=x<A?x:A,y=x<A?x+1:0;q=(m?m[q]:q)*c;y=(m?m[y]:y)*c;n[0]=d[q+0];n[1]=d[q+1];n[2]=d[q+2];
b[0]=d[y+0];b[1]=d[y+1];b[2]=d[y+2];u.scale(n,u.add(n,n,b),.5);y=u.dist(n,b);0<y?(u.add(r,r,u.scale(n,n,y)),l+=y):(u.add(k,k,n),g++)}return 0!==l?(u.scale(r,r,1/l),!0):0!==g?(u.scale(r,k,1/g),!0):!1};a.computeAttachmentOriginPoints=function(l,m,z){if(!l||!m)return!1;const {size:r,data:c}=l;u.set(z,0,0,0);l=-1;let d=0;for(let g=0;g<m.length;g++){const A=m[g]*r;l!==A&&(z[0]+=c[A+0],z[1]+=c[A+1],z[2]+=c[A+2],d++);l=A}1<d&&u.scale(z,z,1/d);return 0<d};a.computeAttachmentOriginTriangles=function(l,m,z){if(!l)return!1;
const {size:r,data:c}=l;u.set(z,0,0,0);u.set(k,0,0,0);let d=l=0;for(let A=0;A<m.length-2;A+=3){var g=m[A+0]*r;const q=m[A+1]*r,y=m[A+2]*r;u.set(n,c[g+0],c[g+1],c[g+2]);u.set(b,c[q+0],c[q+1],c[q+2]);u.set(h,c[y+0],c[y+1],c[y+2]);(g=p.areaPoints3d(n,b,h))?(u.add(n,n,b),u.add(n,n,h),u.scale(n,n,1/3*g),u.add(z,z,n),l+=g):(u.add(k,k,n),u.add(k,k,b),u.add(k,k,h),d+=3)}return 0===d&&0===l?!1:0!==l?(u.scale(z,z,1/l),!0):0!==d?(u.scale(z,k,1/d),!0):!1};a.generateDefaultIndexArray=function(l){if(1===l)return w;
if(l<e.length)return new Uint16Array(e.buffer,0,l);if(l>t.length){t=new Uint32Array(Math.max(2*t.length,l));for(let m=0;m<t.length;m++)t[m]=m}return new Uint32Array(t.buffer,0,l)};a.generateIndexArray=function(l){if(1===l)return new Uint16Array(w);if(l<e.length)return new Uint16Array(e.slice(0,l));if(l>t.length){l=new Uint32Array(l);for(let m=0;m<l.length;m++)l[m]=m;return l}return new Uint32Array(t.slice(0,l))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec2 ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),
function(a,u,f,p,t,w,e){function n(r){return r?{p0:t.clone(r.p0),p1:t.clone(r.p1),p2:t.clone(r.p2)}:{p0:t.create(),p1:t.create(),p2:t.create()}}function b(r,c,d,g=n()){p.copy(g.p0,r);p.copy(g.p1,c);p.copy(g.p2,d);return g}function h(r,c,d){var g=f.distance(r,c);c=f.distance(c,d);r=f.distance(d,r);d=(g+c+r)/2;g=d*(d-g)*(d-c)*(d-r);return 0>=g?0:Math.sqrt(g)}const k=new u.ObjectStack(w.create),l=new u.ObjectStack(()=>({p0:null,p1:null,p2:null})),m=t.create(),z=t.create();a.area2d=function(r){return h(r.p0,
r.p1,r.p2)};a.areaPoints2d=h;a.areaPoints3d=function(r,c,d){p.subtract(m,c,r);p.subtract(z,d,r);return p.length(p.cross(m,m,z))/2};a.copy=function(r,c=n()){return b(r.p0,r.p1,r.p2,c)};a.create=n;a.distance2=function(r,c){var d=r.p0,g=r.p1;r=r.p2;const A=p.subtract(e.sv3d.get(),g,d),q=p.subtract(e.sv3d.get(),r,g),y=p.subtract(e.sv3d.get(),d,r),x=p.subtract(e.sv3d.get(),c,d);var D=p.subtract(e.sv3d.get(),c,g),C=p.subtract(e.sv3d.get(),c,r);const B=p.cross(A,A,y),v=p.dot(p.cross(e.sv3d.get(),A,B),x);
D=p.dot(p.cross(e.sv3d.get(),q,B),D);C=p.dot(p.cross(e.sv3d.get(),y,B),C);if(0<v&&0<D&&0<C)return c=p.dot(B,x),c*c/p.dot(B,B);d=w.distance2(w.fromValues(d,A,k.get()),c);g=w.distance2(w.fromValues(g,q,k.get()),c);c=w.distance2(w.fromValues(r,y,k.get()),c);return Math.min(d,g,c)};a.fromValues=b;a.intersectRay=function(r,c,d){const {direction:g,origin:A}=c,{p0:q,p1:y,p2:x}=r;var D=y[0]-q[0],C=y[1]-q[1],B=y[2]-q[2];r=x[0]-q[0];c=x[1]-q[1];const v=x[2]-q[2];var E=g[1]*v-c*g[2],F=g[2]*r-v*g[0];const L=
g[0]*c-r*g[1];var N=D*E+C*F+B*L;if(-1E-5<N&&1E-5>N)return!1;N=1/N;const I=A[0]-q[0],G=A[1]-q[1],K=A[2]-q[2];E=N*(I*E+G*F+K*L);if(0>E||1<E)return!1;F=G*B-C*K;B=K*D-B*I;D=I*C-D*G;C=N*(g[0]*F+g[1]*B+g[2]*D);if(0>C||1<E+C)return!1;d&&(p.scale(d,g,N*(r*F+c*B+v*D)),p.add(d,A,d));return!0};a.wrap=function(r,c,d){const g=l.get();g.p0=r;g.p1=c;g.p2=d;return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger",
"../../core/typedArrayUtil","./checkWebGLError","./enums"],function(a,u,f,p,t){const w=u.getLogger("esri.views.webgl.BufferObject");return function(){function e(b,h,k,l,m){this._context=b;this.bufferType=h;this.usage=k;this._glName=null;this._size=-1;this._indexType=void 0;b.instanceCounter.increment(t.ResourceType.Buffer,this);this._glName=this._context.gl.createBuffer();p.checkWebGLError(this._context.gl);l&&this.setData(l,m)}e.createIndex=function(b,h,k,l){return new e(b,34963,h,k,l)};e.createVertex=
function(b,h,k){return new e(b,34962,h,k)};var n=e.prototype;n.dispose=function(){var b;null!=(b=this._context)&&b.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(t.ResourceType.Buffer,this),this._context=null):this._glName&&w.warn("Leaked WebGL buffer object")};n.setData=function(b,h){if(b){if("number"===typeof b){if(0>b&&w.error("Buffer size cannot be negative!"),34963===this.bufferType&&h)switch(this._indexType=h,this._size=
b,h){case 5123:b*=2;break;case 5125:b*=4}}else h=b.byteLength,f.isUint16Array(b)&&(h/=2,this._indexType=5123),f.isUint32Array(b)&&(h/=4,this._indexType=5125),this._size=h;h=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);var k=this._context.gl;k.bufferData(this.bufferType,b,this.usage);p.checkWebGLError(k);this._context.bindVAO(h)}};n.setSubData=function(b,h=0,k=0,l=b.byteLength){if(b){(0>h||h>=this._size)&&w.error("offset is out of range!");var m=h,z=k,r=l,
c=b.byteLength;f.isUint16Array(b)&&(c/=2,m*=2,z*=2,r*=2);f.isUint32Array(b)&&(c/=4,m*=4,z*=4,r*=4);void 0===l&&(l=c-1);k>=l&&w.error("end must be bigger than start!");h+k-l>this._size&&w.error("An attempt to write beyond the end of the buffer!");h=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);k=this._context.gl;l=ArrayBuffer.isView(b)?b.buffer:b;b=0===z&&r===b.byteLength?l:l.slice(z,r);k.bufferSubData(this.bufferType,m,b);p.checkWebGLError(k);this._context.bindVAO(h)}};
a._createClass(e,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]);return e}()})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/Logger","./RenderingContext"],function(a,u,f,p){function t(e,n){switch(n){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const w=f.getLogger("esri/views/webgl");a.checkWebGLError=function(e){if(p.webglDebugEnabled()){const n=e.getError();n&&(e=t(e,n),w.error(new u("webgl-error","WebGL error occured",{message:e,stack:Error().stack})))}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,u,f){function p(e){return e[0].stride}function t(e){switch(e){case 6406:case 6409:case 36168:return 1;
case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function w(e){if(f.isNone(e))return 0;if("descriptor"in e)return e.glName?w(e.descriptor):
0;const n=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!n)return 0;const b="hasMipmap"in e&&e.hasMipmap?1.3:1;e=e.width*e.height;return t(n)*e*b}a.bindVertexBufferLayout=function(e,n,b,h,k){const l=e.gl,m=e.capabilities.instancing;e.bindBuffer(b);for(const z of h)if(e=n.get(z.name),void 0===e&&console.error(`There is no location for vertex attribute '${z.name}' defined.`),z.baseInstance&&!z.divisor&&console.error(`Vertex attribute '${z.name}' uses baseInstanceOffset without divisor.`),b=
(k?k:0+z.baseInstance?z.baseInstance:0)*z.stride,4>=z.count)l.vertexAttribPointer(e,z.count,z.type,z.normalized,z.stride,z.offset+b),l.enableVertexAttribArray(e),0<z.divisor&&m&&m.vertexAttribDivisor(e,z.divisor);else if(9===z.count)for(h=0;3>h;h++)l.vertexAttribPointer(e+h,3,z.type,z.normalized,z.stride,z.offset+12*h+b),l.enableVertexAttribArray(e+h),0<z.divisor&&m&&m.vertexAttribDivisor(e+h,z.divisor);else if(16===z.count)for(h=0;4>h;h++)l.vertexAttribPointer(e+h,4,z.type,z.normalized,z.stride,
z.offset+16*h+b),l.enableVertexAttribArray(e+h),0<z.divisor&&m&&m.vertexAttribDivisor(e+h,z.divisor);else console.error("Unsupported vertex attribute element count: "+z.count)};a.getBytesPerElementFormat=t;a.getGpuMemoryUsage=w;a.getStride=p;a.unbindVertexBufferLayout=function(e,n,b,h){const k=e.gl,l=e.capabilities.instancing;e.bindBuffer(b);for(const m of h)if(b=n.get(m.name),4>=m.count)k.disableVertexAttribArray(b),m.divisor&&0<m.divisor&&l&&l.vertexAttribDivisor(b,0);else if(9===m.count)for(h=
0;3>h;h++)k.disableVertexAttribArray(b+h),m.divisor&&0<m.divisor&&l&&l.vertexAttribDivisor(b+h,0);else if(16===m.count)for(h=0;4>h;h++)k.disableVertexAttribArray(b+h),m.divisor&&0<m.divisor&&l&&l.vertexAttribDivisor(b+h,0);else console.error("Unsupported vertex attribute element count: "+m.count);e.unbindBuffer(34962)};a.vertexCount=function(e,n){return e.vertexBuffers[n].size/p(e.layout[n])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/VertexArrayObject":function(){define(["../../chunks/_rollupPluginBabelHelpers",
"../../core/Logger","../../core/maybe","./enums","./Util"],function(a,u,f,p,t){const w=u.getLogger("esri.views.webgl.VertexArrayObject");return function(){function e(b,h,k,l,m=null){this._context=b;this._locations=h;this._layout=k;this._buffers=l;this._indexBuffer=m;this._glName=null;this._initialized=!1;b.instanceCounter.increment(p.ResourceType.VAO,this)}var n=e.prototype;n.dispose=function(b=!0){if(this._context){if(this._glName){var h,k;const l=null==(h=this._context)?void 0:null==(k=h.capabilities)?
void 0:k.vao;l?(l.deleteVertexArray(this._glName),this._glName=null):w.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(b){for(const l in this._buffers)this._buffers[l].dispose(),delete this._buffers[l];this._indexBuffer=f.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(p.ResourceType.VAO,this);this._context=null}else(this._glName||b&&0<Object.getOwnPropertyNames(this._buffers).length)&&w.warn("Leaked WebGL VAO")};n.initialize=function(){if(!this._initialized){var b=
this._context.capabilities.vao;if(b){const h=b.createVertexArray();b.bindVertexArray(h);this._bindLayout();b.bindVertexArray(null);this._glName=h}this._initialized=!0}};n.bind=function(){this.initialize();const b=this._context.capabilities.vao;b?b.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};n._bindLayout=function(){const {_buffers:b,_layout:h,_indexBuffer:k}=this;b||w.error("Vertex buffer dictionary is empty!");const l=this._context.gl;for(const m in b){const z=
b[m];z||w.error("Vertex buffer is uninitialized!");const r=h[m];r||w.error("Vertex element descriptor is empty!");t.bindVertexBufferLayout(this._context,this._locations,z,r)}f.isSome(k)&&(this._context.capabilities.vao?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,k.glName):this._context.bindBuffer(k))};n.unbind=function(){this.initialize();const b=this._context.capabilities.vao;b?b.bindVertexArray(null):this._unbindLayout()};n._unbindLayout=function(){const {_buffers:b,_layout:h}=this;b||w.error("Vertex buffer dictionary is empty!");
for(const k in b){const l=b[k];l||w.error("Vertex buffer is uninitialized!");t.unbindVertexBufferLayout(this._context,this._locations,l,h[k])}f.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};a._createClass(e,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((b,h)=>b+this._buffers[h].size,
f.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return e}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("exports ../../../core/Handles ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A){let q=function(){function E(L){this._view=L;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:e.create(),cameraPosition:b.create(),projectionInverse:t.create(),viewInverse:t.create(),heightParameters:k.create(),atmosphereParameters1:k.create(),atmosphereParameters2:k.create(),atmosphereParameters3:b.create(),invWavelength:D,invWavelengthScaled:C,radii:e.create(),scale:0,scaleDepth:.25,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,
oneOverScaleDepth:0,scaleDepthBlue:.05,oneOverScaleDepthBlue:20,scaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,miePhaseCoefficients:B,nearFar:e.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._lowerBoundEarthRadius=l.earth.radius;this._updateRadius(l.earth.radius)}var F=E.prototype;F.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};F.when=
function(){return Promise.resolve()};F.initializeRenderContext=function(L){const N=L.renderContext.rctx;this._handles=new u;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(f.on(this._view,"basemapTerrain","elevation-change",G=>this._updateElevation(G),()=>this._updateElevation()));this._handles.add(f.on(this._view,"basemapTerrain",
"elevation-bounds-change",()=>this._updateVisibleElevationBounds(),()=>this._updateVisibleElevationBounds()));const I=new z.RealisticAtmosphereTechniqueConfiguration;I.haze=!1;this._atmosphereTechnique=L.shaderTechniqueRep.acquire(z.RealisticAtmosphereTechnique,I);I.haze=!0;this._atmosphereHazeTechnique=L.shaderTechniqueRep.acquire(z.RealisticAtmosphereTechnique,I);this._vao=this._createVertexArrayObject(N)};F.uninitializeRenderContext=function(){this.destroy()};F.render=function(L){if(L.slot!==this._hazeSlot&&
L.slot!==this._skyslot||0!==L.pass)return!1;this._update(L.camera);L.slot===this._skyslot&&this._renderSky(L);L.slot===this._hazeSlot&&this._renderHaze(L);return!0};F._renderSky=function(L){const N=L.rctx,I=this._atmosphereTechnique.program;N.useProgram(I);this._atmosphereTechnique.bindPipelineState(N);I.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(I,L)};F._renderHaze=function(L){const N=L.rctx,I=L.offscreenRenderingHelper,G=this._atmosphereHazeTechnique.program;
N.useProgram(G);this._atmosphereHazeTechnique.bindPipelineState(N);I.renderDepthDetached(()=>{G.bindTexture(I.depthTexture,"depthTex");this._renderCommon(G,L)})};F._renderCommon=function(L,N){const I=N.rctx;L.setUniform3fv("invWavelength",this._renderData.invWavelength);L.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);N.scenelightingData.setLightDirectionUniform(L);L.setUniform4fv("heightParameters",this._renderData.heightParameters);L.setUniform3fv("cameraPosition",this._renderData.cameraPosition);
L.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse);L.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);L.setUniform2fv("nearFar",this._renderData.nearFar);L.setUniform2fv("radii",this._renderData.radii);L.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);L.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);L.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);L.setUniform1f("altitudeFade",
this._renderData.altitudeFade);I.bindVAO(this._vao);L.assertCompatibleVertexAttributeLocations(this._vao);I.drawArrays(5,0,4)};F._createVertexArrayObject=function(L){const N=v.createBuffer(4);N.position.setVec(0,[-1,-1]);N.position.setVec(1,[1,-1]);N.position.setVec(2,[-1,1]);N.position.setVec(3,[1,1]);N.uv0.setVec(0,[0,0]);N.uv0.setVec(1,[1,0]);N.uv0.setVec(2,[0,1]);N.uv0.setVec(3,[1,1]);return new A(L,d.Default3D,{geometry:r.glLayout(v)},{geometry:g.createVertex(L,35044,N.buffer)})};F._adjustRadiusForTesselation=
function(L){return L*Math.cos(Math.PI/16/16)};F._updateElevation=function(L){L=L?L.tile:this._view.basemapTerrain.rootTiles[0];0===L.lij[0]&&(L=this._adjustRadiusForTesselation(l.earth.radius+L.elevationBounds[0]),L!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=L,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};F._updateVisibleElevationBounds=function(){const L=this._adjustRadiusForTesselation(l.earth.radius+this._view.basemapTerrain.elevationBounds.min);
(0>this._lowerBoundEarthRadius||L<this._lowerBoundEarthRadius)&&this._updateRadius(L)};F._updateRadius=function(L){this._lowerBoundEarthRadius=L;var N=L/10*10.25;const I=1/(N-L),G=I/.25,K=I/.05,H=.3*(N-L)+L,J=this._renderData;h.set(J.atmosphereParameters1,I,.25,G,4);h.set(J.atmosphereParameters2,-.99999,.05,K,20);n.set(J.atmosphereParameters3,-.99999*-.99999,B,H);w.set(J.radii,L,N);J.scale=I;J.lowerAlphaBlendBound=H;J.scaleOverScaleDepth=G;J.scaleOverScaleDepthBlue=K;N=m.INNER_ATMOSPHERE_DEPTH;J.innerFadeDistance=
2*Math.sqrt((2*L-N)*N)};F._update=function(L){L&&(this._renderData.cameraHeight=n.length(L.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=k.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,
this._renderData.C,this._renderData.CSur),n.copy(this._renderData.cameraPosition,L.eye),p.invert(this._renderData.projectionInverse,L.projectionMatrix),p.invert(this._renderData.viewInverse,L.viewMatrix),w.set(this._renderData.nearFar,L.near,L.far),this._renderData.altitudeFade=m.computeInnerAltitudeFade(this._renderData.cameraHeight-this._lowerBoundEarthRadius))};E.isSupported=function(L){return L.renderContext.rctx.capabilities.depthTexture};return E}();const y=.02*Math.PI,x=.004*Math.PI,D=b.fromValues(1/
.65**4,1/.57**4,1/.475**4),C=b.clone(D);n.scale(C,C,y);n.add(C,C,b.fromValues(x,x,x));const B=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5,v=c.newLayout().vec2f("position").vec2f("uv0");a.RealisticAtmosphere=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports"],function(a){a.INNER_ATMOSPHERE_DEPTH=1E4;a.computeInnerAltitudeFade=function(u){return Math.min(1,Math.max(0,(u-1E5)/9E5))};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k){e=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build({haze:this.configuration.haze});return new h.Program(r.rctx,c,b.Default3D)};z.initializePipeline=function(){return this.configuration.haze?k.makePipelineState({blending:k.separateBlendingParams(1,0,769,1),colorWrite:k.defaultColorWriteParams}):k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),depthTest:{func:515},
colorWrite:k.defaultColorWriteParams})};return m}(e.ShaderTechnique);e.shader=new w.ReloadableShaderModule(t.RealisticAtmosphereShader,()=>new Promise(function(l,m){a(["./RealisticAtmosphere.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.haze=!1;return z}f._inheritsLoose(m,l);return m}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter()],t.prototype,"haze",void 0);u.RealisticAtmosphereTechnique=e;u.RealisticAtmosphereTechniqueConfiguration=t;Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/chunks/RealisticAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f,p){function t(e){const n=new p.ShaderBuilder;n.attributes.add("position","vec2");n.attributes.add("uv0","vec2");n.varyings.add("worldRay","vec3");n.varyings.add("vtc","vec2");e.haze&&n.varyings.add("eyeDir",
"vec3");n.vertex.uniforms.add("projectionInverse","mat4");n.vertex.uniforms.add("viewInverse","mat4");n.vertex.code.add(f.glsl`
    void main(void) {
      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;

      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
      vtc = uv0;

      ${e.haze?f.glsl`eyeDir = posViewNear;`:""}

      gl_Position = vec4(position, 1, 1);
    }
  `);n.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");e.haze?n.fragment.uniforms.add("depthTex","sampler2D"):n.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");n.fragment.include(u.ColorConversion);
n.fragment.code.add(f.glsl`const float krESun = 0.075;
const float kmESun = 0.015;
#define innerRadius radii[0]
#define outerRadius radii[1]
#define shellScale atmosphereParameters1.x
#define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)
#define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)
#define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)`);e.haze||n.fragment.code.add(f.glsl`#define g atmosphereParameters2.x
#define gSq atmosphereParameters3.x
#define miePhaseCoefficients atmosphereParameters3.y
#define lowerAlphaBlendBound atmosphereParameters3.z`);n.fragment.code.add(f.glsl`
  // The camera's current height
  #define cameraHeight heightParameters[0]
  // cameraHeight^2
  #define cameraHeightSq heightParameters[1]
  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2
  #define C heightParameters[2]
  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2
  #define CSur heightParameters[3]

  ${e.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "}
    // Loop constants for integral approximation
    const float samples = 5.0;
    const int maxSamples = 5;

    // ToneMapping operators
    vec3 expTM(vec3 inputColor,float _exposure) {
        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);
    }

    // Approximation for inner integral based on a radii ratio of 10.25:10
    float scale(float _cos) {
      float x = 1.0 - _cos;
      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));
    }

    void main() {
      // Obtain ray from Camera
      vec3 worldSpaceRay = normalize(worldRay);

      // Compute Atmosphere intersection; i.e. ray/sphere intersection
      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))
      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C

      // idealized sphere intersection to discard early some pixels
      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C

      // the minimal sample start position:
      // at the camera by default, on the earth radius surface if the camera is underground.
      float minRayStart = 0.0;
  `);e.haze||n.fragment.code.add(f.glsl`float surfaceBlend = 0.0;
vec4 surfaceColor = vec4(0.0);
if (detSur >= 0.0) {
float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));
float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));
if (nearSurface == 0.0) {
minRayStart = farSurface;
}
vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;
float lightAngle = dot(lightingMainDirection, normalize(vPos));
float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));
surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);
float relDist = (farSurface - nearSurface) / innerFadeDistance;
if (relDist > 1.0) {
gl_FragColor = surfaceColor;
return;
}
surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);
}`);n.fragment.code.add(f.glsl`
    if (det >= 0.0) {
    ${e.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
""}
    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere
    ${e.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere"}

    float scatterDistance; // calculate its scattering offset
    // Calculate the ray's starting position
    if (rayStart < minRayStart)
    { // ray starts from camera or inner radius sphere to far
      rayStart = minRayStart;
      ${e.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);"}
    }
    ${e.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"}
    // Initialize the scattering loop variables
    vec3 start = cameraPosition + worldSpaceRay * rayStart;
  `);e.haze&&n.fragment.code.add(f.glsl`vec3 end = cameraPosition + worldSpaceRay * rayEnd;
float endLength = length(end);
vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);
if (altitudeInterval.x < 0.0) {
altitudeInterval = -altitudeInterval;
}
float lightAngle = dot(lightingMainDirection, end) / endLength;
if (near > far)
{
if (altitudeInterval.x < altitudeInterval.y)
{
end = cameraPosition + worldSpaceRay * rayStart;
start = cameraPosition + worldSpaceRay * rayEnd;
worldSpaceRay *= -1.0;
float tmp = altitudeInterval.x;
altitudeInterval.x = altitudeInterval.y;
altitudeInterval.y = tmp;
}
else if (altitudeInterval.x == altitudeInterval.y)
{
altitudeInterval.x += 1.0;
}
}
if (altitudeInterval.x > outerRadius - innerRadius)
{
scatterDistance = innerRadius - outerRadius;
} else
{
scatterDistance = altitudeInterval.y - altitudeInterval.x;
}`);n.fragment.code.add(f.glsl`vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);
float rayLength = rayEnd - rayStart;
float sampleLength = rayLength / samples;
float scaledLength = sampleLength * shellScale;
vec3 sampleRay = worldSpaceRay * sampleLength;
vec3 samplePoint = start + sampleRay * 0.5;`);e.haze?n.fragment.code.add(f.glsl`float cameraAngle = dot(-worldSpaceRay, end) / length(end);
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;
float scaledValues = scale(lightAngle) + scaleCameraAngle;
vec2 scaledValuesDepth = scaledValues * shellDepth;`):n.fragment.code.add(f.glsl`float cameraAngle = dot(worldSpaceRay, start / length(start));
float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;
float scaleCameraAngle = scale(cameraAngle);
vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;`);n.fragment.code.add(f.glsl`vec3 frontColor = vec3(0.0);
vec3 frontColorBlue = vec3(0.0);
vec3 attenuate = vec3(0.0);
vec3 attenuateBlue = vec3(0.0);
for(int i=0; i<maxSamples; i++) {
float height = length(samplePoint);
float altitude = abs(height - innerRadius);
vec2 depth = exp(-altitude * scaleOverScaleDepth);`);e.haze?n.fragment.code.add(f.glsl`vec2 scatter = depth * scaledValuesDepth - cameraOffset;`):n.fragment.code.add(f.glsl`float lightAngle = dot(lightingMainDirection, samplePoint) / height;
float cameraAngle = dot(worldSpaceRay, samplePoint) / height;
float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);
vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;`);n.fragment.code.add(f.glsl`attenuate = exp(-scatter.x * invWavelengthScaled);
attenuateBlue = exp(-scatter.y * invWavelengthScaled);
frontColor += attenuate * depth.x;
frontColorBlue += attenuateBlue * depth.y;
samplePoint += sampleRay;
}
float LdotR = clamp(dot(lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);
float LdotRSq = LdotR * LdotR + 1.0;`);e.haze?n.fragment.code.add(f.glsl`vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );
vec3 color = colorCoefficients * frontColor;
vec3 colorBlue = colorCoefficients * frontColorBlue;`):n.fragment.code.add(f.glsl`vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;
float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);
vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;
vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;`);n.fragment.code.add(f.glsl`vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);
vec3 ldrRed = expTM(color, exposure);
vec3 LDR = mix(ldrBlue, ldrRed, 0.2);`);e.haze?n.fragment.code.add(f.glsl`LDR *= (1.0 - cameraAngle);
vec3 hsv = rgb2hsv(LDR);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
LDR = hsv2rgb(hsv);
vec3 finalColor = LDR;`):n.fragment.code.add(f.glsl`vec3 ldrReinhard = reinhardTM(color, exposure);
LDR += angleMultiplier * ldrReinhard;
float side = (rayEnd + rayStart) * 0.5;
float atmoHeight = sqrt(cameraHeightSq - side * side);
float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);
vec3 finalColor = LDR * h2;
vec3 hsv = rgb2hsv(finalColor);
hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0);
finalColor = hsv2rgb(hsv);`);n.fragment.code.add(f.glsl`
    ${e.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"}
      } else { // Outside Atmosphere
        gl_FragColor = vec4(0.0);
      }
    }
  `);return n}var w=Object.freeze({__proto__:null,build:t});a.RealisticAtmosphereShader=w;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.ColorConversion=function(f){f.code.add(u.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F){function L(O,Q,S,V,Y){const W=h.length(O),ba=V*Math.sqrt(W*W-V*V)/W,ca=Y.silCircleV1,da=Y.silCircleV2;h.scale(Y.silCircleCenter,O,Math.sqrt(V*V-ba*ba)/W);h.cross(ca,O,Q);1>h.squaredLength(ca)&&h.cross(ca,O,S);h.scale(ca,ca,ba/h.length(ca));h.cross(da,ca,O);h.scale(da,da,ba/h.length(da));return ba}const N=u.getLogger("esri.views.3d.environment.SimpleAtmosphere"),I=-r.INNER_ATMOSPHERE_DEPTH,G=A.makePiecewiseLinearFunction([[50,.1015625],
[500,.21875],[5E3,.51171875],[5E4,.4140625]]);u=function(){function O(S){this.view=S;this.slot=14;this._renderData={texV:b.create(),silCircleCenter:k.create(),silCircleV1:k.create(),silCircleV2:k.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=p.createResolver();this._readyController=p.createAbortController();this.texV1=1;this.isOnMars=m.isMars(S.spatialReference);S=l.getReferenceEllipsoid(S.spatialReference);this.planetRadius=S.radius;this.outerRimWidth=
S.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+I)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var Q=O.prototype;Q.when=function(){return this._readyResolver.promise};Q.initializeRenderContext=function(S){const V=S.renderContext.rctx;this._cameraChangeHandle=t.init(this.view,"state.camera",()=>S.requestRender(),
!0);const Y=new c.SimpleAtmosphereTechniqueConfiguration;Y.geometry=0;this._atmosphereConeTechnique=S.shaderTechniqueRep.acquire(c.SimpleAtmosphereTechnique,Y);Y.geometry=2;this._atmosphereUndergroundTechnique=S.shaderTechniqueRep.acquire(c.SimpleAtmosphereTechnique,Y);this._vao=this._createRibbon(V);this._vaoCount=E.vertexCount(this._vao,"geometry");this._fadeVao=D.createQuadVAO(V);this._fadeVaoCount=E.vertexCount(this._fadeVao,"geometry");z.requestImage(this.isOnMars?d:g,{signal:this._readyController.signal}).then(W=>
{this._texture=new v(V,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},W);S.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(W=>{p.isAbortError(W)||N.error("Unable to initialize simple atmosphere: image request failed",W);this._readyResolver.reject()})};Q.uninitializeRenderContext=function(){this.destroy()};Q.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=
null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};Q.render=function(S){if(S.slot!==this.slot||0!==S.pass)return!1;this._update(S.camera);const V=S.rctx;this._atmosphereConeTechnique.bindPipelineState(V);if(1>this._renderData.undergroundFadeAlpha){var Y=this._atmosphereConeTechnique.program;V.useProgram(Y);
Y.setUniformMatrix4fv("proj",S.camera.projectionMatrix);Y.setUniformMatrix4fv("view",S.camera.viewMatrix);Y.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);Y.setUniform3fv("silCircleV1",this._renderData.silCircleV1);Y.setUniform3fv("silCircleV2",this._renderData.silCircleV2);Y.setUniform2fv("texV",this._renderData.texV);Y.bindTexture(this._texture,"tex");S.scenelightingData.setLightDirectionUniform(Y);Y.setUniform1f("altitudeFade",this._renderData.altitudeFade);Y.setUniform1f("innerScale",
this._renderData.innerScale);V.bindVAO(this._vao);V.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(Y=this._atmosphereUndergroundTechnique.program,V.useProgram(Y),Y.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),S.scenelightingData.setLightDirectionUniform(Y),Y.setUniform3fv("cameraPosition",S.camera.eye),V.bindVAO(this._fadeVao),V.drawArrays(5,0,this._fadeVaoCount));return!0};Q._update=function(S){var V=k.create();const Y=this.planetRadius;var W=
h.length(S.eye);const ba=W-Y;this._renderData.undergroundFadeAlpha=0>ba?Math.min(-ba/5E3,1):0;var ca=Y+I,da=Y+Math.max(50,ba);this._renderData.innerScale=da*da/(Math.sqrt(da*da-Y*Y)*Math.sqrt(da*da-ca*ca)+Y*ca)-1;this._renderData.altitudeFade=r.computeInnerAltitudeFade(ba);h.scale(V,S.eye,(Y+50)/W);L(V,S.center,S.up,Y,this._renderData);V=this._computeScreenRimWidth(S,V,S.up,this._renderData);W=G(ba);ca=this.texV0+.001953125*this.texVScale;da=this.texV0+V*W*this.texVScale;50<ba&&(L(S.eye,S.center,
S.up,Y,this._renderData),S=this._computeScreenRimWidth(S,S.eye,S.up,this._renderData),S=f.clamp((S-1.5)/(V-1.5),0,1),ca=this.texV0+.001953125*S*this.texVScale,da=this.texV0+f.lerp(this.texV1,V*W,S)*this.texVScale);n.set(this._renderData.texV,ca,da)};Q._createRibbon=function(S){const V=new Float32Array(1155),Y=new Uint32Array(1920);V[0]=0;V[1]=0;V[2]=-1;for(var W=0;128>W;W++){var ba=9*W+3;V[ba+0]=W;V[ba+1]=this.innerRimFactor;V[ba+2]=-1;V[ba+3]=W;V[ba+4]=this.middleRimFactor;V[ba+5]=0;V[ba+6]=W;V[ba+
7]=this.outerRimFactor;V[ba+8]=1;ba=3*W+1;var ca=127===W?1:ba+3,da=15*W;Y[da+0]=ba;Y[da+1]=ba+1;Y[da+2]=ca+1;Y[da+3]=ca+1;Y[da+4]=ca;Y[da+5]=ba;Y[da+6]=ba+1;Y[da+7]=ba+2;Y[da+8]=ca+2;Y[da+9]=ca+2;Y[da+10]=ca+1;Y[da+11]=ba+1;Y[da+12]=ba;Y[da+13]=ca;Y[da+14]=0}W=M.createBuffer(Y.length);ba=W.position;for(ca=0;ca<Y.length;++ca)da=3*Y[ca],ba.set(ca,0,V[da]),ba.set(ca,1,V[da+1]),ba.set(ca,2,V[da+2]);return new F(S,x.Default3D,{geometry:q.glLayout(M)},{geometry:B.createVertex(S,35044,W.buffer)})};Q._computeScreenRimWidth=
function(S,V,Y,W){h.add(H,W.silCircleCenter,W.silCircleV2);h.scale(J,H,this.outerRimFactor);w.lookAt(K,V,H,Y);C.project(H,K,S.projectionMatrix,S.viewport);C.project(J,K,S.projectionMatrix,S.viewport);return h.distance(H,J)/S.height};a._createClass(O,[{key:"canRender",get:function(){return null!=this._texture}}]);return O}();const K=e.create(),H=k.create(),J=k.create(),M=y.newLayout().vec3f("position");return u})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(a,u,f,p,t,w){a.createColorTexture=function(e,n,b=4){const h=new Uint8Array(b*b*4);for(let k=0;k<h.length;k+=4)h[k+0]=255*n[0],h[k+1]=255*n[1],h[k+2]=255*n[2],h[k+3]=255*n[3];return new t(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:b,height:b},
h)};a.createEmptyDepthTexture=function(e){return new t(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(e,n=4){return new t(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:n,height:n})};a.createQuadVAO=function(e,n=f.Pos2,b=u.Default3D,h=-1,k=1){let l=null;switch(n){case f.Pos2Tex:l=new Float32Array([h,h,0,0,k,h,1,0,h,k,0,1,k,k,1,1]);break;default:l=new Float32Array([h,h,k,h,h,
k,k,k])}return new w(e,b,{geometry:n},{geometry:p.createVertex(e,35044,l)})};a.createScreenSizeTriangleVAO=function(e,n=f.Pos2,b=u.Default3D){const h=new Float32Array([-1,-1,3,-1,-1,3]);return new w(e,b,{geometry:n},{geometry:p.createVertex(e,35044,h)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports"],function(a){a.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];a.Pos2Tex=[{name:"position",
count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];a.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];a.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];a.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",
count:2,type:5126,offset:24,stride:32,normalized:!1}];a.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){const C=e.getLogger("esri.views.3d.environment.Stars");a.Stars=function(N){function I(K){K=N.call(this,K)||this;K.slot=14;K._loadDataTask=null;K._numPoints=0;K._modelMatrix=c.create();K._updatingTracking=new y.WatchUpdatingTracking;K._requestRender=()=>{};return K}u._inheritsLoose(I,N);var G=I.prototype;G.initialize=function(){this._loadDataTask=this._createLoadDataTask()};G.destroy=function(){this._loadDataTask=n.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=n.disposeMaybe(this._technique);this._vao=n.disposeMaybe(this._vao);this._requestRender=null};G.initializeRenderContext=function(K){this._requestRender=K.requestRender};G.uninitializeRenderContext=function(){this.destroy()};G.render=function(K){if(K.slot!==this.slot||0!==K.pass)return!1;this._ensureResources(K);if(n.isNone(this._technique)||n.isNone(this._vao))return!0;const H=K.rctx,J=this._technique.program;H.useProgram(J);this._technique.bindPass({camera:K.camera,
modelMatrix:this._modelMatrix});this._technique.bindPipelineState(H);H.bindVAO(this._vao);J.assertCompatibleVertexAttributeLocations(this._vao);H.drawArrays(0,0,this._numPoints);return!0};G._ensureResources=function(K){if(!n.isSome(this._technique)&&!n.isNone(L)){this._technique=new d.StarsTechnique({rctx:K.rctx,viewingMode:this.view.state.viewingMode},null);this._numPoints=L.byteLength/9;var H=new Float32Array(L,0,2*this._numPoints),J=new Uint8Array(L,8*this._numPoints,this._numPoints);this._vao=
this._createVertexArrayObject(K.rctx,H,J,this._numPoints);this._updatingTracking.add(this.view,"environment.lighting.date",M=>this._update(M),2)}};G._computeDayDuration=function(K){const H=new Date(K.getFullYear(),0,1,11,58,56),J=new Date(K.getFullYear()+1,0,1,11,58,55);return(+K-+H)/(+J-+H)};G._update=function(K){if(K){var H=K.getHours()/12,J=K.getMinutes()/60*(2/24),M=K.getSeconds()/60*(2/1440);H=(H+J+M-.9972222)%2;K=2*this._computeDayDuration(K);J=this._modelMatrix;r.copy(J,E);r.rotateZ(J,J,-K*
Math.PI);r.multiply(J,v,J);r.rotateZ(J,J,-H*Math.PI);this._requestRender()}};G._hexToRGB=function(K){return[parseInt(K.substring(0,2),16),parseInt(K.substring(2,4),16),parseInt(K.substring(4,6),16)]};G._unpackUint8Attributes=function(K){return 192<=K?[2.9,K-192]:160<=K?[2.5,K-160]:128<=K?[2,K-128]:96<=K?[1.5,K-96]:64<=K?[1,K-64]:32<=K?[.7,K-32]:[.4,K]};G._createVertexArrayObject=function(K,H,J,M){const O=F.createBuffer(M),Q=O.position,S=O.color,V=O.size;for(let ba=0;ba<M;ba++){var Y=H[2*ba],W=H[2*
ba+1];Q.set(ba,0,-Math.cos(Y)*Math.sin(W));Q.set(ba,1,-Math.sin(Y)*Math.sin(W));Q.set(ba,2,-Math.cos(W));Y=this._unpackUint8Attributes(J[ba]);W=this._hexToRGB(B[Y[1]]);S.set(ba,0,255*W[0]);S.set(ba,1,255*W[1]);S.set(ba,2,255*W[2]);S.set(ba,3,255);V.set(ba,Y[0])}return new D(K,q.Default3D,{geometry:g.glLayout(F)},{geometry:x.createVertex(K,35044,O.buffer)})};G._createLoadDataTask=function(){var K=this;if(n.isSome(L))return null;const H=b.createTask(function(){var J=u._asyncToGenerator(function*(M){({data:M}=
yield p.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:M}));K._verifyStarData(M);L=M});return function(M){return J.apply(this,arguments)}}());H.promise.catch(J=>{b.isAbortError(J)||C.error(J)}).then(()=>{this.destroyed||(this._requestRender(),this.notifyChange("updating"))});return H};G._verifyStarData=function(K){if(!K)throw new w("stars:no-data-received","Failed to create stars because star catalogue is missing");K=K.byteLength/9;if(0!==K%1||5E4<K||
5E3>K)throw new w("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};u._createClass(I,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return n.isSome(this._loadDataTask)&&!this._loadDataTask.finished}},{key:"canRender",get:function(){return!this.loading}}]);return I}(t);f.__decorate([h.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);f.__decorate([h.property({readOnly:!0})],a.Stars.prototype,
"updating",null);f.__decorate([h.property()],a.Stars.prototype,"_loadDataTask",void 0);f.__decorate([h.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=f.__decorate([z.subclass("esri.views.3d.environment.Stars")],a.Stars);const B="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),v=c.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,
-.39778850739794974,.9174771405229186,0,0,0,0,1),E=c.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),F=A.newLayout().vec3f("position").vec4u8("color").f32("size");let L=null;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){n=function(m){function z(){return m.apply(this,arguments)||this}f._inheritsLoose(z,m);var r=z.prototype;r.initializeProgram=function(c){const d=z.shader.get().build();return new h.Program(c.rctx,d,b.Default3D)};r.initializePipeline=function(){return k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:k.defaultColorWriteParams})};r.bindPass=function({camera:c,modelMatrix:d}){const g=this.makeInfiniteProjectionMatrix(c.projectionMatrix,
c.near,l);p.multiply(g,g,c.viewMatrix);p.multiply(g,g,d);this.program.setUniformMatrix4fv("transform",g);this.program.setUniform4fv("viewport",c.fullViewport);this.program.setUniform1f("pixelRatio",c.pixelRatio)};r.makeInfiniteProjectionMatrix=function(c,d,g){p.copy(g,c);g[10]=2.4E-7-1;g[11]=-1;g[14]=(2.4E-7-2)*d;return g};return z}(n.ShaderTechnique);n.shader=new e.ReloadableShaderModule(w.StarsShader,()=>new Promise(function(m,z){a(["./Stars.glsl"],m,z)}));const l=t.create();u.StarsTechnique=n;
Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f,p){function t(){const e=new p.ShaderBuilder;e.attributes.add("position","vec3");e.attributes.add("color","vec4");e.attributes.add("size","float");e.varyings.add("vcolor","vec4");e.varyings.add("vsize",
"float");e.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");e.include(u.AlignPixel);e.vertex.code.add(f.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);e.fragment.code.add(f.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return e}var w=Object.freeze({__proto__:null,build:t});a.StarsShader=w;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.AlignPixel=function(f){const p=u.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,t=u.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;f.vertex.code.add(p);f.vertex.code.add(t);f.fragment.code.add(p);f.fragment.code.add(t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],function(a,u,f,p){function t(n,b,h){return w(n,b.longitude,b.latitude,h.longitude,h.latitude)}function w(n,b,h,k,l){h=u.deg2rad(h);l=u.deg2rad(l);b=u.deg2rad(b);const m=u.deg2rad(k);k=Math.sin((h-l)/2);
b=Math.sin((b-m)/2);h=2*u.asinClamped(Math.sqrt(k*k+Math.cos(h)*Math.cos(l)*b*b));return Math.round(h*n*1E4)/1E4}function e(n,b){n/=15;b||(n=Math.round(n));return n}a.getGreatCircleDistance=w;a.getGreatCircleDistanceFromPoints=t;a.getGreatCircleSpanAt=function(n,b,h){const k=b.spatialReference,l=p.getReferenceEllipsoid(k),m=new f(b.x,n.y,k),z=new f(h.x,n.y,k);b=new f(n.x,b.y,k);n=new f(n.x,h.y,k);return{lon:t(l.radius,m,z),lat:t(l.radius,b,n)}};a.getLatDeltaForDistance=function(n,b){return u.rad2deg(n/
b)};a.getLonDeltaForDistance=function(n,b,h){b/=h;n=u.deg2rad(n);b=Math.sin(b/2);n=Math.cos(n);n=2*u.asinClamped(Math.sqrt(b*b/(n*n)));return u.rad2deg(n)};a.getMaxCameraAltitude=function(n,b){n=u.deg2rad(n/2);return(1-Math.sin(n))*b/Math.sin(n)};a.longitudeToTimezone=e;a.pointToTimezone=function(n,b){return e(n.longitude,b)};a.positionToTimezoneInfo=function(n,b){b||(b={hours:0,minutes:0,seconds:0});b.hours=e(n[0],!0);n=b.hours%1;b.hours-=n;b.minutes=60*n;n=b.minutes%1;b.minutes-=n;b.seconds=Math.round(60*
n);return b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/SunCalc".split(" "),function(a,u,f,p,t,w,e){function n(r,c,d,g){g||(g=w.create());const A=l,q=f.identity(k);if("global"===d)e.SunCalc.getPosition(r,0,0,A),t.set(g,0,0,-1),f.rotateX(q,q,-A.azimuth),f.rotateY(q,q,-A.altitude);else{var y=h.planarDirection;
d=y.globalAngles;y=(Math.abs(c[2])-y.localAltitude)/(y.globalAltitude-y.localAltitude);y=u.clamp(y,0,1);1>y?(e.SunCalc.getPosition(r,c[1],c[0],A),A.azimuth=(1-y)*A.azimuth+y*d.azimuth,A.altitude=(1-y)*A.altitude+y*d.altitude):(A.azimuth=d.azimuth,A.altitude=d.altitude);t.set(g,0,-1,0);f.rotateZ(q,q,-A.azimuth);f.rotateX(q,q,-A.altitude)}t.transformMat4(g,g,q);return g}function b(r,c,d,g){const A=[];for(let q=0;q<d.length;q++)A[q]=(g[q]-d[q])*r/c+d[q];return A}const h={local:{altitude:1500,ambientAtNight:.1,
ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},k=p.create(),l={azimuth:0,altitude:0},m={ambient:{color:w.create(),intensity:0},diffuse:{color:w.create(),intensity:0,directionToLightSource:w.create()},globalFactor:0,noonFactor:0},z=new Date(0);a.computeColorAndIntensity=function(r,c){var d=c[2];t.set(m.ambient.color,
1,1,1);m.ambient.intensity=h.global.ambient;t.set(m.diffuse.color,1,1,1);m.diffuse.intensity=h.global.diffuse;d=(Math.abs(d)-h.local.altitude)/(h.global.altitude-h.local.altitude);d=u.clamp(d,0,1);m.globalFactor=d;c=e.SunCalc.getTimes(r,c[1],c[0]);if(1>d){{var g=r.valueOf();if(c.polarException===e.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var A=g-36E5*(r.getHours()+48)-6E4*r.getMinutes();var q=A+432E6}else c.polarException===e.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(A=g-2,q=g-1):(A=c.sunrise.valueOf(),q=
c.sunset.valueOf());var y=q-A;var x=A+y/2;var D=y/4;var C=x-D;D=x+D;var B=.06*y;y=A-B/2;A+=B/2;const v=q-B/2,E=q+B/2;q=h.local;const F=[.01,q.ambientAtNight],L=[.8,.8,1],N=[.01,.01,.01],I=[q.diffuseAtTwilight,q.ambientAtTwilight],G=[1,.75,.75],K=[.8,.8,1],H=[.9*q.diffuseAtNoon,q.ambientAtNoon],J=[1,.98,.98],M=[.98,.98,1],O=[q.diffuseAtNoon,q.ambientAtNoon],Q=[1,1,1],S=[1,1,1];q=[0,0];let V=[0,0,0];B=[0,0,0];g<y||g>E?(q=F,V=N,B=L):g<A?(B=A-y,q=b(g-y,B,F,I),V=b(g-y,B,N,G),B=b(g-y,B,L,K)):g<C?(B=C-A,
q=b(g-A,B,I,H),V=b(g-A,B,G,J),B=b(g-A,B,K,M)):g<x?(B=x-C,q=b(g-C,B,H,O),V=b(g-C,B,J,Q),B=b(g-C,B,M,S)):g<D?(B=D-x,q=b(g-x,B,O,H),V=b(g-x,B,Q,J),B=b(g-x,B,S,M)):g<v?(B=v-D,q=b(g-D,B,H,I),V=b(g-D,B,J,G),B=b(g-D,B,M,K)):g<E&&(B=E-v,q=b(g-v,B,I,F),V=b(g-v,B,G,N),B=b(g-v,B,K,L));g=q[0];x=w.fromValues(V[0],V[1],V[2]);C=q[1];D=w.fromValues(B[0],B[1],B[2])}t.lerp(m.ambient.color,D,m.ambient.color,d);m.ambient.intensity=u.lerp(C,m.ambient.intensity,d);t.lerp(m.diffuse.color,x,m.diffuse.color,d);m.diffuse.intensity=
u.lerp(g,m.diffuse.intensity,d)}d=r.valueOf();c.polarException===e.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(r=d-36E5*(r.getHours()+48)-6E4*r.getMinutes(),c=r+432E6):c.polarException===e.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(r=d-2,c=d-1):(r=c.sunrise.valueOf(),c=c.sunset.valueOf());r=1-u.clamp(Math.abs(d-(r+(c-r)/2))/432E5,0,1);m.noonFactor=r;return m};a.computeDirection=n;a.computeDirectionsOverTime=function(r,c,d,g,A){const q=A.length;if(1>q)return A;r=r.getTime();c=(c.getTime()-r)/q;for(let y=0;y<q;++y)z.setTime(r+
c*y),n(z,d,g,A[y]);return A};a.computeShadowsEnabled=function(r,c){return"global"===c?!0:Math.abs(r[2])<h.planarDirection.localAltitude};a.settings=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var u={exports:{}};(function(f){(function(p){p=p();void 0!==p&&(f.exports=p)})(function(){function p(B){return new Date(864E5*(B+.5-2440588))}function t(B,v){return g(z(B)*r(x)-c(v)*z(x),r(B))}function w(B,v){return d(z(v)*r(x)+r(v)*z(x)*
z(B))}function e(B,v,E){return g(z(B),r(B)*z(v)-c(E)*r(v))}function n(B,v,E){return d(z(v)*z(E)+r(v)*r(E)*r(B))}function b(B){return q*(1.9148*z(B)+.02*z(2*B)+3E-4*z(3*B))}function h(B,v){B=q*(357.5291+.98560028*B);var E=b(B);B=B+E+102.9372*q+m;v||(v={dec:0,ra:0});v.dec=w(B,0);v.ra=t(B,0);return v}function k(B,v,E){return 2451545+B+.0053*z(v)-.0069*z(2*E)}function l(B){var v=q*(134.963+13.064993*B),E=q*(93.272+13.22935*B);B=q*(218.316+13.176396*B)+6.289*q*z(v);E=5.128*q*z(E);v=385001-20905*r(v);return{ra:t(B,
E),dec:w(B,E),dist:v}}var m=Math.PI,z=Math.sin,r=Math.cos,c=Math.tan,d=Math.asin,g=Math.atan2,A=Math.acos,q=m/180,y={dec:0,ra:0},x=23.4397*q,D={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(B,v,E,F){E=q*-E;v*=q;var L=B.valueOf()/864E5-.5+2440588-2451545;B=h(L,y);E=q*(280.16+360.9856235*L)-E-B.ra;F||(F={azimuth:0,altitude:0});F.azimuth=e(E,v,B.dec);F.altitude=n(E,v,B.dec);return F}},C=[[-.83,"sunrise","sunset"]];D.addTime=function(B,v,E){C.push([B,v,E])};D.getTimes=function(B,
v,E){function F(S){var V=N,Y=H;S=A((z(S)-z(V)*z(Y))/(r(V)*r(Y)));return k(9E-4+(S+L)/(2*m)+I,G,K)}var L=q*-E,N=q*v,I=Math.round(B.valueOf()/864E5-.5+2440588-2451545-9E-4-L/(2*m));B=9E-4+(0+L)/(2*m)+I;var G=q*(357.5291+.98560028*B);v=b(G);var K=G+v+102.9372*q+m,H=w(K,0);B=k(B,G,K);v={solarNoon:p(B),nadir:p(B-.5),polarException:D.POLAR_EXCEPTION.NORMAL};var J;E=0;for(J=C.length;E<J;E+=1){var M=C[E];var O=F(M[0]*q);var Q=B-(O-B);v[M[1]]=p(Q);v[M[2]]=p(O)}v.polarException=function(S){S=(z(S)-z(N)*z(H))/
(r(N)*r(H));return-1>S?D.POLAR_EXCEPTION.MIDNIGHT_SUN:1<S?D.POLAR_EXCEPTION.POLAR_NIGHT:D.POLAR_EXCEPTION.NORMAL}(C[0][0]*q);return v};D.getMoonPosition=function(B,v,E){E=q*-E;v*=q;var F=B.valueOf()/864E5-.5+2440588-2451545;B=l(F);E=q*(280.16+360.9856235*F)-E-B.ra;F=n(E,v,B.dec);F+=.017*q/c(F+10.26*q/(F+5.1*q));return{azimuth:e(E,v,B.dec),altitude:F,distance:B.dist}};D.getMoonFraction=function(B){var v=B.valueOf()/864E5-.5+2440588-2451545;B=h(v);v=l(v);B=A(z(B.dec)*z(v.dec)+r(B.dec)*r(v.dec)*r(B.ra-
v.ra));B=g(149598E3*z(B),v.dist-149598E3*r(B));return(1+r(B))/2};return D})})(u);a.SunCalc=u.exports})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,u){a.AmbientLight=function(f=u.create()){this.intensity=f};a.FillLight=function(f=u.create(),p=u.fromValues(.57735,.57735,.57735)){this.intensity=f;this.direction=p};a.MainLight=function(f=u.create(),p=u.fromValues(.57735,.57735,.57735),t=!0){this.intensity=f;this.direction=p;
this.castShadows=t};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N){f=function(G){function K(){var J=G.apply(this,arguments)||this;J._handles=new p;return J}a._inheritsLoose(K,G);var H=K.prototype;H.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};H.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};H.connect=
function(){const J=this.view;this._source=new D.BrowserEventSource(this.view.surface,J.input);var M=[new E.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new L.SingleAndDoubleClick,new v.Drag(this.view.navigation),new N.VerticalTwoFingerDrag];this._inputManager=M=new C.InputManager({eventSource:this._source,recognizers:M});M.installHandlers("prevent-context-menu",[new B.PreventContextMenu],C.ViewEventPriorities.INTERNAL);this._modeDragPan=new g.PinchAndPanNavigation(J,"primary");this._modeDragRotate=
new m.DragRotate(J,"secondary",0);this._modeDragZoom=new z.DragZoom(J,"tertiary");M.installHandlers("navigation",[new A.PointerDownCancelAnimation(J),new l.DoubleClickZoom(J),new r.GamepadNavigation(J),new c.KeyboardNavigation(J,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new d.MouseWheelZoom(J),new y.SingleKeyResetTilt(J,"p"),new q.SingleKeyResetHeading(J,"n"),new m.DragRotate(J,
"primary",1,["b"]),new m.DragRotate(J,"secondary",0,["b"]),new g.PinchAndPanNavigation(J,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new x.TwoFingerTilt(J)],C.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(M);this._updateMode();t.init(this.view.navigation,"browserTouchPanEnabled",O=>{this._source.browserTouchPanningEnabled=!O})};H._updateMode=function(){var J=this.primaryDragAction;J=I.get(this.mode).get(J);this._modeDragPan&&(this._modeDragPan.pointerAction=
J.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=J.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=J.zoom)};a._createClass(K,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(J){"pan"!==J&&"rotate"!==J||J===this._get("primaryDragAction")||(this._set("primaryDragAction",J),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(J){"default"!==J&&"pro"!==J||J===this._get("mode")||(this._set("mode",
J),this._updateMode())}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return K}(f);u.__decorate([w.property()],f.prototype,"view",void 0);u.__decorate([w.property({value:"pan"})],f.prototype,"primaryDragAction",null);u.__decorate([w.property({value:"default"})],f.prototype,"mode",null);u.__decorate([w.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],f.prototype,
"hasPendingInputs",void 0);u.__decorate([w.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],f.prototype,"latestPointerType",void 0);u.__decorate([w.property()],f.prototype,"_inputManager",void 0);f=u.__decorate([k.subclass("esri.views.3d.input.SceneInputManager")],f);const I=new Map;u=new Map;w=new Map;u.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});u.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});w.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});
w.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});I.set("default",u);I.set("pro",w);return f})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,u,f,p,t,w,e){w=function(n){function b(h,k){var l=n.call(this,
!0)||this;l.view=h;l.registerIncoming("double-click",k,m=>l.handleDoubleClick(m));return l}u._inheritsLoose(b,n);b.prototype.handleDoubleClick=function(h){const k=h.data;if(e.eventMatchesPointerAction(k,"primary")){const l=this.view.state.isGlobal?new p.ZoomStepController({view:this.view,mode:"animation"}):new t.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(l);l.zoomStep(Math.log(.5)/Math.log(.6),f.createScreenPointArray(k.x,k.y));h.stopPropagation()}};
return b}(w.InputHandler);a.DoubleClickZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){a.ZoomStepController=function(B){function v(){var F=B.apply(this,arguments)||this;F.zoomLocation=l.create();F.tmpCamera=new q;F.tmpViewDir=l.create();F.tmpRayDir={origin:l.create(),direction:l.create()};F.targetOnSphere=l.create();F.tmpCenter=l.create();F.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new q,interactionDirection:null,tiltMode:0};F.sphere=z.create();return F}u._inheritsLoose(v,B);
var E=v.prototype;E.initialize=function(){this.intersector=new y.Intersector(this.view.state.viewingMode)};E.zoomStep=function(F,L){if(this.active){var N=this.view.state,{interactionStartCamera:I}=this.constraintOptions;this.animation.finished?I.copyFrom(N.camera):this.animation.cameraAt(1,I);var G=I=!1;this.intersectionHelper.intersectScreen(L,this.zoomLocation)&&(I=0<F?!0:!1,G=!0);this.tmpCamera.copyFrom(N.camera);I?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,F,this.zoomLocation,L,G);this.begin(this.tmpCamera)}};E.animationSettings=function(){return{apex:null,duration:t.Milliseconds(600),easing:x.outExpo}};E.updateCamera=function(F,L,N,I,G){var K=m.getReferenceEllipsoid(this.view.spatialReference);if(d.decideNavigationMode(F,
I,G,K)===d.NavigationMode.Horizontal||p("disable-feature:context-navigation")){L=.6**L;this.sphere[3]=k.length(N);k.subtract(this.tmpViewDir,F.center,F.eye);G=k.length(this.tmpViewDir);K=G*L;1>=L&&4>K&&(K=4,L=K/G);if(1E-6>Math.abs(G-K))return;G=k.length(F.center);this.sphere[3]!==G&&(F.center=k.scale(C,F.center,(this.sphere[3]+L*(G-this.sphere[3]))/G));k.scale(this.tmpViewDir,this.tmpViewDir,-L);F.eye=k.add(C,F.center,this.tmpViewDir);r.applyAll(this.view,F,this.constraintOptions);1E-12<k.squaredDistance(N,
F.center)&&A.intersectScreen(this.sphere,F,I,this.targetOnSphere)&&d.panToPosition(this.sphere,F,N,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{G=.6**Math.abs(L);K=0<L?1:-1;g.fromScreenAtEye(F,I,this.tmpRayDir);k.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var H;this.view.camera.position.hasZ&&(H=Math.abs(this.view.camera.position.z));H=Math.max(12*H,20);I=this.view._stage.renderView.getMinimalDepthForArea(I[0],I[1],this.view.state.camera,60);H=H>I?
I:H;k.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,H);k.add(N,this.tmpRayDir.origin,this.tmpRayDir.direction);N=H*G;0<L&&4>N&&(N=4,G=N/H);if(1E-6>Math.abs(H-N))return;k.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,K*(1-G));F.eye=k.add(C,F.eye,this.tmpRayDir.direction);F.center=k.add(C,F.center,this.tmpRayDir.direction)}D.applySurfaceCollisionConstraint(this.view,F)};return v}(c.PointToPointAnimationController);a.ZoomStepController=f.__decorate([h.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);const C=l.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,u,f,p,t,w,e,n){const b=[{type:1,error:function(k,l,m){return e.getTiltConstraintError(k,l,m)*l.distance},apply:e.applyTiltConstraint},{type:2,
error:f.getAltitudeConstraintError,apply:f.applyAltitudeConstraint},{type:4,error:t.getDistanceConstraintError,apply:t.applyDistanceConstraint}],h={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.applyAltitudeConstraint=f.applyAltitudeConstraint;a.getAltitudeConstraintError=f.getAltitudeConstraintError;a.applyDistanceConstraint=t.applyDistanceConstraint;a.getDistanceConstraintError=t.getDistanceConstraintError;a.applySurfaceCollisionConstraint=
w.applySurfaceCollisionConstraint;a.applyTiltConstraint=e.applyTiltConstraint;a.getTiltConstraintError=e.getTiltConstraintError;a.applyAll=function(k,l,m=h,z=l){let r=!1;z!==l&&z.copyFrom(l);z.computeUp(k.state.viewingMode);for(l=0;5>l;l++){let d=0;for(var c of b)if(p.hasConstraintType(m.selection,c.type)){const g=Math.abs(c.error(k,z,m));c.apply(k,z,m)&&(r=!0,d+=g)}if(0===d)break}c=p.hasConstraintType(m.selection,8);a:switch(m.interactionType){case 4:m=1;break a;case 5:m=k.state.isGlobal?2:1;break a;
default:m=0}c&&w.applySurfaceCollisionConstraint(k,z,m)&&(r=!0);r&&z.computeUp(k.state.viewingMode);return r};a.pixelDistanceToInteractionFactor=function(k,l){k="number"===typeof k?k:u.distance(k,l);return n.inOutCubic(Math.min(1,k/150))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,u,f,p,t,w,e,n){function b(c,d,g=e.defaultApplyOptions){var A=c.state.constraints.altitude;A=c.state.isGlobal&&A?2===g.interactionType&&e.hasConstraintType(g.selection,1)?!1:!0:!1;if(!A)return 0;var q=c.state.constraints.altitude;A=k;A.min=q.min;A.max=q.max;q=g.interactionType;if(0!==q){var {min:y,max:x}=A,{interactionStartCamera:D,interactionFactor:C}=g;g=2===q||1===q;q=b(c,D);var B=0===q?0:c.renderCoordsHelper.getAltitude(D.eye);A.min=y;A.max=x;e.adjustRangeForInteraction(q,B,g,C,.05*
B,A)}c=c.renderCoordsHelper.getAltitude(d.eye);c=u.clamp(c,A.min,A.max)-c;return 1E-6>=Math.abs(c)?0:c}function h(c,d,g,A){c.renderCoordsHelper.worldUpAtPosition(d.eye,A);p.scale(A,A,g);return A}const k={min:0,max:0},l=t.create(),m=t.create(),z=t.create(),r=t.create();a.applyAltitudeConstraint=function(c,d,g=e.defaultApplyOptions){const A=b(c,d,g);if(0===A)return!1;const q=c.renderCoordsHelper,y=q.getAltitude(d.eye)+A;g=e.interactionDirectionTowardsConstraintMinimization(d,g.interactionDirection,
h(c,d,u.sign(A),m),l);c=p.copy(z,d.viewForward);g=q.intersectInfiniteManifold(w.wrap(d.eye,g),y,r);d.eye=f.isSome(g)?g:q.setAltitude(r,y,d.eye);d.center=n.closestPointOnRay(r,d.eye,c,d.center);return!0};a.getAltitudeConstraintError=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],function(a,u,f){a.adjustRangeForInteraction=function(p,t,w,e,n,b){0!==p&&(w?(b.min=Math.min(b.min,
t),b.max=Math.max(b.max,t)):null!=e?(b.min-=Math.max(0,(t-b.min)*(1-e)),b.max+=Math.max(0,(t-b.max)*(1-e))):n&&(b.min-=Math.max(0,t-b.min-n),b.max+=Math.max(0,t-b.max-n)))};a.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.hasConstraintType=function(p,t){return 0!==(p&t)};a.interactionDirectionTowardsConstraintMinimization=function(p,t,w,e){t=t||p.viewForward;f.copy(e,t);f.scale(e,e,u.sign(f.dot(t,w)));return e};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,u,f,p,t){function w(b,h,k,l){const m=n;b?(k&&l&&(m.len=f.distance(h,k)),f.copy(m.dir,b)):l?(m.len=f.distance(h,k),f.subtract(m.dir,k,h),f.scale(m.dir,m.dir,1/m.len)):(f.subtract(m.dir,k,h),f.normalize(m.dir,m.dir));return m}function e(b,h,k,l){l.clip[0]=0;l.clip[1]=
k?l.len:Number.MAX_VALUE;for(k=0;k<b.length;k++){{var m=b[k],z=h;var r=l;const c=f.dot(t.normal(m),r.dir);m=-t.signedDistance(m,z);0>m&&0<=c?r=!1:-1E-6<c&&1E-6>c?r=0<m:!(0>m||0>c)||0>m&&0>c?(m/=c,0<c?m<r.clip[1]&&(r.clip[1]=m):m>r.clip[0]&&(r.clip[0]=m),r=r.clip[0]<=r.clip[1]):r=!0}if(!r)return!1}return!0}const n={dir:p.create(),len:0,clip:u.create()};a.closestPointOnRay=function(b,h,k,l){l=f.dot(k,f.subtract(b,l,h));return f.add(b,h,f.scale(b,k,l))};a.frustumLineSegment=function(b,h,k,l){l=w(l,h,
k,!0);return e(b,h,k,l)};a.frustumPoint=function(b,h){for(let k=0;6>k;k++)if(0<t.signedDistance(b[k],h))return!1;return!0};a.frustumRay=function(b,h,k,l){k=w(l,h,k,!1);return e(b,h,null,k)};a.frustumSphere=function(b,h,k){const l=h[0],m=h[1];h=h[2];return b[0][0]*l+b[0][1]*m+b[0][2]*h+b[0][3]>k||b[1][0]*l+b[1][1]*m+b[1][2]*h+b[1][3]>k||b[2][0]*l+b[2][1]*m+b[2][2]*h+b[2][3]>k||b[3][0]*l+b[3][1]*m+b[3][2]*h+b[3][3]>k||b[4][0]*l+b[4][1]*m+b[4][2]*h+b[4][3]>k||b[5][0]*l+b[5][1]*m+b[5][2]*h+b[5][3]>k?
!1:!0};a.planeSphere=function(b,h,k){return b[0]*h[0]+b[1]*h[1]+b[2]*h[2]+b[3]<k};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),function(a,u,f,p,t,w,e){function n(r,c,d=e.defaultApplyOptions){if(!r.state.isLocal)return 0;var g=r.state.constraints.distance;if(!r.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===g)return 0;b.min=0;b.max=g;g=b;var A=d.interactionType;if(0!==A){var {min:q,max:y}=g,{interactionStartCamera:x,interactionFactor:D}=d;d=1===A||4===A;A=n(r,x);var C=0===A?0:f.distance(x.eye,r.pointsOfInterest.surfaceOrigin.renderLocation);g.min=q;g.max=y;e.adjustRangeForInteraction(A,C,d,D,.05*C,g)}r=f.distance(c.eye,r.pointsOfInterest.surfaceOrigin.renderLocation);r=b.max-r;return-1E-6<=r?0:r}const b={min:0,max:0},h=p.create(),k=p.create(),l=p.create(),m=p.create(),z=p.create();a.applyDistanceConstraint=
function(r,c,d=e.defaultApplyOptions){var g=n(r,c,d);if(0===g)return!1;var A=r.pointsOfInterest.surfaceOrigin;g=f.distance(c.eye,r.pointsOfInterest.surfaceOrigin.renderLocation)+g;const q=f.copy(h,c.eye);d=e.interactionDirectionTowardsConstraintMinimization(c,d.interactionDirection,f.direction(m,c.eye,r.pointsOfInterest.surfaceOrigin.renderLocation),l);if(!w.intersectRay(w.fromCenterAndRadius(A.renderLocation,g),t.wrap(c.eye,d),z))return!1;c.eye=z;A=f.subtract(k,c.eye,q);c.center=f.add(z,c.center,
A);A=r.renderCoordsHelper.getAltitude(c.center);r=r.renderCoordsHelper.intersectInfiniteManifold(c.ray,A,z);u.isSome(r)&&(c.center=r);return!0};a.getDistanceConstraintError=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,u,f,p){const t=f.create(),w=f.create();a.applySurfaceCollisionConstraint=function(e,n,b=0){var h=e.state.constraints;
if(!h.collision.enabled)return!1;var k=p.surfaceElevationBelowRenderLocation(e,n.eye);const l=e.renderCoordsHelper.getAltitude(n.eye);h=k+h.collision.elevationMargin;if(l>=h)return!1;k=u.length(n.eye);u.subtract(t,n.center,n.eye);n.eye=e.renderCoordsHelper.setAltitude(w,h,n.eye);1===b?n.center=u.add(t,n.eye,t):2===b&&(n.center=u.scale(t,n.center,(k-l+h)/k));return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,u,f,p,t,w,e){function n(r,c){return r.elevationProvider?u.unwrapOr(r.elevationProvider.getElevation(c[0],c[1],c[2],r.renderCoordsHelper.spatialReference,"ground"),0):0}function b(r,c,d){if(!r.state.isGlobal)return!1;const g=n(r,c);({far:r}=r.stateManager.constraintsManager.nearFarHeuristic.compute(c,d,r.dataExtent,g,z));r*=r;return f.squaredDistance(c,d)>r}const h={},k=p.create(),l=p.create(),m=p.create(),z={near:0,far:0};a.cameraOnContentAlongViewDirection=function(r,c,d,g){const A=r.state.camera.clone();
c&&(A.eye=c,A.center=d,A.up=g);c=A.ray;d=h[r.viewingMode];d||(d=new e.Intersector(r.state.viewingMode),d.options.backfacesTerrain=!r.state.isGlobal,d.options.invisibleTerrain=!0,h[r.viewingMode]=d);({isGlobal:g}=r.state);r.sceneIntersectionHelper.intersectRay(c,d,l)&&!b(r,c.origin,l)?c=!0:!r.renderCoordsHelper.intersectManifold(c,0,l)||b(r,c.origin,l)?g?(d=t.getReferenceEllipsoid(r.spatialReference).radius,d=f.dot(c.origin,c.origin)-d*d,f.scale(l,c.direction,(0<d?Math.sqrt(d)/3:1)/f.length(c.direction)),
f.add(l,l,c.origin),c=!0):c=!1:c=!0;c||f.copy(l,A.center);d=r.state.constraints;g=d.minimumPoiDistance;f.squaredDistance(A.eye,l)<g&&(c=d.collision.enabled,f.copy(m,A.viewForward),f.scale(m,m,g),c?A.eye=f.subtract(k,l,m):f.add(l,A.eye,m),r=r.renderCoordsHelper,g=r.getAltitude(A.eye),d=d.collision.elevationMargin,c&&g<d&&(f.subtract(m,l,A.eye),A.eye=r.setAltitude(k,d,A.eye),f.add(l,A.eye,m)));A.center=l;return A};a.eyeWithinExtent=function(r,c,d,g){return u.isSome(r.renderCoordsHelper.fromRenderCoords(c.eye,
k,g))&&w.containsPoint(d,k)};a.surfaceElevationBelowRenderLocation=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k,l){f=function(){function m(r){this.options=new b.IntersectorOptions;this.results=new h.IntersectorResults;this.transform=new k.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:e.create(),direction:e.create()};this._rayEndPoint=e.create();this._rayStartPointTransformed=e.create();this._rayEndPointTransformed=e.create();this.viewingMode=null==r?1:r}var z=m.prototype;z.reset=function(r,c){this.resetWithRay(n.fromPoints(r,
c,this._ray))};z.resetWithRay=function(r){r!==this._ray&&n.copy(r,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;w.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};z.intersect=function(r=null,c,d,g,A,q){this.point=c;this.camera=d;this.filterPredicate=A;this.tolerance=null==g?1E-5:g;c=k.getVerticalOffsetObject3D(this.verticalOffset);
if(p.isSome(r)&&0<r.length){const y=q?x=>{q(x)&&this.intersectObject(x)}:x=>{this.intersectObject(x)};for(const x of r)r=x.getSpatialQueryAccelerator&&x.getSpatialQueryAccelerator(),p.isSome(r)?(p.isSome(c)?r.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,y,c):r.forEachAlongRay(this._ray.origin,this._ray.direction,y),this.options.selectionMode&&this.options.hud&&r.forEachDegenerateObject(y)):x.objects.forAll(D=>y(D))}this.sortResults()};z.intersectObject=function(r){this._numObjectsTested++;
const c=r.geometryRecords;if(c){var d=r.id,g=r.transformation,A=k.getVerticalOffsetObject3D(this.verticalOffset);for(const y of c){const {geometry:x,material:D,instanceParameters:C}=y;if(l.isInstanceHidden(C))continue;var q=x.id;this.transform.setAndInvalidateLazyTransforms(g,y.getShaderTransformation());w.transformMat4(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse);w.transformMat4(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const B=this.transform.transform;
p.isSome(A)&&(A.objectTransform=this.transform);D.intersect(x,C,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(v,E,F,L,N,I)=>{if(0<=v&&(!p.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEndPoint,v))){var G=`Object3D ${d}`;N?(null==this.results.hud.dist||v<this.results.hud.dist)&&this.results.hud.set(r,G,v,E,t.IDENTITY,L,I,q,F):((null==this.results.min.drapedLayerOrder||L>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||
v<this.results.min.dist)&&this.results.min.set(r,G,v,E,B,L,null,q,F),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||L<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||v>this.results.max.dist)&&this.results.max.set(r,G,v,E,B,L,null,q,F),2===this.options.store&&(N=new h.IntersectorResult(this._ray),N.set(r,G,v,E,B,L,null,q,F),this.results.all.push(N)))}},y.shaderTransformation)}}};z.sortResults=function(){this.results.all.sort((r,c)=>r.dist!==c.dist?r.dist-c.dist:
r.drapedLayerOrder!==c.drapedLayerOrder?(void 0!==r.drapedLayerOrder?r.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:Number.MAX_VALUE):(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==r.drapedLayerGraphicOrder?r.drapedLayerGraphicOrder:Number.MIN_VALUE))};u._createClass(m,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}}]);
return m}();f.DEFAULT_TOLERANCE=1E-5;a.Intersector=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../chunks/boundedPlane ../../../../geometry/support/ray ./Object3D".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){let l=function(){function d(){this.min=new m;this.max=new m;this.hud=new m;this.ground=new m}d.prototype.init=function(g){this.min.init(g);this.max.init(g);this.hud.init(g);this.ground.init(g);this.all=[]};return d}(),m=function(){function d(A){this.normal=w.create();this.transformation=p.create();this._ray=h.create();this.init(A)}var g=d.prototype;g.getIntersectionPoint=function(A){if(!this.hasIntersectionPoint)return!1;t.scale(r,this.ray.direction,this.dist);t.add(A,
this.ray.origin,r);return!0};g.getTransformedNormal=function(A){t.copy(c,this.normal);c[3]=0;e.transformMat4(c,c,this.transformation);t.copy(A,c);t.normalize(A,A);return A};g.init=function(A){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";A?h.copy(A,this._ray):this._ray=h.create()};g.set=function(A,q,y,x,D,C,B,v,E,F){A instanceof k.Object3D&&(A={type:"stage",obj:A});this.dist=y;t.copy(this.normal,
x);f.copy(this.transformation,D);this.target=A;this.name=q;this.drapedLayerOrder=C;this.center=B?w.clone(B):null;this.geometryId=v;this.triangleNr=E;this.drapedLayerGraphicOrder=F};g.copyFrom=function(A){h.copy(A.ray,this._ray);this.dist=A.dist;this.target=A.target;this.name=A.name;this.drapedLayerOrder=A.drapedLayerOrder;this.center=A.center?w.clone(A.center):null;this.geometryId=A.geometryId;this.triangleNr=A.triangleNr;this.intersector=A.intersector;this.drapedLayerGraphicOrder=A.drapedLayerGraphicOrder;
t.copy(this.normal,A.normal);f.copy(this.transformation,A.transformation)};u._createClass(d,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return t.scale(r,this.ray.direction,this.dist),t.length(r)}}]);return d}();const z=w.create(),r=w.create(),c=n.create();a.IntersectorResult=m;a.IntersectorResults=l;a.sliceFilterPredicate=function(d){return(g,A,q)=>{t.lerp(z,g,A,q);
return!b.extrusionContainsPoint(d,z)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./ContentObject ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,u,f,p,t,w,e,
n,b,h,k,l,m,z){h=function(d){function g(q={}){var y=d.call(this)||this;y.type=1;y._geometryRecords=[];y._geometries=[];y._objectTransformation=t.create();y._bvObjectSpace=new c;y._bvWorldSpace=new c;y._bvDirty=!0;y._hasVolatileTransformation=!1;y._visible=!0;y.castShadow=null!=q.castShadow?q.castShadow:!0;y.metadata=q.metadata;y.metadata&&y.metadata.isElevationSource&&(y.metadata.lastValidElevationBB=new r);y.transformation=t.create();const {geometries:x,materials:D,transformations:C,origins:B}=q;
if(!Array.isArray(x))return u._assertThisInitialized(y);m.assert(D.length===x.length,"Object3D: materials don't match geometries");m.assert(C.length===x.length,"Object3D: transformations don't match geometries");y._geometryRecords.length=x.length;y._geometries.length=x.length;for(q=0;q<x.length;q++)y._geometries[q]=x[q],y._geometryRecords[q]=k.GeometryRecord.pool.acquire(x[q],D[q],t.clone(C[q]),{highlights:null,occludees:null,visible:!0},B&&B[q]);return y}u._inheritsLoose(g,d);var A=g.prototype;A.dispose=
function(){this._geometryRecords.length=0;this._geometries.length=0};A.getNumGeometryRecords=function(){return this._geometryRecords.length};A.getGeometryRecord=function(q){m.assert(0<=q&&q<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[q]};A.addGeometry=function(q,y,x,D,C,B){x=x?x:t.IDENTITY;this._geometries.push(q);q=k.GeometryRecord.pool.acquire(q,y,x,D||{highlights:null,occludees:null,visible:!0},C,B);this._geometryRecords.push(q);
this._hasVolatileTransformation=this._hasVolatileTransformation||f.isSome(q.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:q});this._invalidateBoundingVolume();return q};A.removeGeometry=function(q){const y=this._geometryRecords.splice(q,1)[0];this._hasVolatileTransformation=f.isSome(y.shaderTransformation)?this._geometryRecords.some(x=>f.isSome(x.shaderTransformation)):this._hasVolatileTransformation;y.dispose();this._geometries.splice(q,1);this._emit("objectGeometryRemoved",
{object:this,record:y});this._invalidateBoundingVolume();return y};A.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};A.geometryVertexAttrsUpdated=function(q){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[q]});this._invalidateBoundingVolume()};A.setVisible=function(q){this._visible=q;for(const y of this._geometryRecords)y.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)};A.maskOccludee=function(){const q=
new l.Object3DStateID(1);for(const y of this._geometryRecords)y.instanceParameters.occludees=z.addObject3DStateID(y.instanceParameters.occludees,q);this._emit("occlusionChanged",this);return q};A.removeOcclude=function(q){for(const y of this._geometryRecords)y.instanceParameters.occludees=z.removeObject3DStateID(y.instanceParameters.occludees,q);this._emit("occlusionChanged",this)};A.highlight=function(){const q=new l.Object3DStateID(0);for(const y of this._geometryRecords)y.instanceParameters.highlights=
z.addObject3DStateID(y.instanceParameters.highlights,q);this._emit("highlightChanged",this);return q};A.removeHighlight=function(q){for(const y of this._geometryRecords)y.instanceParameters.highlights=z.removeObject3DStateID(y.instanceParameters.highlights,q);this._emit("highlightChanged",this)};A.getCombinedStaticTransformation=function(q,y){return p.multiply(f.unwrapOr(y,t.create()),this.transformation,q.getStaticTransformation())};A.getCombinedShaderTransformation=function(q,y){y=y||t.create();
p.multiply(y,this.transformation,q.getShaderTransformation());return y};A.hasVolativeTransformation=function(){return this._hasVolatileTransformation};A._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var q=0;q<this._geometryRecords.length;++q){var y=this._geometryRecords[q],x=this._geometries[q].boundingInfo;f.isSome(x)&&(this._calculateTransformedBoundingVolume(x,this._bvObjectSpace,y.getShaderTransformation()),
this._calculateTransformedBoundingVolume(x,this._bvWorldSpace,this.getCombinedShaderTransformation(y)))}w.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);w.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);q=e.create();y=e.create();x=b.maxScale(this.transformation);for(let v=0;v<this._geometryRecords.length;++v){var D=this._geometries[v].boundingInfo;if(!f.isNone(D)){var C=this._geometryRecords[v].getShaderTransformation(),B=b.maxScale(C);
w.transformMat4(q,D.getCenter(),C);C=w.distance(q,this._bvObjectSpace.bounds);D=D.getBSRadius()*B;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],C+D);w.transformMat4(y,q,this.transformation);B=w.distance(y,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],B+D*x)}}this._bvDirty=!1}};A._calculateTransformedBoundingVolume=function(q,y,x){const D=q.getBBMin();q=q.getBBMax();const C=e.clone(D),B=e.clone(q);w.transformMat4(C,C,x);w.transformMat4(B,
B,x);for(var v=0;3>v;++v)y.min[v]=Math.min(y.min[v],C[v],B[v]),y.max[v]=Math.max(y.max[v],C[v],B[v]);for(v=0;3>v;++v){w.copy(C,D);w.copy(B,q);C[v]=q[v];B[v]=D[v];w.transformMat4(C,C,x);w.transformMat4(B,B,x);for(let E=0;3>E;++E)y.min[E]=Math.min(y.min[E],C[E],B[E]),y.max[E]=Math.max(y.max[E],C[E],B[E])}};A._invalidateBoundingVolume=function(){this._bvDirty=!0;f.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};A._emit=function(q,y){f.isSome(this._parentLayer)&&
this._parentLayer.events.emit(q,y)};u._createClass(g,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(q){p.copy(this._objectTransformation,q);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(q){m.assert(null==this._parentLayer||null==q,"Object3D can only be added to a single Layer");
this._parentLayer=q}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const q=this;return{hasGeometry:y=>-1<q._geometries.indexOf(y),getGeometryIndex:y=>q._geometries.indexOf(y)}}}]);return g}(h.ContentObject);let r=function(){function d(){this.min=e.fromValues(Number.MAX_VALUE,
Number.MAX_VALUE,Number.MAX_VALUE);this.max=e.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}d.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return d}(),c=function(d){function g(){var A=d.apply(this,arguments)||this;A.bounds=n.create();return A}u._inheritsLoose(g,d);g.prototype.init=function(){w.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);w.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
n.clear(this.bounds)};return g}(r);a.Object3D=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),function(a,u,f,p,t,w){let e=function(){function n(){this._disposed=!1}var b=n.prototype;b.acquire=function(h,k,l,m,z,r){this.id=t.generateUID();this.geometry=h;this.material=
k;this.transformation=l;this.instanceParameters=m;this.origin=z;this._shaderTransformation=r;this._disposed=!1};b.release=function(){this._disposed=!1};b.dispose=function(){this._disposed=!0};b.getStaticTransformation=function(){return this.transformation};b.getShaderTransformation=function(){return f.isSome(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation};b.computeAttachmentOrigin=function(h){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,
h):this.geometry.computeAttachmentOrigin(h))?(w.transformMat4(h,h,this.getStaticTransformation()),!0):!1};u._createClass(n,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return n}();e.pool=new p(e);a.GeometryRecord=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,u){a.Object3DStateID=function(f){this.channel=
f;this.id=u.generateUID()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/doublePrecisionUtils ../../lib/Util".split(" "),function(a,u,f,p,t,w){const e=new Float64Array(3),n=new Float32Array(6),b=p.create();a.acquireMaterials=function(h,k){const l=new Map;l.set(0,k.acquire(h,0));l.set(1,k.acquire(h,7));l.set(4,k.acquire(h,
3));l.set(3,k.acquire(h,2));l.set(2,k.acquire(h,1));l.set(5,k.acquire(h,4));l.set(7,k.acquire(h,3));l.set(6,k.acquire(h,3));return l};a.addObject3DStateID=function(h,k){u.isNone(h)&&(h=[]);h.push(k);return h};a.calculateTransformRelativeToOrigin=function(h,k,l){const m=h.origin.vec3;w.setMatrixTranslation3(b,-m[0],-m[1],-m[2]);u.isSome(h.transformation)?f.multiply(k,b,h.transformation):f.copy(k,b);l&&(f.invert(l,k),f.transpose(l,l))};a.encodeDoubleVec3=function(h,k,l,m,z){e[0]=h.get(k,0);e[1]=h.get(k,
1);e[2]=h.get(k,2);t.encodeDoubleArray(e,n,3);l.set(z,0,n[0]);m.set(z,0,n[1]);l.set(z,1,n[2]);m.set(z,1,n[3]);l.set(z,2,n[4]);m.set(z,2,n[5])};a.isInstanceHidden=function(h){return u.isSome(h)?!h.visible:!1};a.releaseMaterials=function(h,k){k.release(h,0);k.release(h,7);k.release(h,3);k.release(h,2);k.release(h,1);k.release(h,4)};a.removeObject3DStateID=function(h,k){if(u.isNone(h))return h;h=h.filter(l=>l!==k);return 0===h.length?null:h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["exports"],
function(a){function u(t,w,e){for(let n=0;n<e;++n)w[2*n]=t[n],w[2*n+1]=t[n]-w[2*n]}const f=new Float64Array(1),p=new Float32Array(2);a.decodeDoubleArray=function(t,w,e){for(let n=0;n<e;++n)w[n]=t[2*n]+t[2*n+1]};a.encodeDouble=function(t,w){p[0]=t;p[1]=t-p[0];w[0]=p[0];w[1]=p[1]};a.encodeDoubleArray=u;a.encodeDoubleArraySplit=function(t,w,e,n){for(let b=0;b<n;++b)f[0]=t[b],u(f,p,1),w[b]=p[0],e[b]=p[1]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../chunks/sphere".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){let r=function(){function C(){this._transform=e.create();this._transformInverse=new c({value:this._transform},w.invert,e.create);this._transformInverseTranspose=new c(this._transformInverse,w.transpose,e.create);this._transformTranspose=new c({value:this._transform},w.transpose,e.create);this._transformInverseRotation=new c({value:this._transform},p.normalFromMat4Legacy,t.create)}var B=C.prototype;B.invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};B.setTransformMatrix=function(v){w.copy(this._transform,v)};B.multiplyTransform=function(v){w.multiply(this._transform,this._transform,v)};B.set=function(v){w.copy(this._transform,v);this.invalidateLazyTransforms()};B.setAndInvalidateLazyTransforms=function(v,E){this.setTransformMatrix(v);this.multiplyTransform(E);this.invalidateLazyTransforms()};u._createClass(C,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return C}(),c=function(){function C(B,v,E){this.original=B;this.update=v;this.dirty=!0;this.transform=E()}C.prototype.invalidate=function(){this.dirty=
!0};u._createClass(C,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return C}(),d=function(){function C(v=0){this.offset=v;this.tmpVertex=l.create()}var B=C.prototype;B.applyToVertex=function(v,E,F){const L=v+this.localOrigin[0],N=E+this.localOrigin[1],I=F+this.localOrigin[2],G=this.offset/Math.sqrt(L*L+N*N+I*I);this.tmpVertex[0]=v+L*G;this.tmpVertex[1]=E+N*G;this.tmpVertex[2]=F+I*G;return this.tmpVertex};B.applyToAabb=
function(v){var E=v[0]+this.localOrigin[0];const F=v[1]+this.localOrigin[1],L=v[2]+this.localOrigin[2],N=v[3]+this.localOrigin[0],I=v[4]+this.localOrigin[1],G=v[5]+this.localOrigin[2],K=this.offset/Math.sqrt(E*E+F*F+L*L);v[0]+=E*K;v[1]+=F*K;v[2]+=L*K;E=this.offset/Math.sqrt(N*N+I*I+G*G);v[3]+=N*E;v[4]+=I*E;v[5]+=G*E;return v};return C}(),g=function(){function C(v=0){this.offset=v;this.componentLocalOriginLength=0;this.tmpVertex=l.create();this.mbs=m.create();this.obb={center:l.create(),halfSize:k.create(),
quaternion:null}}var B=C.prototype;B.applyToVertex=function(v,E,F){const L=F+this.componentLocalOriginLength,N=this.offset/Math.sqrt(v*v+E*E+L*L);this.tmpVertex[0]=v+v*N;this.tmpVertex[1]=E+E*N;this.tmpVertex[2]=F+L*N;return this.tmpVertex};B.applyToAabb=function(v){var E=v[0];const F=v[1],L=v[2]+this.componentLocalOriginLength,N=v[3],I=v[4],G=v[5]+this.componentLocalOriginLength,K=this.offset/Math.sqrt(E*E+F*F+L*L);v[0]+=E*K;v[1]+=F*K;v[2]+=L*K;E=this.offset/Math.sqrt(N*N+I*I+G*G);v[3]+=N*E;v[4]+=
I*E;v[5]+=G*E;return v};B.applyToMbs=function(v){const E=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),F=this.offset/E;this.mbs[0]=v[0]+v[0]*F;this.mbs[1]=v[1]+v[1]*F;this.mbs[2]=v[2]+v[2]*F;this.mbs[3]=v[3]+v[3]*this.offset/E;return this.mbs};B.applyToObb=function(v){var E=v.center;const F=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);this.obb.center[0]=E[0]+E[0]*F;this.obb.center[1]=E[1]+E[1]*F;this.obb.center[2]=E[2]+E[2]*F;h.transformQuat(this.obb.halfSize,v.halfSize,v.quaternion);h.add(this.obb.halfSize,
this.obb.halfSize,v.center);E=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*E;this.obb.halfSize[1]+=this.obb.halfSize[1]*E;this.obb.halfSize[2]+=this.obb.halfSize[2]*E;h.subtract(this.obb.halfSize,this.obb.halfSize,v.center);n.conjugate(D,v.quaternion);h.transformQuat(this.obb.halfSize,this.obb.halfSize,D);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:
1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=v.quaternion;return this.obb};u._createClass(C,[{key:"localOrigin",set:function(v){this.componentLocalOriginLength=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])}}]);return C}(),A=function(){function C(v=0){this.offset=v;this.sphere=z.create();this.tmpVertex=l.create()}var B=C.prototype;B.applyToVertex=function(v,E,F){const L=this.objectTransform.transform;let N=L[0]*v+L[4]*E+L[8]*F+
L[12],I=L[1]*v+L[5]*E+L[9]*F+L[13];v=L[2]*v+L[6]*E+L[10]*F+L[14];E=this.offset/Math.sqrt(N*N+I*I+v*v);N+=N*E;I+=I*E;v+=v*E;E=this.objectTransform.inverse;this.tmpVertex[0]=E[0]*N+E[4]*I+E[8]*v+E[12];this.tmpVertex[1]=E[1]*N+E[5]*I+E[9]*v+E[13];this.tmpVertex[2]=E[2]*N+E[6]*I+E[10]*v+E[14];return this.tmpVertex};B.applyToMinMax=function(v,E){const F=this.offset/Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);v[0]+=v[0]*F;v[1]+=v[1]*F;v[2]+=v[2]*F;v=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=
E[0]*v;E[1]+=E[1]*v;E[2]+=E[2]*v};B.applyToAabb=function(v){var E=this.offset/Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);v[0]+=v[0]*E;v[1]+=v[1]*E;v[2]+=v[2]*E;E=this.offset/Math.sqrt(v[3]*v[3]+v[4]*v[4]+v[5]*v[5]);v[3]+=v[3]*E;v[4]+=v[4]*E;v[5]+=v[5]*E;return v};B.applyToBoundingSphere=function(v){const E=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),F=this.offset/E;this.sphere[0]=v[0]+v[0]*F;this.sphere[1]=v[1]+v[1]*F;this.sphere[2]=v[2]+v[2]*F;this.sphere[3]=v[3]+v[3]*this.offset/E;return this.sphere};
return C}();const q=new A,y=new g,x=new d,D=b.create();a.I3SVerticalOffsetGlobalViewingMode=g;a.IntersectorTransform=r;a.Object3DVerticalOffsetGlobalViewingMode=A;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=d;a.getVerticalOffsetI3S=function(C){return f.isSome(C)?(y.offset=C,y):null};a.getVerticalOffsetObject3D=function(C){return f.isSome(C)?(q.offset=C,q):null};a.getVerticalOffsetTerrain=function(C){return f.isSome(C)?(x.offset=C,x):null};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/chunks/mat3":function(){define(["exports","./common"],function(a,u){function f(H,J){H[0]=J[0];H[1]=J[1];H[2]=J[2];H[3]=J[4];H[4]=J[5];H[5]=J[6];H[6]=J[8];H[7]=J[9];H[8]=J[10];return H}function p(H,J){H[0]=J[0];H[1]=J[1];H[2]=J[2];H[3]=J[3];H[4]=J[4];H[5]=J[5];H[6]=J[6];H[7]=J[7];H[8]=J[8];return H}function t(H,J,M,O,Q,S,V,Y,W,ba){H[0]=J;H[1]=M;H[2]=O;H[3]=Q;H[4]=S;H[5]=V;H[6]=Y;H[7]=W;H[8]=ba;return H}function w(H){H[0]=1;H[1]=0;H[2]=0;H[3]=0;H[4]=1;H[5]=0;H[6]=0;H[7]=0;H[8]=1;return H}function e(H,
J){if(H===J){const M=J[1],O=J[2],Q=J[5];H[1]=J[3];H[2]=J[6];H[3]=M;H[5]=J[7];H[6]=O;H[7]=Q}else H[0]=J[0],H[1]=J[3],H[2]=J[6],H[3]=J[1],H[4]=J[4],H[5]=J[7],H[6]=J[2],H[7]=J[5],H[8]=J[8];return H}function n(H,J){const M=J[0],O=J[1],Q=J[2],S=J[3],V=J[4],Y=J[5],W=J[6],ba=J[7];J=J[8];const ca=J*V-Y*ba,da=-J*S+Y*W,ha=ba*S-V*W;let fa=M*ca+O*da+Q*ha;if(!fa)return null;fa=1/fa;H[0]=ca*fa;H[1]=(-J*O+Q*ba)*fa;H[2]=(Y*O-Q*V)*fa;H[3]=da*fa;H[4]=(J*M-Q*W)*fa;H[5]=(-Y*M+Q*S)*fa;H[6]=ha*fa;H[7]=(-ba*M+O*W)*fa;H[8]=
(V*M-O*S)*fa;return H}function b(H,J){const M=J[0],O=J[1],Q=J[2],S=J[3],V=J[4],Y=J[5],W=J[6],ba=J[7];J=J[8];H[0]=V*J-Y*ba;H[1]=Q*ba-O*J;H[2]=O*Y-Q*V;H[3]=Y*W-S*J;H[4]=M*J-Q*W;H[5]=Q*S-M*Y;H[6]=S*ba-V*W;H[7]=O*W-M*ba;H[8]=M*V-O*S;return H}function h(H){const J=H[3],M=H[4],O=H[5],Q=H[6],S=H[7],V=H[8];return H[0]*(V*M-O*S)+H[1]*(-V*J+O*Q)+H[2]*(S*J-M*Q)}function k(H,J,M){const O=J[0],Q=J[1],S=J[2],V=J[3],Y=J[4],W=J[5],ba=J[6],ca=J[7];J=J[8];const da=M[0],ha=M[1],fa=M[2],R=M[3],U=M[4],Z=M[5],T=M[6],P=
M[7];M=M[8];H[0]=da*O+ha*V+fa*ba;H[1]=da*Q+ha*Y+fa*ca;H[2]=da*S+ha*W+fa*J;H[3]=R*O+U*V+Z*ba;H[4]=R*Q+U*Y+Z*ca;H[5]=R*S+U*W+Z*J;H[6]=T*O+P*V+M*ba;H[7]=T*Q+P*Y+M*ca;H[8]=T*S+P*W+M*J;return H}function l(H,J,M){const O=J[0],Q=J[1],S=J[2],V=J[3],Y=J[4],W=J[5],ba=J[6],ca=J[7];J=J[8];const da=M[0];M=M[1];H[0]=O;H[1]=Q;H[2]=S;H[3]=V;H[4]=Y;H[5]=W;H[6]=da*O+M*V+ba;H[7]=da*Q+M*Y+ca;H[8]=da*S+M*W+J;return H}function m(H,J,M){const O=J[0],Q=J[1],S=J[2],V=J[3],Y=J[4],W=J[5],ba=J[6],ca=J[7];J=J[8];const da=Math.sin(M);
M=Math.cos(M);H[0]=M*O+da*V;H[1]=M*Q+da*Y;H[2]=M*S+da*W;H[3]=M*V-da*O;H[4]=M*Y-da*Q;H[5]=M*W-da*S;H[6]=ba;H[7]=ca;H[8]=J;return H}function z(H,J,M){const O=M[0],Q=M[1];M=M[2];H[0]=O*J[0];H[1]=O*J[1];H[2]=O*J[2];H[3]=Q*J[3];H[4]=Q*J[4];H[5]=Q*J[5];H[6]=M*J[6];H[7]=M*J[7];H[8]=M*J[8];return H}function r(H,J,M){const O=M[0];M=M[1];H[0]=O*J[0];H[1]=O*J[1];H[2]=O*J[2];H[3]=M*J[3];H[4]=M*J[4];H[5]=M*J[5];return H}function c(H,J){H[0]=1;H[1]=0;H[2]=0;H[3]=0;H[4]=1;H[5]=0;H[6]=J[0];H[7]=J[1];H[8]=1;return H}
function d(H,J){const M=Math.sin(J);J=Math.cos(J);H[0]=J;H[1]=M;H[2]=0;H[3]=-M;H[4]=J;H[5]=0;H[6]=0;H[7]=0;H[8]=1;return H}function g(H,J){H[0]=J[0];H[1]=0;H[2]=0;H[3]=0;H[4]=J[1];H[5]=0;H[6]=0;H[7]=0;H[8]=1;return H}function A(H,J){H[0]=J[0];H[1]=J[1];H[2]=0;H[3]=J[2];H[4]=J[3];H[5]=0;H[6]=J[4];H[7]=J[5];H[8]=1;return H}function q(H,J){var M=J[0],O=J[1],Q=J[2];J=J[3];var S=M+M,V=O+O;const Y=Q+Q;M*=S;const W=O*S;O*=V;const ba=Q*S,ca=Q*V;Q*=Y;S*=J;V*=J;J*=Y;H[0]=1-O-Q;H[3]=W-J;H[6]=ba+V;H[1]=W+J;H[4]=
1-M-Q;H[7]=ca-S;H[2]=ba-V;H[5]=ca+S;H[8]=1-M-O;return H}function y(H,J){const M=J[0],O=J[1],Q=J[2],S=J[4],V=J[5],Y=J[6],W=J[8],ba=J[9];J=J[10];const ca=J*V-Y*ba,da=-J*S+Y*W,ha=ba*S-V*W;var fa=M*ca+O*da+Q*ha;if(!fa)return null;fa=1/fa;H[0]=ca*fa;H[1]=(-J*O+Q*ba)*fa;H[2]=(Y*O-Q*V)*fa;H[3]=da*fa;H[4]=(J*M-Q*W)*fa;H[5]=(-Y*M+Q*S)*fa;H[6]=ha*fa;H[7]=(-ba*M+O*W)*fa;H[8]=(V*M-O*S)*fa;return H}function x(H,J){const M=J[0],O=J[1],Q=J[2],S=J[3],V=J[4],Y=J[5],W=J[6],ba=J[7];var ca=J[8],da=J[9],ha=J[10],fa=J[11];
const R=J[12],U=J[13],Z=J[14];J=J[15];const T=M*Y-O*V,P=M*W-Q*V,X=M*ba-S*V,aa=O*W-Q*Y,ja=O*ba-S*Y,ia=Q*ba-S*W,ka=ca*U-da*R,na=ca*Z-ha*R;ca=ca*J-fa*R;const ta=da*Z-ha*U;da=da*J-fa*U;ha=ha*J-fa*Z;fa=T*ha-P*da+X*ta+aa*ca-ja*na+ia*ka;if(!fa)return null;fa=1/fa;H[0]=(Y*ha-W*da+ba*ta)*fa;H[1]=(W*ca-V*ha-ba*na)*fa;H[2]=(V*da-Y*ca+ba*ka)*fa;H[3]=(Q*da-O*ha-S*ta)*fa;H[4]=(M*ha-Q*ca+S*na)*fa;H[5]=(O*ca-M*da-S*ka)*fa;H[6]=(U*ia-Z*ja+J*aa)*fa;H[7]=(Z*X-R*ia-J*P)*fa;H[8]=(R*ja-U*X+J*T)*fa;return H}function D(H,
J,M){H[0]=2/J;H[1]=0;H[2]=0;H[3]=0;H[4]=-2/M;H[5]=0;H[6]=-1;H[7]=1;H[8]=1;return H}function C(H){return"mat3("+H[0]+", "+H[1]+", "+H[2]+", "+H[3]+", "+H[4]+", "+H[5]+", "+H[6]+", "+H[7]+", "+H[8]+")"}function B(H){return Math.sqrt(H[0]**2+H[1]**2+H[2]**2+H[3]**2+H[4]**2+H[5]**2+H[6]**2+H[7]**2+H[8]**2)}function v(H,J,M){H[0]=J[0]+M[0];H[1]=J[1]+M[1];H[2]=J[2]+M[2];H[3]=J[3]+M[3];H[4]=J[4]+M[4];H[5]=J[5]+M[5];H[6]=J[6]+M[6];H[7]=J[7]+M[7];H[8]=J[8]+M[8];return H}function E(H,J,M){H[0]=J[0]-M[0];H[1]=
J[1]-M[1];H[2]=J[2]-M[2];H[3]=J[3]-M[3];H[4]=J[4]-M[4];H[5]=J[5]-M[5];H[6]=J[6]-M[6];H[7]=J[7]-M[7];H[8]=J[8]-M[8];return H}function F(H,J,M){H[0]=J[0]*M;H[1]=J[1]*M;H[2]=J[2]*M;H[3]=J[3]*M;H[4]=J[4]*M;H[5]=J[5]*M;H[6]=J[6]*M;H[7]=J[7]*M;H[8]=J[8]*M;return H}function L(H,J,M,O){H[0]=J[0]+M[0]*O;H[1]=J[1]+M[1]*O;H[2]=J[2]+M[2]*O;H[3]=J[3]+M[3]*O;H[4]=J[4]+M[4]*O;H[5]=J[5]+M[5]*O;H[6]=J[6]+M[6]*O;H[7]=J[7]+M[7]*O;H[8]=J[8]+M[8]*O;return H}function N(H,J){return H[0]===J[0]&&H[1]===J[1]&&H[2]===J[2]&&
H[3]===J[3]&&H[4]===J[4]&&H[5]===J[5]&&H[6]===J[6]&&H[7]===J[7]&&H[8]===J[8]}function I(H,J){const M=H[0],O=H[1],Q=H[2],S=H[3],V=H[4],Y=H[5],W=H[6],ba=H[7];H=H[8];const ca=J[0],da=J[1],ha=J[2],fa=J[3],R=J[4],U=J[5],Z=J[6],T=J[7];J=J[8];return Math.abs(M-ca)<=u.EPSILON*Math.max(1,Math.abs(M),Math.abs(ca))&&Math.abs(O-da)<=u.EPSILON*Math.max(1,Math.abs(O),Math.abs(da))&&Math.abs(Q-ha)<=u.EPSILON*Math.max(1,Math.abs(Q),Math.abs(ha))&&Math.abs(S-fa)<=u.EPSILON*Math.max(1,Math.abs(S),Math.abs(fa))&&Math.abs(V-
R)<=u.EPSILON*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(Y-U)<=u.EPSILON*Math.max(1,Math.abs(Y),Math.abs(U))&&Math.abs(W-Z)<=u.EPSILON*Math.max(1,Math.abs(W),Math.abs(Z))&&Math.abs(ba-T)<=u.EPSILON*Math.max(1,Math.abs(ba),Math.abs(T))&&Math.abs(H-J)<=u.EPSILON*Math.max(1,Math.abs(H),Math.abs(J))}function G(H){const J=u.EPSILON,M=H[0],O=H[1],Q=H[2],S=H[3],V=H[4],Y=H[5],W=H[6],ba=H[7];H=H[8];return Math.abs(1-(M*M+S*S+W*W))<=J&&Math.abs(1-(O*O+V*V+ba*ba))<=J&&Math.abs(1-(Q*Q+Y*Y+H*H))<=J}var K=Object.freeze({__proto__:null,
fromMat4:f,copy:p,set:t,identity:w,transpose:e,invert:n,adjoint:b,determinant:h,multiply:k,translate:l,rotate:m,scale:z,scaleByVec2:r,fromTranslation:c,fromRotation:d,fromScaling:g,fromMat2d:A,fromQuat:q,normalFromMat4Legacy:y,normalFromMat4:x,projection:D,str:C,frob:B,add:v,subtract:E,multiplyScalar:F,multiplyScalarAndAdd:L,exactEquals:N,equals:I,isOrthoNormal:G,mul:k,sub:E});a.add=v;a.adjoint=b;a.copy=p;a.determinant=h;a.equals=I;a.exactEquals=N;a.frob=B;a.fromMat2d=A;a.fromMat4=f;a.fromQuat=q;
a.fromRotation=d;a.fromScaling=g;a.fromTranslation=c;a.identity=w;a.invert=n;a.isOrthoNormal=G;a.mat3=K;a.mul=k;a.multiply=k;a.multiplyScalar=F;a.multiplyScalarAndAdd=L;a.normalFromMat4=x;a.normalFromMat4Legacy=y;a.projection=D;a.rotate=m;a.scale=z;a.scaleByVec2=r;a.set=t;a.str=C;a.sub=E;a.subtract=E;a.translate=l;a.transpose=e})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,u,f,p,t,w,e){function n(W){W[0]=0;W[1]=0;W[2]=
0;W[3]=1;return W}function b(W,ba,ca){ca*=.5;const da=Math.sin(ca);W[0]=da*ba[0];W[1]=da*ba[1];W[2]=da*ba[2];W[3]=Math.cos(ca);return W}function h(W,ba){const ca=2*Math.acos(ba[3]),da=Math.sin(ca/2);da>t.EPSILON?(W[0]=ba[0]/da,W[1]=ba[1]/da,W[2]=ba[2]/da):(W[0]=1,W[1]=0,W[2]=0);return ca}function k(W,ba,ca){const da=ba[0],ha=ba[1],fa=ba[2];ba=ba[3];const R=ca[0],U=ca[1],Z=ca[2];ca=ca[3];W[0]=da*ca+ba*R+ha*Z-fa*U;W[1]=ha*ca+ba*U+fa*R-da*Z;W[2]=fa*ca+ba*Z+da*U-ha*R;W[3]=ba*ca-da*R-ha*U-fa*Z;return W}
function l(W,ba,ca){ca*=.5;const da=ba[0],ha=ba[1],fa=ba[2];ba=ba[3];const R=Math.sin(ca);ca=Math.cos(ca);W[0]=da*ca+ba*R;W[1]=ha*ca+fa*R;W[2]=fa*ca-ha*R;W[3]=ba*ca-da*R;return W}function m(W,ba,ca){ca*=.5;const da=ba[0],ha=ba[1],fa=ba[2];ba=ba[3];const R=Math.sin(ca);ca=Math.cos(ca);W[0]=da*ca-fa*R;W[1]=ha*ca+ba*R;W[2]=fa*ca+da*R;W[3]=ba*ca-ha*R;return W}function z(W,ba,ca){ca*=.5;const da=ba[0],ha=ba[1],fa=ba[2];ba=ba[3];const R=Math.sin(ca);ca=Math.cos(ca);W[0]=da*ca+ha*R;W[1]=ha*ca-da*R;W[2]=
fa*ca+ba*R;W[3]=ba*ca-fa*R;return W}function r(W,ba){const ca=ba[0],da=ba[1];ba=ba[2];W[0]=ca;W[1]=da;W[2]=ba;W[3]=Math.sqrt(Math.abs(1-ca*ca-da*da-ba*ba));return W}function c(W,ba,ca,da){const ha=ba[0],fa=ba[1],R=ba[2];ba=ba[3];let U=ca[0],Z=ca[1],T=ca[2];ca=ca[3];let P;let X;var aa=ha*U+fa*Z+R*T+ba*ca;0>aa&&(aa=-aa,U=-U,Z=-Z,T=-T,ca=-ca);1-aa>t.EPSILON?(P=Math.acos(aa),X=Math.sin(P),aa=Math.sin((1-da)*P)/X,da=Math.sin(da*P)/X):aa=1-da;W[0]=aa*ha+da*U;W[1]=aa*fa+da*Z;W[2]=aa*R+da*T;W[3]=aa*ba+da*
ca;return W}function d(W){var ba=t.RANDOM();const ca=t.RANDOM(),da=t.RANDOM(),ha=Math.sqrt(1-ba);ba=Math.sqrt(ba);W[0]=ha*Math.sin(2*Math.PI*ca);W[1]=ha*Math.cos(2*Math.PI*ca);W[2]=ba*Math.sin(2*Math.PI*da);W[3]=ba*Math.cos(2*Math.PI*da);return W}function g(W,ba){const ca=ba[0],da=ba[1],ha=ba[2];ba=ba[3];var fa=ca*ca+da*da+ha*ha+ba*ba;fa=fa?1/fa:0;W[0]=-ca*fa;W[1]=-da*fa;W[2]=-ha*fa;W[3]=ba*fa;return W}function A(W,ba){W[0]=-ba[0];W[1]=-ba[1];W[2]=-ba[2];W[3]=ba[3];return W}function q(W,ba){var ca=
ba[0]+ba[4]+ba[8];if(0<ca)ca=Math.sqrt(ca+1),W[3]=.5*ca,ca=.5/ca,W[0]=(ba[5]-ba[7])*ca,W[1]=(ba[6]-ba[2])*ca,W[2]=(ba[1]-ba[3])*ca;else{let da=0;ba[4]>ba[0]&&(da=1);ba[8]>ba[3*da+da]&&(da=2);const ha=(da+1)%3,fa=(da+2)%3;ca=Math.sqrt(ba[3*da+da]-ba[3*ha+ha]-ba[3*fa+fa]+1);W[da]=.5*ca;ca=.5/ca;W[3]=(ba[3*ha+fa]-ba[3*fa+ha])*ca;W[ha]=(ba[3*ha+da]+ba[3*da+ha])*ca;W[fa]=(ba[3*fa+da]+ba[3*da+fa])*ca}return W}function y(W,ba,ca,da){var ha=.5*Math.PI/180;ba*=ha;ca*=ha;da*=ha;ha=Math.sin(ba);ba=Math.cos(ba);
const fa=Math.sin(ca);ca=Math.cos(ca);const R=Math.sin(da);da=Math.cos(da);W[0]=ha*ca*da-ba*fa*R;W[1]=ba*fa*da+ha*ca*R;W[2]=ba*ca*R-ha*fa*da;W[3]=ba*ca*da+ha*fa*R;return W}function x(W){return"quat("+W[0]+", "+W[1]+", "+W[2]+", "+W[3]+")"}function D(W,ba,ca){const da=w.dot(ba,ca);if(-.999999>da)return w.cross(M,O,ba),1E-6>w.len(M)&&w.cross(M,Q,ba),w.normalize(M,M),b(W,M,Math.PI),W;if(.999999<da)return W[0]=0,W[1]=0,W[2]=0,W[3]=1,W;w.cross(M,ba,ca);W[0]=M[0];W[1]=M[1];W[2]=M[2];W[3]=1+da;return H(W,
W)}function C(W,ba,ca,da,ha,fa){c(S,ba,ha,fa);c(V,ca,da,fa);c(W,S,V,2*fa*(1-fa));return W}function B(W,ba,ca,da){const ha=Y;ha[0]=ca[0];ha[3]=ca[1];ha[6]=ca[2];ha[1]=da[0];ha[4]=da[1];ha[7]=da[2];ha[2]=-ba[0];ha[5]=-ba[1];ha[8]=-ba[2];return H(W,q(W,ha))}const v=e.copy,E=e.set,F=e.add,L=e.scale,N=e.dot,I=e.lerp,G=e.length,K=e.squaredLength,H=e.normalize,J=e.exactEquals;e=e.equals;const M=p.create(),O=p.fromValues(1,0,0),Q=p.fromValues(0,1,0),S=f.create(),V=f.create(),Y=u.create();u=Object.freeze({__proto__:null,
identity:n,setAxisAngle:b,getAxisAngle:h,multiply:k,rotateX:l,rotateY:m,rotateZ:z,calculateW:r,slerp:c,random:d,invert:g,conjugate:A,fromMat3:q,fromEuler:y,str:x,copy:v,set:E,add:F,mul:k,scale:L,dot:N,lerp:I,length:G,len:G,squaredLength:K,sqrLen:K,normalize:H,exactEquals:J,equals:e,rotationTo:D,sqlerp:C,setAxes:B});a.add=F;a.calculateW=r;a.conjugate=A;a.copy=v;a.dot=N;a.equals=e;a.exactEquals=J;a.fromEuler=y;a.fromMat3=q;a.getAxisAngle=h;a.identity=n;a.invert=g;a.len=G;a.length=G;a.lerp=I;a.mul=k;
a.multiply=k;a.normalize=H;a.quat=u;a.random=d;a.rotateX=l;a.rotateY=m;a.rotateZ=z;a.rotationTo=D;a.scale=L;a.set=E;a.setAxes=B;a.setAxisAngle=b;a.slerp=c;a.sqlerp=C;a.sqrLen=K;a.squaredLength=K;a.str=x})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){function m(C,B,v=k.defaultApplyOptions,E=!0){D.eyeCenterDistance=0;D.requiresTwoSteps=!1;const F=z(C,B,v,void 0,D);if(0===F)return!1;t.identity(g);t.rotate(g,g,-F,B.viewRight);switch(v.tiltMode){case 1:e.transformMat4(d,B.viewForward,g);e.scale(d,d,D.eyeCenterDistance);B.center=e.add(A,B.eye,d);break;case 0:e.subtract(d,B.center,B.eye);e.transformMat4(d,d,g);B.eye=e.subtract(A,B.center,d);break;default:u.neverReached(v.tiltMode)}B.up=e.transformMat4(A,B.up,g);return D.requiresTwoSteps&&
E?m(C,B,v,!1):!0}function z(C,B,v=k.defaultApplyOptions,E=k.defaultApplyOptions,F){if(!C.state.constraints.tilt)return 0;var L=C.state.constraints.tilt(B.distance,y);if(0!==v.interactionType){var {interactionStartCamera:N,interactionFactor:I}=v,{min:G,max:K}=L,H=z(C,N,k.defaultApplyOptions,v),J=0===H?0:l.viewAngle(C.renderCoordsHelper,N.center,N.eye);L.min=G;L.max=K;2===v.interactionType?(k.hasConstraintType(v.selection,2)&&c(C,N,L),k.adjustRangeForInteraction(H,J,!0,I,q,L)):k.adjustRangeForInteraction(H,
J,!1,I,q,L)}2===E.interactionType&&k.hasConstraintType(E.selection,2)&&c(C,E.interactionStartCamera,L);if(1===v.tiltMode||1===E.tiltMode){a:switch(F&&(F.requiresTwoSteps=!1),C.viewingMode){case "global":v=x;H=C.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;E=H+b.getReferenceEllipsoid(C.spatialReference).radius;H=C.renderCoordsHelper.intersectManifold(B.ray,H,A);v.eyeCenterDistance=B.distance;v.centerIsOnSurface=!1;p.isSome(H)?(v.eyeCenterDistance=e.distance(B.eye,H),v.tiltAtCenter=
l.viewAngle(C.renderCoordsHelper,H,B.eye),v.centerIsOnSurface=!0):C.state.isLocal?v.tiltAtCenter=l.viewAngle(C.renderCoordsHelper,B.center,B.eye):(h.closestPointOnSilhouette(h.fromRadius(E),B.ray,A),v.eyeCenterDistance=e.distance(B.eye,A),v.tiltAtCenter=f.acosClamped(-e.dot(B.viewForward,e.normalize(A,A))));v.radius=E;v.eyeRadius=e.length(B.eye);v.constraints=C.state.constraints;B=f.clamp(v.tiltAtCenter,L.min,L.max);if(1E-9<Math.abs(v.tiltAtCenter-B)){if(v.centerIsOnSurface){{const {constraints:M,
eyeCenterDistance:O,tiltAtCenter:Q}=v;B=Q;C=M.clampTilt(O,Q);L=r(v,C);if(M.clampTilt(L,Q)!==C)for(L=0;10>L&&1E-9<Math.abs(C-B);)E=(B+C)/2,H=r(v,E),H=M.clampTilt(H,E),1E-9<Math.abs(H-E)?B=E:C=E,L++;B=C}L=B;C=f.asinClamped(v.radius/v.eyeRadius*Math.sin(v.tiltAtCenter));L=f.asinClamped(v.radius/v.eyeRadius*Math.sin(L));C=v.eyeRadius>v.radius?C-L:L-C}else B=v.constraints.clampTilt(v.eyeCenterDistance,v.tiltAtCenter),F&&B<Math.PI/2&&(F.requiresTwoSteps=!0,B=Math.PI/2-1E-5),C=v.tiltAtCenter-Math.PI/2-(B-
Math.PI/2);F&&(F.eyeCenterDistance=r(v,B));F=C}else F=0;break a;case "local":E=l.viewAngle(C.renderCoordsHelper,B.center,B.eye);v=f.clamp(E,L.min,L.max);L=E-v;1E-9<Math.abs(L)?(F&&(E=C.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,C=C.renderCoordsHelper.getAltitude(B.eye)-E,v=Math.cos(v),F.eyeCenterDistance=1E-4<Math.abs(v)?C/v:B.distance),F=L):F=0;break a;default:u.neverReached(C.viewingMode),F=void 0}return F}F=l.viewAngle(C.renderCoordsHelper,B.center,B.eye);v=f.clamp(F,L.min,
L.max);F-=v;F=1E-9<Math.abs(F)?F:0;return F}function r(C,B){if(!C.centerIsOnSurface)return C.eyeCenterDistance;B=Math.PI-f.clamp(B,0,Math.PI);const v=f.asinClamped(C.radius/C.eyeRadius*Math.sin(B)),E=Math.sin(Math.PI-B-v)/Math.sin(B);return C.eyeRadius<C.radius&&1<E?Math.sin(Math.PI-B-(Math.PI-v))/Math.sin(B)*C.eyeRadius:E*C.eyeRadius}function c(C,B,v){if(!C.state.isLocal){var E=C.state.constraints;if(E.altitude){var F=e.squaredLength(B.center),L=Math.sqrt(F);B=B.distance;var N=b.getReferenceEllipsoid(C.spatialReference).radius;
C=E.altitude.min+N;E=E.altitude.max+N;C=(C*C-B*B-F)/(-2*L*B);v.min=Math.max(v.min,Math.min(Math.PI-f.acosClamped((E*E-B*B-F)/(-2*L*B)),v.max));v.max=Math.min(v.max,Math.PI-f.acosClamped(C))}}}const d=n.create(),g=w.create(),A=n.create(),q=f.deg2rad(5),y={min:0,max:0},x={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},D={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=m;a.getTiltConstraintError=z;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,u,f,p){const t=p.create(),w=p.create();a.viewAngle=function(e,n,b){e.worldUpAtPosition(n,t);f.subtract(w,b,n);e=f.length(w);return 0===e?0:u.acosClamped(f.dot(w,t)/e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function u(Q){return Q}function f(Q){const S=2*
(Q-Math.sqrt((Q-1)*Q)),V=S/2/Q;return Y=>Y<V?Q*Y*Y:S*Y-S+1}function p(Q,S){return(V,Y)=>V<S?S*Q(V/S,Y):1-Q((1-V)/(1-S),Y)*(1-S)}const t=Q=>Q*Q,w=Q=>1-t(1-Q),e=Q=>.5>Q?t(2*Q)/2:(1-t(1-2*(Q-.5))+1)/2,n=Q=>Q*Q*Q,b=Q=>1-n(1-Q),h=Q=>.5>Q?n(2*Q)/2:(1-n(1-2*(Q-.5))+1)/2,k=Q=>Q*Q*Q*Q,l=Q=>1-k(1-Q),m=Q=>.5>Q?k(2*Q)/2:(1-k(1-2*(Q-.5))+1)/2,z=Q=>Q*Q*Q*Q*Q,r=Q=>1-z(1-Q),c=Q=>.5>Q?z(2*Q)/2:(1-z(1-2*(Q-.5))+1)/2,d=Q=>-Math.cos(Q*Math.PI/2)+1,g=Q=>1-d(1-Q),A=Q=>.5>Q?d(2*Q)/2:(1-d(1-2*(Q-.5))+1)/2,q=Q=>2**(10*(Q-
1)),y=Q=>1-2**(10*(1-Q-1)),x=Q=>.5>Q?2**(10*(2*Q-1))/2:(1-2**(10*(1-2*(Q-.5)-1))+1)/2,D=Q=>-(Math.sqrt(1-Q*Q)-1),C=Q=>1-D(1-Q),B=Q=>.5>Q?D(2*Q)/2:(1-D(1-2*(Q-.5))+1)/2,v=p(f(1),1),E=p(f(1),0),F=p(f(1),.5),L=p(f(2),1),N=p(f(2),0),I=p(f(2),.5),G=p(f(3),1),K=p(f(3),0),H=p(f(3),.5),J=p(f(4),1),M=p(f(4),0),O=p(f(4),.5);a.EasingFunctions={linear:u,"in-quad":t,"out-quad":w,"in-out-quad":e,"in-coast-quad":v,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":n,"out-cubic":b,"in-out-cubic":h,"in-coast-cubic":L,
"out-coast-cubic":N,"in-out-coast-cubic":I,"in-quart":k,"out-quart":l,"in-out-quart":m,"in-coast-quart":G,"out-coast-quart":K,"in-out-coast-quart":H,"in-quint":z,"out-quint":r,"in-out-quint":c,"in-coast-quint":J,"out-coast-quint":M,"in-out-coast-quint":O,"in-sine":d,"out-sine":g,"in-out-sine":A,"in-expo":q,"out-expo":y,"in-out-expo":x,"in-circ":D,"out-circ":C,"in-out-circ":B};a.inCirc=D;a.inCoastCubic=L;a.inCoastQuad=v;a.inCoastQuart=G;a.inCoastQuint=J;a.inCubic=n;a.inExpo=q;a.inOutCirc=B;a.inOutCoastCubic=
I;a.inOutCoastQuad=F;a.inOutCoastQuart=H;a.inOutCoastQuint=O;a.inOutCubic=h;a.inOutExpo=x;a.inOutQuad=e;a.inOutQuart=m;a.inOutQuint=c;a.inOutSine=A;a.inQuad=t;a.inQuart=k;a.inQuint=z;a.inSine=d;a.linear=u;a.outCirc=C;a.outCoastCubic=N;a.outCoastQuad=E;a.outCoastQuart=K;a.outCoastQuint=M;a.outCubic=b;a.outExpo=y;a.outQuad=w;a.outQuart=l;a.outQuint=r;a.outSine=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){a.PointToPointAnimationController=function(A){function q(x){x=A.call(this,x)||this;x.view=null;x.mode="interaction";x.hasTarget=!1;return x}u._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this.animation=new l.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new k};y.begin=function(x,D){this.hasTarget=!0;D=this.animationSettings(D);d.copyFrom(this.view.state.camera);const C=new r.Intersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(d.ray,C,g)&&(d.center=g);this.animation.update(d,x,D);this.animation.finished&&this.finish()};y.finish=function(){this.animation.currentTime=this.animation.time;A.prototype.finish.call(this)};y.stepController=function(x,D){this.hasTarget&&this.animation.step(x,D)};y.onControllerEnd=function(x){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,x),this.animation.currentTime=this.animation.time);A.prototype.onControllerEnd.call(this,
x)};y.animationSettings=function(x={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...x,easing:"string"===typeof x.easing?c.EasingFunctions[x.easing]:x.easing}};u._createClass(q,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return q}(m.AnimationController);f.__decorate([p.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);f.__decorate([p.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=f.__decorate([b.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const d=new z,g=h.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,u,f,p,t,w,e,n){const b=t.create();t=function(){function h(l){this.currentTime=f.Milliseconds(0);this._animation=new n.Animation(()=>new w(l));this._current=new w(l)}var k=h.prototype;k.update=function(l,m,z){const r=this._animation.definition.source,c=this._animation.definition.target,d=p.subtract(b,m.center,l.center),g=p.length(d);1E-5<=g?(d[0]/=g,d[1]/=g,d[2]/=g):(d[0]=0,d[1]=1,d[0]=0);p.copy(r.lookAtDirection,d);p.copy(c.lookAtDirection,d);r.copyFromRenderCamera(l);c.copyFromRenderCamera(m);
this._current.copyFrom(r);this._animation.update(r,c,z);this.currentTime=f.Milliseconds(0);l.almostEquals(m)&&(this.currentTime=this._animation.time)};k.cameraAt=function(l,m){this._animation.cameraAt(l,this._current);m=m||new e;this._current.copyToRenderCamera(m);return m};k.step=function(l,m){this.finished||(this.currentTime=f.Milliseconds(this.currentTime+f.MillisecondsFromSeconds(l)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,m)};
u._createClass(h,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return h}();a.Animation=t;a.default=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/mathUtils".split(" "),function(a,u,f,p,t,w){const e=
t.create(),n=t.create(),b=t.create(),h=t.create(),k=t.create(),l=t.create();var m=t.fromValues(0,0,1),z=t.fromValues(0,1,0),r=t.fromValues(1,0,0);const c=f.create();return function(){function d(A=1){this.viewingMode=A;this.center=t.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=t.clone(z)}var g=d.prototype;g.pixelsPerPanAtZoom=function(A){return this.size/2/(this._zoomToPanScale*A)};g.zoomAtPixelsPerPan=function(A){return this.size/2/(this._zoomToPanScale*A)};g.pixelsPerRotateAtZoom=
function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};g.compareTo=function(A,q){q||(q={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(1===this.viewingMode){var y=p.length(this.center);const x=p.length(A.center);y=(y+x)/2;q.pan=w.angle(this.center,A.center)*y}else q.pan=p.distance(this.center,A.center);y=Math.abs(A.yaw-this.yaw);y>=Math.PI&&(y=2*Math.PI-y);q.rotate=Math.max(y,Math.abs(A.pitch-this.pitch));q.sourceZoom=this.distance;q.targetZoom=A.distance;return q};g.interpolate=
function(A,q,y){1===this.viewingMode?w.slerp(A.center,q.center,y.pan,this.center):p.lerp(this.center,A.center,q.center,y.pan);this.distance=a.lerp(A.distance,q.distance,y.zoom);this.pitch=a.lerp(A.pitch,q.pitch,y.rotate);A=A.yaw;q=q.yaw;Math.abs(q-A)>=Math.PI&&(A+=2*(A<q?1:-1)*Math.PI);this.yaw=a.lerp(A,q,y.rotate)};g.copyFrom=function(A){p.copy(this.center,A.center);this.pitch=A.pitch;this.yaw=A.yaw;this.distance=A.distance;p.copy(this.lookAtDirection,A.lookAtDirection);this.size=A.size;this.copyFromCommon(A);
this.viewingMode=A.viewingMode};g.copyFromRenderCamera=function(A){const q=this._lookAtOrientation(A.center,c);p.copy(this.center,A.center);p.subtract(h,A.center,A.eye);p.transformMat3(h,h,q);p.transformMat3(k,A.up,q);this.distance=p.length(h);h[0]/=this.distance;h[1]/=this.distance;h[2]/=this.distance;this.pitch=this._eyeUpToPitch(h);this.yaw=this._eyeUpToYaw(h,k);this.size=Math.sqrt(A.width*A.width+A.height*A.height);this.copyFromCommon(A)};g.copyFromCommon=function(A){this.fov=A.fov;this._zoomToPanScale=
Math.atan(.5*this.fov)};g.copyToRenderCamera=function(A){const q=this._lookAtOrientation(this.center,c);u.transpose(q,q);this._axisAngleVec3(r,this.pitch-Math.PI/2,z,h);this._axisAngleVec3(m,this.yaw,h);this._axisAngleVec3(r,this.pitch-Math.PI/2,m,k);this._axisAngleVec3(m,this.yaw,k);p.scale(h,h,this.distance);p.transformMat3(h,h,q);p.transformMat3(k,k,q);A.center=this.center;A.eye=p.subtract(h,this.center,h);A.up=k};g._axisAngleVec3=function(A,q,y,x=y){const D=Math.cos(q);q=Math.sin(q);p.scale(e,
y,D);p.cross(n,A,y);p.scale(n,n,q);p.scale(b,A,(1-D)*p.dot(A,y));return p.add(x,p.add(x,e,n),b)};g._lookAtOrientation=function(A,q=f.create()){this._upAtLookAt(A,b);p.cross(e,this.lookAtDirection,b);p.normalize(e,e);0===e[0]&&0===e[1]&&0===e[2]&&p.copy(e,r);p.cross(n,b,e);p.normalize(n,n);q[0]=e[0];q[1]=n[0];q[2]=b[0];q[3]=e[1];q[4]=n[1];q[5]=b[1];q[6]=e[2];q[7]=n[2];q[8]=b[2];return q};g._upAtLookAt=function(A,q){return 2===this.viewingMode?p.copy(q,m):p.normalize(q,A)};g._eyeUpToPitch=function(A){return Math.PI-
w.angle(m,A)};g._eyeUpToYaw=function(A,q){.5>Math.abs(q[2])?(p.copy(l,q),0<A[2]&&p.scale(l,l,-1)):p.copy(l,A);p.cross(n,l,m);p.normalize(n,n);return w.angle(r,n,m)};return d}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ./Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=u.getLogger("esri.views.3d.webgl-engine.lib.Camera");u=function(){function C(v=null,E=null,F=null){this._viewUp=k.create();this._viewForward=k.create();this._viewRight=k.create();this._ray=r.create();this._viewport=m.fromValues(0,0,1,1);this._padding=m.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=b.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=e.create();this._projectionDirty=!0;this._projectionMatrix=e.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=e.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.create();this._frustumDirty=!0;this._frustum=z.create();this._fullViewport=m.create();this.pixelRatio=1;this.relativeElevation=0;p.isSome(v)&&h.copy(this._ray.origin,v);this._center=p.isSome(E)?k.clone(E):k.create();this._up=p.isSome(F)?k.clone(F):k.fromValues(0,0,1)}var B=C.prototype;B.depthNDCToWorld=function(v){return 2*this.near*this.far/(this.far+this.near-(2*v-1)*(this.far-this.near))};
B.copyFrom=function(v){h.copy(this._ray.origin,v.eye);h.copy(this._center,v.center);h.copy(this._up,v.up);l.copy(this._viewport,v.viewport);l.copy(this._padding,v.padding);n.copy(this._nearFar,v.nearFar);this._fov=v.fov;this.relativeElevation=v.relativeElevation;this._viewDirty=v._viewDirty;this._viewDirty||(w.copy(this._viewMatrix,v.viewMatrix),h.copy(this._viewRight,v.viewRight),h.copy(this._viewUp,v.viewUp),h.copy(this._viewForward,v.viewForward));v._projectionDirty?this._projectionDirty=!0:(w.copy(this._projectionMatrix,
v.projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=v._frustumDirty;this._frustumDirty||(z.copy(v.frustum,this._frustum),this._frustumDirty=!1);v._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(w.copy(this._viewInverseTransposeMatrix,v.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);l.copy(this._fullViewport,v.fullViewport);this.pixelRatio=v.pixelRatio;return this};B.copyViewFrom=function(v){this.eye=v.eye;
this.center=v.center;this.up=v.up};B.clone=function(){return(new C).copyFrom(this)};B.equals=function(v){return h.exactEquals(this.eye,v.eye)&&h.exactEquals(this._center,v.center)&&h.exactEquals(this._up,v.up)&&l.exactEquals(this._viewport,v.viewport)&&l.exactEquals(this._padding,v.padding)&&n.exactEquals(this._nearFar,v.nearFar)&&this._fov===v.fov&&this.pixelRatio===v.pixelRatio&&this.relativeElevation===v.relativeElevation};B.almostEquals=function(v){if(this.pixelRatio!==v.pixelRatio||.001<=Math.abs(v.fov-
this._fov))return!1;const E=1-1E-10;h.sub(y,v.eye,v.center);h.sub(x,this.eye,this._center);const F=h.dot(y,x),L=h.sqrLen(y),N=h.sqrLen(x);return F*F>=E*L*N&&h.sqrDist(v.eye,this.eye)<2.5E-7*Math.max(L,N)&&.5>l.squaredDistance(v.padding,this._padding)&&.5>l.squaredDistance(v.viewport,this._viewport)};B.computeRenderPixelSizeAt=function(v){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(v))};B.computeRenderPixelSizeAtDist=function(v){return v*this.perRenderPixelRatio};B.computeScreenPixelSizeAt=
function(v){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(v))};B.viewDirectionDistance=function(v){return Math.abs(c.projectPointSignedLength(this.viewForward,h.subtract(y,v,this.eye)))};B.computeScreenPixelSizeAtDist=function(v){return v*this.perScreenPixelRatio};B.computeDistanceFromRadius=function(v,E){return v/Math.tan(Math.min(this.fovX,this.fovY)/(2*(E||1)))};B.getScreenCenter=function(v=t.createScreenPointArray()){v[0]=(this.padding[3]+this.width/2)/this.pixelRatio;v[1]=
(this.padding[0]+this.height/2)/this.pixelRatio;return v};B.getRenderCenter=function(v,E=.5,F=.5){v||(v=t.createRenderScreenPointArray3());v[0]=this.padding[3]+this.width*E;v[1]=this.padding[2]+this.height*F;2<v.length&&(v[2]=.5);return v};B.setGLViewport=function(v){const E=this.viewport,F=this.padding;v.setViewport(E[0]-F[3],E[1]-F[2],E[2]+F[1]+F[3],E[3]+F[0]+F[2])};B.applyProjection=function(v,E,F=!1){v!==A&&h.copy(A,v);A[3]=1;F&&(E[2]=-A[2]);l.transformMat4(A,A,this.projectionMatrix);h.scale(A,
A,1/Math.abs(A[3]));v=this.fullViewport;E[0]=f.lerp(0,v[0]+v[2],.5+.5*A[0]);E[1]=f.lerp(0,v[1]+v[3],.5+.5*A[1]);F||(E[2]=.5*(A[2]+1));return E};B.projectToScreen=function(v,E){this.projectToRenderScreen(v,D);this.renderToScreen(D,E)};B.projectToRenderScreen=function(v,E){A[0]=v[0];A[1]=v[1];A[2]=v[2];A[3]=1;l.transformMat4(A,A,this.viewProjectionMatrix);if(0===A[3])return null;h.scale(A,A,1/Math.abs(A[3]));v=this.fullViewport;"x"in E?(E.x=f.lerp(0,v[0]+v[2],.5+.5*A[0]),E.y=f.lerp(0,v[1]+v[3],.5+.5*
A[1])):(E[0]=f.lerp(0,v[0]+v[2],.5+.5*A[0]),E[1]=f.lerp(0,v[1]+v[3],.5+.5*A[1]),2<E.length&&(E[2]=.5*(A[2]+1)));return E};B.unprojectFromScreen=function(v,E){return this.unprojectFromRenderScreen(this.screenToRender(v,D),E)};B.unprojectFromRenderScreen=function(v,E){w.multiply(q,this.projectionMatrix,this.viewMatrix);if(!w.invert(q,q))return null;const F=this.fullViewport;A[0]=2*(v[0]-F[0])/F[2]-1;A[1]=2*(v[1]-F[1])/F[3]-1;A[2]=2*v[2]-1;A[3]=1;l.transformMat4(A,A,q);if(0===A[3])return null;E[0]=A[0]/
A[3];E[1]=A[1]/A[3];E[2]=A[2]/A[3];return E};B.constrainWindowSize=function(v,E,F,L=F){v*=this.pixelRatio;E*=this.pixelRatio;return[Math.max(v-F/2,0),Math.max(this.fullHeight-E-L/2,0),F- -Math.min(v-F/2,0)- -Math.min(this.fullWidth-v-F/2,0),L- -Math.min(this.fullHeight-E-L/2,0)- -Math.min(E-L/2,0)]};B.computeUp=function(v){1===v?this.computeUpGlobal():this.computeUpLocal()};B.screenToRender=function(v,E){const F=this.fullHeight-v[1]*this.pixelRatio;E[0]=v[0]*this.pixelRatio;E[1]=F;return E};B.renderToScreen=
function(v,E){const F=(this.fullHeight-v[1])/this.pixelRatio;E[0]=v[0]/this.pixelRatio;E[1]=F};B.computeUpGlobal=function(){h.subtract(y,this.center,this.eye);const v=h.length(this.center);1>v?(h.set(this._up,0,0,1),this._markViewDirty()):Math.abs(h.dot(y,this.center))>.9999*h.length(y)*v||(h.cross(this._up,y,this.center),h.cross(this._up,this._up,y),h.normalize(this._up,this._up),this._markViewDirty())};B.computeUpLocal=function(){h.direction(y,this.eye,this.center);.9999>=Math.abs(y[2])&&(h.scale(y,
y,y[2]),h.set(this._up,-y[0],-y[1],1-y[2]),h.normalize(this._up,this._up),this._markViewDirty())};B._compareAndSetView=function(v,E){"number"===typeof v[0]&&isFinite(v[0])&&"number"===typeof v[1]&&isFinite(v[1])&&"number"===typeof v[2]&&isFinite(v[2])?h.exactEquals(v,E)||(h.copy(E,v),this._markViewDirty()):g.warn("Camera vector contains invalid number, ignoring value")};B._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};B._recomputeFrustum=function(){this._frustumDirty&&
(z.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};B._ensureViewClean=function(){this._viewDirty&&(w.lookAt(this._viewMatrix,this.eye,this._center,this._up),h.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),h.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),h.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=
!0)};a._createClass(C,[{key:"eye",get:function(){return this._ray.origin},set:function(v){this._compareAndSetView(v,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(v){this._compareAndSetView(v,this._center)}},{key:"ray",get:function(){h.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(v){this._compareAndSetView(v,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},
set:function(v){w.copy(this._viewMatrix,v);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(v){this._nearFar[0]!==
v&&(this._nearFar[0]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(v){this._nearFar[1]!==v&&(this._nearFar[1]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(v){this.x=v[0];this.y=v[1];this.width=v[2];this.height=v[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(v){v+=this._padding[3];this._viewport[0]!==
v&&(this._viewport[0]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(v){v+=this._padding[2];this._viewport[1]!==v&&(this._viewport[1]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(v){this._viewport[2]!==v&&(this._viewport[2]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"height",
get:function(){return this._viewport[3]},set:function(v){this._viewport[3]!==v&&(this._viewport[3]=v,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(v){this.width=v-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(v){this.height=v-(this._padding[0]+this._padding[2])}},{key:"fullViewport",
get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(v){if(this._padding[0]!==v[0]||this._padding[1]!==v[1]||this._padding[2]!==v[2]||this._padding[3]!==v[3])this._viewport[0]+=v[3]-this._padding[3],
this._viewport[1]+=v[2]-this._padding[2],this._viewport[2]-=v[1]+v[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=v[0]+v[2]-(this._padding[0]+this._padding[2]),l.copy(this._padding,v),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(w.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",
get:function(){if(this._projectionDirty){const v=this.width,E=this.height,F=this.near*Math.tan(this.fovY/2),L=F*this.aspect;w.frustum(this._projectionMatrix,-L*(1+2*this._padding[3]/v),L*(1+2*this._padding[1]/v),-F*(1+2*this._padding[2]/E),F*(1+2*this._padding[0]/E),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(v){w.copy(this._projectionMatrix,v);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},
set:function(v){this._fov=v;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return d.fovd2fovx(this._fov,this.width,this.height)},set:function(v){this._fov=d.fovx2fovd(v,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return d.fovd2fovy(this._fov,this.width,this.height)},set:function(v){this._fov=d.fovy2fovd(v,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0}},{key:"distance",get:function(){return h.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)w.invert(this._viewInverseTransposeMatrix,this.viewMatrix),w.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},
{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return C}();const A=m.create(),q=e.create(),y=k.create(),x=k.create(),D=t.createRenderScreenPointArray3();return u})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,u,f,p,t,w,e,n,b,h){function k(g){return g?[b.create(g[0]),b.create(g[1]),b.create(g[2]),b.create(g[3]),b.create(g[4]),b.create(g[5])]:[b.create(),b.create(),b.create(),b.create(),b.create(),b.create()]}function l(){return[t.create(),t.create(),t.create(),t.create(),t.create(),t.create(),t.create(),t.create()]}function m(g,A){b.fromPoints(A[4],A[0],A[3],g[0]);b.fromPoints(A[1],A[5],A[6],g[1]);b.fromPoints(A[4],A[5],A[1],g[2]);b.fromPoints(A[3],A[2],A[6],g[3]);b.fromPoints(A[0],A[1],A[2],
g[4]);b.fromPoints(A[5],A[4],A[7],g[5])}function z(g,A){for(let q=0;6>q;q++)if(!b.clip(g[q],A))return!1;return!0}const r=[e.fromValues(-1,-1,-1,1),e.fromValues(1,-1,-1,1),e.fromValues(1,1,-1,1),e.fromValues(-1,1,-1,1),e.fromValues(-1,-1,1,1),e.fromValues(1,-1,1,1),e.fromValues(1,1,1,1),e.fromValues(-1,1,1,1)],c=new u.ObjectStack(n.create),d=l();a.computePlanes=m;a.copy=function(g,A=k()){for(let q=0;6>q;q++)b.copy(g[q],A[q])};a.create=k;a.createPoints=l;a.fromMatrix=function(g,A,q,y=d){g=f.multiply(h.sm4d.get(),
A,g);f.invert(g,g);for(A=0;8>A;++A){const x=w.transformMat4(h.sv4d.get(),r[A],g);p.set(y[A],x[0]/x[3],x[1]/x[3],x[2]/x[3])}m(q,y)};a.intersectClipRay=function(g,A){for(let q=0;6>q;q++)if(!b.clipInfinite(g[q],A))return!1;return!0};a.intersectsAABB=function(g,A){for(let q=0;6>q;q++)if(b.isAABBFullyInside(g[q],A))return!1;return!0};a.intersectsLineSegment=function(g,A,q){return z(g,n.fromLineSegmentAndDirection(A,q,c.get()))};a.intersectsPoint=function(g,A){for(let q=0;6>q;q++)if(0<b.signedDistance(g[q],
A))return!1;return!0};a.intersectsRay=function(g,A){return z(g,n.fromRay(A,c.get()))};a.intersectsSphere=function(g,A){for(let q=0;6>q;q++)if(b.isSphereFullyInside(g[q],A))return!1;return!0};a.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,u,
f,p,t){function w(k){return k?{ray:p.create(k.ray),c0:k.c0,c1:k.c1}:{ray:p.create(),c0:0,c1:Number.MAX_VALUE}}function e(k,l,m,z=w()){p.copy(k,z.ray);z.c0=l;z.c1=m;return z}function n(k,l,m=w()){const z=f.length(k.vector);p.fromValues(k.origin,l,m.ray);m.c0=0;m.c1=z;return m}function b(k,l,m){return f.add(m,k.ray.origin,f.scale(m,k.ray.direction,l))}const h=new u.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(k,l=w()){return e(k.ray,k.c0,k.c1,l)};a.create=w;a.fromLineSegment=function(k,l=
w()){const m=f.normalize(t.sv3d.get(),k.vector);return n(k,m,l)};a.fromLineSegmentAndDirection=n;a.fromRay=function(k,l=w()){p.copy(k,l.ray);l.c0=0;l.c1=Number.MAX_VALUE;return l};a.fromValues=e;a.getAt=b;a.getEnd=function(k,l){return b(k,k.c1,l)};a.getStart=function(k,l){return b(k,k.c0,l)};a.wrap=function(k,l,m){const z=h.get();z.ray=k;z.c0=l;z.c1=m;return z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(a,u,f,p,t,w,e){const n={zoom:0,pan:0,rotate:0};let b=function(){function h(l){this.createCamera=l;this._time=f.Milliseconds(0);this.definition=new t.Definition(l);this.path=new e.Path}var k=h.prototype;k.update=function(l,m,z){this.definition.update(l,m,z);this.path.update(this.definition,z);this._time=this._applyTimeSettings(f.MillisecondsFromSeconds(this.path.time),z);this._easing=z.easing?z.easing:1E3<=this._time?p.inOutCoastQuad:p.outExpo};k.cameraAt=function(l,m){m=m||this.createCamera();
l=Math.min(Math.max(0,l),1);l=this._normalizedEasing(l);l=this.path.interpolateComponentsAt(l,n);m.interpolate(this.definition.source,this.definition.target,l);return m};k._normalizedEasing=function(l){const m=this._easing(0,this._time),z=this._easing(1,this._time);return(this._easing(l,this._time)-m)/(z-m)};k._applyTimeSettings=function(l,m){const z=null!=m.speedFactor?m.speedFactor:1;null!=m.duration?l=m.duration:null!=m.speedFactor&&(l=f.Milliseconds(l/z));return f.Milliseconds(Math.min(Math.max(null!=
m.minDuration?m.minDuration:w.defaultSettings.minDuration/z,l),null!=m.maxDuration?m.maxDuration:w.defaultSettings.maxDuration/z))};u._createClass(h,[{key:"time",get:function(){return this._time}}]);return h}();a.Animation=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,u,f){let p=function(){function t(e){this.createCamera=e;this.compared={sourceZoom:0,
targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:f.defaultSettings.desiredScreenFlow};this.source=e();this.target=e()}var w=t.prototype;w.clone=function(){const e=new t(this.createCamera);e.copyFrom(this);return e};w.copyFrom=function(e){this.update(e.source,e.target,e.settings)};w.update=function(e,n,b){this.source!==e&&this.source.copyFrom(e);this.target!==n&&this.target.copyFrom(n);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=
b.desiredScreenFlow?b.desiredScreenFlow:f.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};w.halfWindowPanAtZoom=function(e){e=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/e};u._createClass(t,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<
this.compared.rotate}}]);return t}();a.Definition=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,u){u={desiredScreenFlow:2,minDuration:u.Milliseconds(500),maxDuration:u.Milliseconds(8E3)};a.defaultSettings=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(a,u,f,p,t,w){p=function(e){function n(h,k){var l=e.call(this)||this;l._preallocSegments=[new t.Segment,new t.Segment,new t.Segment];l.update(h,k);return l}u._inheritsLoose(n,e);var b=n.prototype;b.update=function(h,k){if(h){this.definition?this.definition.copyFrom(h):this.definition=h.clone();var l=null;k&&k.apex&&(l=w.optimalDistance(h,k.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==l?this._updateWithoutApex():this._updateWithApex(l,k.apex)}};b.segmentInterpolateComponentsAt=
function(h,k,l){l=h.interpolateComponentsAt(k,l);h===this._ascensionSegment?l.zoom=f.outQuad(l.zoom):h===this._descensionSegment&&(l.zoom=f.inQuad(l.zoom));return l};b._updateWithApex=function(h,k){const [l,m,z]=this._preallocSegments,r=null!=k.ascensionFactor?k.ascensionFactor:.5;k=Math.min(1-r,null!=k.ascensionFactor?k.descensionFactor:.5);const c=1-r-k;l.definition?l.definition.copyFrom(this.definition):l.definition=this.definition.clone();l.definition.compared.targetZoom=h;l.definition.compared.pan=
this.definition.compared.pan*r;l.definition.compared.rotate=this.definition.compared.rotate*r;l.update();this._ascensionSegment=l;this.segments.push(l);0<c&&(m.definition?m.definition.copyFrom(this.definition):m.definition=this.definition.clone(),m.definition.copyFrom(this.definition),m.definition.compared.sourceZoom=h,m.definition.compared.targetZoom=h,m.definition.compared.pan=this.definition.compared.pan*c,m.definition.compared.rotate=this.definition.compared.rotate*c,m.update(),this.segments.push(m));
z.definition?z.definition.copyFrom(this.definition):z.definition=this.definition.clone();z.definition.compared.sourceZoom=h;z.definition.compared.pan=this.definition.compared.pan*k;z.definition.compared.rotate=this.definition.compared.rotate*k;z.update();this._descensionSegment=z;this.segments.push(z)};b._updateWithoutApex=function(){const [h]=this._preallocSegments;h.update(this.definition);this.segments.push(h)};return n}(p.Path);a.Path=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,u,f){let p=function(){function t(){this.segments=[]}var w=t.prototype;w.interpolateComponentsAt=function(e,n){e=Math.min(Math.max(e,0),1);e*=this.time;var b=0,h=0;const k=this.definition;for(let l=0;l<this.segments.length;l++){const m=this.segments[l],z=m.definition;if(e<=m.time||l===this.segments.length-1)return n=this.segmentInterpolateComponentsAt(m,e/m.time,n),n.pan=k.hasPan?(b+z.compared.pan*n.pan)/k.compared.pan:1,
n.rotate=k.hasRotate?(h+z.compared.rotate*n.rotate)/k.compared.rotate:1,e=n.zoom*(z.compared.targetZoom-z.compared.sourceZoom)+z.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom,n.zoom=k.hasZoom?(e-b)/(h-b):1,n;e-=m.time;b+=z.compared.pan;h+=z.compared.rotate}};w.segmentInterpolateComponentsAt=function(e,n,b){return e.interpolateComponentsAt(n,b)};u._createClass(t,[{key:"time",get:function(){return this.segments.reduce((e,
n)=>f.Seconds(e+n.time),f.Seconds(0))}}]);return t}();a.Path=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,u,f){let p=function(){function t(e){e&&this.update(e)}var w=t.prototype;w.update=function(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};
w._updatePrecomputedVariables=function(){var e=this.definition;const n=e.compared,b=n.sourceZoom,h=n.targetZoom;this._zoomSign=b>h?1:-1;this._panPixelsAtSource=n.pan*e.source.pixelsPerPanAtZoom(b);e=(e.source.pixelsPerRotateAtZoom(b)+e.target.pixelsPerRotateAtZoom(h))/2;this._rotatePixels=n.rotate*e};w._updatePixelFlow=function(){var e=this.definition.compared.sourceZoom,n=this.definition.compared.targetZoom;const {hasZoom:b,hasPan:h,hasRotate:k}=this.definition;var l=0,m=0;b&&(h&&(l=(n/e-1)/(-1/
(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),k&&(m=Math.log(e/n)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;e=this.definition.desiredPixelFlow;b&&h&&k?(n=l+m+l*m,this._zoomPixelFlow=l*m/n*e,this._panPixelFlow=m/n*e,this._rotatePixelFlow=l/n*e):b&&h?(m=1+l,this._zoomPixelFlow=l/m*e,this._panPixelFlow=1/m*e):b&&k?(l=1+m,this._zoomPixelFlow=m/l*e,this._rotatePixelFlow=
1/l*e):h&&k?(l=this._panPixelsAtSource/this._rotatePixels,m=1+l,this._panPixelFlow=l/m*e,this._rotatePixelFlow=1/m*e):h?this._panPixelFlow=e:b?this._zoomPixelFlow=e:k&&(this._rotatePixelFlow=e);this._time=k?this.rotateTime:b?this.zoomTime:h?this.panTime:f.Seconds(0)};w._interpolateComponentsZoom=function(e){if(0===e||1===e)return e;if(this.definition.hasZoom){const n=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(n*(n/b)**-e-n)/(b-n)}return e};w._interpolateComponentsPan=
function(e){if(0===e||1===e)return e;if(this.definition.hasPan&&this.definition.hasZoom){const n=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(n*e*this._time)-1)/(n*Math.LN2)}return e};w._interpolateComponentsRotate=function(e){return e};w.interpolateComponentsAt=function(e,n){e=Math.min(Math.max(e,0),1);const b=this._interpolateComponentsZoom(e),h=this._interpolateComponentsPan(e);e=this._interpolateComponentsRotate(e);
n?(n.zoom=b,n.pan=h,n.rotate=e):n={zoom:b,pan:h,rotate:e};return n};u._createClass(t,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?f.Seconds(this._rotatePixels/this._rotatePixelFlow):f.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?f.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):f.Seconds(0)}},
{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return f.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*e+1)/(e*this._zoomPixelFlow))}return f.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return f.Seconds(0)}}]);return t}();a.Segment=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,u){function f(p,t){const w=Math.max(p.compared.sourceZoom,p.compared.targetZoom);p=p.source.zoomAtPixelsPerPan(p.desiredPixelFlow/p.compared.pan)/2;return p<w?null!=t.maximumDistance?w+(t.maximumDistance-w)/2:1.5*w:t.maximumDistance?Math.min(t.maximumDistance,p):p}a.optimalDistance=function(p,t){let w=f(p,t);const e={ascensionFactor:null!=t.ascensionFactor?t.ascensionFactor:.5,descensionFactor:null!=t.descensionFactor?t.descensionFactor:.5};var n=0===e.ascensionFactor,b=
0===e.descensionFactor;const h=n?u.tAscensionZoomOnly:u.tAscensionZoomPan,k=n?u.dtAscensionZoomOnly:u.dtAscensionZoomPan,l=n?u.ddtAscensionZoomOnly:u.ddtAscensionZoomPan,m=b?u.tDescensionZoomOnly:u.tDescensionZoomPan,z=b?u.dtDescensionZoomOnly:u.dtDescensionZoomPan,r=b?u.ddtDescensionZoomOnly:u.ddtDescensionZoomPan;n=x=>h(p,x,e)+u.tPanion(p,x,e)+m(p,x,e);b=x=>k(p,x,e)+u.dtPanion(p,x,e)+z(p,x,e);const c=x=>l(p,x,e)+u.ddtPanion(p,x,e)+r(p,x,e);let d=n(w);const g=u.tBaseLine(p),A=t.maximumIterations||
20,q=null!=t.maximumDistance?t.maximumDistance:Infinity;for(t=0;t<A;t++){var y=(b(w)+1E-6)/c(w);if(isNaN(y)||w>=q&&0>y){if(!isFinite(q))return null;w=q;d=n(w);break}w-=y;if(w<p.compared.sourceZoom||w<p.compared.targetZoom)return null;y=n(w);if(.005>=Math.abs(y-d)/d)break;d=y}return d>.7*g||w<p.compared.sourceZoom||w<p.compared.targetZoom?null:w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=
function(u,f){return-u.halfWindowSize/(f*f*u.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(u,f,p){const t=f-u.compared.sourceZoom,w=1/t,e=1/f,n=Math.log(u.compared.sourceZoom*e);p=(p.ascensionFactor*Math.LN2*u.compared.pan+u.halfWindowPanAtZoom(t))/u.halfWindowPanAtZoom(1);return u.halfWindowSize*w*(-2*w*e*p+2*w*n+2*e-2*n*p/(t*t)-p/(f*f))/(u.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(u,f){return-u.halfWindowSize/(f*f*u.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=
function(u,f,p){const t=f-u.compared.targetZoom,w=1/t,e=1/f,n=Math.log(f/u.compared.targetZoom);p=(u.halfWindowPanAtZoom(f)+p.descensionFactor*Math.LN2*u.compared.pan-u.halfWindowPanAtZoom(u.compared.targetZoom))/u.halfWindowPanAtZoom(1);return u.halfWindowSize*w*(-2*w*e*p-2*w*n+2*e+2*n*p/(t*t)-p/(f*f))/(u.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(u,f,p){return-2*u.compared.pan*u.halfWindowSize*(p.ascensionFactor+p.descensionFactor-1)/(u.desiredPixelFlow*u.halfWindowPanAtZoom(f*f*f))};a.dtAscensionZoomOnly=
function(u,f){return u.halfWindowSize/(f*u.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(u,f,p){const t=1/f,w=Math.log(u.compared.sourceZoom*t),e=1/u.desiredPixelFlow,n=1/Math.LN2;f-=u.compared.sourceZoom;const b=1/f;p=(p.ascensionFactor*Math.LN2*u.compared.pan+u.halfWindowPanAtZoom(f))/u.halfWindowPanAtZoom(1);return u.halfWindowSize*t*e*n*b*p-u.halfWindowSize*w*e*n*b+u.halfWindowSize*w*e*n*p/(f*f)};a.dtDescensionZoomOnly=function(u,f){return u.halfWindowSize/(f*u.desiredPixelFlow*Math.LN2)};
a.dtDescensionZoomPan=function(u,f,p){const t=Math.log(f/u.compared.targetZoom),w=1/u.desiredPixelFlow,e=1/Math.LN2,n=-f+u.compared.targetZoom,b=1/n;p=(-u.halfWindowPanAtZoom(f)-p.descensionFactor*Math.LN2*u.compared.pan+u.halfWindowPanAtZoom(u.compared.targetZoom))/u.halfWindowPanAtZoom(1);return-u.halfWindowSize*t*w*e*b+u.halfWindowSize*t*w*e*p/(n*n)+u.halfWindowSize*w*e*b*p/f};a.dtPanion=function(u,f,p){return u.compared.pan*u.halfWindowSize*(p.ascensionFactor+p.descensionFactor-1)/(u.desiredPixelFlow*
u.halfWindowPanAtZoom(f*f))};a.tAscensionZoomOnly=function(u,f){return-u.halfWindowSize*Math.log(u.compared.sourceZoom/f)/(u.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(u,f,p){const t=u.halfWindowPanAtZoom(f-u.compared.sourceZoom);return-u.halfWindowSize*(p.ascensionFactor*Math.LN2*u.compared.pan+t)*Math.log(u.compared.sourceZoom/f)/(u.desiredPixelFlow*Math.LN2*t)};a.tBaseLine=function(u){const f=Math.LN2*u.compared.pan,p=u.halfWindowPanAtZoom(u.compared.sourceZoom-u.compared.targetZoom),
t=u.halfWindowSize*Math.log(u.compared.sourceZoom/u.compared.targetZoom)/(u.desiredPixelFlow*Math.LN2*p);return u.compared.sourceZoom<=u.compared.targetZoom?t*(f-p):t*(f+p)};a.tDescensionZoomOnly=function(u,f){return u.halfWindowSize*Math.log(f/u.compared.targetZoom)/(u.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(u,f,p){return u.halfWindowSize*(-u.halfWindowPanAtZoom(f)-p.descensionFactor*Math.LN2*u.compared.pan+u.halfWindowPanAtZoom(u.compared.targetZoom))*Math.log(f/u.compared.targetZoom)/
(u.desiredPixelFlow*Math.LN2*u.halfWindowPanAtZoom(-f+u.compared.targetZoom))};a.tPanion=function(u,f,p){return-u.compared.pan*u.halfWindowSize*(p.ascensionFactor+p.descensionFactor-1)/(u.desiredPixelFlow*u.halfWindowPanAtZoom(f))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.AnimationController=function(z){function r(){return z.apply(this,arguments)||this}u._inheritsLoose(r,z);var c=r.prototype;c.onControllerStart=function(){this.state=m.State.Running;p.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};c.updateStateFromViewAnimation=function(){!p.isSome(this.viewAnimation)||this.state!==m.State.Ready&&this.state!==m.State.Running||(this.viewAnimation.state===
l.State.FINISHED?this.finish():this.viewAnimation.state===l.State.STOPPED&&(this.state=m.State.Stopped))};c.onControllerEnd=function(){p.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===m.State.Finished?this.viewAnimation.finish():this.state===m.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===m.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(t.createAbortError()))};c.finish=function(){this.finishController()};u._createClass(r,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(d){this._asyncResult&&(this._asyncResult.reject(t.createAbortError()),this._asyncResult=null);this.state===m.State.Finished||this.state===m.State.Stopped?this.state===m.State.Finished?d.resolve():d.reject(t.createAbortError()):this._asyncResult=d}}]);return r}(m.CameraController);a.AnimationController=f.__decorate([k.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b,h){a.State=void 0;
(function(k){k.Ready="ready";k.Rejected="rejected";k.Running="running";k.Stopped="stopped";k.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(k){function l(){var z=k.apply(this,arguments)||this;z.state=a.State.Ready;return z}u._inheritsLoose(l,k);var m=l.prototype;m.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};m.finishController=function(){this.state=a.State.Finished};u._createClass(l,[{key:"active",get:function(){return this.state===a.State.Running}},
{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return l}(p);f.__decorate([t.property({readOnly:!0})],a.CameraController.prototype,"active",null);f.__decorate([t.property()],a.CameraController.prototype,"state",void 0);a.CameraController=f.__decorate([h.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){function y(Fa,Ha,ua){const Ba=c.sm4d.get();t.identity(Ba);t.rotate(Ba,Ba,ua[3],k.axis(ua));b.subtract(ka,Fa.eye,Ha);b.transformMat4(ka,ka,Ba);Fa.eye=b.add(ka,ka,Ha);b.subtract(ka,Fa.center,Ha);b.transformMat4(ka,ka,Ba);Fa.center=b.add(ka,ka,Ha);Fa.up=b.transformMat4(ka,Fa.up,Ba)}function x(Fa,Ha){b.set(Ha,0,0,0);for(const ua of Fa)b.add(Ha,Ha,ua);b.scale(Ha,Ha,1/Fa.length)}function D(Fa,Ha,ua,Ba){return Math.sin(Fa/b.length(Ha))*(ua+Ba.radius)}function C(Fa,
Ha,ua,Ba){ua=g.fromScreenAtEye(Ha,ua,Da);if(f.isNone(ua))return!1;z.closestPointOnSilhouette(Fa,ua,S);return z.intersectRay(Fa,ua,Ba)?b.squaredDistance(S,ua.origin)<b.squaredDistance(Ba,ua.origin)?(b.copy(Ba,S),!1):!0:(b.subtract(V,Ha.eye,Ha.center),b.normalize(V,V),m.fromNormalAndOffset(V,-b.dot(b.normalize(V,V),S),Y),m.intersectRay(Y,ua,Ba),!1)}function B(Fa,Ha,ua,Ba,Ea,Ga){b.cross(pa,Fa,Ha);b.subtract(na,Fa,Ha);b.length(Fa)<=Ea||!Ba.aboveGround?(b.cross(ua,na,Ba.eye),Fa=b.dot(Fa,Ha)/(b.length(Fa)*
b.length(Ha)),Ga=Math.cos(u.clamp(d.cyclicalPI.normalize(u.deg2rad(Ga)),0,O)),Ha=-u.acosClamped(Fa)-Math.max(0,b.length(Ha)-Ea)/(Ga*Ea)):(b.subtract(W,Ba.eye,Ba.center),b.cross(ua,na,W),Ha=-b.length(na)/Ea);b.normalize(ua,ua);b.scale(ua,ua,b.length(pa));return Ha}function v(Fa,Ha,ua,Ba){Ba=Math.cos(u.clamp(d.cyclicalPI.normalize(u.deg2rad(Ba)),0,O));Ha=Ha>ua?-(Ha-ua)/(Ba*ua):Ha<-ua?Math.PI-(Ha+ua)/(Ba*ua):u.acosClamped(Ha/ua);return((Fa>ua?-(Fa-ua)/(Ba*ua):Fa<-ua?Math.PI-(Fa+ua)/(Ba*ua):u.acosClamped(Fa/
ua))-Ha)*ua}function E(Fa,Ha,ua,Ba,Ea,Ga,ma,ya,Ma,Ra){Ma=v(Fa[2],Ha[2],ma[3],Ma);Ha=Ra?v(Fa[0],Ha[0],ma[3],180):Ha[0]-Fa[0];Fa=Math.sin(ya)*Ha-Math.cos(ya)*Ma;ya=Math.cos(ya)*Ha+Math.sin(ya)*Ma;b.normalize(ka,Ea);Ea=Ra?Fa/Math.sqrt(Math.abs(ma[3]**2-b.dot(ua,ka)**2)):Fa/ma[3];ua=ya/Math.sqrt(Math.abs(ma[3]**2-b.dot(ua,Ba)**2));e.set(Ga,Ea,ua)}function F(Fa,Ha,ua,Ba,Ea,Ga,ma,ya,Ma,Ra){b.cross(pa,Fa,Ha);l.coordinateSystemFromOneAxisAndNormalVector(Ga.up,Ga.eye,ha,fa,R);l.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ga.eye,ba,ca,da);b.copy(ua,ca);b.copy(Ba,ba);b.normalize(ua,ua);b.scale(ua,ua,b.length(pa));l.vectorCoordinates(Fa,b.normalize(fa,fa),b.normalize(R,R),b.normalize(ha,ha),U);l.vectorCoordinates(Ha,fa,R,ha,Z);E(U,Z,Fa,ba,ca,Ea,ma,ya,Ma,Ra)}function L(Fa,Ha,ua,Ba,Ea,Ga,ma){t.identity(X);t.identity(aa);t.identity(ja);t.rotate(X,X,Ea,Ba);t.rotate(aa,aa,ma,Ga);t.multiply(ja,X,aa);b.subtract(Ha,Fa,ua);b.transformMat4(Ha,Ha,ja);b.add(Ha,Ha,ua)}function N(Fa,Ha,ua,Ba,Ea,Ga){t.identity(X);t.identity(aa);
t.identity(ja);t.rotate(X,X,Ba,ua);t.rotate(aa,aa,Ga,Ea);t.multiply(ja,X,aa);b.subtract(ka,Fa.eye,Ha);b.transformMat4(ka,ka,ja);Fa.eye=b.add(ka,ka,Ha);b.subtract(ka,Fa.center,Ha);b.transformMat4(ka,ka,ja);Fa.center=b.add(ka,ka,Ha);b.subtract(ka,Fa.up,Ha);b.transformMat4(ka,ka,ja);Fa.up=b.add(ka,ka,Ha)}function I(Fa,Ha,ua,Ba,Ea,Ga,ma=M.Pole,ya=M.Angle){Fa=Math.abs(Fa[2])<ua*ma||Math.abs(Ha)>ua;return(Math.abs(Ba)>Math.PI-ya||Math.abs(Ba)<ya)&&Fa&&Ga.aboveGround&&Ea<M.Tilt?!0:!1}function G(Fa,Ha,ua,
Ba,Ea,Ga){Ga?(k.fromPoints(ua,Ba,P),y(Ha,Fa,P)):(ua=B(ua,Ba,xa,Ha,Fa[3],Ea),y(Ha,Fa,k.wrapAxisAngle(xa,ua)))}function K(Fa,Ha,ua,Ba,Ea,Ga,ma){const ya=ma?20:1;b.copy(ia,Ba);ta.copyFrom(Ha);let Ma;for(let Ra=0;Ra<ya&&1E-12<b.squaredDistance(ua,ia);Ra++)if(Ba=b.squaredDistance(ua,ia),F(ua,ia,ca,ba,T,ta,Fa,Ea,Ga,ma),N(ta,Fa,ba,T[1],ca,T[0]),L(ia,ia,Fa,ba,T[1],ca,T[0]),Ma=b.squaredDistance(ua,ia),Ma<Ba||0===Ra)Ha.copyFrom(ta);else break}const H=p.createScreenPointArray();a.NavigationMode=void 0;(function(Fa){Fa[Fa.Vertical=
0]="Vertical";Fa[Fa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const J={Elevation:3E4,Angle:u.deg2rad(6)},M={Pole:.95,Angle:u.deg2rad(18),Tilt:45},O=u.deg2rad(80),Q=h.create(),S=h.create(),V=h.create(),Y=m.create(),W=h.create(),ba=h.create(),ca=h.create(),da=h.create(),ha=h.create(),fa=h.create(),R=h.create(),U=h.create(),Z=h.create(),T=n.create(),P=k.create(),X=w.create(),aa=w.create(),ja=w.create(),ia=h.create(),ka=h.create(),na=h.create(),ta=new q,pa=h.create(),xa=h.create(),
Da={origin:h.create(),direction:h.create()},Ka={origin:h.create(),direction:h.create()};a.PreservingHeadingThreshold=M;a.TiltThresholdPanningSpeed=O;a.VerticalPanTresholds=J;a.applyPanPlanar=function(Fa,Ha,ua){b.subtract(Q,ua,Ha);Fa.eye=b.subtract(ka,Fa.eye,Q);Fa.center=b.subtract(ka,Fa.center,Q)};a.applyPanSphericalDirectRotation=G;a.applyPanSphericalPreserveHeading=K;a.applyRotation=y;a.applyRotationWithTwoAxes=N;a.applyZoomOnSphere=function(Fa,Ha,ua){Ha.getScreenCenter(H);A.intersectScreen(Fa,
Ha,H,ka)&&(Ha.center=ka);Fa=Ha.distance;ua*=Fa;1E-6>Math.abs(Fa-ua)||(ua=b.scale(c.sv3d.get(),Ha.viewForward,ua),Ha.eye=b.subtract(ka,Ha.center,ua))};a.applyZoomToPoint=function(Fa,Ha,ua,Ba){const Ea=c.sv3d.get();ua=1-ua;b.subtract(Ea,Ha,Fa.eye);const Ga=b.length(Ea);let ma=Ga*(1-ua);0<=ua&&ma<Ba&&(ma=Ba,ua=-(ma-Ga)/Ga);1E-6>Math.abs(Ga-ma)||(b.scale(Ea,Ea,ua),Fa.eye=b.add(ka,Fa.eye,Ea),Fa.center=b.lerp(ka,Fa.center,Ha,ua))};a.centroid=x;a.centroidOnSphere=function(Fa,Ha,ua){x(Ha,ua);b.normalize(ua,
ua);b.scale(ua,ua,Fa)};a.decideNavigationMode=function(Fa,Ha,ua,Ba){if(b.length(Fa.eye)-Ba.radius>J.Elevation)return a.NavigationMode.Horizontal;if(!ua)return a.NavigationMode.Vertical;g.fromScreenAtEye(Fa,Ha,Ka);return-u.sign(Fa.relativeElevation)*(.5*Math.PI+r.angle(Fa.eye,Ka.direction))<J.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(Fa,Ha,ua,Ba){return m.intersectRay(Fa,g.fromScreen(Ha,ua,Da),Ba)};a.lengthFromPoints=v;a.normalizeCoordinate=
function(Fa,Ha,ua){ua[0]=Ha[0]/(Fa.fullWidth/Fa.pixelRatio);ua[1]=Ha[1]/(Fa.fullHeight/Fa.pixelRatio);return ua};a.normalizeRotationDelta=function(Fa){for(;Fa>Math.PI;)Fa-=2*Math.PI;for(;Fa<-Math.PI;)Fa+=2*Math.PI;return Fa};a.offSurfaceTiltToEyeTiltGlobal=function(Fa,Ha,ua,Ba){return D(Math.PI/2,Ha,ua,Ba)+(Fa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=D;a.panMotionToRotationMatrix=function(Fa,Ha,ua,Ba,Ea,Ga,ma,ya,Ma){if(I(Fa.center,b.dot(Fa.up,Fa.center),b.length(Fa.center),-d.cyclicalPI.normalize(u.deg2rad(Ga)),
ma,Ha))switch(Fa=-d.cyclicalPI.normalize(u.deg2rad(Ea)),{eye:Ea}=Ha,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ea,ba,ca,da),Ea=ua.translation[0]*Ba.pan,Ga="zoom"===Ma.mode?0:ua.translation[1]*Ba.pan,Ha=Math.max(Math.sqrt(Math.abs(1-b.dot(Ha.center,ba)**2/b.length(Ha.center)**2)),.5),ma=-Math.cos(Fa)*Ga+Math.sin(Fa)*Ea,t.rotate(ya.pan.matrix,ya.pan.matrix,(Math.sin(Fa)*Ga+Math.cos(Fa)*Ea)/Ha,ba),ya.pan.enabled=!0,Ma.mode){case "pan":t.rotate(ya.pan.matrix,ya.pan.matrix,ma,ca);ya.pan.enabled=
!0;break;case "zoom":ya.zoom=-ua.translation[1]*Ba.zoom}else{{const {eye:Ra,viewRight:ea}=Ha;Ha=b.cross(c.sv3d.get(),ea,Ra);Fa=ua.translation[0]*Ba.pan;0!==Fa&&(t.rotate(ya.pan.matrix,ya.pan.matrix,-Fa,Ha),ya.pan.enabled=!0);switch(Ma.mode){case "pan":ua=ua.translation[1]*Ba.pan;0!==ua&&(t.rotate(ya.pan.matrix,ya.pan.matrix,ua,ea),ya.pan.enabled=!0);break;case "zoom":ya.zoom=-ua.translation[1]*Ba.zoom}}}};a.panToPosition=function(Fa,Ha,ua,Ba,Ea,Ga,ma){I(ua,b.dot(Ha.up,ua),Fa[3],-d.cyclicalPI.normalize(u.deg2rad(Ea)),
Ga,Ha,M.Pole,M.Angle)?K(Fa,Ha,ua,Ba,-d.cyclicalPI.normalize(u.deg2rad(Ea)),Ga,ma):G(Fa,Ha,ua,Ba,Ga,ma)};a.pickPointAndInitSphere=function(Fa,Ha,ua,Ba,Ea){const Ga=h.create(),ma=z.create();let ya=!0,Ma=!0;Fa.intersectScreen(ua,Ga)?ma[3]=b.length(Ga):(Ma=!1,ma[3]=Ha.aboveGround?Math.max(b.length(Ha.center),.9*Ea.radius):b.length(Ha.eye)-Ha.relativeElevation,Ba?C(ma,Ha,ua,Ga):ya=A.intersectScreen(ma,Ha,ua,Ga));return{sphere:ma,scenePickPoint:ya?Ga:null,hasGeometryIntersection:Ma}};a.preserveHeadingThreshold=
I;a.rotatePointAroundTwoAxes=L;a.rotationAngleAndAxisDirectRotation=B;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=E;a.rotationFromPointsAroundAxis=function(Fa,Ha,ua){const Ba=c.sv3d.get(),Ea=c.sv3d.get(),Ga=c.sv3d.get();b.copy(Ea,Fa);b.copy(Ga,Ha);Fa=b.dot(Ea,ua);Ha=b.dot(Ga,ua);b.scale(Ba,ua,Fa);b.subtract(Ea,Ea,Ba);b.normalize(Ea,Ea);b.scale(Ba,ua,Ha);b.subtract(Ga,Ga,Ba);b.normalize(Ga,Ga);Fa=b.dot(Ea,Ga);b.cross(Ba,ua,Ea);ua=b.dot(Ga,Ba);return Math.atan2(ua,Fa)};
a.sphereOrPlanePointFromScreenPoint=C;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),function(a,u,f,p,t,w){function e(m=h){return[m[0],m[1],m[2],m[3]]}function n(m,z,r,c,d=e()){d[0]=m;d[1]=z;d[2]=r;d[3]=c;return d}function b(m,z){m[3]=z;return m}const h=[0,0,1,0],k=f.create(),l=f.create();a.UP=h;a.angle=function(m){return m[3]};a.axis=function(m){return m};
a.compose=function(m,z,r=e()){u.setAxisAngle(k,m,m[3]);u.setAxisAngle(l,z,z[3]);u.multiply(k,l,k);return b(r,u.getAxisAngle(r,k))};a.copy=function(m,z=e()){return n(m[0],m[1],m[2],m[3],z)};a.create=e;a.fromAxisAndAngle=function(m,z,r=e()){p.copy(r,m);r[3]=z;return r};a.fromPoints=function(m,z,r=e()){p.cross(r,m,z);p.normalize(r,r);r[3]=t.angle(m,z);return r};a.fromValues=n;a.setAngle=b;a.wrap=function(m,z,r,c){return n(m,z,r,c,w.sv4d.get())};a.wrapAxisAngle=function(m,z){return n(m[0],m[1],m[2],z,
w.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,u,f,p,t,w,e){function n(r){return{operations:r,value:r.create()}}function b(r,c,d=n(r)){d.operations=r;r.copy(c,d.value);return d}function h(r,c,d,g){return r.operations.setAltitudeAt(r.value,c,d,g)}const k=2**50,l=p.create(),
m={operations:null,value:null},z=p.create();a.altitudeAt=function(r,c){return r.operations.altitudeAt(r.value,c)};a.axisAt=function(r,c,d,g){return r.operations.axisAt(r.value,c,d,g)};a.closestPoint=function(r,c,d){return r.operations.closestPoint(r.value,c,d)};a.closestPointOnSilhouette=function(r,c,d){return r.operations.closestPointOnSilhouette(r.value,c,d)};a.coordinateSystemFromOneAxisAndNormalVector=function(r,c,d,g,A){f.copy(d,r);f.copy(z,c);f.normalize(z,z);f.cross(g,z,d);f.cross(A,g,d)};
a.create=function(r){const {value:c,operations:d}=r;return{operations:d,value:d.create(c)}};a.createFromOperations=n;a.createGlobal=function(r){return b(e.sphere,e.fromValues(0,0,0,t.getReferenceEllipsoid(r).radius))};a.createLocal=function(){return b(w.boundedPlane,w.fromValues([0,0,0],[k,0,0],[0,k,0]))};a.distanceToSilhouette=function(r,c){return r.operations.distanceToSilhouette(r.value,c)};a.elevate=function(r,c,d){return r.operations.elevate(r.value,c,d.value)};a.fromValues=b;a.intersectRay=
function(r,c,d){return r.operations.intersectRay(r.value,c,d)};a.intersectRayClosestSilhouette=function(r,c,d){return r.operations.intersectRayClosestSilhouette(r.value,c,d)};a.intersectsRay=function(r,c){return r.operations.intersectRay(r.value,c,null)};a.normalAt=function(r,c,d){return r.operations.axisAt(r.value,c,2,d)};a.setAltitudeAt=h;a.setAltitudeOfTransformation=function(r,c,d,g){c!==g&&u.copy(g,c);f.set(l,g[12],g[13],g[14]);h(r,l,d,l);g[12]=l[0];g[13]=l[1];g[14]=l[2];return g};a.setExtent=
function(r,c,d){r.operations.setExtent(r.value,c,d.value);return d};a.vectorCoordinates=function(r,c,d,g,A){A[0]=f.dot(r,c);A[1]=f.dot(r,d);A[2]=f.dot(r,g);return A};a.wrap=function(r,c){m.operations=r;m.value=c;return m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,u,f,p,t,w,e){function n(h,k,l=w.create()){const m=f.castRenderScreenPointArray3(p.copy(e.sv3d.get(),k));m[2]=0;if(!h.unprojectFromRenderScreen(m,l.origin))return null;k=f.castRenderScreenPointArray3(p.copy(e.sv3d.get(),k));k[2]=1;h=h.unprojectFromRenderScreen(k,e.sv3d.get());if(u.isNone(h))return null;t.subtract(l.direction,h,l.origin);return l}function b(h,k,l=w.create()){t.copy(l.origin,h.eye);k=t.set(e.sv3d.get(),k[0],k[1],1);h=h.unprojectFromRenderScreen(k,e.sv3d.get());if(u.isNone(h))return null;
t.subtract(l.direction,h,l.origin);return l}a.fromRender=n;a.fromRenderAtEye=b;a.fromScreen=function(h,k,l=w.create()){return n(h,h.screenToRender(k,f.castRenderScreenPointArray3(e.sv3d.get())),l)};a.fromScreenAtEye=function(h,k,l=w.create()){return b(h,h.screenToRender(k,f.castRenderScreenPointArray3(e.sv3d.get())),l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere",
"./ray"],function(a,u,f,p){const t=u.create();a.intersectScreen=function(w,e,n,b){e=p.fromScreenAtEye(e,n,t);return f.intersectRay(w,e,b)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../support/featureFlags ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){a.ZoomStepController=function(q){function y(){var D=q.apply(this,arguments)||this;D.zoomLocation=l.create();D.tmpCamera=new c;D.tmpRayDir=l.create();D.tmpCenter=l.create();D.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new c,interactionDirection:null,tiltMode:0};return D}u._inheritsLoose(y,q);var x=y.prototype;x.zoomStep=function(D,C){if(this.active){var B=this.view.state,{interactionStartCamera:v}=this.constraintOptions;
this.animation.finished?v.copyFrom(B.camera):this.animation.cameraAt(1,v);this.tmpCamera.copyFrom(B.camera);B=new d.Intersector(this.view.state.viewingMode);0<D?(this.intersectionHelper.intersectScreenFreePointFallback(C,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,B,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,B,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.copy(this.zoomLocation,this.tmpCamera.center);
D=.6**D;!m.disableContextNavigation()&&(C=this.view._stage.renderView.getMinimalDepthForArea(C[0],C[1],this.view.state.camera,60),B=Math.max(14*Math.abs(this.view.camera.position.z),20),C=C?Math.min(C,B):B)&&(B=l.create(),k.subtract(B,this.zoomLocation,this.tmpCamera.eye),C<k.length(B)&&(k.normalize(B,B),k.add(this.zoomLocation,this.tmpCamera.eye,k.scale(B,B,C))));this.updateCamera(this.tmpCamera,D,this.zoomLocation);this.begin(this.tmpCamera)}};x.animationSettings=function(){return{apex:null,duration:p.Milliseconds(600),
easing:g.outExpo}};x.updateCamera=function(D,C,B){k.subtract(this.tmpRayDir,B,D.eye);const v=k.length(this.tmpRayDir);let E=v*C;1>=C&&4>E&&(E=4,C=E/v);1E-6>Math.abs(v-E)||(k.scale(this.tmpRayDir,this.tmpRayDir,C),D.eye=k.subtract(A,B,this.tmpRayDir),D.center=k.lerp(A,D.center,B,1-C),z.applyAll(this.view,D,this.constraintOptions))};return y}(r.PointToPointAnimationController);a.ZoomStepController=f.__decorate([h.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);
const A=l.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(u,f){if("touch"===u.pointerType)return!1;switch(f){case "primary":return 0===u.button;case "secondary":return 2===u.button;case "tertiary":return 1===u.button}};a.eventMatchesPointerAction=function(u,f){switch(f){case "primary":return"touch"===u.pointerType||0===u.button;case "secondary":return"touch"!==u.pointerType&&
2===u.button;case "tertiary":return"touch"!==u.pointerType&&1===u.button}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,u,f,p,t,w){t=function(e){function n(b,h,k,l){var m=e.call(this,!0)||this;m.view=b;m.pointerAction=h;m.pivot=
k;m.registerIncoming("drag",l,z=>m.handleDrag(z));return m}u._inheritsLoose(n,e);n.prototype.handleDrag=function(b){const h=b.data;if(!(1<h.pointers.size)&&w.eventMatchesMousePointerAction(b.data,this.pointerAction)){var k=f.createScreenPointArray(h.center.x,h.center.y);switch(h.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new p.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(k);break;case "update":this.cameraController&&this.cameraController.update(k);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}b.stopPropagation()}};return n}(t.InputHandler);a.DragRotate=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x){a.RotateController=function(C){function B(E){E=C.call(this,E)||this;E.view=null;E.pivot=0;E.lastPoint=r.create();E.tmpWorldUp=d.create();E.tmpViewDir=d.create();E.tmpRotCurPoint=r.create();E.tmpTransf=m.create();E.tmpAxis=d.create();E.tmpPivotPoint=d.create();E.pivotPos=d.create();E.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return E}u._inheritsLoose(B,
C);var v=B.prototype;v.initialize=function(){this.rotScale=0===this.pivot?3:1.5};v.begin=function(E){if(this.active){switch(this.pivot){case 1:c.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case 0:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||c.copy(this.pivotPos,this.startCamera.center),p("disable-feature:context-navigation")||this.constrainPivotPoint(E),
this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.startCamera;x.normalizeCoordinate(this.startCamera,E,this.lastPoint)}};v.constrainPivotPoint=function(E){const F=this.startCamera,L=d.create();c.subtract(L,this.pivotPos,F.eye);let N=c.length(L);this.view.camera.position.hasZ&&(N=Math.min(N,7*Math.abs(this.view.camera.position.z)));var I=g.getReferenceEllipsoid(this.view.spatialReference),
G=w.createScreenPointArray(F.width/F.pixelRatio*.5,F.height/F.pixelRatio*.5);I=x.decideNavigationMode(this.startCamera,G,!0,I);G=this.view._stage.renderView.getMinimalDepthForArea(F.fullWidth/F.pixelRatio*.5,F.fullHeight/F.pixelRatio*.5,F,225,90);E=this.view._stage.renderView.getMinimalDepthForArea(E[0],E[1],F,90);if(void 0!==G||void 0!==E)G=void 0===G?E:G,E=void 0===E||I===x.NavigationMode.Horizontal?G:E,N=G>E?E:G;c.normalize(L,L);c.copy(this.pivotPos,c.add(this.tmpPivotPoint,F.eye,c.scale(this.tmpPivotPoint,
L,N)))};v.update=function(E){if(this.active){switch(this.pivot){case 1:this.currentCamera.center=this.applyRotation(this.currentCamera,E,this.currentCamera.center,this.pivotPos);break;case 0:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this.applyRotation(this.currentCamera,E,this.currentCamera.eye,this.pivotPos)}A.applyAll(this.view,this.currentCamera,this.constraintOptions)}};v.end=function(){this.active&&this.finishController()};v.applyRotation=function(E,F,L,N){this.view.renderCoordsHelper.worldUpAtPosition(N,
this.tmpWorldUp);x.normalizeCoordinate(E,F,this.tmpRotCurPoint);F=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let I=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;c.subtract(this.tmpViewDir,L,N);L=c.length(this.tmpViewDir);L=t.acosClamped(c.dot(this.tmpViewDir,this.tmpWorldUp)/L);if(1===this.pivot){const G=.5*Math.PI-L,K=.495*Math.PI;F=G-Math.max(-K,Math.min(K,G+-.5*F))}F=t.clamp(F+L,q.TiltDefault.min,q.TiltDefault.max)-L;l.identity(this.tmpTransf);c.cross(this.tmpAxis,E.up,
this.tmpViewDir);0===this.pivot&&(I=-I);l.rotate(this.tmpTransf,this.tmpTransf,I,this.tmpWorldUp);l.rotate(this.tmpTransf,this.tmpTransf,F,this.tmpAxis);c.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);E.up=c.transformMat4(D,E.up,this.tmpTransf);c.add(D,N,this.tmpViewDir);z.copy(this.lastPoint,this.tmpRotCurPoint);return D};u._createClass(B,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return B}(y.InteractiveController);f.__decorate([e.property({constructOnly:!0})],
a.RotateController.prototype,"view",void 0);f.__decorate([e.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=f.__decorate([k.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const D=d.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){a.InteractiveController=function(l){function m(){var r=l.apply(this,arguments)||this;r.startCamera=new k;r.currentCamera=new k;return r}u._inheritsLoose(m,l);var z=m.prototype;z.stepController=function(r,c){c.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(c)};z.onControllerStart=function(r){this.state=h.State.Running;this.startCamera.copyFrom(r);this.currentCamera.copyFrom(r)};z.onControllerEnd=function(r){r.copyViewFrom(this.currentCamera)};u._createClass(m,
[{key:"isInteractive",get:function(){return!0}}]);return m}(h.CameraController);a.InteractiveController=f.__decorate([b.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,u,f,p,t,w,e){w=function(n){function b(h,k,l){var m=n.call(this,!0)||this;m.view=h;m.pointerAction=k;m.registerIncoming("drag",l,z=>m.handleDrag(z));return m}u._inheritsLoose(b,n);b.prototype.handleDrag=function(h){const k=h.data;if(!(1<k.pointers.size)&&e.eventMatchesMousePointerAction(h.data,this.pointerAction)){var l=f.createScreenPointArray(k.center.x,k.center.y);switch(k.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new p.ZoomController({view:this.view}):new t.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(l);break;case "update":this.cameraController&&this.cameraController.update(l);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}h.stopPropagation()}};return b}(w.InputHandler);a.DragZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x){a.ZoomController=function(C){function B(E){E=C.call(this,E)||this;E.view=null;E.pickPoint=z.create();E.tmpP0=l.create();E.panAxisAngle=c.create();E.tmpRayDir=z.create();E.targetOnSphere=z.create();E.tmpRay={origin:z.create(),direction:z.create()};E.dragBeginPoint=t.createScreenPointArray();E.normalizedAnchorPoint=l.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};E.sphere=d.create();E.hasPickPoint=!1;return E}u._inheritsLoose(B,C);var v=B.prototype;v.begin=function(E){if(this.active){k.copy(this.dragBeginPoint,E);q.normalizeCoordinate(this.startCamera,E,this.normalizedAnchorPoint);var F=r.getReferenceEllipsoid(this.view.spatialReference),L=q.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,E,!1,F);this.navMode=q.decideNavigationMode(this.startCamera,E,L.hasGeometryIntersection,F);if(this.navMode===q.NavigationMode.Horizontal||p("disable-feature:context-navigation"))this.hasPickPoint=
!!L.scenePickPoint,this.pickPoint=L.scenePickPoint,this.sphere=L.sphere;else{y.fromScreenAtEye(this.startCamera,E,this.tmpRay);m.normalize(this.tmpRay.direction,this.tmpRay.direction);let N;this.view.camera.position.hasZ&&(N=Math.abs(this.view.camera.position.z));F=30*N;E=this.view._stage.renderView.getMinimalDepthForArea(E[0],E[1],this.view.state.camera,70);F=F>E?E:F;this.hasPickPoint=!0;m.scale(this.tmpRay.direction,this.tmpRay.direction,F);m.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=
this.startCamera}};v.update=function(E){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===q.NavigationMode.Horizontal||p("disable-feature:context-navigation")){m.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var F=m.length(this.tmpRayDir);q.normalizeCoordinate(this.currentCamera,E,this.tmpP0);var L=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),N=F*
2**L;const I=this.view.state.constraints.minimumPoiDistance;0>L&&N<I&&(N=I);if(1E-6>Math.abs(F-N))return;this.hasPickPoint&&N<F&&(L=1-(1-N/F)*(1-this.sphere[3]/m.length(this.currentCamera.center)),this.currentCamera.center=m.scale(D,this.currentCamera.center,L));m.scale(this.tmpRayDir,this.tmpRayDir,-N/F);this.currentCamera.eye=m.add(D,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.dragBeginPoint,E);g.applyAll(this.view,this.currentCamera,
this.constraintOptions);this.hasPickPoint&&(q.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),c.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),q.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{F=m.length(this.tmpRay.direction);q.normalizeCoordinate(this.currentCamera,E,this.tmpP0);E=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);N=F*2**E;L=this.view.state.constraints.minimumPoiDistance;0>E&&N<L&&(N=
L);if(1E-6>Math.abs(F-N))return;m.scale(this.tmpRayDir,this.tmpRay.direction,1-N/F);this.currentCamera.eye=m.add(D,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=m.add(D,this.currentCamera.center,this.tmpRayDir)}x.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};v.end=function(){this.active&&this.finishController()};u._createClass(B,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return B}(A.InteractiveController);f.__decorate([w.property({constructOnly:!0})],
a.ZoomController.prototype,"view",void 0);a.ZoomController=f.__decorate([h.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const D=z.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A){a.ZoomController=function(y){function x(C){C=y.call(this,C)||this;C.view=null;C.tmpP=r.create();C.tmpDir=r.create();C.tmpN=r.create();C.tmpP0=m.create();C.tmpPoi=r.create();C.tmpRayDir=r.create();C.dragBeginPoint=t.createScreenPointArray();C.normalizedAnchorPoint=m.create();C.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:r.create(),tiltMode:0};C.plane=c.create();return C}u._inheritsLoose(x,
y);var D=x.prototype;D.begin=function(C){if(this.active){l.copy(this.dragBeginPoint,C);A.normalizeCoordinate(this.startCamera,C,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(C,this.tmpP);z.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);z.normalize(this.tmpDir,this.tmpDir);var B;this.view.camera.position.hasZ&&(B=Math.abs(this.view.camera.position.z));B*=30;C=this.view._stage.renderView.getMinimalDepthForArea(C[0],C[1],this.view.state.camera,70);z.scale(this.tmpDir,
this.tmpDir,B>C?C:B);z.add(this.tmpP,this.startCamera.eye,this.tmpDir);z.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);z.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&z.negate(this.tmpN,this.tmpN);c.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.startCamera}};D.update=function(C){if(this.active){A.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||z.copy(this.tmpPoi,this.currentCamera.center);
A.normalizeCoordinate(this.currentCamera,C,this.tmpP0);var B=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);l.copy(this.normalizedAnchorPoint,this.tmpP0);z.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var v=z.length(this.tmpRayDir),E=v*(1-B);z.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);z.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,p.sign(B)/v);var F=this.view.state.constraints.minimumPoiDistance;0<=B&&E<F&&(E=
F,B=-(E-v)/v);1E-6>Math.abs(v-E)||(z.scale(this.tmpRayDir,this.tmpRayDir,B),this.currentCamera.eye=z.add(q,this.currentCamera.eye,this.tmpRayDir),z.lerp(q,this.currentCamera.center,this.tmpPoi,B),q[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],q[2]):Math.min(this.startCamera.center[2],q[2]),this.currentCamera.center=q,this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(this.dragBeginPoint,C),d.applyAll(this.view,this.currentCamera,this.constraintOptions))}};
D.end=function(){this.active&&this.finishController()};u._createClass(x,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return x}(g.InteractiveController);f.__decorate([w.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=f.__decorate([k.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const q=r.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,u,f,p,t,w){w=function(e){function n(h){var k=e.call(this,!0)||this;k.view=h;k.watchHandles=new f;k.handle=k.registerIncoming("gamepad",l=>k.handleEventGamepad(l));k.handle.pause();return k}u._inheritsLoose(n,e);var b=n.prototype;b.onInstall=function(h){e.prototype.onInstall.call(this,h);this.watchHandles.add([p.init(this.view.navigation.gamepad,"enabled",k=>{k?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=
null))}),this.view.navigation.gamepad.watch("device",k=>{this.cameraControllerGamepad&&k&&this.cameraControllerGamepad.gamepadDevice!==k&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};b.onUninstall=function(){this.watchHandles.removeAll();e.prototype.onUninstall.call(this)};b.handleEventGamepad=function(h){var k=this.view.navigation.gamepad.device;if(!k||h.data.device===k)if((k=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||t.GamepadKeyboardController.activatesFor(this.view,
h.data))k||(k=new t.GamepadKeyboardController({view:this.view,gamepadDevice:h.data.device}),this.view.state.switchCameraController(k)&&(this.cameraControllerGamepad=k)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===h.data.device&&this.cameraControllerGamepad.handleEventGamepad(h.data)};return n}(w.InputHandler);a.GamepadNavigation=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L){a.GamepadKeyboardController=function(Q){function S(Y){Y=Q.call(this,Y)||this;Y.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};Y.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];Y.tmpCamera=new F;Y.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new F,interactionFactor:0,interactionDirection:null,tiltMode:1};return Y}u._inheritsLoose(S,Q);var V=S.prototype;V.handleEventGamepad=function(Y){const W=L.extractTransformation(Y,
this.view.navigation.gamepad,this.transformation);("end"===Y.action||L.isZeroTransformation(W))&&this.finishController()};V.activateDirection=function(Y){this.keysButtonState[Y]=1;L.extractTransformationKeyboard(this.keysButtonState,this.transformation)};V.deactivateDirection=function(Y){this.keysButtonState[Y]=0;Y=L.extractTransformationKeyboard(this.keysButtonState,this.transformation);L.isZeroTransformation(Y)&&this.finishController()};V.onControllerStart=function(Y){this.filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;Q.prototype.onControllerStart.call(this,Y)};V.updateFilteredSurfaceElevation=function(Y){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*Y};V.stepController=function(Y,W){this.updateStartHeading();this.updateFilteredSurfaceElevation(Y);this.currentCamera.copyViewFrom(W);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);
this.calculateControlTransformation(Y,this.currentCamera,H);this.applyDisabledMovementTypes(H);this.applyPan(H.pan);this.applyRotate(H.rotate);this.applyZoom(H.zoom);this.applyAscend(H.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;y.applyAll(this.view,this.currentCamera,this.constraintOptions);Q.prototype.stepController.call(this,Y,W)};V.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};V.applyRotate=
function(Y){if(Y.enabled){var W=this.currentCamera;r.subtract(J,W.center,W.eye);r.transformMat4(J,J,Y.matrix);W.center=r.add(J,J,W.eye);W.up=r.transformMat4(J,W.up,Y.matrix);this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;y.applyAll(this.view,W,this.constraintOptions)}};V.applyPan=function(Y,W=this.currentCamera){Y.enabled&&(W.eye=r.transformMat4(J,W.eye,Y.matrix),W.center=r.transformMat4(J,W.center,Y.matrix),this.view.state.isGlobal&&(W.up=r.transformMat4(J,W.up,Y.matrix)),
this.constraintOptions.interactionType=4,this.constraintOptions.selection=15,y.applyAll(this.view,W,this.constraintOptions))};V.applyZoom=function(Y){if(Y){var W=this.currentCamera.viewForward;this.currentCamera.eye=r.add(J,this.currentCamera.eye,r.scale(q.sv3d.get(),W,Y));r.copy(M,W);r.negate(M,M);this.constraintOptions.interactionDirection=M;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;y.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=
null}};V.applyAscend=function(Y){if(Y){var W=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,q.sv3d.get());this.constraintOptions.interactionDirection=r.copy(M,W);this.view.state.isGlobal?(W=r.length(this.currentCamera.eye),Y=(W+Y)/W,this.currentCamera.eye=r.scale(J,this.currentCamera.eye,Y),this.currentCamera.center=r.scale(J,this.currentCamera.center,Y)):(Y=r.scale(q.sv3d.get(),W,Y),this.currentCamera.eye=r.add(J,this.currentCamera.eye,Y),this.currentCamera.center=r.add(J,
this.currentCamera.center,Y));this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;y.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;y.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};V.calculateControlTransformation=function(Y,W,ba){ba.zoom=0;ba.ascend=0;ba.pan.enabled=!1;m.identity(ba.pan.matrix);ba.rotate.enabled=
!1;m.identity(ba.rotate.matrix);Y=this.computeVelocities(Y);this.view.state.isLocal?this.calculateControlTransformationLocal(Y,W,ba):this.calculateControlTransformationGlobal(Y,W,ba)};V.updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,J)};V.calculateControlTransformationLocal=function(Y,W,ba){const {viewRight:ca,viewForward:da}=W,
ha=this.transformation;var fa=this.view.navigation.gamepad,R=r.set(q.sv3d.get(),da[0],da[1],0);r.normalize(R,R);var U=ha.translation[0]*Y.pan;0!==U&&(U=r.scale(q.sv3d.get(),ca,U),m.translate(ba.pan.matrix,ba.pan.matrix,U),ba.pan.enabled=!0);switch(fa.mode){case "pan":fa=-ha.translation[1]*Y.pan;0!==fa&&(R=r.scale(q.sv3d.get(),R,fa),m.translate(ba.pan.matrix,ba.pan.matrix,R),ba.pan.enabled=!0);ba.zoom=ha.zoom*Y.zoom;break;case "zoom":ba.zoom=(-ha.translation[1]+ha.zoom)*Y.zoom;break;default:p.neverReached(fa.mode)}ba.ascend=
ha.translation[2]*Y.ascend;R=-ha.heading*Y.rotate;0!==R&&(m.rotate(ba.rotate.matrix,ba.rotate.matrix,R,this.view.renderCoordsHelper.worldUpAtPosition(W.eye,q.sv3d.get())),ba.rotate.enabled=!0);Y=ha.tilt*Y.rotate;W=B.viewAngle(this.view.renderCoordsHelper,W.center,W.eye);if(W=t.clamp(W+Y,x.TiltDefault.min,x.TiltDefault.max)-W)m.rotate(ba.rotate.matrix,ba.rotate.matrix,W,ca),ba.rotate.enabled=!0};V.calculateControlTransformationGlobal=function(Y,W,ba){const {eye:ca,viewRight:da}=W,ha=this.transformation;
var fa=this.view.navigation.gamepad,R=r.cross(q.sv3d.get(),da,ca);r.normalize(R,R);r.negate(R,R);C.panMotionToRotationMatrix(this.startCamera,W,ha,Y,this.view.camera.heading,this.headingStart,this.view.camera.tilt,ba,fa);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(H.pan,this.tmpCamera);fa=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;ba.ascend=ha.translation[2]*Y.ascend;R=-ha.heading*Y.rotate;0!==R&&(m.rotate(ba.rotate.matrix,ba.rotate.matrix,R,this.tmpCamera.eye),
ba.rotate.enabled=!0);W=this.clampTiltDeltaGlobalToValidRange(ha.tilt*Y.rotate,W.ray,fa);0!==W&&(m.rotate(ba.rotate.matrix,ba.rotate.matrix,W,this.tmpCamera.viewRight),ba.rotate.enabled=!0);ba.zoom+=ha.zoom*Y.zoom};V.clampTiltDeltaGlobalToValidRange=function(Y,W,ba){const ca=d.getReferenceEllipsoid(this.view.spatialReference),da=C.onSurfaceTiltToEyeTiltGlobal(x.TiltDefault.min,W.origin,ba,ca);var ha=0;let fa=0;ha=q.sv3d.get();this.view.renderCoordsHelper.intersectManifold(W,ba,ha)?(ha=B.viewAngle(this.view.renderCoordsHelper,
ha,W.origin),ha=C.onSurfaceTiltToEyeTiltGlobal(ha,W.origin,ba,ca),fa=C.onSurfaceTiltToEyeTiltGlobal(x.TiltDefault.max,W.origin,ba,ca)):(A.closestPointOnSilhouette(A.fromRadius(ba+ca.radius),W,ha),ha=t.acosClamped(-r.dot(W.direction,r.normalize(ha,ha))),ha=C.offSurfaceTiltToEyeTiltGlobal(ha,W.origin,ba,ca),fa=C.offSurfaceTiltToEyeTiltGlobal(x.TiltDefault.max,W.origin,ba,ca));return t.clamp(ha+Y,da,fa)-ha};V.getPointAbsoluteSurfaceElevation=function(Y,W,ba){const {renderCoordsHelper:ca}=this.view,da=
ca.getAltitude(Y);W+=Math.abs(da-W);ca.setAltitude(ba,W,Y);return W};V.clampedDistanceToSurface=function(Y,W){const {renderCoordsHelper:ba}=this.view,{camera:ca}=this.view.state;var {direction:da}=v.headingTiltToDirectionUp(this.view,W,0,80,O);da=ba.intersectManifoldClosestSilhouette(g.wrap(W,da),Y,q.sv3d.get());da=r.distance(W,da);Y=ba.intersectManifoldClosestSilhouette(g.wrap(W,r.direction(q.sv3d.get(),W,ca.center)),Y,q.sv3d.get());W=r.distance(W,Y);return Math.min(da,W)};V.computeHeadingRotateRadius=
function(Y){const {renderCoordsHelper:W,state:ba}=this.view,{camera:ca,isGlobal:da}=ba;var ha=W.intersectManifoldClosestSilhouette(ca.ray,this.filteredSurfaceElevation,q.sv3d.get());if(da){const fa=r.subtract(q.sv3d.get(),Y,ha);ha=r.length(fa);r.scale(fa,fa,1/ha);Y=r.normalize(q.sv3d.get(),Y);Y=t.acosClamped(r.dot(Y,fa));return ha*Math.sin(Math.min(I,Y))}Y=r.copy(q.sv3d.get(),Y);W.setAltitude(Y,this.filteredSurfaceElevation);return r.distance(ha,Y)};V.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?
0:5};V.computeVelocities=function(Y){var W=this.filteredSurfaceElevation,ba=W+d.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:ca,isGlobal:da}=this.view.state;var ha=q.sv3d.get();const fa=this.getPointAbsoluteSurfaceElevation(ca.eye,W,ha);var R=this.clampedDistanceToSurface(W,ha);const U=ca.width/2,Z=.75*ca.width,T=.75*ca.width;var P=R*Math.tan(.5*ca.fovX)/U;ba=P/ba;ha=P/this.computeHeadingRotateRadius(ha);P=(da?ba:P)*Z*Y;W=fa-W;W=Math.max(this.minimumAscendVelocity()*Y,2**
(Z*Y/U)*W-W);R=2**(Z*Y/U)*R-R;Y*=t.clamp(ha*T,G,K);return{pan:P,ascend:W,zoom:R,rotate:Y}};V.applyDisabledMovementTypes=function(Y){!w.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(Y.zoom=this.disableMovements.zoom?0:Y.zoom,Y.ascend=this.disableMovements.ascend?0:Y.ascend,Y.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&m.identity(Y.pan.matrix),Y.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&
m.identity(Y.rotate.matrix))};S.activatesFor=function(Y,W){Y=L.extractTransformation(W,Y.navigation.gamepad,N);return!("end"===W.action||L.isZeroTransformation(Y))};return S}(D.InteractiveController);f.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);f.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);f.__decorate([e.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",
void 0);a.GamepadKeyboardController=f.__decorate([l.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const N={translation:[0,0,0],heading:0,tilt:0,zoom:0},I=t.deg2rad(80),G=t.deg2rad(30),K=t.deg2rad(80),H={zoom:0,ascend:0,pan:{enabled:!1,matrix:z.create()},rotate:{enabled:!1,matrix:z.create()}},J=c.create(),M=c.create(),O=E.createDirectionUp();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ../../support/spatialReferenceSupport".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){function x(fa){return"global"===fa.viewingMode?d.cameraUtilsSpherical:c.cameraUtilsPlanar}function D(fa,R,U){const Z=fa.state.camera,T=Z.width/2/Z.pixelRatio;1===fa.renderCoordsHelper.viewingMode&&null!=U&&(R*=Math.cos(t.deg2rad(U)));R/=fa.renderCoordsHelper.unitInMeters;return T/(96*39.37/R)/Math.tan(Z.fovX/2)}function C(fa,R,U){const Z=fa.state.camera;R=96*39.37/(Z.width/2/Z.pixelRatio/(R*Math.tan(Z.fovX/2)));1===fa.renderCoordsHelper.viewingMode&&
(R/=Math.cos(t.deg2rad(U)));return R*=fa.renderCoordsHelper.unitInMeters}function B(fa,R,U,Z,T,P){if(O(P)){const X=new ha(P.signal);K(fa,Z.heading,Z.tilt,R,U,T,X);X.resolver.promise.then(aa=>{aa=M(fa,aa,Z.fov);if(w.isNone(aa))P.resolver.reject();else return P.resolver.resolve(aa)},aa=>P.resolver.reject(aa))}else return R=K(fa,Z.heading,Z.tilt,R,U,T),M(fa,R,Z.fov,P)}function v(fa,R,U,Z,T){return x(fa).directionToHeadingTilt(R,U,Z,T)}function E(fa,R){return!!(fa.basemapTerrain&&fa.renderCoordsHelper.fromRenderCoords(R,
W,fa.spatialReference)&&w.unwrapOr(A.getElevationAtPoint(fa.elevationProvider,W),0)>W.z-1)}function F(fa,R,U){return L.apply(this,arguments)}function L(){L=u._asyncToGenerator(function*(fa,R,U){if(!fa.renderCoordsHelper.fromRenderCoords(R,W,fa.spatialReference))return!1;fa=yield fa.elevationProvider.queryElevation(W.x,W.y,W.z,W.spatialReference,"ground",U);return w.unwrapOr(fa,0)>W.z-1});return L.apply(this,arguments)}function N(fa,R,U){return I.apply(this,arguments)}function I(){I=u._asyncToGenerator(function*(fa,
R,U){const Z=b.create();R?R instanceof h?(k.projectPointToVector(R,Z,fa.renderSpatialReference),null==R.z&&null!=fa.basemapTerrain&&(R=yield fa.elevationProvider.queryElevation(R.x,R.y,R.z,R.spatialReference,"ground",U),w.isSome(R)&&fa.renderCoordsHelper.setAltitude(Z,R))):n.copy(Z,R):n.copy(Z,fa.state.camera.center);return Z});return I.apply(this,arguments)}function G(fa,R){const U=b.create();R&&R instanceof h?(k.projectPointToVector(R,U,fa.renderSpatialReference),null==R.z&&null!=fa.basemapTerrain&&
(R=A.getElevationAtPoint(fa.elevationProvider,R),w.isSome(R)&&fa.renderCoordsHelper.setAltitude(U,R))):R?n.copy(U,R):n.copy(U,fa.state.camera.center);return U}function K(fa,R,U,Z,T,P,X){const aa=Z&&Z instanceof h?Z:null;if(O(X))return N(fa,Z,X.signal).then(ja=>{H(fa,R,U,aa,ja,T,P,X)},ja=>X.resolver.reject(ja)),null;Z=G(fa,Z);return H(fa,R,U,aa,Z,T,P,X)}function H(fa,R,U,Z,T,P,X,aa){if(w.isNone(Z)&&(Z=k.projectVectorToPoint(T,fa.renderSpatialReference,fa.spatialReference||m.WGS84),w.isNone(Z)))return null;
P=Math.max(P,fa.state.constraints.minimumPoiDistance);var ja=J(fa,R,U,T,P,X);const ia=x(fa).eyeForCenterWithHeadingTilt,ka=ia(T,P,ja.heading,ja.tilt);if(1===X&&"global"===fa.viewingMode&&0<U){const na=()=>{var ta=P,pa=P;var xa=fa.state.constraints.tilt(pa);pa=x(fa).eyeTiltToLookAtTilt(U,T,pa);pa=Math.min(pa,.5*Math.PI);xa=xa.min*(1-.7)+.7*pa;ta=x(fa).lookAtTiltToEyeTilt(xa,T,ta);X=1>U-ta?0:1;return H(fa,R,ta,Z,T,P,X,aa)};ja=fa.map.ground.navigationConstraint;if(!ja||"stay-above"===ja.type){if(E(fa,
ka.eye))return na();if(O(aa))return F(fa,ka.eye,aa.signal).then(ta=>{if(ta)return na();aa.resolver.resolve({eye:ka.eye,up:ka.up,center:b.clone(T),heading:ka.heading,tilt:ka.tilt});return null}),null}}ja=!aa||O(aa)?{center:b.create(),eye:b.create(),up:b.create(),tilt:0,heading:0}:aa;ja.eye=ka.eye;ja.up=ka.up;ja.center=b.clone(T);ja.heading=ka.heading;ja.tilt=ka.tilt;O(aa)&&aa.resolver.resolve(ja);return ja}function J(fa,R,U,Z,T,P){var X=0;if(P=1===P)if(X=fa.pointsOfInterest.centerOnSurfaceFrequent.distance,
8<Math.log(T/X)/Math.LN2)P=!0;else{var aa=fa.renderSpatialReference,ja=fa.spatialReference||m.WGS84;P=k.projectVectorToPoint(Z,aa,ja);aa=k.projectVectorToPoint(fa.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,aa,ja);w.isNone(P)||w.isNone(aa)?P=!1:(X*=Math.tan(.5*fa.state.camera.fov),P=5<aa.distance(P)/X)}P?(R=0,P=fa.state.constraints.tilt(T),P.max=Math.min(P.max,.5*Math.PI),P=P.min*(1-.7)+.7*P.max,U=x(fa).eyeTiltToLookAtTilt(U,Z,T),X=Math.min(U,P)):X=x(fa).eyeTiltToLookAtTilt(U,Z,T);U=X=
fa.state.constraints.clampTilt(T,X);U=x(fa).lookAtTiltToEyeTilt(U,Z,T);return{heading:R,tilt:U}}function M(fa,R,U,Z){if(w.isNone(R))return null;fa=k.projectVectorToPoint(R.eye,fa.renderSpatialReference,fa.spatialReference||m.WGS84);return w.isNone(fa)?null:w.isSome(Z)?(Z.position=fa,Z.heading=R.heading,Z.tilt=R.tilt,Z.fov=U,Z):new f(fa,R.heading,R.tilt,U)}function O(fa){return fa&&"resolver"in fa}const Q=p.getLogger("esri.views.3d.support.cameraUtils"),S=b.create(),V=b.create(),Y={heading:0,tilt:0},
W=new h,ba=new q.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ca=new q.Cyclical(-180,180),da=b.create();let ha=function(fa){this.signal=fa;this.resolver=e.createResolver()};a.AsyncContext=ha;a.computeScale=function(fa,R,U){const Z=fa.renderSpatialReference;R||(R=fa.state.camera);var T=m.WGS84;R instanceof f?(T=R.position.latitude,k.projectPointToVector(R.position,S,Z),k.projectPointToVector(U,V,Z),R=n.distance(S,V)):(k.projectVectorToVector(R.center,Z,V,T),T=V[1],R=R.distance);return C(fa,
R,T)};a.directionToHeadingTilt=v;a.distanceToScale=C;a.externalToInternal=function(fa,R){if(w.isNone(R))return null;var U=fa.renderSpatialReference;const Z=x(fa).headingTiltToDirectionUp,T=b.create();if(!k.projectPointToVector(R.position,T,U))return null;U=Z(T,R.heading,R.tilt);n.scale(U.direction,U.direction,fa.state.camera.distance);n.add(U.direction,U.direction,T);fa=r.cameraOnContentAlongViewDirection(fa,T,U.direction,U.up);fa.fov=t.deg2rad(R.fov);return fa};a.fromCenterDistance=B;a.fromCenterScale=
function(fa,R,U,Z,T,P){U=D(fa,U,R.latitude);return B(fa,R,U,Z,T,P)};a.fromExtent=function(fa,R,U,Z,T,P=null){let X;var aa=0;null!=R.zmax&&null!=R.zmin&&(X=(R.zmax+R.zmin)/2,aa=R.zmax-R.zmin);if("global"===fa.viewingMode){if(!y.isSpatialReferenceSupported(R.spatialReference,"global"))return O(P)&&P.resolver.reject(),null;var ja=new h(R.xmin,R.ymin,R.spatialReference);const ta=new h(R.xmax,R.ymax,R.spatialReference),pa=R.spatialReference.isGeographic?ca:ba;var ia=new h(pa.center(ja.x,ta.x),(ta.y+ja.y)/
2,R.spatialReference);null!=X&&(ia.z=X);R=l.getReferenceEllipsoid(R.spatialReference);var ka=g.getGreatCircleSpanAt(ia,ja,ta);var na=ka.lon;ka=ka.lat;pa.diff(ja.x,ta.x)>pa.range/2&&(na+=R.halfCircumference);na=Math.min(na,R.halfCircumference);ka=Math.min(ka,R.halfCircumference)}else ia=fa.spatialReference||m.WGS84,na=R.xmax-R.xmin,ka=R.ymax-R.ymin,ia=new h({x:R.xmin+.5*na,y:R.ymin+.5*ka,z:X,spatialReference:ia});ja=fa.state.camera;aa=Math.max(1/Math.tan(ja.fovX/2)*na*.5,1/Math.tan(ja.fovY/2)*ka*.5,
1/Math.tan(ja.fov/2)*aa*.5)/1;if(O(P))na=new ha(P.signal),K(fa,U,Z,ia,aa,T,na),na.resolver.promise.then(ta=>{ta=M(fa,ta,fa.camera.fov);if(w.isNone(ta))P.resolver.reject();else return P.resolver.resolve(ta)},ta=>P.resolver.reject(ta));else return U=K(fa,U,Z,ia,aa,T),M(fa,U,fa.camera.fov,P)};a.getObserverForPointAtDistance=K;a.headingTiltToDirectionUp=function(fa,R,U,Z,T){return x(fa).headingTiltToDirectionUp(R,U,Z,T)};a.internalToExternal=function(fa,R,U){const Z=fa.renderSpatialReference,T=v(fa,R.eye,
R.viewForward,R.up,Y);fa=fa.spatialReference||m.WGS84;k.projectVectorToVector(R.eye,Z,da,fa)||(fa=m.WGS84,k.projectVectorToVector(R.eye,Z,da,fa));if(w.isNone(U))return new f(new h(da,fa),T.heading,T.tilt,t.rad2deg(R.fov));U.position.x=da[0];U.position.y=da[1];U.position.z=da[2];U.position.spatialReference=fa;U.heading=T.heading;U.tilt=T.tilt;U.fov=t.rad2deg(R.fov);return U};a.observerToCamera=M;a.scaleToDistance=D;a.scaleToResolution=function(fa,R){return fa.spatialReference?z.getResolutionForScale(R,
fa.spatialReference):void 0};a.scaleToZoom=function(fa,R){var U;if(fa=null==(U=fa.basemapTerrain)?void 0:U.tilingScheme)return fa.levelAtScale(R);Q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(fa,R,U){const Z=k.projectVectorToPoint(U,fa.renderSpatialReference,fa.spatialReference||m.WGS84);if(w.isNone(Z))return null;var T=Math.tan(R.fovX/2),P=Math.tan(R.fovY/2);R=n.dist(R.eye,U);T*=2*R;P*=2*R;return"global"===fa.viewingMode?d.toExtent(fa,Z,T,
P):c.toExtent(fa,Z,T,P)};a.zoomToScale=function(fa,R){var U;if(fa=null==(U=fa.basemapTerrain)?void 0:U.tilingScheme)return fa.scaleAtLevel(R);Q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,u,f,p,t,
w,e,n,b){function h(y,x,D,C=b.createDirectionUp()){f.identity(g);const {direction:B,up:v}=C;f.rotateZ(g,g,-u.deg2rad(x));f.rotateX(g,g,u.deg2rad(D));t.transformMat4(B,d,g);t.scale(B,B,-1);t.transformMat4(v,c,g);return C}function k(y,x,D,C){return b.directionToHeadingTilt(x,D,C,d,c)}function l(y,x,D,C){const B=h(y,D,C),v=w.create();t.scale(v,B.direction,-x);t.add(v,v,y);return{up:B.up,eye:v,heading:D,tilt:C}}function m(y){return u.rad2deg(y)}function z(y){return u.deg2rad(y)}function r(y,x,D,C,B){const v=
y.renderSpatialReference;y=y.map&&y.spatialReference||x.spatialReference;n.projectPointToVector(x,A,v);n.projectPointToVector(x,q,v);A[0]-=D/2;q[0]+=D/2;A[1]-=C/2;q[1]+=C/2;n.projectVectorToVector(A,v,A,y);n.projectVectorToVector(q,v,q,y);B?(B.xmin=A[0],B.ymin=A[1],B.xmax=q[0],B.ymax=q[1],B.spatialReference=y):B=new e(A[0],A[1],q[0],q[1],y);return B}const c=w.fromValues(0,1,0),d=w.fromValues(0,0,1),g=p.create(),A=w.create(),q=w.create();p=Object.freeze({__proto__:null,headingTiltToDirectionUp:h,directionToHeadingTilt:k,
eyeForCenterWithHeadingTilt:l,lookAtTiltToEyeTilt:m,eyeTiltToLookAtTilt:z,toExtent:r});a.cameraUtilsPlanar=p;a.directionToHeadingTilt=k;a.eyeForCenterWithHeadingTilt=l;a.eyeTiltToLookAtTilt=z;a.headingTiltToDirectionUp=h;a.lookAtTiltToEyeTilt=m;a.toExtent=r})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,u,f,p){const t=p.create(),w=p.create();a.createDirectionUp=function(){return{direction:p.create(),
up:p.create()}};a.directionToHeadingTilt=function(e,n,b,h,k){let l=f.normalize(t,e),m=f.dot(l,h);const z=0<m;m=Math.abs(m);.99<m&&(m=Math.abs(f.dot(n,h)),.99>m?(f.copy(l,n),z&&f.scale(l,l,-1)):l=null);n=0;l&&(f.scale(w,h,f.dot(h,l)),f.subtract(l,l,w),n=f.dot(l,k)/(f.length(l)*f.length(k)),f.cross(w,l,k),n=(0<f.dot(w,h)?1:-1)*u.rad2deg(u.acosClamped(n)));e=u.rad2deg(u.acosClamped(-f.dot(h,e)/f.length(e)));if(!b)return{heading:n,tilt:e};b.heading=n;b.tilt=e;return b};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(F,L,N,I=k.createDirectionUp()){t.cross(v,F,x);0===t.dot(v,v)&&t.cross(v,F,D);f.identity(B);f.rotate(B,
B,-u.deg2rad(L),F);f.rotate(B,B,-u.deg2rad(N),v);const {up:G,direction:K}=I;t.cross(G,v,F);t.normalize(G,G);t.transformMat4(G,G,B);t.normalize(K,F);t.negate(K,K);t.transformMat4(K,K,B);return I}function r(F,L,N,I){const G=v,K=E;t.normalize(G,F);t.cross(E,G,x);0===t.dot(E,E)&&t.cross(E,G,D);t.cross(K,E,G);return k.directionToHeadingTilt(L,N,I,G,K)}function c(F,L,N,I){const G={eye:w.create(),up:null,tilt:I,heading:N},K=v;K[0]=F[0];K[1]=F[2];K[2]=-F[1];N=u.deg2rad(N);var H=u.deg2rad(I);I=Math.sin(N);
N=Math.cos(N);var J=Math.sin(H),M=Math.cos(H);const O=t.length(K);if(1E-8>Math.abs(H))H=L+O;else{var Q=O/J,S=u.asinClamped(L/Q);H=Q*Math.sin(Math.PI-H-S)}M*=L;Q=L*L*J*J;S=N*N*Q;const V=H-M,Y=V*V;var W=S*(S+Y-K[1]*K[1]);if(0>W)return t.scale(G.eye,K,H/O),G.tilt=0,G;var ba=Math.sqrt(W);const ca=K[1]*V;W=S+Y;ba=0<N?-ba+ca:ba+ca;if(1E-8>Math.abs(W))return 1E-8>O?(G.eye[0]=0,G.eye[1]=0,G.eye[2]=L):t.scale(G.eye,K,H/O),G.tilt=0,d(G.eye),g(G,F);G.eye[1]=ba/W;L*=J;ba=G.eye[1]*G.eye[1];J=1-ba;W=Math.sqrt(J);
Q=S*ba+I*I*Q-2*N*L*G.eye[1]*W*V+J*Y;if(1E-8>Math.abs(Q))return t.scale(G.eye,K,H/O),G.tilt=0,d(G.eye),g(G,F);G.eye[0]=(J*(H*K[0]-M*K[0])-L*W*(K[0]*G.eye[1]*N+K[2]*I))/Q;G.eye[2]=(J*(H*K[2]-M*K[2])-L*W*(K[2]*G.eye[1]*N-K[0]*I))/Q;t.scale(G.eye,G.eye,H);d(G.eye);return g(G,F)}function d(F){const L=F[1];F[1]=-F[2];F[2]=L}function g(F,L){L=z(L,F.heading,F.tilt);F.up=L.up;return F}function A(F,L,N){L=t.length(L);N=u.asinClamped(N/(Math.sqrt(N*N+L*L-2*N*L*Math.cos(Math.PI-F))/Math.sin(F)));return u.rad2deg(F-
N)}function q(F,L,N){F=u.deg2rad(F);L=t.length(L);return u.asinClamped(N/(L/Math.sin(F)))+F}function y(F,L,N,I,G){function K(O){const Q=Math.PI/2;O=m.cyclical2PI.normalize(O,-Q);O>Q&&(O=Math.PI-O);return O}var H=L.latitude;L=L.longitude;var J=l.getLonDeltaForDistance(H,N,n.getReferenceEllipsoid(F.spatialReference).radius)/2;N=L-J;L+=J;H=u.deg2rad(H);J=n.getReferenceEllipsoid(F.spatialReference).radius;H=(1+Math.sin(H))/(1-Math.sin(H));const M=(H+1)*Math.tan(I/J/2);H=1.5*Math.PI-2*Math.atan(.5*(M+
Math.sqrt(4*H+M*M)));I=H+I/J;H=K(H);I=K(I);I<H&&(J=I,I=H,H=J);H=Math.max(u.rad2deg(H),-90);I=Math.min(u.rad2deg(I),90);L=C.monotonic(N,L);180<L-N&&(J=(L-N-180)/2,N+=J,L-=J);J=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:b.WGS84;G?(G.xmin=N,G.ymin=H,G.xmax=L,G.ymax=I,G.spatialReference=J):G=new e(N,H,L,I,J);F.spatialReference&&F.spatialReference.isWebMercator&&h.geographicToWebMercator(G,!1,G);return G}const x=w.fromValues(0,0,1),D=t.normalize(w.create(),w.fromValues(1,1,
1)),C=new m.Cyclical(-180,180),B=p.create(),v=w.create(),E=w.create();p=Object.freeze({__proto__:null,headingTiltToDirectionUp:z,directionToHeadingTilt:r,eyeForCenterWithHeadingTilt:c,lookAtTiltToEyeTilt:A,eyeTiltToLookAtTilt:q,toExtent:y});a.cameraUtilsSpherical=p;a.directionToHeadingTilt=r;a.eyeForCenterWithHeadingTilt=c;a.eyeTiltToLookAtTilt=q;a.headingTiltToDirectionUp=z;a.lookAtTiltToEyeTilt=A;a.toExtent=y})},"esri/views/support/spatialReferenceSupport":function(){define(["exports"],function(a){a.isSpatialReferenceSupported=
function(u,f){return null==u?!1:"2d"===f?!0:"local"===f?!u.isGeographic:u.isWebMercator||u.isWGS84||4490===u.wkid||104971===u.wkid||104905===u.wkid||104903===u.wkid};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,u){function f(p){let t=p*p;0>p&&(t*=-1);return t}a.extractTransformation=function(p,t,w){const e=p.state;p=p.device;t="forward-down"===t.tiltDirection?1:-1;"standard"===p.deviceType?
(w.translation[0]=f(e.axes[0]),w.translation[1]=f(e.axes[1]),w.translation[2]=f(e.buttons[7])-f(e.buttons[6]),w.heading=f(e.axes[2]),w.tilt=f(e.axes[3])):"spacemouse"===p.deviceType&&(w.translation[0]=1.2*f(e.axes[0]),w.translation[1]=1.2*f(e.axes[1]),w.translation[2]=2*-f(e.axes[2]),w.heading=1.2*f(e.axes[5]),w.tilt=1.2*f(e.axes[3]));w.tilt*=t;u.scale(w.translation,w.translation,1);return w};a.extractTransformationKeyboard=function(p,t){t.translation[0]=p[1]-p[0];t.translation[1]=p[3]-p[2];t.translation[2]=
p[4]-p[5];t.heading=p[7]-p[6];t.tilt=p[8]-p[9];t.zoom=p[10]-p[11];return t};a.isZeroTransformation=function(p){return 0===p.translation[0]&&0===p.translation[1]&&0===p.translation[2]&&0===p.heading&&0===p.tilt&&0===p.zoom};a.quadraticAccentuation=f;a.resetTransformation=function(p){p.translation[0]=0;p.translation[1]=0;p.translation[2]=0;p.heading=0;p.tilt=0;return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,u,f,p){p=function(t){function w(n,b){var h=t.call(this,!0)||this;h.view=n;h.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2};h.keyToNumber={[b.left]:0,[b.right]:1,[b.forward]:2,[b.backward]:3,[b.up]:4,[b.down]:5,[b.headingLeft]:6,[b.headingRight]:7,[b.tiltUp]:8,[b.tiltDown]:9,[b.zoomIn]:10,[b.zoomOut]:11};h.registerIncoming("key-down",null,k=>h.handleKeyDown(k));
h.registerIncoming("key-up",null,k=>h.handleKeyUp(k));h.registerIncoming("blur",null,()=>h.handleBlur());return h}u._inheritsLoose(w,t);var e=w.prototype;e.handleKeyDown=function(n){if(!n.data.native.ctrlKey&&!n.data.native.metaKey){var b=this.keyToNumber[n.data.key];null!=b&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new f.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(b),n.stopPropagation()))}};e.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};e.handleKeyUp=function(n){if(!n.data.native.ctrlKey&&!n.data.native.metaKey){var b=this.keyToNumber[n.data.key];null!=b&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(b),
n.stopPropagation())}};return w}(p.InputHandler);a.KeyboardNavigation=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(a,u,f,p,t,w){w=function(e){function n(b,h){var k=e.call(this,!0)||this;k.view=b;k.registerIncoming("mouse-wheel",
h,l=>k.handleMouseWheel(l));return k}u._inheritsLoose(n,e);n.prototype.handleMouseWheel=function(b){if(this.view.navigation.mouseWheelZoomEnabled){var h=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new p.ZoomStepController({view:this.view,mode:"interaction"}):new t.ZoomStepController({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*h.deltaY,f.createScreenPointArray(h.x,
h.y));b.preventDefault();b.stopPropagation()}};return n}(w.InputHandler);a.MouseWheelZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,u,f,p,t,w){t=function(e){function n(h,k,l){var m=
e.call(this,!0)||this;m.view=h;m.pointerAction=k;m.lastEndTimestamp=0;m.lastTimestamp=0;m.registerIncoming("drag",l,z=>m.handleDrag(z));return m}u._inheritsLoose(n,e);var b=n.prototype;b.handleDrag=function(h){if("mouse"!==h.data.pointerType||w.eventMatchesMousePointerAction(h.data,this.pointerAction)){var k=h.timestamp-this.lastEndTimestamp;k=this.momentum&&this.momentum.active&&40>k;switch(h.data.action){case "start":case "update":if(k)break;this.controller&&this.controller.active?2<h.data.timestamp-
this.lastTimestamp&&(this.controller.update(h.data),this.lastTimestamp=h.timestamp):this.startController(h);break;case "end":case "removed":this.endController(h,!0);break;case "added":this.endController(h,!1),this.startController(h)}h.stopPropagation()}};b.endController=function(h,k){this.controller&&this.controller.active&&(this.lastEndTimestamp=h.timestamp,h=this.controller.end(h.data),k&&h&&(this.momentum=h,this.view.state.switchCameraController(this.momentum)));this.controller=null};b.startController=
function(h){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(h.data);this.lastTimestamp=h.timestamp};b.createController=function(){return this.view.state.isGlobal?new f.PinchAndPanController({view:this.view}):new p.PinchAndPanController({view:this.view})};return n}(t.InputHandler);a.PinchAndPanNavigation=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../../../support/featureFlags ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H){a.PinchAndPanController=function(J){function M(Q){Q=J.call(this,Q)||this;Q.view=null;Q.smoothRotation=new y.ExponentialFalloff(.05);Q.rotationAxis=z.create();Q.panningPlane=d.create();Q.smoothScaling=new y.ExponentialFalloff(.05);Q.zoomCenterScreen=t.createScreenPointArray();Q.zoomMomentumEstimator=new H.ZoomMomentumEstimator;Q.rotationMomentumEstimator=new K.RotationMomentumEstimator;Q.panSphericalMomentumEstimator=new G.PanSphericalMomentumEstimator;
Q.panPlanarMomentumEstimator=new I.PanPlanarMomentumEstimator;Q.adjustedSphere=g.create();Q.tmp3d=z.create();Q.tmpScreenPointArray=t.createScreenPointArray();Q.beginScreenPoint=t.createScreenPointArray();Q.beginScenePoint=z.create();Q.screenPickPoint=t.createScreenPointArray();Q.navMode=F.NavigationMode.Horizontal;Q.tmpInteractionDirection=z.create();Q.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new N,interactionDirection:null,tiltMode:0};return Q}
u._inheritsLoose(M,J);var O=M.prototype;O.begin=function(Q){if(this.active){var S=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=S;this.rotationMomentumEstimator.enabled=S;this.panPlanarMomentumEstimator.enabled=S;this.panSphericalMomentumEstimator.enabled=S;this.beginHeading=-L.cyclicalPI.normalize(p.deg2rad(this.view.camera.heading));this.beginRadius=Q.radius;this.pointerCount=Q.pointers.size;this.beginAngle=Q.angle;this.smoothRotation.reset();t.screenPointObjectToArray(Q.center,
this.screenPickPoint);l.copy(this.beginScreenPoint,this.screenPickPoint);S=r.getReferenceEllipsoid(this.view.spatialReference);var V=F.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,S);this.scenePickPoint=V.scenePickPoint;this.sphere=V.sphere;m.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=F.decideNavigationMode(this.startCamera,this.screenPickPoint,V.hasGeometryIntersection,S);this.navMode===F.NavigationMode.Vertical&&this.preparePlanarPanMode(Q);
this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};O.preparePlanarPanMode=function(Q){var S=m.negate(this.tmp3d,this.startCamera.viewForward);d.fromPositionAndNormal(this.scenePickPoint,S,this.panningPlane);var V=t.createScreenPointArray(this.screenPickPoint[0],0);S=z.create();var Y=m.length(this.startCamera.eye);this.adjustedSphere[3]=Y<this.sphere[3]?Y-100:this.sphere[3];F.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.startCamera,V,S);V=t.createRenderScreenPointArray3();
this.startCamera.projectToRenderScreen(S,V);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*V[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&d.fromPositionAndNormal(this.scenePickPoint,d.normal(this.panningPlane),this.panningPlane);if(!A.disableContextNavigation()){S=z.create();V=z.create();Y=z.create();m.subtract(S,this.scenePickPoint,this.currentCamera.eye);m.normalize(S,S);var W=5*Math.max(Math.abs(this.view.camera.position.z),50);const ba=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],
this.screenPickPoint[1],this.view.state.camera,80);W=ba?Math.min(ba,W):W;m.copy(Y,m.add(V,this.currentCamera.eye,m.scale(V,S,W)));this.panningPlane[3]=-m.dot(this.panningPlane,Y);this.startCamera.center=m.add(V,this.startCamera.eye,m.scale(V,this.startCamera.viewForward,W))}Q=t.screenPointObjectToArray(Q.center,this.tmpScreenPointArray);F.intersectPlaneFromScreenPoint(this.panningPlane,this.startCamera,Q,this.beginScenePoint)};O.update=function(Q){if(this.active){this.currentCamera.copyFrom(this.startCamera);
var S=1<Q.pointers.size;this.navMode===F.NavigationMode.Horizontal?(S&&this.zoomSpherical(Q),this.panningSpherical(Q),S&&this.rotateSpherical(Q)):(S&&this.zoomPlanar(Q),this.panningPlanar(Q),S&&this.rotatePlanar(Q))}};O.end=function(Q){Q.pointers.size===this.pointerCount&&this.update(Q);this.finishController();if(Q=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===F.NavigationMode.Horizontal?new E.ZoomSphericalMomentumController({view:this.view,momentum:Q,screenCenter:this.zoomCenterScreen,
sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new v.ZoomPlanarMomentumController({view:this.view,momentum:Q,zoomCenter:this.beginScenePoint});if(Q=this.rotationMomentumEstimator.evaluateMomentum())return new B.RotationMomentumController({view:this.view,momentum:Q,center:this.sphere,axis:this.rotationAxis});if(this.navMode===F.NavigationMode.Horizontal){if(Q=this.panSphericalMomentumEstimator.evaluateMomentum())return new C.PanSphericalMomentumController({view:this.view,momentum:Q})}else if(Q=
this.panPlanarMomentumEstimator.evaluateMomentum())return new D.PanPlanarMomentumController({view:this.view,momentum:Q});return null};O.zoomSpherical=function(Q){const S=this.beginRadius/Q.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,40),120);this.smoothScaling.update(S);F.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);t.screenPointObjectToArray(Q.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*Q.timestamp);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius-this.beginRadius);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};O.panningSpherical=function(Q){const S=t.screenPointObjectToArray(Q.center,this.tmpScreenPointArray);F.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,S,this.tmp3d);F.preserveHeadingThreshold(this.beginScenePoint,m.dot(this.currentCamera.up,this.beginScenePoint),this.sphere[3],
this.beginHeading,this.view.camera.tilt,this.startCamera)?(F.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(S,this.tmp3d,.001*Q.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(F.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(S,
this.tmp3d,.001*Q.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.screenPickPoint,S);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};O.rotateSpherical=function(Q){m.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||m.negate(this.rotationAxis,this.rotationAxis);var S=this.smoothRotation.value,V=F.normalizeRotationDelta(Q.angle-
S);S+=V;this.smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),120);this.smoothRotation.update(S);V=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(V,.001*Q.timestamp);F.applyRotation(this.currentCamera,this.sphere,c.wrapAxisAngle(this.rotationAxis,V));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius*S);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};O.panningPlanar=function(Q){const S=
t.screenPointObjectToArray(Q.center,this.tmpScreenPointArray);F.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,S,this.tmp3d)&&(F.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(S,this.tmp3d,.001*Q.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.beginScreenPoint,S),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this.tmpInteractionDirection),q.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};O.zoomPlanar=function(Q){const S=this.beginRadius/Q.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,40),120);this.smoothScaling.update(S);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*Q.timestamp);F.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius-this.beginRadius);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};O.rotatePlanar=function(Q){m.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||m.negate(this.rotationAxis,this.rotationAxis);var S=this.smoothRotation.value;let V=Q.angle-S;V=F.normalizeRotationDelta(V);this.smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),
120);this.smoothRotation.update(S+V);S=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(S,.001*Q.timestamp);F.applyRotation(this.currentCamera,this.sphere,c.wrapAxisAngle(this.rotationAxis,S));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius*S);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};u._createClass(M,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return M}(x.InteractiveController);f.__decorate([w.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=f.__decorate([k.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w){this._gain=w}var t=p.prototype;t.reset=
function(w){this._value=w};t.update=function(w){this._value=void 0===this._value?w:this._gain*w+(1-this._gain)*this._value};u._createClass(p,[{key:"gain",set:function(w){this._gain=w}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return p}();a.ExponentialFalloff=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){a.PanPlanarMomentumController=function(z){function r(c){c=z.call(this,c)||this;c.interactionType=4;c.tmpPan=k.create();return c}u._inheritsLoose(r,z);r.prototype.momentumStep=function(c,d){c=this.momentum.value(c);h.scale(this.tmpPan,this.momentum.direction,c);d.eye=h.subtract(m,d.eye,this.tmpPan);d.center=h.subtract(m,d.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return r}(l.MomentumController);f.__decorate([p.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=f.__decorate([b.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const m=k.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.MomentumController=function(z){function r(d){d=z.call(this,d)||this;d.view=null;d.beginCamera=new m;d.elapsedTimeSec=0;d.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new m,interactionDirection:null,tiltMode:0};return d}u._inheritsLoose(r,z);var c=r.prototype;c.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new h};c.onControllerStart=function(d){this.beginCamera.copyFrom(d);
this.constraintOptions.interactionStartCamera=this.beginCamera;z.prototype.onControllerStart.call(this,d)};c.stepController=function(d,g){g.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=d;this.momentumStep(this.elapsedTimeSec,g);k.applyAll(this.view,g,this.constraintOptions)};u._createClass(r,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return r}(l.AnimationController);f.__decorate([p.property({constructOnly:!0})],a.MomentumController.prototype,
"view",void 0);a.MomentumController=f.__decorate([b.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){const z=k.create(),r=k.create();a.PanSphericalMomentumController=function(c){function d(g){g=c.call(this,g)||this;g.interactionType=4;return g}u._inheritsLoose(d,c);d.prototype.momentumStep=function(g,A){const q=this.momentum.value1(g);g=this.momentum.value2(g);h.copy(r,A.eye);h.normalize(r,r);h.cross(this.momentum.axis2,r,this.momentum.axis1);m.applyRotationWithTwoAxes(A,z,this.momentum.axis1,q,this.momentum.axis2,g)};return d}(l.MomentumController);f.__decorate([p.property({constructOnly:!0})],
a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=f.__decorate([b.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.RotationMomentumController=function(z){function r(c){c=z.call(this,c)||this;c.interactionType=2;return c}u._inheritsLoose(r,z);r.prototype.momentumStep=function(c,d){c=this.momentum.value(c);m.applyRotation(d,this.center,k.wrapAxisAngle(this.axis,c))};u._createClass(r,[{key:"center",set:function(c){this._set("center",h.clone(c))}},{key:"axis",set:function(c){this._set("axis",h.clone(c))}}]);return r}(l.MomentumController);f.__decorate([p.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);f.__decorate([p.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);f.__decorate([p.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=f.__decorate([b.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.ZoomPlanarMomentumController=function(z){function r(c){c=z.call(this,c)||this;c.interactionType=1;c.constraintOptions.interactionDirection=k.create();return c}u._inheritsLoose(r,z);r.prototype.momentumStep=function(c,d){h.copy(this.constraintOptions.interactionDirection,d.eye);c=this.momentum.valueDelta(0,c);m.applyZoomToPoint(d,this.zoomCenter,c,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=h.direction(this.constraintOptions.interactionDirection,
d.eye,this.constraintOptions.interactionDirection)};u._createClass(r,[{key:"zoomCenter",set:function(c){this._set("zoomCenter",k.clone(c))}}]);return r}(l.MomentumController);f.__decorate([p.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);f.__decorate([p.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=f.__decorate([b.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){a.ZoomSphericalMomentumController=function(d){function g(q){q=d.call(this,q)||this;q.interactionType=1;q.radius=0;q.tmpSceneCenter=k.create();q.tmpZoomAxisAngle=l.create();q.sphere=m.create();return q}u._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this.sphere[3]=this.radius};A.momentumStep=function(q,y){q=this.momentum.valueDelta(0,q);c.applyZoomOnSphere(this.sphere,y,q);this.constraintOptions.interactionType=1;z.applyAll(this.view,y,this.constraintOptions);
c.sphereOrPlanePointFromScreenPoint(this.sphere,y,this.screenCenter,this.tmpSceneCenter);l.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);c.applyRotation(y,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};u._createClass(g,[{key:"screenCenter",set:function(q){this._set("screenCenter",p.createScreenPointArray(q[0],q[1]))}},{key:"sceneCenter",set:function(q){this._set("sceneCenter",k.clone(q))}}]);return g}(r.MomentumController);f.__decorate([t.property({constructOnly:!0})],
a.ZoomSphericalMomentumController.prototype,"momentum",void 0);f.__decorate([t.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);f.__decorate([t.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);f.__decorate([t.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=f.__decorate([h.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],
a.ZoomSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,u,f,p,t,w){let e=function(n){function b(h,k,l,m,z){h=n.call(this,h,k,l)||this;h.sceneVelocity=m;h.direction=z;return h}u._inheritsLoose(b,n);b.prototype.value=function(h){return n.prototype.valueFromInitialVelocity.call(this,
this.sceneVelocity,h)};return b}(w.Momentum);w=function(){function n(h=300,k=12,l=.84){this.minimumInitialVelocity=h;this.stopVelocity=k;this.friction=l;this.enabled=!0;this.time=new t.FilteredFiniteDifference(.6);this.screen=[new t.FilteredFiniteDifference(.4),new t.FilteredFiniteDifference(.4)];this.scene=[new t.FilteredFiniteDifference(.6),new t.FilteredFiniteDifference(.6),new t.FilteredFiniteDifference(.6)];this.tmpDirection=p.create()}var b=n.prototype;b.add=function(h,k,l){!this.enabled||this.time.hasLastValue&&
.015>this.time.computeDelta(l)||(this.screen[0].update(h[0]),this.screen[1].update(h[1]),this.scene[0].update(k[0]),this.scene[1].update(k[1]),this.scene[2].update(k[2]),this.time.update(l))};b.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var h=this.screen[0].filteredDelta;const k=this.screen[1].filteredDelta;
h=Math.sqrt(h*h+k*k)/this.time.filteredDelta;return Math.abs(h)<this.minimumInitialVelocity?null:this.createMomentum(h,this.stopVelocity,this.friction)};b.createMomentum=function(h,k,l){f.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const m=f.length(this.tmpDirection);0<m&&f.scale(this.tmpDirection,this.tmpDirection,1/m);return new e(h,k,l,m/this.time.filteredDelta,this.tmpDirection)};return n}();a.PanPlanarMomentum=e;a.PanPlanarMomentumEstimator=
w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w){this.gain=w}var t=p.prototype;t.update=function(w){if(this.hasLastValue){const e=this.computeDelta(w);this.updateDelta(e)}this.lastValue=w};t.reset=function(){this.filteredDelta=this.lastValue=void 0};t.computeDelta=function(w){return w-this.lastValue};t.updateDelta=function(w){this.filteredDelta=
this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*w:w};u._createClass(p,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return p}();a.FilteredFiniteDifference=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w,e,n){this._initialVelocity=
w;this._stopVelocity=e;this._friction=n;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var t=p.prototype;t.isFinished=function(w){return w>this.duration};t.value=function(w){return this.valueFromInitialVelocity(this._initialVelocity,w)};t.valueDelta=function(w,e){const n=this.value(w);return this.value(w+e)-n};t.valueFromInitialVelocity=function(w,e){e=Math.min(e,this.duration);const n=1-this.friction;return w*(n**e-1)/Math.log(n)};
u._createClass(p,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return p}();a.Momentum=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,u,f,
p,t,w,e,n,b){let h=function(k){function l(z,r,c,d,g,A=0,q){z=k.call(this,z,r,c)||this;z.angularVelocity1=d;z.axis1=g;z.angularVelocity2=A;z.axis2=q;return z}u._inheritsLoose(l,k);var m=l.prototype;m.value1=function(z){return k.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,z)};m.value2=function(z){return k.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,z)};return l}(b.Momentum);b=function(){function k(m=300,z=12,r=.84){this.minimumInitialVelocity=m;this.stopVelocity=
z;this.friction=r;this.enabled=!0;this.tmpAxis1=t.create();this.tmpAxis2=t.create();this.tmpAngles=f.create();this.time=new e.FilteredFiniteDifference(.3);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.angle1=new n.FilteredValue(.6);this.angle2=new n.FilteredValue(.6);this.axis1=t.create();this.axis2=t.create();this.lastScene=t.create()}var l=k.prototype;l.addMomentumDirectRotation=function(m,z,r,c,d,g){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(r))return;
c=w.rotationAngleAndAxisDirectRotation(this.lastScene,z,this.tmpAxis2,c,d,g);this.angle2.update(0);1E-5>p.squaredLength(this.tmpAxis2)?c=0:p.normalize(this.axis1,this.tmpAxis2);this.angle1.update(c);p.copy(this.lastScene,z)}this.screen[0].update(m[0]);this.screen[1].update(m[1]);this.time.update(r)}};l.addMomentumPreserveHeading=function(m,z,r,c,d,g,A){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(r))return;w.rotationAnglesAndAxesHeadingPreserving(this.lastScene,z,this.tmpAxis2,
this.tmpAxis1,this.tmpAngles,c,d,g,A,!1);1E-5>p.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),p.normalize(this.axis1,this.tmpAxis1),p.normalize(this.axis2,this.tmpAxis2));p.copy(this.lastScene,z)}this.screen[0].update(m[0]);this.screen[1].update(m[1]);this.time.update(r)}};l.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};
l.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var m=this.screen[0].filteredDelta;const z=this.screen[1].filteredDelta;m=Math.sqrt(m*m+z*z)/this.time.filteredDelta;return Math.abs(m)<this.minimumInitialVelocity?null:this.createMomentum(m,this.stopVelocity,this.friction)};l.createMomentum=function(m,z,r){return new h(m,z,r,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return k}();
a.PanSphericalMomentum=h;a.PanSphericalMomentumEstimator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w){this.gain=w}var t=p.prototype;t.update=function(w){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*w:w};t.reset=function(){this.filteredValue=void 0};u._createClass(p,[{key:"hasFilteredValue",get:function(){return void 0!==
this.filteredValue}}]);return p}();a.FilteredValue=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,u,f){f=function(p){function t(w=3,e=.01,n=.95,b=12){return p.call(this,w,e,n,b)||this}u._inheritsLoose(t,p);t.prototype.add=function(w,e){if(this.value.hasLastValue){const n=this.value.lastValue;for(w-=n;w>Math.PI;)w-=2*Math.PI;for(;w<-Math.PI;)w+=
2*Math.PI;w=n+w}p.prototype.add.call(this,w,e)};return t}(f.MomentumEstimator);a.RotationMomentumEstimator=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,u,f,p){let t=function(){function w(n=2.5,b=.01,h=.95,k=12){this.minimumInitialVelocity=n;this.stopVelocity=b;this.friction=h;this.maxVelocity=k;this.enabled=!0;this.value=new f.FilteredFiniteDifference(.8);
this.time=new f.FilteredFiniteDifference(.3)}var e=w.prototype;e.add=function(n,b){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){const h=this.value.computeDelta(n);0>this.value.filteredDelta*h&&this.value.reset()}}this.time.update(b);this.value.update(n)}};e.reset=function(){this.value.reset();this.time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let n=this.value.filteredDelta/
this.time.filteredDelta;n=u.clamp(n,-this.maxVelocity,this.maxVelocity);return Math.abs(n)<this.minimumInitialVelocity?null:this.createMomentum(n,this.stopVelocity,this.friction)};e.createMomentum=function(n,b,h){return new p.Momentum(n,b,h)};return w}();a.MomentumEstimator=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,u,f,p){let t=
function(w){function e(b,h,k){return w.call(this,b,h,k)||this}u._inheritsLoose(e,w);var n=e.prototype;n.value=function(b){b=w.prototype.value.call(this,b);return Math.exp(b)};n.valueDelta=function(b,h){const k=w.prototype.value.call(this,b);b=w.prototype.value.call(this,b+h);return Math.exp(b-k)};return e}(f.Momentum);f=function(w){function e(b=2.5,h=.01,k=.95,l=12){return w.call(this,b,h,k,l)||this}u._inheritsLoose(e,w);var n=e.prototype;n.add=function(b,h){w.prototype.add.call(this,Math.log(b),
h)};n.createMomentum=function(b,h,k){return new t(b,h,k)};return e}(p.MomentumEstimator);a.ZoomMomentum=t;a.ZoomMomentumEstimator=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../support/featureFlags ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E){const F=m.fromValues(0,0,1);var L=16/180*Math.PI;a.PinchAndPanController=function(N){function I(K){K=N.call(this,K)||this;K.view=null;K.rotationValueSmooth=new g.ExponentialFalloff(.05);K.scalingValueSmooth=new g.ExponentialFalloff(.05);K.planeHorizontal=r.create();K.planeVertical=r.create();K.rotationMomentumEstimator=new v.RotationMomentumEstimator;K.panMomentumEstimator=new B.PanPlanarMomentumEstimator(300,12,.9);K.zoomMomentumEstimator=
new E.ZoomMomentumEstimator;K.beginCenter=m.create();K.tmpPoints=[];K.beginCenterScreen=t.createScreenPointArray();K.tmpCentroid3d=m.create();K.tmpCentroid2d=t.createScreenPointArray();K.tmp2d=t.createScreenPointArray();K.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new C,interactionDirection:null,tiltMode:0};return K}u._inheritsLoose(I,N);var G=I.prototype;G.begin=function(K){if(this.active){var H=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=
H;this.rotationMomentumEstimator.enabled=H;this.panMomentumEstimator.enabled=H;this.beginRadius=K.radius;this.pointerCount=K.pointers.size;this.beginAngle=K.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();t.screenPointObjectToArray(K.center,this.beginCenterScreen);r.fromNormalAndOffset(F,0,this.planeHorizontal);H=m.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,H);var J=m.create();l.negate(J,this.startCamera.viewForward);var M=m.create();
l.copy(M,F);var O=l.dot(J,M);this.panMode=p.asinClamped(0>O?-O:O)>=L?D.NavigationMode.Horizontal:D.NavigationMode.Vertical;r.setOffsetFromPoint(this.planeHorizontal,H,this.planeHorizontal);this.startCamera.aboveGround||r.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===D.NavigationMode.Vertical){l.scale(M,M,O);l.subtract(this.planeVertical,J,M);l.normalize(this.planeVertical,this.planeVertical);r.setOffsetFromPoint(this.planeVertical,H,this.planeVertical);if(!c.disableContextNavigation()){J=
m.create();M=m.create();O=m.create();l.subtract(J,H,this.currentCamera.eye);l.normalize(J,J);H=5*Math.max(Math.abs(this.view.camera.position.z),50);const Q=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);l.copy(O,l.add(M,this.currentCamera.eye,l.scale(M,J,Q?Math.min(Q,H):H)));this.planeVertical[3]=-l.dot(this.planeVertical,O)}this.computePlanePoints(K.pointers,this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(K.pointers,
this.planeHorizontal,this.startCamera,this.tmpPoints);D.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};G.update=function(K){if(this.active){this.currentCamera.copyFrom(this.startCamera);var H=1<K.pointers.size,J=this.panMode===D.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,M=this.beginCenter;if(H){var O=this.beginRadius/K.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(K.radius,40),120);this.scalingValueSmooth.update(O);
D.applyZoomToPoint(this.currentCamera,M,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*K.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(Math.abs(K.radius-this.beginRadius));d.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(K.pointers,J,this.currentCamera,this.tmpPoints);D.centroid(this.tmpPoints,
this.tmpCentroid3d);t.screenPointObjectToArray(K.center,this.tmpCentroid2d);D.applyPanPlanar(this.currentCamera,M,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*K.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);d.applyAll(this.view,this.currentCamera,this.constraintOptions);H&&(H=this.planeHorizontal,J=this.rotationValueSmooth.value,
O=D.normalizeRotationDelta(K.angle-J),J+=O,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(K.radius,40),120),this.rotationValueSmooth.update(J),J=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(J,.001*K.timestamp),D.applyRotation(this.currentCamera,M,z.wrapAxisAngle(H,J)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(Math.abs(K.radius*J)),d.applyAll(this.view,this.currentCamera,this.constraintOptions))}};
G.end=function(K){K.pointers.size===this.pointerCount&&this.update(K);this.finishController();return(K=this.zoomMomentumEstimator.evaluateMomentum())?new x.ZoomPlanarMomentumController({view:this.view,momentum:K,zoomCenter:this.beginCenter}):(K=this.rotationMomentumEstimator.evaluateMomentum())?new y.RotationMomentumController({view:this.view,momentum:K,center:this.beginCenter,axis:r.normal(this.planeHorizontal)}):(K=this.panMomentumEstimator.evaluateMomentum())?new q.PanPlanarMomentumController({view:this.view,
momentum:K}):null};G.computePlanePoints=function(K,H,J,M){M.length=K.size;const O=this.tmp2d;let Q=0;K.forEach(S=>{O[0]=S.x;O[1]=S.y;void 0===M[Q]&&(M[Q]=m.create());D.intersectPlaneFromScreenPoint(H,J,O,M[Q]);Q+=1});return M};u._createClass(I,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return I}(A.InteractiveController);f.__decorate([w.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=f.__decorate([k.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,u,f){f=function(p){function t(w,e){var n=p.call(this,!0)||this;n.view=w;n.registerIncoming("pointer-down",e,()=>n.view.state.stopActiveCameraController());return n}u._inheritsLoose(t,p);return t}(f.InputHandler);a.PointerDownCancelAnimation=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,u,f){f=function(p){function t(w,e,n){n=p.call(this,e,n)||this;n.view=w;n.key=e;return n}u._inheritsLoose(t,p);t.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return t}(f.SingleKey);a.SingleKeyResetHeading=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,u,f){f=function(p){function t(w,e){var n=p.call(this,!0)||this;n.key=w;n.registerIncoming("key-down",e,b=>n._handleKeyDown(b));return n}u._inheritsLoose(t,p);t.prototype._handleKeyDown=function(w){w.data.key===this.key&&(this.activate(),w.stopPropagation())};return t}(f.InputHandler);a.SingleKey=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,u,f){f=function(p){function t(w,e,n){n=p.call(this,e,n)||this;n.view=w;n.key=e;return n}u._inheritsLoose(t,p);t.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return t}(f.SingleKey);a.SingleKeyResetTilt=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils",
"../../state/controllers/RotateController","../../../input/InputHandler"],function(a,u,f,p,t){t=function(w){function e(n,b=!1){var h=w.call(this,!0)||this;h.view=n;h.invert=b;h.registerIncoming("vertical-two-finger-drag",k=>h.handleTwoFinger(k));return h}u._inheritsLoose(e,w);e.prototype.handleTwoFinger=function(n){var b,h,k;const l=f.createScreenPointArray(0,n.data.delta*(this.invert?-1:1));switch(n.data.action){case "begin":null==(b=this.cameraController)?void 0:b.end();this.cameraController=new p.RotateController({view:this.view,
pivot:0});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(l);break;case "update":null==(h=this.cameraController)?void 0:h.update(l);break;case "end":null==(k=this.cameraController)?void 0:k.end(),this.cameraController=null}};return e}(t.InputHandler);a.TwoFingerTilt=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),
function(a,u,f,p,t,w){const e=f("trident"),n=f("edge"),b=f("chrome"),h=f("ff"),k=f("safari");f=function(){function m(r,c){this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=r;r.getAttribute("tabindex")||r.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new t.GamepadSource(r,this.input);this._gamepadSource.onEvent=d=>this._callback("gamepad",d)}var z=m.prototype;z.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(r=>
{this._releasePointerCaptureSafe(r)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};z.setPointerCapture=function(r,c){c?(this._element.setPointerCapture(r.pointerId),this._activePointerCaptures.add(r.pointerId)):(this._releasePointerCaptureSafe(r.pointerId),this._activePointerCaptures.delete(r.pointerId))};z._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};z._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._releasePointerCaptureSafe=function(r){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(r)||this._element.releasePointerCapture(r)}catch(c){}};z._updateNormalizedPointerLikeEvent=function(r,c){r=w.createScreenPointFromNativeEvent(this._element,r);m.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y));c.x=r.x;c.y=
r.y;return c};z._handleKey=function(r,c){const d=p.eventKey(c);d&&"key-up"===r&&this._keyDownState.delete(d);c={native:c,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===r&&this._keyDownState.add(c.key);this._callback(r,c)};z._handlePointer=function(r,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(r,c)};z._handlePointerPreventDefault=function(r,c){const d=this._updateNormalizedPointerLikeEvent(c,
{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(r,d)};z._handleMouseWheel=function(r,c){let d=c.deltaY;switch(c.deltaMode){case 0:if(e||n)d=d/document.documentElement.clientHeight*600;break;case 1:d*=30;break;case 2:d*=900}e||n?d*=.7:b||k?d*=.6:h&&(d*=1.375);const g=Math.abs(d);100<g&&(d=d/g*200/(1+Math.exp(-.02*(g-100))));c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,deltaY:d});this._callback(r,
c)};z._handlePointerCaptureLost=function(r,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(r,c)};z._handleDefault=function(r,c){const d={native:c};c.preventDefault();this._callback(r,d)};z._preventAltKeyDefault=function(r){"Alt"===r.key&&r.preventDefault()};z._preventMultiTouchPanning=function(r){1<r.touches.length&&r.preventDefault()};u._createClass(m,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(r){this._browserTouchPanningEnabled=
r;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(r){this._callback=r}},{key:"activeEvents",set:function(r){for(const c in this._active)r&&r.has(c)||(this._element.removeEventListener(l[c],this._active[c]),delete this._active[c]);r&&r.forEach(c=>{if(!this._active[c]&&l[c]){const d=(this._eventHandlers[c]||this._handleDefault).bind(this,c);this._element.addEventListener(l[c],d);this._active[c]=d}});this._gamepadSource.hasEventListeners=r&&r.has("gamepad")}}]);
return m}();f.test={disableSubpixelCoordinates:!1};const l={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=f;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,u,f,p,t){let w=function(){function e(b,h){this.element=b;this.input=h;this._hasEventListeners=!1;this.onConnectGamepad=k=>{this.connectGamepad(k.gamepad)};this.onDisconnectGamepad=k=>{k=k.gamepad;const l=k.index,m=this.inputDevices[l];m&&(this.emitGamepadEvent(k,t.extractState(m),!1),this.inputDevices.splice(l,
1),this.latestUpdate.splice(l,1),this.input.gamepad.devices.remove(m),this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;b=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&b)this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}var n=e.prototype;n.destroy=function(){this.hasEventListeners=
!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))};n.connectGamepad=function(b){const h=new p(b);"unknown"!==h.deviceType&&(this.inputDevices[b.index]=h,this.input.gamepad.devices.add(h));this.ensurePollingState()};n.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};n.startPolling=function(){null==this.frameTask&&(this.frameTask=f.addFrameTask({update:()=>
this.readGamepadState()}))};n.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};n.readGamepadState=function(){const b=document.hasFocus(),h=this.element.contains(document.activeElement),k="document"===this.input.gamepad.enabledFocusMode&&!b||"view"===this.input.gamepad.enabledFocusMode&&!h;this.forEachGamepad(l=>{var m=this.inputDevices[l.index];if(m){var z=this.latestUpdate[l.index];m=t.extractState(m);var r=k||t.stateIdle(m);z&&(z.timestamp===
l.timestamp||!z.active&&r||t.stateEqual(z.state,m))||this.emitGamepadEvent(l,m,!r)}})};n.forEachGamepad=function(b){const h=window.navigator.getGamepads();for(let k=0;k<h.length;k++){const l=h[k];this.validate(l)&&b(l)}};n.emitGamepadEvent=function(b,h,k){var l=this.latestUpdate[b.index];if((l=l&&l.active)||k)this.latestUpdate[b.index]={timestamp:b.timestamp,state:h,active:k},this.callback&&this.callback({device:this.inputDevices[b.index],state:h,action:!l&&k?"start":l&&k?"update":"end"})};n.validate=
function(b){if(!b||!b.connected)return!1;for(let h=0;h<b.axes.length;h++)if(isNaN(b.axes[h]))return!1;return!0};u._createClass(e,[{key:"hasEventListeners",set:function(b){this._hasEventListeners!==b&&(this._hasEventListeners=b,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(b){this.callback=b}}]);return e}();a.GamepadSource=w;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/input/gamepad/GamepadState":function(){define(["exports","../../../core/mathUtils"],function(a,u){a.extractState=function(f){const p=f.native;return p?{buttons:p.buttons.map(t=>t.pressed?t.value?t.value:1:0),axes:p.axes.map(t=>{{var w=f.axisThreshold;const e=Math.abs(t);t=e<w?0:u.sign(t)*(e-w)/(1-w)}return t})}:{buttons:[],axes:[]}};a.stateEqual=function(f,p){if(f.axes.length!==p.axes.length||f.buttons.length!==p.buttons.length)return!1;for(var t=0;t<f.axes.length;t++)if(f.axes[t]!==p.axes[t])return!1;
for(t=0;t<f.buttons.length;t++)if(f.buttons[t]!==p.buttons[t])return!1;return!0};a.stateIdle=function(f){for(var p=0;p<f.axes.length;p++)if(0!==f.axes[p])return!1;for(p=0;p<f.buttons.length;p++)if(0!==f.buttons[p])return!1;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,u,f){f=function(p){function t(){var w=p.call(this,!0)||this;w.registerIncoming("context-menu",
e=>{e.data.native.preventDefault()});return w}u._inheritsLoose(t,p);return t}(f.InputHandler);a.PreventContextMenu=f;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,u,f,p,t,w){function e(k){const l=[];k.forEach(m=>{l.push(f.createScreenPoint(m.event.x,m.event.y))});return w.fitCircleLSQ(l)}
function n(k){const l=e(k);let m=0;k.forEach(z=>{var r=h(z,l);for(r-=z.lastAngle;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;r=z.lastAngle+r;z.lastAngle=r;m+=r-z.initialAngle});m/=k.size||1;return{angle:m,radius:l.radius,center:l.center}}function b(k){const l=new Map;k.forEach((m,z)=>l.set(z,m.event));return l}function h(k,l){k=k.event;return Math.atan2(k.y-l.center.y,k.x-l.center.x)}t=function(k){function l(z){var r=k.call(this,!1)||this;r.navigationTouch=z;r.startStateModifiers=new Set;
r.activePointerMap=new Map;r.isDragging=!1;r.isCurrentDragSuppressed=!1;r.drag=r.registerOutgoing("drag");r.registerIncoming("pointer-drag",r.handlePointerDrag.bind(u._assertThisInitialized(r)));r.registerIncoming("pointer-up",r.handlePointerUpAndPointerLost.bind(u._assertThisInitialized(r)));r.registerIncoming("pointer-capture-lost",r.handlePointerUpAndPointerLost.bind(u._assertThisInitialized(r)));r.registerIncoming("pointer-cancel",r.handlePointerUpAndPointerLost.bind(u._assertThisInitialized(r)));
return r}u._inheritsLoose(l,k);var m=l.prototype;m.createPayload=function(z,r,c,d){return{action:z,pointerType:this.pointerType,button:this.mouseButton,buttons:r.buttons,timestamp:d,pointers:b(this.activePointerMap),pointer:r,angle:c.angle,radius:c.radius,center:c.center}};m.addPointer=function(z){var r=z.native.pointerId;const c=n(this.activePointerMap).angle;z={event:z,initialAngle:0,lastAngle:0};this.activePointerMap.set(r,z);r=h(z,e(this.activePointerMap));z.initialAngle=r;z.lastAngle=r;this.updatePointerAngles(c)};
m.updatePointer=function(z){if(!z||null!=z.x||null!=z.y){var r=this.activePointerMap.get(z.native.pointerId);r?r.event=z:this.addPointer(z)}};m.removePointer=function(z){const r=n(this.activePointerMap).angle;this.activePointerMap.delete(z);this.updatePointerAngles(r)};m.updatePointerAngles=function(z){const r=n(this.activePointerMap);this.activePointerMap.forEach(c=>{c.initialAngle=h(c,r)-z;c.lastAngle=h(c,r)-z})};m.emitEvent=function(z,r,c){const d=n(this.activePointerMap);this.drag.emit(this.createPayload(z,
r,d,c),void 0,this.startStateModifiers)};m.handlePointerUpAndPointerLost=function(z){const r=z.data.native.pointerId,c=p.Milliseconds(z.timestamp);this.activePointerMap.get(r)&&(1===this.activePointerMap.size?(this.updatePointer(z.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",z.data,c),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(r)):(this.removePointer(r),this.emitEvent("removed",z.data,p.Milliseconds(z.timestamp))))};m.handlePointerDrag=function(z){const r=z.data,
c=r.currentEvent,d=p.Milliseconds(z.timestamp);switch(r.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),!this.isCurrentDragSuppressed&&this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",c,d),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(c),this.pointerType=z.data.startEvent.pointerType,this.mouseButton=z.data.startEvent.button,this.startStateModifiers=z.modifiers,this.isDragging=!0,
this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",c,d))}};u._createClass(l,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return l}(t.InputHandler);a.Button=void 0;(function(k){k[k.Left=0]="Left";k[k.Middle=1]="Middle";k[k.Right=2]="Right";k[k.Back=3]="Back";k[k.Forward=4]="Forward";k[k.Undefined=-1]="Undefined"})(a.Button||
(a.Button={}));a.Drag=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,u){a.euclideanDistance=function(f,p){const t=p.x-f.x;f=p.y-f.y;return Math.sqrt(t*t+f*f)};a.fitCircleLSQ=function(f,p){p?(p.radius=0,p.center.x=0,p.center.y=0):p={radius:0,center:u.createScreenPoint()};if(0===f.length)return p;if(1===f.length)return p.center.x=f[0].x,p.center.y=f[0].y,p;if(2===f.length){const [c,d]=
f,[g,A]=[d.x-c.x,d.y-c.y];p.radius=Math.sqrt(g*g+A*A)/2;p.center.x=(c.x+d.x)/2;p.center.y=(c.y+d.y)/2;return p}let t=0,w=0;for(p=0;p<f.length;p++)t+=f[p].x,w+=f[p].y;t/=f.length;w/=f.length;var e=f.map(c=>c.x-t),n=f.map(c=>c.y-w);let b=p=0;var h=0,k=0,l=0,m=0,z=0;for(var r=0;r<e.length;r++){const c=e[r],d=n[r],g=c*c,A=d*d;p+=g;b+=A;h+=c*d;k+=g*c;l+=A*d;m+=c*A;z+=d*g}e=p;n=h;r=b;k=.5*(k+m);l=.5*(l+z);z=e*r-h*n;m=(k*r-l*n)/z;l=(e*l-h*k)/z;z=u.createScreenPoint(m+t,l+w);return{radius:Math.sqrt(m*m+l*
l+(p+b)/f.length),center:z}};a.manhattanDistance=function(f,p){return Math.abs(p.x-f.x)+Math.abs(p.y-f.y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,u,f,p,t,w){p=function(e){function n(h=t.DefaultParameters.maximumDoubleClickDelay,k=t.DefaultParameters.maximumDoubleClickDistance,
l=t.DefaultParameters.maximumDoubleTouchDelay,m=t.DefaultParameters.maximumDoubleTouchDistance,z=f["default"]){var r=e.call(this,!1)||this;r.maximumDoubleClickDelay=h;r.maximumDoubleClickDistance=k;r.maximumDoubleTouchDelay=l;r.maximumDoubleTouchDistance=m;r._clock=z;r._pointerState=new Map;r._immediateDoubleClick=r.registerOutgoing("immediate-double-click");r.registerIncoming("pointer-down",r._handlePointerDown.bind(u._assertThisInitialized(r)));r.registerIncoming("pointer-up",c=>{r._handlePointerLoss(c,
"pointer-up")});r.registerIncoming("pointer-capture-lost",c=>{r._handlePointerLoss(c,"pointer-capture-lost")});r.registerIncoming("pointer-cancel",c=>{r._handlePointerLoss(c,"pointer-cancel")});return r}u._inheritsLoose(n,e);var b=n.prototype;b.onUninstall=function(){this._pointerState.forEach(h=>{h.immediateDoubleClick&&h.immediateDoubleClick.timeoutHandle.remove()});e.prototype.onUninstall.call(this)};b._handlePointerDown=function(h){h=h.data;const k=this._pointerId(h);this._pointerState.has(k)||
(this._pointerState.set(k,{downButton:h.native.button,immediateDoubleClick:null}),this.startCapturingPointer(h.native))};b._handlePointerLoss=function(h,k){const l=h.data;var m=this._pointerId(l);if((m=this._pointerState.get(m))&&"pointer-up"===k&&m.downButton===l.native.button)if(k=m.immediateDoubleClick){k.timeoutHandle.remove();const z="touch"===h.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;w.manhattanDistance(k,h.data)>z?this._startImmediateDoubleClick(h,
m):(this._immediateDoubleClick.emit(h.data,void 0,k.modifiers),this._removeState(l))}else this._startImmediateDoubleClick(h,m)};b._startImmediateDoubleClick=function(h,k){k.immediateDoubleClick={x:h.data.x,y:h.data.y,modifiers:h.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(h.data),"touch"===h.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};b._pointerId=function(h){h=h.native;return"mouse"===h.pointerType?`${h.pointerId}:${h.button}`:`${h.pointerType}`};
b._removeState=function(h){const k=this._pointerId(h);this._pointerState.delete(k);this.stopCapturingPointer(h.native);this.refreshHasPendingInputs()};return n}(p.InputHandler);a.ImmediateDoubleClick=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(a,u,f,p,t,w){const e={maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};t=function(n){function b(k=e.maximumDoubleClickDelay,l=e.maximumDoubleClickDistance,m=e.maximumDoubleTouchDelay,z=e.maximumDoubleTouchDistance,r=f["default"]){var c=n.call(this,!1)||this;c.maximumDoubleClickDelay=k;c.maximumDoubleClickDistance=l;c.maximumDoubleTouchDelay=m;c.maximumDoubleTouchDistance=z;c._clock=r;c._pointerState=new Map;c._click=c.registerOutgoing("click");c._doubleClick=c.registerOutgoing("double-click");
c.registerIncoming("immediate-click",c._handleImmediateClick.bind(u._assertThisInitialized(c)));c.registerIncoming("pointer-drag",c._handlePointerDrag.bind(u._assertThisInitialized(c)));c.registerIncoming("drag",c._handleDrag.bind(u._assertThisInitialized(c)));return c}u._inheritsLoose(b,n);var h=b.prototype;h.onUninstall=function(){this._pointerState.forEach(k=>{null!=k.doubleClickTimeout&&(k.doubleClickTimeout.remove(),k.doubleClickTimeout=null)})};h._pointerId=function(k){k=k.native;return"mouse"===
k.pointerType?`${k.pointerId}:${k.button}`:`${k.pointerType}`};h._handleImmediateClick=function(k){const l=k.data,m=this._pointerId(l),z=this._pointerState.get(m);if(z){const r="touch"===l.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;w.manhattanDistance(z.event.data,l)>r?(this._clearDoubleClickTimeout(m,!0),this._startClick(k)):(this._clearDoubleClickTimeout(m,!1),this._doubleClick.emit(z.event.data,void 0,z.event.modifiers))}else this._startClick(k)};h._startClick=
function(k){const l=this._pointerId(k.data);this._pointerState.set(l,{event:k,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(l),"touch"===k.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};h._handlePointerDrag=function(k){k=this._pointerId(k.data.currentEvent);this._clearDoubleClickTimeout(k,!0)};h._handleDrag=function(k){k=this._pointerId(k.data.pointer);this._clearDoubleClickTimeout(k,!0)};h._clearDoubleClickTimeout=
function(k,l){const m=this._pointerState.get(k);m&&(m.doubleClickTimeout.remove(),m.doubleClickTimeout=null,l&&this._doubleClickTimeoutExceeded(k),this._pointerState.delete(k),this.refreshHasPendingInputs())};h._doubleClickTimeoutExceeded=function(k){const l=this._pointerState.get(k);this._click.emit(l.event.data,void 0,l.event.modifiers);l.doubleClickTimeout=null;this._pointerState.delete(k);this.refreshHasPendingInputs()};u._createClass(b,[{key:"hasPendingInputs",get:function(){return p.someMap(this._pointerState,
k=>null!=k.doubleClickTimeout)}}]);return b}(t.InputHandler);a.DefaultParameters=e;a.SingleAndDoubleClick=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,u,f,p,t){const w={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};p=function(e){function n(h=
w.maximumClickDelay,k=w.movementUntilMouseDrag,l=w.movementUntilPenDrag,m=w.movementUntilTouchDrag,z=w.holdDelay,r=f["default"]){var c=e.call(this,!1)||this;c.maximumClickDelay=h;c.movementUntilMouseDrag=k;c.movementUntilPenDrag=l;c.movementUntilTouchDrag=m;c.holdDelay=z;c._clock=r;c._pointerState=new Map;c._pointerDrag=c.registerOutgoing("pointer-drag");c._immediateClick=c.registerOutgoing("immediate-click");c._pointerHold=c.registerOutgoing("hold");c.registerIncoming("pointer-down",c._handlePointerDown.bind(u._assertThisInitialized(c)));
c.registerIncoming("pointer-up",d=>{c._handlePointerLoss(d,"pointer-up")});c.registerIncoming("pointer-capture-lost",d=>{c._handlePointerLoss(d,"pointer-capture-lost")});c.registerIncoming("pointer-cancel",d=>{c._handlePointerLoss(d,"pointer-cancel")});c._moveHandle=c.registerIncoming("pointer-move",c._handlePointerMove.bind(u._assertThisInitialized(c)));c._moveHandle.pause();return c}u._inheritsLoose(n,e);var b=n.prototype;b.onUninstall=function(){this._pointerState.forEach(h=>{null!=h.holdTimeout&&
(h.holdTimeout.remove(),h.holdTimeout=null)});e.prototype.onUninstall.call(this)};b._handlePointerDown=function(h){const k=h.data,l=k.native.pointerId;var m=null;0===this._pointerState.size&&(m=this._clock.setTimeout(()=>{const z=this._pointerState.get(l);z&&(z.isDragging||(this._pointerHold.emit(z.previousEvent,void 0,h.modifiers),z.holdEmitted=!0),z.holdTimeout=null)},this.holdDelay));m={startEvent:k,previousEvent:k,startTimestamp:h.timestamp,isDragging:!1,downButton:k.native.button,holdTimeout:m,
modifiers:new Set};this._pointerState.set(l,m);this.startCapturingPointer(k.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(h)};b._createPointerDragData=function(h,k,l){return{action:h,startEvent:k.startEvent,previousEvent:k.previousEvent,currentEvent:l}};b._handlePointerMove=function(h){const k=h.data,l=this._pointerState.get(k.native.pointerId);if(l){if(l.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",l,k),void 0,l.modifiers);else{const m=
t.euclideanDistance(k,l.startEvent),z=this._getDragThreshold(k.native.pointerType);m>z&&this.startDragging(h)}l.previousEvent=k}};b._getDragThreshold=function(h){switch(h){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};b.startDragging=function(h){const k=h.data,l=k.native.pointerId;this._pointerState.forEach(m=>{null!=m.holdTimeout&&(m.holdTimeout.remove(),m.holdTimeout=null);m.isDragging||(m.modifiers=h.modifiers,
m.isDragging=!0,l===m.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",m,k)):this._pointerDrag.emit(this._createPointerDragData("start",m,m.previousEvent),h.timestamp))})};b._handlePointerLoss=function(h,k){const l=h.data,m=l.native.pointerId,z=this._pointerState.get(m);z&&(null!=z.holdTimeout&&(z.holdTimeout.remove(),z.holdTimeout=null),z.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",z,"pointer-up"===k?l:z.previousEvent),void 0,z.modifiers):
"pointer-up"===k&&z.downButton===l.native.button&&h.timestamp-z.startTimestamp<=this.maximumClickDelay&&!z.holdEmitted&&this._immediateClick.emit(l),this._pointerState.delete(m),this.stopCapturingPointer(l.native),0===this._pointerState.size&&this._moveHandle.pause())};return n}(p.InputHandler);a.DefaultParameters=w;a.PointerClickHoldAndDrag=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../DragEventSeparator","../InputHandler"],function(a,u,f,p){p=function(t){function w(n=20,b=40){var h=t.call(this,!1)||this;h._threshold=n;h._maxDelta=b;h.state="ready";h.emittedArtificalEnd2=!1;h._vertical=h.registerOutgoing("vertical-two-finger-drag");h._artificalDrag=h.registerOutgoing("drag");h.dragEventSeparator=new f.DragEventSeparator({start:(k,l)=>h.observeStart(k,l),update:(k,l,m)=>h.observeUpdate(k,l,m),end:(k,l)=>h.observeEnd(l)});h.registerIncoming("drag",k=>h.dragEventSeparator.handle(k));
return h}u._inheritsLoose(w,t);var e=w.prototype;e.observeStart=function(n,b){1===n&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center}),b.stopPropagation());this.state=2===n?"ready":"failed"};e.observeUpdate=function(n,b,h){"failed"!==this.state&&
2===n&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,h.data)?this.checkVerticalThresholdReached(b.data,h.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,
angle:b.data.angle,radius:b.data.radius,center:b.data.center}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};e.observeEnd=function(n){"active"===this.state&&(this._vertical.emit({delta:n.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",n.stopPropagation())};e.checkMovementWithinLimits=function(n,b){let h=-Infinity,k=Infinity,l=-Infinity,m=Infinity;b.pointers.forEach(g=>{h=Math.max(h,
g.x);k=Math.min(k,g.x);l=Math.max(l,g.y);m=Math.min(m,g.y)});let z=-Infinity,r=Infinity,c=-Infinity,d=Infinity;n.pointers.forEach(g=>{z=Math.max(z,g.x);r=Math.min(r,g.x);c=Math.max(c,g.y);d=Math.min(d,g.y)});return Math.abs(n.center.x-b.center.x)<this._threshold&&Math.abs(z-r-(h-k))<=this._maxDelta&&Math.abs(c-d-(l-m))<=this._maxDelta};e.checkVerticalThresholdReached=function(n,b){let h=Math.abs(n.center.y-b.center.y);n.pointers.forEach((k,l)=>{l=b.pointers.get(l);h=Math.min(h,Math.abs(k.y-l.y))});
return h>=this._threshold};u._createClass(w,[{key:"failed",get:function(){return"failed"===this.state}}]);return w}(p.InputHandler);a.VerticalTwoFingerDrag=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let u=function(){function f(t){this.callbacks=t;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var p=f.prototype;p.handle=function(t){const w=t.data,e=w.pointers.size;switch(w.action){case "start":this.currentCount=
e;this.emitStart(t);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(t);break;case "update":this.emitUpdate(t);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(t);break;case "end":this.emitEnd(t),this.currentCount=0}this.previousEvent=t};p.emitStart=function(t){this.startEvent=t;this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)};p.emitUpdate=function(t){this.callbacks.condition(this.currentCount,
t)&&this.callbacks.update(this.currentCount,t,this.startEvent)};p.emitEnd=function(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent);this.startEvent=null};return f}();a.DragEventSeparator=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){function g(q){q=q.layer;return!(!q||!q.featureReduction||"selection"!==q.featureReduction.type)}function A(q){(q=q.graphics3DGraphics)&&q.forEach(y=>y.clearVisibilityFlag(3))}a.GraphicsDeconflictor=function(q){function y(){var D=q.apply(this,arguments)||this;D._handles=new p;D._contexts=new Map;D._viewState=new r.DeconflictorViewState;D.visibilityGroup=0;D._iconMarginFactor=-.1;return D}u._inheritsLoose(y,q);var x=y.prototype;x.initialize=function(){this._handles.add([this.view.watch("state.camera",
()=>{this.updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(D,C)=>{1!==D&&1!==C||this.setDirty()}),e.init(this.view,"slicePlane",()=>{this.updateSlicePlane();this.slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(d.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new c.LabelDeconflictor({view:this.view,parent:this})};x.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&
(this._frameTask.remove(),this._frameTask=null)};x.setDirty=function(){0<this._contexts.size&&(q.prototype.setDirty.call(this),this._labels.setDirty())};x.runTask=function(D){q.prototype.runTask.call(this,D);this.running||this._labels.setDirty()};x.setInitialIconVisibilityFlag=function(D,C){D=!(this._graphicSupportsDeconfliction(C)&&g(D));C.setVisibilityFlag(3,D,0)};x.updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this.updateSlicePlane())};
x.updateSlicePlane=function(){const D=this.view?this.view.slicePlane:null;w.isSome(D)&&z.transform(D,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=w.isSome(D)};x.slicePlaneChanged=function(){t.someMap(this._contexts,(D,C)=>C.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};x.addGraphicsOwner=function(D){let C=this._contexts.get(D);null==C&&(C=new Map,this._contexts.set(D,C),this.setDirty());return{addGraphic:B=>this.addGraphic(D,C,B),removeGraphic:B=>
this.removeGraphic(C,B),labelingInfoChange:()=>this._labels.enabledChanged(D,C),featureReductionChange:()=>this.enabledChanged(D,C),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(D,C),clear:()=>C.forEach(B=>this.removeGraphic(C,B.graphics3DGraphic))}};x.removeGraphicsOwner=function(D){const C=this._contexts.get(D);C&&(C.forEach(B=>this.removeGraphic(C,B.graphics3DGraphic)),this._contexts.delete(D),this.setDirty())};x.addGraphic=function(D,C,B){const v=B.graphic.uid;B=new r.DeconflictorGraphic(B,
D.symbolCreationContext.slicePlaneEnabled);C.set(v,B);g(D)&&this.addToActiveGraphics(B);D.labelsEnabled&&this._labels.addToActiveGraphics(B)};x.removeGraphic=function(D,C){C=C.graphic.uid;const B=D.get(C);B&&(this.removeFromActiveGraphics(B),this._labels.removeFromActiveGraphics(B),D.delete(C),this.setDirty())};x.enabledChanged=function(D,C){const B=g(D);B||A(D);this.modifyGraphics(C,B)};x._slicePlaneEnabledChanged=function(D,C){const B=D.symbolCreationContext.slicePlaneEnabled;C.forEach(v=>v.slicePlaneEnabled=
B);this.setDirty()};x.getGraphicsLayers=function(D){return D._graphics};x._graphicSupportsDeconfliction=function(D){if(D.isDraped)return!1;D=D._graphics;if(!D||!D.length)return!1;for(const C of D)if(this.layerSupportsDeconfliction(C))return!0;return!1};u._createClass(y,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(D){this._iconMarginFactor=D;this.setDirty()}}]);
return y}(r.Deconflictor);a.GraphicsDeconflictor=f.__decorate([m.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N){function*I(U){if(Map.prototype.entries){U=U.entries();for(let Z=U.next();!Z.done;Z=U.next())yield Z.value[1]}else yield*U.values()}function*G(U,Z,T){Z.clear();U.forEach((X,aa)=>{const ja=Z.pushNew();ja.id=aa;ja.prio=X.info?-X.info[T].distance:Number.MAX_VALUE});yield;const P=Z.iterableSort((X,aa)=>aa.prio-X.prio);for(let X=P.next();!X.done;X=P.next())yield;Z.forAll(X=>{const aa=U.get(X.id);aa&&(U.delete(X.id),U.set(X.id,aa))});
Z.clear()}const K=g.create(),H=q.create(),J=q.create(),M=g.create(),O=r.create(),Q=B.create(),S=C.create(),V=g.create(),Y=x.create();let W=function(){this.aabr=x.create();this.distance=0;this.visible=this.culled=!1},ba=function(){function U(){this.active=new Map;this.visible=new Map}U.prototype.clear=function(){this.active.clear();this.visible.clear()};return U}(),ca=function(){},da=function(){this.sortArray=new e({allocator:U=>U||new ca})},ha=function(){function U(){this.camera=new F;this.slicePlane=
D.create();this.slicePlaneEnabled=!1}U.prototype.copyFrom=function(Z){this.camera.copyFrom(Z.camera);D.copy(Z.slicePlane,this.slicePlane);this.slicePlaneEnabled=Z.slicePlaneEnabled};return U}();a.Deconflictor=function(U){function Z(){var P=U.apply(this,arguments)||this;P._dirty=!1;P._runningViewState=new ha;P._state=0;P.graphics=new ba;P.iterators=new da;P.accBinsNumX=15;P.accBinsNumY=20;P.accBinsSizeX=0;P.accBinsSizeY=0;P.accBins=null;P.accNumTests=0;return P}u._inheritsLoose(Z,U);var T=Z.prototype;
T.destroy=function(){this.graphics.clear();this.iterators=null};T.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};T.runTask=function(P){switch(this._state){case 0:this.startUpdate(),P.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(P))break;case 2:if(this._state=2,!this.sortVisibleGraphics(P))break;case 3:if(this._state=3,!this.deconflictVisibleGraphics(P))break;default:v.drawAccelerationStruct(this,this.graphics.visible),
this._state=0,this.notifyChange("updating")}};T.modifyGraphics=function(P,X){X?P.forEach(aa=>this.addToActiveGraphics(aa)):P.forEach(aa=>this.removeFromActiveGraphics(aa));this.setDirty()};T.layerSupportsDeconfliction=function(P){if(w.isNone(P)||"object3d"!==P.type)return!1;P=P.stageObject;return 1===(P?P.getNumGeometryRecords():0)&&P.getGeometryRecord(0).material instanceof N.HUDMaterial?!0:!1};T.startUpdate=function(){v.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);
const {fullWidth:P,fullHeight:X}=this._runningViewState.camera;this.initBins(P,X);this.resetIterators()};T.addToActiveGraphics=function(P){P.info[this.visibilityGroup]=new W;this.graphics.active.set(P.graphics3DGraphic.graphic.uid,P);this.setDirty()};T.removeFromActiveGraphics=function(P){this.removeFromVisibleGraphics(P);{const X=P.graphics3DGraphic;X.destroyed||X.clearVisibilityFlag(3,this.visibilityGroup)}delete P.info[this.visibilityGroup];this.graphics.active.delete(P.graphics3DGraphic.graphic.uid);
this.setDirty()};T.addToVisibleGraphics=function(P){this.graphics.visible.set(P.graphics3DGraphic.graphic.uid,P)};T.removeFromVisibleGraphics=function(P){this.graphics.visible.delete(P.graphics3DGraphic.graphic.uid)};T.processActiveGraphics=function(P){const X=this.ensureActiveGraphicsIterator(),aa=z.invert(O,this._runningViewState.camera.projectionMatrix),ja="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?Q:null;let ia=0;w.isSome(ja)&&
(d.transformMat4(ja,g.ZEROS,this._runningViewState.camera.viewMatrix),ja[3]=y.getReferenceEllipsoid(this.view.spatialReference).radius,ia=B.distanceToSilhouette(ja,g.ZEROS));for(;!P.done;){P.madeProgress();var ka=X.next();if(ka.done)return this.resetActiveGraphicsIterator(),!0;const na=(ka=ka.value)&&ka.info[this.visibilityGroup];na&&(this.collectGraphics3DGraphics(ka,aa,ja,ia),na.culled?this.removeFromVisibleGraphics(ka):this.addToVisibleGraphics(ka))}return!1};T.sortVisibleGraphics=function(P){const X=
this.ensureSortGraphicsIterator();for(;!P.done;){const aa=X.next();P.madeProgress();if(aa.done)return this.resetSortGraphicsIterator(),!0}return!1};T.deconflictVisibleGraphics=function(P){const X=this.ensureVisibleGraphicsIterator(),aa=1===this.visibilityGroup;for(;!P.done;){P.madeProgress();var ja=X.next();if(ja.done)return this.resetVisibleGraphicsIterator(),!0;ja=ja.value;const ka=ja.info[this.visibilityGroup];if(ka&&!ka.culled){var ia=ja.graphics3DGraphic;(ia=(!aa||ia.isVisible())&&!this.isConflicted(ja))&&
this.addToBins(ja);ka.visible=ia;this.setGraphicVisibility(ja,ia);v.drawPoly(ka,ia)}}return!1};T.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};T.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=I(this.graphics.active));return this.iterators.active};T.resetActiveGraphicsIterator=function(){this.iterators.active=null};T.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=
I(this.graphics.visible));return this.iterators.visible};T.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};T.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=G(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};T.resetSortGraphicsIterator=function(){this.iterators.sort=null};T.collectGraphics3DGraphics=function(P,X,aa,ja){var ia=P.graphics3DGraphic;if(!ia.destroyed){var ka=P.info[this.visibilityGroup];
if(ia.isVisible(0,3)){var na=this.getGraphicsLayers(ia);x.empty(ka.aabr);ia=null;for(const ta of na)if(this.layerSupportsDeconfliction(ta)){na=ta.stageObject.getGeometryRecord(0).material;if(w.isNone(ia)){ia=this.getProjectionInfo(ta,X,R);if(ia.isOutsideScreen||this.isCulledBySlice(P,K)||w.isSome(aa)&&this.isCulledByHorizon(ia,aa,ja)){ka.culled=!0;return}!E.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&ka.visible&&(ia.distance*=.7)}this.expandBoundingRect(ka,ta,na,ia)}w.isNone(ia)?ka.culled=!0:(ka.distance=
ia.distance,ka.culled=!1)}else ka.culled=!0}};T.getProjectionInfo=function(P,X,aa){const ja=this._runningViewState.camera;P=P.stageObject;var ia=P.getGeometryRecord(0);const ka=ia.material;var na=B.getCenter(P.boundingVolumeWorldSpace.bounds);d.transformMat4(K,na,ja.viewMatrix);na=ia.geometry.vertexAttributes;ia=na.get("normal").data;na=na.get("auxpos1").data;ka.applyShaderOffsetsView(K,ia,P.transformation,na,ja,aa.scaleInfo,K);A.set(H,K[0],K[1],K[2],1);A.transformMat4(J,H,ja.projectionMatrix);d.scale(aa.positionNDC,
J,1/J[3]);ka.applyShaderOffsetsNDC(aa.positionNDC,na,ja,aa.positionNDC,M);aa.distanceWithoutPolygonOffset=ja.depthNDCToWorld(M[2]);aa.distance=M[2]===aa.positionNDC[2]?aa.distanceWithoutPolygonOffset:ja.depthNDCToWorld(aa.positionNDC[2]);A.set(J,aa.positionNDC[0],aa.positionNDC[1],aa.positionNDC[2],1);A.transformMat4(H,J,X);A.scale(H,H,1/H[3]);d.set(aa.positionView,K[0],K[1],K[2]);return aa};T.isCulledByHorizon=function(P,X,aa){d.copy(S.direction,P.positionView);d.set(S.origin,0,0,0);return B.intersectRay(X,
S,V)?P.distanceWithoutPolygonOffset>aa:!1};T.isCulledBySlice=function(P,X){return P.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&D.extrusionContainsPoint(this._runningViewState.slicePlane,X)};T.expandBoundingRect=function(P,X,aa,{positionNDC:ja,scaleInfo:ia}){const ka=this._runningViewState.camera;X=X.getScreenSize(fa);L.applyPrecomputedScaleFactor(X,ia.factor,X);X[0]*=ka.pixelRatio;X[1]*=ka.pixelRatio;aa=x.offset(aa.calculateRelativeScreenBounds(X,ia.factorAlignment.scale,Y),t.lerp(0,
ka.fullWidth,.5+.5*ja[0]),t.lerp(0,ka.fullHeight,.5+.5*ja[1]));ja=this.iconMarginFactor;0!==ja&&(ja*=Math.min(x.width(aa),x.height(aa)),aa[0]-=ja,aa[1]-=ja,aa[2]+=ja,aa[3]+=ja);x.expand(P.aabr,aa)};T.isConflicted=function(P){const X=P.graphics3DGraphic.graphic.uid;P=P.info[this.visibilityGroup];for(let aa=Math.floor(P.aabr[0]/this.accBinsSizeX);aa<=Math.floor(P.aabr[2]/this.accBinsSizeX);aa++)if(!(0>aa||aa>=this.accBinsNumX))for(let ja=Math.floor(P.aabr[1]/this.accBinsSizeY);ja<=Math.floor(P.aabr[3]/
this.accBinsSizeY);ja++){if(0>ja||ja>=this.accBinsNumY)continue;const ia=this.accBins[aa][ja];for(let ka=0;ka<ia.length;ka++){const na=ia.data[ka],ta=na.info[this.visibilityGroup];if(ta&&ta.visible&&na.graphics3DGraphic.graphic.uid!==X&&(this.accNumTests++,x.intersects(ta.aabr,P.aabr)))return!0}}return!1};T.initBins=function(P,X){if(null==this.accBins){this.accBins=[];for(var aa=0;aa<this.accBinsNumX;aa++){this.accBins.push([]);var ja=this.accBins[this.accBins.length-1];for(let ia=0;ia<this.accBinsNumY;ia++)ja.push(new e)}}else for(aa=
0;aa<this.accBinsNumX;aa++)for(ja=0;ja<this.accBinsNumY;ja++)this.accBins[aa][ja].clear();this.accBinsSizeX=P/this.accBinsNumX;this.accBinsSizeY=X/this.accBinsNumY;this.accNumTests=0};T.addToBins=function(P){var X=P.info[this.visibilityGroup],aa=Math.floor(X.aabr[0]/this.accBinsSizeX);const ja=Math.floor(X.aabr[2]/this.accBinsSizeX),ia=Math.floor(X.aabr[1]/this.accBinsSizeY);for(X=Math.floor(X.aabr[3]/this.accBinsSizeY);aa<=ja;aa++)if(!(0>aa||aa>=this.accBinsNumX))for(let ka=ia;ka<=X;ka++)0>ka||ka>=
this.accBinsNumY||this.accBins[aa][ka].push(P)};T.setGraphicVisibility=function(P,X){P=P.graphics3DGraphic;P.destroyed||(P.setVisibilityFlag(3,X,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(P,X))};u._createClass(Z,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return 0!==this._state||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const P=
this._state/4;return this._dirty?.5*P:P}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return Z}(p);f.__decorate([n.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);f.__decorate([n.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=f.__decorate([m.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);const fa=c.create(),R=new (function(){function U(){this.positionView=
g.create();this.positionNDC=g.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}u._createClass(U,[{key:"isOutsideScreen",get:function(){const Z=this.positionNDC;return-1>Z[0]||-1>Z[1]||-1>Z[2]||1<=Z[0]||1<=Z[1]}}]);return U}());a.DeconflictorGraphic=function(U,Z,T={}){this.graphics3DGraphic=U;this.slicePlaneEnabled=Z;this.info=T};a.DeconflictorViewState=
ha;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,u){function f(k,l,m,z,r){n&&(n(),n=null);const c=b.height,d=h;d.beginPath();d.lineWidth=1;d.strokeStyle=r;d.moveTo(k,c-m);d.lineTo(l,c-m);d.stroke();d.lineTo(l,c-z);d.stroke();d.lineTo(l,c-m);d.stroke();d.lineTo(k,c-m);d.stroke();d.lineTo(k,c-m);d.stroke();d.closePath()}let p=!1,t=!1,w=!1,e=!1,n=null,b,h;a.drawAccelerationStruct=
function(k,l){if(t&&h){n&&(n(),n=null);var m=h,z=0;for(let r=0;r<k.accBinsNumX;r++)for(let c=0;c<k.accBinsNumY;c++){const d=k.accBins[r][k.accBinsNumY-1-c];z+=d.length;const g=r*k.accBinsSizeX,A=(r+1)*k.accBinsSizeX,q=c*k.accBinsSizeY,y=(c+1)*k.accBinsSizeY;m.fillText(d.length.toFixed(),g+5,q+15);f(g,A,q,y,"blue")}m.fillText("total totalShownLabels: "+z,70,40);m.fillText("total visible labels: "+l.size,70,50);m.fillText("total numTests: "+k.accNumTests,70,30)}};a.drawPoly=function(k,l){p&&(l&&w||
!l&&e)&&f(k.aabr[0],k.aabr[2],k.aabr[1],k.aabr[3],l?"green":"red")};a.prepare=function(k){w=u.DECONFLICTOR_SHOW_VISIBLE;e=u.DECONFLICTOR_SHOW_INVISIBLE;p=w||e;t=u.DECONFLICTOR_SHOW_GRID;n=null;p||t?n=()=>{{null==b&&(b=document.createElement("canvas"),b.setAttribute("id","canvas2d"),k.surface.parentElement.style.position="relative",k.surface.parentElement.appendChild(b));const l=k.height*k.pixelRatio;b.setAttribute("width",`${k.width*k.pixelRatio}px`);b.setAttribute("height",`${l}px`);b.setAttribute("style",
`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${k.width}px;height:${k.height}px`);h=b.getContext("2d");h.clearRect(0,0,k.width,k.height);h.font="12px Arial"}}:b&&(b.parentElement.removeChild(b),b=null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b){f=function(h){function k(){var l=h.apply(this,arguments)||this;l.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;l.SCENEVIEW_LOCKING_LOG=!1;l.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0;l.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;l.DECONFLICTOR_SHOW_VISIBLE=!1;l.DECONFLICTOR_SHOW_INVISIBLE=!1;l.DECONFLICTOR_SHOW_GRID=!1;l.LABELS_SHOW_BORDER=!1;l.OVERLAY_DRAW_DEBUG_TEXTURE=!1;l.OVERLAY_SHOW_CENTER=!1;l.SHOW_POI=!1;l.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;l.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;l.DRAW_MESH_GEOMETRY_NORMALS=!1;l.FEATURE_TILE_FETCH_SHOW_TILES=!1;l.FEATURE_TILE_TREE_SHOW_TILES=!1;l.TERRAIN_TILE_TREE_SHOW_TILES=!1;l.I3S_TREE_SHOW_TILES=!1;l.I3S_SHOW_MODIFICATIONS=!1;l.ENABLE_PROFILE_DEPTH_RANGE=!1;l.DISABLE_FAST_UPDATES=!1;l.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;l.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;l.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return l}a._inheritsLoose(k,h);return k}(f);u.__decorate([p.property()],f.prototype,
"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);u.__decorate([p.property()],f.prototype,"SCENEVIEW_LOCKING_LOG",void 0);u.__decorate([p.property()],f.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0);u.__decorate([p.property()],f.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);u.__decorate([p.property()],f.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);u.__decorate([p.property()],f.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);u.__decorate([p.property()],f.prototype,"DECONFLICTOR_SHOW_GRID",
void 0);u.__decorate([p.property()],f.prototype,"LABELS_SHOW_BORDER",void 0);u.__decorate([p.property()],f.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);u.__decorate([p.property()],f.prototype,"OVERLAY_SHOW_CENTER",void 0);u.__decorate([p.property()],f.prototype,"SHOW_POI",void 0);u.__decorate([p.property()],f.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);u.__decorate([p.property()],f.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);u.__decorate([p.property()],f.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",
void 0);u.__decorate([p.property()],f.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);u.__decorate([p.property()],f.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);u.__decorate([p.property()],f.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);u.__decorate([p.property()],f.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);u.__decorate([p.property()],f.prototype,"I3S_TREE_SHOW_TILES",void 0);u.__decorate([p.property()],f.prototype,"I3S_SHOW_MODIFICATIONS",void 0);u.__decorate([p.property()],f.prototype,
"ENABLE_PROFILE_DEPTH_RANGE",void 0);u.__decorate([p.property()],f.prototype,"DISABLE_FAST_UPDATES",void 0);u.__decorate([p.property()],f.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);u.__decorate([p.property()],f.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);u.__decorate([p.property()],f.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);f=u.__decorate([b.subclass("esri.views.3d.support.DebugFlags")],f);return new f})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(a,u,f){function p(k,l,m){const z=m.parameters;m=m.paddingPixelsOverride;b.scale=Math.min(z.divisor/(l-z.offset),1);b.factor=Math.abs(k*k*k);b.minPixelSize=z.minPixelSize;b.paddingPixels=m;return b}function t(k,l){return 0===k?l.minPixelSize:l.minPixelSize*(1+2*l.paddingPixels/k)}function w(k,l){return Math.max(f.lerp(k*l.scale,k,l.factor),t(k,l))}let e=function(){function k(m,z,r,c={camera:{distance:0,fovY:0},divisor:0,
offset:0,minPixelSize:0,paddingPixels:0},d){this.viewingMode=m;this.description=z;this.ellipsoidRadius=r;this.parameters=c;this._paddingPixelsOverride=d;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}var l=k.prototype;
l.update=function(m){if(this.parameters&&this.parameters.camera.fovY===m.fovY&&this.parameters.camera.distance===m.distance)return!1;this.calculateParameters(m,this.ellipsoidRadius,this.parameters);return!0};l.overridePadding=function(m){return m!==this.paddingPixelsOverride?new k(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,m):this};l.calculateParameters=function(m,z,r){const {scaleStart:c,scaleFallOffRange:d,minPixelSize:g}=this.description,{fovY:A,distance:q}=m;var y=
this.calculateCurvatureDependentParameters(m,z);z=this.coverageCompensation(m,z,y);const {tiltAngle:x,scaleFallOffFactor:D}=y,C=Math.sin(x)*q,B=.5*Math.PI-x-A*(.5-c*z);y=C/Math.cos(B);z=(y-C/Math.cos(B+A*d*z)*D)/(1-D);r.camera.fovY=m.fovY;r.camera.distance=m.distance;r.offset=z;r.divisor=y-z;r.minPixelSize=g;return r};l.calculateCurvatureDependentParametersLocal=function(m,z,r=h){r.tiltAngle=this.description.curvatureDependent.min.tiltAngle;r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return r};l.calculateCurvatureDependentParametersGlobal=function(m,z,r=h){const c=this.description.curvatureDependent;m=1+m.distance/z;m=Math.sqrt(m*m-1);const [d,g]=[c.min.curvature,c.max.curvature];m=f.clamp((m-d)/(g-d),0,1);const [A,q]=[c.min,c.max];r.tiltAngle=f.lerp(A.tiltAngle,q.tiltAngle,m);r.scaleFallOffFactor=f.lerp(A.scaleFallOffFactor,q.scaleFallOffFactor,m);return r};l.surfaceCoverageCompensationLocal=function(m,z,r){return(m.fovY-r.tiltAngle)/m.fovY};l.surfaceCoverageCompensationGlobal=
function(m,z,r){const c=z*z;r=r.tiltAngle+.5*Math.PI;const {fovY:d,distance:g}=m;m=g*g+c-2*Math.cos(r)*g*z;const A=Math.sqrt(m);return(Math.acos(Math.sqrt(m-c)/A)-Math.asin(z/(A/Math.sin(r)))+.5*d)/d};u._createClass(k,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return k}();const n={curvatureDependent:{min:{curvature:f.deg2rad(10),tiltAngle:f.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:f.deg2rad(70),tiltAngle:f.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},b={scale:0,factor:0,minPixelSize:0,paddingPixels:0},h={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(k,l,m=[0,0]){l=Math.min(Math.max(l.scale,t(k[1],l)/k[1]),1);m[0]=k[0]*l;m[1]=k[1]*l;return m};a.applyScaleFactor=w;a.applyScaleFactorVec2=function(k,l,m=[0,0]){const z=Math.min(Math.max(l.scale,t(k[1],l)/k[1]),1);m[0]=f.lerp(k[0]*z,k[0],l.factor);m[1]=f.lerp(k[1]*z,k[1],l.factor);return m};a.getLabelSettings=
function(k,l){const {curvatureDependent:m,scaleStart:z,scaleFallOffRange:r}=n;return new e(k,{curvatureDependent:{min:{curvature:m.min.curvature,tiltAngle:m.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:m.max.curvature,tiltAngle:m.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:z,scaleFallOffRange:r,minPixelSize:14},l)};a.getSettings=function(k,l){return new e(k,n,l)};a.precomputeScaleFactor=function(k,l,m,z){k=p(k,l,m);k.minPixelSize=0;k.paddingPixels=0;k=w(1,k);z.scale=k;z.factor=0;z.minPixelSize=
m.parameters.minPixelSize;z.paddingPixels=m.paddingPixelsOverride};a.scale=function(k,l,m,z){return w(k,p(l,m,z))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v){function E(Z,T,P,X=K){h.copy(X,Z.anchorPos);X[0]*=-T[0];X[1]*=-T[1];X[0]+=Z.screenOffset[0]*P;X[1]+=Z.screenOffset[1]*P;return X}function F(Z,T,P,X,aa,ja,ia,ka){T=T-aa-(0<ka[0]?X[0]*ka[0]:0);let na=T+X[0]+2*aa;P=P-aa-(0<ka[1]?X[1]*ka[1]:0);aa=P+X[1]+2*aa;ia.textureIsSignedDistanceField&&(ia=ia.distanceFieldBoundingBox,T+=X[0]*ia[0],P+=X[1]*ia[1],na-=X[0]*(1-ia[2]),aa-=X[1]*(1-ia[3]),T-=ja,na+=ja,P-=ja,aa+=ja);return Z[0]>T&&Z[0]<na&&Z[1]>
P&&Z[1]<aa}let L=function(Z){function T(X){X=Z.call(this,X,fa)||this;X.techniqueConfig=new v.HUDMaterialTechniqueConfiguration;return X}u._inheritsLoose(T,Z);var P=T.prototype;P.getTechniqueConfig=function(X,aa){this.techniqueConfig.output=X;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled=
"screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===X&&(this.techniqueConfig.debugDrawBorder=
!!this.params.debugDrawBorder);4===X&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;this.techniqueConfig.transparencyPassType=aa?aa.transparencyPassType:3;this.techniqueConfig.multipassGeometryEnabled=aa?aa.multipassGeometryEnabled:!1;this.techniqueConfig.multipassTerrainEnabled=aa?aa.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=aa?aa.cullAboveGround:!1;return this.techniqueConfig};
P.intersect=function(X,aa,ja,ia,ka,na,ta,pa,xa){xa?this.intersectDrapedHudGeometry(X,na,ta,pa):this.intersectHudGeometry(X,aa,ja,ia,ta,pa)};P.intersectDrapedHudGeometry=function(X,aa,ja,ia){const ka=X.vertexAttributes.get("position"),na=X.vertexAttributes.get("size"),ta=this.params,pa=B.calculateAnchorPosForRendering(ta);let xa=1;var Da=1;p.isSome(ia)&&(Da=ia(ca),xa=Da[0],Da=Da[5]);xa*=X.screenToWorldRatio;Da*=X.screenToWorldRatio;ia=2*X.screenToWorldRatio;for(let Fa=0;Fa<ka.data.length/ka.size;Fa++){var Ka=
Fa*ka.size;const Ha=ka.data[Ka];Ka=ka.data[Ka+1];const ua=Fa*na.size;da[0]=na.data[ua]*xa;da[1]=na.data[ua+1]*Da;let Ba;ta.textureIsSignedDistanceField&&(Ba=ta.outlineSize*X.screenToWorldRatio/2);F(aa,Ha,Ka,da,ia,Ba,ta,pa)&&ja()}};P.intersectHudGeometry=function(X,aa,ja,ia,ka,na){if(ia.options.selectionMode&&ia.options.hud&&!C.isInstanceHidden(aa)){aa=this.params;var ta=1,pa=1;w.fromMat4(S,ja);if(p.isSome(na)){pa=na(ca);ta=pa[0];pa=pa[5];{na=S;var xa=na[0],Da=na[1],Ka=na[2],Fa=na[3],Ha=na[4],ua=na[5],
Ba=na[6],Ea=na[7],Ga=na[8],ma=1/Math.sqrt(xa*xa+Da*Da+Ka*Ka);const ya=1/Math.sqrt(Fa*Fa+Ha*Ha+ua*ua),Ma=1/Math.sqrt(Ba*Ba+Ea*Ea+Ga*Ga);na[0]=xa*ma;na[1]=Da*ma;na[2]=Ka*ma;na[3]=Fa*ya;na[4]=Ha*ya;na[5]=ua*ya;na[6]=Ba*Ma;na[7]=Ea*Ma;na[8]=Ga*Ma}}na=X.vertexAttributes.get("position");xa=X.vertexAttributes.get("size");Da=X.vertexAttributes.get("normal");X=X.vertexAttributes.get("auxpos1");y.assert(3<=na.size);Ka=ia.point;Fa=ia.camera;Ha=B.calculateAnchorPosForRendering(aa);ta*=Fa.pixelRatio;pa*=Fa.pixelRatio;
ua="screen"===this.params.centerOffsetUnits;for(Ba=0;Ba<na.data.length/na.size;Ba++)if(Ea=Ba*na.size,l.set(H,na.data[Ea],na.data[Ea+1],na.data[Ea+2]),l.transformMat4(H,H,ja),Ea=Ba*xa.size,da[0]=xa.data[Ea]*ta,da[1]=xa.data[Ea+1]*pa,l.transformMat4(H,H,Fa.viewMatrix),Ea=Ba*X.size,l.set(W,X.data[Ea+0],X.data[Ea+1],X.data[Ea+2]),ua||(H[0]+=W[0],H[1]+=W[1],0!==W[2]&&(Ea=W[2],l.normalize(W,H),l.subtract(H,H,l.scale(W,W,Ea)))),Ea=Ba*Da.size,l.set(J,Da.data[Ea],Da.data[Ea+1],Da.data[Ea+2]),this.normalAndViewAngle(J,
S,Fa,ba),this.applyVerticalOffsetTransformationView(H,ba,Fa,G),Fa.applyProjection(H,M),-1<M[0]){Ea=Math.floor(M[0])+this.params.screenOffset[0];Ga=Math.floor(M[1])+this.params.screenOffset[1];ua&&(Ea+=W[0],0!==W[1]&&(Ga+=q.applyScaleFactor(W[1],G.factorAlignment)));q.applyPrecomputedScaleFactor(da,G.factor,da);ma=1*Fa.pixelRatio;let ya;aa.textureIsSignedDistanceField&&(ya=aa.outlineSize*Fa.pixelRatio/2);F(Ka,Ea,Ga,da,ma,ya,aa,Ha)&&(Ga=ia.ray,l.transformMat4(Q,H,n.invert(Y,Fa.viewMatrix)),M[0]=Ka[0],
M[1]=Ka[1],Fa.unprojectFromRenderScreen(M,H)&&(Ea=m.create(),l.copy(Ea,Ga.direction),ma=1/l.length(Ea),l.scale(Ea,Ea,ma),Ga=l.distance(Ga.origin,H)*ma,ka(Ga,Ea,-1,1,!0,Q)))}}};P.computeAttachmentOrigin=function(X,aa){var ja=X.vertexAttributes;if(!ja)return!1;ja=ja.get("position");X=X.indices.get("position");return d.computeAttachmentOriginPoints(ja,X,aa)};P.createBufferWriter=function(){return new U(this)};P.normalAndViewAngle=function(X,aa,ja,ia){z.isMat4(aa)&&(aa=w.fromMat4(V,aa));l.transformMat3(ia.normal,
X,aa);l.transformMat4(ia.normal,ia.normal,ja.viewInverseTransposeMatrix);ia.cosAngle=l.dot(O,ha);return ia};P.updateScaleInfo=function(X,aa,ja){const ia=this.params;ia.screenSizePerspective?q.precomputeScaleFactor(ja,aa,ia.screenSizePerspective,X.factor):(X.factor.scale=1,X.factor.factor=0,X.factor.minPixelSize=0,X.factor.paddingPixels=0);ia.screenSizePerspectiveAlignment?q.precomputeScaleFactor(ja,aa,ia.screenSizePerspectiveAlignment,X.factorAlignment):(X.factorAlignment.factor=X.factor.factor,X.factorAlignment.scale=
X.factor.scale,X.factorAlignment.minPixelSize=X.factor.minPixelSize,X.factorAlignment.paddingPixels=X.factor.paddingPixels)};P.applyShaderOffsetsView=function(X,aa,ja,ia,ka,na,ta){aa=this.normalAndViewAngle(aa,ja,ka,ba);this.applyVerticalGroundOffsetView(X,aa,ka,ta);this.applyVerticalOffsetTransformationView(ta,aa,ka,na);this.applyPolygonOffsetView(ta,aa,ia[3],ka,ta);this.applyCenterOffsetView(ta,ia,ta);return ta};P.applyShaderOffsetsNDC=function(X,aa,ja,ia,ka){this.applyCenterOffsetNDC(X,aa,ja,ia);
p.isSome(ka)&&l.copy(ka,ia);this.applyPolygonOffsetNDC(ia,aa,ja,ia);return ia};P.applyPolygonOffsetView=function(X,aa,ja,ia,ka){var na=ia.aboveGround?1:-1;ja=f.sign(ja);0===ja&&(ja=na);na*=ja;if(0>=this.params.shaderPolygonOffset)return l.copy(ka,X);aa=f.clamp(Math.abs(aa.cosAngle),.01,1);ia=1-Math.sqrt(1-aa*aa)/aa/ia.viewport[2];0<na?l.scale(ka,X,ia):l.scale(ka,X,1/ia);return ka};P.applyVerticalGroundOffsetView=function(X,aa,ja,ia){const ka=l.length(X),na=ja.aboveGround?1:-1;ja=.5*ja.computeRenderPixelSizeAtDist(ka);
aa=l.scale(H,aa.normal,na*ja);l.add(ia,X,aa);return ia};P.applyVerticalOffsetTransformationView=function(X,aa,ja,ia){const ka=this.params;if(!ka.verticalOffset||!ka.verticalOffset.screenLength){if(ka.screenSizePerspective||ka.screenSizePerspectiveAlignment){var na=l.length(X);this.updateScaleInfo(ia,na,aa.cosAngle)}else ia.factor.scale=1,ia.factorAlignment.scale=1;return X}na=l.length(X);ja=D.verticalOffsetAtDistance(ja,na,ka.verticalOffset,aa.cosAngle,ka.screenSizePerspectiveAlignment||ka.screenSizePerspective);
this.updateScaleInfo(ia,na,aa.cosAngle);l.scale(aa.normal,aa.normal,ja);return l.add(X,X,aa.normal)};P.applyCenterOffsetView=function(X,aa,ja){const ia="screen"!==this.params.centerOffsetUnits;ja!==X&&l.copy(ja,X);ia&&(ja[0]+=aa[0],ja[1]+=aa[1],aa[2]&&(l.normalize(J,ja),l.add(ja,ja,l.scale(J,J,aa[2]))));return ja};P.applyCenterOffsetNDC=function(X,aa,ja,ia){const ka="screen"!==this.params.centerOffsetUnits;ia!==X&&l.copy(ia,X);ka||(ia[0]+=aa[0]/ja.fullWidth*2,ia[1]+=aa[1]/ja.fullHeight*2);return ia};
P.applyPolygonOffsetNDC=function(X,aa,ja,ia){const ka=this.params.shaderPolygonOffset;X!==ia&&l.copy(ia,X);ka&&(X=ja.aboveGround?1:-1,aa=X*f.sign(aa[3]),ia[2]-=(aa||X)*ka);return ia};P.getGLMaterial=function(X){if(0===X.output||7===X.output)return new N(X);if(4===X.output)return new I(X)};P.calculateRelativeScreenBounds=function(X,aa,ja=r.create()){E(this.params,X,aa,ja);ja[2]=ja[0]+X[0];ja[3]=ja[1]+X[1];return ja};return T}(A.Material);g=function(Z){function T(X){X=Z.call(this,{...X,...X.material.params})||
this;X.updateParameters();return X}u._inheritsLoose(T,Z);var P=T.prototype;P.beginSlot=function(X){return X===(this._material.params.drawInSecondSlot?19:18)};P.updateParameters=function(X){this.updateTexture(this._material.params.textureId);this.selectProgram(X)};P.selectProgram=function(X){this._technique=this._techniqueRep.releaseAndAcquire(v.HUDMaterialTechnique,this._material.getTechniqueConfig(this._output,X),this._technique)};P.ensureParameters=function(X){this.updateParameters(X)};P.bind=function(X){this.bindTextures(this._technique.program);
this.bindTextureScale(this._technique.program);this._technique.bindPass(this._material.params,X)};return T}(g);let N=function(Z){function T(X){X=Z.call(this,X)||this;X._isOcclusionSlot=!1;return X}u._inheritsLoose(T,Z);var P=T.prototype;P.beginSlot=function(X){const aa=this._material.params.drawInSecondSlot?19:18;if(this._material.params.occlusionTest)return this._isOcclusionSlot=12===X,12===X||X===aa;this._isOcclusionSlot=!1;return X===aa};P.selectProgram=function(X){this._technique=this._techniqueRep.releaseAndAcquire(v.HUDMaterialTechnique,
this._material.getTechniqueConfig(this._output,X),this._technique);this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(v.HUDMaterialTechnique,this._material.getTechniqueConfig(6,X),this._occlusionTechnique)};P.bind=function(X){const aa=this.technique;this._isOcclusionSlot||(this.bindTextures(aa.program),this.bindTextureScale(aa.program));aa.bindPass(this._material.params,X)};u._createClass(T,[{key:"technique",get:function(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}}]);
return T}(g),I=function(Z){function T(P){return Z.call(this,{...P,output:4})||this}u._inheritsLoose(T,Z);return T}(g);const G={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},K=k.create(),H=m.create(),J=m.create(),M=t.createRenderScreenPointArray3(),O=m.create(),Q=m.create(),S=e.create(),V=e.create(),Y=b.create(),W=m.create(),ba={normal:O,cosAngle:0},ca=b.create(),da=[0,0],ha=m.fromValues(0,0,1),fa={texCoordScale:[1,1],occlusionTest:!0,
binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,
slicePlaneEnabled:!1,anchorPos:k.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...A.materialParametersDefaults},R=c.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");let U=function(){function Z(P){this.material=P;this.vertexBufferLayout=R}var T=Z.prototype;T.allocate=function(P){return this.vertexBufferLayout.createBuffer(P)};
T.elementCount=function(P){return 6*P.indices.get("position").length};T.write=function(P,X,aa,ja){x.writePosition(X.indices.get("position"),X.vertexAttributes.get("position").data,P.transformation,aa.position,ja,6);x.writeNormal(X.indices.get("normal"),X.vertexAttributes.get("normal").data,P.invTranspTransformation,aa.normal,ja,6);var ia=X.vertexAttributes.get("uv0").data;if(null==ia||4>ia.length){ia=this.material.params;var ka=P=0;var na=ia.texCoordScale[0];ia=ia.texCoordScale[1]}else P=ia[0],ka=
ia[1],na=ia[2],ia=ia[3];na=Math.min(1.99999,na+1);ia=Math.min(1.99999,ia+1);var ta=X.indices.get("position").length,pa=aa.uv0,xa=ja;for(var Da=0;Da<ta;++Da)pa.set(xa,0,P),pa.set(xa,1,ka),xa+=1,pa.set(xa,0,na),pa.set(xa,1,ka),xa+=1,pa.set(xa,0,na),pa.set(xa,1,ia),xa+=1,pa.set(xa,0,na),pa.set(xa,1,ia),xa+=1,pa.set(xa,0,P),pa.set(xa,1,ia),xa+=1,pa.set(xa,0,P),pa.set(xa,1,ka),xa+=1;x.writeColor(X.indices.get("color"),X.vertexAttributes.get("color").data,4,aa.color,ja,6);P=X.indices.get("size");ka=X.vertexAttributes.get("size").data;
na=P.length;ia=aa.size;ta=ja;for(pa=0;pa<na;++pa){xa=ka[2*P[pa]];Da=ka[2*P[pa]+1];for(let Ka=0;6>Ka;++Ka)ia.set(ta,0,xa),ia.set(ta,1,Da),ta+=1}X.indices.get("auxpos1")&&X.vertexAttributes.get("auxpos1")&&x.writeBufferVec4(X.indices.get("auxpos1"),X.vertexAttributes.get("auxpos1").data,aa.auxpos1,ja,6);X.indices.get("auxpos2")&&X.vertexAttributes.get("auxpos2")&&x.writeBufferVec4(X.indices.get("auxpos2"),X.vertexAttributes.get("auxpos2").data,aa.auxpos2,ja,6)};return Z}();a.HUDMaterial=L;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function u(p){return p instanceof Float32Array&&16<=p.length}function f(p){return Array.isArray(p)&&16<=p.length}a.isMat4=function(p){return u(p)||f(p)};a.isMat4f32=u;a.isMat4f64=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./GLMaterial"],
function(a,u,f){return function(p){function t(e){var n=p.call(this,e)||this;n._textureIDs=new Set;n._textureRepository=e.textureRep;n._textureId=e.textureId;n._initTransparent=!!e.initTextureTransparent;n._texture=n._acquire(n._textureId);n._textureNormal=n._acquire(e.normalTextureId);n._textureEmissive=n._acquire(e.emissiveTextureId);n._textureOcclusion=n._acquire(e.occlusionTextureId);n._textureMetallicRoughness=n._acquire(e.metallicRoughnessTextureId);return n}a._inheritsLoose(t,p);var w=t.prototype;
w.dispose=function(){this._textureIDs.forEach(e=>this._textureRepository.release(e));this._textureIDs.clear()};w.updateTexture=function(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))};w.bindTextures=function(e){u.isSome(this._texture)&&e.bindTexture(this._texture.glTexture,"tex");u.isSome(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture");u.isSome(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,
"texEmission");u.isSome(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion");u.isSome(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")};w.bindTextureScale=function(e){const n=u.isSome(this._texture)&&this._texture.glTexture;n&&n.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",n.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",
1,1)};w._acquire=function(e){if(!u.isNone(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)};w._release=function(e){u.isNone(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))};return t}(f)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./AutoDisposable"],function(a,u){return function(f){function p(w){var e=f.call(this)||this;e._material=w.material;e._techniqueRep=w.techniqueRep;
e._output=w.output;return e}a._inheritsLoose(p,f);var t=p.prototype;t.getPipelineState=function(w,e){return this.technique.pipeline};t.ensureResources=function(w){return 2};t.ensureParameters=function(w){};a._createClass(p,[{key:"technique",get:function(){return this._technique}}]);return p}(u.AutoDisposable)})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){const f=t=>function(w){function e(){var n=w.apply(this,
arguments)||this;n._isDisposed=!1;return n}u._inheritsLoose(e,w);e.prototype.dispose=function(){for(const b of null!=(n=this._managedDisposables)?n:[]){var n;n=this[b];this[b]=null;n&&"function"===typeof n.dispose&&n.dispose()}this._isDisposed=!0};u._createClass(e,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return e}(t);let p=function(t){function w(){return t.apply(this,arguments)||this}u._inheritsLoose(w,t);return w}(f(function(){return function(){}}()));a.AutoDisposable=p;a.AutoDisposableMixin=
f;a.autoDispose=function(){return(t,w)=>{if(!t.hasOwnProperty("_managedDisposables")){var e,n;t._managedDisposables=null!=(e=null==(n=t._managedDisposables)?void 0:n.slice())?e:[]}t._managedDisposables.unshift(w)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./ContentObject ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,u,f,p,t,w){p=function(e){function n(h,k){var l=e.call(this)||this;l.type=3;l.supportsEdges=!1;l._visible=!0;l._renderPriority=0;l._insertOrder=0;l._vertexAttributeLocations=t.Default3D;l._params=w.copyParameters(h,k);l.validateParameterValues(l._params);return l}u._inheritsLoose(n,e);var b=n.prototype;b.dispose=function(){};b.update=function(h){return!1};b.setParameterValues=function(h){w.updateParameters(this._params,h)&&(this.validateParameterValues(this._params),this.parametersChanged())};
b.validateParameterValues=function(h){};b.isVisibleInPass=function(h){return!0};b.isVisible=function(){return this._visible};b.parametersChanged=function(){f.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};u._createClass(n,[{key:"params",get:function(){return this._params}},{key:"visible",get:function(){return this._visible},set:function(h){h!==this._visible&&(this._visible=h,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.params.renderOccluded}},
{key:"renderPriority",get:function(){return this._renderPriority},set:function(h){h!==this._renderPriority&&(this._renderPriority=h,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(h){h!==this._insertOrder&&(this._insertOrder=h,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return n}(p.ContentObject);a.Material=p;a.materialParametersDefaults={renderOccluded:1};a.materialPredicate=
function(e,n){return e.isVisible()&&e.isVisibleInPass(n.pass)&&0!==(e.renderOccluded&n.renderOccludedMask)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/screenSizePerspectiveUtils ../../lib/Util ../renderers/utils".split(" "),function(a,
u,f,p,t,w,e,n,b){function h(D,C,B,v,E,F){if(!f.isNone(D)){var L=m(C,B,A);w.setMin(g,D.getBBMin());w.setMax(g,D.getBBMax());f.isSome(E)&&E.applyToAabb(g);if(z(g,C,L,v)){const {primitiveIndices:N,indices:I,position:G}=D;L=N?N.length:I.length/3;if(1E3<L&&(D=D.getChildren(),void 0!==D)){for(L=0;8>L;++L)void 0!==D[L]&&h(D[L],C,B,v,E,F);return}k(C,B,0,L,I,G,N,E,F)}}}function k(D,C,B,v,E,F,L,N,I){if(L){var G=F.data;F=F.stride||F.size;var K=D[0],H=D[1];D=D[2];var J=C[0]-K,M=C[1]-H;for(C=C[2]-D;B<v;++B){var O=
L[B],Q=3*O,S=F*E[Q++],V=G[S++],Y=G[S++],W=G[S];S=F*E[Q++];var ba=G[S++],ca=G[S++],da=G[S];S=F*E[Q];Q=G[S++];var ha=G[S++];S=G[S];f.isSome(N)&&([V,Y,W]=N.applyToVertex(V,Y,W,B),[ba,ca,da]=N.applyToVertex(ba,ca,da,B),[Q,ha,S]=N.applyToVertex(Q,ha,S,B));ba-=V;ca-=Y;da-=W;Q-=V;ha-=Y;S-=W;var fa=M*S-ha*C,R=C*Q-S*J;const Z=J*ha-Q*M;var U=ba*fa+ca*R+da*Z;if(!(Math.abs(U)<=Number.EPSILON)){V=K-V;Y=H-Y;W=D-W;fa=V*fa+Y*R+W*Z;if(0<U){if(0>fa||fa>U)continue}else if(0<fa||fa<U)continue;R=Y*da-ca*W;W=W*ba-da*V;
Y=V*ca-ba*Y;V=J*R+M*W+C*Y;if(0<U){if(0>V||fa+V>U)continue}else if(0<V||fa+V<U)continue;W=(Q*R+ha*W+S*Y)/U;0<=W&&(ba=l(ba,ca,da,Q,ha,S,q),I(W,ba,O))}}}else{L=F.data;G=F.stride||F.size;F=D[0];K=D[1];H=D[2];D=C[0]-F;J=C[1]-K;M=C[2]-H;for(let Z=B,T=3*B;Z<v;++Z)if(Q=G*E[T++],Y=L[Q++],W=L[Q++],da=L[Q],Q=G*E[T++],C=L[Q++],B=L[Q++],O=L[Q],Q=G*E[T++],ba=L[Q++],ca=L[Q++],Q=L[Q],f.isSome(N)&&([Y,W,da]=N.applyToVertex(Y,W,da,Z),[C,B,O]=N.applyToVertex(C,B,O,Z),[ba,ca,Q]=N.applyToVertex(ba,ca,Q,Z)),C-=Y,B-=W,
O-=da,ba-=Y,ca-=W,Q-=da,S=J*Q-ca*M,V=M*ba-Q*D,U=D*ca-ba*J,ha=C*S+B*V+O*U,!(Math.abs(ha)<=Number.EPSILON)){Y=F-Y;W=K-W;da=H-da;S=Y*S+W*V+da*U;if(0<ha){if(0>S||S>ha)continue}else if(0<S||S<ha)continue;V=W*O-B*da;da=da*C-O*Y;W=Y*B-C*W;Y=D*V+J*da+M*W;if(0<ha){if(0>Y||S+Y>ha)continue}else if(0<Y||S+Y<ha)continue;da=(ba*V+ca*da+Q*W)/ha;0<=da&&(C=l(C,B,O,ba,ca,Q,q),I(da,C,Z))}}}function l(D,C,B,v,E,F,L){p.set(y,D,C,B);p.set(x,v,E,F);p.cross(L,y,x);p.normalize(L,L);return L}function m(D,C,B){return p.set(B,
1/(C[0]-D[0]),1/(C[1]-D[1]),1/(C[2]-D[2]))}function z(D,C,B,v){return r(D,C,B,v,Infinity)}function r(D,C,B,v,E){var F=(D[0]-v-C[0])*B[0],L=(D[3]+v-C[0])*B[0];let N=Math.min(F,L);F=Math.max(F,L);L=(D[1]-v-C[1])*B[1];const I=(D[4]+v-C[1])*B[1];F=Math.min(F,Math.max(L,I));if(0>F)return!1;N=Math.max(N,Math.min(L,I));if(N>F)return!1;L=(D[2]-v-C[2])*B[2];D=(D[5]+v-C[2])*B[2];F=Math.min(F,Math.max(L,D));if(0>F)return!1;N=Math.max(N,Math.min(L,D));return N>F?!1:N<E}function c(D,C){C=C?c(C):{};for(const B in D){let v=
D[B];v&&v.forEach&&(v=d(v));null==v&&B in C||(C[B]=v)}return C}function d(D){const C=[];D.forEach(B=>C.push(B));return C}const g=w.create(),A=t.create(),q=t.create(),y=t.create(),x=t.create();a.bindScreenSizePerspective=function(D,C,B){if(D){var v=D.parameters;C.setUniform4f(B,v.divisor,v.offset,v.minPixelSize,D.paddingPixelsOverride)}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=m;a.computeNormal=l;a.copyParameters=c;a.intersectAabbInvDir=z;a.intersectAabbInvDirBefore=
r;a.intersectDrapedRenderLineGeometry=function(D,C,B,v,E){if(C.options.selectionMode){C=D.vertexAttributes.get("position").data;var F=D.vertexAttributes.get("size"),L=B[0];B=B[1];D=(((F&&F.data[0])+v)/2+4)*D.screenToWorldRatio;v=Number.MAX_VALUE;for(F=0;F<C.length-5;F+=3){var N=C[F],I=C[F+1],G=L-N,K=B-I;N=C[F+3]-N;I=C[F+4]-I;const H=u.clamp((N*G+I*K)/(N*N+I*I),0,1);G=N*H-G;K=I*H-K;K=G*G+K*K;K<v&&(v=K)}v<D*D&&E()}};a.intersectTriangleGeometry=function(D,C,B,v,E,F,L){b.isInstanceHidden(C)||(D.boundingInfo?
(n.assert(0===D.primitiveType),h(D.boundingInfo,v,E,B.tolerance,F,L)):(C=D.indices.get("position"),D=D.vertexAttributes.get("position"),k(v,E,0,C.length/3,C,D,void 0,F,L)))};a.intersectTriangles=k;a.updateParameters=function(D,C){let B=!1;for(const v in C){const E=C[v];void 0!==E&&(B=!0,Array.isArray(E)?D[v]=E.slice():D[v]=E)}return B};a.verticalOffsetAtDistance=function(D,C,B,v,E){let F=(B.screenLength||0)*D.pixelRatio;E&&(F=e.scale(F,v,C,E));return u.clamp(F*Math.tan(.5*D.fovY)/(.5*D.fullHeight)*
C,B.minWorldLength||0,null!=B.maxWorldLength?B.maxWorldLength:Infinity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../../core/maybe","../Extent","./aaBoundingRect"],function(a,u,f,p){function t(c=z){return[c[0],c[1],c[2],c[3],c[4],c[5]]}function w(c,d,g,A,q,y,x=t()){x[0]=c;x[1]=d;x[2]=g;x[3]=A;x[4]=q;x[5]=y;return x}function e(c){return c[0]>=c[3]?0:c[3]-c[0]}function n(c){return c[1]>=c[4]?0:c[4]-c[1]}function b(c){return c[2]>=
c[5]?0:c[5]-c[2]}function h(c,d){return Math.max(d[0],c[0])<=Math.min(d[3],c[3])&&Math.max(d[1],c[1])<=Math.min(d[4],c[4])&&Math.max(d[2],c[2])<=Math.min(d[5],c[5])}function k(c,d){c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];return c}function l(c){return 6===c.length}const m=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],z=[0,0,0,0,0,0],r=t();a.NEGATIVE_INFINITY=m;a.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];a.ZERO=z;a.allFinite=function(c){for(let d=
0;6>d;d++)if(!isFinite(c[d]))return!1;return!0};a.center=function(c,d=[0,0,0]){d[0]=c[0]+e(c)/2;d[1]=c[1]+n(c)/2;d[2]=c[2]+b(c)/2;return d};a.contains=function(c,d){return d[0]>=c[0]&&d[1]>=c[1]&&d[2]>=c[2]&&d[3]<=c[3]&&d[4]<=c[4]&&d[5]<=c[5]};a.containsPoint=function(c,d){return d[0]>=c[0]&&d[1]>=c[1]&&d[2]>=c[2]&&d[0]<=c[3]&&d[1]<=c[4]&&d[2]<=c[5]};a.containsPointWithMargin=function(c,d,g){return d[0]>=c[0]-g&&d[1]>=c[1]-g&&d[2]>=c[2]-g&&d[0]<=c[3]+g&&d[1]<=c[4]+g&&d[2]<=c[5]+g};a.create=t;a.depth=
n;a.diameter=function(c){const d=e(c),g=b(c);c=n(c);return Math.sqrt(d*d+g*g+c*c)};a.empty=function(c){return c?k(c,m):t(m)};a.equals=function(c,d,g){if(u.isNone(c)||u.isNone(d))return c===d;if(!l(c)||!l(d))return!1;if(g)for(let A=0;A<c.length;A++){if(!g(c[A],d[A]))return!1}else for(g=0;g<c.length;g++)if(c[g]!==d[g])return!1;return!0};a.expandWithAABB=function(c,d){c[0]=Math.min(c[0],d[0]);c[1]=Math.min(c[1],d[1]);c[2]=Math.min(c[2],d[2]);c[3]=Math.max(c[3],d[3]);c[4]=Math.max(c[4],d[4]);c[5]=Math.max(c[5],
d[5])};a.expandWithBuffer=function(c,d,g=0,A=d.length/3){let q=c[0],y=c[1],x=c[2],D=c[3],C=c[4],B=c[5];for(let v=0;v<A;v++)q=Math.min(q,d[g+3*v]),y=Math.min(y,d[g+3*v+1]),x=Math.min(x,d[g+3*v+2]),D=Math.max(D,d[g+3*v]),C=Math.max(C,d[g+3*v+1]),B=Math.max(B,d[g+3*v+2]);c[0]=q;c[1]=y;c[2]=x;c[3]=D;c[4]=C;c[5]=B};a.expandWithNestedArray=function(c,d,g){const A=d.length;let q=c[0],y=c[1],x=c[2],D=c[3],C=c[4],B=c[5];if(g)for(g=0;g<A;g++){var v=d[g];q=Math.min(q,v[0]);y=Math.min(y,v[1]);x=Math.min(x,v[2]);
D=Math.max(D,v[0]);C=Math.max(C,v[1]);B=Math.max(B,v[2])}else for(g=0;g<A;g++)v=d[g],q=Math.min(q,v[0]),y=Math.min(y,v[1]),D=Math.max(D,v[0]),C=Math.max(C,v[1]);c[0]=q;c[1]=y;c[2]=x;c[3]=D;c[4]=C;c[5]=B};a.expandWithOffset=function(c,d,g,A){c[0]=Math.min(c[0],c[0]+d);c[3]=Math.max(c[3],c[3]+d);c[1]=Math.min(c[1],c[1]+g);c[4]=Math.max(c[4],c[4]+g);c[2]=Math.min(c[2],c[2]+A);c[5]=Math.max(c[5],c[5]+A)};a.expandWithRect=function(c,d){c[0]=Math.min(c[0],d[0]);c[1]=Math.min(c[1],d[1]);c[3]=Math.max(c[3],
d[2]);c[4]=Math.max(c[4],d[3])};a.expandWithVec3=function(c,d){c[0]=Math.min(c[0],d[0]);c[1]=Math.min(c[1],d[1]);c[2]=Math.min(c[2],d[2]);c[3]=Math.max(c[3],d[0]);c[4]=Math.max(c[4],d[1]);c[5]=Math.max(c[5],d[2])};a.fromExtent=function(c,d=t()){d[0]=c.xmin;d[1]=c.ymin;d[2]=c.zmin;d[3]=c.xmax;d[4]=c.ymax;d[5]=c.zmax;return d};a.fromMinMax=function(c,d,g=t()){g[0]=c[0];g[1]=c[1];g[2]=c[2];g[3]=d[0];g[4]=d[1];g[5]=d[2];return g};a.fromRect=function(c,d){c[0]=d[0];c[1]=d[1];c[2]=Number.NEGATIVE_INFINITY;
c[3]=d[2];c[4]=d[3];c[5]=Number.POSITIVE_INFINITY;return c};a.fromValues=w;a.getMax=function(c,d){d[0]=c[3];d[1]=c[4];d[2]=c[5];return d};a.getMin=function(c,d){d[0]=c[0];d[1]=c[1];d[2]=c[2];return d};a.height=b;a.intersects=h;a.intersectsClippingArea=function(c,d){return u.isNone(d)?!0:h(c,d)};a.is=l;a.isPoint=function(c){return 0===e(c)&&0===n(c)&&0===b(c)};a.maximumDimension=function(c){return Math.max(e(c),b(c),n(c))};a.offset=function(c,d,g,A,q=c){q[0]=c[0]+d;q[1]=c[1]+g;q[2]=c[2]+A;q[3]=c[3]+
d;q[4]=c[4]+g;q[5]=c[5]+A;return q};a.scale=function(c,d,g=c){const A=c[0]+e(c)/2,q=c[1]+n(c)/2,y=c[2]+b(c)/2;g[0]=A+(c[0]-A)*d;g[1]=q+(c[1]-q)*d;g[2]=y+(c[2]-y)*d;g[3]=A+(c[3]-A)*d;g[4]=q+(c[4]-q)*d;g[5]=y+(c[5]-y)*d;return g};a.set=k;a.setMax=function(c,d,g=c){g[3]=d[0];g[4]=d[1];g[5]=d[2];g!==c&&(g[0]=c[0],g[1]=c[1],g[2]=c[2]);return c};a.setMin=function(c,d,g=c){g[0]=d[0];g[1]=d[1];g[2]=d[2];g!==c&&(g[3]=c[3],g[4]=c[4],g[5]=c[5]);return g};a.size=function(c,d=[0,0,0]){d[0]=e(c);d[1]=n(c);d[2]=
b(c);return d};a.toExtent=function(c,d){return isFinite(c[2])||isFinite(c[5])?new f({xmin:c[0],xmax:c[3],ymin:c[1],ymax:c[4],zmin:c[2],zmax:c[5],spatialReference:d}):new f({xmin:c[0],xmax:c[3],ymin:c[1],ymax:c[4],spatialReference:d})};a.toRect=function(c,d){d||(d=p.create());d[0]=c[0];d[1]=c[1];d[2]=c[3];d[3]=c[4];return d};a.width=e;a.wrap=function(c,d,g,A,q,y){return w(c,d,g,A,q,y,r)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports",
"../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util"],function(a,u,f,p){function t(l,m,z,r){const c=z.typedBuffer;z=z.typedBufferStride;const d=l.length;r*=z;for(let g=0;g<d;++g){const A=2*l[g];c[r]=m[A];c[r+1]=m[A+1];r+=z}}function w(l,m,z,r,c){const d=z.typedBuffer;z=z.typedBufferStride;const g=l.length;r*=z;if(null==c||1===c)for(c=0;c<g;++c){var A=3*l[c];d[r]=m[A];d[r+1]=m[A+1];d[r+2]=m[A+2];r+=z}else for(A=0;A<g;++A){const q=3*l[A];for(let y=0;y<c;++y)d[r]=
m[q],d[r+1]=m[q+1],d[r+2]=m[q+2],r+=z}}function e(l,m,z,r,c=1){const d=z.typedBuffer;z=z.typedBufferStride;const g=l.length;r*=z;if(1===c)for(c=0;c<g;++c){var A=4*l[c];d[r]=m[A];d[r+1]=m[A+1];d[r+2]=m[A+2];d[r+3]=m[A+3];r+=z}else for(A=0;A<g;++A){const q=4*l[A];for(let y=0;y<c;++y)d[r]=m[q],d[r+1]=m[q+1],d[r+2]=m[q+2],d[r+3]=m[q+3],r+=z}}function n(l,m,z,r,c,d=1){if(z){var g=r.typedBuffer;r=r.typedBufferStride;var A=l.length,q=z[0],y=z[1],x=z[2],D=z[4],C=z[5],B=z[6],v=z[8],E=z[9],F=z[10],L=z[12],
N=z[13];z=z[14];c*=r;if(1===d)for(d=0;d<A;++d){var I=3*l[d],G=m[I],K=m[I+1];I=m[I+2];g[c]=q*G+D*K+v*I+L;g[c+1]=y*G+C*K+E*I+N;g[c+2]=x*G+B*K+F*I+z;c+=r}else for(G=0;G<A;++G){K=3*l[G];var H=m[K],J=m[K+1];const M=m[K+2];K=q*H+D*J+v*M+L;I=y*H+C*J+E*M+N;H=x*H+B*J+F*M+z;for(J=0;J<d;++J)g[c]=K,g[c+1]=I,g[c+2]=H,c+=r}}else w(l,m,r,c,d)}function b(l,m,z,r,c,d=1){if(z){var g=r.typedBuffer;r=r.typedBufferStride;var A=l.length,q=z[0],y=z[1],x=z[2],D=z[4],C=z[5],B=z[6],v=z[8],E=z[9],F=z[10];z=!u.isOrthoNormal(z);
c*=r;if(1===d)for(d=0;d<A;++d){var L=3*l[d],N=m[L],I=m[L+1],G=m[L+2];L=q*N+D*I+v*G;var K=y*N+C*I+E*G;N=x*N+B*I+F*G;z&&(I=L*L+K*K+N*N,.999999>I&&1E-6<I&&(I=1/Math.sqrt(I),L*=I,K*=I,N*=I));g[c+0]=L;g[c+1]=K;g[c+2]=N;c+=r}else for(L=0;L<A;++L){K=3*l[L];I=m[K];G=m[K+1];const H=m[K+2];K=q*I+D*G+v*H;N=y*I+C*G+E*H;I=x*I+B*G+F*H;z&&(G=K*K+N*N+I*I,.999999>G&&1E-6<G&&(G=1/Math.sqrt(G),K*=G,N*=G,I*=G));for(G=0;G<d;++G)g[c+0]=K,g[c+1]=N,g[c+2]=I,c+=r}}else w(l,m,r,c,d)}function h(l,m,z,r,c,d=1){if(z){var g=r.typedBuffer;
r=r.typedBufferStride;var A=l.length,q=z[0],y=z[1],x=z[2],D=z[4],C=z[5],B=z[6],v=z[8],E=z[9],F=z[10];z=!u.isOrthoNormal(z);c*=r;if(1===d)for(d=0;d<A;++d){var L=4*l[d],N=m[L],I=m[L+1],G=m[L+2];L=m[L+3];var K=q*N+D*I+v*G,H=y*N+C*I+E*G;N=x*N+B*I+F*G;z&&(I=K*K+H*H+N*N,.999999>I&&1E-6<I&&(I=1/Math.sqrt(I),K*=I,H*=I,N*=I));g[c+0]=K;g[c+1]=H;g[c+2]=N;g[c+3]=L;c+=r}else for(L=0;L<A;++L){K=4*l[L];I=m[K];G=m[K+1];const J=m[K+2];K=m[K+3];H=q*I+D*G+v*J;N=y*I+C*G+E*J;I=x*I+B*G+F*J;z&&(G=H*H+N*N+I*I,.999999>G&&
1E-6<G&&(G=1/Math.sqrt(G),H*=G,N*=G,I*=G));for(G=0;G<d;++G)g[c+0]=H,g[c+1]=N,g[c+2]=I,g[c+3]=K,c+=r}}else e(l,m,r,c,d)}function k(l,m,z,r,c,d=1){const g=r.typedBuffer;r=r.typedBufferStride;const A=l.length;c*=r;if(1===d)if(4===z)for(d=0;d<A;++d)z=4*l[d],g[c]=m[z],g[c+1]=m[z+1],g[c+2]=m[z+2],g[c+3]=m[z+3],c+=r;else{if(3===z)for(d=0;d<A;++d)z=3*l[d],g[c]=m[z],g[c+1]=m[z+1],g[c+2]=m[z+2],g[c+3]=255,c+=r}else if(4===z)for(z=0;z<A;++z){var q=4*l[z];for(var y=0;y<d;++y)g[c]=m[q],g[c+1]=m[q+1],g[c+2]=m[q+
2],g[c+3]=m[q+3],c+=r}else if(3===z)for(z=0;z<A;++z)for(q=3*l[z],y=0;y<d;++y)g[c]=m[q],g[c+1]=m[q+1],g[c+2]=m[q+2],g[c+3]=255,c+=r}a.writeBufferMat3f=function(l,m,z,r){const c=z.typedBuffer;z=z.typedBufferStride;const d=l.length;r*=z;for(let g=0;g<d;++g){const A=9*l[g];for(let q=0;9>q;++q)c[r+q]=m[A+q];r+=z}};a.writeBufferMat4f=function(l,m,z,r){const c=z.typedBuffer;z=z.typedBufferStride;const d=l.length;r*=z;for(let g=0;g<d;++g){const A=16*l[g];for(let q=0;16>q;++q)c[r+q]=m[A+q];r+=z}};a.writeBufferVec2=
t;a.writeBufferVec3=w;a.writeBufferVec4=e;a.writeColor=k;a.writeDefaultAttributes=function(l,m,z,r,c,d){for(const A of m.fieldNames){m=l.vertexAttributes.get(A);const q=l.indices.get(A);if(m&&q)switch(A){case "position":p.assert(3===m.size);var g=c.getField(A,f.BufferViewVec3f);g&&n(q,m.data,z,g,d);break;case "normal":p.assert(3===m.size);(g=c.getField(A,f.BufferViewVec3f))&&b(q,m.data,r,g,d);break;case "uv0":p.assert(2===m.size);(g=c.getField(A,f.BufferViewVec2f))&&t(q,m.data,g,d);break;case "color":p.assert(3===
m.size||4===m.size);(g=c.getField(A,f.BufferViewVec4u8))&&k(q,m.data,m.size,g,d);break;case "symbolColor":p.assert(3===m.size||4===m.size);(g=c.getField(A,f.BufferViewVec4u8))&&k(q,m.data,m.size,g,d);break;case "tangent":p.assert(4===m.size),(g=c.getField(A,f.BufferViewVec4f))&&h(q,m.data,r,g,d)}}};a.writeNormal=b;a.writePosition=n;a.writeTangent=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){function d(y){const x=new c.ShaderBuilder;var D=y.signedDistanceFieldEnabled;x.include(w.AlignPixel);x.include(e.HUD,y);x.include(t.Slice,y);if(6===y.output)return x.include(n.HUDOcclusionPass,y),x;x.include(z.ScreenSizePerspective);x.fragment.include(m.RgbaFloatEncoding);x.fragment.include(l.ColorConversion);x.include(h.VisualVariables,y);x.varyings.add("vcolor","vec4");x.varyings.add("vtc","vec2");x.varyings.add("vsize","vec2");y.binaryHighlightOcclusionEnabled&&
x.varyings.add("voccluded","float");x.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");D&&x.vertex.uniforms.add("outlineColor","vec4");y.screenSizePerspectiveEnabled&&x.vertex.uniforms.add("screenSizePerspective","vec4");(y.debugDrawBorder||y.binaryHighlightOcclusionEnabled)&&x.varyings.add("debugBorderCoords","vec4");x.attributes.add("uv0","vec2");x.attributes.add("color","vec4");x.attributes.add("size","vec2");
x.attributes.add("auxpos2","vec4");x.vertex.code.add(r.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${y.screenSizePerspectiveEnabled?r.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:r.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${y.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${y.occlusionTestEnabled||y.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${y.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var C=r.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const B=y.pixelSnappingEnabled?D?r.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:r.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:r.glsl`posProj += quadOffset;`;x.vertex.code.add(r.glsl`
      ${y.occlusionTestEnabled?"if (visible) {":""}
      ${C}
      ${y.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${r.glsl.float(k.symbolAlphaCutoff)};
      ${D?`alphaDiscard = alphaDiscard && outlineColor.a < ${r.glsl.float(k.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${B}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${y.debugDrawBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${y.occlusionTestEnabled?r.glsl`} else { vtc = vec2(0.0);
        ${y.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);x.fragment.uniforms.add("tex","sampler2D");D&&(x.fragment.uniforms.add("outlineColor","vec4"),x.fragment.uniforms.add("outlineSize","float"));C=y.debugDrawBorder?r.glsl`(isBorder > 0.0 ? 0.0 : ${r.glsl.float(k.defaultMaskAlphaCutoff)})`:r.glsl.float(k.defaultMaskAlphaCutoff);D=r.glsl`
    ${y.debugDrawBorder?r.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${D?r.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${C} ||
          fillPixelColor.a + outlinePixelColor.a < ${r.glsl.float(k.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${C}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:r.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${C}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${y.debugDrawBorder?r.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;7===y.output&&x.fragment.code.add(r.glsl`
      void main() {
        ${D}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);0===y.output&&x.fragment.code.add(r.glsl`
    void main() {
      ${D}
      ${y.FrontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);4===y.output&&(x.include(b.OutputHighlight),x.fragment.code.add(r.glsl`
    void main() {
      ${D}
      ${y.binaryHighlightOcclusionEnabled?r.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return x}function g(y,x,D){y.setUniform4fv("materialColor",x.color);x.textureIsSignedDistanceField&&(0>=x.outlineColor[3]||0>=x.outlineSize?(y.setUniform4fv("outlineColor",p.ZEROS),y.setUniform1f("outlineSize",0)):(y.setUniform4fv("outlineColor",x.outlineColor),y.setUniform1f("outlineSize",x.outlineSize)));y.setUniform2f("screenOffset",2*x.screenOffset[0]*D,2*x.screenOffset[1]*D);y.setUniform2fv("anchorPos",A(x))}function A(y,x=q){if(y.textureIsSignedDistanceField){var D=y.anchorPos;y=y.distanceFieldBoundingBox;
x[0]=D[0]*(y[2]-y[0])+y[0];x[1]=D[1]*(y[3]-y[1])+y[1]}else u.copy(x,y.anchorPos);return x}const q=f.create();f=Object.freeze({__proto__:null,build:d,bindHUDMaterialUniforms:g,calculateAnchorPosForRendering:A});a.HUDMaterialShader=f;a.bindHUDMaterialUniforms=g;a.build=d;a.calculateAnchorPosForRendering=A})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../shaderModules/interfaces"],
function(a,u,f,p,t){function w(n,b,h,k){b.slicePlaneEnabled&&(u.isSome(h)?(k?(f.subtract(e,h.origin,k),n.setUniform3fv("slicePlaneOrigin",e)):n.setUniform3fv("slicePlaneOrigin",h.origin),n.setUniform3fv("slicePlaneBasis1",h.basis1),n.setUniform3fv("slicePlaneBasis2",h.basis2)):(n.setUniform3fv("slicePlaneBasis1",p.ZEROS),n.setUniform3fv("slicePlaneBasis2",p.ZEROS),n.setUniform3fv("slicePlaneOrigin",p.ZEROS)))}const e=p.create();a.Slice=function(n,b){if(b.slicePlaneEnabled){n.extensions.add("GL_OES_standard_derivatives");
b.sliceEnabledForVertexPrograms&&(n.vertex.uniforms.add("slicePlaneOrigin","vec3"),n.vertex.uniforms.add("slicePlaneBasis1","vec3"),n.vertex.uniforms.add("slicePlaneBasis2","vec3"));n.fragment.uniforms.add("slicePlaneOrigin","vec3");n.fragment.uniforms.add("slicePlaneBasis1","vec3");n.fragment.uniforms.add("slicePlaneBasis2","vec3");var h=t.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,k=t.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;k=b.sliceHighlightDisabled?t.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:t.glsl`
        ${k}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;b.sliceEnabledForVertexPrograms&&n.vertex.code.add(h);n.fragment.code.add(h);n.fragment.code.add(k)}else h=t.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,b.sliceEnabledForVertexPrograms&&n.vertex.code.add(h),n.fragment.code.add(h)};a.bindSliceUniforms=w;a.bindSliceUniformsWithOrigin=function(n,b,h){w(n,b,h.slicePlane,h.origin)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,u,f){a.HUD=function(p,t){p.include(u.ScreenSizePerspective);
p.attributes.add("position","vec3");p.attributes.add("normal","vec3");p.attributes.add("auxpos1","vec4");p.vertex.uniforms.add("proj","mat4");p.vertex.uniforms.add("view","mat4");p.vertex.uniforms.add("viewNormal","mat4");p.vertex.uniforms.add("viewport","vec4");p.vertex.uniforms.add("camPos","vec3");p.vertex.uniforms.add("polygonOffset","float");p.vertex.uniforms.add("cameraGroundRelative","float");p.vertex.uniforms.add("pixelRatio","float");p.vertex.uniforms.add("perDistancePixelRatio","float");
p.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");t.verticalOffsetEnabled&&p.vertex.uniforms.add("verticalOffset","vec4");t.screenSizePerspectiveEnabled&&p.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");p.vertex.uniforms.add("hudVisibilityTexture","sampler2D");p.vertex.constants.add("smallOffsetAngle","float",.984807753012208);p.vertex.code.add(f.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);p.vertex.code.add(f.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);t.isDraped||p.vertex.code.add(f.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`);p.vertex.code.add(f.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled?t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?f.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?f.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);p.vertex.code.add(f.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};a.bindHUDUniforms=function(p,t){p.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(a,u,f){a.ScreenSizePerspective=function(p){p.vertex.code.add(u.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);p.vertex.code.add(u.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);p.vertex.code.add(u.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);p.vertex.code.add(u.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);p.vertex.code.add(u.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);p.vertex.code.add(u.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`);p.vertex.code.add(u.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.bindScreenSizePerspectiveUniforms=function(p,t){t.screenSizePerspective&&(f.bindScreenSizePerspective(t.screenSizePerspective,p,"screenSizePerspective"),f.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,p,"screenSizePerspectiveAlignment"))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../shading/MultipassGeometryTest.glsl",
"../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,u,f,p,t){a.HUDOcclusionPass=function(w,e){e.multipassGeometryEnabled&&w.vertex.include(f.multipassGeometryTest);e.multipassTerrainEnabled&&w.varyings.add("depth","float");w.vertex.code.add(t.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassGeometryEnabled?t.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassTerrainEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);e.multipassTerrainEnabled&&w.fragment.include(u.ReadLinearDepth);w.fragment.uniforms.add("terrainDepthTexture","sampler2D");w.fragment.uniforms.add("cameraNearFar","vec2");w.fragment.uniforms.add("inverseViewport","vec2");w.fragment.include(p.RgbaFloatEncoding);w.fragment.code.add(t.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.multipassTerrainEnabled?t.glsl`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,u,f){a.ReadLinearDepth=function(p){p.include(u.RgbaFloatEncoding);p.code.add(f.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.RgbaFloatEncoding=function(f){f.code.add(u.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/interfaces"],function(a,u,f){a.bindMultipassGeometryTexture=function(p,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&p.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")};a.multipassGeometryTest=function(p){p.include(u.ReadLinearDepth);p.uniforms.add("geometryDepthTexture",
"sampler2D");p.uniforms.add("cameraNearFar","vec2");p.code.add(f.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces"],function(a,u,f){const p=u.fromValues(1,1,0,1),t=u.fromValues(1,0,1,1);a.OutputHighlight=function(w){w.fragment.uniforms.add("depthTex","sampler2D");w.fragment.uniforms.add("highlightViewportPixelSz","vec4");w.fragment.constants.add("occludedHighlightFlag","vec4",p).add("unoccludedHighlightFlag",
"vec4",t);w.fragment.code.add(f.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.bindOutputHighlight=function(w,e){w.bindTexture(e.highlightDepthTexture,"depthTex");w.setUniform4f("highlightViewportPixelSz",0,0,e.inverseViewport[0],e.inverseViewport[1])};a.occludedHighlightFlag=p;a.unoccludedHighlightFlag=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){function f(p,t){t.vvSizeEnabled&&(p.setUniform3fv("vvSizeMinSize",
t.vvSizeMinSize),p.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),p.setUniform3fv("vvSizeOffset",t.vvSizeOffset),p.setUniform3fv("vvSizeFactor",t.vvSizeFactor));t.vvColorEnabled&&(p.setUniform1fv("vvColorValues",t.vvColorValues),p.setUniform4fv("vvColorColors",t.vvColorColors))}a.VisualVariables=function(p,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&p.attributes.add("instanceFeatureAttribute","vec4");t.vvSize?(p.vertex.uniforms.add("vvSizeMinSize","vec3"),p.vertex.uniforms.add("vvSizeMaxSize",
"vec3"),p.vertex.uniforms.add("vvSizeOffset","vec3"),p.vertex.uniforms.add("vvSizeFactor","vec3"),p.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),p.vertex.uniforms.add("vvSymbolAnchor","vec3"),p.vertex.code.add(u.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),p.vertex.code.add(u.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?u.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):p.vertex.code.add(u.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);t.vvColor?(p.vertex.constants.add("vvColorNumber","int",8),p.vertex.code.add(u.glsl`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?u.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):p.vertex.code.add(u.glsl`vec4 vvColor() { return vec4(1.0); }`)};a.bindVisualVariablesUniforms=f;a.bindVisualVariablesUniformsForSymbols=function(p,t){f(p,t);t.vvSizeEnabled&&(p.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),p.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))};a.bindVisualVariablesUniformsWithOpacity=function(p,t){f(p,t);t.vvOpacityEnabled&&(p.setUniform1fv("vvOpacityValues",t.vvOpacityValues),p.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.DiscardOrAdjustAlpha=function(f,p){const t=f.fragment;switch(p.alphaDiscardMode){case 0:t.code.add(u.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${u.glsl.float(.001)}) { discard; } }
      `);break;case 1:t.code.add(u.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:t.uniforms.add("textureAlphaCutoff","float");t.code.add(u.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:f.fragment.uniforms.add("textureAlphaCutoff","float"),f.fragment.code.add(u.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}};a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){r=function(C){function B(){return C.apply(this,arguments)||this}f._inheritsLoose(B,C);var v=B.prototype;v.initializeProgram=function(E){var F=B.shader.get();const L=this.configuration;F=F.build({output:L.output,FrontFacePass:2===L.transparencyPassType,viewingMode:E.viewingMode,occlusionTestEnabled:L.occlusionTestEnabled,signedDistanceFieldEnabled:L.sdf,slicePlaneEnabled:L.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,
debugDrawBorder:L.debugDrawBorder,binaryHighlightOcclusionEnabled:L.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:L.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:L.screenSizePerspective,verticalOffsetEnabled:L.verticalOffset,pixelSnappingEnabled:L.pixelSnappingEnabled,vvSize:L.vvSize,vvColor:L.vvColor,vvInstancingEnabled:!1,isDraped:L.isDraped,multipassGeometryEnabled:L.multipassGeometryEnabled,multipassTerrainEnabled:L.multipassTerrainEnabled,cullAboveGround:L.cullAboveGround});
return new A.Program(E.rctx,F,d.Default3D)};v.bindPass=function(E,F){m.bindProjectionMatrix(this.program,F.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",F.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(F.camera.fovY/2)/(F.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",F.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",E.shaderPolygonOffset);w.bindVerticalOffsetUniforms(this.program,
E,F);l.bindScreenSizePerspectiveUniforms(this.program,E);this.program.setUniform1f("pixelRatio",F.camera.pixelRatio||1);m.bindViewport(this.program,F);6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",F.camera.nearFar),this.program.setUniform2fv("inverseViewport",F.inverseViewport),b.bindMultipassGeometryTexture(this.program,F),h.bindMultipassTerrainTexture(this.program,F)):(e.bindHUDUniforms(this.program,F),q.bindHUDMaterialUniforms(this.program,E,F.camera.pixelRatio||1),
k.bindVisualVariablesUniforms(this.program,E),this.configuration.occlusionTestEnabled&&this.program.bindTexture(F.hudVisibilityTexture,"hudVisibilityTexture"));4===this.configuration.output&&n.bindOutputHighlight(this.program,F)};v.bindDraw=function(E){m.bindView(this.program,E);m.bindCameraPosition(this.program,E.origin,E.camera.viewInverseTransposeMatrix);t.bindSliceUniformsWithOrigin(this.program,this.configuration,E);this.program.rebindTextures()};v.setPipelineState=function(E){const F=this.configuration,
L=3===E,N=this.configuration.polygonOffsetEnabled&&x,I=!L&&2!==E||4===F.output?null:(F.depthEnabled||6===F.output)&&y.defaultDepthWriteParams;return y.makePipelineState({blending:0===F.output||7===F.output||4===F.output?L?D:g.OITBlending(E):null,depthTest:{func:515},depthWrite:I,colorWrite:y.defaultColorWriteParams,polygonOffset:N})};v.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};f._createClass(B,[{key:"primitiveType",get:function(){return 6===
this.configuration.output?0:4}}]);return B}(r.ShaderTechnique);r.shader=new z.ReloadableShaderModule(q.HUDMaterialShader,()=>new Promise(function(C,B){a(["./HUDMaterial.glsl"],C,B)}));const x={factor:0,units:-4},D=y.simpleBlendingParams(1,771);z=function(C){function B(){var v=C.apply(this,arguments)||this;v.output=0;v.occlusionTestEnabled=!0;v.sdf=!1;v.vvSize=!1;v.vvColor=!1;v.verticalOffset=!1;v.screenSizePerspective=!1;v.screenCenterOffsetUnitsEnabled=0;v.debugDrawBorder=!0;v.binaryHighlightOcclusion=
!0;v.slicePlaneEnabled=!1;v.polygonOffsetEnabled=!1;v.depthEnabled=!0;v.transparencyPassType=3;v.pixelSnappingEnabled=!0;v.isDraped=!1;v.multipassGeometryEnabled=!1;v.multipassTerrainEnabled=!1;v.cullAboveGround=!1;return v}f._inheritsLoose(B,C);return B}(c.ShaderTechniqueConfiguration);p.__decorate([c.parameter({count:8})],z.prototype,"output",void 0);p.__decorate([c.parameter()],z.prototype,"occlusionTestEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"sdf",void 0);p.__decorate([c.parameter()],
z.prototype,"vvSize",void 0);p.__decorate([c.parameter()],z.prototype,"vvColor",void 0);p.__decorate([c.parameter()],z.prototype,"verticalOffset",void 0);p.__decorate([c.parameter()],z.prototype,"screenSizePerspective",void 0);p.__decorate([c.parameter({count:2})],z.prototype,"screenCenterOffsetUnitsEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"debugDrawBorder",void 0);p.__decorate([c.parameter()],z.prototype,"binaryHighlightOcclusion",void 0);p.__decorate([c.parameter()],z.prototype,
"slicePlaneEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"polygonOffsetEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"depthEnabled",void 0);p.__decorate([c.parameter({count:4})],z.prototype,"transparencyPassType",void 0);p.__decorate([c.parameter()],z.prototype,"pixelSnappingEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"isDraped",void 0);p.__decorate([c.parameter()],z.prototype,"multipassGeometryEnabled",void 0);p.__decorate([c.parameter()],z.prototype,"multipassTerrainEnabled",
void 0);p.__decorate([c.parameter()],z.prototype,"cullAboveGround",void 0);u.HUDMaterialTechnique=r;u.HUDMaterialTechniqueConfiguration=z;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,u,f){function p(w,e,n,b=t){b.screenLength=w.screenLength;b.perDistance=Math.tan(.5*e)/(.5*n);b.minWorldLength=w.minWorldLength;
b.maxWorldLength=w.maxWorldLength;return b}const t={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};a.VerticalOffset=function(w,e){const n=w.vertex.code;e.verticalOffsetEnabled?(w.vertex.uniforms.add("verticalOffset","vec4"),e.screenSizePerspectiveEnabled&&(w.include(u.ScreenSizePerspective),w.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),n.add(f.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===e.viewingMode?f.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:f.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${e.screenSizePerspectiveEnabled?f.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:f.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):n.add(f.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.bindVerticalOffsetUniforms=function(w,e,n){e.verticalOffset&&(e=p(e.verticalOffset,n.camera.fovY,n.camera.fullViewport[3]),w.setUniform4f("verticalOffset",e.screenLength*(n.camera.pixelRatio||1),e.perDistance,e.minWorldLength,e.maxWorldLength))};a.calculateVerticalOffsetFactors=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,u){a.bindMultipassTerrainTexture=function(f,p){p.multipassTerrainEnabled&&p.terrainLinearDepthTexture&&f.bindTexture(p.terrainLinearDepthTexture,"terrainDepthTexture")};a.multipassTerrainTest=function(f,p){f.fragment.uniforms.add("terrainDepthTexture","sampler2D");f.fragment.uniforms.add("cameraNearFar","vec2");f.fragment.uniforms.add("inverseViewport","vec2");f.fragment.code.add(u.glsl`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${p.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../../../webgl/renderState"],function(a,u){const f=u.separateBlendingParams(770,1,771,771),p=u.simpleBlendingParams(1,1),t=u.simpleBlendingParams(0,771),w={factor:-1,units:-2};a.OITBlending=function(e){return 2===e?null:1===e?t:p};a.OITDepthTest=function(e){return 3===e||2===e?513:515};a.OITDepthWrite=function(e){return 2===e?u.defaultDepthWriteParams:
null};a.OITPolygonOffset=w;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=t;a.blendingColor=p;a.blendingDefault=f;a.getOITPolygonOffset=function(e){return e?w:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./Deconflictor".split(" "),
function(a,u,f,p,t,w,e,n,b,h){a.LabelDeconflictor=function(k){function l(){var z=k.apply(this,arguments)||this;z.visibilityGroup=1;z.iconMarginFactor=0;z._lastDeconfliction=0;return z}u._inheritsLoose(l,k);var m=l.prototype;m.runTask=function(z){if(!this.parent.running){var r=performance.now();if(2===z.state||2E3<r-this._lastDeconfliction)k.prototype.runTask.call(this,z),0===this.state&&(this._lastDeconfliction=r)}};m.enabledChanged=function(z,r){this.modifyGraphics(r,z.labelsEnabled)};m.getGraphicsLayers=
function(z){return z.labelGraphics};u._createClass(l,[{key:"viewState",get:function(){return this.parent.viewState}}]);return l}(h.Deconflictor);f.__decorate([p.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=f.__decorate([b.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/Scheduler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/time ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../layers/support/PromiseQueue ./debugFlags".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){function A(I){return y.has(I)?y.get(I):"number"===typeof I?I:1}const q=t.getLogger("esri.views.support.Scheduler");a.TaskPriority=void 0;(function(I){I.RESOURCE_CONTROLLER="schedule";I.SLIDE="slide";I.STREAM_DATA_LOADER="stream loader";I.ELEVATION_QUERY="elevation query";I.TERRAIN_SURFACE="terrain";I.SURFACE_GEOMETRY_UPDATES="surface geometry updates";I.GRAPHICS_CORE="Graphics3D";I.I3S_CONTROLLER="I3S";I.POINT_CLOUD_LAYER="point cloud";I.FEATURE_TILE_FETCHER=
"feature fetcher";I.STAGE="stage";I.GRAPHICS_DECONFLICTOR="graphics deconflictor";I.FILTER_VISIBILITY="Graphics3D filter visibility";I.SCALE_VISIBILITY="Graphics3D scale visibility";I.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";I.POINT_OF_INTEREST_FREQUENT="POI frequent";I.POINT_OF_INTEREST_INFREQUENT="POI infrequent";I.LABELER="labeler";I.FEATURE_QUERY_ENGINE="feature query";I.FEATURE_TILE_TREE="feature tile tree";I.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";I.ELEVATION_ALIGNMENT="elevation alignment";
I.TEXT_TEXTURE_ATLAS="text texture atlas";I.TEXTURE_UNLOAD="texture unload";I.OVERLAY_MANAGER="overlay manager";I.LINE_OF_SIGHT_TOOL="line of sight tool";I.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";I.ELEVATION_PROFILE="elevation profile";I.SNAPPING="snapping";I.SHADOW_ACCUMULATOR="shadow accumulator";I[I.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority={}));const y=new Map([[a.TaskPriority.RESOURCE_CONTROLLER,0],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,
0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.STAGE,4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.OVERLAY_MANAGER,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),x=h.Milliseconds(6.5),D=h.Milliseconds(1),
C=h.Milliseconds(30),B=h.Milliseconds(1E3/30),v=h.Milliseconds(100);var E;(function(I){let G=function(J){function M(Q){var S=J.call(this,Q)||this;S.updating=!0;S.performanceInfo={total:new e("total"),tasks:new Map};S._frameTaskTimes=new Map;S._budget=null;S._state=1;S._tasks=new n;S._runQueue=new n;S._load=0;S._idleStateCallbacks=new n;S._idleUpdatesStartFired=!1;S._maxReschedule=N;S._forceTask=!1;S._debug=!1;S._debugHandle=k.init(g,"SCHEDULER_LOG_SLOW_TASKS",W=>S._debug=W);S._budget=new H(Q.nowFunc);
for(const W of Object.keys(a.TaskPriority))S.performanceInfo.tasks.set(a.TaskPriority[W],new e(a.TaskPriority[W]));let V;const Y=u._assertThisInitialized(S);S._test={get state(){return w.isNone(V)?Y._state:V},set state(W){V=W},FRAME_SAFETY_BUDGET:x,INTERACTING_BUDGET:B,IDLE_BUDGET:v,get budget(){return Y._budget.budget},usedBudget:0,updateTask:W=>S._updateTask(W),getState:W=>S._getState(W),getRuntime:W=>S._getRuntime(W),resetRuntimes:()=>S._resetRuntimes(),getRunning:()=>S._getRunning()};return S}
u._inheritsLoose(M,J);var O=M.prototype;O.destroy=function(){this._debugHandle&&this._debugHandle.remove()};O.registerTask=function(Q,S){const V=A(Q);S=new K(this,Q,S,V);this._tasks.push(S);this.performanceInfo.tasks.has(Q)||this.performanceInfo.tasks.set(Q,new e(Q));return S};O.registerIdleStateCallbacks=function(Q,S){const V={idleBegin:Q,idleEnd:S};this._idleStateCallbacks.push(V);2===this.state&&this._idleUpdatesStartFired&&V.idleBegin();const Y=this;return{remove:()=>this._removeIdleStateCallbacks(V),
set idleBegin(W){Y._idleUpdatesStartFired&&(V.idleEnd(),2===Y._state&&W());V.idleBegin=W},set idleEnd(W){V.idleEnd=W}}};O.updateBudget=function(Q){this._test.usedBudget=0;let S=x,V=Q.frameDuration,Y=D;switch(this.state){case 2:S=h.Milliseconds(0);V=h.Milliseconds(Math.max(v,Q.frameDuration));Y=C;break;case 1:V=h.Milliseconds(Math.max(B,Q.frameDuration))}V=h.Milliseconds(V-Q.elapsedFrameTime-S);if(2!==this.state&&V<D&&!this._forceTask)return this._forceTask=!0,!1;V=h.Milliseconds(Math.max(V,Y));this._budget.reset(V,
this.state);this._maxReschedule=N;this._updateLoad();return this._schedule()};O.frame=function(){this._forceTask=!1;switch(this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(Q=>Q.idleBegin()));this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed};O.stopFrame=function(){this._budget.reset(h.Milliseconds(0),this._state);this._budget.madeProgress()};O._removeIdleStateCallbacks=
function(Q){this._idleUpdatesStartFired&&Q.idleEnd();this._idleStateCallbacks.removeUnordered(Q)};O.removeTask=function(Q){this._tasks.removeUnordered(Q);this._runQueue.removeUnordered(Q)};O._updateTask=function(Q){this._tasks.forAll(S=>{S.name===Q&&S.setPriority(Q)})};O._getState=function(Q){if(this._runQueue.some(V=>V.name===Q))return a.TaskState.SCHEDULED;let S=a.TaskState.IDLE;this._tasks.forAll(V=>{V.name===Q&&V.needsUpdate&&(1>=V.schedulePriority?S=a.TaskState.READY:S!==a.TaskState.READY&&(S=
a.TaskState.WAITING))});return S};O._getRuntime=function(Q){let S=0;this._tasks.forAll(V=>{V.name===Q&&(S+=V.runtime)});return S};O._resetRuntimes=function(){this._tasks.forAll(Q=>Q.runtime=0)};O._getRunning=function(){const Q=new Map;this._tasks.forAll(V=>{V.needsUpdate&&Q.set(V.name,(Q.get(V.name)||0)+1)});if(0===Q.size)return null;let S="";Q.forEach((V,Y)=>{S=1<V?S+` ${V}x ${Y}`:S+` ${Y}`});return S};O._runIdle=function(){this._run()};O._runInteracting=function(){this._run()};O._runAnimating=function(){this._run()};
O._updateLoad=function(){const Q=this._tasks.reduce((S,V)=>V.needsUpdate?++S:S,0);this._load=.9*this._load+Q*(1-.9)};O._schedule=function(){if(0>=this._maxReschedule)return!1;this._runQueue.filterInPlace(Q=>{if(Q.needsUpdate)return!0;Q.schedulePriority=Q.basePriority;return!1});for(this._tasks.forAll(Q=>{0===Q.basePriority&&Q.needsUpdate&&!this._runQueue.some(S=>S===Q)&&this._runQueue.unshift(Q)});0===this._runQueue.length;){let Q=!1,S=0;this._tasks.forAll(V=>{if(V.needsUpdate&&0!==V.schedulePriority&&
0!==V.basePriority)switch(Q=!0,S=Math.max(S,V.basePriority),V.schedulePriority){case 1:V.schedulePriority=0;this._runQueue.push(V);break;default:--V.schedulePriority}});if(!Q)return this.updating=!1;this._maxReschedule===N&&(this._maxReschedule=S);--this._maxReschedule}return this.updating=!0};O._run=function(){const Q=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var S=this._budget.now();const V=this._runQueue.pop();this._budget.resetProgress();try{V.task.runTask(this._budget)}catch(Y){q.error(`Exception in task "${V.name}"`,
Y)}V.schedulePriority=V.basePriority;S=this._budget.now()-S;V.runtime+=S;this._frameTaskTimes.set(V.priority,this._frameTaskTimes.get(V.priority)+S);this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",V.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._recordFrameTaskTimes(this._budget.now()-Q);return}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-Q)};O._startFrameTaskTimes=function(){for(const Q of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[Q],
0)};O._recordFrameTaskTimes=function(Q){this._frameTaskTimes.forEach((S,V)=>this.performanceInfo.tasks.get(V).record(S));this.performanceInfo.total.record(Q)};u._createClass(M,[{key:"now",get:function(){return this.nowFunc()}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return w.isNone(this._test.state)?this._state:this._test.state},set:function(Q){this._state!==Q&&(this._state=Q,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(S=>
S.idleEnd())))}},{key:"test",get:function(){return this._test}}]);return M}(p);f.__decorate([l.property()],G.prototype,"updating",void 0);f.__decorate([l.property()],G.prototype,"nowFunc",void 0);G=f.__decorate([c.subclass("esri.views.support.Scheduler")],G);I.Scheduler=G;let K=function(J){function M(Q,S,V,Y){var W=J.call(this,{})||this;W._scheduler=Q;W.name=S;W._basePriority=Y;W.runtime=0;W._queue=new d;W.updating=!1;W.schedulePriority=W._basePriority;W.task=w.isSome(V)?V:{running:!1,runTask:ba=>
W.processQueue(ba)};return W}u._inheritsLoose(M,J);var O=M.prototype;O.normalizeCtorArgs=function(){return{}};O.remove=function(){this.processQueue(F);this._scheduler.removeTask(this);this.schedule=L.schedule;this.reschedule=L.reschedule};O.setPriority=function(Q){this.name=Q;Q=A(Q);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=Q;this._basePriority=Q};O.schedule=function(Q,S,V){this.updating=!0;return this._queue.push(Q,S,V)};O.reschedule=function(Q,S,V){this.updating=
!0;return this._queue.unshift(Q,S,V)};O.processQueue=function(Q){for(;!Q.done&&this._queue.process();)Q.madeProgress();this.updating=0<this._queue.length};u._createClass(M,[{key:"basePriority",get:function(){return this._basePriority}},{key:"priority",get:function(){return this.name},set:function(Q){this.setPriority(Q)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}}]);return M}(p);f.__decorate([l.property()],K.prototype,"updating",void 0);K=f.__decorate([c.subclass("esri.views.support.SchedulerTask")],
K);let H=function(){function J(O){this.now=O;this._budget=this._begin=0;this._state=2;this._didWork=!1;this._enabled=!0}var M=J.prototype;M.run=function(O){if(this.done)return!1;!0===O()&&(this._didWork=!0);return!0};M.madeProgress=function(){this._didWork=!0};M.reset=function(O,Q){this._begin=this.now();this._budget=O;this._state=Q;this._didWork=!1};M.resetProgress=function(){this._didWork=!1};u._createClass(J,[{key:"done",get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}},
{key:"budget",get:function(){return this._budget}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(O){this._enabled=O}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"elapsed",get:function(){return this.now()-this._begin}},{key:"hasProgressed",get:function(){return this._didWork}}]);return J}();I.Budget=H})(E||(E={}));a.TaskState=void 0;(function(I){I.SCHEDULED="s";I.READY="r";I.WAITING="w";I.IDLE=
"i"})(a.TaskState||(a.TaskState={}));const F=(()=>{const I=new E.Budget(()=>performance.now());I.enabled=!1;return I})(),L=new (function(){function I(){}var G=I.prototype;G.remove=function(){};G.processQueue=function(){};G.schedule=function(K,H,J){try{if(b.isAborted(H)){const M=b.createAbortError();return J?Promise.resolve(J(M)):Promise.reject(M)}return b.when(K())}catch(M){return Promise.reject(M)}};G.reschedule=function(K,H,J){return this.schedule(K,H,J)};return I}()),N=Number.MAX_SAFE_INTEGER;
a.ImmediateTask=L;a.getTaskPriority=A;a.newScheduler=function(I){return new E.Scheduler({nowFunc:I})};a.noBudget=F;a.taskPriorities=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/PromiseQueue":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils"],function(a,u){let f=function(p,t,w,e,n){this.resolve=p;this.reject=t;this.callback=w;this.signal=e;this.abortCallback=n};return function(){function p(){this._tasks=[]}var t=p.prototype;t.push=function(w,
e,n){return new Promise((b,h)=>this._tasks.push(new f(b,h,w,e,n)))};t.unshift=function(w,e,n){return new Promise((b,h)=>this._tasks.unshift(new f(b,h,w,e,n)))};t.process=function(){if(0===this._tasks.length)return!1;const w=this._tasks.shift();try{const e=u.isAborted(w.signal);if(e&&!w.abortCallback)w.reject(u.createAbortError());else{const n=e?w.abortCallback(u.createAbortError()):w.callback();u.isPromise(n)?n.then(w.resolve,w.reject):w.resolve(n)}}catch(e){w.reject(e)}return!0};t.cancelAll=function(){const w=
u.createAbortError();for(const e of this._tasks)if(e.abortCallback){const n=e.abortCallback(w);e.resolve(n)}else e.reject(w);this._tasks.length=0};a._createClass(p,[{key:"length",get:function(){return this._tasks.length}}]);return p}()})},"esri/views/support/debugFlags":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b){f=function(h){function k(){var l=h.apply(this,arguments)||this;l.SCHEDULER_LOG_SLOW_TASKS=!1;l.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1;return l}a._inheritsLoose(k,h);return k}(f);u.__decorate([p.property()],f.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);u.__decorate([p.property()],f.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);f=u.__decorate([b.subclass("esri.views.support.DebugFlags")],f);return new f})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N){const I=e.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(K){function H(){var M=K.apply(this,arguments)||this;M._dirty=!1;M._labels=new Map;M._labelsToAdd=new Map;M._labelsToRemove=new Map;M._labelingContexts=[];return M}u._inheritsLoose(H,K);var J=H.prototype;J.setup=function(){this.dispose();this._handles=new w;this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",
()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(N.TaskPriority.LABELER,this)]);this._textTextureAtlas=new F["default"]({view:this.view});this._hudMaterialCollection=new B.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new B.MaterialCollection(this.view._stage)};J.dispose=function(){this._handles=b.destroyMaybe(this._handles);this._textTextureAtlas=b.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=b.disposeMaybe(this._hudMaterialCollection);
this._calloutMaterialCollection=b.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};J._activateLabelingContext=function(M){M.labels.forEach((O,Q)=>{this._labels.set(Q,O);O.graphics3DGraphic.setVisibilityFlag(0,!0,1)});M.active=!0};J._deactivateLabelingContext=function(M){M.labels.forEach((O,Q)=>{O.graphics3DGraphic.setVisibilityFlag(0,!1,1);this.setLabelGraphicVisibility(O.graphics3DGraphic,!1);
this._labels.delete(Q)});M.active=!1};J._addLabelTextureToAtlas=function(M){for(const O of M.graphics3DGraphic.labelGraphics){if(!O._labelClass)continue;const Q=M.textRenderers[O._labelIndex];Q&&this._textTextureAtlas.addTextTexture(Q,O.stageObject)}M.rendered=!0};J._removeLabelTextureFromAtlas=function(M){for(const O of M.graphics3DGraphic.labelGraphics){if(!O._labelClass)continue;const Q=M.textRenderers[O._labelIndex];Q&&this._textTextureAtlas.removeTextTexture(Q,O.stageObject)}M.rendered=!1};J.runTask=
function(M){this._updateLabels(M);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(M)};J._updateLabels=function(M){if(this._dirty){this._dirty=!1;for(const O of this._labelingContexts)if(O.active&&g.areLabelsVisible(O.layer)){if(!O.labelClassContexts||!O.labelClassContexts.length){if(null===O.labelClassContexts){this._deactivateLabelingContext(O);continue}this._createLabelClassContext(O);if(O.labelClassPromise&&O.labelClassAbortController){this._dirty=!0;continue}if(!O.labelClassContexts||
!O.labelClassContexts.length)continue}n.someMap(O.labelsToInitialize,(Q,S)=>{this._ensureGraphics3DResources(Q)&&(this._labels.set(S,Q),this.deconflictor.setDirty(),M.madeProgress());if(Q.visible&&Q.hasTextTextureResources||!Q.visible&&Q.hasGraphics3DResources)O.labelsToInitialize.delete(S),M.madeProgress();return M.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(O=>this._removeLabelTextureFromAtlas(O));this._labelsToAdd.forEach(O=>this._addLabelTextureToAtlas(O));this._labelsToRemove.clear();
this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};J._createLabelClassContextAsync=function(){var M=u._asyncToGenerator(function*(O){var Q=this;const S=O.labelClassAbortController.signal;yield O.layer.when();h.throwIfAborted(S);O.scaleVisibility&&O.scaleVisibility.updateScaleRangeActive();const V=O.graphics3DCore;var Y=V.layer;if((Y=Y.labelingInfo&&Y.labelingInfo.filter(ca=>!!ca.symbol))&&0!==Y.length){var W=Array(Y.length),ba=!1;yield t.forEach(Y,function(){var ca=u._asyncToGenerator(function*(da,
ha){var fa=da.symbol;const R=x.getGraphics3DSymbol(V.getOrCreateGraphics3DSymbol(fa));if(b.isNone(R))I.error("Failed to create Graphics3DSymbol for label");else{yield R.load();h.throwIfAborted(S);var U=null;A.isCalloutSupport(fa)&&fa.hasVisibleCallout()&&(U=q.make(fa,V.symbolCreationContext),yield U.load(),h.throwIfAborted(S));fa=yield t.result(d.createLabelFunction(da,O.layer.fieldsIndex,Q.view.spatialReference));h.throwIfAborted(S);!0===fa.ok?W[ha]={labelClass:da,labelFunction:fa.value,graphics3DSymbol:R,
graphics3DCalloutSymbolLayer:U,calloutSymbolLayerIndex:0,textRenderParameters:Q._createTextRenderParameters(R.symbol)}:(I.error(`Label expression failed to evaluate: ${fa.error}`),ba=!0)}});return function(da,ha){return ca.apply(this,arguments)}}());h.throwIfAborted(S);ba||(O.labelClassContexts=W)}});return function(O){return M.apply(this,arguments)}}();J._createLabelClassContext=function(){var M=u._asyncToGenerator(function*(O){O.labelClassPromise||(O.labelClassPromise=this._createLabelClassContextAsync(O).catch(Q=>
{if(h.isAbortError(Q))throw Q;O.labelClassContexts=null}).then(()=>{O.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return O.labelClassPromise});return function(O){return M.apply(this,arguments)}}();J._createTextRenderParameters=function(M){return(M=M.symbolLayers.getItemAt(0))&&"text"===M.type?E.TextRenderParameters.fromSymbol(M,this.view.pixelRatio):null};J._destroyLabelClassContext=function(M){for(var O of M.labelClassContexts)--O.graphics3DSymbol.referenced,
O.graphics3DSymbol=null;O=M.labelClassAbortController;M.labelClassAbortController=h.createAbortController();O&&O.abort();M.labelClassContexts=[];M.labelClassPromise=null;this.notifyChange("updating")};J._createTextSymbolGraphic=function(M,O,Q,S,V){M={text:M.text,centerOffset:Q.centerOffset,translation:Q.translation,elevationOffset:Q.elevationOffset,screenOffset:Q.screenOffset,anchor:Q.anchor,centerOffsetUnits:Q.centerOffsetUnits,verticalOffset:Q.verticalOffset,debugDrawBorder:C.LABELS_SHOW_BORDER,
displayWidth:M.displayWidth,displayHeight:M.displayHeight};G.graphic=O;G.renderingInfo=null;G.layer=S;return V.createLabel(G,M,this._hudMaterialCollection,this._textTextureAtlas)};J._createLineCalloutGraphic=function(M,O,Q,S,V){O={symbol:O,translation:S.translation,elevationOffset:S.elevationOffset,screenOffset:S.screenOffset,centerOffset:S.centerOffset,centerOffsetUnits:S.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};G.graphic=M;G.renderingInfo=O;G.layer=V;return Q.createGraphics3DGraphic(G)};
J._ensureGraphics3DResources=function(M){if(M.hasGraphics3DResources)return!1;const O=M.graphics3DGraphic;if(O.destroyed)return!1;this._ensureTextTextureResources(M);const Q=M.labelingContext,S=Q.labelClassContexts;if(!S||0===S.length||!Q.emptySymbolLabelSupported&&0===O._graphics.length)return!1;var V=!1,Y=O.graphic;const W=Q.layer;var ba=g.areLabelsVisible(Q.layer);const ca=this.view._stage;for(let ha=0;ha<S.length;ha++){const fa=M.textRenderers[ha];if(!fa)continue;const R=S[ha];var da=R.graphics3DSymbol;
let U=null;da.symbol&&"label-3d"===da.symbol.type&&(U=da.symbol);const Z=da.symbolLayers[0];if(!Z)continue;const T=R.labelClass;da=D.get({graphics3DGraphic:O,labelSymbol:U,labelClass:T,disablePlacement:Q.disablePlacement});if(!b.isNone(da)){Z.setElevationInfoOverride(Q.elevationInfoOverride);V=this._createTextSymbolGraphic(fa,Y,da,W,Z);if(!V)return!1;V._labelClass=T;V._labelIndex=ha;O.addLabelGraphic(V,ca,Q.stageLayer);O.setVisibilityFlag(0,ba,1);O.clearVisibilityFlag(1,1);O.setVisibilityFlag(3,!1,
1);V=!0;(ba=R.graphics3DCalloutSymbolLayer)&&da.hasLabelVerticalOffset&&(ba.setElevationInfoOverride(Q.elevationInfoOverride),Y=this._createLineCalloutGraphic(Y,U,ba,da,W))&&(R.calloutSymbolLayerIndex=O.labelGraphics.length,O.addLabelGraphic(Y,ca,Q.stageLayer));break}}Q.scaleVisibility&&V&&Q.scaleVisibility.updateGraphicLabelScaleVisibility(O);return M.hasGraphics3DResources=!0};J._destroyGraphics3DResources=function(M){const O=M.labelingContext.labelClassContexts;for(const Q of M.graphics3DGraphic.labelGraphics){if(null==
Q._labelClass)continue;const S=O[Q._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=S)S.onRemoveGraphic(Q)}M.graphics3DGraphic.clearLabelGraphics();M.hasGraphics3DResources=!1};J._ensureTextTextureResources=function(M){if(!M.hasTextTextureResources){var O=M.labelingContext,Q=O.labelClassContexts;if(Q&&0!==Q.length){var S=M.graphics3DGraphic.graphic;for(let V=0;V<Q.length;V++){const Y=Q[V];M.textRenderers[V]=null;if(!Y.textRenderParameters)continue;const W=Y.labelFunction;let ba;if("arcade"===
W.type)try{const ca=W.needsHydrationToEvaluate()?c.hydrateGraphic(S,O.layer):S;ba=W.evaluate(ca)}catch(ca){ba=null}else ba=W.evaluate(S);b.isNone(ba)||""===ba||/^\s+$/.test(ba)||(M.textRenderers[V]=new v.TextRenderer(ba,Y.textRenderParameters))}M.hasTextTextureResources=!0}}};J._destroyTextTextureResources=function(M){M.textRenderers=[];M.hasTextTextureResources=!1};J._addGraphic=function(M,O){const Q={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:M,graphics3DGraphic:O,
textRenderers:[]};O=O.graphic.uid;M.labels.set(O,Q);M.labelsToInitialize.set(O,Q);this.setDirty();this.deconflictor.setDirty()};J._removeGraphic=function(M,O){O=O.graphic.uid;const Q=M.labels.get(O);Q&&(this._destroyGraphic(Q,O),M.labels.delete(O),M.labelsToInitialize.delete(O),this.setDirty(),this.deconflictor.setDirty())};J._destroyGraphic=function(M,O){this._labels.has(O)&&(this._labels.delete(O),this._labelsToAdd.delete(O),this._labelsToRemove.delete(O));M.hasTextTextureResources&&(this._removeLabelTextureFromAtlas(M),
this._destroyTextTextureResources(M));M.hasGraphics3DResources&&this._destroyGraphics3DResources(M)};J._labelingInfoChange=function(){var M=u._asyncToGenerator(function*(O,Q){if(Q)for(const S of Q){if(Q=O.labels.get(S))this._removeGraphic(O,Q.graphics3DGraphic),this._addGraphic(O,Q.graphics3DGraphic)}else return this._visibilityInfoChange(O),this._resetLabels(O),this._createLabelClassContext(O)});return function(O,Q){return M.apply(this,arguments)}}();J._globalPropertyChanged=function(M,O){for(const Q of O.labelClassContexts){const S=
new Map;O.labels.forEach(V=>{V=V.graphics3DGraphic;S.set(V.graphic.uid,V)});b.unwrap(Q.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(M,S,V=>V.labelGraphics[0]);Q.graphics3DCalloutSymbolLayer&&Q.graphics3DCalloutSymbolLayer.globalPropertyChanged(M,S,V=>V.labelGraphics[Q.calloutSymbolLayerIndex])}};J._visibilityInfoChange=function(M){const O=M.layer.labelsVisible;O&&!M.active&&this._activateLabelingContext(M);!O&&M.active&&this._deactivateLabelingContext(M);this.setDirty()};J._resetAllLabels=
function(){for(const M of this._labelingContexts)this._resetLabels(M)};J._resetLabels=function(M){M.labels.forEach((O,Q)=>{this._destroyGraphic(O,Q);O.visible=!1;O.rendered=!1;M.labelsToInitialize.set(Q,O)});this._destroyLabelClassContext(M);this.setDirty();this.deconflictor.setDirty()};J._findLabelingContext=function(M){for(const O of this._labelingContexts)if(O.graphics3DCore===M)return O;return null};J.addGraphicsOwner=function(M,O,Q){const S=Q&&Q.emptySymbolLabelSupported||!1,V=Q&&Q.elevationInfoOverride||
null;Q=Q&&Q.disablePlacement||null;if(!this._findLabelingContext(M)){var Y=M.layer,W={graphics3DCore:M,layer:Y,scaleVisibility:O,emptySymbolLabelSupported:S,elevationInfoOverride:V,disablePlacement:Q,active:Y.labelsVisible,labelClassPromise:null,labelClassAbortController:h.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new L.WebGLLayer({isPickable:!0},Y.uid)};this.view._stage.add(W.stageLayer);this._labelingContexts.push(W);this.setDirty();return{addGraphic:ba=>
this._addGraphic(W,ba),removeGraphic:ba=>this._removeGraphic(W,ba),featureReductionChange:()=>{},layerLabelsEnabled:()=>g.areLabelsVisible(W.layer),labelingInfoChange:ba=>this._labelingInfoChange(W,ba),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",W),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",W),visibilityInfoChange:()=>this._visibilityInfoChange(W),reset:()=>this._resetLabels(W),clear:()=>{}}}};J.removeGraphicsOwner=function(M){const O=this._findLabelingContext(M);
O&&(M=this._labelingContexts.indexOf(O),this._labelingContexts.splice(M,1),O.labels.forEach(Q=>this._removeGraphic(O,Q.graphics3DGraphic)),this.view._stage.remove(O.stageLayer),O.stageLayer=null,this.setDirty())};J.setLabelGraphicVisibility=function(M,O){M=M.graphic.uid;const Q=this._labels.get(M);Q&&Q.visible!==O&&(O&&!Q.rendered?(this._labelsToAdd.set(M,Q),this._labelsToRemove.delete(M),Q.hasTextTextureResources||Q.labelingContext.labelsToInitialize.set(M,Q)):!O&&Q.rendered&&(this._labelsToRemove.set(M,
Q),this._labelsToAdd.delete(M)),Q.visible=O,this.setDirty())};J.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};u._createClass(H,[{key:"running",get:function(){var M;return this.view.ready?this._dirty||(null==(M=this._textTextureAtlas)?void 0:M.updating)||this.deconflictor.running:!1}},{key:"updating",get:function(){var M;return this._dirty||(null==(M=this._textTextureAtlas)?void 0:M.updating)||this.deconflictor.updating||this._labelingContexts.some(O=>
O.labelClassPromise&&!!O.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const M=0<this._labelingContexts.length?this._labelingContexts.reduce((O,Q)=>O+(Q.labelClassPromise&&Q.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*M+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>
this._resetAllLabels()}}}]);return H}(p);f.__decorate([k.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);f.__decorate([k.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);f.__decorate([k.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);f.__decorate([k.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=f.__decorate([r.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const G=new y(null,null,null);Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),function(a,u,f,p,t,w,e,n){function b(g){return"declaredClass"in g}function h(g){return"declaredClass"in g}function k(g){return"declaredClass"in g}function l(g){return t.isNone(g)?null:b(g)?g:e.fromJSON(m(g))}function m(g){const A=g.spatialReference.toJSON();
switch(g.type){case "point":{const {x:q,y,z:x,m:D}=g;return{x:q,y,z:x,m:D,spatialReference:A}}case "polygon":{const {rings:q,hasZ:y,hasM:x}=g;return{rings:z(q),hasZ:y,hasM:x,spatialReference:A}}case "polyline":{const {paths:q,hasZ:y,hasM:x}=g;return{paths:z(q),hasZ:y,hasM:x,spatialReference:A}}case "extent":{const {xmin:q,xmax:y,ymin:x,ymax:D,zmin:C,zmax:B,mmin:v,mmax:E,hasZ:F,hasM:L}=g;return{xmin:q,xmax:y,ymin:x,ymax:D,zmin:C,zmax:B,mmin:v,mmax:E,hasZ:F,hasM:L,spatialReference:A}}case "multipoint":{const {points:q,
hasZ:y,hasM:x}=g;return{points:d(q)?r(q):q,hasZ:y,hasM:x,spatialReference:A}}}}function z(g){return c(g)?g.map(A=>r(A)):g}function r(g){return g.map(A=>w.toArray(A))}function c(g){for(const A of g)if(0!==A.length)return d(A);return!1}function d(g){return g.length&&(w.isFloat32Array(g[0])||w.isFloat64Array(g[0]))}a.clonePoint=function(g,A){if(!g)return null;if(h(g)){if(null==A)return g.clone();if(h(A))return A.copy(g)}null!=A?(A.x=g.x,A.y=g.y,A.spatialReference=g.spatialReference,g.hasZ?(A.z=g.z,A.hasZ=
g.hasZ):(A.z=null,A.hasZ=!1),g.hasM?(A.m=g.m,A.hasM=!0):(A.m=null,A.hasM=!1)):(A=n.makeDehydratedPoint(g.x,g.y,g.z,g.spatialReference),g.hasM&&(A.m=g.m,A.hasM=!0));return A};a.hydrateGeometry=l;a.hydrateGraphic=function(g,A){if(!g)return null;if(k(g))return g;A=new u({layer:A,sourceLayer:A});A.visible=g.visible;A.symbol=p.clone(g.symbol);A.attributes=p.clone(g.attributes);A.geometry=l(g.geometry);return A};a.isHydratedGeometry=b;a.isHydratedGraphic=k;a.isHydratedPoint=h;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(q,y,x){if(!q)return null;switch(y){case "point":return{x:q.x,
y:q.y,z:q.z,m:q.m,hasZ:null!=q.z,hasM:null!=q.m,type:"point",spatialReference:x};case "polyline":return{paths:q.paths,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polyline",spatialReference:x};case "polygon":return{rings:q.rings,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polygon",spatialReference:x};case "multipoint":return{points:q.points,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"multipoint",spatialReference:x}}}function r(q){if(p.isNone(q))return 0;let y=32;switch(q.type){case "point":y+=42;break;case "polyline":case "polygon":{var x=
0;const D=2+(q.hasZ?1:0)+(q.hasM?1:0);q="polyline"===q.type?q.paths:q.rings;for(const C of q)x+=C.length;y+=8*x*D+64;y+=128*x;y=y+34+32*(q.length+1);break}case "multipoint":x=q.points.length;y+=8*x*(2+(q.hasZ?1:0)+(q.hasM?1:0))+64;y+=128*x;y=y+34+32;break;case "extent":y+=98;q.hasM&&(y+=32);q.hasZ&&(y+=32);break;case "mesh":y+=t.estimateSize(q.vertexAttributes.position),y+=t.estimateSize(q.vertexAttributes.normal),y+=t.estimateSize(q.vertexAttributes.uv),y+=t.estimateSize(q.vertexAttributes.tangent)}return y}
function c(q,y){n.empty(y);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":y[0]=y[3]=q.x;y[1]=y[4]=q.y;q.hasZ&&(y[2]=y[5]=q.z);break;case "polyline":for(var x=0;x<q.paths.length;x++)n.expandWithNestedArray(y,q.paths[x],q.hasZ);break;case "polygon":for(x=0;x<q.rings.length;x++)n.expandWithNestedArray(y,q.rings[x],q.hasZ);break;case "multipoint":n.expandWithNestedArray(y,q.points,q.hasZ);break;case "extent":y[0]=q.xmin,y[1]=q.ymin,y[3]=q.xmax,y[4]=q.ymax,null!=q.zmin&&(y[2]=q.zmin),null!=
q.zmax&&(y[5]=q.zmax)}}function d(q,y){b.empty(y);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":y[0]=y[2]=q.x;y[1]=y[3]=q.y;break;case "polyline":for(var x=0;x<q.paths.length;x++)b.expandWithNestedArray(y,q.paths[x]);break;case "polygon":for(x=0;x<q.rings.length;x++)b.expandWithNestedArray(y,q.rings[x]);break;case "multipoint":b.expandWithNestedArray(y,q.points);break;case "extent":y[0]=q.xmin,y[1]=q.ymin,y[2]=q.xmax,y[3]=q.ymax}}const g=n.create(),A=b.create();a.equals=m.equals;a.DehydratedFeatureClass=
function(q,y,x){this.uid=q;this.geometry=y;this.attributes=x;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=c;a.computeAABR=d;a.estimateGeometryObjectSize=r;a.estimateSize=function(q){let y;y=32+u.estimateAttributesObjectSize(q.attributes);
return y=y+3+(8+r(q.geometry))};a.expandAABB=function(q,y){c(q,g);n.expandWithAABB(y,g)};a.expandAABR=function(q,y){d(q,A);b.expand(y,A)};a.fromFeatureSetJSON=function(q){const y=k.featureGeometryTypeKebabDictionary.fromJSON(q.geometryType),x=e.fromJSON(q.spatialReference),D=q.transform,C=q.features.map(B=>{var v=q.objectIdFieldName;B={uid:w.generateUID(),objectId:v&&B.attributes?B.attributes[v]:null,attributes:B.attributes,geometry:z(B.geometry,y,x),visible:!0};v=B.geometry;if(p.isSome(v)&&D)switch(v.type){case "point":B.geometry=
h.unquantizePoint(D,v,v,v.hasZ,v.hasM);break;case "multipoint":B.geometry=h.unquantizeMultipoint(D,v,v,v.hasZ,v.hasM);break;case "polygon":B.geometry=h.unquantizePolygon(D,v,v,v.hasZ,v.hasM);break;case "polyline":B.geometry=h.unquantizePolyline(D,v,v,v.hasZ,v.hasM);break;case "extent":B.geometry=v;break;case "mesh":B.geometry=v}return B});return{geometryType:y,features:C,spatialReference:x,fields:q.fields?q.fields.map(B=>l.fromJSON(B)):null,objectIdFieldName:q.objectIdFieldName,globalIdFieldName:q.globalIdFieldName,
geohashFieldName:q.geohashFieldName,geometryProperties:q.geometryProperties,hasZ:q.hasZ,hasM:q.hasM,exceededTransferLimit:q.exceededTransferLimit,transform:null}};a.fromJSONGeometry=z;a.getObjectId=function(q,y){return null!=q.objectId?q.objectId:q.attributes&&y?q.attributes[y]:null};a.hasGeometry=function(q){return p.isSome(q.geometry)};a.hasVertices=function(q){if(p.isNone(q))return!1;switch(q.type){case "extent":case "point":return!0;case "polyline":for(const y of q.paths)if(0<y.length)return!0;
return!1;case "polygon":for(const y of q.rings)if(0<y.length)return!0;return!1;case "multipoint":return 0<q.points.length;case "mesh":return!q.loaded||0<q.vertexAttributes.position.length}};a.isFeatureGeometry=function(q){return k.isFeatureGeometryType(q.type)};a.makeDehydratedPoint=function(q,y,x,D){return{x:q,y,z:x,hasZ:null!=x,hasM:!1,spatialReference:D,type:"point"}};a.numVertices=function(q){if(p.isNone(q))return 0;switch(q.type){case "point":return 1;case "polyline":var y=0;for(var x of q.paths)y+=
x.length;return y;case "polygon":x=0;for(y of q.rings)x+=y.length;return x;case "multipoint":return q.points.length;case "extent":return 2;case "mesh":return(q=q.vertexAttributes&&q.vertexAttributes.position)?q.length/3:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function u(f){return 32+f.length}a.estimateAttributesObjectSize=function(f){if(!f)return 0;let p=32;for(const t in f)if(f.hasOwnProperty(t)){const w=f[t];
switch(typeof w){case "string":p+=u(w);break;case "number":p+=16;break;case "boolean":p+=4}}return p};a.estimateFixedArraySize=function(f,p){return 32+f.length*p};a.estimateNumberByteSize=function(){return 16};a.estimateStringByteSize=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,u){function f({scale:v,translate:E},F){return Math.round((F-E[0])/v[0])}function p({scale:v,translate:E},F){return Math.round((E[1]-
F)/v[1])}function t(v,E,F){const L=[];let N,I,G,K;for(let H=0;H<F.length;H++){const J=F[H];if(0<H){if(G=f(v,J[0]),K=p(v,J[1]),G!==N||K!==I)L.push(E(J,G-N,K-I)),N=G,I=K}else N=f(v,J[0]),I=p(v,J[1]),L.push(E(J,N,I))}return 0<L.length?L:null}function w(v,E,F,L){return t(v,F?L?B:C:L?C:D,E)}function e(v,E,F,L){const N=[];F=F?L?B:C:L?C:D;for(L=0;L<E.length;L++){const I=t(v,F,E[L]);I&&3<=I.length&&N.push(I)}return N.length?N:null}function n(v,E,F,L){const N=[];F=F?L?B:C:L?C:D;for(L=0;L<E.length;L++){const I=
t(v,F,E[L]);I&&2<=I.length&&N.push(I)}return N.length?N:null}function b({scale:v,translate:E},F){return F*v[0]+E[0]}function h({scale:v,translate:E},F){return E[1]-F*v[1]}function k(v,E,F){const L=Array(F.length);if(!F.length)return L;const [N,I]=v.scale;let G=b(v,F[0][0]);v=h(v,F[0][1]);L[0]=E(F[0],G,v);for(let K=1;K<F.length;K++){const H=F[K];G+=H[0]*N;v-=H[1]*I;L[K]=E(H,G,v)}return L}function l(v,E,F){const L=Array(F.length);for(let N=0;N<F.length;N++)L[N]=k(v,E,F[N]);return L}function m(v,E,F,
L){return k(v,F?L?B:C:L?C:D,E)}function z(v,E,F,L){return l(v,F?L?B:C:L?C:D,E)}function r(v,E,F,L){return l(v,F?L?B:C:L?C:D,E)}function c(v,E,F){let [L,N]=F[0],I=Math.min(L,E[0]),G=Math.min(N,E[1]),K=Math.max(L,E[2]);E=Math.max(N,E[3]);for(let H=1;H<F.length;H++){const [J,M]=F[H];L+=J;N+=M;0>J&&(I=Math.min(I,L));0<J&&(K=Math.max(K,L));0>M?G=Math.min(G,N):0<M&&(E=Math.max(E,N))}v[0]=I;v[1]=G;v[2]=K;v[3]=E;return v}function d(v,E){if(!E.length)return null;v[0]=v[1]=Number.POSITIVE_INFINITY;v[2]=v[3]=
Number.NEGATIVE_INFINITY;for(let F=0;F<E.length;F++)c(v,v,E[F]);return v}function g(v,E,F,L,N){E.xmin=f(v,F.xmin);E.ymin=p(v,F.ymin);E.xmax=f(v,F.xmax);E.ymax=p(v,F.ymax);E!==F&&(L&&(E.zmin=F.zmin,E.zmax=F.zmax),N&&(E.mmin=F.mmin,E.mmax=F.mmax));return E}function A(v,E,F,L,N){E.points=w(v,F.points,L,N);return E}function q(v,E,F,L,N){E.x=f(v,F.x);E.y=p(v,F.y);E!==F&&(L&&(E.z=F.z),N&&(E.m=F.m));return E}function y(v,E,F,L,N){v=e(v,F.rings,L,N);if(!v)return null;E.rings=v;return E}function x(v,E,F,L,
N){v=n(v,F.paths,L,N);if(!v)return null;E.paths=v;return E}const D=(v,E,F)=>[E,F],C=(v,E,F)=>[E,F,v[2]],B=(v,E,F)=>[E,F,v[2],v[3]];a.equals=function(v,E){if(v===E||null==v&&null==E)return!0;if(null==v||null==E)return!1;let F,L,N,I;v&&"upperLeft"===v.originPosition?(F=v.translate[0],L=v.translate[1],v=v.scale[0]):(F=v.extent.xmin,L=v.extent.ymax,v=v.tolerance);E&&"upperLeft"===E.originPosition?(N=E.translate[0],I=E.translate[1],E=E.scale[0]):(N=E.extent.xmin,I=E.extent.ymax,E=E.tolerance);return F===
N&&L===I&&v===E};a.getQuantizedBoundsCoordsArray=c;a.getQuantizedBoundsCoordsArrayArray=d;a.getQuantizedBoundsPaths=function(v){return d([0,0,0,0],v)};a.getQuantizedBoundsPoints=function(v){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return c(E,E,v)};a.getQuantizedBoundsRings=function(v){return d([0,0,0,0],v)};a.quantizeBounds=function(v,E,F){E[0]=f(v,F[0]);E[3]=p(v,F[1]);E[2]=f(v,F[2]);E[1]=p(v,F[3]);return E};a.quantizeExtent=g;a.quantizeGeometry=
function(v,E){return v&&E?u.isPoint(E)?q(v,{},E,!1,!1):u.isPolyline(E)?x(v,{},E,!1,!1):u.isPolygon(E)?y(v,{},E,!1,!1):u.isMultipoint(E)?A(v,{},E,!1,!1):u.isExtent(E)?g(v,{},E,!1,!1):null:null};a.quantizeMultipoint=A;a.quantizePaths=n;a.quantizePoint=q;a.quantizePoints=w;a.quantizePolygon=y;a.quantizePolyline=x;a.quantizeRings=e;a.quantizeX=f;a.quantizeY=p;a.toQuantizationTransform=function(v){return v?{originPosition:"upper-left"===v.originPosition?"upperLeft":"lower-left"===v.originPosition?"lowerLeft":
v.originPosition,scale:v.tolerance?[v.tolerance,v.tolerance]:[1,1],translate:v.extent?[v.extent.xmin,v.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(v,E,F){return F?(E[0]=b(v,F[0]),E[1]=h(v,F[3]),E[2]=b(v,F[2]),E[3]=h(v,F[1]),E):[b(v,E[0]),h(v,E[3]),b(v,E[2]),h(v,E[1])]};a.unquantizeCoordsArray=k;a.unquantizeCoordsArrayArray=l;a.unquantizeExtent=function(v,E,F,L,N){E.xmin=b(v,F.xmin);E.ymin=h(v,F.ymin);E.xmax=b(v,F.xmax);E.ymax=h(v,F.ymax);E!==F&&(L&&(E.zmin=F.zmin,E.zmax=F.zmax),N&&(E.mmin=
F.mmin,E.mmax=F.mmax));return E};a.unquantizeMultipoint=function(v,E,F,L,N){E.points=m(v,F.points,L,N);return E};a.unquantizePaths=z;a.unquantizePoint=function(v,E,F,L,N){E.x=b(v,F.x);E.y=h(v,F.y);E!==F&&(L&&(E.z=F.z),N&&(E.m=F.m));return E};a.unquantizePoints=m;a.unquantizePolygon=function(v,E,F,L,N){E.rings=r(v,F.rings,L,N);return E};a.unquantizePolyline=function(v,E,F,L,N){E.paths=z(v,F.paths,L,N);return E};a.unquantizeRings=r;a.unquantizeX=b;a.unquantizeY=h;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe"],function(a,u,f){function p(h,k){if(h===k)return!0;if(null==h||null==k||h.length!==k.length)return!1;for(let l=0;l<h.length;l++){const m=h[l],z=k[l];if(m.length!==z.length)return!1;for(let r=0;r<m.length;r++)if(m[r]!==z[r])return!1}return!0}function t(h,k){if(h===k)return!0;if(null==h||null==k||h.length!==k.length)return!1;for(let l=0;l<h.length;l++)if(!p(h[l],k[l]))return!1;
return!0}function w(h,k){return e(h.spatialReference,k.spatialReference)?h.x===k.x&&h.y===k.y&&h.z===k.z&&h.m===k.m:!1}function e(h,k){return h===k||h&&k&&h.equals(k)}function n(h,k){if(h===k)return!0;if(f.isNone(h)||f.isNone(k)||h.type!==k.type)return!1;switch(h.type){case "point":return w(h,k);case "extent":return h=h.hasZ!==k.hasZ||h.hasM!==k.hasM?!1:e(h.spatialReference,k.spatialReference)?h.xmin===k.xmin&&h.ymin===k.ymin&&h.zmin===k.zmin&&h.xmax===k.xmax&&h.ymax===k.ymax&&h.zmax===k.zmax:!1,
h;case "polyline":return h=h.hasZ!==k.hasZ||h.hasM!==k.hasM?!1:e(h.spatialReference,k.spatialReference)?t(h.paths,k.paths):!1,h;case "polygon":return h=h.hasZ!==k.hasZ||h.hasM!==k.hasM?!1:e(h.spatialReference,k.spatialReference)?t(h.rings,k.rings):!1,h;case "multipoint":return h=h.hasZ!==k.hasZ||h.hasM!==k.hasM?!1:e(h.spatialReference,k.spatialReference)?p(h.points,k.points):!1,h;case "mesh":return!1}}function b(h,k){if(h===k)return!0;if(!h||!k)return!1;const l=Object.keys(h),m=Object.keys(k);if(l.length!==
m.length)return!1;for(const z of l)if(h[z]!==k[z])return!1;return!0}a.equals=function(h,k){return h===k?!0:null!=h&&null!=k&&h.objectId===k.objectId&&n(h.geometry,k.geometry)&&b(h.attributes,k.attributes)?!0:!1};a.pointEquals=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,u,f,p,t,w,e,n,b,h){function k(){k=f._asyncToGenerator(function*(c,d,g){if(!c||!c.symbol)return z;const A=c.where,q=b.getLabelExpression(c);c=A?yield new Promise(function(y,x){a(["../../core/sql/WhereClause"],y,x)}):null;if("arcade"===q.type){const y=yield h.createLabelExpression(q.expression,g,d);g={type:"arcade",evaluate(x){try{const D=y.evaluate({$feature:"attributes"in x?y.repurposeFeature(x):y.repurposeAdapter(x)});if(null!=D)return D.toString()}catch(D){m.error(new p("bad-arcade-expression",
"Encountered an error when evaluating label expression for feature",{feature:x,expression:q}))}return null},needsHydrationToEvaluate(){return null==b.getSingleFieldArcadeExpression(q.expression)}}}else g={type:"simple",evaluate(y){return q.expression.replace(/{[^}]*}/g,x=>{var D=x.slice(1,-1);D=d.get(D);if(!D)return x;x=null;"attributes"in y?y&&y.attributes&&(x=y.attributes[D.name]):x=y.field(D.name);return null==x?"":l(x,D)})}};if(A){let y;try{y=c.WhereClause.create(A,d)}catch(D){return z}const x=
g.evaluate;g.evaluate=D=>y.testFeature(D,"attributes"in D?void 0:r)?x(D):null}return g});return k.apply(this,arguments)}function l(c,d){if(null==c)return"";const g=d.domain;if(g)if("codedValue"===g.type||"coded-value"===g.type)for(var A of g.codedValues){if(A.code===c)return A.name}else if("range"===g.type){A=+c;const q="range"in g?g.range[1]:g.maxValue;if(("range"in g?g.range[0]:g.minValue)<=A&&A<=q)return g.name}"date"===d.type||"esriFieldTypeDate"===d.type?c=w.formatDate(c,w.convertDateFormatToIntlOptions("short-date")):
n.isNumericField(d)&&(c=e.formatNumber(+c));return c?c:""}const m=t.getLogger("esri.layers.support.labelFormatUtils"),z={type:"simple",evaluate(){return null}},r={getAttribute(c,d){return c.field(d)}};u.createLabelFunction=function(c,d,g){return k.apply(this,arguments)};u.formatField=l;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils",
"./Graphics3DLineCalloutSymbolLayer"],function(a,u,f,p){const t=u.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),w={line:p.Graphics3DLineCalloutSymbolLayer};a.make=function(e,n){if(!f.isCalloutSupport(e))return t.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const b=w[e.callout.type];return b?new b(e,n):(t.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),
null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){h=function(y){function x(C,B){C=y.call(this,C,null,B,q)||this;C._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};C.ensureDrapedStatus(!1);return C}u._inheritsLoose(x,y);var D=x.prototype;D.doLoad=function(){var C=u._asyncToGenerator(function*(){this._material=new c.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return C.apply(this,arguments)}}();D.destroy=function(){y.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};D.perInstanceMaterialParameters=function(C){const B=this.materialParameters;B.screenOffset=C.screenOffset||[0,0];B.centerOffsetUnits=C.centerOffsetUnits||"world";return B};D._defaultElevationInfoNoZ=function(){return A};D.createGraphics3DGraphic=function(C){const B=C.renderingInfo;C=C.graphic;const v=this.setGraphicElevationContext(C,new n.ElevationContext,B.elevationOffset||0);var E=B.symbol;const F="on-the-ground"===this._elevationContext.mode&&
("cim"===E.type||!E.symbolLayers.some(L=>"object"===L.type||"text"===L.type));if("label-3d"!==E.type&&F)return null;E=k.computeCentroid(C.geometry);return p.isNone(E)?null:this._createAs3DShape(E,v,B,C.uid)};D.layerOpacityChanged=function(){if(p.isNone(this._material))return!0;this._material.setParameterValues(this.materialParameters);return!0};D.layerElevationInfoChanged=function(C,B,v){v=e.elevationModeChangeUpdateType(x.elevationModeChangeTypes,v,this._elevationContext.mode);if(v!==e.SymbolUpdateType.UPDATE)return v;
C.forEach(E=>{const F=B(E);p.isSome(F)&&this.updateGraphicElevationContext(E.graphic,F)});return v};D.slicePlaneEnabledChanged=function(){if(p.isNone(this._material))return!0;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};D.physicalBasedRenderingChanged=function(){return!0};D.pixelRatioChanged=function(){return!0};D.setGraphicElevationContext=function(C,B,v=0){C=y.prototype.setGraphicElevationContext.call(this,C,B);C.addOffsetRenderUnits(v);return C};
D.updateGraphicElevationContext=function(C,B){this.setGraphicElevationContext(C,B.elevationContext,B.metadata.elevationOffset);B.needsElevationUpdates=e.needsElevationUpdates2D(B.elevationContext.mode)};D.updateGeometry=function(C,B){return!1};D.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:m.emptySymbolComplexity.memory}};D.createVertexData=function(C){const {translation:B,centerOffset:v}=C;return[["position",B?{size:3,
data:[B[0],B[1],B[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",v?{size:4,data:[v[0],v[1],v[2],v[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};D._getOrCreateMaterial=function(C){const B=this.perInstanceMaterialParameters(C),v=c.LineCalloutMaterial.uniqueMaterialIdentifier(B);if(p.isSome(this._material)&&v===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(C.materialCollection){let E=
C.materialCollection.get(v);p.isNone(E)&&(E=new c.LineCalloutMaterial(B),C.materialCollection.add(v,E));return{material:E,isUnique:!1}}return{material:new c.LineCalloutMaterial(B),isUnique:!0}};D._createAs3DShape=function(C,B,v,E){var F=[new z.Geometry(this.createVertexData(v),g,1)];const L=this._getOrCreateMaterial(v);E=l.createStageObjectForHUD(this._context,C,F,[L.material],null,null,B,this._context.layer.uid,E);if(null===E)return null;F=new b.Graphics3DObject3DGraphicLayer(this,E.object,F,L.isUnique?
[L.material]:null,null,w.perObjectElevationAligner,B);F.metadata={elevationOffset:v.elevationOffset||0};F.alignedSampledElevation=E.sampledElevation;F.needsElevationUpdates=e.needsElevationUpdates2D(B.mode);l.extendPointGraphicElevationContext(F,C,this._context.elevationProvider);return F};u._createClass(x,[{key:"materialParameters",get:function(){const C=this.symbol;var B=C.callout;const v=p.isSome(B.color)?f.toUnitRGBA(B.color):[0,0,0,0];v[3]*=this._getLayerOpacity();const E=t.pt2px(B.size||0);
let F=null;if(C.verticalOffset){const {screenLength:N,minWorldLength:I,maxWorldLength:G}=C.verticalOffset;F={screenLength:t.pt2px(N),minWorldLength:I||0,maxWorldLength:null!=G?G:Infinity}}B=p.isSome(B.border)&&p.isSome(B.border.color)?f.toUnitRGBA(B.border.color):null;const L="object"===C.symbolLayers.getItemAt(0).type;return{color:v,size:E,verticalOffset:F,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,
0],centerOffsetUnits:"world",borderColor:B,occlusionTest:!L,shaderPolygonOffset:L?0:void 0,depthHUDAlignStart:"label-3d"===C.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:r.materialParametersDefaults.renderOccluded}}}]);return x}(h.Graphics3DSymbolLayer);h.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.UPDATE,staysOnTheGround:e.SymbolUpdateType.UPDATE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const d=new Uint16Array([0]),g=[["position",d],["normal",d],["auxpos1",
d]],A={mode:"relative-to-ground",offset:0},q={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=h;a.default=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){const l=p.create(),m=w.create(),z=w.create(),r=w.create(),c=p.create(),d=w.create(),g={verticalDistanceToGround:0,sampledElevation:0};a.perLodInstanceElevationAligner=function(A,q,y,x){const D=A.graphics3DSymbolLayer.lodRenderer;if(u.isNone(D))return 0;const C=q.centerPointInElevationSR;let B=0,v=0;const E="absolute-height"!==q.mode;B=n.evaluateElevationAlignmentAtPoint(C,y,q,x,E?g:null);E&&(v=g.sampledElevation);q=D.instanceData;A=A.instanceIndex;q.getGlobalTransform(A,
c);y=t.set(d,c[12],c[13],c[14]);h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(m[0]=C.x,m[1]=C.y,m[2]=B,e.computeLinearTransformation(C.spatialReference,m,c,x.spatialReference)&&q.setGlobalTransform(A,c)):x.setAltitudeOfTransformation(B,c);x=.01/x.unitInMeters;(h.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(c[12]-y[0])>=x||Math.abs(c[13]-y[1])>=x||Math.abs(c[14]-y[2])>=x)&&q.setGlobalTransform(A,c);return v};a.perObjectElevationAligner=function(A,q,y,x){A=A.stageObject;const D=q.centerPointInElevationSR;
let C=0,B=0;if(A.metadata.usesVerticalDistanceToGround)C=n.evaluateElevationAlignmentAtPoint(D,y,q,x,g),b.updateVertexAttributeAuxpos1w(A,g.verticalDistanceToGround),B=g.sampledElevation;else{const v="absolute-height"!==q.mode;C=n.evaluateElevationAlignmentAtPoint(D,y,q,x,v?g:null);v&&(B=g.sampledElevation)}q=f.copy(l,A.transformation);y=t.set(d,q[12],q[13],q[14]);h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(m[0]=D.x,m[1]=D.y,m[2]=C,e.computeLinearTransformation(D.spatialReference,m,q,x.spatialReference)&&
(A.transformation=q)):x.setAltitudeOfTransformation(C,q);x=.01/x.unitInMeters;if(Math.abs(q[12]-y[0])>=x||Math.abs(q[13]-y[1])>=x||Math.abs(q[14]-y[2])>=x)A.transformation=q;return B};a.perVertexElevationAligner=function(A,q,y,x){A=A.stageObject;const D=y.spatialReference,C=A.geometryRecords,B=C.length,v="absolute-height"!==q.mode;let E=0;for(let K=0;K<B;K++){var F=C[K].geometry,L=C[K].getShaderTransformation();z[0]=L[12];z[1]=L[13];z[2]=L[14];F.invalidateBoundingInfo();var N=F.getMutableAttribute("position");
L=N.data;var I=F.vertexAttributes.get("mapPos").data;F=N.size;N=L.length/F;I=new k.SamplePosition(I,D);let H=0,J=!1,M=0;for(let O=0;O<N;O++){r[0]=L[H];r[1]=L[H+1];r[2]=L[H+2];var G=n.evaluateElevationAlignmentAtPoint(I,y,q,x,v?g:null);v&&(M+=g.sampledElevation);h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(L[H]=I.array[I.offset],L[H+1]=I.array[I.offset+1],L[H+2]=G,e.projectBuffer(L,D,H,L,x.spatialReference,H,1),L[H]-=z[0],L[H+1]-=z[1],L[H+2]-=z[2]):(m[0]=L[H]+z[0],m[1]=L[H+1]+z[1],m[2]=L[H+2]+z[2],
x.setAltitude(m,G),L[H]=m[0]-z[0],L[H+1]=m[1]-z[1],L[H+2]=m[2]-z[2]);if(h.TESTS_DISABLE_UPDATE_THRESHOLDS)J=!0;else if(G=.01/x.unitInMeters,Math.abs(r[0]-L[H])>=G||Math.abs(r[1]-L[H+1])>=G||Math.abs(r[2]-L[H+2])>=G)J=!0;H+=F;I.offset+=3}E+=M/N;J&&A.geometryVertexAttrsUpdated(K)}return E/B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,u,f,p,t,w,e,n,b,h){function k(c,d,g,A,q){const y=(n.isDehydratedPoint(c)?c.z:h.isSamplePosition(c)?c.array[c.offset+2]:c[2])||0;switch(g.mode){case "on-the-ground":return g=f.unwrapOr(h.getElevationAtPoint(d,c,"ground"),0),q&&(q.verticalDistanceToGround=0,q.sampledElevation=g),g;case "relative-to-ground":return c=f.unwrapOr(h.getElevationAtPoint(d,c,"ground"),0),g=g.geometryZWithOffset(y,A),q&&(q.verticalDistanceToGround=g,q.sampledElevation=c),g+c;case "relative-to-scene":return c=f.unwrapOr(h.getElevationAtPoint(d,
c,"scene"),0),g=g.geometryZWithOffset(y,A),q&&(q.verticalDistanceToGround=g,q.sampledElevation=c),g+c;case "absolute-height":return g=g.geometryZWithOffset(y,A),q&&(A=f.unwrapOr(h.getElevationAtPoint(d,c,"ground"),0),q.verticalDistanceToGround=g-A,q.sampledElevation=A),g;default:return u.neverReached(g.mode),0}}a.SymbolUpdateType=void 0;(function(c){c[c.NONE=0]="NONE";c[c.UPDATE=1]="UPDATE";c[c.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const l={"absolute-height":{applyElevationAlignmentBuffer:function(c,
d,g,A,q,y,x,D){y=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;d*=3;A*=3;for(x=0;x<q;++x){const C=c[d+1],B=c[d+2];g[A+0]=c[d+0];g[A+1]=C;g[A+2]=null==D?B+y:y;d+=3;A+=3}return 0},requiresAlignment:function(c){const d=c.featureExpressionInfoContext;return 0!==c.meterUnitOffset||null!=d}},"on-the-ground":{applyElevationAlignmentBuffer:function(c,d,g,A,q,y){let x=0;const D=y.spatialReference;d*=3;A*=3;for(let C=0;C<q;++C){const B=c[d+0],v=c[d+1],E=f.unwrapOr(y.getElevation(B,v,c[d+
2],D,"ground"),0);x+=E;g[A+0]=B;g[A+1]=v;g[A+2]=E;d+=3;A+=3}return x/q},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(c,d,g,A,q,y,x,D){let C=0;x=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;const B=y.spatialReference;d*=3;A*=3;for(let v=0;v<q;++v){const E=c[d+0],F=c[d+1],L=c[d+2],N=f.unwrapOr(y.getElevation(E,F,L,B,"ground"),0);C+=N;g[A+0]=E;g[A+1]=F;g[A+2]=null==D?L+N+x:N+x;d+=3;A+=3}return C/q},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(c,
d,g,A,q,y,x,D){let C=0;x=D.calculateOffsetRenderUnits(x);D=D.featureExpressionInfoContext;const B=y.spatialReference;d*=3;A*=3;for(let v=0;v<q;++v){const E=c[d+0],F=c[d+1],L=c[d+2],N=f.unwrapOr(y.getElevation(E,F,L,B,"scene"),0);C+=N;g[A+0]=E;g[A+1]=F;g[A+2]=null==D?L+N+x:N+x;d+=3;A+=3}return C/q},requiresAlignment:()=>!0}},m=t.create(),z={verticalDistanceToGround:0,sampledElevation:0},r=w.create();a.applyElevationAlignmentForHUD=function(c,d,g,A,q){g=k(d,g,q,A,z);b.updateVertexAttributeAuxpos1w(c,
z.verticalDistanceToGround);q=z.sampledElevation;const y=p.copy(m,c.transformation);r[0]=d.x;r[1]=d.y;r[2]=g;e.computeLinearTransformation(d.spatialReference,r,y,A.spatialReference)?c.transformation=y:console.warn("Could not locate symbol object properly, it might be misplaced");return q};a.applyPerVertexElevationAlignment=function(c,d,g,A,q,y,x,D,C,B,v){const E=l[v.mode];let F=0;if(e.projectBuffer(c,d,g,A,C.spatialReference,q,D)&&(E.requiresAlignment(v)?(F=E.applyElevationAlignmentBuffer(A,q,y,x,
D,C,B,v),c=y,q=x):c=A,e.projectBuffer(c,C.spatialReference,q,y,B.spatialReference,x,D)))return F};a.elevationModeChangeUpdateType=function(c,d,g){return null==d||null==g?c.definedChanged:"on-the-ground"===d&&"on-the-ground"===g?c.staysOnTheGround:d===g||"on-the-ground"!==d&&"on-the-ground"!==g?a.SymbolUpdateType.UPDATE:c.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=k;a.needsElevationUpdates2D=function(c){return"relative-to-ground"===c||"relative-to-scene"===c};a.needsElevationUpdates3D=
function(c){return"absolute-height"!==c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){function d(q){var y=q.paths[0];if(!y||0===y.length)return null;y=z.getPointOnPath(y,z.getPathLength(y)/2);return r.makeDehydratedPoint(y[0],y[1],y[2],q.spatialReference)}function g(q,y,x){x=x?q:c.clonePoint(q);return y&&q?h.projectPoint(q,x,y)?x:null:x}function A(q){if(Array.isArray(q)){for(const y of q)if(!A(y))return!1;return!0}return null==q||0<=q}w={"bottom-left":w.fromValues(0,0),bottom:w.fromValues(.5,0),"bottom-right":w.fromValues(1,0),left:w.fromValues(0,
.5),center:w.fromValues(.5,.5),right:w.fromValues(1,.5),"top-left":w.fromValues(0,1),top:w.fromValues(.5,1),"top-right":w.fromValues(1,1)};a.computeCentroid=function(q,y){if("point"===q.type)return g(q,y,!1);if(c.isHydratedGeometry(q))switch(q.type){case "extent":return g(q.center,y,!1);case "polygon":return g(q.centroid,y,!1);case "polyline":return g(d(q),y,!0);case "mesh":return g(q.origin,y,!1)}else switch(q.type){case "extent":var x=u.isFinite(q.zmin);q=r.makeDehydratedPoint(.5*(q.xmax+q.xmin),
.5*(q.ymax+q.ymin),x?.5*(q.zmax+q.zmin):void 0,q.spatialReference);return g(q,y,!0);case "polygon":return(x=q.rings[0])&&0!==x.length?(x=m.ringsCentroid(q.rings,q.hasZ),q=r.makeDehydratedPoint(x[0],x[1],x[2],q.spatialReference)):q=null,g(q,y,!0);case "polyline":return g(d(q),y,!0)}};a.computeObjectRotation=function(q,y,x,D=t.create()){q=q||0;y=y||0;x=x||0;0!==q&&p.rotateZ(D,D,-q/180*Math.PI);0!==y&&p.rotateX(D,D,y/180*Math.PI);0!==x&&p.rotateY(D,D,x/180*Math.PI);return D};a.computeObjectScale=function(q=
e.ONES,y,x,D=1){const C=Array(3);if(f.isNone(y)||f.isNone(x))C[0]=1,C[1]=1,C[2]=1;else{let v=0;for(let E=2;0<=E;E--){const F=q[E];let L;const N=null!=F,I=0===E&&!B&&!N,G=x[E];"symbol-value"===F||I?L=0!==G?y[E]/G:1:N&&"proportional"!==F&&isFinite(F)&&(L=0!==G?F/G:1);if(null!=L){var B=C[E]=L;v=Math.max(v,Math.abs(L))}}for(q=2;0<=q;q--)null==C[q]?C[q]=B:0===C[q]&&(C[q]=.001*v)}for(B=2;0<=B;B--)C[B]/=D;return e.fromArray(C)};a.demResolutionForBoundingBox=function(q,y){return null!=y.minDemResolution?
y.minDemResolution:k.isPoint(q)?y.minDemResolutionForPoints:.01*k.maximumDimension(q)};a.enlargeExtent=function(q,y,x,D=0){if(q){y||(y=l.create());let C=.5*q.width*(x-1);x=.5*q.height*(x-1);q.width<1E-7*q.height?C+=x/20:q.height<1E-7*q.width&&(x+=C/20);n.set(y,q.xmin-C-D,q.ymin-x-D,q.xmax+C+D,q.ymax+x+D);return y}return null};a.isValidSize=A;a.mixinColorAndOpacity=function(q,y){const x=b.clone(b.ONES);f.isSome(q)&&(x[0]=q[0],x[1]=q[1],x[2]=q[2]);f.isSome(y)?x[3]=y:f.isSome(q)&&3<q.length&&(x[3]=q[3]);
return x};a.namedAnchorToHUDMaterialAnchorPos=w;a.overrideColor=function(q,y,x,D,C,B=[0,0,0,0]){for(let v=0;3>v;++v)f.isSome(q)&&null!=q[v]?B[v]=q[v]:f.isSome(x)&&null!=x[v]?B[v]=x[v]:B[v]=C[v];f.isSome(y)?B[3]=y:f.isSome(D)?B[3]=D:B[3]=C[3];return B};a.updateVertexAttributeAuxpos1w=function(q,y){for(let x=0;x<q.geometries.length;++x){const D=q.geometries[x].getMutableAttribute("auxpos1");D&&D.data[3]!==y&&(D.data[3]=y,q.geometryVertexAttrsUpdated(x))}};a.validateSymbolLayerSize=function(q){null!=
q.isPrimitive&&(q=[q.width,q.depth,q.height]);return A(q)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,u,f,p,t){let w=function(){function e(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";
this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var n=e.prototype;n.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};n.addOffsetRenderUnits=function(b){this._renderUnitOffset+=b};n.geometryZWithOffset=function(b,h){h=this.calculateOffsetRenderUnits(h);return null!=this.featureExpressionInfoContext?h:b+h};n.calculateOffsetRenderUnits=function(b){let h=
this._meterUnitOffset;const k=this.featureExpressionInfoContext;null!=k&&(h+=t.execute(k)*this._metersPerElevationInfoUnit);return h/b.unitInMeters+this._renderUnitOffset};n.setFromElevationInfo=function(b){this.mode=b.mode;this.unit=p.supportsUnit(b.unit)?b.unit:"meters";this.offsetElevationInfoUnits=f.unwrapOr(b.offset,0)};n.updateFeatureExpressionInfoContext=function(b,h,k){if(f.isNone(b))this._featureExpressionInfoContext=null;else{var l=b&&b.arcade;l&&f.isSome(h)&&f.isSome(k)?(this._featureExpressionInfoContext=
t.clone(b),t.setContextFeature(this._featureExpressionInfoContext,t.createFeature(l.modules,h,k))):this._featureExpressionInfoContext=b}};e.fromElevationInfo=function(b){const h=new e;f.isSome(b)&&h.setFromElevationInfo(b);return h};u._createClass(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(b){this._unit=b;this._metersPerElevationInfoUnit=
p.getMetersPerUnit(b)}},{key:"offsetMeters",set:function(b){this._meterUnitOffset=b;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(b){this._meterUnitOffset=b*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return e}();a.ElevationContext=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures",
"../../../../support/arcadeOnDemand"],function(a,u,f,p,t){function w(){w=u._asyncToGenerator(function*(n,b,h){n=n&&n.expression;if("string"!==typeof n)return null;var k="0"===n?0:null;if(null!=k)return{cachedResult:k};k=yield t.loadArcade();const l=k.arcadeUtils;n=l.createSyntaxTree(n);return l.dependsOnView(n)?(null!=h&&h.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:l.createFunction(n),context:l.createExecContext(null,{sr:b}),modules:k}}});
return w.apply(this,arguments)}const e=f.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(n){return{cachedResult:n.cachedResult,arcade:n.arcade?{func:n.arcade.func,context:n.arcade.modules.arcadeUtils.createExecContext(null,{sr:n.arcade.context.spatialReference}),modules:n.arcade.modules}:null}};a.createContext=function(n,b,h){return w.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(n){n=n&&n.expression;return"string"===typeof n&&(n="0"===
n?0:null,null!=n)?{cachedResult:n}:null};a.createFeature=function(n,b,h){return n.arcadeUtils.createFeature(b.attributes,b.geometry,h)};a.execute=function(n){if(null!=n){if(null!=n.cachedResult)return n.cachedResult;var b=n.arcade;b=n.arcade.modules.arcadeUtils.executeFunction(b.func,b.context);"number"!==typeof b&&(b=n.cachedResult=0);return b}return 0};a.extractExpressionInfo=function(n,b=!1){const h=(n=n&&n.featureExpressionInfo)&&n.expression;b||"0"===h||(n=null);return n};a.setContextFeature=
function(n,b){null!=n&&null==n.cachedResult&&(b&&n.arcade?(b._geometry&&(b._geometry=p.hydrateGeometry(b._geometry)),n.arcade.modules.arcadeUtils.updateExecContext(n.arcade.context,b)):e.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils".split(" "),
function(a,u,f,p,t,w,e,n,b){function h(c){return c.isVisible?c.params.transparent?1:2:0}let k=function(){function c(g,A,q,y,x,D,C,B=null){this.graphics3DSymbolLayer=g;this.stageObject=A;this._uniqueGeometries=q;this._uniqueMaterials=y;this._uniqueTextures=x;this.elevationAligner=D;this.elevationContext=C;this._edgeState=B;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=g;this.stageObject=A}var d=c.prototype;d.initialize=function(g,A){this.stageLayer=A;this.stage=g;g.addMany(this._uniqueMaterials);g.addMany(this._uniqueGeometries);g.addMany(this._uniqueTextures);g.add(this.stageObject)};d.destroy=function(){var g=this.stage;this.stageLayer&&(g.removeMany(this._uniqueMaterials),g.removeMany(this._uniqueGeometries),g.removeMany(this._uniqueTextures));g.remove(this.stageObject);this._addedToStage&&(this.stageLayer.remove(this.stageObject),
this._addedToStage=!1);g=this.stage.renderView.ensureEdgeView();g.hasObject(this.stageObject)&&g.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};d.layerOpacityChanged=function(g,A){if(!f.isNone(this._edgeState)){var q=h(this._edgeState.baseMaterial),y=!1;for(const x of this._edgeState.edgeMaterials)x.objectTransparency!==q&&(x.objectTransparency=q,y=!0);y&&this.resetEdgeObject(A);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[g])}};d.slicePlaneEnabledChanged=function(g,A){f.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:g},!A),this._edgeState.properties.slicePlaneEnabled=g)};d.setVisibility=function(g){if(null!=this.stage&&this._visible!==g&&((this._visible=g)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),f.isSome(this._edgeState))){const A=
this.stage.renderView.ensureEdgeView();A.hasObject(this.stageObject)?A.updateObjectVisibility(this.stageObject,g):g&&this.addOrUpdateEdgeObject(A,!1)}};d.alignWithElevation=function(g,A,q,y){null!=this.elevationAligner&&(f.isSome(q)&&n.setContextFeature(this.elevationContext.featureExpressionInfoContext,q),g=this.elevationAligner(this,this.elevationContext,g,A),null!=g&&(this.alignedSampledElevation=g),this.resetEdgeObject(y))};d.getCenterObjectSpace=function(g=t.create()){return p.copy(g,e.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};
d.getBoundingBoxObjectSpace=function(g=w.create()){const A=this.stageObject.boundingVolumeObjectSpace;w.setMin(g,A.min);w.setMax(g,A.max);return g};d.computeAttachmentOrigin=function(g){if(this.useObjectOriginAsAttachmentOrigin){var A=this.stageObject.transformation;g.render.origin[0]+=A[12];g.render.origin[1]+=A[13];g.render.origin[2]+=A[14];g.render.num++}else for(A of this.stageObject.geometryRecords)A.computeAttachmentOrigin(z)&&(p.transformMat4(z,z,this.stageObject.transformation),p.add(g.render.origin,
g.render.origin,z),g.render.num++)};d.getProjectedBoundingBox=function(){var g=u._asyncToGenerator(function*(A,q,y,x,D){D=this.getBoundingBoxObjectSpace(D);var C=r,B=w.isPoint(D)?1:C.length;for(var v=0;v<B;v++){const E=C[v];m[0]=D[E[0]];m[1]=D[E[1]];m[2]=D[E[2]];p.transformMat4(m,m,this.stageObject.transformation);l[3*v]=m[0];l[3*v+1]=m[1];l[3*v+2]=m[2]}if(!A(l,0,B))return null;w.empty(D);A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());for(C=0;C<3*B;C+=3){for(v=
0;3>v;v++)D[v]=Math.min(D[v],l[C+v]),D[v+3]=Math.max(D[v+3],l[C+v]);A&&y.push({location:l.slice(C,C+3),screenSpaceBoundingRect:A})}if(q&&q.service&&"absolute-height"!==this.elevationContext.mode){w.center(D,z);y="relative-to-scene"===this.elevationContext.mode?"scene":"ground";B=0;if(q.useViewElevation)B=f.unwrapOr(q.service.getElevation(z[0],z[1],y),0);else try{const E=b.demResolutionForBoundingBox(D,q);B=f.unwrapOr(yield q.service.queryElevation(z[0],z[1],x,E,y),0)}catch(E){}w.offset(D,0,0,-this.alignedSampledElevation+
B)}return D});return function(A,q,y,x,D){return g.apply(this,arguments)}}();d.addObjectState=function(g,A){0===g&&A.addObject(this.stageObject,this.stageObject.highlight());1===g&&A.addObject(this.stageObject,this.stageObject.maskOccludee())};d.removeObjectState=function(g){g.removeObject(this.stageObject)};d.resetEdgeObject=function(g){if(!f.isNone(this._edgeState)){var A=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(A,g):A.removeObject(this.stageObject)}};d.addOrUpdateEdgeObject=
function(g,A){const q=this._edgeState;if(!f.isNone(q)){var y=h(q.baseMaterial);for(const x of q.edgeMaterials)x.objectTransparency=y;g.addOrUpdateObject3D(this.stageObject,q.edgeMaterials,q.properties,!A).then(()=>{var x;return null==(x=this.stageLayer)?void 0:x.sync()})}};u._createClass(c,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return c}();const l=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=t.create(),z=t.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=k;a.default=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){function c(y,x){y=null!=y?x.attributes[y]:0;return null!=y&&isFinite(y)?y:0}const d=t.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");p=function(y){function x(C,B,v,E){var F=y.call(this,v.schedule)||this;F._context=v;F._elevationInfoOverride=null;F.complexity=null;F.logger=d;F._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};F.symbol=C;F.symbolLayer=B;F._renderPriority=E.renderPriority;F._renderPriorityStep=E.renderPriorityStep;
F._elevationContext=new k.ElevationContext;F.complexity=F.computeComplexity();F._updateDrivenProperties(E.ignoreDrivers);F._updateElevationContext();return F}u._inheritsLoose(x,y);var D=x.prototype;D.getCachedSize=function(){return null};D._logGeometryCreationWarnings=function(C,B,v,E){const F="polygons"in C?C.polygons:null;E=`${E} geometry failed to be created`;let L=null;C.projectionSuccess?!B.length||1===B.length&&!B[0].length?L=`${E} (no ${v} were defined)`:Array.isArray(B)&&Array.isArray(B[0])?
F&&0===F.length&&"rings"===v&&0<B.length&&2<B[0].length&&(L=`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):L=`${E} (${v} should be defined as a 2D array)`:L=`${E} (failed to project geometry to view spatial reference)`;L&&d.warnOncePerTick(L)};D._validateGeometry=function(C,B=null,v=null){return e.isSome(B)&&!B.includes(C.type)?(this.logger.warn("unsupported geometry type for "+v+` symbol: ${C.type}`),!1):"point"!==C.type||w.isFinite(C.x)&&w.isFinite(C.y)?
!0:(d.warn("point coordinate is not a valid number, graphic skipped"),!1)};D._defaultElevationInfoNoZ=function(){return g};D._defaultElevationInfoZ=function(){return A};D._updateElevationContext=function(){e.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};D.getDefaultElevationInfo=function(C){return C.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};D.getGeometryElevationMode=function(C,B=this.getDefaultElevationInfo(C)){return this._elevationContext.mode||B.mode};D.setElevationInfoOverride=function(C){this._elevationInfoOverride=C;this._updateElevationContext()};D.setGraphicElevationContext=function(C,B){var v=e.unwrap(C.geometry);const E=this.getDefaultElevationInfo(v);B.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:E.unit;B.mode=this.getGeometryElevationMode(v,E);B.offsetMeters=e.unwrapOr(this._elevationContext.meterUnitOffset,e.unwrapOr(E.offset,0));if(v=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===B.mode)B.mode="relative-to-ground",B.offsetMeters=0;B.updateFeatureExpressionInfoContext(v?l.zeroContext:this._elevationContext.featureExpressionInfoContext,C,this._context.layer);return B};D.prepareSymbolLayerPatch=function(C){};D.updateGeometry=function(C,B){return!1};
D.onRemoveGraphic=function(C){};D._updateDrivenProperties=function(C){const B={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};C||(C=this._context.renderer)&&"visualVariables"in C&&C.visualVariables&&C.visualVariables.forEach(v=>{switch(v.type){case "color":B.color=!0;if(v.stops)for(let E=0;E<v.stops.length;E++){const F=v.stops[E].color;F&&(B.opacity=!0,1>F.a&&(B.opacityAlwaysOpaque=!1))}break;case "opacity":B.opacity=!0;B.opacityAlwaysOpaque=!1;break;case "size":B.size=!0}});this._drivenProperties=
B};D._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const C=this._context.layer.opacity;return null==C?1:C};D._getCombinedOpacity=function(C,B=q){let v=1;this.draped||(v*=this._getLayerOpacity());if(this._drivenProperties.opacity)return v;e.isSome(C)?v*=C.a:B.hasIntrinsicColor||(v=0);return v};D._getCombinedOpacityAndColor=function(C,B=q){B=this._getCombinedOpacity(C,B);if(this._drivenProperties.color)return m.mixinColorAndOpacity(null,
B);C=e.isSome(C)?f.toUnitRGB(C):n.ONES;return m.mixinColorAndOpacity(C,B)};D._getVertexOpacityAndColor=function(C,B=null){C=m.mixinColorAndOpacity(this._drivenProperties.color?C.color:null,this._drivenProperties.opacity?C.opacity:null);e.isSome(B)&&(C[0]*=B,C[1]*=B,C[2]*=B,C[3]*=B);return C};D.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};D.computeComplexity=function(){return r.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};D.destroy=function(){this.abortLoad()};
D.globalPropertyChanged=function(C,B,v){switch(C){case "opacity":return this.layerOpacityChanged(B,v);case "elevationInfo":return C=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(B,v,C)===h.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(B,v);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};D.updateGraphics3DGraphicElevationInfo=
function(C,B,v){let E=h.SymbolUpdateType.UPDATE;C.forEach(F=>{const L=B(F);e.isSome(L)?(this.setGraphicElevationContext(F.graphic,L.elevationContext),L.needsElevationUpdates=v(L.elevationContext.mode)):E=h.SymbolUpdateType.RECREATE});return E};D.applyRendererDiff=function(C,B){return!1};D.getFastUpdateAttrValues=function(C){if(!this._fastUpdates.enabled)return null;const B=this._fastUpdates.visualVariables,v=B.size?c(B.size.field,C):0,E=B.color?c(B.color.field,C):0;C=B.opacity?c(B.opacity.field,C):
0;return b.fromValues(v,E,C,0)};D.ensureDrapedStatus=function(C){if(null==this._draped)return this._draped=C,!0;C!==this.draped&&d.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};u._createClass(x,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},
{key:"draped",get:function(){return this._draped}}]);return x}(z.Loadable);const g={mode:"on-the-ground",offset:0,unit:"meters"},A={mode:"absolute-height",offset:0,unit:"meters"},q={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=p;a.default=p;a.getAttributeValue=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,u,f){let p=function(){function t(e){this.schedule=
e;this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}var w=t.prototype;w.load=function(e,n){if(1===this._loadStatus)return e&&e(),this._loader;if(2===this._loadStatus)return n&&n(this._loadError),this._loader;this._loader||(this._abortController=f.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=1},b=>{this._loadError=b;this._abortController=null;this._loadStatus=2;!f.isAbortError(b)&&
this.logger&&b.message&&this.logger.warn(b.message);throw b;}));this._loader.then(e,n).catch(()=>{});return this._loader};w.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};u._createClass(t,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return t}();a.Loadable=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,u,f,p,t,w,e){function n(r){let c=0,d=0,g=0,A=!1,q=0;const y={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const x of r)f.isNone(x)||(c+=x.primitivesPerFeature,d+=x.primitivesPerCoordinate,g+=x.drawCallsPerFeature,y.bytesPerFeature+=x.memory.bytesPerFeature,y.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,y.bytesPerCoordinate+=x.memory.bytesPerCoordinate,y.draped.bytesPerFeature+=x.memory.bytesPerFeature,
y.draped.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,y.draped.bytesPerCoordinate+=x.memory.bytesPerCoordinate,A=A||x.estimated,++q);return{primitivesPerFeature:c,primitivesPerCoordinate:d,drawCallsPerFeature:g,estimated:A,memory:y,numComplexities:q}}function b(r,c){const d=h(r,c);var g=w.hasEdges(c)?2:0;switch(c.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:g,estimated:!1,memory:d};case "fill":return"mesh-3d"===r.type?{primitivesPerFeature:0,
primitivesPerCoordinate:0,drawCallsPerFeature:g,estimated:!1,memory:d}:f.isSome(c.outline)&&0<c.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:d}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:d};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:d};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,
estimated:!1,memory:d};case "object":return c.resource&&c.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:d}:{...k(c.resource&&c.resource.primitive||p.defaultPrimitive),memory:d};case "path":{var A=r=0;switch(c.profile){case "circle":r=10;break;case "quad":r=4;break;default:u.neverReached(c.profile);return}switch(c.join){case "round":A=3;break;case "miter":case "bevel":A=1;break;default:u.neverReached(c.join);return}g=2*r;A=r*A*2;let q=-2*
A-g;switch(c.cap){case "none":break;case "butt":case "square":q+=2*(r-1);break;case "round":q+=2*(4*r+r);break;default:return}return{primitivesPerFeature:q,primitivesPerCoordinate:A+g,drawCallsPerFeature:0,estimated:!1,memory:d}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:d}}}function h(r,c){r="point-3d"===r.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?z.EXTRUDE_EDGES:z.EXTRUDE;case "fill":return f.isSome(c.outline)&&
0<c.outline.size?z.FILL_OUTLINE:z.FILL;case "water":return z.FILL;case "line":return"round"===c.join?z.LINE_ROUND:z.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return z.PATH_ROUND_CIRCLE;case "quad":return z.PATH_ROUND_QUAD;default:u.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return z.PATH_MITER_CIRCLE;case "quad":return z.PATH_MITER_QUAD;default:u.neverReached(c.profile);return}default:u.neverReached(c.join);return}case "object":return r?
z.OBJECT_POINT:z.OBJECT_POLYGON;case "icon":case "text":return r?z.ICON_POINT:z.ICON_POLYGON}}function k(r){var c=m[r];if(c)return c;c=t.primitiveLodResources(r,null);c={primitivesPerFeature:e.geometriesFromLodLevelResources(c.levels[0]).reduce((d,g)=>d+g.indices.get("position").length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return m[r]=c}const l={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,
bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},m={},z={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,
bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,
bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,
bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,
draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,
bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,
bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(r){r=n(r);0<r.numComplexities&&(r.primitivesPerFeature/=r.numComplexities,r.primitivesPerCoordinate/=r.numComplexities,r.drawCallsPerFeature/=r.numComplexities,r.memory.bytesPerFeature/=
r.numComplexities,r.memory.bytesPerFeatureLabel/=r.numComplexities,r.memory.bytesPerCoordinate/=r.numComplexities,r.memory.draped.bytesPerFeature/=r.numComplexities,r.memory.draped.bytesPerFeatureLabel/=r.numComplexities,r.memory.draped.bytesPerCoordinate/=r.numComplexities);return r};a.defaultSymbolComplexity=function(r){if("web-style"===r.type)return l;const c=r.symbolLayers.toArray().map(d=>b(r,d));return n(c)};a.defaultSymbolLayerComplexity=b;a.defaultSymbolLayerMemoryComplexity=h;a.emptySymbolComplexity=
l;a.memoryEstimators=z;a.totalSymbolComplexities=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],function(a,u,f){const p=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(t){switch(t){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
a.primitiveLodResources=function(t,w){const e=(n,b,h=!1)=>({levels:n.map(k=>{const l=b(k.tesselation);h&&f.cgToGIS(l);return{components:[{geometry:l,material:w}],faceCount:l.indexCount/3,minScreenSpaceRadius:k.minScreenSpaceRadius}})});switch(t){case "sphere":return e([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],n=>f.createPolySphereGeometry(.5,
n,!0));case "cube":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>f.createBoxGeometry(1));case "cone":return e(p,n=>f.createConeGeometry(1,.5,n,!1),!0);case "inverted-cone":return e(p,n=>f.createConeGeometry(1,.5,n,!0),!0);case "cylinder":return e(p,n=>f.createCylinderGeometry(1,.5,n,[0,0,1],[0,0,.5]));case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>f.createTetrahedronGeometry(1),!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>f.createDiamondGeometry(1),
!0)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils".split(" "),function(a,u,f,p,t,w,e){function n(l,m){if(p.isNone(l))return null;const z=p.isSome(l.color)?w.fromArray(u.toUnitRGBA(l.color)):w.fromValues(0,0,0,0),r=t.pt2px(l.size),c=t.pt2px(l.extensionLength);switch(l.type){case "solid":return b({color:z,
size:r,extensionLength:c,...m});case "sketch":return{...k,color:z,size:r,extensionLength:c,...m,type:"sketch"}}}function b(l){return{...h,...l,type:"solid"}}const h={color:w.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},k={color:w.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2};a.createMaterial=function(l,m){return n(l&&l.enabled&&l.edges||null,m)};a.createMaterialFromEdges=n;a.createSolidEdgeMaterial=b;a.hasEdges=function(l){return l&&
l.enabled&&(e.isExtrudeSymbol3DLayer(l)||e.isFillSymbol3DLayer(l))&&p.isSome(l.edges)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(u){return"extrude"===u.type};a.isFillSymbol3DLayer=function(u){return"fill"===u.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],
function(a,u){function f(p){const t=[];p.components.forEach(w=>{t.push(w.geometry)});return u.unique(t)}a.computeFaceCount=function(p){return f(p).reduce((t,w)=>t+w.indexCount/3,0)};a.geometriesFromLodLevelResources=f;a.geometriesFromLodResources=function(p){const t=[];p.levels.forEach(w=>{w.components.forEach(e=>{t.push(e.geometry)})});return u.unique(t)};a.materialsFromLodResources=function(p){const t=[];p.levels.forEach(w=>{w.components.forEach(e=>{t.push(e.material)})});return u.unique(t)};a.texturesFromLodResources=
function(p){const t=[];p.levels.forEach(w=>{w.components.forEach(e=>{e.textures&&t.push(...e.textures)})});return u.unique(t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){const l=p.create();a.createStageObjectForHUD=function(m,z,r,c,d,g,A,q,y,x){const D=r?r.length:0;var C=m.clippingExtent;t.projectPointToVector(z,l,m.elevationProvider.spatialReference);if(u.isSome(C)&&!w.containsPoint(C,l))return null;t.projectPointToVector(z,l,m.renderCoordsHelper.spatialReference);C=m.localOriginFactory.getOrigin(l);q=new k.Object3D({castShadow:!1,metadata:{layerUid:q,graphicUid:y,usesVerticalDistanceToGround:!0}});for(y=0;y<D;y++)q.addGeometry(r[y],
c[y],d?d[y]:f.IDENTITY,g,C,x);m=b.applyElevationAlignmentForHUD(q,z,m.elevationProvider,m.renderCoordsHelper,A);return{object:q,sampledElevation:m}};a.extendPointGraphicElevationContext=function(m,z,r){m=m.elevationContext;r=r.spatialReference;t.projectPointToVector(z,l,r);m.centerPointInElevationSR=n.makeDehydratedPoint(l[0],l[1],z.hasZ?l[2]:0,r)};a.geometryToRenderInfo=function(m,z,r,c,d){const g=new Float64Array(3*m.length),A=new Float64Array(g.length);m.forEach((q,y)=>{g[3*y]=q[0];g[3*y+1]=q[1];
g[3*y+2]=2<q.length?q[2]:0});z=b.applyPerVertexElevationAlignment(g,z,0,A,0,g,0,g.length/3,r,c,d);return{numVertices:m.length,position:g,mapPosition:A,projectionSuccess:null!=z,sampledElevation:z}};a.placePointOnGeometry=function(m){switch(m.type){case "point":return m;case "polygon":case "extent":return h.computeCentroid(m);case "polyline":var z=m.paths[0];if(!z||0===z.length)break;z=e.getPointOnPath(z,e.getPathLength(z)/2);return n.makeDehydratedPoint(z[0],z[1],z[2],m.spatialReference);case "mesh":return m.origin}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),function(a,u,f,p,t,w,e,n){let b=function(r){function c(g){g=r.call(this,g,k)||this;g.techniqueConfig=new n.LineCalloutTechniqueConfiguration;g._uniqueMaterialIdentifier=
c.uniqueMaterialIdentifier(g.params);return g}u._inheritsLoose(c,r);var d=c.prototype;d.dispose=function(){};d.getGLMaterial=function(g){return 0===g.output?new h(g):void 0};d.getPassParameters=function(){return this.params};d.getTechniqueConfig=function(g,A){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=
g;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.multipassGeometryEnabled=A?A.multipassGeometryEnabled:!1;return this.techniqueConfig};d.intersect=function(){};d.createBufferWriter=function(){return new z};d.validateParameterValues=function(g){g=c.uniqueMaterialIdentifier(g);g!==this._uniqueMaterialIdentifier&&
(this._uniqueMaterialIdentifier=g)};c.uniqueMaterialIdentifier=function(g){return JSON.stringify({screenOffset:g.screenOffset||[0,0],centerOffsetUnits:g.centerOffsetUnits||"world"})};u._createClass(c,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return c}(w.Material),h=function(r){function c(g){g=r.call(this,g)||this;g._isRenderSlot=!0;g.updateParameters();return g}u._inheritsLoose(c,r);var d=c.prototype;d.updateParameters=function(g){this._technique=this._techniqueRep.releaseAndAcquire(n.LineCalloutTechnique,
this._material.getTechniqueConfig(!1,g),this._technique);this._depthTechnique=this._techniqueRep.releaseAndAcquire(n.LineCalloutTechnique,this._material.getTechniqueConfig(!0,g),this._depthTechnique)};d.beginSlot=function(g){switch(g){case 20:return this._isRenderSlot=!0;case 21:return this._isRenderSlot=!1,!0}return!1};d.ensureParameters=function(g){this.updateParameters(g)};d.bind=function(g){this.technique.bindPass(this._material.getPassParameters(),g)};u._createClass(c,[{key:"technique",get:function(){return this._isRenderSlot?
this._technique:this._depthTechnique}}]);return c}(t);const k={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...w.materialParametersDefaults},l=p.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),m=[f.fromValues(0,0),f.fromValues(1,0),f.fromValues(0,1),f.fromValues(1,0),f.fromValues(1,1),f.fromValues(0,
1)];let z=function(){function r(){this.vertexBufferLayout=l}var c=r.prototype;c.allocate=function(d){return this.vertexBufferLayout.createBuffer(d)};c.elementCount=function(d){return 6*d.indices.get("position").length};c.write=function(d,g,A,q){e.writePosition(g.indices.get("position"),g.vertexAttributes.get("position").data,d.transformation,A.position,q,6);e.writeNormal(g.indices.get("normal"),g.vertexAttributes.get("normal").data,d.invTranspTransformation,A.normal,q,6);e.writeBufferVec4(g.indices.get("auxpos1"),
g.vertexAttributes.get("auxpos1").data,A.auxpos1,q,6);for(d=0;d<m.length;++d)A.uv0.setVec(q+d,m[d])};return r}();a.LineCalloutMaterial=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function u(){return new Float32Array(2)}function f(r){const c=new Float32Array(2);c[0]=r[0];c[1]=r[1];return c}function p(r,c){const d=new Float32Array(2);d[0]=r;d[1]=c;return d}function t(r,c){return new Float32Array(r,c,2)}function w(){return u()}
function e(){return p(1,1)}function n(){return p(1,0)}function b(){return p(0,1)}const h=u(),k=e(),l=n(),m=b();var z=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,zeros:w,ones:e,unitX:n,unitY:b,ZEROS:h,ONES:k,UNIT_X:l,UNIT_Y:m});a.ONES=k;a.UNIT_X=l;a.UNIT_Y=m;a.ZEROS=h;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.ones=e;a.unitX=n;a.unitY=b;a.vec2f32=z;a.zeros=w})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../materials/internal/MaterialUtil ../../../../chunks/LineCallout.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){k=function(g){function A(){return g.apply(this,arguments)||this}f._inheritsLoose(A,g);var q=A.prototype;q.initializeProgram=function(y){var x=A.shader.get();const D=this.configuration;x=x.build({occlusionTestEnabled:D.occlusionTestEnabled,verticalOffsetEnabled:D.verticalOffset,screenSizePerspectiveEnabled:D.screenSizePerspective,depthHudEnabled:D.depthHudEnabled,depthHudAlignStartEnabled:D.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:D.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:D.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:y.viewingMode,isDraped:!1,multipassGeometryEnabled:D.multipassGeometryEnabled});return new z.Program(y.rctx,x,m.Default3D)};q.bindPass=function(y,x){b.bindProjectionMatrix(this.program,x.camera.projectionMatrix);c.LineCallout.bindUniforms(this.program,y,x.camera.pixelRatio||1);w.bindVerticalOffsetUniforms(this.program,y,x);e.bindHUDUniforms(this.program,x);this.program.setUniform2fv("cameraNearFar",
x.camera.nearFar);this.program.setUniform2fv("inverseViewport",x.inverseViewport);n.bindMultipassGeometryTexture(this.program,x);this.program.bindTexture(x.hudVisibilityTexture,"hudVisibilityTexture");this.program.setUniform1f("cameraGroundRelative",x.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",y.shaderPolygonOffset);b.bindViewport(this.program,x);this.program.setUniform1f("perDistancePixelRatio",Math.tan(x.camera.fovY/2)/(x.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",
x.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/x.camera.fullViewport[2],2/x.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(y.size)*(x.camera.pixelRatio||1));r.bindScreenSizePerspective(y.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};q.bindDraw=function(y){b.bindView(this.program,y);b.bindCameraPosition(this.program,y.origin,y.camera.viewInverseTransposeMatrix);t.bindSliceUniformsWithOrigin(this.program,this.configuration,
y);this.program.rebindTextures()};q.setPipelineState=function(y){y=y?519:513;return this.configuration.depthHudEnabled?d.makePipelineState({depthTest:{func:y},depthWrite:d.defaultDepthWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(1,770,771,771),depthTest:{func:y},colorWrite:d.defaultColorWriteParams})};q.initializePipeline=function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)};return A}(k.ShaderTechnique);k.shader=new h.ReloadableShaderModule(c.LineCalloutShader,
()=>new Promise(function(g,A){a(["./LineCallout.glsl"],g,A)}));h=function(g){function A(){var q=g.apply(this,arguments)||this;q.occlusionTestEnabled=!0;q.verticalOffset=!1;q.screenSizePerspective=!1;q.depthHudEnabled=!1;q.depthHudAlignStartEnabled=!1;q.screenCenterOffsetUnitsEnabled=0;q.slicePlaneEnabled=!1;q.multipassGeometryEnabled=!1;return q}f._inheritsLoose(A,g);return A}(l.ShaderTechniqueConfiguration);p.__decorate([l.parameter()],h.prototype,"occlusionTestEnabled",void 0);p.__decorate([l.parameter()],
h.prototype,"verticalOffset",void 0);p.__decorate([l.parameter()],h.prototype,"screenSizePerspective",void 0);p.__decorate([l.parameter()],h.prototype,"depthHudEnabled",void 0);p.__decorate([l.parameter()],h.prototype,"depthHudAlignStartEnabled",void 0);p.__decorate([l.parameter({count:2})],h.prototype,"screenCenterOffsetUnitsEnabled",void 0);p.__decorate([l.parameter()],h.prototype,"slicePlaneEnabled",void 0);p.__decorate([l.parameter()],h.prototype,"multipassGeometryEnabled",void 0);u.LineCalloutTechnique=
k;u.LineCalloutTechniqueConfiguration=h;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e){function n(k){const l=new e.ShaderBuilder;l.include(f.AlignPixel);l.include(p.HUD,k);l.include(u.Slice,k);l.attributes.add("uv0","vec2");l.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");l.varyings.add("coverageSampling","vec4");l.varyings.add("lineSizes","vec2");k.multipassGeometryEnabled&&l.varyings.add("depth","float");l.vertex.code.add(w.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${k.occlusionTestEnabled?w.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${k.screenSizePerspectiveEnabled?w.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${k.multipassGeometryEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${k.depthHudEnabled?k.depthHudAlignStartEnabled?w.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${k.screenSizePerspectiveEnabled?w.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);l.fragment.uniforms.add("color","vec4");l.fragment.uniforms.add("borderColor","vec4");k.multipassGeometryEnabled&&(l.fragment.include(t.multipassGeometryTest,k),l.fragment.uniforms.add("inverseViewport","vec2"));l.fragment.code.add(w.glsl`
    void main() {
      ${k.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${k.depthHudEnabled?w.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return l}function b(k,l,m){3===m.length?k.setUniform4f(l,m[0],m[1],m[2],1):k.setUniform4fv(l,m)}a.LineCallout=void 0;(function(k){k.bindUniforms=function(l,m,z){b(l,"color",m.color);l.setUniform1f("pixelRatio",z);l.setUniform2f("screenOffset",m.screenOffset[0]*z,m.screenOffset[1]*z);null!==m.borderColor?(b(l,"borderColor",m.borderColor),l.setUniform1f("borderSize",z)):(l.setUniform4f("borderColor",0,0,0,0),l.setUniform1f("borderSize",0))}})(a.LineCallout||(a.LineCallout={}));var h=Object.freeze({__proto__:null,
build:n,get LineCallout(){return a.LineCallout}});a.LineCalloutShader=h;a.build=n})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,u,f){this.graphic=a;this.renderingInfo=u;this.layer=f}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,u,f){a.getGraphics3DSymbol=function(p){return p instanceof f?p.graphics3DSymbol:p instanceof u?p:null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),function(a,u,f,p,t,w,e,n,b){const h={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(k){function l(z,r,c){var d=k.call(this,r.schedule)||
this;d._symbol=z;d._context=r;d._backgroundLayers=c;d._destroyed=!1;d.symbolLayers=[];d.referenced=0;d._extentPadding=0;return d}a._inheritsLoose(l,k);var m=l.prototype;m.doLoad=function(){var z=a._asyncToGenerator(function*(r){var c=this;let d=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(d=this._backgroundLayers.concat(d));const g=d.length;for(;this.symbolLayers.length<d.length;)this.symbolLayers.push(null);this.symbolLayers.length=d.length;const A=[];for(let q=0;q<g;q++){const y=
d.getItemAt(q);if(!1===y.enabled)continue;h.renderPriority=1-(1+q)/g;h.renderPriorityStep=1/g;h.ignoreDrivers=y._ignoreDrivers;const x=e.make(this.symbol,y,this._context,h);A.push(p.onAbortOrThrow(r,()=>{this.symbolLayers[q]=null;x.destroy()}));this.symbolLayers[q]=x}yield u.forEach(this.symbolLayers,function(){var q=a._asyncToGenerator(function*(y,x){if(f.isSome(y))try{yield y.load(),c._extentPadding+=Math.max(c._extentPadding,y.extentPadding)}catch{c.symbolLayers[x]=null}});return function(y,x){return q.apply(this,
arguments)}}());for(const q of A)null==q?void 0:q.remove();A.length=0;p.throwIfAborted(r);if(this.symbolLayers.length&&!this.symbolLayers.some(q=>!!q))throw Error();});return function(r){return z.apply(this,arguments)}}();m.getSymbolLayerSize=function(z){z=this.symbolLayers[z];return f.isSome(z)?z.getCachedSize():null};m.createGraphics3DGraphic=function(z,r){const c=z.graphic,d=Array(this.symbolLayers.length);for(let g=0;g<this.symbolLayers.length;g++){const A=this.symbolLayers[g];d[g]=f.isSome(A)?
A.createGraphics3DGraphic(z):null}return new t(c,r||this,d,z.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};m.globalPropertyChanged=function(z,r){const c=this.symbolLayers.length;for(let d=0;d<c;d++){const g=this.symbolLayers[d],A=q=>{q=q._graphics[d];return q instanceof w.Graphics3DObject3DGraphicLayer?q:null};if(f.isSome(g)&&!g.globalPropertyChanged(z,r,A))return!1}return!0};
m.applyRendererDiff=function(z,r){return 1!==this.loadStatus?!1:this.symbolLayers.reduce((c,d)=>c&&(f.isNone(d)||d.applyRendererDiff(z,r)),!0)};m.prepareSymbolPatch=function(z){if(2!==this.loadStatus&&"partial"===z.diff.type){var r=z.diff.diff;if(r.symbolLayers&&"partial"===r.symbolLayers.type){var c=r.symbolLayers.diff;this.symbolLayers.forEach((d,g)=>{if(!f.isNone(d)){var A=c[g];if(A){const q={diff:A,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};d.prepareSymbolLayerPatch(q);z.symbolStatePatches.push(...q.symbolLayerStatePatches);
q.graphics3DGraphicPatches.length&&z.graphics3DGraphicPatches.push((y,x)=>{const D=y._graphics[g];f.isSome(D)&&q.graphics3DGraphicPatches.forEach(C=>C(D,x))})}}})}}};m.updateGeometry=function(z,r){for(let c=0;c<this.symbolLayers.length;c++){const d=this.symbolLayers[c];if(f.isNone(d))continue;const g=z._graphics[c];if(f.isNone(g)||!d.updateGeometry(g,r))return!1}return!0};m.onRemoveGraphic=function(z){for(let r=0;r<this.symbolLayers.length;r++){const c=this.symbolLayers[r];if(f.isNone(c))continue;
const d=z._graphics[r];if(f.isSome(d))c.onRemoveGraphic(d)}};m.getFastUpdateStatus=function(){let z=0,r=0,c=0;this.symbolLayers.forEach(d=>{f.isNone(d)||(0===d.loadStatus?z++:d.isFastUpdatesEnabled()?c++:r++)});return{loading:z,slow:r,fast:c}};m.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(const z of this.symbolLayers)f.isSome(z)&&z.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(l,
[{key:"symbol",get:function(){return this._symbol},set:function(z){this._symbol=z;if(this.symbolLayers)for(let r=0;r<z.symbolLayers.length;r++){const c=this.symbolLayers[r];f.isNone(c)||(c.symbol=z,c.symbolLayer=z.symbolLayers.items[r])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return b.totalSymbolComplexities(this.symbolLayers.map(z=>f.get(z,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return l}(n.Loadable)})},
"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){const d=new t(Array,A=>l.set(A,l.ZERO),null,10,5),g=m.create();return function(){function A(y,x,D,C,B){this._labelGraphics=[];this._auxiliaryGraphics=[];var v=Array(2);for(let E=0;E<v.length;E++)v[E]=Array(4);this._visibilityFlags=v;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++x.referenced;this.graphics3DSymbol=x;this.graphic=y;this._graphics=D;this._featureExpressionFeature=
B?c.createFeature(B,y,C):null;for(const E of this._graphics)p.isSome(E)&&(this.isElevationSource=this.isElevationSource||E.isElevationSource)}var q=A.prototype;q.initialize=function(y,x,D){this._layer=x;this._stage=y;this.forEachSymbolLayerGraphic(C=>{C.initialize(y,x,D);C.setVisibility(this.isVisible())})};q.destroy=function(){this.forEachSymbolLayerGraphic(y=>y.destroy());this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};q.clearLabelGraphics=
function(){this.forEachLabelGraphic(y=>y.destroy());this._labelGraphics.length=0};q.addLabelGraphic=function(y,x,D){this._labelGraphics.push(y);y.initialize(x,D);y.setVisibility(this.isVisible(1))};q.addAuxiliaryGraphic=function(y){this._auxiliaryGraphics.push(y);this._layer&&(y.initialize(this._stage,this._layer),y.setVisibility(this.isVisible()))};q.isVisible=function(y=0,x){for(let D=0;D<=y;D++){const C=this._visibilityFlags[D];for(let B=0;B<C.length;++B)if(!1===C[B]&&B!==x)return!1}return!0};
q.hasVisibilityFlag=function(y,x){return null!=this._visibilityFlags[x][y]};q.setVisibilityFlag=function(y,x,D){const C=this.isVisible(D);this._visibilityFlags[D][y]=x;const B=this.isVisible(D);if(C===B)return!1;if(1===D)this.forEachLabelGraphic(v=>v.setVisibility(B));else{this.forEachSymbolLayerGraphic(E=>E.setVisibility(B));const v=this.isVisible(1);this.forEachLabelGraphic(E=>E.setVisibility(v))}return!0};q.clearVisibilityFlag=function(y,x=0){return this.setVisibilityFlag(y,void 0,x)};q.computeExtent=
function(y){if(!this._extent){var x=this.graphic.geometry;if(p.isNone(x))return!1;this._extent=m.create();z.computeAABR(x,this._extent);x=x.spatialReference;if(!x.equals(y)&&!k.projectBoundingRect(this._extent,x,this._extent,y))return this._extent=null,!1}return!0};q.getAsOptimizedGeometry=function(y,x){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===y&&this._optimizedGeometry.hasM===x)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,
y,x);this._optimizedGeometry.hasZ=y;this._optimizedGeometry.hasM=x;return this._optimizedGeometry.geometry};q._convertGraphicToOptimizedGeometry=function(y,x,D){y=y.geometry;if("mesh"===y.type||"extent"===y.type)y=h.fromExtent("mesh"===y.type?y.extent:y);return r.convertFromGeometry(y,x,D)};q.computeAttachmentOrigin=function(){const y={render:{origin:b.create(),num:0},draped:{origin:e.create(),num:0}};for(const x of this._graphics)p.isNone(x)||x.computeAttachmentOrigin(y);y.render.num&&n.scale(y.render.origin,
y.render.origin,1/y.render.num);y.draped.num&&w.scale(y.draped.origin,y.draped.origin,1/y.draped.num);return y};q.getProjectedBoundingBox=function(){var y=a._asyncToGenerator(function*(x,D,C,B,v){v||(v={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});v.boundingBox?l.empty(v.boundingBox):v.boundingBox=l.empty();v.requiresDrapedElevation=!1;yield u.forEach(this._graphics,function(){var E=a._asyncToGenerator(function*(F){if(!p.isNone(F)){var L="draped"===F.type?D:x,N=d.acquire();
F=yield F.getProjectedBoundingBox(L,C,v.screenSpaceObjects,B,N);isFinite(F[2])&&isFinite(F[5])||(v.requiresDrapedElevation=!0);F&&l.expandWithAABB(v.boundingBox,N);d.release(N)}});return function(F){return E.apply(this,arguments)}}());return l.allFinite(v.boundingBox)||m.allFinite(l.toRect(v.boundingBox,g))?v:null});return function(x,D,C,B,v){return y.apply(this,arguments)}}();q.needsElevationUpdates=function(){for(const y of this._graphics)if(p.isSome(y)&&("object3d"===y.type||"lod-instance"===y.type)&&
y.needsElevationUpdates)return!0;for(const y of this._labelGraphics)if(y&&y.needsElevationUpdates)return!0;return!1};q.alignWithElevation=function(y,x,D){this.forEachRenderedGraphic(C=>{"object3d"!==C.type&&"lod-instance"!==C.type||C.alignWithElevation(y,x,this._featureExpressionFeature,D)})};q.addObjectStateSet=function(y,x){this.forEachSymbolLayerGraphic(D=>D.addObjectState(y,x))};q.removeObjectState=function(y){this.forEachSymbolLayerGraphic(x=>x.removeObjectState(y))};q.forEachGraphicList=function(y,
x){y.forEach(D=>D&&x(D))};q.forEachSymbolLayerGraphic=function(y){this.forEachGraphicList(this._graphics,y);this.forEachGraphicList(this._auxiliaryGraphics,y)};q.forEachLabelGraphic=function(y){this.forEachGraphicList(this._labelGraphics,y)};q.forEachRenderedGraphic=function(y){this.forEachSymbolLayerGraphic(y);this.forEachLabelGraphic(y)};a._createClass(A,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==
this._graphics}},{key:"isDraped",get:function(){let y=!1;this.forEachSymbolLayerGraphic(x=>{"draped"===x.type&&(y=!0)});return y}},{key:"usedMemory",get:function(){let y=f.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(x=>{const D=x.graphics3DSymbolLayer.complexity;p.isNone(D)||(x="draped"===x.type?D.memory.draped:D.memory,y+=x.bytesPerFeature,x.bytesPerCoordinate&&(y+=z.numVertices(this.graphic.geometry)*x.bytesPerCoordinate))});return y}}]);return A}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){const l=u.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),m={icon:p.Graphics3DIconSymbolLayer,object:e.Graphics3DObjectSymbolLayer,line:t.Graphics3DLineSymbolLayer,path:n.Graphics3DPathSymbolLayer,fill:b.Graphics3DPolygonFillSymbolLayer,extrude:f.Graphics3DExtrudeSymbolLayer,text:h.Graphics3DTextSymbolLayer,water:k.Graphics3DWaterSymbolLayer},z={"mesh-3d":{fill:w.Graphics3DMeshFillSymbolLayer}};a.make=function(r,c,d,g){const A=z[r.type]&&z[r.type][c.type]||
m[c.type];return A?new A(r,c,d,g):(l.error("GraphicsLayerFactory#make",`unknown symbol type ${c.type}`),null)};a.setSymbolClass=function(r,c){m[r]=c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F){function L(ha,fa,R,U,Z,T,P,X,aa,ja,ia,ka,na,ta){let pa=0;var xa=2*U.count;{var Da=U.index,Ka=U.count,Fa=R.length/3,Ha=aa;h.copy(W,na);const ua=0<ka?1:-1;Da*=3;let Ba=Ha;na=3*Ba;let Ea=Ha+Ka;Ha=3*Ea;for(let Ga=0;Ga<Ka;++Ga)ta&&(W[0]=ha[Da+0],W[1]=ha[Da+1],W[2]=ha[Da+2],h.normalize(W,W)),Z[na+0]=ha[Da+0],Z[na+1]=ha[Da+1],Z[na+2]=ha[Da+2],T[na+0]=fa[Da+0],T[na+1]=fa[Da+1],T[na+2]=fa[Da+2],P[na+0]=-ua*W[0],P[na+1]=-ua*W[1],P[na+2]=-ua*
W[2],X[Ba]=0,Z[Ha+0]=ha[Da+0]+ka*W[0],Z[Ha+1]=ha[Da+1]+ka*W[1],Z[Ha+2]=ha[Da+2]+ka*W[2],T[Ha+0]=fa[Da+0],T[Ha+1]=fa[Da+1],T[Ha+2]=fa[Da+2],P[Ha+0]=ua*W[0],P[Ha+1]=ua*W[1],P[Ha+2]=ua*W[2],X[Ea]=ka,na+=3,Ha+=3,Da+=3,Ba+=1,Ea+=1;na=Da=0;Ha=3*xa;ha=0>ka?ca:ba;fa=0>ka?ba:ca;for(ta=0;ta<Fa;++ta)ia[na+0]=R[Da+ha[0]],ia[na+1]=R[Da+ha[1]],ia[na+2]=R[Da+ha[2]],ja[Ha+0]=R[Da+fa[0]]+Ka,ja[Ha+1]=R[Da+fa[1]]+Ka,ja[Ha+2]=R[Da+fa[2]]+Ka,na+=3,Ha+=3,Da+=3}aa+=2*U.count;xa=0;I(Z,T,X,P,pa,U.pathLengths[0],U.count,aa,
ja,xa,ka);aa+=4*U.pathLengths[0];xa+=2*U.pathLengths[0];pa+=U.pathLengths[0];for(R=1;R<U.pathLengths.length;++R)I(Z,T,X,P,pa,U.pathLengths[R],U.count,aa,ja,xa,ka),aa+=4*U.pathLengths[R],xa+=2*U.pathLengths[R],pa+=U.pathLengths[R]}function N(ha,fa,R,U,Z,T,P){U[T]=U[P];P*=3;T*=3;ha[T+0]=ha[P+0];ha[T+1]=ha[P+1];ha[T+2]=ha[P+2];fa[T+0]=fa[P+0];fa[T+1]=fa[P+1];fa[T+2]=fa[P+2];R[T+0]=Z[0];R[T+1]=Z[1];R[T+2]=Z[2]}function I(ha,fa,R,U,Z,T,P,X,aa,ja,ia){let ka=Z,na=Z+1,ta=Z+P,pa=Z+P+1,xa=X,Da=X+1,Ka=X+2*T;
X=X+2*T+1;0>ia&&(ka=Z+P+1,pa=Z);ja*=3;for(let Ga=0;Ga<T;++Ga){Ga===T-1&&(0<ia?(na=Z,pa=Z+P):(na=Z,ka=Z+P));var Fa=ha,Ha=ka,ua=na,Ba=ta,Ea=H;Ha*=3;ua*=3;Ba*=3;h.set(J,Fa[Ha++],Fa[Ha++],Fa[Ha++]);h.set(M,Fa[ua++],Fa[ua++],Fa[ua++]);h.set(O,Fa[Ba++],Fa[Ba++],Fa[Ba++]);h.subtract(Q,M,J);h.subtract(S,O,J);h.cross(Ea,S,Q);h.normalize(Ea,Ea);N(ha,fa,U,R,H,xa,ka);N(ha,fa,U,R,H,Da,na);N(ha,fa,U,R,H,Ka,ta);N(ha,fa,U,R,H,X,pa);aa[ja++]=xa;aa[ja++]=Ka;aa[ja++]=X;aa[ja++]=xa;aa[ja++]=X;aa[ja++]=Da;ka++;na++;ta++;
pa++;xa+=2;Da+=2;Ka+=2;X+=2}}function G(ha,fa,R,U){ha=ha.stageObject;const Z=ha.geometryRecords,T=Z.length,P="absolute-height"!==fa.mode;let X=0;const aa=ha.transformation,ja=n.invert(b.create(),aa);for(let na=0;na<T;na+=2){const ta=Z[na].geometry,pa=ta.getMutableAttribute("position").data,xa=ta.vertexAttributes.get("size").data;var ia=ta.vertexAttributes.get("mapPos").data;ia=new B.SamplePosition(ia);const Da=pa.length/3;let Ka=0,Fa=!1,Ha=0;const ua=R.spatialReference;for(let Ba=0;Ba<Da;Ba++){V[0]=
pa[Ka];V[1]=pa[Ka+1];V[2]=pa[Ka+2];var ka=d.evaluateElevationAlignmentAtPoint(ia,R,fa,U,P?da:null);P&&(Ha+=da.sampledElevation);C.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h.set(Y,ia.array[ia.offset+0],ia.array[ia.offset+1],ka+xa[Ka/3]),U.toRenderCoords(Y,ua,Y)):(h.set(Y,pa[Ka+0],pa[Ka+1],pa[Ka+2]),h.transformMat4(Y,Y,aa),U.setAltitude(Y,ka+xa[Ka/3]));h.transformMat4(Y,Y,ja);pa[Ka]=Y[0];pa[Ka+1]=Y[1];pa[Ka+2]=Y[2];ka=.01/U.unitInMeters;if(Math.abs(V[0]-pa[Ka])>=ka||Math.abs(V[1]-pa[Ka+1])>=ka||
Math.abs(V[2]-pa[Ka+2])>=ka)Fa=!0;ia.offset+=3;Ka+=3}Fa&&(ta.invalidateBoundingInfo(),ha.geometryVertexAttrsUpdated(na),Z[na+1].geometry.invalidateBoundingInfo(),ha.geometryVertexAttrsUpdated(na+1));X+=Ha/Da}return X/T}const K=["polygon","extent"];q=function(ha){function fa(U,Z,T,P){U=ha.call(this,U,Z,T,P)||this;U.ensureDrapedStatus(!1);return U}u._inheritsLoose(fa,ha);var R=fa.prototype;R.doLoad=function(){var U=u._asyncToGenerator(function*(){if(!this._drivenProperties.size){var Z=y.validateSymbolLayerSize(this._getSymbolSize());
if(Z)throw new f("graphics3dextrudesymbollayer:invalid-size",Z);}Z=p.get(this.symbolLayer,"material","color");var T=this._getCombinedOpacityAndColor(Z);Z=k.fromArray(T);T=T[3];const P=1>T||this.needsDrivenTransparentPass;Z={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:Z,ambient:Z,opacity:T,transparent:P,cullFace:P?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=
new F.DefaultMaterial(Z);this._bottomMaterial=new F.DefaultMaterial({...Z,cullFace:2});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return U.apply(this,arguments)}}();R.destroy=function(){ha.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};R.createGraphics3DGraphic=function(U){const Z=U.graphic;if(!this._validateGeometry(Z.geometry,K,this.symbolLayer.type))return null;
const T=this._getVertexOpacityAndColor(U.renderingInfo,255),P=this.setGraphicElevationContext(Z,new g.ElevationContext);return this._createAs3DShape(Z,U.renderingInfo,T,P,Z.uid)};R.layerOpacityChanged=function(U,Z){var T=p.get(this.symbolLayer,"material","color");T=this._getCombinedOpacity(T);const P=1>T||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:T,transparent:P});this._bottomMaterial.setParameterValues({opacity:T,transparent:P});const X=this._getLayerOpacity();U.forEach(aa=>
{aa=Z(aa);p.isSome(aa)&&aa.layerOpacityChanged(X,this._context.isAsync)});return!0};R.layerElevationInfoChanged=function(U,Z){return this.updateGraphics3DGraphicElevationInfo(U,Z,d.needsElevationUpdates3D)};R.slicePlaneEnabledChanged=function(U,Z){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});U.forEach(T=>{T=Z(T);p.isSome(T)&&T.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,
this._context.isAsync)});return!0};R.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};R.pixelRatioChanged=function(){return!0};R._getExtrusionSize=function(U){if(U.size&&this._drivenProperties.size){var Z;U=null!=(Z=c.getDriverAxisSizeValue(U.size,2))?Z:0}else U=this._getSymbolSize();return U/=
this._context.renderCoordsHelper.unitInMeters};R._getSymbolSize=function(){var U;return null!=(U=this.symbolLayer.size)?U:1};R._createAs3DShape=function(U,Z,T,P,X){var aa=x.geometryAsPolygon(U.geometry);if(p.isNone(aa))return null;U=x.geometryToRenderInfo(aa,this._context.elevationProvider,this._context.renderCoordsHelper,P);this._logGeometryCreationWarnings(U,aa.rings,"rings","ExtrudeSymbol3DLayer");if(0===aa.rings.length||!aa.rings.some(Qa=>0<Qa.length))return null;var ja=y.computeCentroid(aa);
if(p.isNone(ja))return null;var ia=[];const ka=[],na=[],ta=m.create(),pa=b.create(),xa=k.create(),Da=1===this._context.renderCoordsHelper.viewingMode;Da||this._context.renderCoordsHelper.worldUpAtPosition(null,xa);l.computeLinearTransformation(aa.spatialReference,[ja.x,ja.y,0],pa,this._context.renderCoordsHelper.spatialReference);aa=b.create();n.invert(aa,pa);ja=e.create();w.normalFromMat4(ja,aa);const {polygons:Ka,mapPosition:Fa,position:Ha}=U;var ua=Ha.length/3;const Ba=new Float64Array(18*ua),
Ea=new Float64Array(18*ua),Ga=new Float64Array(18*ua);ua=new Float64Array(6*ua);let ma=0;for(let Qa=0;Qa<Ka.length;++Qa){var ya=Ka[Qa];const ra=ya.count;if(this._context.clippingExtent&&(m.empty(ta),m.expandWithBuffer(ta,ya.mapPosition),!m.intersectsClippingArea(ta,this._context.clippingExtent)))continue;const va=t.earcut(ya.mapPosition,ya.holeIndices,3);if(0===va.length)continue;const La=new Uint32Array(6*ra+va.length);var Ma=new Uint32Array(va.length),Ra=6*ra,ea=3*Ba.BYTES_PER_ELEMENT;ea=new z.BufferViewVec3f64(Ba.buffer,
ma*ea,ea,(ma+Ra)*ea);var Ua=3*Ea.BYTES_PER_ELEMENT;Ua=new z.BufferViewVec3f64(Ea.buffer,ma*Ua,Ua,(ma+Ra)*Ua);const Ta=new Float64Array(Ga.buffer,3*ma*Ga.BYTES_PER_ELEMENT,3*Ra);Ra=new Float64Array(ua.buffer,1*ma*ua.BYTES_PER_ELEMENT,1*Ra);const Pa=this._getExtrusionSize(Z);L(Ha,Fa,va,ya,ea.typedBuffer,Ta,Ua.typedBuffer,Ra,0,La,Ma,Pa,xa,Da);r.transformMat4(ea,ea,aa);r.transformMat3(Ua,Ua,ja);ma+=6*ra;ya=this._createExtrudeGeometry(La,La.length-Ma.length,{positions:ea.typedBuffer,elevation:Ta,normals:Ua.typedBuffer,
heights:Ra},T);ia.push(ya);ka.push(this._material);na.push(b.IDENTITY);Ma=this._createExtrudeGeometry(Ma,0,{positions:ea.typedBuffer,elevation:Ta,normals:Ua.typedBuffer,heights:Ra},T);ia.push(Ma);ka.push(this._bottomMaterial);na.push(b.IDENTITY)}if(0===ia.length)return null;Z=new E.Object3D({geometries:ia,materials:ka,transformations:na,metadata:{layerUid:this._context.layer.uid,graphicUid:X,isElevationSource:!0}});Z.transformation=pa;T=D.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});
T=p.isSome(T)?{baseMaterial:this._material,edgeMaterials:[T],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;ia=new A.Graphics3DObject3DGraphicLayer(this,Z,ia,null,null,G,P,T);ia.alignedSampledElevation=U.sampledElevation;ia.needsElevationUpdates=d.needsElevationUpdates3D(P.mode);return ia};R._createExtrudeGeometry=function(U,Z,T,P){var X=new Uint32Array(U.length);P=[["position",{size:3,data:T.positions,exclusive:!0}],["normal",{size:3,data:T.normals,exclusive:!0}],
["color",{size:4,data:P,exclusive:!0}],["size",{size:1,data:T.heights,exclusive:!0}]];X=[["position",U],["normal",U],["color",X]];T.elevation&&(P.push(["mapPos",{size:3,data:T.elevation}]),X.push(["mapPos",U]));return new v.Geometry(P,X,0,Z)};return fa}(q.Graphics3DSymbolLayer);const H=k.create(),J=k.create(),M=k.create(),O=k.create(),Q=k.create(),S=k.create(),V=k.create(),Y=k.create(),W=k.create(),ba=[0,2,1],ca=[0,1,2],da={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DExtrudeSymbolLayer=
q;a.default=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var u={exports:{}};(function(f){(function(p){p=p();void 0!==p&&(f.exports=p)})(function(){function p(v,E,F){F=F||2;var L=E&&E.length,N=L?E[0]*F:v.length,I=t(v,0,N,F,!0),G=[];if(!I||I.next===I.prev)return G;var K;if(L){var H=I;var J=F;I=[];var M;L=0;for(M=E.length;L<M;L++){var O=E[L]*J;var Q=L<M-1?E[L+1]*J:v.length;O=t(v,O,Q,J,!1);O===O.next&&(O.steiner=!0);I.push(m(O))}I.sort(b);
for(L=0;L<I.length;L++)J=I[L],E=H,(H=h(J,E))?(J=y(H,J),M=w(H,H.next),w(J,J.next),H=E===H?M:E):H=E,H=w(H,H.next);I=H}if(v.length>80*F){var S=K=v[0];var V=L=v[1];for(J=F;J<N;J+=F)E=v[J],H=v[J+1],E<S&&(S=E),H<V&&(V=H),E>K&&(K=E),H>L&&(L=H);K=Math.max(K-S,L-V);K=0!==K?1/K:0}e(I,G,F,S,V,K);return G}function t(v,E,F,L,N){if(N===0<B(v,E,F,L))for(N=E;N<F;N+=L)var I=x(N,v[N],v[N+1],I);else for(N=F-L;N>=E;N-=L)I=x(N,v[N],v[N+1],I);I&&c(I,I.next)&&(D(I),I=I.next);return I}function w(v,E){if(!v)return v;E||(E=
v);do{var F=!1;if(v.steiner||!c(v,v.next)&&0!==r(v.prev,v,v.next))v=v.next;else{D(v);v=E=v.prev;if(v===v.next)break;F=!0}}while(F||v!==E);return E}function e(v,E,F,L,N,I,G){if(v){!G&&I&&k(v,L,N,I);for(var K=v,H,J;v.prev!==v.next;){H=v.prev;J=v.next;if(I)var M=n(v,L,N,I);else a:{M=v;var O=M.prev,Q=M,S=M.next;if(0<=r(O,Q,S))M=!1;else{for(var V=M.next.next;V!==M.prev;){if(z(O.x,O.y,Q.x,Q.y,S.x,S.y,V.x,V.y)&&0<=r(V.prev,V,V.next)){M=!1;break a}V=V.next}M=!0}}if(M)E.push(H.i/F),E.push(v.i/F),E.push(J.i/
F),D(v),K=v=J.next;else if(v=J,v===K){if(!G)e(w(v),E,F,L,N,I,1);else if(1===G){v=w(v);G=E;K=F;H=v;do J=H.prev,M=H.next.next,!c(J,M)&&d(J,H,H.next,M)&&q(J,M)&&q(M,J)&&(G.push(J.i/K),G.push(H.i/K),G.push(M.i/K),D(H),D(H.next),H=v=M),H=H.next;while(H!==v);v=w(H);e(v,E,F,L,N,I,2)}else if(2===G)a:{G=v;do{for(K=G.next.next;K!==G.prev;){if(H=G.i!==K.i){M=M=M=M=void 0;H=G;J=K;if(M=H.next.i!==J.i&&H.prev.i!==J.i){b:{M=H;do{if(M.i!==H.i&&M.next.i!==H.i&&M.i!==J.i&&M.next.i!==J.i&&d(M,M.next,H,J)){M=!0;break b}M=
M.next}while(M!==H);M=!1}M=!M}if(M){if(M=q(H,J)&&q(J,H)){M=H;O=!1;Q=(H.x+J.x)/2;S=(H.y+J.y)/2;do M.y>S!==M.next.y>S&&M.next.y!==M.y&&Q<(M.next.x-M.x)*(S-M.y)/(M.next.y-M.y)+M.x&&(O=!O),M=M.next;while(M!==H);M=O}M=M&&(r(H.prev,H,J.prev)||r(H,J.prev,J))||c(H,J)&&0<r(H.prev,H,H.next)&&0<r(J.prev,J,J.next)}H=M}if(H){v=y(G,K);G=w(G,G.next);v=w(v,v.next);e(G,E,F,L,N,I);e(v,E,F,L,N,I);break a}K=K.next}G=G.next}while(G!==v)}break}}}}function n(v,E,F,L){var N=v.prev,I=v.next;if(0<=r(N,v,I))return!1;var G=
N.x>v.x?N.x>I.x?N.x:I.x:v.x>I.x?v.x:I.x,K=N.y>v.y?N.y>I.y?N.y:I.y:v.y>I.y?v.y:I.y,H=l(N.x<v.x?N.x<I.x?N.x:I.x:v.x<I.x?v.x:I.x,N.y<v.y?N.y<I.y?N.y:I.y:v.y<I.y?v.y:I.y,E,F,L);E=l(G,K,E,F,L);F=v.prevZ;for(L=v.nextZ;F&&F.z>=H&&L&&L.z<=E;){if(F!==v.prev&&F!==v.next&&z(N.x,N.y,v.x,v.y,I.x,I.y,F.x,F.y)&&0<=r(F.prev,F,F.next))return!1;F=F.prevZ;if(L!==v.prev&&L!==v.next&&z(N.x,N.y,v.x,v.y,I.x,I.y,L.x,L.y)&&0<=r(L.prev,L,L.next))return!1;L=L.nextZ}for(;F&&F.z>=H;){if(F!==v.prev&&F!==v.next&&z(N.x,N.y,v.x,
v.y,I.x,I.y,F.x,F.y)&&0<=r(F.prev,F,F.next))return!1;F=F.prevZ}for(;L&&L.z<=E;){if(L!==v.prev&&L!==v.next&&z(N.x,N.y,v.x,v.y,I.x,I.y,L.x,L.y)&&0<=r(L.prev,L,L.next))return!1;L=L.nextZ}return!0}function b(v,E){return v.x-E.x}function h(v,E){var F=E,L=v.x,N=v.y,I=-Infinity;do{if(N<=F.y&&N>=F.next.y&&F.next.y!==F.y){var G=F.x+(N-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(G<=L&&G>I){I=G;if(G===L){if(N===F.y)return F;if(N===F.next.y)return F.next}var K=F.x<F.next.x?F:F.next}}F=F.next}while(F!==E);if(!K)return null;
if(L===I)return K;E=K;G=K.x;var H=K.y,J=Infinity;F=K;do{if(L>=F.x&&F.x>=G&&L!==F.x&&z(N<H?L:I,N,G,H,N<H?I:L,N,F.x,F.y)){var M=Math.abs(N-F.y)/(L-F.x);var O;if((O=q(F,v))&&!(O=M<J)&&(O=M===J)&&!(O=F.x>K.x)&&(O=F.x===K.x)){O=K;var Q=F;O=0>r(O.prev,O,Q.prev)&&0>r(Q.next,O,O.next)}O&&(K=F,J=M)}F=F.next}while(F!==E);return K}function k(v,E,F,L){var N=v;do{null===N.z&&(N.z=l(N.x,N.y,E,F,L));if(N.prev.next!==N||N.next.prev!==N)return N.prev.next=N,N.next.prev=N,k(v,E,F,L);N.prevZ=N.prev;N=N.nextZ=N.next}while(N!==
v);N.prevZ.nextZ=null;N.prevZ=null;v=N;var I,G,K,H=1;do{E=v;L=v=null;for(N=0;E;){N++;F=E;for(I=G=0;I<H&&(G++,F=F.nextZ,F);I++);for(K=H;0<G||0<K&&F;)0!==G&&(0===K||!F||E.z<=F.z)?(I=E,E=E.nextZ,G--):(I=F,F=F.nextZ,K--),L?L.nextZ=I:v=I,I.prevZ=L,L=I;E=F}L.nextZ=null;H*=2}while(1<N)}function l(v,E,F,L,N){v=32767*(v-F)*N;E=32767*(E-L)*N;v=(v|v<<8)&16711935;v=(v|v<<4)&252645135;v=(v|v<<2)&858993459;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;return(v|v<<1)&1431655765|((E|E<<1)&1431655765)<<
1}function m(v){var E=v,F=v;do{if(E.x<F.x||E.x===F.x&&E.y<F.y)F=E;E=E.next}while(E!==v);return F}function z(v,E,F,L,N,I,G,K){return 0<=(N-G)*(E-K)-(v-G)*(I-K)&&0<=(v-G)*(L-K)-(F-G)*(E-K)&&0<=(F-G)*(I-K)-(N-G)*(L-K)}function r(v,E,F){return(E.y-v.y)*(F.x-E.x)-(E.x-v.x)*(F.y-E.y)}function c(v,E){return v.x===E.x&&v.y===E.y}function d(v,E,F,L){var N=A(r(v,E,F)),I=A(r(v,E,L)),G=A(r(F,L,v)),K=A(r(F,L,E));return N!==I&&G!==K||0===N&&g(v,F,E)||0===I&&g(v,L,E)||0===G&&g(F,v,L)||0===K&&g(F,E,L)?!0:!1}function g(v,
E,F){return E.x<=Math.max(v.x,F.x)&&E.x>=Math.min(v.x,F.x)&&E.y<=Math.max(v.y,F.y)&&E.y>=Math.min(v.y,F.y)}function A(v){return 0<v?1:0>v?-1:0}function q(v,E){return 0>r(v.prev,v,v.next)?0<=r(v,E,v.next)&&0<=r(v,v.prev,E):0>r(v,E,v.prev)||0>r(v,v.next,E)}function y(v,E){var F=new C(v.i,v.x,v.y),L=new C(E.i,E.x,E.y),N=v.next,I=E.prev;v.next=E;E.prev=v;F.next=N;N.prev=F;L.next=F;F.prev=L;I.next=L;L.prev=I;return L}function x(v,E,F,L){v=new C(v,E,F);L?(v.next=L.next,v.prev=L,L.next.prev=v,L.next=v):
(v.prev=v,v.next=v);return v}function D(v){v.next.prev=v.prev;v.prev.next=v.next;v.prevZ&&(v.prevZ.nextZ=v.nextZ);v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function C(v,E,F){this.i=v;this.x=E;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(v,E,F,L){for(var N=0,I=F-L;E<F;E+=L)N+=(v[I]-v[E])*(v[E+1]+v[I+1]),I=E;return N}p.deviation=function(v,E,F,L){var N=E&&E.length,I=Math.abs(B(v,0,N?E[0]*F:v.length,F));if(N){N=0;for(var G=E.length;N<G;N++)I-=Math.abs(B(v,E[N]*F,N<
G-1?E[N+1]*F:v.length,F))}for(N=E=0;N<L.length;N+=3){G=L[N]*F;var K=L[N+1]*F,H=L[N+2]*F;E+=Math.abs((v[G]-v[H])*(v[K+1]-v[G+1])-(v[G]-v[K])*(v[H+1]-v[G+1]))}return 0===I&&0===E?0:Math.abs((E-I)/I)};p.flatten=function(v){for(var E=v[0][0].length,F={vertices:[],holes:[],dimensions:E},L=0,N=0;N<v.length;N++){for(var I=0;I<v[N].length;I++)for(var G=0;G<E;G++)F.vertices.push(v[N][I][G]);0<N&&(L+=v[N-1].length,F.holes.push(L))}return F};return p})})(u);a.earcut=u.exports})},"esri/chunks/vec32":function(){define(["exports",
"../geometry/support/buffer/math/common"],function(a,u){function f(b,h,k){if(b.count!==h.count)u.logger.error("source and destination buffers need to have the same number of elements");else{var l=b.count,m=k[0],z=k[1],r=k[2],c=k[4],d=k[5],g=k[6],A=k[8],q=k[9],y=k[10],x=k[12],D=k[13];k=k[14];var C=b.typedBuffer;b=b.typedBufferStride;var B=h.typedBuffer;h=h.typedBufferStride;for(let E=0;E<l;E++){const F=E*b;var v=E*h;const L=B[v],N=B[v+1];v=B[v+2];C[F]=m*L+c*N+A*v+x;C[F+1]=z*L+d*N+q*v+D;C[F+2]=r*L+
g*N+y*v+k}}}function p(b,h,k){if(b.count!==h.count)u.logger.error("source and destination buffers need to have the same number of elements");else{var l=b.count,m=k[0],z=k[1],r=k[2],c=k[3],d=k[4],g=k[5],A=k[6],q=k[7];k=k[8];var y=b.typedBuffer;b=b.typedBufferStride;var x=h.typedBuffer;h=h.typedBufferStride;for(let C=0;C<l;C++){const B=C*b;var D=C*h;const v=x[D],E=x[D+1];D=x[D+2];y[B]=m*v+c*E+A*D;y[B+1]=z*v+d*E+q*D;y[B+2]=r*v+g*E+k*D}}}function t(b,h,k){const l=Math.min(b.count,h.count),m=b.typedBuffer;
b=b.typedBufferStride;const z=h.typedBuffer;h=h.typedBufferStride;for(let r=0;r<l;r++){const c=r*b,d=r*h;m[c]=k*z[d];m[c+1]=k*z[d+1];m[c+2]=k*z[d+2]}}function w(b,h){const k=Math.min(b.count,h.count),l=b.typedBuffer;b=b.typedBufferStride;const m=h.typedBuffer;h=h.typedBufferStride;for(let c=0;c<k;c++){const d=c*b;var z=c*h;const g=m[z],A=m[z+1];z=m[z+2];var r=Math.sqrt(g*g+A*A+z*z);0<r&&(r=1/r,l[d]=r*g,l[d+1]=r*A,l[d+2]=r*z)}}function e(b,h,k){const l=Math.min(b.count,h.count),m=b.typedBuffer;b=b.typedBufferStride;
const z=h.typedBuffer;h=h.typedBufferStride;for(let r=0;r<l;r++){const c=r*b,d=r*h;m[c]=z[d]>>k;m[c+1]=z[d+1]>>k;m[c+2]=z[d+2]>>k}}var n=Object.freeze({__proto__:null,transformMat4:f,transformMat3:p,scale:t,normalize:w,shiftRight:e});a.normalize=w;a.scale=t;a.shiftRight=e;a.transformMat3=p;a.transformMat4=f;a.vec3=n})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,u){u=u.getLogger("esri.views.3d.support.buffer.math");a.logger=u;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,u,f,p,t){function w(h,k){if(!h||h.symbol)return null;k=k&&k.renderer;return h&&p.isSome(k)&&k.getObservationRenderer?k.getObservationRenderer(h):k}function e(h,k){return n.apply(this,arguments)}function n(){n=u._asyncToGenerator(function*(h,k){if(p.isSome(h.symbol))return h.symbol;
const l=w(h,k);return p.isSome(l)&&l.getSymbolAsync(h,{...k,abortOptions:{signal:k.signal}})});return n.apply(this,arguments)}function b(){b=u._asyncToGenerator(function*(h,k){var l=w(h,k),m=yield e(h,k);if(!m)return null;m={renderer:l,symbol:m};if(!(l&&"visualVariables"in l&&l.visualVariables))return m;k=t.getVisualVariableValues(l,h,k);h=["proportional","proportional","proportional"];for(const {variable:z,value:r}of k)"color"===z.type?m.color=f.toUnitRGBA(r):"size"===z.type?"outline"===z.target?
m.outlineSize=r:(k=z.axis,l=z.useSymbolValue?"symbol-value":r,"width"===k?h[0]=l:"depth"===k?h[1]=l:"height"===k?h[2]=l:h[0]="width-and-depth"===k?h[1]=l:h[1]=h[2]=l):"opacity"===z.type?m.opacity=r:"rotation"===z.type&&"tilt"===z.axis?m.tilt=r:"rotation"===z.type&&"roll"===z.axis?m.roll=r:"rotation"===z.type&&(m.heading=r);if(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))m.size=h;return m});return b.apply(this,arguments)}a.getDriverAxisSizeValue=function(h,k=0){h=h[k];return"number"===typeof h&&
isFinite(h)?h:null};a.getDriverAxisSizeValueAny=function(h){for(let k=0;3>k;k++){const l=h[k];if("number"===typeof l)return isFinite(l)?l:0}return 0};a.getRenderer=w;a.getRenderingInfo=function(h,k){const l=w(h,k);if(p.isSome(h.symbol))var m=h.symbol;else m=w(h,k),m=p.isSome(m)&&"dot-density"!==m.type?m.getSymbol(h,k):null;if(p.isNone(m))return null;m={renderer:l,symbol:m};if(p.isNone(l)||!("visualVariables"in l)||!l.visualVariables)return m;k=t.getVisualVariableValues(l,h,k);h=["proportional","proportional",
"proportional"];for(const {variable:z,value:r}of k)switch(z.type){case "color":m.color=r.toRgba();break;case "size":if("outline"===z.target)m.outlineSize=r;else switch(k=z.useSymbolValue?"symbol-value":r,z.axis){case "width":h[0]=k;break;case "depth":h[1]=k;break;case "height":h[2]=k;break;case "width-and-depth":h[0]=h[1]=k;break;default:h[0]=h[1]=h[2]=k}break;case "opacity":m.opacity=r;break;case "rotation":switch(z.axis){case "tilt":m.tilt=r;break;case "roll":m.roll=r;break;default:m.heading=r}}if("proportional"!==
h[0]||"proportional"!==h[1]||"proportional"!==h[2])m.size=h;return m};a.getRenderingInfoAsync=function(h,k){return b.apply(this,arguments)};a.getSymbolAsync=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,u,f,p,t,w,e,n,b,h){function k(m,z,r){const c=[];for(const {index:d,count:g}of m){if(1>=g)continue;m=3*d;const A=m+3*g;c.push({index:d,count:g,position:z.subarray(m,A),mapPosition:r?r.subarray(m,A):void 0})}return c}function l(m,z,r){const c=[];for(const {index:d,count:g,holeIndices:A,pathLengths:q}of m){if(1>=g)continue;m=3*d;const y=m+3*g,x=A.map(D=>D-d);c.push({index:d,count:g,holeIndices:x,pathLengths:q,position:z.subarray(m,y),mapPosition:r?r.subarray(m,y):void 0})}return c}a.createColorGeometry=
function(m){const z=[["position",m.indices]],r=[["position",{size:3,data:m.attributeData.position,exclusive:!0}]];f.isSome(m.attributeData.color)&&(r.push(["color",{size:4,data:m.attributeData.color,exclusive:!0}]),z.push(["color",new Uint32Array(m.indices.length)]));f.isSome(m.attributeData.uvMapSpace)&&(r.push(["uvMapSpace",{size:4,data:m.attributeData.uvMapSpace,exclusive:!0}]),z.push(["uvMapSpace",m.indices]));f.isSome(m.attributeData.boundingRect)&&(r.push(["boundingRect",{size:9,data:m.attributeData.boundingRect,
exclusive:!0}]),z.push(["boundingRect",m.indices]));f.isSome(m.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:m.attributeData.mapPosition,exclusive:!0}]),z.push(["mapPos",m.indices]));return new n.Geometry(r,z)};a.createWaterGeometry=function(m){const z=[["position",m.indices],["uv0",m.indices]],r=[["position",{size:3,data:m.attributeData.position,exclusive:!0}],["uv0",{size:2,data:m.attributeData.uv0,exclusive:!0}]];f.isSome(m.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:m.attributeData.mapPosition,
exclusive:!0}]),z.push(["mapPos",m.indices]));return new n.Geometry(r,z)};a.geometryAsPolygon=function(m){switch(m.type){case "extent":if(m instanceof b)return h.fromExtent(m);break;case "polygon":return m}return null};a.geometryToRenderInfo=function(m,z,r,c){const d=t.pathsToTriangulationInfo(m.rings,m.hasZ,1),g=new Float64Array(d.position.length);m=w.applyPerVertexElevationAlignment(d.position,m.spatialReference,0,g,0,d.position,0,d.position.length/3,z,r,c);z=null!=m;return{position:d.position,
mapPosition:g,polygons:l(d.polygons,d.position,g),outlines:k(d.outlines,d.position,g),projectionSuccess:z,sampledElevation:m}};a.geometryToRenderInfoDraped=function(m,z){const r=t.pathsToTriangulationInfo(m.rings,!1,1);m=p.projectBuffer(r.position,m.spatialReference,0,r.position,z,0,r.position.length/3);for(z=2;z<r.position.length;z+=3)r.position[z]=e.DRAPED_Z;return{position:r.position,polygons:l(r.polygons,r.position),outlines:k(r.outlines,r.position),projectionSuccess:m}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],function(a,u,f,p){function t(n,b,h){if(1===n.length)return n[0];b=new Float64Array(b);h=new Uint32Array(h);let k=0,l=0,m=0;for(const z of n){for(n=0;n<z.position.length;n++)b[k++]=z.position[n];for(n=0;n<z.faces.length;n++)h[l++]=z.faces[n]+m;m=k/3}return{position:b,faces:h}}function w(n,b,h){const k=n.length,l=Array(k),m=Array(k),z=Array(k);
let r=0,c=0,d=0;var g=0;for(var A=0;A<k;++A)g+=n[A].length;g=new Float64Array(3*g);A=0;for(let D=k-1;0<=D;D--){var q=n[D],y=1===h?!f.isClockwise(q,!1,!1):!1;if(y&&1!==k)l[r++]=q;else{var x=q.length;for(let C=0;C<r;++C)x+=l[C].length;x={index:A,pathLengths:Array(r+1),count:x,holeIndices:Array(r)};x.pathLengths[0]=q.length;0<q.length&&(z[d++]={index:A,count:q.length});A=y?e(q,q.length-1,-1,g,A,q.length,b):e(q,0,1,g,A,q.length,b);for(q=0;q<r;++q)y=l[q],x.holeIndices[q]=A,x.pathLengths[q+1]=y.length,
0<y.length&&(z[d++]={index:A,count:y.length}),A=e(y,0,1,g,A,y.length,b);r=0;0<x.count&&(m[c++]=x)}}for(n=0;n<r;++n)h=l[n],0<h.length&&(z[d++]={index:A,count:h.length}),A=e(h,0,1,g,A,h.length,b);c<k&&(m.length=c);d<k&&(z.length=d);return{position:g,polygons:m,outlines:z}}function e(n,b,h,k,l,m,z){l*=3;for(let r=0;r<m;++r){const c=n[b];k[l++]=c[0];k[l++]=c[1];k[l++]=z?c[2]:0;b+=h}return l/3}a.pathsToTriangulationInfo=w;a.triangulate=function(n){n=w(n.rings,n.hasZ,1);const b=[];let h=0,k=0;for(var l of n.polygons){const z=
l.index,r=new Float64Array(n.position.buffer,3*z*n.position.BYTES_PER_ELEMENT,3*l.count);var m=l.holeIndices.map(c=>c-z);m=new Uint32Array(u.earcut(r,m,3));b.push({position:r,faces:m});h+=r.length;k+=m.length}l=t(b,h,k);n=p.deduplicate(l.position.buffer,6,{originalIndices:l.faces});l.position=new Float64Array(n.buffer);l.faces=n.indices;return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils"],
function(a,u){function f(t,w,e){var n,b=t.byteLength/(4*w),h=new Uint32Array(t,0,b*w);t=new Uint32Array(b);var k=null!=(n=null==e?void 0:e.minReduction)?n:0;const l=(n=(null==e?void 0:e.originalIndices)||null)?n.length:0;var m=(null==e?void 0:e.componentOffsets)||null;e=0;if(m)for(var z=0;z<m.length-1;z++){var r=m[z+1]-m[z];r>e&&(e=r)}else e=b;var c=Math.floor(1.1*e)+1;if(null==p||p.length<2*c)p=new Uint32Array(u.nextHighestPowerOfTwo(2*c));for(e=0;e<2*c;e++)p[e]=0;e=0;r=(z=!!m&&!!n)?l:b;var d=z?
new Uint32Array(l):null,g=0!==k?Math.ceil(7.84*1.96/(k*k)*k*(1-k)):r,A=1,q=m?m[1]:r;for(var y=0;y<r;y++){if(y===g){var x=1-e/y;if(x+1.96*Math.sqrt(x*(1-x)/y)<k)return null;g*=2}if(y===q){for(q=0;q<2*c;q++)p[q]=0;if(n)for(q=m[A-1];q<m[A];q++)d[q]=t[n[q]];q=m[++A]}x=z?n[y]:y;const v=x*w;var D=0;for(var C=0;C<w;C++)D=h[v+C]+D|0,D=D+(D<<11)+(D>>>2)|0;D>>>=0;C=D%c;let E=e;for(;0!==p[2*C+1];){if(p[2*C]===D){const F=p[2*C+1]-1;var B=F*w;a:{for(let L=0;L<w;L++)if(h[v+L]!==h[B+L]){B=!1;break a}B=!0}if(B){E=
t[F];break}}C++;C>=c&&(C-=c)}E===e&&(p[2*C]=D,p[2*C+1]=x+1,e++);t[x]=E}if(0!==k&&1-e/b<k)return null;if(z){for(b=m[A-1];b<d.length;b++)d[b]=t[n[b]];t=d}b=new Uint32Array(w*e);e=0;for(A=0;A<r;A++)if(t[A]===e){k=h;m=(z?n[A]:A)*w;c=b;d=e*w;g=w;for(y=0;y<g;y++)c[d+y]=k[m+y];e++}if(n&&!z){w=new Uint32Array(l);for(h=0;h<w.length;h++)w[h]=t[n[h]];t=w}return{buffer:b.buffer,indices:t,uniqueCount:e}}let p=null;a.deduplicate=f;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../support/debugFlags ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/StippleTextureRepository ../../support/Scheduler ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S){const V=w.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");a.OverlayRenderer=function(ha){function fa(U){U=ha.call(this,U)||this;U._overlays=null;U._overlayRenderTarget=null;U._hasHighlights=!1;U._rendersOccluded=!1;U._hasWater=!1;U._lighting=new J.SceneLighting;U._handles=new t;U._layerRenderers=new Map;U._sortedLayerRenderersDirty=!1;U._sortedLayerRenderers=new b;U._geometries=new Map;U.globalUnitScale=
1;U.longitudeCyclical=null;return U}u._inheritsLoose(fa,ha);var R=fa.prototype;R.initialize=function(){const U=this.view._stage.renderView;this._rctx=U.renderingContext;this._renderContext=new I.OverlayRenderContext(this._rctx);const Z=U.waterTextureRepository;this._stippleTextureRepository=new M.StippleTextureRepository(U.renderingContext);this._shaderTechniqueRepository=new C.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:Z});
this._handles.add([k.init(Z,"loadingState",()=>this.emitContentChanged()),k.init(this,"spatialReference",T=>this._localOrigins=new L.GridLocalOriginFactory(T))]);this._materialRepository=new E(U.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=T=>{0<(T.renderOccluded&4)!==this._rendersOccluded&&this.updateRendersOccluded();this.emitContentChanged();this.notifyChange("updating")};this._lighting.groundLightingFactor=1;this._lighting.globalFactor=0;this._lighting.set([new H.AmbientLight(A.fromValues(1,
1,1))]);this._bindParameters={slot:null,highlightDepthTexture:F.createEmptyDepthTexture(this._rctx),camera:ba,inverseViewport:g.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,
multipassGeometryEnabled:!1,highlightColorTexture:null};this._handles.add(this.view.resourceController.scheduler.registerTask(O.TaskPriority.STAGE,this))};R.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(U=>U.dispose());this._layerRenderers.clear();this._debugTextureTechnique=n.releaseMaybe(this._debugTextureTechnique);this._debugPatternTexture=n.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=n.disposeMaybe(this._bindParameters.highlightDepthTexture);
this._shaderTechniqueRepository=n.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=n.disposeMaybe(this._temporaryFBO);this._quadVAO=n.disposeMaybe(this._quadVAO);this._overlayRenderTarget=n.disposeMaybe(this._overlayRenderTarget)};R.collectUnusedRenderTargetMemory=function(U){let Z=!1;if(n.isSome(this._overlayRenderTarget))for(const T of this._overlayRenderTarget.renderTargets)Z=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[T.type]||!this.overlays[1].validTargets[T.type],
T,U)||Z;return Z};R.ensureDrapeTargets=function(U){n.isSome(this._overlays)&&this._overlays.forEach(Z=>{Z.hasTargetWithoutRasterImage=h.someSet(U,T=>1===T.drapeTargetType)})};R.ensureDrapeSources=function(U){n.isSome(this._overlays)&&this._overlays.forEach(Z=>{Z.hasDrapedFeatureSource=e.someMap(U,(T,P)=>1===P.drapeSourceType);Z.hasDrapedRasterSource=e.someMap(U,(T,P)=>0===P.drapeSourceType)})};R.ensureOverlays=function(U,Z){n.isNone(this._overlays)&&(this._overlayRenderTarget=new D.OverlayRenderTarget(this._rctx),
this._overlays=[new y.Overlay(0,this._overlayRenderTarget),new y.Overlay(1,this._overlayRenderTarget)]);this.ensureDrapeTargets(U);this.ensureDrapeSources(Z)};R.disposeOverlays=function(){n.isSome(this._overlayRenderTarget)&&this._overlayRenderTarget.disposeRenderTargetMemory()};R.runTask=function(U,Z=()=>!0){let T=!1;for(const [P,X]of this._layerRenderers){if(U.done)break;Z(P)&&(X.commitChanges()&&(T=!0,U.madeProgress()),X.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(P),
this._handles.remove(P)))}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),T=!0);T&&(n.isSome(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())};R.processSyncLayers=function(){this.runTask(O.noBudget,U=>1===U.updatePolicy)};R.addGeometries=function(U,Z,T){for(const P of U)n.isNone(P.origin)&&(P.origin=this._localOrigins.getOrigin(P.boundingSphere)),
this._geometries.set(P.id,P);this.ensureLayerRenderer(Z).add(U);2===T&&this.notifyGraphicGeometryChanged(U,Z)};R.removeGeometries=function(U,Z,T){for(var P of U)this._geometries.delete(n.unwrap(P.id));if(P=this._layerRenderers.get(Z))P.remove(U),2===T&&this.notifyGraphicGeometryChanged(U,Z)};R.updateGeometries=function(U,Z,T){const P=this._layerRenderers.get(Z);if(P)switch(P.modify(U,T),T){case 4:case 2:return this.notifyGraphicGeometryChanged(U,Z);case 1:return this.notifyGraphicVisibilityChanged(U,
Z)}else V.warn("Attempted to update geometry for nonexistent layer")};R.notifyGraphicGeometryChanged=function(U,Z){if(!n.isNone(Z.notifyGraphicGeometryChanged))for(const P of U)if(U=P.graphicUid,n.isSome(U)&&U!==T){Z.notifyGraphicGeometryChanged(U);var T=U}};R.notifyGraphicVisibilityChanged=function(U,Z){if(!n.isNone(Z.notifyGraphicVisibilityChanged))for(const P of U)if(U=P.graphicUid,n.isSome(U)&&U!==T){Z.notifyGraphicVisibilityChanged(U);var T=U}};R.updateHighlights=function(U,Z){(Z=this._layerRenderers.get(Z))?
Z.modify(U,8):V.warn("Attempted to update highlights for nonexistent layer")};R.isEmpty=function(){return 0===this._geometries.size&&!q.OVERLAY_DRAW_DEBUG_TEXTURE};R.updateLogic=function(U){let Z=!1;this._layerRenderers.forEach(T=>{T.updateLogic(U)&&(Z=!0)});return Z};R.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};R.drawTarget=function(U,Z,T){const P=U.canvasGeometries;if(0===P.numViews)return!1;T*=U.pixelRatio;this._screenToWorldRatio=T*Math.abs(P.extents[0][2]-P.extents[0][0])/
Math.abs(U.viewport[2]-U.viewport[0]);const X=Z.renderPass;if(this.isEmpty()||5===X&&!this.hasHighlights||3===X&&!this.hasWater||!U.hasSomeSizedView())return!1;const aa=Z.fbo,ja=2*U.resolution,ia=U.resolution,ka=1===Z.type?2:4===Z.type?1:0;if(!aa.isValid())return!1;aa.resize(ja,ia);const na=this._rctx;ba.pixelRatio=T||1;this._renderContext.pass=X;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale;
U.applyViewport(this._rctx);aa.bind(na);0===U.index&&(na.setClearColor(0,0,0,0),na.clearSafe(16384));1===ka&&(this._renderContext.renderOccludedMask=4);if(q.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==ka)for(Z=0;Z<P.numViews;Z++)this.setViewParameters(P.extents[Z],U,ba),this.drawDebugTexture(U.resolution,W[U.index%W.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({layerView:ta,renderer:pa})=>{if(2!==ka||!n.isSome(ta)||0!==ta.drapeSourceType){var xa=n.isSome(ta)&&n.isSome(ta.fullOpacity)&&
1>ta.fullOpacity&&0===X;xa&&(this.bindTemporaryFramebuffer(this._rctx,ja,ia),na.clearSafe(16384));for(let Da=0;Da<P.numViews;Da++)this.setViewParameters(P.extents[Da],U,ba),pa.render(this._renderContext,this._bindParameters);xa&&n.isSome(this._temporaryFBO)&&(aa.bind(na),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,n.unwrap(n.unwrap(ta).fullOpacity),3,U.index))}});na.bindFramebuffer(null);aa.generateMipMap();this._renderContext.resetRenderOccludedMask();
return!0};R.bindTemporaryFramebuffer=function(U,Z,T){n.isNone(this._temporaryFBO)&&(this._temporaryFBO=new x.OverlayFramebufferObject(U,!1));this._temporaryFBO.resize(Z,T);this._temporaryFBO.bind(U)};R.reloadShaders=function(){var U=u._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.hotReload()});return function(){return U.apply(this,arguments)}}();R.intersect=function(U,Z,T){let P=0;this._geometries.forEach(X=>{if(!T||T(X)){this.intersectRenderGeometry(X,Z,0,U,P);var aa=this.longitudeCyclical;
aa&&(X.boundingSphere[0]-X.boundingSphere[3]<aa.min&&this.intersectRenderGeometry(X,Z,aa.range,U,P),X.boundingSphere[0]+X.boundingSphere[3]>aa.max&&this.intersectRenderGeometry(X,Z,-aa.range,U,P));P++}})};R.intersectRenderGeometry=function(U,Z,T,P,X){if(U.instanceParameters.visible){var aa=0;n.isSome(U.transformation)&&(T+=U.transformation[12],aa=U.transformation[13]);ca[0]=Z[0]-T;ca[1]=Z[1]-aa;ca[2]=1;da[0]=Z[0]-T;da[1]=Z[1]-aa;da[2]=0;U.screenToWorldRatio=this._screenToWorldRatio;U.material.intersect(U,
null,U.getShaderTransformation(),P,ca,da,(ja,ia,ka)=>{this.addIntersectionResult(ka,U.material.renderPriority,X,P,U.layerUid,U.graphicUid)},U.calculateShaderTransformation,!0)}};R.addIntersectionResult=function(U,Z,T,P,X,aa){const ja={type:"external",metadata:{layerUid:X,graphicUid:aa}};X=ia=>{ia.set(ja,null,P.results.ground.dist,P.results.ground.normal,P.results.ground.transformation,Z,null,null,U,T);ia.intersector="OverlayRenderer"};(null==P.results.min.drapedLayerOrder||Z>=P.results.min.drapedLayerOrder)&&
(null==P.results.min.dist||P.results.ground.dist<=P.results.min.dist)&&X(P.results.min);0!==P.options.store&&(null==P.results.max.drapedLayerOrder||Z<P.results.max.drapedLayerOrder)&&(null==P.results.max.dist||P.results.ground.dist>P.results.max.dist)&&X(P.results.max);2===P.options.store&&(aa=new N.IntersectorResult(P.ray),X(aa),P.results.all.push(aa))};R.stopAnimationsAtTime=function(U){this._sortedLayerRenderers.forAll(Z=>Z.renderer.stopAnimationsAtTime(U))};R.ensureLayerRenderer=function(U){let Z=
this._layerRenderers.get(U);Z||(Z=new G.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(U,Z),this._sortedLayerRenderersDirty=!0,"fullOpacity"in U&&this._handles.add(U.watch("fullOpacity",()=>this.emitContentChanged()),U),this._handles.add(k.init(Z,"updating",()=>this.notifyChange("updating")),U));return Z};R.updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),
0!==this._layerRenderers.size)){var U=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach(Z=>{const T=this._layerRenderers.get(Z);T&&(this._sortedLayerRenderers.push(new Y(Z,T)),U.delete(T))});U.forEach(Z=>this._sortedLayerRenderers.push(new Y(null,Z)))}};R.setViewParameters=function(U,Z,T){T.viewport=Z.viewport;d.ortho(T.projectionMatrix,0,U[2]-U[0],0,U[3]-U[1],T.near,T.far);d.identity(T.viewMatrix);d.translate(T.viewMatrix,T.viewMatrix,[-U[0],-U[1],0]);this._renderContext.camera=
T;this._bindParameters.camera=T;this._bindParameters.inverseViewport[0]=1/T.fullViewport[2];this._bindParameters.inverseViewport[1]=1/T.fullViewport[3]};R.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};R.updateHasWater=function(){const U=e.someMap(this._layerRenderers,Z=>Z.hasWater);if(U!==this._hasWater&&(this._hasWater=U,this.onHasWaterChanged))this.onHasWaterChanged(U)};R.updateHasHighlights=function(){const U=e.someMap(this._layerRenderers,Z=>Z.hasHighlights);
if(U!==this._hasHighlights&&(this._hasHighlights=U,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};R.updateRendersOccluded=function(){const U=e.someMap(this._layerRenderers,Z=>Z.rendersOccluded);if(U!==this._rendersOccluded&&(this._rendersOccluded=U,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};R.drawDebugTexture=function(U,Z){const T=this._rctx;this.ensureDebugPatternResources(U,U);U=this._debugTextureTechnique.program;T.useProgram(U);
T.setPipelineState(this._debugTextureTechnique.pipeline);U.setUniform4f("color",Z[0],Z[1],Z[2],1);U.bindTexture(this._debugPatternTexture,"tex");T.bindVAO(this._quadVAO);T.drawArrays(5,0,S.vertexCount(this._quadVAO,"geometry"))};R.ensureDebugPatternResources=function(U,Z){if(!this._debugPatternTexture){var T=new Uint8Array(U*Z*4),P=0;for(let X=0;X<Z;X++)for(let aa=0;aa<U;aa++){const ja=Math.floor(aa/10),ia=Math.floor(X/10);2>ja||2>ia||10*ja>U-20||10*ia>Z-20?(T[P++]=255,T[P++]=255,T[P++]=255,T[P++]=
255):(T[P++]=255,T[P++]=255,T[P++]=255,ja&1&&ia&1?T[P++]=aa&1^X&1?0:255:T[P++]=ja&1^ia&1?0:128)}this._debugPatternTexture=new Q(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:U,height:Z},T);U=new K.TextureTechniqueConfiguration;U.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(K.TextureTechnique,U);this._quadVAO=F.createQuadVAO(this._rctx)}};u._createClass(fa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||e.someMap(this._layerRenderers,
U=>U.updating)}},{key:"hasOverlays",get:function(){return n.isSome(this._overlays)&&n.isSome(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return n.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return n.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",
get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);return fa}(B.AutoDisposableMixin(p));f.__decorate([B.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);f.__decorate([B.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);f.__decorate([l.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);f.__decorate([l.property()],a.OverlayRenderer.prototype,"globalUnitScale",
void 0);f.__decorate([l.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);f.__decorate([l.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=f.__decorate([c.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);let Y=function(ha,fa){this.layerView=ha;this.renderer=fa};const W=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],ba=new v;ba.near=1;ba.far=1E4;ba.relativeElevation=null;const ca=A.create(),da=A.create();a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=
4;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec4 ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/localOrigin".split(" "),function(a,u,f,p,t,w){let e=function(){function n(h,k){this.index=h;this.renderTargets=k;this.extent=t.create();this.resolution=0;this.viewport=t.create();this.renderLocalOrigin=w.fromValues(0,0,0,"O");this.pixelRatio=
1;this.canvasGeometries={extents:[t.create(),t.create(),t.create()],numViews:0};this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=h;this.validTargets=Array(k.renderTargets.length).fill(!1)}var b=n.prototype;b.getValidTarget=function(h){return this.validTargets[h]?this.renderTargets.getTarget(h):null};b.getColorTexture=function(h){return(h=1===h?this.renderTargets.getTarget(0):2===h?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4))?
h.getTexture():null};b.getNormalTexture=function(h){return(h=1===h?this.renderTargets.getTarget(3):null)?h.getTexture():null};b.draw=function(h,k){const l=this.computeRenderTargetValidityBitfield(),m=this.needsColorWithoutRasterImage;for(const z of this.renderTargets.renderTargets)this.validTargets[z.type]=1===z.type&&!1===m?!1:h.drawTarget(this,z,k);h=this.computeRenderTargetValidityBitfield();return l^h?0:1};b.computeRenderTargetValidityBitfield=function(){const h=this.validTargets;return+h[0]|
+h[1]<<1|+h[2]<<2|+h[3]<<3|+h[4]<<4};b.setupGeometryViewsCyclical=function(h){this.setupGeometryViewsDirect();var k=.001*h.range;if(this.extent[0]-k<=h.min){const l=this.canvasGeometries.extents[this.canvasGeometries.numViews++];t.offset(this.extent,h.range,0,l)}this.extent[2]+k>=h.max&&(k=this.canvasGeometries.extents[this.canvasGeometries.numViews++],t.offset(this.extent,-h.range,0,k))};b.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;t.set(this.canvasGeometries.extents[0],
this.extent);p.set(this.viewport,0,0,this.resolution,this.resolution)};b.hasSomeSizedView=function(){for(let h=0;h<this.canvasGeometries.numViews;h++){const k=this.canvasGeometries.extents[h];if(k[0]!==k[2]&&k[1]!==k[3])return!0}return!1};b.applyViewport=function(h){const k=this.viewport;0===this.index?h.setViewport(k[0],k[1],k[2],k[3]):h.setViewport(k[0]+this.resolution,k[1],k[2],k[3])};u._createClass(n,[{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&
this.hasTargetWithoutRasterImage}}]);return n}();a.Overlay=e;a.computeOverlayResolution=function(n,b,h){return Math.min(f.nextHighestPowerOfTwo(Math.max(n,b)+256),h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["exports","../../../../chunks/vec3f64"],function(a,u){let f=function(p,t){this.vec3=p;this.id=t};a.LocalOrigin=f;a.fromValues=function(p,t,w,e){return new f(u.fromValues(p,t,w),e)};a.fromVector=function(p,t){return new f(u.clone(p),
t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Program ../../webgl/ProgramCache ../../webgl/Renderbuffer ../../webgl/RenderingContext ../../webgl/ShaderCompiler ../../webgl/Texture ../../webgl/VertexArrayObject".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m){t=function(){function z(c,
d){this.size=p.create();this._fbo=null;this._fbo=new w(c,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:d,maxAnisotropy:8,width:0,height:0})}var r=z.prototype;r.dispose=function(){this._fbo=f.disposeMaybe(this._fbo)};r.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};r.isValid=function(){return null!==this._fbo};r.resize=function(c,d){this.size[0]=c;this.size[1]=d;this._fbo.resize(this.size[0],this.size[1])};
r.bind=function(c){c.bindFramebuffer(this._fbo)};r.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};r.disposeRenderTargetMemory=function(){var c;null==(c=this._fbo)?void 0:c.resize(0,0)};u._createClass(z,[{key:"gpuMemoryUsage",get:function(){var c,d;return null!=(c=null==(d=this._fbo)?void 0:d.gpuMemoryUsage)?c:0}}]);return z}();a.OverlayFramebufferObject=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/FramebufferObject":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./enums ./Renderbuffer ./RenderingContext ./Texture ./Util".split(" "),
function(a,u,f,p,t,w,e){function n(k){return"type"in k&&"texture"===k.type}function b(k,l){void 0!==l.width&&0<=l.width&&void 0!==l.height&&0<=l.height?l.width===k.width&&l.height===k.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(l.width=k.width,l.height=k.height)}const h=u.getLogger("esri.views.webgl.FrameBufferObject");u=function(){function k(m,z,r,c){this._context=m;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;
this._initialized=!1;this._desc={...z};m.instanceCounter.increment(f.ResourceType.Framebuffer,this);if(r)for(Array.isArray(r)||(r=[r]),z=0;z<r.length;++z){var d;const A=r[z];let q;n(A)?(q=A.descriptor,this._colorAttachments.set(36064+z,A)):(q=A,this._colorAttachments.set(36064+z,new w(m,A)));0!==(null==(d=this._desc)?void 0:d.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!");this._validateColorAttachmentPoint(36064+
z);this._validateTextureDimensions(q,this._desc)}if(c instanceof p){var g;m=null!=(g=this._desc.depthStencilTarget)?g:3;2===m?this._stencilAttachment=c:1===m||3===m?this._depthAttachment=c:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');b(c.descriptor,this._desc)}else if(c){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");
let A;n(c)?(this._depthStencilTexture=c,A=c.descriptor):this._depthStencilTexture=new w(this._context,c);this._validateTextureDimensions(A,this._desc)}}var l=k.prototype;l.dispose=function(){if(this._desc){var m=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(m);this._context.instanceCounter.decrement(f.ResourceType.Framebuffer,
this);this._desc=null}};l.getColorTexture=function(m){return(m=this._colorAttachments.get(m))&&n(m)?m:null};l.attachColorTexture=function(m,z=36064){if(m){this._validateColorAttachmentPoint(z);this._validateTextureDimensions(m.descriptor,this._desc);this._disposeColorAttachments();if(this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl;r.framebufferTexture2D(r.FRAMEBUFFER,z,r.TEXTURE_2D,m.glName,0)}this._colorAttachments.set(z,m)}};l.detachColorTexture=function(m=36064){const z=
this._colorAttachments.get(m);if(n(z)){if(this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl;r.framebufferTexture2D(r.FRAMEBUFFER,m,r.TEXTURE_2D,null,0)}this._colorAttachments.delete(m);return z}};l.attachDepthStencilTexture=function(m){if(m){var z=m.descriptor;34041!==z.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==z.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDimensions(z,this._desc);this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),z=this._context.gl,z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.TEXTURE_2D,m.glName,0));this._depthStencilTexture=
m}};l.detachDepthStencilTexture=function(){const m=this._depthStencilTexture;if(m&&this._initialized){this._context.bindFramebuffer(this);const z=this._context.gl;this._context.gl.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return m};l.attachDepthStencilBuffer=function(m){if(m){var z=m.descriptor;34041!==z.internalFormat&&33189!==z.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b(z,this._desc);
this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===z.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),z=this._context.gl,z.framebufferRenderbuffer(z.FRAMEBUFFER,1===this._desc.depthStencilTarget?z.DEPTH_ATTACHMENT:z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,m.glName));this._depthAttachment=m}};l.detachDepthStencilBuffer=function(){const m=this._context.gl,z=this._depthAttachment;z&&this._initialized&&(this._context.bindFramebuffer(this),m.framebufferRenderbuffer(m.FRAMEBUFFER,
1===this._desc.depthStencilTarget?m.DEPTH_ATTACHMENT:m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,null));this._depthAttachment=null;return z};l.detachAll=function(){this.detachColorTexture();this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};l.copyToTexture=function(m,z,r,c,d,g,A){(0>m||0>z||0>d||0>g)&&console.error("Offsets cannot be negative!");(0>=r||0>=c)&&console.error("Copy width and height must be greater than zero!");var q=this._desc;const y=A.descriptor;3553!==A.descriptor.target&&
console.error("Texture target must be TEXTURE_2D!");(m+r>q.width||z+c>q.height||d+r>y.width||g+c>y.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");q=this._context;A=q.bindTexture(A,w.TEXTURE_UNIT_FOR_UPDATES);q.bindFramebuffer(this);q.gl.copyTexSubImage2D(3553,0,d,g,m,z,r,c);q.bindTexture(A,w.TEXTURE_UNIT_FOR_UPDATES)};l.readPixels=function(m,z,r,c,d,g,A){(0>=r||0>=c)&&console.error("Copy width and height must be greater than zero!");
A||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(m,z,r,c,d,g,A)};l.resize=function(m,z){const r=this._desc;if(r.width!==m||r.height!==z)if(this._initialized){r.width=m;r.height=z;this._colorAttachments.forEach(c=>{c&&c.resize(m,z)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(m,z);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(m,z),this._stencilAttachment&&
this._stencilAttachment.resize(m,z);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else r.width=m,r.height=z,this._colorAttachments.forEach(c=>{c&&c.resize(m,z)}),this._depthStencilTexture&&this._depthStencilTexture.resize(m,z)};l.initializeAndBind=function(){var m,z,r,c;const d=this._context.gl;if(this._initialized)d.bindFramebuffer(d.FRAMEBUFFER,this.glName);else{this._glName&&d.deleteFramebuffer(this._glName);var g=this._context,A=d.createFramebuffer(),
q=this._desc,y=null!=(m=q.colorTarget)?m:1;m=null!=(z=q.width)?z:1;z=null!=(r=q.height)?r:1;d.bindFramebuffer(d.FRAMEBUFFER,A);0===this._colorAttachments.size&&(0===y?this._colorAttachments.set(36064,new w(g,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:q.width,height:q.height})):(r=new p(g,{internalFormat:32854,width:m,height:z}),this._colorAttachments.set(36064,r)));this._colorAttachments.forEach((x,D)=>{x&&(n(x)?d.framebufferTexture2D(d.FRAMEBUFFER,D,d.TEXTURE_2D,
x.glName,0):d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.RENDERBUFFER,x.glName))});r=null!=(c=q.depthStencilTarget)?c:0;switch(r){case 1:case 3:this._depthAttachment||(this._depthAttachment=new p(g,{internalFormat:1===q.depthStencilTarget?33189:34041,width:m,height:z}));d.framebufferRenderbuffer(d.FRAMEBUFFER,1===r?d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new p(g,{internalFormat:36168,
width:m,height:z}));d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(g.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new w(g,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:m,height:z})),d.framebufferTexture2D(d.FRAMEBUFFER,
d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,this._depthStencilTexture.glName,0)}t.webglValidateShadersEnabled()&&d.checkFramebufferStatus(d.FRAMEBUFFER)!==d.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=A;this._initialized=!0}};l._disposeColorAttachments=function(){this._colorAttachments.forEach((m,z)=>{if(n(m)){if(this._initialized){this._context.bindFramebuffer(this);var r=this._context.gl;r.framebufferTexture2D(r.FRAMEBUFFER,z,r.TEXTURE_2D,null,0)}m.dispose()}else m instanceof
WebGLRenderbuffer&&(r=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,z,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(m))});this._colorAttachments.clear()};l._disposeDepthStencilAttachments=function(){const m=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),m.framebufferRenderbuffer(m.FRAMEBUFFER,1===this._desc.depthStencilTarget?m.DEPTH_ATTACHMENT:m.DEPTH_STENCIL_ATTACHMENT,
m.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),
this._depthStencilTexture=null)};l._validateTextureDimensions=function(m,z){3553!==m.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==z.width&&0<=z.width&&void 0!==z.height&&0<=z.height?z.width===m.width&&z.height===m.height||console.error("Color attachment texture must match the framebuffer's!"):(z.width=m.width,z.height=m.height)};l._validateColorAttachmentPoint=function(m){if(-1===k._MAX_COLOR_ATTACHMENTS){const z=this._context.capabilities.drawBuffers;k._MAX_COLOR_ATTACHMENTS=
z?this._context.gl.getParameter(z.MAX_COLOR_ATTACHMENTS):1}m-=36064;m+1>k._MAX_COLOR_ATTACHMENTS&&h.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${m+1}. Implementation supports up to ${k._MAX_COLOR_ATTACHMENTS} color attachments`)};a._createClass(k,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const m=this._colorAttachments.get(36064);return m&&n(m)?m:null}},{key:"colorAttachment",
get:function(){return this._colorAttachments.get(36064)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return e.getGpuMemoryUsage(this.colorAttachment)+e.getGpuMemoryUsage(this.depthStencilAttachment)}}]);
return k}();u._MAX_COLOR_ATTACHMENTS=-1;return u})},"esri/views/webgl/Renderbuffer":function(){define(["../../chunks/_rollupPluginBabelHelpers","./enums"],function(a,u){return function(){function f(t,w){this._context=t;this._desc=w;this._context.instanceCounter.increment(u.ResourceType.Renderbuffer,this);t=this._context.gl;this.glName=t.createRenderbuffer();this._context.bindRenderbuffer(this);t.renderbufferStorage(t.RENDERBUFFER,w.internalFormat,w.width,w.height)}var p=f.prototype;p.resize=function(t,
w){const e=this._desc;if(e.width!==t||e.height!==w)e.width=t,e.height=w,t=this._context.gl,this._context.bindRenderbuffer(this),t.renderbufferStorage(t.RENDERBUFFER,e.internalFormat,e.width,e.height)};p.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(u.ResourceType.Renderbuffer,this),this._context=null)};a._createClass(f,[{key:"descriptor",get:function(){return this._desc}}]);return f}()})},"esri/views/webgl/ProgramCache":function(){define(["./programUtils"],
function(a){return function(){function u(p){this._programCacheByTemplate=new Map;this._rctx=p}var f=u.prototype;f.dispose=function(){this._programCacheByTemplate.forEach(p=>p.programs.forEach(t=>t.dispose()));this._programCacheByTemplate=null};f.getProgram=function(p,t){this._programCacheByTemplate.has(p)||this.addProgramTemplate(p,w=>a.createProgram(this._rctx,p,w));return this.getProgramTemplateInstance(p,t)};f.addProgramTemplate=function(p,t){this._programCacheByTemplate.set(p,{constructor:t,programs:new Map})};
f.getProgramTemplateInstance=function(p,t){if(p=this._programCacheByTemplate.get(p)){const w=t?JSON.stringify(t):"default";p.programs.has(w)||(t=p.constructor(t),p.programs.set(w,t));return p.programs.get(w)}return null};return u}()})},"esri/views/webgl/programUtils":function(){define(["exports","./Program"],function(a,u){a.createProgram=function(f,p,t,w){t=t||{};w=w||"";t="function"===typeof p.shaders?p.shaders(t):p.shaders;return new u.Program(f,w+t.vertexShader,w+t.fragmentShader,p.attributes)};
a.glslifyDefineMap=function(f){let p="";for(const t in f){const w=f[t];if("boolean"===typeof w)w&&(p+=`#define ${t}\n`);else if("number"===typeof w)p+=`#define ${t} ${w.toFixed()}\n`;else if("object"===typeof w){const e=w.options;let n=0;for(const b in e)p+=`#define ${e[b]} ${(n++).toFixed()}\n`;p+=`#define ${t} ${e[w.value]}\n`}}return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderCompiler":function(){define(function(){return function(){function a(f){this.readFile=
f}var u=a.prototype;u.resolveIncludes=function(f){return this.resolve(f)};u.resolve=function(f,p=new Map){if(p.has(f))return p.get(f);const t=this.read(f);if(!t)throw Error(`cannot find shader file ${f}`);const w=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let e=w.exec(t);const n=[];for(;null!=e;)n.push({path:e[1],start:e.index,length:e[0].length}),e=w.exec(t);let b=0,h="";n.forEach(k=>{h+=t.slice(b,k.start);h+=p.has(k.path)?"":this.resolve(k.path,p);b=k.start+k.length});h+=t.slice(b);p.set(f,h);return h};
u.read=function(f){return this.readFile(f)};return a}()})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./OverlayFramebufferObject"],function(a,u,f){let p=function(){function t(e){this.renderTargets=null;const n=(b,h,k=!0)=>({type:h,fbo:new f.OverlayFramebufferObject(e,k),renderPass:b,valid:!1,lastUsed:Infinity});this.renderTargets=[n(0,0),n(0,1),n(5,2,!1),n(3,3),n(0,4)]}var w=t.prototype;w.getTarget=function(e){return this.renderTargets[e].fbo};
w.dispose=function(){for(const e of this.renderTargets)e.fbo.dispose()};w.disposeRenderTargetMemory=function(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()};w.validateUsageForTarget=function(e,n,b){if(e)n.lastUsed=b;else if(1E3<b-n.lastUsed)n.fbo.disposeRenderTargetMemory(),n.lastUsed=Infinity;else if(Infinity>n.lastUsed)return!0;return!1};u._createClass(t,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((e,n)=>e+n.fbo.gpuMemoryUsage,0)}}]);return t}();
a.OverlayRenderTarget=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(a,u,f){let p=function(w){this.technique=w;this.refZeroFrame=this.refCount=0},t=function(){function w(n){this._context=n;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}var e=w.prototype;e.dispose=
function(){this._perConstructorInstances.forEach(n=>n.forEach(b=>b.technique.dispose()));this._perConstructorInstances.clear()};e.acquire=function(n,b){const h=b.key;let k=this._perConstructorInstances.get(n);k||(k=new Map,this._perConstructorInstances.set(n,k));let l=k.get(h);if(void 0===l){const m=new n(this._context,b,()=>this.release(m));l=new p(m);k.set(h,l)}++l.refCount;return l.technique};e.releaseAndAcquire=function(n,b,h){if(f.isSome(h)){if(b.key===h.key)return h;h.release()}return this.acquire(n,
b)};e.release=function(n){f.isNone(n)||(n=this._perConstructorInstances.get(n.constructor).get(n.key),--n.refCount,0===n.refCount&&(n.refZeroFrame=this._frameCounter))};e.frameUpdate=function(){this._frameCounter++;this._perConstructorInstances.forEach((n,b)=>{n.forEach((h,k)=>{0===h.refCount&&h.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(h.technique.dispose(),n.delete(k))});0===n.size&&this._perConstructorInstances.delete(b)})};e.hotReload=function(){var n=u._asyncToGenerator(function*(){var b=
this;const h=[];this._perConstructorInstances.forEach((k,l)=>{const m=function(){var z=u._asyncToGenerator(function*(r,c){if(c=c.shader)yield c.reload(),r.forEach(d=>{d.technique.reload(b._context)})});return function(r,c){return z.apply(this,arguments)}}();h.push(m(k,l))});yield Promise.all(h)});return function(){return n.apply(this,arguments)}}();u._createClass(w,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);
return w}();a.ShaderTechniqueRepository=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["../../../../core/Logger","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions","./Util"],function(a,u,f,p){const t=a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let w=function(){function e(b){this.refCnt=0;this.glMaterial=b}var n=e.prototype;n.incRefCnt=function(){++this.refCnt};n.decRefCnt=function(){--this.refCnt;
p.assert(0<=this.refCnt)};n.getRefCnt=function(){return this.refCnt};n.getGLMaterial=function(){return this.glMaterial};return e}();return function(){function e(b,h,k){this._textureRep=b;this._techniqueRep=h;this.onMaterialChanged=k;this._id2glMaterialRef=new Map}var n=e.prototype;n.dispose=function(){this._textureRep.dispose()};n.acquire=function(b,h){this.ownMaterial(b);const k=f.getShaderOutputID(b.id,h);let l=this._id2glMaterialRef.get(k);if(null==l)return b=b.getGLMaterial({material:b,techniqueRep:this._techniqueRep,
textureRep:this._textureRep,output:h}),l=new w(b),l.incRefCnt(),this._id2glMaterialRef.set(k,l),b;l.incRefCnt();return l.getGLMaterial()};n.release=function(b,h){b=f.getShaderOutputID(b.id,h);h=this._id2glMaterialRef.get(b);h.decRefCnt();0===h.getRefCnt()&&((h=h.getGLMaterial())&&h.dispose(),this._id2glMaterialRef.delete(b))};n.materialChanged=function(b){for(const k of f.ShaderOutputTypes)if(5!==k.output&&6!==k.output){var h=this._id2glMaterialRef.get(f.getShaderOutputID(b.id,k.output));h&&h.getGLMaterial()&&
(h=h.getGLMaterial(),h.updateParameters&&h.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(b)};n.ownMaterial=function(b){u.isSome(b.materialRepository)&&b.materialRepository!==this&&t.error("Material is already owned by a different material repository");b.materialRepository=this};return e}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){const u=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},
{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];a.ShaderOutputTypes=u;a.getShaderOutputID=function(f,p){return f+"_"+u.find(t=>t.output===p).name};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./Geometry ./localOrigin ./Object3D ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){let m=0,z=function(){function d(A){this._originSR=A;this.ROOT_ORIGIN_ID="rg_root_"+m++;this._origins=new Map;this._gridSize=125E4;this._objects=new Map}var g=d.prototype;g.getOrigin=function(A){const q=this._origins.get(this.ROOT_ORIGIN_ID);if(null==q){if(f.isSome(r))return this._origins.set(this.ROOT_ORIGIN_ID,b.fromValues(r[0],r[1],r[2],this.ROOT_ORIGIN_ID)),this.getOrigin(A);A=b.fromValues(A[0]+Math.random()-.5,A[1]+Math.random()-.5,A[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,A);return A}var y=this._gridSize;const x=Math.round(A[0]/y),D=Math.round(A[1]/y),C=Math.round(A[2]/y),B=`${"rg_"}${x}/${D}/${C}`;let v=this._origins.get(B);const E=.5*y;t.subtract(c,A,q.vec3);c[0]=Math.abs(c[0]);c[1]=Math.abs(c[1]);c[2]=Math.abs(c[2]);if(c[0]<E&&c[1]<E&&c[2]<E)return v&&(y=Math.max(...c),t.subtract(c,A,v.vec3),c[0]=Math.abs(c[0]),c[1]=Math.abs(c[1]),c[2]=Math.abs(c[2]),Math.max(...c)<y)?v:q;v||(v=b.fromValues(x*y,D*y,C*y,B),this._origins.set(B,
v));return v};g._drawOriginBox=function(A,q=[1,1,0,1]){const y=window.view,x=y._stage;var D=q.toString();if(!this._objects.has(D)){this._material=new l.RibbonLineMaterial({width:2,color:q});x.add(this._material);q=new k.WebGLLayer({isPickable:!1});var C=new h.Object3D({castShadow:!1});x.add(C);q.add(C);x.add(q);this._objects.set(D,C)}D=this._objects.get(D);q=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];C=q.length;const B=Array(3*C),v=new Uint16Array(2*(C-1)),E=.5*this._gridSize;for(let F=0;F<C;F++)B[3*
F]=A[0]+(q[F]&1?E:-E),B[3*F+1]=A[1]+(q[F]&2?E:-E),B[3*F+2]=A[2]+(q[F]&4?E:-E),0<F&&(v[2*F]=F-1,v[2*F+1]=F);e.projectBuffer(B,this._originSR,0,B,y.renderSpatialReference,0,C);A=new n.Geometry([["position",{size:3,data:B,exclusive:!0}]],[["position",v]],2);x.add(A);D.addGeometry(A,this._material,p.IDENTITY)};u._createClass(d,[{key:"test",get:function(){const A=this;return{get gridSize(){return A._gridSize},set gridSize(q){A._gridSize=q}}}}]);return d}(),r=null;const c=w.create();a.GridLocalOriginFactory=
z;a.setTestRootOrigin=function(d){r=d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./DirtyEvents ./Octree".split(" "),function(a,u,f,p,t,w,e,n,b){e=function(h){function k(m,z=""){var r,c,d;var g=h.call(this)||this;g.apiLayerUid=z;g.type=0;g.events=new f;g.isSliceable=
!1;g._objects=new w;g._stageHandles=new p;g.apiLayerUid=z;g.isVisible=null!=(r=null==m?void 0:m.isVisible)?r:!0;g.isPickable=null!=(c=null==m?void 0:m.isPickable)?c:!0;g.updatePolicy=null!=(d=null==m?void 0:m.updatePolicy)?d:0;return g}u._inheritsLoose(k,h);var l=k.prototype;l.destroy=function(){this.detachStage();this._stage=null};l.attachStage=function(m){this.detachStage();this._stage=m;for(const z of n.DirtyEventNames)this._stageHandles.add(this.events.on(z,r=>m.handleEvent(z,r)))};l.detachStage=
function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};l.add=function(m){this._objects.push(m);m.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:m});t.isSome(this._octree)&&this._octree.add([m])};l.remove=function(m){this._objects.removeUnordered(m)&&(m.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:m}),t.isSome(this._octree)&&this._octree.remove([m]))};l.addMany=function(m){this._objects.pushArray(m);for(const z of m)z.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:m});t.isSome(this._octree)&&this._octree.add(m)};l.removeMany=function(m){const z=[];this._objects.removeUnorderedMany(m,m.length,z);if(0!==z.length){for(const r of z)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:z});t.isSome(this._octree)&&this._octree.remove(z)}};l.sync=function(){t.isSome(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)};l.notifyObjectBBChanged=function(m,z){t.isSome(this._octree)&&
this._octree.update(m,z)};l.getSpatialQueryAccelerator=function(){t.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};l.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};l.invalidateSpatialQueryAccelerator=function(){this._octree=t.destroyMaybe(this._octree)};l._createOctree=function(){this._octree=new b(m=>m.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,
this._objects.length)};u._createClass(k,[{key:"objects",get:function(){return this._objects}}]);return k}(e.ContentObject);a.WebGLLayer=e;a.isWebGLLayer=function(h){return t.isSome(h)&&0===h.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,u,f,p,t,w,e,n,b,h){function k(J,M,O){O[0]=J[0]+M;O[1]=J[1]+M;O[2]=J[2]+M}function l(J,M,
O,Q){if(1===M)J=O(J[0]),b.copy(J,Q);else{B[0]=Infinity;B[1]=Infinity;B[2]=Infinity;v[0]=-Infinity;v[1]=-Infinity;v[2]=-Infinity;for(let W=0;W<M;W++){var S=O(J[W]);if(c(S[3])){var V=B,Y=S;V[0]=Math.min(V[0],Y[0]-Y[3]);V[1]=Math.min(V[1],Y[1]-Y[3]);V[2]=Math.min(V[2],Y[2]-Y[3]);V=v;V[0]=Math.max(V[0],S[0]+S[3]);V[1]=Math.max(V[1],S[1]+S[3]);V[2]=Math.max(V[2],S[2]+S[3])}}t.lerp(Q,B,v,.5);Q[3]=Math.max(v[0]-B[0],v[1]-B[1],v[2]-B[2])/2}}function m(J,M,O){if(!K.length)for(var Q=0;8>Q;++Q)K.push({index:0,
distance:0});for(Q=0;8>Q;++Q){const S=A[Q];K.data[Q].index=Q;K.data[Q].distance=r(J,M,S)}K.sort((S,V)=>S.distance-V.distance);for(J=0;8>J;++J)O[J]=K.data[J].index}function z(J,M){let O=Infinity,Q=null;for(let S=0;8>S;++S){const V=r(J,M,q[S]);V<O&&(O=V,Q=q[S])}return Q}function r(J,M,O){return M*(J[0]*O[0]+J[1]*O[1]+J[2]*O[2])}function c(J){return!isNaN(J)&&-Infinity!==J&&Infinity!==J&&0<J}let d=function(){function J(O,Q){this._objectToBoundingSphere=O;this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._root=new g;this._objectCount=0;Q&&(void 0!==Q.maximumObjectsPerNode&&(this._maximumObjectsPerNode=Q.maximumObjectsPerNode),void 0!==Q.maximumDepth&&(this._maximumDepth=Q.maximumDepth))}var M=J.prototype;M.destroy=function(){this._degenerateObjects.clear();g.clearPool();x[0]=null;E.prune();K.prune()};M.add=function(O,Q=O.length){this._objectCount+=Q;this._grow(O,Q);const S=g.acquire();for(let V=0;V<Q;V++){const Y=O[V];this._isDegenerate(Y)?this._degenerateObjects.add(Y):
(S.init(this._root),this._add(Y,S))}g.release(S)};M.remove=function(O,Q=null){this._objectCount-=O.length;const S=g.acquire();for(const V of O)O=u.isSome(Q)?Q:b.copy(this._objectToBoundingSphere(V),F),c(O[3])?(S.init(this._root),this._remove(V,O,S)):this._degenerateObjects.delete(V);g.release(S);this._shrink()};M.update=function(O,Q){if(c(Q[3])||!this._isDegenerate(O))x[0]=O,O=x,this.remove(O,Q),this.add(O)};M.forEachAlongRay=function(O,Q,S){const V=n.wrap(O,Q);this._forEachNode(this._root,Y=>{if(!this._intersectsNode(V,
Y))return!1;Y=Y.node;Y.terminals.forAll(W=>{this._intersectsObject(V,W)&&S(W)});null!==Y.residents&&Y.residents.forAll(W=>{this._intersectsObject(V,W)&&S(W)});return!0})};M.forEachAlongRayWithVerticalOffset=function(O,Q,S,V){const Y=n.wrap(O,Q);this._forEachNode(this._root,W=>{if(!this._intersectsNodeWithOffset(Y,W,V))return!1;W=W.node;W.terminals.forAll(ba=>{this._intersectsObjectWithOffset(Y,ba,V)&&S(ba)});null!==W.residents&&W.residents.forAll(ba=>{this._intersectsObjectWithOffset(Y,ba,V)&&S(ba)});
return!0})};M.forEach=function(O){this._forEachNode(this._root,Q=>{Q=Q.node;Q.terminals.forAll(O);null!==Q.residents&&Q.residents.forAll(O);return!0});this._degenerateObjects.forEach(O)};M.forEachDegenerateObject=function(O){this._degenerateObjects.forEach(O)};M.findClosest=function(O,Q,S,V=()=>!0,Y=Infinity){let W=Infinity,ba=Infinity,ca=null;const da=z(O,Q),ha=fa=>{--Y;if(V(fa)){var R=this._objectToBoundingSphere(fa);if(e.intersectsSphere(S,R)){var U=r(O,Q,b.getCenter(R)),Z=U-R[3];R=U+R[3];Z<W&&
(W=Z,ba=R,ca=fa)}}};this._forEachNodeDepthOrdered(this._root,fa=>{if(0>=Y||!e.intersectsSphere(S,fa.bounds))return!1;t.scale(C,da,fa.halfSize);t.add(C,C,fa.bounds);if(r(O,Q,C)>ba)return!1;fa=fa.node;fa.terminals.forAll(R=>ha(R));null!==fa.residents&&fa.residents.forAll(R=>ha(R));return!0},O,Q);return ca};M.forEachInDepthRange=function(O,Q,S,V,Y,W,ba){let ca=-Infinity,da=Infinity;const ha={setRange:T=>{1===S?(ca=Math.max(ca,T.near),da=Math.min(da,T.far)):(ca=Math.max(ca,-T.far),da=Math.min(da,-T.near))}};
ha.setRange(V);const fa=r(Q,S,O),R=z(Q,S),U=z(Q,-1*S),Z=T=>{if(ba(T)){var P=this._objectToBoundingSphere(T),X=b.getCenter(P);X=r(Q,S,X)-fa;var aa=X+P[3];X-P[3]>da||aa<ca||!e.intersectsSphere(W,P)||Y(T,ha)}};this._forEachNodeDepthOrdered(this._root,T=>{if(!e.intersectsSphere(W,T.bounds))return!1;t.scale(C,R,T.halfSize);t.add(C,C,T.bounds);if(r(Q,S,C)-fa>da)return!1;t.scale(C,U,T.halfSize);t.add(C,C,T.bounds);if(r(Q,S,C)-fa<ca)return!1;T=T.node;T.terminals.forAll(P=>Z(P));null!==T.residents&&T.residents.forAll(P=>
Z(P));return!0},Q,S)};M.forEachNode=function(O){this._forEachNode(this._root,Q=>O(Q.node,Q.bounds,Q.halfSize))};M._intersectsNode=function(O,Q){k(Q.bounds,2*-Q.halfSize,B);k(Q.bounds,2*Q.halfSize,v);return h.rayBoxTest(O.origin,O.direction,B,v)};M._intersectsNodeWithOffset=function(O,Q,S){k(Q.bounds,2*-Q.halfSize,B);k(Q.bounds,2*Q.halfSize,v);S.applyToMinMax(B,v);return h.rayBoxTest(O.origin,O.direction,B,v)};M._intersectsObject=function(O,Q){Q=this._objectToBoundingSphere(Q);return 0<Q[3]?b.intersectsRay(Q,
O):!0};M._intersectsObjectWithOffset=function(O,Q,S){Q=this._objectToBoundingSphere(Q);return 0<Q[3]?b.intersectsRay(S.applyToBoundingSphere(Q),O):!0};M._forEachNode=function(O,Q){O=g.acquire().init(O);const S=[O];for(;0!==S.length;){O=S.pop();if(Q(O)&&!O.isLeaf())for(let V=0;V<O.node.children.length;V++)O.node.children[V]&&S.push(g.acquire().init(O).advance(V));g.release(O)}};M._forEachNodeDepthOrdered=function(O,Q,S,V=1){O=g.acquire().init(O);const Y=[O];for(m(S,V,H);0!==Y.length;){O=Y.pop();if(Q(O)&&
!O.isLeaf())for(S=7;0<=S;--S)V=H[S],O.node.children[V]&&Y.push(g.acquire().init(O).advance(V));g.release(O)}};M._remove=function(O,Q,S){E.clear();Q=S.advanceTo(Q,(V,Y)=>{E.push(V.node);E.push(Y)})?S.node.terminals:S.node.residents;Q.removeUnordered(O);if(0===Q.length)for(O=E.length-2;0<=O&&this._purge(E.data[O],E.data[O+1]);O-=2);};M._nodeIsEmpty=function(O){if(0!==O.terminals.length)return!1;if(null!==O.residents)return 0===O.residents.length;for(let Q=0;Q<O.children.length;Q++)if(O.children[Q])return!1;
return!0};M._purge=function(O,Q){0<=Q&&(O.children[Q]=null);return this._nodeIsEmpty(O)?(null===O.residents&&(O.residents=new p({shrink:!0})),!0):!1};M._add=function(O,Q){Q.advanceTo(this._objectToBoundingSphere(O))?Q.node.terminals.push(O):(Q.node.residents.push(O),Q.node.residents.length>this._maximumObjectsPerNode&&Q.depth<this._maximumDepth&&this._split(Q))};M._split=function(O){const Q=O.node.residents;O.node.residents=null;for(let S=0;S<Q.length;S++){const V=g.acquire().init(O);this._add(Q.getItemAt(S),
V);g.release(V)}};M._grow=function(O,Q){0!==Q&&(l(O,Q,S=>this._objectToBoundingSphere(S),L),c(L[3])&&!this._fitsInsideTree(L)&&(this._nodeIsEmpty(this._root.node)?(b.copy(L,this._root.bounds),this._root.halfSize=1.25*L[3]):(O=this._rootBoundsForRootAsSubNode(L),this._placingRootViolatesMaxDepth(O)?this._rebuildTree(L,O):this._growRootAsSubNode(O),g.release(O))))};M._rebuildTree=function(O,Q){t.copy(N,Q.bounds);N[3]=Q.halfSize;l([O,N],2,S=>S,I);O=g.acquire().init(this._root);this._root.initFrom(null,
I,1.25*I[3]);this._forEachNode(O,S=>{this.add(S.node.terminals.data,S.node.terminals.length);null!==S.node.residents&&this.add(S.node.residents.data,S.node.residents.length);return!0});g.release(O)};M._placingRootViolatesMaxDepth=function(O){const Q=Math.log(O.halfSize/this._root.halfSize)*Math.LOG2E;let S=0;this._forEachNode(this._root,V=>{S=Math.max(S,V.depth);return S+Q<=this._maximumDepth});return S+Q>this._maximumDepth};M._rootBoundsForRootAsSubNode=function(O){var Q=O[3];let S=-Infinity;const V=
this._root.bounds,Y=this._root.halfSize;for(var W=0;3>W;W++){var ba=Math.max(0,Math.ceil((V[W]-Y-(O[W]-Q))/(2*Y)));const ca=Math.max(0,Math.ceil((O[W]+Q-(V[W]+Y))/(2*Y)))+1;S=Math.max(S,2**Math.ceil(Math.log(ba+ca)*Math.LOG2E));G[W].min=ba;G[W].max=ca}for(O=0;3>O;O++)Q=G[O].min,W=G[O].max,ba=(S-(Q+W))/2,Q+=Math.ceil(ba),W+=Math.floor(ba),D[O]=V[O]-Y-Q*Y*2+(W+Q)*Y;D[3]=S*Y*y;return g.acquire().initFrom(null,D,S*Y,0)};M._growRootAsSubNode=function(O){const Q=this._root.node;t.copy(L,this._root.bounds);
L[3]=this._root.halfSize;this._root.init(O);O.advanceTo(L,null,!0);O.node.children=Q.children;O.node.residents=Q.residents;O.node.terminals=Q.terminals};M._shrink=function(){for(;;){const O=this._findShrinkIndex();if(-1===O)break;this._root.advance(O);this._root.depth=0}};M._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let O=null;const Q=this._root.node.children;let S=0,V=0;for(;V<Q.length&&null==O;)S=V++,O=Q[S];for(;V<Q.length;)if(Q[V++])return-1;
return S};M._isDegenerate=function(O){O=this._objectToBoundingSphere(O)[3];return!c(O)};M._fitsInsideTree=function(O){const Q=this._root.bounds,S=this._root.halfSize;return O[3]<=S&&O[0]>=Q[0]-S&&O[0]<=Q[0]+S&&O[1]>=Q[1]-S&&O[1]<=Q[1]+S&&O[2]>=Q[2]-S&&O[2]<=Q[2]+S};a._createClass(J,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},
{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return J}(),g=function(){function J(){this.bounds=b.create();this.halfSize=0;this.initFrom(null,null,0,0)}var M=J.prototype;M.init=function(O){return this.initFrom(O.node,O.bounds,O.halfSize,O.depth)};M.initFrom=function(O,Q,S,V=this.depth){this.node=u.isSome(O)?O:J.createEmptyNode();u.isSome(Q)&&b.copy(Q,this.bounds);this.halfSize=S;this.depth=V;return this};M.advance=function(O){let Q=
this.node.children[O];Q||(Q=J.createEmptyNode(),this.node.children[O]=Q);this.node=Q;this.halfSize/=2;this.depth++;O=A[O];this.bounds[0]+=O[0]*this.halfSize;this.bounds[1]+=O[1]*this.halfSize;this.bounds[2]+=O[2]*this.halfSize;this.bounds[3]=this.halfSize*y;return this};M.advanceTo=function(O,Q,S=!1){for(;;){if(this.isTerminalFor(O))return Q&&Q(this,-1),!0;if(this.isLeaf()){if(!S)return Q&&Q(this,-1),!1;this.node.residents=null}const V=this._childIndex(O);Q&&Q(this,V);this.advance(V)}};M.isLeaf=function(){return null!=
this.node.residents};M.isTerminalFor=function(O){return O[3]>this.halfSize/2};M._childIndex=function(O){const Q=this.bounds;return(Q[0]<O[0]?1:0)+(Q[1]<O[1]?2:0)+(Q[2]<O[2]?4:0)};J.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new p({shrink:!0}),residents:new p({shrink:!0})}};J.acquire=function(){return J._pool.acquire()};J.release=function(O){J._pool.release(O)};J.clearPool=function(){J._pool.prune()};return J}();g._pool=new f(g);const A=[w.fromValues(-1,
-1,-1),w.fromValues(1,-1,-1),w.fromValues(-1,1,-1),w.fromValues(1,1,-1),w.fromValues(-1,-1,1),w.fromValues(1,-1,1),w.fromValues(-1,1,1),w.fromValues(1,1,1)],q=[w.fromValues(-1,-1,-1),w.fromValues(-1,-1,1),w.fromValues(-1,1,-1),w.fromValues(-1,1,1),w.fromValues(1,-1,-1),w.fromValues(1,-1,1),w.fromValues(1,1,-1),w.fromValues(1,1,1)],y=Math.sqrt(3),x=[null],D=b.create(),C=w.create(),B=w.create(),v=w.create(),E=new p,F=b.create(),L=b.create(),N=b.create(),I=b.create(),G=[{min:0,max:0},{min:0,max:0},{min:0,
max:0}],K=new p,H=[0,0,0,0,0,0,0,0];return d})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./renderers/utils ../shaders/RibbonLineTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A){function q(ha,fa,R,U,Z){for(let T=0;T<Z;T++)R[U++]=ha[fa++];return U}function y(ha,fa,R){fa=fa.get("position").data;R=R?R.get("position"):null;return ha.isClosed?R?2<R.length:6<fa.length:!1}const x=f.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");f=function(ha){function fa(U){U=ha.call(this,U,C)||this;U._vertexAttributeLocations=A.ribbonVertexAttributeLocations;U.techniqueConfig=new A.RibbonLineTechniqueConfiguration;U.layout=U.createLayout();
return U}u._inheritsLoose(fa,ha);var R=fa.prototype;R.isClosed=function(U,Z){return this.params.isClosed?Z?2<Z.length:6<U.length:!1};R.dispose=function(){};R.getPassParameters=function(){return this.params};R.getTechniqueConfig=function(U,Z){this.techniqueConfig.output=U;U=t.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=U;this.techniqueConfig.stippleIntegerRepeatsEnabled=U&&this.params.stippleIntegerRepeats;this.techniqueConfig.stippleOffColorEnabled=U&&t.isSome(this.params.stippleOffColor);
this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=
this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&t.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=0<this.params.falloff;this.techniqueConfig.occluder=8===this.params.renderOccluded;this.techniqueConfig.transparencyPassType=Z?Z.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=Z?Z.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=Z?Z.cullAboveGround:
!1;return this.techniqueConfig};R.intersect=function(U,Z,T,P,X,aa,ja,ia,ka){ka?this.intersectDrapedLineGeometry(U,P,aa,ja):this.intersectLineGeometry(U,Z,T,P,this.params.width,ja)};R.intersectDrapedLineGeometry=function(U,Z,T,P){if(Z.options.selectionMode){Z=U.vertexAttributes.get("position").data;var X=U.vertexAttributes.get("size"),aa=this.params.width;this.params.vvSizeEnabled?(X=U.vertexAttributes.get("sizeFeatureAttribute").data[0],aa*=p.clamp(this.params.vvSizeOffset[0]+X*this.params.vvSizeFactor[0],
this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):X&&(aa*=X.data[0]);X=T[0];T=T[1];U=(aa/2+4)*U.screenToWorldRatio;aa=Number.MAX_VALUE;for(let ta=0;ta<Z.length-5;ta+=3){var ja=Z[ta],ia=Z[ta+1],ka=X-ja,na=T-ia;ja=Z[ta+3]-ja;ia=Z[ta+4]-ia;const pa=p.clamp((ja*ka+ia*na)/(ja*ja+ia*ia),0,1);ka=ja*pa-ka;na=ia*pa-na;na=ka*ka+na*na;na<aa&&(aa=na)}aa<U*U&&P()}};R.intersectLineGeometry=function(U,Z,T,P,X,aa){if(P.options.selectionMode&&!g.isInstanceHidden(Z))if(c.isTranslationMatrix(T)){var ja=U.vertexAttributes;
Z=ja.get("position").data;if(this.params.vvSizeEnabled){var ia=ja.get("sizeFeatureAttribute").data[0];X*=p.clamp(this.params.vvSizeOffset[0]+ia*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else ja.has("size")&&(X*=ja.get("size").data[0]);ia=P.camera;var ka=N;e.copy(ka,P.point);X=X*ia.pixelRatio/2+4*ia.pixelRatio;n.set(V[0],ka[0]-X,ka[1]+X,0);n.set(V[1],ka[0]+X,ka[1]+X,0);n.set(V[2],ka[0]+X,ka[1]-X,0);n.set(V[3],ka[0]-X,ka[1]-X,0);for(var na=0;4>na;na++)if(!ia.unprojectFromRenderScreen(V[na],
Y[na]))return;k.fromPoints(ia.eye,Y[0],Y[1],W);k.fromPoints(ia.eye,Y[1],Y[2],ba);k.fromPoints(ia.eye,Y[2],Y[3],ca);k.fromPoints(ia.eye,Y[3],Y[0],da);na=Number.MAX_VALUE;U=y(this.params,ja,U.indices)?Z.length-2:Z.length-5;for(ja=0;ja<U;ja+=3){v[0]=Z[ja]+T[12];v[1]=Z[ja+1]+T[13];v[2]=Z[ja+2]+T[14];var ta=(ja+3)%Z.length;E[0]=Z[ta]+T[12];E[1]=Z[ta+1]+T[13];E[2]=Z[ta+2]+T[14];if(!(0>k.signedDistance(W,v)&&0>k.signedDistance(W,E)||0>k.signedDistance(ba,v)&&0>k.signedDistance(ba,E)||0>k.signedDistance(ca,
v)&&0>k.signedDistance(ca,E)||0>k.signedDistance(da,v)&&0>k.signedDistance(da,E))){ia.projectToRenderScreen(v,I);ia.projectToRenderScreen(E,G);if(0>I[2]&&0<G[2])n.subtract(F,v,E),ta=ia.frustum,ta=-k.signedDistance(ta[4],v)/n.dot(F,k.normal(ta[4])),n.scale(F,F,ta),n.add(v,v,F),ia.projectToRenderScreen(v,I);else if(0<I[2]&&0>G[2])n.subtract(F,E,v),ta=ia.frustum,ta=-k.signedDistance(ta[4],E)/n.dot(F,k.normal(ta[4])),n.scale(F,F,ta),n.add(E,E,F),ia.projectToRenderScreen(E,G);else if(0>I[2]&&0>G[2])continue;
I[2]=0;G[2]=0;ta=h.distance2(h.fromPoints(I,G,J),ka);ta<na&&(na=ta,n.copy(K,v),n.copy(H,E))}}T=P.rayBeginPoint;P=P.rayEndPoint;na<X*X&&(Z=Number.MAX_VALUE,h.closestLineSegmentPoint(h.fromPoints(K,H,J),h.fromPoints(T,P,M),L)&&(n.subtract(L,L,T),Z=n.length(L),n.scale(L,L,1/Z),Z/=n.distance(T,P)),aa(Z,L))}else x.error("intersection assumes a translation-only matrix")};R.computeAttachmentOrigin=function(U,Z){const T=U.vertexAttributes;if(!T)return null;U=U.indices;const P=T.get("position");return m.computeAttachmentOriginLines(P,
U?U.get("position"):null,U&&y(this.params,T,U),Z)};R.createLayout=function(){const U=l.newLayout().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");this.params.vvSizeEnabled?U.f32("sizeFeatureAttribute"):U.f32("size");this.params.vvColorEnabled?U.f32("colorFeatureAttribute"):U.vec4f("color");this.params.vvOpacityEnabled&&U.f32("opacityFeatureAttribute");return U};R.createBufferWriter=function(){return new B(this.layout,this.params)};R.getGLMaterial=function(U){return 0===
U.output||7===U.output||4===U.output||1===U.output?new D(U):void 0};R.validateParameterValues=function(U){"miter"!==U.join&&(U.miterLimit=0);this.requiresTransparent(U)&&(U.transparent=!0)};R.requiresTransparent=function(U){return!!(1>(U.color&&U.color[3])||0<U.innerWidth&&this.colorRequiresTransparent(U.innerColor)||U.stipplePattern&&this.colorRequiresTransparent(U.stippleOffColor)||0<U.falloff)};R.colorRequiresTransparent=function(U){return t.isSome(U)&&1>U[3]&&0<U[3]};return fa}(r.Material);let D=
function(ha){function fa(U){U=ha.call(this,U)||this;U.updateParameters();return U}u._inheritsLoose(fa,ha);var R=fa.prototype;R.updateParameters=function(U){this._technique=this._techniqueRep.releaseAndAcquire(A.RibbonLineTechnique,this._material.getTechniqueConfig(this._output,U),this._technique)};R.beginSlot=function(U){return this._technique.configuration.occluder?3===U||10===U||11===U:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,U===this.targetSlot):
3===U};R._updateOccludeeState=function(U){U.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:U.hasOccludees})};R.ensureParameters=function(U){0!==this._output&&7!==this._output||this._updateOccludeeState(U);this.updateParameters(U)};R.bind=function(U){this._technique.bindPass(this._material.getPassParameters(),U)};R.getPipelineState=function(U,Z){return this._technique.getPipelineState(U,Z)};return fa}(z);const C={width:0,color:[1,1,1,1],join:"miter",
cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...r.materialParametersDefaults,...d.Default};let B=function(){function ha(R,U){this.params=U;this.numJoinSubdivisions=0;this.vertexBufferLayout=R;switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=U.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=
1}}var fa=ha.prototype;fa.isClosed=function(R){return y(this.params,R.vertexAttributes,R.indices)};fa.numCapSubdivisions=function(R){if(this.isClosed(R))return 0;switch(this.params.cap){case "butt":return 0;case "square":return 1;case "round":return 3}};fa.allocate=function(R){return this.vertexBufferLayout.createBuffer(R)};fa.elementCount=function(R){var U=2*this.numCapSubdivisions(R)+2,Z=R.indices.get("position").length/2+1;const T=this.isClosed(R);U=T?2:2*U;var P=T?0:1;Z=T?Z:Z-1;if(R.vertexAttributes.has("subdivisions"))for(R=
R.vertexAttributes.get("subdivisions").data;P<Z;++P)U+=4+2*R[P];else U+=(Z-P)*(2*this.numJoinSubdivisions+4);return U+2};fa.write=function(R,U,Z,T){const P=O,X=Q,aa=S;var ja=U.vertexAttributes.get("position").data,ia=U.indices&&U.indices.get("position");const ka=this.numCapSubdivisions(U);ia&&ia.length!==2*(ja.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");ia=null;U.vertexAttributes.has("subdivisions")&&(ia=U.vertexAttributes.get("subdivisions").data);let na=1,ta=0;this.params.vvSizeEnabled?
ta=U.vertexAttributes.get("sizeFeatureAttribute").data[0]:U.vertexAttributes.has("size")&&(na=U.vertexAttributes.get("size").data[0]);let pa=[1,1,1,1],xa=0;this.params.vvColorEnabled?xa=U.vertexAttributes.get("colorFeatureAttribute").data[0]:U.vertexAttributes.has("color")&&(pa=U.vertexAttributes.get("color").data);let Da=0;this.params.vvOpacityEnabled&&(Da=U.vertexAttributes.get("opacityFeatureAttribute").data[0]);const Ka=ja.length/3;R=R.transformation;const Fa=new Float32Array(Z.buffer);Z=this.vertexBufferLayout.stride/
4;let Ha=T*Z;T=Ha;const ua=(ma,ya,Ma,Ra,ea,Ua,Qa)=>{Fa[Ha++]=ya[0];Fa[Ha++]=ya[1];Fa[Ha++]=ya[2];Fa[Ha++]=Ra;Fa[Ha++]=ea;Fa[Ha++]=Ua;Fa[Ha++]=ma[0];Fa[Ha++]=ma[1];Fa[Ha++]=ma[2];Fa[Ha++]=Ma[0];Fa[Ha++]=Ma[1];Fa[Ha++]=Ma[2];this.params.vvSizeEnabled?Fa[Ha++]=ta:Fa[Ha++]=na;this.params.vvColorEnabled?Fa[Ha++]=xa:(ma=Math.min(4*Qa,pa.length-4),Fa[Ha++]=pa[ma+0],Fa[Ha++]=pa[ma+1],Fa[Ha++]=pa[ma+2],Fa[Ha++]=pa[ma+3]);this.params.vvOpacityEnabled&&(Fa[Ha++]=Da)};Ha+=Z;n.set(X,ja[0],ja[1],ja[2]);R&&n.transformMat4(X,
X,R);if(U=this.isClosed(U)){var Ba=ja.length-3;n.set(P,ja[Ba],ja[Ba+1],ja[Ba+2]);R&&n.transformMat4(P,P,R)}else{n.copy(P,X);n.set(aa,ja[3],ja[4],ja[5]);R&&n.transformMat4(aa,aa,R);for(Ba=0;Ba<ka;++Ba){var Ea=1-Ba/ka;ua(P,X,aa,Ea,1,-4,0);ua(P,X,aa,Ea,1,4,0)}ua(P,X,aa,0,0,-4,0);ua(P,X,aa,0,0,4,0);n.copy(P,X);n.copy(X,aa)}Ea=U?0:1;for(Ba=U?Ka:Ka-1;Ea<Ba;Ea++){var Ga=(Ea+1)%Ka*3;n.set(aa,ja[Ga+0],ja[Ga+1],ja[Ga+2]);R&&n.transformMat4(aa,aa,R);ua(P,X,aa,0,1,-1,Ea);ua(P,X,aa,0,1,1,Ea);Ga=ia?ia[Ea]:this.numJoinSubdivisions;
for(let ma=0;ma<Ga;++ma){const ya=(ma+1)/(Ga+1);ua(P,X,aa,ya,1,-2,Ea);ua(P,X,aa,ya,1,2,Ea)}ua(P,X,aa,1,0,-2,Ea);ua(P,X,aa,1,0,2,Ea);n.copy(P,X);n.copy(X,aa)}if(U)Ha=q(Fa,T+Z,Fa,Ha,2*Z);else for(ua(P,X,aa,0,1,-5,Ba),ua(P,X,aa,0,1,5,Ba),ja=0;ja<ka;++ja)ia=(ja+1)/ka,ua(P,X,aa,ia,1,-5,Ba),ua(P,X,aa,ia,1,5,Ba);q(Fa,T+Z,Fa,T,Z);Ha=q(Fa,Ha-Z,Fa,Ha,Z)};return ha}();const v=b.create(),E=b.create(),F=b.create(),L=b.create(),N=b.create(),I=w.createRenderScreenPointArray3(),G=w.createRenderScreenPointArray3(),
K=b.create(),H=b.create(),J=h.create(),M=h.create(),O=b.create(),Q=b.create(),S=b.create(),V=[w.createRenderScreenPointArray3(),w.createRenderScreenPointArray3(),w.createRenderScreenPointArray3(),w.createRenderScreenPointArray3()],Y=[b.create(),b.create(),b.create(),b.create()],W=k.create(),ba=k.create(),ca=k.create(),da=k.create();a.RibbonLineMaterial=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["../../../../chunks/mat3f64",
"../../../../chunks/vec3f32"],function(a,u){var f;(f||(f={})).Default={vvSizeEnabled:!1,vvSizeMinSize:u.fromValues(1,1,1),vvSizeMaxSize:u.fromValues(100,100,100),vvSizeOffset:u.fromValues(0,0,0),vvSizeFactor:u.fromValues(1,1,1),vvSizeValue:u.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,
0],vvSymbolRotationMatrix:a.create()};return f})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/RibbonLine.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){const A=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);l=function(y){function x(C,B,v){B=y.call(this,C,B,v)||this;B.stippleTextureRepository=C.stippleTextureRepository;return B}f._inheritsLoose(x,y);var D=x.prototype;D.initializeProgram=function(C){var B=x.shader.get();const v=this.configuration;B=B.build({OITEnabled:0===
v.transparencyPassType,output:v.output,slicePlaneEnabled:v.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:v.stippleEnabled,stippleOffColorEnabled:v.stippleOffColorEnabled,stippleUVMaxEnabled:v.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:v.stippleIntegerRepeatsEnabled,roundCaps:v.roundCaps,roundJoins:v.roundJoins,vvColor:v.vvColor,vvSize:v.vvSize,vvInstancingEnabled:!0,vvOpacity:v.vvOpacity,falloffEnabled:v.falloffEnabled,innerColorEnabled:v.innerColorEnabled,
multipassTerrainEnabled:v.multipassTerrainEnabled,cullAboveGround:v.cullAboveGround});return new r.Program(C.rctx,B,A)};D.dispose=function(){y.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};D.bindPass=function(C,B){h.bindProjectionMatrix(this.program,B.camera.projectionMatrix);4===this.configuration.output&&e.bindOutputHighlight(this.program,B);B.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
B.inverseViewport),n.bindMultipassTerrainTexture(this.program,B));this.program.setUniform1f("intrinsicWidth",C.width);this.program.setUniform4fv("intrinsicColor",C.color);this.program.setUniform1f("miterLimit","miter"!==C.join?0:C.miterLimit);this.program.setUniform2fv("cameraNearFar",B.camera.nearFar);this.program.setUniform1f("pixelRatio",B.camera.pixelRatio);this.program.setUniform2f("screenSize",B.camera.fullViewport[2],B.camera.fullViewport[3]);b.bindVisualVariablesUniformsWithOpacity(this.program,
C);if(this.stipplePattern!==C.stipplePattern){var v=C.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,v);this.stipplePattern=v}this.configuration.stippleEnabled&&(v=t.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program)*B.camera.pixelRatio:1,this.program.setUniform1f("stipplePatternPixelSizeInv",1/v),this.configuration.stippleOffColorEnabled&&(v=t.unwrap(C.stippleOffColor),this.program.setUniform4f("stippleOffColor",v[0],v[1],v[2],3<v.length?
v[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",C.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",t.unwrapOr(C.innerColor,C.color)),this.program.setUniform1f("innerWidth",C.innerWidth*B.camera.pixelRatio))};D.bindDraw=function(C){h.bindView(this.program,C);w.bindSliceUniformsWithOrigin(this.program,this.configuration,C);this.program.rebindTextures()};D.setPipelineState=function(C,B){const v=this.configuration,E=3===C,F=2===C;
return g.makePipelineState({blending:0===v.output||7===v.output?E?z.blendingDefault:z.OITBlending(C):null,depthTest:{func:z.OITDepthTest(C)},depthWrite:E?!v.transparent&&v.writeDepth&&g.defaultDepthWriteParams:z.OITDepthWrite(C),colorWrite:g.defaultColorWriteParams,stencilWrite:v.sceneHasOcludees?c.stencilWriteMaskOn:null,stencilTest:v.sceneHasOcludees?B?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null,polygonOffset:E||F?v.polygonOffset&&q:z.OITPolygonOffset})};D.initializePipeline=function(){const C=
this.configuration,B=C.polygonOffset&&q;C.occluder&&(this._occluderPipelineTransparent=g.makePipelineState({blending:z.blendingDefault,polygonOffset:B,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:g.defaultColorWriteParams,stencilWrite:null,stencilTest:c.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=g.makePipelineState({blending:z.blendingDefault,polygonOffset:B,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:g.defaultColorWriteParams,stencilWrite:c.stencilWriteMaskOff,
stencilTest:c.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=g.makePipelineState({blending:null,polygonOffset:B,depthTest:c.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:c.stencilWriteMaskOn,stencilTest:c.stencilToolMaskBaseParams}));this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};D.getPipelineState=function(C,B){return B?this._occludeePipelineState:
this.configuration.occluder?11===C?this._occluderPipelineTransparent:10===C?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline};f._createClass(x,[{key:"primitiveType",get:function(){return 5}}]);return x}(l.ShaderTechnique);l.shader=new k.ReloadableShaderModule(d.RibbonLineShader,()=>new Promise(function(y,x){a(["./RibbonLine.glsl"],y,x)}));const q={factor:0,units:-4};k=function(y){function x(){var D=y.apply(this,arguments)||this;D.output=0;D.occluder=!1;D.slicePlaneEnabled=
!1;D.transparent=!1;D.polygonOffset=!1;D.writeDepth=!1;D.stippleEnabled=!1;D.stippleOffColorEnabled=!1;D.stippleIntegerRepeatsEnabled=!1;D.roundCaps=!1;D.roundJoins=!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.falloffEnabled=!1;D.innerColorEnabled=!1;D.sceneHasOcludees=!1;D.transparencyPassType=3;D.multipassTerrainEnabled=!1;D.cullAboveGround=!1;return D}f._inheritsLoose(x,y);return x}(m.ShaderTechniqueConfiguration);p.__decorate([m.parameter({count:8})],k.prototype,"output",void 0);p.__decorate([m.parameter()],
k.prototype,"occluder",void 0);p.__decorate([m.parameter()],k.prototype,"slicePlaneEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"transparent",void 0);p.__decorate([m.parameter()],k.prototype,"polygonOffset",void 0);p.__decorate([m.parameter()],k.prototype,"writeDepth",void 0);p.__decorate([m.parameter()],k.prototype,"stippleEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"stippleOffColorEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"stippleIntegerRepeatsEnabled",
void 0);p.__decorate([m.parameter()],k.prototype,"roundCaps",void 0);p.__decorate([m.parameter()],k.prototype,"roundJoins",void 0);p.__decorate([m.parameter()],k.prototype,"vvSize",void 0);p.__decorate([m.parameter()],k.prototype,"vvColor",void 0);p.__decorate([m.parameter()],k.prototype,"vvOpacity",void 0);p.__decorate([m.parameter()],k.prototype,"falloffEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"innerColorEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"sceneHasOcludees",
void 0);p.__decorate([m.parameter({count:4})],k.prototype,"transparencyPassType",void 0);p.__decorate([m.parameter()],k.prototype,"multipassTerrainEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"cullAboveGround",void 0);u.RibbonLineTechnique=l;u.RibbonLineTechniqueConfiguration=k;u.ribbonVertexAttributeLocations=A;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports"],function(a){a.depthCompareAlways={func:519};a.depthCompareLess=
{func:513};a.renderWhenBitIsNotSet=u=>({function:{func:517,ref:u,mask:u},operation:{fail:7680,zFail:7680,zPass:7680}});a.replaceBitWhenDepthTestPasses=u=>({function:{func:519,ref:u,mask:u},operation:{fail:7680,zFail:7680,zPass:7681}});a.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};a.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};a.stencilToolMaskOccluderParams={function:{func:514,ref:2,
mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){function m(r){const c=new l.ShaderBuilder;c.extensions.add("GL_OES_standard_derivatives");c.include(n.PiUtils);c.include(f.RibbonVertexPosition,r);c.include(w.LineStipple,r);1===r.output&&c.include(p.OutputDepth,r);c.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");c.attributes.add("position","vec3");c.attributes.add("subdivisionFactor","float");c.attributes.add("uv0",
"vec2");c.attributes.add("auxpos1","vec3");c.attributes.add("auxpos2","vec3");c.varyings.add("vColor","vec4");c.varyings.add("vpos","vec3");c.varyings.add("linearDepth","float");r.multipassTerrainEnabled&&c.varyings.add("depth","float");const d=r.falloffEnabled,g=r.innerColorEnabled;g&&c.varyings.add("vLineDistance","float");d&&c.varyings.add("vLineDistanceNorm","float");r.falloffEnabled&&c.fragment.uniforms.add("falloff","float");r.innerColorEnabled&&(c.fragment.uniforms.add("innerColor","vec4"),
c.fragment.uniforms.add("innerWidth","float"));c.vertex.code.add(k.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);c.vertex.code.add(k.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);c.vertex.code.add(k.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${r.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`);c.vertex.code.add(k.glsl`void main(void) {
float coverage = 1.0;
vpos = position;
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
bool isJoin = abs(uv0.y)-3.0 < 0.0;
float lineWidth = getSize() * pixelRatio;
if (lineWidth < 1.0) {
coverage = lineWidth;
lineWidth = 1.0;
}else{
lineWidth = floor(lineWidth + 0.5);
}
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
vec4 next = view * vec4(auxpos2.xyz, 1.0);
clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);r.stippleEnabled&&c.vertex.code.add(k.glsl`vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;
vec2 stippleSegmentDirection = stippleSegmentInfo.zw;`);c.vertex.code.add(k.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = ISOUTSIDE;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);r.roundJoins?c.vertex.code.add(k.glsl`vec2 startDir;
vec2 endDir;
if (leftLen < 0.001) {
startDir = right;
}
else{
startDir = left;
}
startDir = normalize(startDir);
startDir = PERPENDICULAR(startDir);
if (rightLen < 0.001) {
endDir = left;
}
else{
endDir = right;
}
endDir = normalize(endDir);
endDir = PERPENDICULAR(endDir);
float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);`):c.vertex.code.add(k.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);c.vertex.code.add(k.glsl`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;`);r.roundCaps?c.vertex.code.add(k.glsl`float angle = subdivisionFactor*PI*0.5;
joinDisplacementDir *= cos(angle);
capDisplacementDir *= sin(angle);`):c.vertex.code.add(k.glsl`capDisplacementDir *= subdivisionFactor;`);c.vertex.code.add(k.glsl`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${d||g?k.glsl`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${g?k.glsl`vLineDistance = lineDist;`:""}
  ${d?k.glsl`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `);r.stippleEnabled&&(c.vertex.code.add(k.glsl`{
vec2 posVec = pos.xy - stippleSegmentOrigin;
float stippleSegmentDirectionLength = length(stippleSegmentDirection);`),r.stippleIntegerRepeatsEnabled&&c.vertex.code.add(k.glsl`float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
stipplePatternUvMax = roundedNumberOfPatternRepeats;`),c.vertex.code.add(k.glsl`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${r.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `));c.vertex.code.add(k.glsl`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`);r.multipassTerrainEnabled&&(c.fragment.include(t.ReadLinearDepth),c.include(e.multipassTerrainTest,r));c.include(u.Slice,r);c.fragment.uniforms.add("intrinsicColor","vec4");c.fragment.include(h.ColorConversion);c.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${r.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 color = intrinsicColor * vColor;
  `);r.innerColorEnabled&&(c.fragment.uniforms.add("pixelRatio","float"),c.fragment.code.add(k.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`));c.fragment.code.add(k.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`);r.falloffEnabled&&c.fragment.code.add(k.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`);c.fragment.code.add(k.glsl`
    if (finalColor.a < ${k.glsl.float(b.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===r.output?k.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===r.output?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===r.output&&r.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${4===r.output?k.glsl`gl_FragColor = vec4(1.0);`:""}
    ${1===r.output?k.glsl`outputDepth(linearDepth);`:""}
  }
  `);return c}var z=Object.freeze({__proto__:null,build:m});a.RibbonLineShader=z;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.RibbonVertexPosition=function(f,p){f.vertex.uniforms.add("intrinsicWidth","float");p.vvSize?(f.attributes.add("sizeFeatureAttribute","float"),f.vertex.uniforms.add("vvSizeMinSize","vec3"),f.vertex.uniforms.add("vvSizeMaxSize","vec3"),f.vertex.uniforms.add("vvSizeOffset",
"vec3"),f.vertex.uniforms.add("vvSizeFactor","vec3"),f.vertex.code.add(u.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(f.attributes.add("size","float"),f.vertex.code.add(u.glsl`float getSize(){
return intrinsicWidth * size;
}`));p.vvOpacity?(f.attributes.add("opacityFeatureAttribute","float"),f.vertex.constants.add("vvOpacityNumber","int",8),f.vertex.code.add(u.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):f.vertex.code.add(u.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);p.vvColor?(f.attributes.add("colorFeatureAttribute","float"),f.vertex.constants.add("vvColorNumber","int",8),f.vertex.code.add(u.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(f.attributes.add("color","vec4"),f.vertex.code.add(u.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,u,f){a.OutputDepth=function(p,t){p.fragment.include(u.RgbaFloatEncoding);3===t.output?(p.extensions.add("GL_OES_standard_derivatives"),p.fragment.code.add(f.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&p.fragment.code.add(f.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.LineStipple=function(f,p){f.constants.add("stippleAlphaColorDiscard","float",.001);f.constants.add("stippleAlphaHighlightDiscard","float",.5);p.stippleEnabled?(f.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),p.stippleUVMaxEnabled&&f.varyings.add("stipplePatternUvMax","float"),f.varyings.add("stipplePatternUv",
"float"),f.fragment.uniforms.add("stipplePatternTexture","sampler2D"),p.stippleOffColorEnabled&&f.fragment.uniforms.add("stippleOffColor","vec4"),f.fragment.code.add(u.glsl`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${p.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),p.stippleOffColorEnabled?f.fragment.code.add(u.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):f.fragment.code.add(u.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)):f.fragment.code.add(u.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.PiUtils=function(f){f.vertex.code.add(u.glsl`const float PI = 3.141592653589793;`);f.fragment.code.add(u.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Camera"],function(a,u,f){let p=function(){function w(e){this.rctx=e;this.camera=null;this.lastFrameCamera=new f;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=!1}w.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=
13};u._createClass(w,[{key:"isHighlightPass",get:function(){return 5===this.pass}}]);return w}(),t=function(w){function e(n,b,h,k,l,m){n=w.call(this,n)||this;n.offscreenRenderingHelper=b;n.scenelightingData=h;n.shadowMap=k;n.ssaoHelper=l;n.sliceHelper=m;return n}u._inheritsLoose(e,w);return e}(p);a.OverlayRenderContext=p;a.RenderContext=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./ChangeSet ./Material ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){a.SortedRenderGeometryRenderer=function(A){function q(){var x=A.apply(this,arguments)||this;x._pending=new g;x._changes=new z.ChangeSet;x._materialRenderers=new Map;x._sortedMaterialRenderers=new e;x._hasHighlights=!1;x._hasWater=!1;return x}u._inheritsLoose(q,A);var y=q.prototype;y.dispose=function(){this._changes.prune();this._materialRenderers.forEach(x=>x.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear()};y.stopAnimationsAtTime=
function(x){this._sortedMaterialRenderers.forAll(D=>w.applySome(D.material.animation,C=>C.stopAtTime(x)))};y.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let x=!1,D=!1,C=!1;c.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((B,v)=>{let E=this._materialRenderers.get(v);!E&&0<B.adds.length&&(E=new d(this.rctx,this.materialRepository,v),this._materialRenderers.set(v,E),C=D=x=!0);if(E){var F=D||E.hasHighlights,L=C||E.hasWater;E.modify(B);D=D||F!==E.hasHighlights;
C=C||L!==E.hasWater;E.isEmpty&&(this._materialRenderers.delete(v),E.dispose(),x=!0)}});this._changes.clear();x&&this.updateSortedMaterialRenderers();D&&(this._hasHighlights=t.someMap(this._materialRenderers,B=>B.hasHighlights));C&&(this._hasWater=t.someMap(this._materialRenderers,B=>B.hasWater));this.notifyChange("updating");return!0};y.add=function(x){if(0!==x.length){var D=this._pending.empty;for(const C of x)this._pending.adds.add(C);D&&this.notifyChange("updating")}};y.remove=function(x){const D=
this._pending.empty;for(const C of x)this._pending.adds.has(C)?(this._pending.removed.add(C),this._pending.adds.delete(C)):this._pending.removed.has(C)||this._pending.removes.add(C);D&&!this._pending.empty&&this.notifyChange("updating")};y.modify=function(x,D){const C=0===this._changes.updates.length;for(const B of x)x=this._changes.updates.pushNew(),x.renderGeometry=B,x.updateType=D;C&&0<this._changes.updates.length&&this.notifyChange("updating")};y.updateLogic=function(x){let D=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:C})=>
{C.updateLogic&&C.updateLogic(x)&&(D=!0)});return D};y.render=function(x,D){for(let C=0;C<this._sortedMaterialRenderers.length;C++){const B=this._sortedMaterialRenderers.data[C];r.materialPredicate(B.material,x)&&B.materialRenderer.render(null,x.pass,D,null)}};y.updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let x=0;this._materialRenderers.forEach((D,C)=>{C.insertOrder=x++;this._sortedMaterialRenderers.push({material:C,materialRenderer:D})});this._sortedMaterialRenderers.sort((D,
C)=>{const B=C.material.renderPriority-D.material.renderPriority;return 0!==B?B:D.material.insertOrder-C.material.insertOrder})};y._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let x=0;x<this._changes.updates.length;)this._pending.has(this._changes.updates.data[x].renderGeometry)?this._changes.updates.removeUnorderedIndex(x):
x++;this._pending.clear()};u._createClass(q,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return t.someMap(this._materialRenderers,x=>x.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);
return q}(p);f.__decorate([n.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",void 0);f.__decorate([n.property()],a.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);f.__decorate([n.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);a.SortedRenderGeometryRenderer=f.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let g=function(){function A(){this.adds=new Set;this.removes=new Set;
this.removed=new Set}var q=A.prototype;q.has=function(y){return this.adds.has(y)||this.removes.has(y)||this.removed.has(y)};q.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};u._createClass(A,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return A}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,
u){let f=function(){function t(){this.adds=new u;this.removes=new u;this.updates=new u({allocator:e=>e||new p,deallocator:e=>{e.renderGeometry=null;return e}})}var w=t.prototype;w.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};w.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return t}(),p=function(){};a.ChangeSet=f;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=p;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,u){a.splitRenderGeometryChangeSetByMaterial=function(f){const p=new Map,t=w=>{let e=p.get(w);e||(e=new u.MaterialChangeSet,p.set(w,e));return e};f.adds.forAll(w=>{1<=w.data.indexCount&&t(w.material).adds.push(w)});f.removes.forAll(w=>{1<=w.data.indexCount&&t(w.material).removes.push(w)});f.updates.forAll(w=>{1<=w.renderGeometry.data.indexCount&&t(w.renderGeometry.material).updates.push(w)});
return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../statistics/RendererPerformanceInfo ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){function c(x,D,C,B){const v=new Map,E=D.vertexBufferLayout.stride/4,F=(L,N)=>{var I=L.origin;if(!f.isNone(I)){var G=x.get(I.id),K=v.get(I.id);null==K&&(K={optimalCount:null==G?0:G.optimalCount,sparseCount:null==G?0:G.buffer.size,toAdd:[],toRemove:[],origin:I.vec3},v.set(I.id,K));I=D.elementCount(L.data)*E;N?(K.optimalCount+=I,K.sparseCount+=I,K.toAdd.push(L)):(K.optimalCount-=I,K.toRemove.push(L))}};for(const L of C)F(L,!0);for(const L of B)F(L,!1);return v}
let d=function(){function x(C,B,v){this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=C;this._material=v;this._materialRep=B;this._glMaterials=k.acquireMaterials(this._material,this._materialRep);this._bufferWriter=v.createBufferWriter()}var D=x.prototype;D.dispose=function(){k.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(C=>{C.vao.dispose(!0);C.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=
null);this._glMaterials&&(this._glMaterials.forEach(C=>{C&&C.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};D.modify=function(C){this.updateGeometries(C.updates);this.addAndRemoveGeometries(C.adds,C.removes);this.updateRenderCommands()};D.addAndRemoveGeometries=function(C,B){const v=this._bufferWriter,E=v.vertexBufferLayout,F=E.stride/4,L=this._dataByOrigin,N=c(L,v,C,B);N.forEach((I,G)=>{N.delete(G);var K=I.optimalCount;const H=I.sparseCount;let J=L.get(G);if(null==J)n.assert(0<K),
J=this.createData(E,K,I.origin),L.set(G,J);else if(0===K){J.vao.dispose(!0);J.vao=null;L.delete(G);return}const M=K<I.sparseCount/2;G=g;const O=J.buffer.size,Q=J.buffer.array;K=J.buffer.resize(M?K:H,!1);M||K?this.removeAndRebuild(J,I.toRemove,F,Q,G):0<I.toRemove.length?(this.removeByErasing(J,I.toRemove,F,G),0<I.toAdd.length&&(G.end=O)):(G.begin=O,G.end=O);K=A;n.setMatrixTranslation3(K,-I.origin[0],-I.origin[1],-I.origin[2]);this.append(J,I.toAdd,F,K,G);I=J.vao.vertexBuffers.geometry;if(I.byteSize!==
J.buffer.array.buffer.byteLength)I.setData(J.buffer.array);else{const {begin:S,end:V}=G;S<V&&(G=4*S,I.setSubData(J.buffer.array,G,G,4*V))}J.drawCommandsDirty=!0})};D.updateGeometries=function(C){const B=this._bufferWriter,v=B.vertexBufferLayout.stride/4;for(const L of C){var E=L.updateType;C=L.renderGeometry;const N=this._dataByOrigin.get(C.origin.id),I=N&&N.instances.get(C.id);if(!I)break;E&1&&(I.isVisible=C.instanceParameters.visible);if(E&9){var F=C.instanceParameters.visible;I.hasHighlights=!!C.instanceParameters.highlights&&
F}E&16&&(I.hasOccludees=!!C.instanceParameters.occludees);E&6&&(E=N.buffer.array,F=N.vao,k.calculateTransformRelativeToOrigin(C,q,y),B.write({transformation:q,invTranspTransformation:y},C.data,B.vertexBufferLayout.createView(E.buffer),I.from),n.assert(I.from+B.elementCount(C.data)===I.to,"material VBO layout has changed"),F.vertexBuffers.geometry.setSubData(E,I.from*v*4,I.from*v*4,I.to*v*4));N.drawCommandsDirty=!0}};D.updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(B=>
{B.hasHiddenInstances=!1;B.hasHighlights=!1;B.hasOccludees=!1;u.someMap(B.instances,v=>{v.isVisible?(v.hasHighlights&&(this._hasHighlights=!0,B.hasHighlights=!0),v.hasOccludees&&(this._hasOccludees=!0,B.hasOccludees=!0)):B.hasHiddenInstances=!0;return B.hasHiddenInstances&&B.hasHighlights&&B.hasOccludees})});const C=B=>{B.drawCommandsDefault=null;B.drawCommandsHighlight=null;B.drawCommandsOccludees=null;B.drawCommandsShadowHighlightRest=null;B.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0};
if(0!==B.instances.size)if(B.hasOccludees||B.hasHighlights||B.hasHiddenInstances){var v=h.sortInstancesAccordingToRange([...B.instances.values()]);B.drawCommandsDefault=[];B.drawCommandsHighlight=[];B.drawCommandsOccludees=[];B.drawCommandsShadowHighlightRest=[];for(const E of v)E.isVisible&&(E.hasOccludees?h.addOrMerge(B.drawCommandsOccludees,E):h.addOrMerge(B.drawCommandsDefault,E),E.hasHighlights?h.addOrMerge(B.drawCommandsHighlight,E):h.addOrMerge(B.drawCommandsShadowHighlightRest,E));v=E=>{let F=
0;for(const L of E)F+=L.count;return F/3};B.stats={default:v(B.drawCommandsDefault),highlight:v(B.drawCommandsHighlight),occludees:v(B.drawCommandsOccludees),shadowHighlightRest:v(B.drawCommandsShadowHighlightRest)}}else v=4*B.buffer.size/z.getStride(B.vao.layout.geometry),B.drawCommandsDefault=[{first:0,count:v}],B.stats={default:v,highlight:0,occludees:0,shadowHighlightRest:0}};this._dataByOrigin.forEach(B=>{B.drawCommandsDirty&&(C(B),B.drawCommandsDirty=!1)})};D.updateLogic=function(C){return this._material.update(C)};
D.render=function(C,B,v,E){const F=this._rctx,L=this._glMaterials.get(B),N=5===B||7===B,I=6===B,G=!(N||I);3===B&&null===C&&(C=22);if(!L||2!==L.ensureResources(F)||null!=C&&!L.beginSlot(C)||N&&!this._hasHighlights)return!1;L.ensureParameters(v);const K=L.getPipelineState(C,!1);F.setPipelineState(K);const H=L.technique;F.useProgram(H.program);L.bind(v);let J=!1;this._dataByOrigin.forEach(M=>{if(!(f.isNone(M.drawCommandsDefault)&&f.isNone(M.drawCommandsHighlight)&&f.isNone(M.drawCommandsOccludees)&&
f.isNone(M.drawCommandsShadowHighlightRest)||N&&!M.hasHighlights)){v.origin=M.origin;H.bindDraw(v,{},{});H.ensureAttributeLocations(M.vao);F.bindVAO(M.vao);var O=H.primitiveType,Q=N?M.drawCommandsHighlight:I&&(M.hasOccludees||M.hasHighlights||M.hasHiddenInstances)?M.drawCommandsShadowHighlightRest:M.drawCommandsDefault;f.isSome(Q)&&(this.renderCommands(F,O,Q),l.addToRenderStats(Q.length,N?M.stats.highlight:I&&(M.hasOccludees||M.hasHighlights||M.hasHiddenInstances)?M.stats.shadowHighlightRest:M.stats.default,
E),J=!0);if(G&&(Q=M.drawCommandsOccludees,f.isSome(Q))){const S=L.getPipelineState(C,!0);F.setPipelineState(S);this.renderCommands(F,O,Q);F.setPipelineState(K);l.addToRenderStats(Q.length,M.stats.occludees,E);J=!0}}});return J};D.renderCommands=function(C,B,v){for(let E=0;E<v.length;E++)C.drawArrays(B,v[E].first,v[E].count)};D.createData=function(C,B,v){return{instances:new Map,vao:new r(this._rctx,this._material.vertexAttributeLocations,{geometry:w.glLayout(C)},{geometry:m.createVertex(this._rctx,
35044)}),buffer:new e.ResizableFloat32Array(B),optimalCount:0,origin:v,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}};D.removeAndRebuild=function(C,B,v,E,F){for(const H of B){B=H.id;const J=C.instances.get(B);C.optimalCount-=(J.to-J.from)*v;C.instances.delete(B)}let L=0;const N=C.buffer.array;
F.begin=0;F.end=0;let I=-1,G=-1,K=0;C.instances.forEach(H=>{const J=H.from*v,M=H.to*v,O=M-J;I!==G&&G!==J?(N.set(E.subarray(I,G),K),K+=G-I,I=J):-1===I&&(I=J);G=M;H.from=L/v;L+=O;H.to=L/v});I!==G&&N.set(E.subarray(I,G),K);F.end=L};D.removeByErasing=function(C,B,v,E){E.begin=Infinity;E.end=-Infinity;let F=-1,L=-1;for(const I of B){B=I.id;var N=C.instances.get(B);const G=N.from*v;N=N.to*v;F!==L&&L!==G?(C.buffer.erase(F,L),F=G):-1===F&&(F=G);L=N;C.instances.delete(B);C.optimalCount-=N-G;G<E.begin&&(E.begin=
G);N>E.end&&(E.end=N)}F!==L&&C.buffer.erase(F,L)};D.append=function(C,B,v,E,F){const L=this._bufferWriter;for(const I of B){var N=f.isSome(I.transformation)?p.multiply(q,E,I.transformation):E;p.invert(y,N);p.transpose(y,y);B=F.end;L.write({transformation:N,invTranspTransformation:y},I.data,L.vertexBufferLayout.createView(C.buffer.array.buffer),F.end/v);N=L.elementCount(I.data)*v;const G=B+N;n.assert(null==C.instances.get(I.id));const K=I.instanceParameters.visible;B=new h.Instance(B/v,G/v,K,!!I.instanceParameters.highlights&&
K,!!I.instanceParameters.occludees);C.instances.set(I.id,B);C.optimalCount+=N;F.end+=N}};a._createClass(x,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&u.someMap(this._glMaterials,C=>C instanceof b.WaterGLMaterial)}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},
{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]);return x}();const g={begin:0,end:0},A=t.create(),q=t.create(),y=t.create();return d})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(a,u,f){let p=function(){function t(e){null==e?e=16:65536>e&&(e=f.nextHighestPowerOfTwo(e));this._array=new Float32Array(e);this._size=0}var w=t.prototype;
w.resize=function(e,n){this._size=e;if(this._size>this._array.length){for(e=this._array.length||1;e<this._size;)e*=2;e=new Float32Array(e);n&&e.set(this._array);this._array=e;return!0}var b=2*this._size;if(b<=this._array.length){for(e=this._array.length;e>=b;)e=Math.floor(e/2);b=new Float32Array(e);n&&b.set(this._array.subarray(0,e));this._array=b;return!0}return!1};w.append=function(e){const n=this._size;this.resize(this._size+e.length,!0);this._array.set(e,n)};w.erase=function(e,n){for(;e<n;++e)this._array[e]=
0};u._createClass(t,[{key:"array",get:function(){return this._array}},{key:"size",get:function(){return this._size}}]);return t}();a.ResizableFloat32Array=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/GLMaterial","./WaterTechnique"],function(a,u,f,p){f=function(t){function w(n){n=t.call(this,n)||this;n.updateParameters();return n}u._inheritsLoose(w,t);
var e=w.prototype;e.updateParameters=function(n){this._technique=this._techniqueRep.releaseAndAcquire(p.WaterTechnique,this._material.getTechniqueConfig(this._output,n),this._technique)};e.beginSlot=function(n){if(2===this._output)return 22===n;if(5===this._output)return null==n;if(4===this._output)return 3===n;let b=3;this._material.params.transparent&&(b=this._material.params.writeDepth?5:8);return n===b};e.setElapsedTimeUniform=function(n){n.setUniform1f("timeElapsed",.001*this._material.animation.time*
this._material.params.animationSpeed)};e._updateShadowState=function(n){n.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:n.shadowMappingEnabled})};e._updateSSRState=function(n){n.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:n.ssrEnabled})};e.ensureResources=function(n){return this._technique.ensureResource(n)};e.ensureParameters=function(n){0===this._output&&(this._updateShadowState(n),
this._updateSSRState(n));this.updateParameters(n)};e.bind=function(n){this._technique.bindPass(this._material.params,n);2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)};return w}(f);a.WaterGLMaterial=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A){m=function(q){function y(D,C,B){C=q.call(this,D,C,B)||this;C._textureRepository=D.waterTextureRepository;return C}f._inheritsLoose(y,q);var x=y.prototype;x.initializeProgram=function(D){var C=y.shader.get();const B=this.configuration;C=C.build({OITEnabled:0===B.transparencyPassType,output:B.output,viewingMode:D.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:B.receiveShadows,
pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:B.useSSR,highStepCount:!0,multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new d.Program(D.rctx,C,r.Default3D)};x.ensureResource=function(D){this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(D);return this._textureRepository.ready?2:1};x.bindPass=function(D,C){k.bindProjectionMatrix(this.program,C.camera.projectionMatrix);C.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",
C.camera.nearFar),this.program.setUniform2fv("inverseViewport",C.inverseViewport),e.bindMultipassTerrainTexture(this.program,C));0===this.configuration.output&&(C.lighting.setUniforms(this.program,!1),b.bindSSRUniforms(this.program,C));if(0===this.configuration.output||2===this.configuration.output)h.bindWaterDistortionUniforms(this.program,D),this._textureRepository.bind(this.program);this.program.setUniform4fv("waterColor",D.color);4===this.configuration.output&&w.bindOutputHighlight(this.program,
C)};x.bindDraw=function(D){k.bindView(this.program,D);this.program.rebindTextures();0!==this.configuration.output&&7!==this.configuration.output||k.bindCameraPosition(this.program,D.origin,D.camera.viewInverseTransposeMatrix);0===this.configuration.output&&n.bindReadShadowMapUniforms(this.program,D);0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||t.bindSliceUniformsWithOrigin(this.program,this.configuration,D)};x.setPipelineState=function(D){const C=this.configuration,
B=3===D,v=2===D;return A.makePipelineState({blending:2!==C.output&&4!==C.output&&C.transparent?B?c.blendingDefault:c.OITBlending(D):null,depthTest:{func:c.OITDepthTest(D)},depthWrite:B?C.writeDepth&&A.defaultDepthWriteParams:c.OITDepthWrite(D),colorWrite:A.defaultColorWriteParams,polygonOffset:B||v?null:c.getOITPolygonOffset(C.enableOffset)})};x.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return y}(m.ShaderTechnique);m.shader=new l.ReloadableShaderModule(g.WaterSurface,
()=>new Promise(function(q,y){a(["../shaders/WaterSurface.glsl"],q,y)}));l=function(q){function y(){var x=q.apply(this,arguments)||this;x.output=0;x.receiveShadows=!1;x.slicePlaneEnabled=!1;x.transparent=!1;x.enableOffset=!0;x.writeDepth=!1;x.useSSR=!1;x.isDraped=!1;x.transparencyPassType=3;x.multipassTerrainEnabled=!1;x.cullAboveGround=!1;return x}f._inheritsLoose(y,q);return y}(z.ShaderTechniqueConfiguration);p.__decorate([z.parameter({count:8})],l.prototype,"output",void 0);p.__decorate([z.parameter()],
l.prototype,"receiveShadows",void 0);p.__decorate([z.parameter()],l.prototype,"slicePlaneEnabled",void 0);p.__decorate([z.parameter()],l.prototype,"transparent",void 0);p.__decorate([z.parameter()],l.prototype,"enableOffset",void 0);p.__decorate([z.parameter()],l.prototype,"writeDepth",void 0);p.__decorate([z.parameter()],l.prototype,"useSSR",void 0);p.__decorate([z.parameter()],l.prototype,"isDraped",void 0);p.__decorate([z.parameter({count:4})],l.prototype,"transparencyPassType",void 0);p.__decorate([z.parameter()],
l.prototype,"multipassTerrainEnabled",void 0);p.__decorate([z.parameter()],l.prototype,"cullAboveGround",void 0);u.WaterTechnique=m;u.WaterTechniqueConfiguration=l;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,u,f){a.ReadShadowMap=function(p){p.fragment.include(u.RgbaFloatEncoding);p.fragment.uniforms.add("uShadowMapTex",
"sampler2D");p.fragment.uniforms.add("uShadowMapNum","int");p.fragment.uniforms.add("uShadowMapDistance","vec4");p.fragment.uniforms.add("uShadowMapMatrix","mat4",4);p.fragment.uniforms.add("uDepthHalfPixelSz","float");p.fragment.code.add(f.glsl`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)};a.bindReadShadowMapUniforms=function(p,t){t.shadowMappingEnabled&&(t.shadowMap.bind(p),t.shadowMap.bindView(p,t.origin))};a.bindReadShadowMapView=function(p,t){t.shadowMappingEnabled&&t.shadowMap.bindView(p,t.origin)};a.bindReadShadowMapViewCustomOrigin=function(p,t,w){t.shadowMappingEnabled&&t.shadowMap.bindView(p,w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl",
"./Reprojection.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.ScreenSpaceReflections=function(t,w){t.fragment.uniforms.add("nearFar","vec2");t.fragment.uniforms.add("depthMapView","sampler2D");t.fragment.uniforms.add("ssrViewMat","mat4");t.fragment.uniforms.add("invResolutionHeight","float");t.fragment.include(u.ReadLinearDepth);t.include(f.Reprojection);t.fragment.code.add(p.glsl`
  const int maxSteps = ${w.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};a.bindSSRUniforms=function(t,w){w.ssrEnabled&&(t.bindTexture(w.linearDepthTexture,"depthMapView"),t.setUniform2fv("nearFar",w.camera.nearFar),t.setUniformMatrix4fv("ssrViewMat",w.camera.viewMatrix),t.setUniform1f("invResolutionHeight",1/w.camera.height),f.bindReprojectionUniforms(t,w))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Reprojection=
function(f){f.fragment.uniforms.add("lastFrameColorMap","sampler2D");f.fragment.uniforms.add("reprojectionMat","mat4");f.fragment.uniforms.add("rpProjectionMat","mat4");f.fragment.code.add(u.glsl`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)};a.bindReprojectionUniforms=function(f,p){f.bindTexture(p.lastFrameColorTexture,"lastFrameColorMap");f.setUniformMatrix4fv("reprojectionMat",p.reprojectionMat);f.setUniformMatrix4fv("rpProjectionMat",p.camera.projectionMatrix)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","./FoamRendering.glsl","../../shaderModules/interfaces"],function(a,u,f){a.WaterDistortion=function(p){p.fragment.uniforms.add("texWaveNormal",
"sampler2D");p.fragment.uniforms.add("texWavePerturbation","sampler2D");p.fragment.uniforms.add("waveParams","vec4");p.fragment.uniforms.add("waveDirection","vec2");p.include(u.FoamIntensity);p.fragment.code.add(f.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.bindWaterDistortionUniforms=function(p,t){p.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset);p.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.FoamColor=function(f){f.fragment.code.add(u.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(f){f.fragment.code.add(u.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){function c(g){const A=new r.ShaderBuilder;A.include(p.Transform,{linearDepth:!1});A.attributes.add("position","vec3");A.attributes.add("uv0","vec2");A.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");A.vertex.uniforms.add("waterColor","vec4");if(0===g.output||7===g.output)A.include(n.NormalUtils,g),A.include(u.ForwardLinearDepth,g),A.varyings.add("vuv","vec2"),A.varyings.add("vpos","vec3"),A.varyings.add("vnormal","vec3"),A.varyings.add("vtbnMatrix",
"mat3"),g.multipassTerrainEnabled&&A.varyings.add("depth","float"),A.vertex.code.add(z.glsl`
      void main(void) {
        if (waterColor.a < ${z.glsl.float(l.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${g.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===g.output?"forwardLinearDepth();":""}
      }
    `);g.multipassTerrainEnabled&&(A.fragment.include(w.ReadLinearDepth),A.include(e.multipassTerrainTest,g));7===g.output&&(A.include(f.Slice,g),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(z.glsl`
        void main() {
          discardBySlice(vpos);
          ${g.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));0===g.output&&(A.include(k.WaterDistortion,g),A.include(f.Slice,g),g.receiveShadows&&A.include(b.ReadShadowMap,g),A.include(h.Water,g),A.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),A.fragment.include(m.ColorConversion),A.fragment.code.add(z.glsl`
      void main() {
        discardBySlice(vpos);
        ${g.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${g.receiveShadows?z.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${g.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));2===g.output&&(A.include(n.NormalUtils,g),A.include(k.WaterDistortion,g),A.include(f.Slice,g),A.varyings.add("vpos","vec3"),A.varyings.add("vuv","vec2"),A.vertex.code.add(z.glsl`
        void main(void) {
          if (waterColor.a < ${z.glsl.float(l.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.fragment.uniforms.add("timeElapsed","float"),A.fragment.code.add(z.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));5===g.output&&(A.varyings.add("vpos","vec3"),A.vertex.code.add(z.glsl`
        void main(void) {
          if (waterColor.a < ${z.glsl.float(l.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(z.glsl`void main() {
gl_FragColor = waterColor;
}`));4===g.output&&(A.include(t.OutputHighlight),A.varyings.add("vpos","vec3"),A.vertex.code.add(z.glsl`
      void main(void) {
        if (waterColor.a < ${z.glsl.float(l.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),A.include(f.Slice,g),A.fragment.code.add(z.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return A}var d=Object.freeze({__proto__:null,build:c});a.WaterSurface=d;a.build=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,u){a.ForwardLinearDepth=function(f,p){0===p.output&&p.receiveShadows?(f.varyings.add("linearDepth","float"),f.vertex.code.add(u.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===p.output||3===p.output?(f.varyings.add("linearDepth","float"),f.vertex.uniforms.add("cameraNearFar",
"vec2"),f.vertex.code.add(u.glsl`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):f.vertex.code.add(u.glsl`void forwardLinearDepth() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.NormalUtils=function(f,p){1===p.viewingMode?f.vertex.code.add(u.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):f.vertex.code.add(u.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);1===p.viewingMode?f.vertex.code.add(u.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):f.vertex.code.add(u.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../../shaderModules/interfaces".split(" "),function(a,u,f,p,t,w){a.Water=function(e,n){e.include(p.PhysicallyBasedRendering,n);e.include(f.Gamma);e.include(u.FoamColor);n.ssrEnabled&&e.include(t.ScreenSpaceReflections,n);e.fragment.constants.add("fresnelSky",
"vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]);e.fragment.code.add(w.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);e.fragment.code.add(w.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`);n.ssrEnabled?e.fragment.code.add(w.glsl`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(w.glsl`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Gamma=function(f){f.fragment.code.add(u.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.PhysicallyBasedRendering=function(t,w){const e=t.fragment.code;t.include(f.PiUtils);if(3===w.pbrMode||4===w.pbrMode)e.add(p.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${w.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),e.add(p.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),e.add(p.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),e.add(p.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),e.add(p.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(1===w.pbrMode||2===w.pbrMode)t.include(u.AnalyticalSkyModel),e.add(p.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),e.add(p.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),e.add(p.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),e.add(p.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),e.add(p.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),e.add(p.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.AnalyticalSkyModel=function(f){f=f.fragment.code;f.add(u.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);f.add(u.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);f.add(u.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/mat4","../../../../../chunks/mat4f64"],function(a,u,f){a.Instance=function(p,t,w,e,n,b){this.from=p;this.to=t;this.isVisible=w;this.hasHighlights=e;this.hasOccludees=n;this.transformation=b;null!=b&&(this.transformationNormal=f.clone(b),u.invert(this.transformationNormal,this.transformationNormal),u.transpose(this.transformationNormal,
this.transformationNormal))};a.addOrMerge=function(p,t){if(0===p.length)p.push({first:t.from,count:t.to-t.from});else{var w=p[p.length-1];var e=w.first+w.count>=t.from?!0:!1;e?w.count=t.from-w.first+t.to-t.from:p.push({first:t.from,count:t.to-t.from})}};a.sortInstancesAccordingToRange=function(p){return p.sort((t,w)=>t.from===w.from?t.to>w.to?1:t.to<w.to?-1:0:t.from>w.from?1:t.from<w.from?-1:0)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),
function(a,u,f,p,t,w){const e="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let n=function(){function k(){this.drawCalls=this.triangles=0}k.prototype.reset=function(){this.drawCalls=this.triangles=0};return k}(),b=function(k){function l(){var m=k.call(this,"total")||this;m.total=0;m.frameCount=0;return m}u._inheritsLoose(l,k);
return l}(p),h=function(){function k(){this._enableGPUTimer=this._lastSample=this._startTime=0;this.totalTime=new b;this.gpuTime=new p("gpu",9);this.renderPassTimings=e.map(m=>new p(m));this.stats=new n}var l=k.prototype;l.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:t.once(()=>--this._enableGPUTimer)}};l.prerender=function(m){this._startTime=this._lastSample=performance.now();this._enableGPUTimer&&(this._gpuTimer=w.startMeasurement(m))};l.advance=function(m){const z=performance.now();
this.renderPassTimings[m].record(z-this._lastSample);this._lastSample=z};l.postrender=function(){f.isSome(this._gpuTimer)&&(this._gpuTimer.stop(z=>f.isSome(z)&&this.gpuTime.record(z),16),this._gpuTimer=null);const m=performance.now()-this._startTime;this.totalTime.record(m);this.totalTime.total+=m;this.totalTime.frameCount++};return k}();a.RenderStats=n;a.RenderTime=b;a.RendererPerformanceInfo=h;a.addToRenderStats=function(k,l,m){f.isSome(m)&&(m.drawCalls+=k,m.triangles+=l)};a.performanceStatsCategories=
e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(a,u){let f=function(){function w(n){this.timer=n;this.start=n.createQuery();n.createTimestamp(this.start)}var e=w.prototype;e.stop=function(n,b=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this.checkQueryResult(n,b)};e.checkQueryResult=function(n,b){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())n(null);else{var h=
this.timer.getResult(this.start),k=this.timer.getResult(this.end);n((k-h)/1E6)}else setTimeout(()=>this.checkQueryResult(n,b),b)};return w}(),p=function(){function w(n){this.timer=n;this.query=n.createQuery();t=!0;this.timer.beginTimeElapsed(this.query)}var e=w.prototype;e.stop=function(n,b=50){this.timer.endTimeElapsed();t=!1;this.checkQueryResult(n,b)};e.checkQueryResult=function(n,b){var h=this.timer.resultAvailable(this.query);const k=this.timer.disjoint();h&&!k?(h=this.timer.getResult(this.query),
n(h/1E6)):k?n(null):setTimeout(()=>this.checkQueryResult(n,b),b)};return w}(),t=!1;a.startMeasurement=function(w){w=w.capabilities.disjointTimerQuery;return u.isNone(w)?null:0<w.timestampBits()?new f(w):t?null:new p(w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){e=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build();return new h.Program(r.rctx,c,b.Default3D)};z.initializePipeline=function(){return this.configuration.hasAlpha?k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),colorWrite:k.defaultColorWriteParams}):k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return m}(e.ShaderTechnique);
e.shader=new w.ReloadableShaderModule(t.TextureOnlyShader,()=>new Promise(function(l,m){a(["../core/shaderLibrary/util/TextureOnly.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.hasAlpha=!1;return z}f._inheritsLoose(m,l);return m}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter()],t.prototype,"hasAlpha",void 0);u.TextureTechnique=e;u.TextureTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f,p){function t(){const e=new p.ShaderBuilder;e.include(u.ScreenSpacePass);e.fragment.uniforms.add("tex","sampler2D");e.fragment.uniforms.add("color","vec4");e.fragment.code.add(f.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`);return e}var w=Object.freeze({__proto__:null,build:t});a.TextureOnlyShader=w;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces"],function(a,u){a.ScreenSpacePass=function(f){f.attributes.add("position","vec2");f.varyings.add("uv","vec2");f.vertex.code.add(u.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,u,f,p,t,w){let e=function(){function b(){this._shOrder=2;this._ambientBoost=.4;this._oldSunlight={direction:p.create(),ambient:{color:p.create(),intensity:1},diffuse:{color:p.create(),intensity:1}};this.groundLightingFactor=
this.globalFactor=.5;this._sphericalHarmonics=new t.SphericalHarmonicsAmbientLight;this._mainLight={intensity:p.create(),direction:p.fromValues(1,0,0),castShadows:!1}}var h=b.prototype;h.setLightDirectionUniform=function(k){k.setUniform3fv("lightingMainDirection",this._mainLight.direction)};h.setUniforms=function(k,l=!1){k.setUniform1f("lightingFixedFactor",l?(1-this.groundLightingFactor)*(1-this.globalFactor):0);k.setUniform1f("lightingGlobalFactor",this.globalFactor);this.setLightDirectionUniform(k);
k.setUniform3fv("lightingMainIntensity",this._mainLight.intensity);k.setUniform1f("ambientBoostFactor",this._ambientBoost);l=this._sphericalHarmonics;0===this._shOrder?k.setUniform3f("lightingAmbientSH0",l.r[0],l.g[0],l.b[0]):1===this._shOrder?(k.setUniform4f("lightingAmbientSH_R",l.r[0],l.r[1],l.r[2],l.r[3]),k.setUniform4f("lightingAmbientSH_G",l.g[0],l.g[1],l.g[2],l.g[3]),k.setUniform4f("lightingAmbientSH_B",l.b[0],l.b[1],l.b[2],l.b[3])):2===this._shOrder&&(k.setUniform3f("lightingAmbientSH0",l.r[0],
l.g[0],l.b[0]),k.setUniform4f("lightingAmbientSH_R1",l.r[1],l.r[2],l.r[3],l.r[4]),k.setUniform4f("lightingAmbientSH_G1",l.g[1],l.g[2],l.g[3],l.g[4]),k.setUniform4f("lightingAmbientSH_B1",l.b[1],l.b[2],l.b[3],l.b[4]),k.setUniform4f("lightingAmbientSH_R2",l.r[5],l.r[6],l.r[7],l.r[8]),k.setUniform4f("lightingAmbientSH_G2",l.g[5],l.g[6],l.g[7],l.g[8]),k.setUniform4f("lightingAmbientSH_B2",l.b[5],l.b[6],l.b[7],l.b[8]))};h.set=function(k){w.combineLights(k,this._shOrder,this._mainLight,this._sphericalHarmonics);
f.copy(this._oldSunlight.direction,this._mainLight.direction);k=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*k;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*k;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*k;f.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,k);f.copy(n,this._oldSunlight.diffuse.color);f.scale(n,n,this._ambientBoost*this.globalFactor);f.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,
n)};u._createClass(b,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return b}();const n=p.create();a.SceneLighting=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,u,f,p,t,w){function e(q){return(q+
1)*(q+1)}function n(q){return u.clamp(Math.floor(Math.sqrt(q)-1),0,2)}function b(q,y,x){const D=q[0],C=q[1];q=q[2];x=x||[];x.length=e(y);0<=y&&(x[0]=.28209479177);1<=y&&(x[1]=.4886025119*D,x[2]=.4886025119*q,x[3]=.4886025119*C);2<=y&&(x[4]=1.09254843059*D*C,x[5]=1.09254843059*C*q,x[6]=.31539156525*(3*q*q-1),x[7]=1.09254843059*D*q,x[8]=.54627421529*(D*D-C*C));return x}function h(q,y){q=e(q);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=q;for(let x=0;x<q;x++)y.r[x]=y.g[x]=y.b[x]=0;return y}
function k(q,y){const x=n(y.r.length);for(const D of q)f.negate(g,D.direction),b(g,x,c),t.elementwiseProduct(c,A),t.scalarProduct(c,D.intensity[0],d),t.add(y.r,d),t.scalarProduct(c,D.intensity[1],d),t.add(y.g,d),t.scalarProduct(c,D.intensity[2],d),t.add(y.b,d);return y}function l(q,y){b(g,0,c);for(const x of q)y.r[0]+=c[0]*A[0]*x.intensity[0]*4*Math.PI,y.g[0]+=c[0]*A[0]*x.intensity[1]*4*Math.PI,y.b[0]+=c[0]*A[0]*x.intensity[2]*4*Math.PI;return y}const m=[],z=[],r=[],c=[0],d=[0],g=p.create(),A=[3.141593,
2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(q,y,x,D){h(y,D);f.set(x.intensity,0,0,0);y=!1;m.length=0;z.length=0;r.length=0;for(const C of q)C instanceof w.MainLight&&!y?(f.copy(x.direction,C.direction),x.intensity[0]=C.intensity[0],x.intensity[1]=C.intensity[1],x.intensity[2]=C.intensity[2],x.castShadows=C.castShadows,y=!0):C instanceof w.MainLight||C instanceof w.FillLight?m.push(C):C instanceof w.AmbientLight?z.push(C):C instanceof w.SphericalHarmonicsAmbientLight&&
r.push(C);k(m,D);l(z,D);for(const C of r)t.add(D.r,C.r),t.add(D.g,C.g),t.add(D.b,C.b)};a.computeCoefficients=b;a.initSHCoefficients=h;a.numberOfCoefficients=e;a.orderFromNumberOfCoefficients=n;a.projectAmbientLights=l;a.projectFillLights=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(u,f,p){p=p||u;p.length=u.length;for(let t=0;t<u.length;t++)p[t]=u[t]+f[t];return p};a.dotProduct=function(u,
f){let p=0;for(let t=0;t<u.length;t++)p+=u[t]*f[t];return p};a.elementwiseProduct=function(u,f,p){p=p||u;p.length=u.length;for(let t=0;t<u.length;t++)p[t]=u[t]*f[t];return p};a.scalarProduct=function(u,f,p){p=p||u;p.length=u.length;for(let t=0;t<u.length;t++)p[t]=u[t]*f;return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define("exports ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){f=function(){function l(z){this._rctx=z;this.cache=new Map}var m=l.prototype;m.dispose=function(){this.cache.forEach(z=>z.texture=u.disposeMaybe(z.texture));this.cache.clear()};m.acquire=function(z){if(u.isNone(z))return null;const r=this.patternId(z),c=this.cache.get(r);if(c)return c.refCount++,c.bind;const d=this.patternToTextureData(z,2),g=d.length/2,A={refCount:1,texture:null,bind:q=>{u.isNone(A.texture)&&(A.texture=new h(this._rctx,{width:d.length,height:1,internalFormat:6406,
pixelFormat:6406,dataType:5121,wrapMode:33071},d));q.bindTexture(A.texture,"stipplePatternTexture");return g}};this.cache.set(r,A);return A.bind};m.release=function(z){if(!u.isNone(z)){z=this.patternId(z);var r=this.cache.get(z);r&&(r.refCount--,0===r.refCount&&(u.isSome(r.texture)&&r.texture.dispose(),this.cache.delete(z)))}};m.swap=function(z,r){r=this.acquire(r);this.release(z);return r};m.patternId=function(z){return z.join(",")};m.patternToTextureData=function(z,r){var c=z.reduce((A,q)=>A+q)*
r;c=new Uint8Array(c);let d=!0,g=0;for(const A of z){for(z=0;z<A*r;z++)c[g++]=d?255:0;d=!d}return c};return l}();a.StippleTextureRepository=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/GLMaterialTexture ../lib/Material ../lib/OrderIndependentTransparency ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){let c=function(E){function F(N){var I=E.call(this,N,g)||this;I.supportsEdges=!0;I.techniqueConfig=new z.DefaultMaterialTechniqueConfiguration;I.vertexBufferLayout=F.getVertexBufferLayout(I.params);I.instanceBufferLayout=N.instanced?F.getInstanceBufferLayout(I.params):null;return I}u._inheritsLoose(F,E);var L=F.prototype;L.isVisibleInPass=function(N){return 4===N||6===N||7===N?this.params.castShadows:!0};L.isVisible=function(){var N=this.params;if(!E.prototype.isVisible.call(this)||
0===N.layerOpacity)return!1;var I=N.instanced;const G=N.vertexColors,K=N.symbolColors;I=!!I&&-1<I.indexOf("color");const H=N.vvColorEnabled,J="replace"===N.colorMixMode,M=0<N.opacity;N=N.externalColor&&0<N.externalColor[3];return G&&(I||H||K)?J?!0:M:G?J?N:M:I||H||K?J?!0:M:J?N:M};L.getTechniqueConfig=function(N,I){this.techniqueConfig.output=N;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace;this.techniqueConfig.multipassTerrainEnabled=I?I.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=
I?I.cullAboveGround:!1;if(0===N||7===N)this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.techniqueConfig.doubleSidedMode=this.params.treeRendering?2:this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=
this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=I&&I.ssaoEnabled?this.params.receiveSSAO:!1,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,
this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=I?I.transparencyPassType:3,this.techniqueConfig.enableOffset=I?I.camera.relativeElevation<h.OITPolygonOffsetLimit:!0;return this.techniqueConfig};L.intersect=function(N,I,G,K,H,J,M){if(null!==this.params.verticalOffset){const Q=
K.camera;p.set(B,G[12],G[13],G[14]);G=null;switch(K.viewingMode){case 1:G=p.normalize(D,B);break;case 2:G=p.copy(D,x)}let S=0;if(null!==this.params.verticalOffset){var O=p.subtract(v,B,Q.eye);const V=p.length(O);O=p.scale(O,O,1/V);let Y=null;this.params.screenSizePerspective&&(Y=p.dot(G,O));S+=m.verticalOffsetAtDistance(Q,V,this.params.verticalOffset,Y,this.params.screenSizePerspective)}p.scale(G,G,S);p.transformMat3(C,G,K.transform.inverseRotation);H=p.subtract(q,H,C);J=p.subtract(y,J,C)}m.intersectTriangleGeometry(N,
I,K,H,J,k.getVerticalOffsetObject3D(K.verticalOffset),M)};L.getGLMaterial=function(N){if(0===N.output||7===N.output||1===N.output||2===N.output||3===N.output||4===N.output)return new d(N)};L.createBufferWriter=function(){return new A(this.vertexBufferLayout,this.instanceBufferLayout)};F.getVertexBufferLayout=function(N){const I=N.textureId||N.normalTextureId||N.metallicRoughnessTextureId||N.emissiveTextureId||N.occlusionTextureId,G=w.newLayout().vec3f("position").vec3f("normal");N.vertexTangents&&
G.vec4f("tangent");I&&G.vec2f("uv0");N.vertexColors&&G.vec4u8("color");N.symbolColors&&G.vec4u8("symbolColor");return G};F.getInstanceBufferLayout=function(N){let I=w.newLayout();I=N.instancedDoublePrecision?I.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):I.mat4f("model").mat4f("modelNormal");N.instanced&&-1<N.instanced.indexOf("color")&&(I=I.vec4f("instanceColor"));N.instanced&&-1<N.instanced.indexOf("featureAttribute")&&(I=I.vec4f("instanceFeatureAttribute"));
return I};return F}(b.Material),d=function(E){function F(N){N=E.call(this,{...N,...N.material.params})||this;N.updateParameters();return N}u._inheritsLoose(F,E);var L=F.prototype;L.updateParameters=function(N){const I=this._material.params;this.updateTexture(I.textureId);this._technique=this._techniqueRep.releaseAndAcquire(I.treeRendering?r.RealisticTreeTechnique:z.DefaultMaterialTechnique,this._material.getTechniqueConfig(this._output,N),this._technique)};L.selectPipelines=function(){};L._updateShadowState=
function(N){N.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:N.shadowMappingEnabled})};L._updateOccludeeState=function(N){N.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:N.hasOccludees})};L.ensureParameters=function(N){if(0===this._output||7===this._output)this._updateShadowState(N),this._updateOccludeeState(N);this.updateParameters(N)};L.bind=function(N){this._technique.bindPass(this._material.params,
N);this.bindTextures(this._technique.program)};L.beginSlot=function(N){return N===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)};L.getPipelineState=function(N,I){return this._technique.getPipelineState(I)};return F}(n);const g={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,
.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,
100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:f.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:e.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...b.materialParametersDefaults};let A=function(){function E(L,N){this.vertexBufferLayout=L;this.instanceBufferLayout=
N}var F=E.prototype;F.allocate=function(L){return this.vertexBufferLayout.createBuffer(L)};F.elementCount=function(L){return L.indices.get("position").length};F.write=function(L,N,I,G){l.writeDefaultAttributes(N,this.vertexBufferLayout,L.transformation,L.invTranspTransformation,I,G)};return E}();const q=t.create(),y=t.create(),x=t.fromValues(0,0,1),D=t.create(),C=t.create(),B=t.create(),v=t.create();a.DefaultMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../materials/internal/MaterialUtil ../../../../chunks/DefaultMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){d=function(v){function E(){return v.apply(this,arguments)||this}f._inheritsLoose(E,v);var F=E.prototype;F.initializeProgram=function(L){var N=E.shader.get();const I=this.configuration;N=N.build({OITEnabled:0===I.transparencyPassType,output:I.output,viewingMode:L.viewingMode,receiveShadows:I.receiveShadows,slicePlaneEnabled:I.slicePlaneEnabled,sliceHighlightDisabled:I.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:I.symbolColors,
vvSize:I.vvSize,vvColor:I.vvColor,vvInstancingEnabled:!0,instanced:I.instanced,instancedColor:I.instancedColor,instancedDoublePrecision:I.instancedDoublePrecision,pbrMode:I.usePBR?I.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:I.hasMetalnessAndRoughnessTexture,hasEmissionTexture:I.hasEmissionTexture,hasOcclusionTexture:I.hasOcclusionTexture,hasNormalTexture:I.hasNormalTexture,hasColorTexture:I.hasColorTexture,receiveAmbientOcclusion:I.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:I.normalsTypeDerivate?
3:0,doubleSidedMode:I.doubleSidedMode,vertexTangents:I.vertexTangents,attributeTextureCoordinates:I.hasMetalnessAndRoughnessTexture||I.hasEmissionTexture||I.hasOcclusionTexture||I.hasNormalTexture||I.hasColorTexture?1:0,textureAlphaPremultiplied:I.textureAlphaPremultiplied,attributeColor:I.vertexColors,screenSizePerspectiveEnabled:I.screenSizePerspective,verticalOffsetEnabled:I.verticalOffset,offsetBackfaces:I.offsetBackfaces,doublePrecisionRequiresObfuscation:z.doublePrecisionRequiresObfuscation(L.rctx),
alphaDiscardMode:I.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:I.multipassTerrainEnabled,cullAboveGround:I.cullAboveGround});return new y.Program(L.rctx,N,A.Default3D)};F.bindPass=function(L,N){var I,G;r.bindProjectionMatrix(this.program,N.camera.projectionMatrix);const K=this.configuration.output;(1===this.configuration.output||N.multipassTerrainEnabled||3===K)&&this.program.setUniform2fv("cameraNearFar",N.camera.nearFar);N.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
N.inverseViewport),h.bindMultipassTerrainTexture(this.program,N));7===K&&(this.program.setUniform1f("opacity",L.opacity),this.program.setUniform1f("layerOpacity",L.layerOpacity),this.program.setUniform4fv("externalColor",L.externalColor),this.program.setUniform1i("colorMixMode",D.colorMixModes[L.colorMixMode]));0===K?(N.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",L.ambient),this.program.setUniform3fv("diffuse",L.diffuse),this.program.setUniform4fv("externalColor",L.externalColor),
this.program.setUniform1i("colorMixMode",D.colorMixModes[L.colorMixMode]),this.program.setUniform1f("opacity",L.opacity),this.program.setUniform1f("layerOpacity",L.layerOpacity),this.configuration.usePBR&&k.bindPBRUniforms(this.program,L,this.configuration.isSchematic)):4===K&&b.bindOutputHighlight(this.program,N);m.bindVisualVariablesUniformsForSymbols(this.program,L);n.bindVerticalOffsetUniforms(this.program,L,N);D.bindScreenSizePerspective(L.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");
2!==L.textureAlphaMode&&3!==L.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",L.textureAlphaCutoff);null==(I=N.shadowMap)?void 0:I.bind(this.program);null==(G=N.ssaoHelper)?void 0:G.bind(this.program)};F.bindDraw=function(L){const N=this.configuration.instancedDoublePrecision?t.fromValues(L.camera.viewInverseTransposeMatrix[3],L.camera.viewInverseTransposeMatrix[7],L.camera.viewInverseTransposeMatrix[11]):L.origin;r.bindViewCustomOrigin(this.program,N,L.camera.viewMatrix);this.program.rebindTextures();
(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&r.bindCameraPosition(this.program,N,L.camera.viewInverseTransposeMatrix);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",L.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&
e.InstancedDoublePrecision.bindCustomOrigin(this.program,N);w.bindSliceUniforms(this.program,this.configuration,L.slicePlane,N);0===this.configuration.output&&l.bindReadShadowMapViewCustomOrigin(this.program,L,N)};F.setPipeline=function(L,N){const I=this.configuration,G=3===L,K=2===L;return B.makePipelineState({blending:0!==I.output&&7!==I.output||!I.transparent?null:G?q.blendingDefault:q.OITBlending(L),culling:(I.cullFace?0!==I.cullFace:I.slicePlaneEnabled?!1:!I.transparent&&!I.doubleSidedMode)&&
B.cullingParams(I.cullFace),depthTest:{func:q.OITDepthTest(L)},depthWrite:G||K?I.writeDepth&&B.defaultDepthWriteParams:null,colorWrite:B.defaultColorWriteParams,stencilWrite:I.sceneHasOcludees?x.stencilWriteMaskOn:null,stencilTest:I.sceneHasOcludees?N?x.stencilToolMaskBaseParams:x.stencilBaseAllZerosParams:null,polygonOffset:G||K?null:q.getOITPolygonOffset(I.enableOffset)})};F.initializePipeline=function(){this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0);return this.setPipeline(this.configuration.transparencyPassType,
!1)};F.getPipelineState=function(L){return L?this._occludeePipelineState:this.pipeline};return E}(d.ShaderTechnique);d.shader=new c.ReloadableShaderModule(C.DefaultMaterialShader,()=>new Promise(function(v,E){a(["./DefaultMaterial.glsl"],v,E)}));c=function(v){function E(){var F=v.apply(this,arguments)||this;F.output=0;F.alphaDiscardMode=1;F.doubleSidedMode=0;F.isSchematic=!1;F.vertexColors=!1;F.offsetBackfaces=!1;F.symbolColors=!1;F.vvSize=!1;F.vvColor=!1;F.verticalOffset=!1;F.receiveShadows=!1;F.slicePlaneEnabled=
!1;F.sliceHighlightDisabled=!1;F.receiveAmbientOcclusion=!1;F.screenSizePerspective=!1;F.textureAlphaPremultiplied=!1;F.hasColorTexture=!1;F.usePBR=!1;F.hasMetalnessAndRoughnessTexture=!1;F.hasEmissionTexture=!1;F.hasOcclusionTexture=!1;F.hasNormalTexture=!1;F.instanced=!1;F.instancedColor=!1;F.instancedDoublePrecision=!1;F.vertexTangents=!1;F.normalsTypeDerivate=!1;F.writeDepth=!0;F.sceneHasOcludees=!1;F.transparent=!1;F.enableOffset=!0;F.cullFace=0;F.transparencyPassType=3;F.multipassTerrainEnabled=
!1;F.cullAboveGround=!1;return F}f._inheritsLoose(E,v);return E}(g.ShaderTechniqueConfiguration);p.__decorate([g.parameter({count:8})],c.prototype,"output",void 0);p.__decorate([g.parameter({count:4})],c.prototype,"alphaDiscardMode",void 0);p.__decorate([g.parameter({count:3})],c.prototype,"doubleSidedMode",void 0);p.__decorate([g.parameter()],c.prototype,"isSchematic",void 0);p.__decorate([g.parameter()],c.prototype,"vertexColors",void 0);p.__decorate([g.parameter()],c.prototype,"offsetBackfaces",
void 0);p.__decorate([g.parameter()],c.prototype,"symbolColors",void 0);p.__decorate([g.parameter()],c.prototype,"vvSize",void 0);p.__decorate([g.parameter()],c.prototype,"vvColor",void 0);p.__decorate([g.parameter()],c.prototype,"verticalOffset",void 0);p.__decorate([g.parameter()],c.prototype,"receiveShadows",void 0);p.__decorate([g.parameter()],c.prototype,"slicePlaneEnabled",void 0);p.__decorate([g.parameter()],c.prototype,"sliceHighlightDisabled",void 0);p.__decorate([g.parameter()],c.prototype,
"receiveAmbientOcclusion",void 0);p.__decorate([g.parameter()],c.prototype,"screenSizePerspective",void 0);p.__decorate([g.parameter()],c.prototype,"textureAlphaPremultiplied",void 0);p.__decorate([g.parameter()],c.prototype,"hasColorTexture",void 0);p.__decorate([g.parameter()],c.prototype,"usePBR",void 0);p.__decorate([g.parameter()],c.prototype,"hasMetalnessAndRoughnessTexture",void 0);p.__decorate([g.parameter()],c.prototype,"hasEmissionTexture",void 0);p.__decorate([g.parameter()],c.prototype,
"hasOcclusionTexture",void 0);p.__decorate([g.parameter()],c.prototype,"hasNormalTexture",void 0);p.__decorate([g.parameter()],c.prototype,"instanced",void 0);p.__decorate([g.parameter()],c.prototype,"instancedColor",void 0);p.__decorate([g.parameter()],c.prototype,"instancedDoublePrecision",void 0);p.__decorate([g.parameter()],c.prototype,"vertexTangents",void 0);p.__decorate([g.parameter()],c.prototype,"normalsTypeDerivate",void 0);p.__decorate([g.parameter()],c.prototype,"writeDepth",void 0);p.__decorate([g.parameter()],
c.prototype,"sceneHasOcludees",void 0);p.__decorate([g.parameter()],c.prototype,"transparent",void 0);p.__decorate([g.parameter()],c.prototype,"enableOffset",void 0);p.__decorate([g.parameter({count:3})],c.prototype,"cullFace",void 0);p.__decorate([g.parameter({count:4})],c.prototype,"transparencyPassType",void 0);p.__decorate([g.parameter()],c.prototype,"multipassTerrainEnabled",void 0);p.__decorate([g.parameter()],c.prototype,"cullAboveGround",void 0);u.DefaultMaterialTechnique=d;u.DefaultMaterialTechniqueConfiguration=
c;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../chunks/vec3f64","../util/DoublePrecision.glsl","../../shaderModules/interfaces","../../../lib/doublePrecisionUtils"],function(a,u,f,p,t){function w(b,h){h.instanced&&h.instancedDoublePrecision&&(b.attributes.add("modelOriginHi","vec3"),b.attributes.add("modelOriginLo","vec3"),b.attributes.add("model","mat3"),
b.attributes.add("modelNormal","mat3"));h.instancedDoublePrecision&&(b.vertex.include(f.DoublePrecision,h),b.vertex.uniforms.add("viewOriginHi","vec3"),b.vertex.uniforms.add("viewOriginLo","vec3"));const k=[p.glsl`
    vec3 calculateVPos() {
      ${h.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,p.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${h.instancedDoublePrecision?p.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,p.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,p.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,h.vertexTangents?p.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${h.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:p.glsl``];b.vertex.code.add(k[0]);b.vertex.code.add(k[1]);b.vertex.code.add(k[2]);2===h.output&&b.vertex.code.add(k[3]);b.vertex.code.add(k[4])}(function(b){b.Uniforms=function(){};b.bindCustomOrigin=function(h,k){t.encodeDoubleArraySplit(k,e,n,3);h.setUniform3fv("viewOriginHi",e);h.setUniform3fv("viewOriginLo",n)}})(w||(w={}));const e=u.create(),n=u.create();a.InstancedDoublePrecision=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports",
"../../../../../../core/has","../../shaderModules/interfaces","../../../lib/WebGLDriverTest"],function(a,u,f,p){a.DoublePrecision=function({code:t},w){w.doublePrecisionRequiresObfuscation?t.add(f.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(f.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(t){return u("force-double-precision-obfuscation")?!0:p.testWebGLDriver(t).doublePrecisionRequiresObfuscation};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./doublePrecisionUtils ./Util ../../../webgl/testSVGPremultipliedAlpha".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){function d(q,y){var x=new w(q,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});const D=t.createVertex(q,35044,new Uint16Array([0,0,1,0,0,1,1,1])),C=new m(q,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:D}),B=p.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),v=p.fromValues(5633271.46742708,
2626873.6381334523,1434963.231608387);y=new e.Program(q,`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${y?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var E=new Float32Array(6);z.encodeDoubleArray(B,E,3);var F=new Float32Array(6);z.encodeDoubleArray(v,F,3);q.useProgram(y);y.setUniform3f("u_highA",E[0],E[2],E[4]);y.setUniform3f("u_lowA",E[1],E[3],E[5]);y.setUniform3f("u_highB",F[0],F[2],F[4]);y.setUniform3f("u_lowB",F[1],F[3],F[5]);E=y;F=q.getBoundFramebufferObject();const {x:L,y:N,width:I,height:G}=q.getViewport();
q.bindFramebuffer(x);q.setViewport(0,0,1,1);q.bindVAO(C);q.drawArrays(5,0,4);y=new Uint8Array(4);x.readPixels(0,0,1,1,6408,5121,y);E.dispose();C.dispose(!1);D.dispose();x.dispose();q.setViewport(L,N,I,G);q.bindFramebuffer(F);q=(B[2]-v[2])/25;x=r.unpackFloatRGBA(y);return Math.abs(q-x)}let g=function(){function q(y){this.context=y;this.svgAlwaysPremultipliesAlpha=!1;this._doublePrecisionRequiresObfuscation=null;c.testSVGPremultipliedAlpha(y).then(x=>this.svgAlwaysPremultipliesAlpha=!x)}u._createClass(q,
[{key:"doublePrecisionRequiresObfuscation",get:function(){if(f.isNone(this._doublePrecisionRequiresObfuscation)){const y=d(this.context,!1),x=d(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==y&&(0===x||5<y/x)}return this._doublePrecisionRequiresObfuscation}}]);return q}(),A=null;a.clearTestWebGLDriver=function(q){f.isSome(A)&&A.context===q&&(A=null)};a.testWebGLDriver=function(q){if(f.isNone(A)||A.context!==q)A=new g(q);return A};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ./BufferObject ./FramebufferObject ./Program ./Texture ./VertexArrayObject".split(" "),function(a,u,f,p,t,w,e){function n(){n=u._asyncToGenerator(function*(b){const h=new Image;h.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
h.width=5;h.height=5;yield h.decode();if(!b.gl)return!0;const k=new p(b,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),l=f.createVertex(b,35044,new Uint16Array([0,0,1,0,0,1,1,1])),m=new e(b,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:l}),z=new t.Program(b,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));b.useProgram(z);const r=new w(b,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},h);b.bindTexture(r,0);z.setUniform1i("u_texture",0);const c=b.getBoundFramebufferObject(),{x:d,y:g,width:A,height:q}=b.getViewport();b.bindFramebuffer(k);b.setViewport(0,0,1,1);b.bindVAO(m);b.drawArrays(5,
0,4);const y=new Uint8Array(4);k.readPixels(0,0,1,1,6408,5121,y);z.dispose();m.dispose(!1);l.dispose();k.dispose();r.dispose();b.setViewport(d,g,A,q);b.bindFramebuffer(c);h.src="";return 255===y[0]});return n.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(b){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../../../../../../chunks/vec3f32",
"../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,u,f,p){u=u.fromValues(0,.6,.2);a.PBRSchematicMRRValues=u;a.PhysicallyBasedRenderingParameters=function(t,w){const e=t.fragment,n=w.hasMetalnessAndRoughnessTexture||w.hasEmissionTexture||w.hasOcclusionTexture;1===w.pbrMode&&n&&t.include(f.VertexTextureCoordinates,w);2===w.pbrMode?e.code.add(p.glsl`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):(0===w.pbrMode&&e.code.add(p.glsl`float getBakedOcclusion() { return 1.0; }`),1===w.pbrMode&&(e.uniforms.add("emissionFactor","vec3"),e.uniforms.add("mrrFactors","vec3"),e.code.add(p.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),w.hasMetalnessAndRoughnessTexture&&(e.uniforms.add("texMetallicRoughness","sampler2D"),w.supportsTextureAtlas&&e.uniforms.add("texMetallicRoughnessSize","vec2"),e.code.add(p.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),w.hasEmissionTexture&&(e.uniforms.add("texEmission","sampler2D"),w.supportsTextureAtlas&&e.uniforms.add("texEmissionSize","vec2"),e.code.add(p.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),w.hasOcclusionTexture?(e.uniforms.add("texOcclusion","sampler2D"),w.supportsTextureAtlas&&e.uniforms.add("texOcclusionSize","vec2"),e.code.add(p.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):e.code.add(p.glsl`float getBakedOcclusion() { return 1.0; }`),e.code.add(p.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${n?"vtc.uv \x3d vuv0;":""}
      ${w.hasMetalnessAndRoughnessTexture?w.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${w.hasEmissionTexture?w.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${w.hasOcclusionTexture?w.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))};a.bindPBRUniforms=function(t,w,e=!1){e||(t.setUniform3fv("mrrFactors",w.mrrFactors),t.setUniform3fv("emissionFactor",w.emissiveFactor))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.VertexTextureCoordinates=function(t,w){t.include(u.TextureCoordinateAttribute,
w);t.fragment.code.add(p.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${w.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);1===w.attributeTextureCoordinates&&t.fragment.code.add(p.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`);2===w.attributeTextureCoordinates&&(t.include(f.TextureAtlasLookup),t.fragment.code.add(p.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.TextureCoordinateAttribute=function(f,p){1===p.attributeTextureCoordinates&&(f.attributes.add("uv0","vec2"),f.varyings.add("vuv0","vec2"),f.vertex.code.add(u.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`));2===p.attributeTextureCoordinates&&(f.attributes.add("uv0","vec2"),f.varyings.add("vuv0","vec2"),f.attributes.add("uvRegion","vec4"),f.varyings.add("vuvRegion","vec4"),f.vertex.code.add(u.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`));0===p.attributeTextureCoordinates&&f.vertex.code.add(u.glsl`void forwardTextureCoordinates() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.TextureAtlasLookup=function(f){f.extensions.add("GL_EXT_shader_texture_lod");f.extensions.add("GL_OES_standard_derivatives");f.fragment.code.add(u.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L){function N(G){const K=new L.ShaderBuilder,H=K.vertex.code,J=K.fragment.code;K.include(v.HeaderComment,{name:"Default Material Shader",output:G.output});K.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");K.include(n.PositionAttribute);K.varyings.add("vpos","vec3");K.include(C.VisualVariables,G);K.include(w.InstancedDoublePrecision,G);K.include(m.VerticalOffset,G);if(0===G.output||
7===G.output)K.include(e.NormalAttribute,G),K.include(t.Transform,{linearDepth:!1}),0===G.normalType&&G.offsetBackfaces&&K.include(f.Offset),K.include(c.ComputeNormalTexture,G),K.include(l.VertexNormal,G),G.instancedColor&&K.attributes.add("instanceColor","vec4"),K.varyings.add("localvpos","vec3"),K.include(h.TextureCoordinateAttribute,G),K.include(u.ForwardLinearDepth,G),K.include(b.SymbolColor,G),K.include(k.VertexColor,G),K.vertex.uniforms.add("externalColor","vec4"),K.varyings.add("vcolorExt",
"vec4"),G.multipassTerrainEnabled&&K.varyings.add("depth","float"),H.add(F.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${G.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${F.glsl.float(B.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===G.normalType?F.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${G.vertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===G.normalType&&G.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${G.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);7===G.output&&(K.include(p.Slice,G),K.include(B.DiscardOrAdjustAlpha,G),G.multipassTerrainEnabled&&(K.fragment.include(r.ReadLinearDepth),K.include(A.multipassTerrainTest,G)),K.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),G.hasColorTexture&&K.fragment.uniforms.add("tex","sampler2D"),K.fragment.include(E.MixExternalColor),J.add(F.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${G.hasColorTexture?F.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:F.glsl`vec4 texColor = vec4(1.0);`}
        ${G.attributeColor?F.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));0===G.output&&(K.include(p.Slice,G),K.include(g.EvaluateSceneLighting,G),K.include(d.EvaluateAmbientOcclusion,G),K.include(B.DiscardOrAdjustAlpha,G),G.receiveShadows&&K.include(D.ReadShadowMap,G),G.multipassTerrainEnabled&&(K.fragment.include(r.ReadLinearDepth),K.include(A.multipassTerrainTest,G)),K.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),G.hasColorTexture&&K.fragment.uniforms.add("tex",
"sampler2D"),K.include(x.PhysicallyBasedRenderingParameters,G),K.include(y.PhysicallyBasedRendering,G),K.fragment.include(E.MixExternalColor),K.include(q.Normals,G),J.add(F.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${G.hasColorTexture?F.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${G.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:F.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===G.normalType?F.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:F.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===G.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${G.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===G.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${G.attributeColor?F.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${G.hasNormalTexture?F.glsl`
              mat3 tangentSpace = ${G.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${1===G.pbrMode||2===G.pbrMode?1===G.viewingMode?F.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:F.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:F.glsl``}
        ${1===G.pbrMode||2===G.pbrMode?F.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${G.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));K.include(z.DefaultMaterialAuxiliaryPasses,G);return K}var I=Object.freeze({__proto__:null,build:N});a.DefaultMaterialShader=I;a.build=N})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,u){a.Offset=function(f){f.vertex.code.add(u.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces"],function(a,u,f){a.NormalAttribute=function(p,t){0===t.normalType&&(p.attributes.add("normal","vec3"),p.vertex.code.add(f.glsl`vec3 normalModel() {
return normal;
}`));1===t.normalType&&(p.include(u.DecodeNormal),p.attributes.add("normalCompressed","vec2"),p.vertex.code.add(f.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));3===t.normalType&&(p.extensions.add("GL_OES_standard_derivatives"),p.fragment.code.add(f.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.DecodeNormal=function(f){const p=u.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;f.fragment.code.add(p);f.vertex.code.add(p)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.PositionAttribute=function(f){f.attributes.add("position","vec3");f.vertex.code.add(u.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports",
"../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(a,u,f){a.SymbolColor=function(p,t){t.symbolColor?(p.include(u.DecodeSymbolColor),p.attributes.add("symbolColor","vec4"),p.varyings.add("colorMixMode","mediump float")):p.fragment.uniforms.add("colorMixMode","int");t.symbolColor?p.vertex.code.add(f.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):p.vertex.code.add(f.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,u){a.DecodeSymbolColor=function(f){f.vertex.code.add(u.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${u.glsl.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${u.glsl.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${u.glsl.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${u.glsl.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.VertexColor=function(f,p){p.attributeColor?(f.attributes.add("color","vec4"),f.varyings.add("vColor","vec4"),f.vertex.code.add(u.glsl`void forwardVertexColor() { vColor = color; }`),f.vertex.code.add(u.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):f.vertex.code.add(u.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/interfaces"],function(a,u,f,p){function t(w,e){0===e.normalType||1===e.normalType?(w.include(u.NormalAttribute,e),w.varyings.add("vNormalWorld","vec3"),w.varyings.add("vNormalView","vec3"),w.vertex.uniforms.add("uTransformNormal_GlobalFromModel",
"mat3"),w.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),w.vertex.code.add(p.glsl`void forwardNormal() {
vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
}`)):2===e.normalType?(w.include(f.VertexPosition,e),w.varyings.add("vNormalWorld","vec3"),w.vertex.code.add(p.glsl`
    void forwardNormal() {
      vNormalWorld = ${1===e.viewingMode?p.glsl`normalize(vPositionWorldCameraRelative);`:p.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):w.vertex.code.add(p.glsl`void forwardNormal() {}`)}(function(w){w.bindUniforms=function(e,n){e.setUniformMatrix4fv("viewNormal",n)}})(t||(t={}));a.VertexNormal=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),
function(a,u,f,p,t,w,e){function n(b,h){b.include(t.PositionAttribute);b.vertex.include(w.DoublePrecision,h);b.varyings.add("vPositionWorldCameraRelative","vec3");b.varyings.add("vPosition_view","vec3");b.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");b.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");b.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");b.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");b.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");
b.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3");b.vertex.uniforms.add("uTransform_ProjFromView","mat4");b.vertex.code.add(e.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`);b.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");b.fragment.code.add(e.glsl`vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`)}(function(b){b.ModelTransform=function(){this.worldFromModel_RS=u.create();this.worldFromModel_TH=p.create();this.worldFromModel_TL=p.create()};b.ViewProjectionTransform=function(){this.worldFromView_TH=p.create();this.worldFromView_TL=p.create();this.viewFromCameraRelative_RS=u.create();this.projFromView=f.create()};b.bindModelTransform=function(h,k){h.setUniformMatrix3fv("uTransform_WorldFromModel_RS",k.worldFromModel_RS);h.setUniform3fv("uTransform_WorldFromModel_TH",k.worldFromModel_TH);h.setUniform3fv("uTransform_WorldFromModel_TL",
k.worldFromModel_TL)};b.bindViewProjTransform=function(h,k){h.setUniform3fv("uTransform_WorldFromView_TH",k.worldFromView_TH);h.setUniform3fv("uTransform_WorldFromView_TL",k.worldFromView_TL);h.setUniformMatrix4fv("uTransform_ProjFromView",k.projFromView);h.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",k.viewFromCameraRelative_RS)}})(n||(n={}));a.VertexPosition=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){a.DefaultMaterialAuxiliaryPasses=function(l,m){const z=l.vertex.code,r=l.fragment.code;if(1===m.output||3===m.output)l.include(f.Transform,{linearDepth:!0}),l.include(t.TextureCoordinateAttribute,m),l.include(b.VisualVariables,m),l.include(e.OutputDepth,m),l.include(u.Slice,m),l.vertex.uniforms.add("cameraNearFar","vec2"),l.varyings.add("depth","float"),m.hasColorTexture&&l.fragment.uniforms.add("tex","sampler2D"),z.add(k.glsl`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
forwardTextureCoordinates();
}`),l.include(h.DiscardOrAdjustAlpha,m),r.add(k.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${m.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);2===m.output&&(l.include(f.Transform,{linearDepth:!1}),l.include(p.NormalAttribute,m),l.include(w.VertexNormal,m),l.include(t.TextureCoordinateAttribute,m),l.include(b.VisualVariables,m),m.hasColorTexture&&l.fragment.uniforms.add("tex","sampler2D"),l.vertex.uniforms.add("viewNormal","mat4"),l.varyings.add("vPositionView","vec3"),z.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===m.normalType?k.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),l.include(u.Slice,m),l.include(h.DiscardOrAdjustAlpha,m),r.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${m.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===m.normalType?k.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:k.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));4===m.output&&(l.include(f.Transform,{linearDepth:!1}),l.include(t.TextureCoordinateAttribute,m),l.include(b.VisualVariables,m),m.hasColorTexture&&l.fragment.uniforms.add("tex","sampler2D"),z.add(k.glsl`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),l.include(u.Slice,m),l.include(h.DiscardOrAdjustAlpha,m),l.include(n.OutputHighlight),r.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${m.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,u,f){a.ComputeNormalTexture=function(p,t){const w=p.fragment;t.vertexTangents?(p.attributes.add("tangent","vec4"),p.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?w.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):w.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(p.extensions.add("GL_OES_standard_derivatives"),w.code.add(f.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));0!==t.attributeTextureCoordinates&&(p.include(u.VertexTextureCoordinates,t),w.uniforms.add("normalTexture","sampler2D"),w.uniforms.add("normalTextureSize","vec2"),w.code.add(f.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.EvaluateAmbientOcclusion=function(f,p){f=f.fragment;p.receiveAmbientOcclusion?(f.uniforms.add("ssaoTex","sampler2D"),f.uniforms.add("viewportPixelSz","vec4"),f.code.add(u.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):f.code.add(u.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),function(a,u,f,p,t,w,e,n){a.EvaluateSceneLighting=function(b,h){const k=b.fragment;
b.include(p.EvaluateMainLighting);b.include(f.EvaluateAmbientOcclusion,h);0!==h.pbrMode&&b.include(t.PhysicallyBasedRendering,h);b.include(u.EvaluateAmbientLighting,h);h.receiveShadows&&b.include(e.ReadShadowMap,h);k.uniforms.add("lightingGlobalFactor","float");k.uniforms.add("ambientBoostFactor","float");b.include(w.PiUtils);k.code.add(n.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===h.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);k.code.add(n.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${1===h.viewingMode?n.glsl`normalize(vPosWorld)`:n.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);k.code.add(n.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(0===h.pbrMode||4===h.pbrMode)k.code.add(n.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(1===h.pbrMode||2===h.pbrMode)k.code.add(n.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),k.code.add(n.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),k.code.add(n.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = abs(dot(normal, ambientDir));
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),k.code.add(n.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),k.code.add(n.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===h.pbrMode?n.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:n.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.EvaluateAmbientLighting=function(f,p){f=f.fragment;const t=void 0!==p.lightingSphericalHarmonicsOrder?p.lightingSphericalHarmonicsOrder:2;0===t?(f.uniforms.add("lightingAmbientSH0","vec3"),f.code.add(u.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===t?(f.uniforms.add("lightingAmbientSH_R","vec4"),f.uniforms.add("lightingAmbientSH_G","vec4"),f.uniforms.add("lightingAmbientSH_B","vec4"),f.code.add(u.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===t&&(f.uniforms.add("lightingAmbientSH0","vec3"),f.uniforms.add("lightingAmbientSH_R1","vec4"),f.uniforms.add("lightingAmbientSH_G1","vec4"),f.uniforms.add("lightingAmbientSH_B1","vec4"),f.uniforms.add("lightingAmbientSH_R2","vec4"),f.uniforms.add("lightingAmbientSH_G2","vec4"),f.uniforms.add("lightingAmbientSH_B2","vec4"),f.code.add(u.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==p.pbrMode&&2!==p.pbrMode||f.code.add(u.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.EvaluateMainLighting=function(f){f=f.fragment;f.uniforms.add("lightingMainDirection","vec3");f.uniforms.add("lightingMainIntensity","vec3");f.uniforms.add("lightingFixedFactor","float");f.code.add(u.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Normals=function(f,p){f=f.fragment;f.code.add(u.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);1===p.doubleSidedMode?f.code.add(u.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`):2===p.doubleSidedMode?f.code.add(u.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`):f.code.add(u.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../../../webgl/RenderingContext"],function(a,u,f){a.HeaderComment=function(p,t){t=u.glsl`
  /*
  *  ${t.name}
  *  ${0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":""}
  */
  `;f.webglValidateShadersEnabled()&&(p.fragment.code.add(t),p.vertex.code.add(t))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,u,f){a.MixExternalColor=function(p){p.include(u.ColorConversion);p.code.add(f.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${f.glsl.int(1)}) {
        return allMixed;
      }
      else if (mode == ${f.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${f.glsl.int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${f.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${f.glsl.int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ../lib/Program ./DefaultMaterialTechnique".split(" "),function(a,u,f,p,t,w,e,n,b){b=function(h){function k(){return h.apply(this,arguments)||
this}f._inheritsLoose(k,h);k.prototype.initializeProgram=function(l){var m=k.shader.get();const z=this.configuration;m=m.build({OITEnabled:0===z.transparencyPassType,output:z.output,viewingMode:l.viewingMode,receiveShadows:z.receiveShadows,slicePlaneEnabled:z.slicePlaneEnabled,sliceHighlightDisabled:z.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:z.symbolColors,vvSize:z.vvSize,vvColor:z.vvColor,vvInstancingEnabled:!0,instanced:z.instanced,instancedColor:z.instancedColor,instancedDoublePrecision:z.instancedDoublePrecision,
pbrMode:z.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:z.hasColorTexture,receiveAmbientOcclusion:z.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:z.hasColorTexture?1:0,textureAlphaPremultiplied:z.textureAlphaPremultiplied,attributeColor:z.vertexColors,screenSizePerspectiveEnabled:z.screenSizePerspective,verticalOffsetEnabled:z.verticalOffset,
offsetBackfaces:z.offsetBackfaces,doublePrecisionRequiresObfuscation:t.doublePrecisionRequiresObfuscation(l.rctx),alphaDiscardMode:z.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:z.multipassTerrainEnabled,cullAboveGround:z.cullAboveGround});return new n.Program(l.rctx,m,e.Default3D)};return k}(b.DefaultMaterialTechnique);b.shader=new w.ReloadableShaderModule(p.RealisticTreeShader,()=>new Promise(function(h,k){a(["../core/shaderLibrary/default/RealisticTree.glsl"],h,k)}));u.RealisticTreeTechnique=
b;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){function v(F){const L=new B.ShaderBuilder,N=L.vertex.code,I=L.fragment.code;L.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");L.include(n.PositionAttribute);L.varyings.add("vpos","vec3");L.include(y.VisualVariables,F);L.include(w.InstancedDoublePrecision,F);L.include(l.VerticalOffset,F);if(0===F.output||7===F.output)L.include(e.NormalAttribute,F),L.include(t.Transform,{linearDepth:!1}),
F.offsetBackfaces&&L.include(f.Offset),F.instancedColor&&L.attributes.add("instanceColor","vec4"),L.varyings.add("vNormalWorld","vec3"),L.varyings.add("localvpos","vec3"),F.multipassTerrainEnabled&&L.varyings.add("depth","float"),L.include(h.TextureCoordinateAttribute,F),L.include(u.ForwardLinearDepth,F),L.include(b.SymbolColor,F),L.include(k.VertexColor,F),L.vertex.uniforms.add("externalColor","vec4"),L.varyings.add("vcolorExt","vec4"),N.add(C.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${F.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${C.glsl.float(x.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${F.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${F.multipassTerrainEnabled?C.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);7===F.output&&(L.include(p.Slice,F),L.include(x.DiscardOrAdjustAlpha,F),F.multipassTerrainEnabled&&(L.fragment.include(z.ReadLinearDepth),L.include(d.multipassTerrainTest,F)),L.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),L.fragment.uniforms.add("view","mat4"),F.hasColorTexture&&L.fragment.uniforms.add("tex","sampler2D"),L.fragment.include(D.MixExternalColor),I.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${F.hasColorTexture?C.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${F.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        ${F.attributeColor?C.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));0===F.output&&(L.include(p.Slice,F),L.include(c.EvaluateSceneLighting,F),L.include(r.EvaluateAmbientOcclusion,F),L.include(x.DiscardOrAdjustAlpha,F),F.receiveShadows&&L.include(q.ReadShadowMap,F),F.multipassTerrainEnabled&&(L.fragment.include(z.ReadLinearDepth),L.include(d.multipassTerrainTest,F)),L.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),L.fragment.uniforms.add("view","mat4"),
F.hasColorTexture&&L.fragment.uniforms.add("tex","sampler2D"),L.include(A.PhysicallyBasedRenderingParameters,F),L.include(g.PhysicallyBasedRendering,F),L.fragment.include(D.MixExternalColor),I.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${F.hasColorTexture?C.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${F.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:C.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===F.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${F.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===F.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${F.attributeColor?C.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${C.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===F.pbrMode||2===F.pbrMode?1===F.viewingMode?C.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:C.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:C.glsl``}
        ${1===F.pbrMode||2===F.pbrMode?C.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${F.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));L.include(m.DefaultMaterialAuxiliaryPasses,F);return L}var E=Object.freeze({__proto__:null,build:v});a.RealisticTreeShader=E;a.build=v})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/has ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V){function Y(fa){return b.isSome(fa)?"cross"===fa||"x"===fa:!1}const W=m.create(),ba=r.fromValues(0,0,1),ca=[.25,.25,.75,.75];t=function(fa){function R(Z,T,P,X){Z=fa.call(this,Z,T,P,X)||this;Z._cimLayers=null;Z._cimSymbolMaterials=new Map;Z._cimSymbolTextures=new Map;Z._cimMaterialParametersInfo=null;Z._cimRequiredFields=null;Z._cimScaleFactorOrFunction=null;Z._size=null;Z._symbolTextureRatio=1;Z._outlineSize=
0;Z._texture=null;Z._releaseTexture=null;Z._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return Z}f._inheritsLoose(R,fa);var U=R.prototype;U.getCachedSize=function(){return{size:this._getIconSize()}};U.doLoad=function(){var Z=f._asyncToGenerator(function*(T){this._validateOrThrow();const P=this._prepareMaterialParameters();var X=this._getPrimitive();if(b.isSome(X))this._prepareResourcesPrimitive(P,X);else{X=x.getIconHref(this.symbol,this.symbolLayer);const aa=l.dataComponents(X);
aa&&"application/json"===aa.mediaType?yield this._prepareResourcesCIM(P,JSON.parse(aa.data),T):yield this._prepareResourcesHref(P,X,T)}});return function(T){return Z.apply(this,arguments)}}();U._validateOrThrow=function(){if(!this._drivenProperties.size){var Z=I.validateSymbolLayerSize(this._getIconSize());if(Z)throw new n("graphics3diconsymbollayer:invalid-size",Z);}};U._getIconSize=function(){var Z=this.symbolLayer;Z=Math.round(null!=Z.size?k.pt2px(Z.size):16);return this._drivenProperties.size?
Math.max(Z,64):Z};U._generateTextureCIM=function(Z){const T=this._getGraphicHash(Z);let P=""===T?null:this._cimSymbolTextures.get(T);P||(Z=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,Z,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",Z.anchorPosition),P=new Q.Texture(Z.imageData,{width:Z.imageData.width,height:Z.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(T,
P),this._context.stage.add(P));return P};U._computeSize=function(Z,T){Z=Z.width/Z.height;return 1<Z?[T,Math.round(T/Z)]:[Math.round(T*Z),T]};U._prepareMaterialParameters=function(){const Z={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},T=this.symbol;if(T&&"point-3d"===T.type&&T.hasVisibleVerticalOffset()){const {screenLength:P,minWorldLength:X,maxWorldLength:aa}=T.verticalOffset;Z.verticalOffset={screenLength:k.pt2px(P),minWorldLength:X||0,maxWorldLength:null!=
aa?aa:Infinity}}this._context.screenSizePerspectiveEnabled&&(Z.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);Z.occlusionTest=!0;Z.slicePlaneEnabled=this._context.slicePlaneEnabled;return Z};U._prepareResourcesPrimitive=function(Z,T){var P=this._getOutlineSize();if(Y(T)&&0===P)throw Error("Nothing to render");this._outlineSize=P;Z.color=this._getFillColor();Z.outlineColor=this._getOutlineColor();Z.outlineSize=this._outlineSize;const X=this._context.sharedResources.textures.fromData(T,
()=>{switch(T){case "circle":var aa=K.createCircle(128,64);break;case "square":aa=K.createSquare(128,64);break;case "kite":aa=K.createKite(128,64);break;case "cross":aa=K.createCross(128,64);break;case "x":aa=K.createX(128,64);break;case "triangle":aa=K.createTriangle(128,64)}return aa=new Q.Texture(aa,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=X.texture;this._releaseTexture=()=>this._context.sharedResources.textures.release(X.uid);Z.textureIsSignedDistanceField=
!0;Z.distanceFieldBoundingBox=ca;Z.textureId=this._texture.id;P=this._getIconSize();this._size=[P,P];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(Z,this._context.stage)};U._prepareResourcesHref=function(){var Z=f._asyncToGenerator(function*(T,P,X){if(!e("esri-canvas-svg-support")&&l.isSVG(P))throw new n("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();T.color=this._getFillColor();
T.outlineColor=this._getOutlineColor();T.outlineSize=this._outlineSize;T.textureIsSignedDistanceField=!1;const aa=this._getIconSize();X=yield w.result(this._context.sharedResources.textures.fromUrl(P,aa*this._context.layerView.view.pixelRatio,{signal:X}));if(!1===X.ok)throw h.throwIfAbortError(X.error),new n("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${P})`);const {uid:ja,texture:ia}=X.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(ja);
this._size=this._computeSize(ia.params,aa);T.textureId=ia.id;this._createMaterialAndAddToStage(T,this._context.stage)});return function(T,P,X){return Z.apply(this,arguments)}}();U._prepareResourcesCIM=function(){var Z=f._asyncToGenerator(function*(T,P,X){P=new V({data:P});if(!this._context.sharedResources.cimSymbolRasterizer){var aa=(yield new Promise(function(na,ta){a(["../../../../symbols/cim/CIMSymbolRasterizer"],na,ta)})).CIMSymbolRasterizer;h.throwIfAborted(X);this._context.sharedResources.cimSymbolRasterizer||
(this._context.sharedResources.cimSymbolRasterizer=new aa(this._context.renderCoordsHelper.spatialReference,!0))}aa=this._context.layer.fields?this._context.layer.fields.map(na=>na.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(P,aa,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:X});let ja;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&
this._context.renderer.scaleExpression)if(P=this._context.renderer,isNaN(P.scaleExpression)){const na=yield q.createRendererExpression(P.scaleExpression,this._context.layer.spatialReference,aa);ja=(ta,pa,xa)=>{ta=D(na,ta,{$view:xa},"esriGeometryPoint",pa);return null!==ta?ta:1}}else var ia=Number(P.scaleExpression);this._cimScaleFactorOrFunction=ia||ja||1;ia=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];h.throwIfAborted(X);const ka=this._context.layer.fieldsIndex;
this._cimRequiredFields=ia.map(na=>ka.get(na).name);this._cimMaterialParametersInfo=T;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1});return function(T,P,X){return Z.apply(this,arguments)}}();U._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||
y.defaultPrimitive};U._getOutlineSize=function(){var Z=0;Z=this.symbolLayer;if(b.isSome(Z.outline)&&null!=Z.outline.size)return Math.max(k.pt2px(Z.outline.size),0);Z=this._getPrimitive();Z=Y(Z)?1.5:0;return Math.max(Z,0)};U._getOutlineColor=function(){const Z=this._getLayerOpacity(),T=b.get(this.symbolLayer,"outline","color");if(b.isSome(T)){const P=p.toUnitRGB(T);return[P[0],P[1],P[2],T.a*Z]}return[0,0,0,0]};U._getFillColor=function(){if(Y(this._getPrimitive()))return C.TRANSPARENT_UNIT;const Z=
b.isNone(this._getPrimitive()),T=b.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(T,{hasIntrinsicColor:Z})};U._getAnchorPos=function(Z,T){return"relative"===Z?z.fromValues((T.x||0)+.5,-(T.y||0)+.5):Z in I.namedAnchorToHUDMaterialAnchorPos?I.namedAnchorToHUDMaterialAnchorPos[Z]:I.namedAnchorToHUDMaterialAnchorPos.center};U._createMaterialAndAddToStage=function(Z,T){this._fastUpdates=this._cimLayers?{enabled:!1}:H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled&&Object.assign(Z,this._fastUpdates.materialParameters);if(this._cimLayers){let P=this._cimSymbolMaterials.get(Z.textureId);P||(P=new S.HUDMaterial(Z),this._cimSymbolMaterials.set(Z.textureId,P),T.add(P));return P}this._material=new S.HUDMaterial(Z);T.add(this._material);return this._material};U._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(Z=>{Z.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,
shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};U.destroy=function(){fa.prototype.destroy.call(this);this._forEachMaterial(Z=>this._context.stage.remove(Z));this._material=null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(Z=>this._context.stage.remove(Z));this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};U._getScaleFactor=function(Z,T){if(this._drivenProperties.size&&Z.size){for(let P=0;3>P;P++){const X=
Z.size[P];X&&"symbol-value"!==X&&"proportional"!==X&&(Z.size[P]=k.pt2px(X))}if("symbol-value"===Z.size[0])return 1;if(isFinite(+Z.size[0]))return+Z.size[0]/T;if(isFinite(+Z.size[2]))return+Z.size[2]/T}return 1};U.createGraphics3DGraphic=function(Z){const T=Z.graphic;if(!this._validateGeometry(T.geometry))return null;let P;if(this._cimLayers){if(!this._cimLayers.length)return null;var X=this._generateTextureCIM(T);P=this._createMaterialAndAddToStage({textureId:X.id,...this._cimMaterialParametersInfo},
this._context.stage);var aa=[X.params.width,X.params.height]}else aa=this._size,P=b.unwrap(this._material);X=G.placePointOnGeometry(T.geometry);if(b.isNone(X))return this.logger.warn(`unsupported geometry type for icon symbol: ${T.geometry.type}`),null;var ja=Z.renderingInfo;const ia=this._getVertexOpacityAndColor(ja);let ka=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(ka=this._getScaleFactor(ja,aa[0]>aa[1]?aa[0]:aa[1]));ka*=this._symbolTextureRatio;aa=[aa[0]*ka,aa[1]*ka];
ja=this.setGraphicElevationContext(T,new E.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ja.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(T,X,P,ia,aa,Z.layer.uid):this._createAs3DShape(T,X,P,ia,aa,ja,T.uid)};U.layerOpacityChanged=function(){const Z=this._getFillColor(),T=this._getOutlineColor();this._forEachMaterial(P=>{P.setParameterValues({color:Z});P.setParameterValues({outlineColor:T})});return!0};U.layerElevationInfoChanged=function(Z,
T,P){const X=this._elevationContext.mode;P=v.elevationModeChangeUpdateType(R.elevationModeChangeTypes,P,X);if(P!==v.SymbolUpdateType.UPDATE)return P;const aa=v.needsElevationUpdates2D(X)||"absolute-height"===X;return this.updateGraphics3DGraphicElevationInfo(Z,T,()=>aa)};U.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(Z=>{Z.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};U.physicalBasedRenderingChanged=function(){return!0};U.pixelRatioChanged=
function(){return this._getPrimitive()?!0:!1};U.applyRendererDiff=function(Z,T){for(const P in Z.diff)switch(P){case "visualVariables":if(H.updateFastSymbolUpdatesState(this._fastUpdates,T,this._fastVisualVariableConvertOptions()))b.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};U._defaultElevationInfoNoZ=function(){return da};U._createAs3DShape=function(Z,T,P,X,aa,ja,ia){const ka=this.getFastUpdateAttrValues(Z);
Z=ka?ta=>H.evaluateModelTransform(this._fastUpdates.materialParameters,ka,ta):null;X=[M.createPointGeometry(ba,null,X,aa,ha,null,ka)];ia=G.createStageObjectForHUD(this._context,T,X,[P],null,null,ja,this._context.layer.uid,ia,Z);if(null===ia)return null;const na=new L.Graphics3DObject3DGraphicLayer(this,ia.object,X,null,null,B.perObjectElevationAligner,ja);na.alignedSampledElevation=ia.sampledElevation;na.needsElevationUpdates=v.needsElevationUpdates2D(ja.mode)||"absolute-height"===ja.mode;na.getScreenSize=
this._createScreenSizeGetter(aa,Z);na.calculateRelativeScreenBounds=ta=>P.calculateRelativeScreenBounds(na.getScreenSize(),1,ta);G.extendPointGraphicElevationContext(na,T,this._context.elevationProvider);return na};U._createAsOverlay=function(Z,T,P,X,aa,ja){P.renderPriority=this._renderPriority;const ia=d.create();g.projectPointToVector(T,ia,this._context.overlaySR);ia[2]=J.DRAPED_Z;T=this._context.clippingExtent;if(b.isSome(T)&&!A.containsPoint(T,ia))return null;const ka=this.getFastUpdateAttrValues(Z);
T=ka?ta=>H.evaluateModelTransform(this._fastUpdates.materialParameters,ka,ta):null;X=M.createPointGeometry(ba,ia,X,aa,null,null,ka);Z=new O.RenderGeometry(X,P,ja,Z.uid);ia[3]=0;c.copy(Z.boundingSphere,ia);Z.calculateShaderTransformation=T;const na=new F(this,[Z],null);na.getScreenSize=this._createScreenSizeGetter(aa,T);na.calculateRelativeScreenBounds=ta=>P.calculateRelativeScreenBounds(na.getScreenSize(),1,ta);return na};U._createScreenSizeGetter=function(Z,T){const P=this._outlineSize+2;if(this._fastUpdates.enabled){const X=
Z[0]/this._symbolTextureRatio,aa=Z[1]/this._symbolTextureRatio;return(ja=z.create())=>{const ia=T(W);ja[0]=ia[0]*X+P;ja[1]=ia[5]*aa+P;return ja}}{const X=Z[0]/this._symbolTextureRatio+P,aa=Z[1]/this._symbolTextureRatio+P;return(ja=z.create())=>{ja[0]=X;ja[1]=aa;return ja}}};U._fastVisualVariableConvertOptions=function(){var Z=this._size[0]>this._size[1]?this._size[0]:this._size[1];const T=r.fromValues(Z,Z,Z),P=k.px2pt(1);Z*=P;Z=r.fromValues(Z,Z,Z);return{modelSize:T,symbolSize:Z,unitInMeters:P,transformation:{anchor:r.ZEROS,
scale:r.ONES,rotation:r.ZEROS}}};U._getGraphicHash=function(Z){let T="";for(const P of this._cimRequiredFields)T+=P+Z.attributes[P];return T};U._forEachMaterial=function(Z){b.isSome(this._material)&&Z(this._material);this._cimSymbolMaterials.forEach(Z)};return R}(N.Graphics3DSymbolLayer);t.PRIMITIVE_SIZE=[64,64];t.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.UPDATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};const da={mode:"relative-to-ground",
offset:0},ha=d.fromValues(0,0,0,1);u.Graphics3DIconSymbolLayer=t;u.default=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,u,f){function p(w){const e={};switch(w){case "esriGeometryPoint":return(n,b,h,k)=>f.unquantizePoint(b,e,n,h,k);case "esriGeometryPolygon":return(n,b,h,k)=>f.unquantizePolygon(b,e,n,h,k);case "esriGeometryPolyline":return(n,
b,h,k)=>f.unquantizePolyline(b,e,n,h,k);case "esriGeometryMultipoint":return(n,b,h,k)=>f.unquantizeMultipoint(b,e,n,h,k);default:return u.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${w}`)),n=>n}}const t=new Map;return function(w,e,n,b,h){if(w.referencesGeometry()&&h){{const {transform:k,hasZ:l,hasM:m}=h;t.has(b)||t.set(b,p(b));b=t.get(b)(e.geometry,k,l,m);e={...e,geometry:b}}}e=w.repurposeFeature(e);try{return w.evaluate({...n,$feature:e})}catch(k){return u.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
k),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,u){const f=u.ZEROS;u=u.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=f;a.WHITE_UNIT=u;a.defaultIconElevationOffset=1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(a,u,f,p,t,w,e){let n=function(){function l(z,r,c){this.graphics3DSymbolLayer=z;this.renderGeometries=r;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}var m=l.prototype;m.initialize=function(z,r,c){this.stage=z;this._layerView=c;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};m.setVisibility=function(z){if(null!=this.stage&&this._visible!==z)if((this._visible=z)&&!this._addedToStage)this._addedToStage=
!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);else if(z||this._addedToStage){for(const r of this.renderGeometries)r.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}};m.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};m.getCenterObjectSpace=function(z=p.create()){return f.set(z,
0,0,0)};m.getBoundingBoxObjectSpace=function(z=t.create()){return t.empty(z)};m.addObjectState=function(z,r){0===z&&(this.renderGeometries.forEach(c=>{const d=c.addHighlight();r.addRenderGeometry(c,d,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};m.removeObjectState=function(z){this.renderGeometries.forEach(r=>{z.removeRenderGeometry(r)})};m.removeRenderGeometryObjectState=function(z,r){z.removeHighlight(r);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,
this._layerView)};m.computeAttachmentOrigin=function(z){for(const r of this.renderGeometries)r.computeAttachmentOrigin(k)&&(z.draped.origin[0]+=k[0],z.draped.origin[1]+=k[1],z.draped.num++)};m.getProjectedBoundingBox=function(){var z=a._asyncToGenerator(function*(r,c,d,g,A){t.empty(A);for(let q=0;q<this.renderGeometries.length;q++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[q],r,b,d),t.expandWithRect(A,b);if(c){t.center(A,k);let q;r=e.demResolutionForBoundingBox(A,c);try{q=
yield c.service.queryElevation(k[0],k[1],g,r,"ground")}catch(y){}u.isSome(q)&&(A[2]=Math.min(A[2],q),A[5]=Math.max(A[5],q))}return A});return function(r,c,d,g,A){return z.apply(this,arguments)}}();m._getRenderGeometryProjectedBoundingRect=function(z,r,c,d){if(this.boundingBox)t.set(h,this.boundingBox);else{z=z.boundingSphere;const g=z[3];h[0]=z[0]-g;h[1]=z[1]-g;h[2]=z[2]-g;h[3]=z[0]+g;h[4]=z[1]+g;h[5]=z[2]+g}r(h,0,2);this.calculateRelativeScreenBounds&&d.push({location:t.center(h),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return t.toRect(h,c)};return l}();const b=w.create(),h=t.create(),k=p.create();return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/Util"],function(a,u,f){function p(l,m){const z=new Uint8Array(4*l*l),r=l/2-.5;m/=2;for(let d=0;d<l;d++)for(let g=0;g<l;g++){const A=g+l*d;var c=g-r;const q=d-r;c=Math.sqrt(c*c+q*q)-m;c=c/l+.5;f.packFloatRGBA(c,z,4*A)}return z}function t(l,m){return h(l,m,!1)}function w(l,m){return h(l,m,
!0)}function e(l,m){return k(l,m,!1)}function n(l,m){return k(l,m,!0)}function b(l,m){const z=new Uint8Array(4*l*l),r=Math.sqrt(1.25),c=(l-m)/2;for(let d=0;d<l;d++)for(let g=0;g<l;g++){const A=(g-c)/m,q=(d-c+.75)/m;f.packFloatRGBA(Math.max(-(1*A+-.5*q)/r,(A-1+-.5*-q)/r,-q)*m/l+.5,z,4*(d*l+g))}return z}function h(l,m,z){z&&(m/=Math.SQRT2);const r=new Uint8Array(4*l*l);for(let d=0;d<l;d++)for(let g=0;g<l;g++){var c=g-.5*l+.25;let A=-d+.5*l-.75;const q=d*l+g;if(z){const y=(c+A)/Math.SQRT2;A=(A-c)/Math.SQRT2;
c=y}c=Math.max(Math.abs(c),Math.abs(A))-.5*m;c=c/l+.5;f.packFloatRGBA(c,r,4*q)}return r}function k(l,m,z){z&&(m*=Math.SQRT2);m*=.5;const r=new Uint8Array(4*l*l);for(let d=0;d<l;d++)for(let g=0;g<l;g++){var c=g-.5*l;let A=-d+.5*l-1;const q=d*l+g;if(z){const y=(c+A)/Math.SQRT2;A=(A-c)/Math.SQRT2;c=y}c=Math.abs(c);A=Math.abs(A);c=c>A?c>m?Math.sqrt((c-m)*(c-m)+A*A):A:A>m?Math.sqrt(c*c+(A-m)*(A-m)):c;c=c/l+.5;f.packFloatRGBA(c,r,4*q)}return r}a.createCircle=p;a.createCross=e;a.createKite=w;a.createSquare=
t;a.createTriangle=b;a.createType=function(l,m,z){switch(l){case "circle":return p(m,z);case "square":return t(m,z);case "cross":return e(m,z);case "x":return n(m,z);case "kite":return w(m,z);case "triangle":return b(m,z);default:return p(m,z)}};a.createX=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(I){return null!==I&&void 0!==I}function m(I){return"number"===typeof I}function z(I){return"string"===typeof I}function r(I,G){I&&I.push(G)}function c(I,G,K,H=e.create()){I=I||0;G=G||0;K=K||0;0!==I&&w.rotateZ(H,H,-I/180*Math.PI);0!==G&&w.rotateX(H,H,G/180*Math.PI);0!==K&&w.rotateY(H,H,K/180*Math.PI);return H}function d(I,G,K,H,J){const M=I.minSize,O=I.maxSize;if(I.expression)return r(J,"Could not convert size info: expression not supported"),!1;if(I.useSymbolValue)return I=
H.symbolSize[K],G.minSize[K]=I,G.maxSize[K]=I,G.offset[K]=G.minSize[K],G.factor[K]=0,G.type[K]=1,!0;if(l(I.field)){if(l(I.stops)){if(2===I.stops.length&&m(I.stops[0].size)&&m(I.stops[1].size))return g(I.stops[0].size,I.stops[1].size,I.stops[0].value,I.stops[1].value,G,K),G.type[K]=1,!0;r(J,"Could not convert size info: stops only supported with 2 elements");return!1}if(m(M)&&m(O)&&l(I.minDataValue)&&l(I.maxDataValue))return g(M,O,I.minDataValue,I.maxDataValue,G,K),G.type[K]=1,!0;if(null!=h.meterIn[I.valueUnit])return G.minSize[K]=
-Infinity,G.maxSize[K]=Infinity,G.offset[K]=0,G.factor[K]=1/h.meterIn[I.valueUnit],G.type[K]=1,!0;if("unknown"===I.valueUnit)return r(J,"Could not convert size info: proportional size not supported"),!1;r(J,"Could not convert size info: scale-dependent size not supported");return!1}if(!l(I.field)){if(I.stops&&I.stops[0]&&m(I.stops[0].size))return G.minSize[K]=I.stops[0].size,G.maxSize[K]=I.stops[0].size,G.offset[K]=G.minSize[K],G.factor[K]=0,G.type[K]=1,!0;if(m(M))return G.minSize[K]=M,G.maxSize[K]=
M,G.offset[K]=M,G.factor[K]=0,G.type[K]=1,!0}r(J,"Could not convert size info: unsupported variant of sizeInfo");return!1}function g(I,G,K,H,J,M){H=0<Math.abs(H-K)?(G-I)/(H-K):0;J.minSize[M]=0<H?I:G;J.maxSize[M]=0<H?G:I;J.offset[M]=I-K*H;J.factor[M]=H}function A(I,G,K,H){if(I.normalizationField||I.valueRepresentation)return r(H,"Could not convert size info: unsupported property"),null;var J=I.field;if(null!=J&&!z(J))return r(H,"Could not convert size info: field is not a string"),null;if(!G.size)G.size=
{field:I.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(I.field)if(!G.size.field)G.size.field=I.field;else if(I.field!==G.size.field)return r(H,"Could not convert size info: multiple fields in use"),null;switch(I.axis){case "width":return(J=d(I,G.size,0,K,H))?G:null;case "height":return(J=d(I,G.size,2,K,H))?G:null;case "depth":return(J=d(I,G.size,1,K,H))?G:null;case "width-and-depth":return(J=d(I,G.size,0,K,H))&&d(I,G.size,1,K,H),J?G:null;case null:case void 0:case "all":return(J=
(J=(J=d(I,G.size,0,K,H))&&d(I,G.size,1,K,H))&&d(I,G.size,2,K,H))?G:null;default:return r(H,`Could not convert size info: unknown axis "${I.axis}""`),null}}function q(I,G,K){for(let H=0;3>H;++H){let J=G.unitInMeters;1===I.type[H]&&(J*=G.modelSize[H],I.type[H]=2);I.minSize[H]/=J;I.maxSize[H]/=J;I.offset[H]/=J;I.factor[H]/=J}if(0!==I.type[0])G=0;else if(0!==I.type[1])G=1;else if(0!==I.type[2])G=2;else return r(K,"No size axis contains a valid size or scale"),!1;for(K=0;3>K;++K)0===I.type[K]&&(I.minSize[K]=
I.minSize[G],I.maxSize[K]=I.maxSize[G],I.offset[K]=I.offset[G],I.factor[K]=I.factor[G],I.type[K]=I.type[G]);return!0}function y(I,G,K){I[4*G]=K.r/255;I[4*G+1]=K.g/255;I[4*G+2]=K.b/255;I[4*G+3]=K.a}function x(I,G,K){if(I.normalizationField)return r(K,"Could not convert color info: unsupported property"),null;if(z(I.field))if(I.stops){if(8<I.stops.length)return r(K,"Could not convert color info: too many color stops"),null;G.color={field:I.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};I=I.stops;for(K=0;8>K;++K){const H=I[Math.min(K,I.length-1)];G.color.values[K]=H.value;y(G.color.colors,K,H.color)}}else return r(K,"Could not convert color info: missing stops or colors"),null;else if(I.stops&&0<=I.stops.length)for(I=I.stops&&0<=I.stops.length&&I.stops[0].color,G.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},K=0;8>K;K++)G.color.values[K]=Infinity,y(G.color.colors,
K,I);else return r(K,"Could not convert color info: no field and no colors/stops"),null;return G}function D(I,G,K){if(I.normalizationField)return r(K,"Could not convert opacity info: unsupported property"),null;if(z(I.field))if(I.stops){if(8<I.stops.length)return r(K,"Could not convert opacity info: too many opacity stops"),null;G.opacity={field:I.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};I=I.stops;for(K=0;8>K;++K){const H=I[Math.min(K,I.length-1)];G.opacity.values[K]=H.value;
G.opacity.opacityValues[K]=H.opacity}}else return r(K,"Could not convert opacity info: missing stops or opacities"),null;else if(I.stops&&0<=I.stops.length)for(I=I.stops&&0<=I.stops.length&&I.stops[0].opacity,G.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},K=0;8>K;K++)G.opacity.values[K]=Infinity,G.opacity.opacityValues[K]=I;else return r(K,"Could not convert opacity info: no field and no opacities/stops"),null;return G}function C(I,G,K){I=2===K&&"arithmetic"===I.rotationType;
G.offset[K]=I?90:0;G.factor[K]=I?-1:1;G.type[K]=1}function B(I,G,K){if(!z(I.field))return r(K,"Could not convert rotation info: field is not a string"),null;if(!G.rotation)G.rotation={field:I.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(I.field)if(!G.rotation.field)G.rotation.field=I.field;else if(I.field!==G.rotation.field)return r(K,"Could not convert rotation info: multiple fields in use"),null;switch(I.axis){case "tilt":return C(I,G.rotation,0),G;case "roll":return C(I,G.rotation,
1),G;case null:case void 0:case "heading":return C(I,G.rotation,2),G;default:return r(K,`Could not convert rotation info: unknown axis "${I.axis}""`),null}}function v(I,G,K){if(!I)return null;const H=!G.supportedTypes||!!G.supportedTypes.size,J=!G.supportedTypes||!!G.supportedTypes.color,M=!G.supportedTypes||!!G.supportedTypes.rotation,O=!!G.supportedTypes&&!!G.supportedTypes.opacity,Q=I.reduce((S,V)=>{if(!S)return S;if(V.valueExpression)return r(K,"Could not convert visual variables: arcade expressions not supported"),
null;switch(V.type){case "size":return H?A(V,S,G,K):S;case "color":return J?x(V,S,K):S;case "opacity":return O?D(V,S,K):null;case "rotation":return M?B(V,S,K):S;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<I.length&&Q&&!Q.size&&!Q.color&&!Q.opacity&&!Q.rotation||Q&&Q.size&&!q(Q.size,G,K)?null:Q}function E(I,G,K){if(!!I!==!!G||I&&I.field!==G.field)return!1;if(I&&"rotation"===K)for(K=0;3>K;K++)if(I.type[K]!==G.type[K]||I.offset[K]!==G.offset[K]||I.factor[K]!==G.factor[K])return!1;
return!0}function F(I,G){const K={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},H=I&&null!=I.size;I&&I.size?(K.vvSizeEnabled=!0,K.vvSizeMinSize=I.size.minSize,K.vvSizeMaxSize=I.size.maxSize,K.vvSizeOffset=I.size.offset,K.vvSizeFactor=I.size.factor):I&&H&&(K.vvSizeValue=
G.transformation.scale);I&&H&&(K.vvSymbolAnchor=G.transformation.anchor,K.vvSymbolRotationMatrix=t.create(),w.identity(N),c(G.transformation.rotation[2],G.transformation.rotation[0],G.transformation.rotation[1],N),p.fromMat4(K.vvSymbolRotationMatrix,N));I&&I.color&&(K.vvColorEnabled=!0,K.vvColorValues=I.color.values,K.vvColorColors=I.color.colors);I&&I.opacity&&(K.vvOpacityEnabled=!0,K.vvOpacityValues=I.opacity.values,K.vvOpacityOpacities=I.opacity.opacityValues);return K}var L;(function(I){const G=
e.create(),K=b.create();I.evaluateModelTransform=function(H,J,M){if(!H.vvSizeEnabled)return M;w.copy(G,M);M=H.vvSymbolRotationMatrix;w.set(N,M[0],M[1],M[2],0,M[3],M[4],M[5],0,M[6],M[7],M[8],0,0,0,0,1);w.multiply(G,G,N);for(M=0;3>M;++M)K[M]=f.clamp(H.vvSizeOffset[M]+J[0]*H.vvSizeFactor[M],H.vvSizeMinSize[M],H.vvSizeMaxSize[M]);w.scale(G,G,K);w.translate(G,G,H.vvSymbolAnchor);return G};I.evaluateModelTransformScale=function(H,J,M){if(!J.vvSizeEnabled)return n.set(H,1,1,1);for(let O=0;3>O;++O)H[O]=f.clamp(J.vvSizeOffset[O]+
M[0]*J.vvSizeFactor[O],J.vvSizeMinSize[O],J.vvSizeMaxSize[O]);return H}})(L||(L={}));const N=e.create();u=L.evaluateModelTransform;L=L.evaluateModelTransformScale;a.convertVisualVariables=v;a.evaluateModelTransform=u;a.evaluateModelTransformScale=L;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(I,G){return!I||k.DISABLE_FAST_UPDATES?{enabled:!1}:(I=v(I.visualVariables,G))?{enabled:!0,visualVariables:I,materialParameters:F(I,G),requiresShaderTransformation:I&&null!=I.size}:{enabled:!1}};
a.updateFastSymbolUpdatesState=function(I,G,K){if(!G||!I.enabled)return!1;const H=I.visualVariables;G=v(G.visualVariables,K);if(!(G&&E(H.size,G.size,"size")&&E(H.color,G.color,"color")&&E(H.rotation,G.rotation,"rotation")&&E(H.opacity,G.opacity,"opacity")))return!1;I.visualVariables=G;I.materialParameters=F(G,K);I.requiresShaderTransformation=G&&null!=G.size;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./geometryDataUtils ./Object3DStateID ../materials/renderers/utils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){let m=function(){function r(d,g,A=null,q=null,y=p.generateUID(),x=null,D=null,C=!1){this.data=d;this.material=g;this.layerUid=A;this.graphicUid=q;this.id=y;this.boundingInfo=x;this.calculateShaderTransformation=D;this.castShadow=C;this.boundingSphere=n.create();this.instanceParameters={highlights:null,occludees:null,visible:!0};this._transformation=w.create();this._shaderTransformationDirty=!0}var c=r.prototype;c.updateTransformation=function(d){d(this._transformation);
this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};c.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};c.computeBoundingSphere=function(d,g,A=b.maxScale(d)){f.isNone(this.boundingInfo)||(e.transformMat4(g,this.boundingInfo.getCenter(),d),g[3]=this.boundingInfo.getBSRadius()*A)};c.getShaderTransformation=function(){if(f.isNone(this.calculateShaderTransformation))return f.unwrapOr(this.transformation,w.IDENTITY);this._shaderTransformationDirty&&
(this._shaderTransformation||(this._shaderTransformation=w.create()),t.copy(this._shaderTransformation,this.calculateShaderTransformation(f.unwrapOr(this.transformation,w.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};c.computeAttachmentOrigin=function(d){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,d)?(f.isSome(this._transformation)&&e.transformMat4(d,d,this._transformation),!0):!1;const g=this.indices.get("position"),
A=this.vertexAttributes.get("position");return h.computeAttachmentOriginTriangles(A,g,d)?(f.isSome(this._transformation)&&e.transformMat4(d,d,this._transformation),!0):!1};c.addHighlight=function(){const d=new k.Object3DStateID(0),g=this.instanceParameters;g.highlights=l.addObject3DStateID(g.highlights,d);return d};c.removeHighlight=function(d){const g=this.instanceParameters;g.highlights=l.removeObject3DStateID(g.highlights,d)};u._createClass(r,[{key:"transformation",get:function(){return this._transformation}},
{key:"hasShaderTransformation",get:function(){return f.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return r}(),z=function(r){function c(){return r.apply(this,arguments)||this}u._inheritsLoose(c,r);return c}(m);a.RenderGeometry=m;a.ValidatedRenderGeometry=z;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./BasisUtil ./ContentObject ./DDSUtil ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){z=function(x){function D(B,v){var E=x.call(this)||this;E.data=B;E.type=4;E.glTexture=null;E.powerOfTwoStretchInfo=null;E.loadingPromise=null;E.loadingController=null;E.events=new t;E.params=v||{};E.params.mipmap=!1!==E.params.mipmap;E.params.noUnpackFlip=E.params.noUnpackFlip||!1;E.params.preMultiplyAlpha=E.params.preMultiplyAlpha||!1;E.params.wrap=E.params.wrap||{s:10497,t:10497};E.params.powerOfTwoResizeMode=E.params.powerOfTwoResizeMode||1;E.estimatedTexMemRequired=
D.estimateTexMemRequired(E.data,E.params);E.startPreload();return E}u._inheritsLoose(D,x);var C=D.prototype;C.startPreload=function(){const B=this.data;e.isNone(B)||(B instanceof HTMLVideoElement?this.startPreloadVideoElement(B):B instanceof HTMLImageElement&&this.startPreloadImageElement(B))};C.startPreloadVideoElement=function(B){h.isBlobProtocol(B.src)||"auto"===B.preload&&B.crossOrigin||(B.preload="auto",B.crossOrigin="anonymous",B.src=B.src)};C.startPreloadImageElement=function(B){h.isDataProtocol(B.src)||
h.isBlobProtocol(B.src)||B.crossOrigin||(B.crossOrigin="anonymous",B.src=B.src)};D.getDataDimensions=function(B){return B instanceof HTMLVideoElement?{width:B.videoWidth,height:B.videoHeight}:B};D.estimateTexMemRequired=function(B,v){if(e.isNone(B))return 0;if(b.isArrayBuffer(B)||b.isUint8Array(B))return v.encoding===D.KTX2_ENCODING?m.estimateMemoryKTX2(B,v.mipmap):v.encoding===D.BASIS_ENCODING?m.estimateMemoryBasis(B,v.mipmap):B.byteLength;const {width:E,height:F}=B instanceof Image||B instanceof
ImageData||B instanceof HTMLCanvasElement||B instanceof HTMLVideoElement?D.getDataDimensions(B):v;return(v.mipmap?4/3:1)*E*F*(v.components||4)||0};C.dispose=function(){this.data=void 0};C.createDescriptor=function(B){var v;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(v=this.params.maxAnisotropy)?v:
this.params.mipmap?B.parameters.maxMaxAnisotropy:1}};C.load=function(B,v){if(e.isSome(this.glTexture))return this.glTexture;if(e.isSome(this.loadingPromise))return this.loadingPromise;const E=this.data;return e.isNone(E)?this.glTexture=new A(B,this.createDescriptor(B),null):"string"===typeof E?this.loadFromURL(B,v,E):E instanceof Image?this.loadFromImageElement(B,v,E):E instanceof HTMLVideoElement?this.loadFromVideoElement(B,v,E):E instanceof ImageData||E instanceof HTMLCanvasElement?this.loadFromImage(B,
E,v):(b.isArrayBuffer(E)||b.isUint8Array(E))&&this.params.encoding===D.DDS_ENCODING?this.loadFromDDSData(B,E):(b.isArrayBuffer(E)||b.isUint8Array(E))&&this.params.encoding===D.KTX2_ENCODING?this.loadFromKTX2(B,E):(b.isArrayBuffer(E)||b.isUint8Array(E))&&this.params.encoding===D.BASIS_ENCODING?this.loadFromBasis(B,E):b.isUint8Array(E)?this.loadFromPixelData(B,E):b.isArrayBuffer(E)?this.loadFromPixelData(B,new Uint8Array(E)):null};C.frameUpdate=function(B,v,E){if(!(this.data instanceof HTMLVideoElement)||
e.isNone(this.glTexture)||2>this.data.readyState||E===this.data.currentTime)return E;if(e.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:F,vao:L,sourceTexture:N}=this.powerOfTwoStretchInfo;N.setData(this.data);this.drawStretchedTexture(B,v,F,L,N,this.glTexture)}else{const {width:F,height:L}=this.data,{width:N,height:I}=this.glTexture.descriptor;F!==N||L!==I?this.glTexture.updateData(0,0,0,Math.min(F,N),Math.min(L,I),this.data):this.glTexture.setData(this.data)}this.glTexture.descriptor.hasMipmap&&
this.glTexture.generateMipmap();return this.data.currentTime};C.loadFromDDSData=function(B,v){return this.glTexture=r.createDDSTexture(B,this.createDescriptor(B),v)};C.loadFromKTX2=function(B,v){return this.loadAsync(()=>m.createTextureKTX2(B,this.createDescriptor(B),v).then(E=>this.glTexture=E))};C.loadFromBasis=function(B,v){return this.loadAsync(()=>m.createTextureBasis(B,this.createDescriptor(B),v).then(E=>this.glTexture=E))};C.loadFromPixelData=function(B,v){d.assert(0<this.params.width&&0<this.params.height);
const E=this.createDescriptor(B);E.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;E.width=this.params.width;E.height=this.params.height;return this.glTexture=new A(B,E,v)};C.loadAsync=function(B){const v=n.createAbortController();this.loadingController=v;const E=B(v.signal);this.loadingPromise=E;B=()=>{this.loadingController===v&&(this.loadingController=null);this.loadingPromise===E&&(this.loadingPromise=null)};E.then(B,B);return E};C.loadFromURL=function(B,v,E){var F=
this;return this.loadAsync(function(){var L=u._asyncToGenerator(function*(N){N=yield k.requestImage(E,{signal:N});return F.loadFromImage(B,N,v)});return function(N){return L.apply(this,arguments)}}())};C.loadFromImageElement=function(B,v,E){var F=this;return E.complete?this.loadFromImage(B,E,v):this.loadAsync(function(){var L=u._asyncToGenerator(function*(N){N=yield l.loadImageAsync(E,E.src,!1,N);return F.loadFromImage(B,N,v)});return function(N){return L.apply(this,arguments)}}())};C.loadFromVideoElement=
function(B,v,E){return 2<=E.readyState?this.loadFromImage(B,E,v):this.loadFromVideoElementAsync(B,v,E)};C.loadFromVideoElementAsync=function(B,v,E){return this.loadAsync(F=>new Promise((L,N)=>{const I=()=>{E.removeEventListener("loadeddata",G);E.removeEventListener("error",K);e.isSome(H)&&H.remove()},G=()=>{2<=E.readyState&&(I(),L(this.loadFromImage(B,E,v)))},K=J=>{I();N(J||new p("Failed to load video"))};E.addEventListener("loadeddata",G);E.addEventListener("error",K);const H=n.onAbort(F,()=>K(n.createAbortError()))}))};
C.loadFromImage=function(B,v,E){const F=D.getDataDimensions(v);this.params.width=F.width;this.params.height=F.height;const L=this.createDescriptor(B);L.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(B,L)&&(!w.isPowerOfTwo(F.width)||!w.isPowerOfTwo(F.height)))return this.glTexture=this.makePowerOfTwoTexture(B,v,F,L,E);L.width=F.width;L.height=F.height;return this.glTexture=new A(B,L,v)};C.requiresPowerOfTwo=function(B,v){const E="number"===typeof v.wrapMode?33071===v.wrapMode:
33071===v.wrapMode.s&&33071===v.wrapMode.t;return!y(B.gl)&&(v.hasMipmap||!E)};C.makePowerOfTwoTexture=function(B,v,E,F,L){const {width:N,height:I}=E;E=w.nextHighestPowerOfTwo(N);const G=w.nextHighestPowerOfTwo(I);F.width=E;F.height=G;let K;switch(this.params.powerOfTwoResizeMode){case 2:F.textureCoordinateScaleFactor=[N/E,I/G];K=new A(B,F);K.updateData(0,0,0,N,I,v);break;case 1:case null:case void 0:K=this.stretchToPowerOfTwo(B,v,F,L);break;default:f.neverReached(this.params.powerOfTwoResizeMode)}F.hasMipmap&&
K.generateMipmap();return K};C.stretchToPowerOfTwo=function(B,v,E,F){const L=new A(B,E),N=new g(B,{colorTarget:0,depthStencilTarget:0},L);v=new A(B,{target:3553,pixelFormat:E.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!E.flipped,maxAnisotropy:8,preMultiplyAlpha:E.preMultiplyAlpha},v);E=c.createQuadVAO(B);this.drawStretchedTexture(B,F,N,E,v,L);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:E,sourceTexture:v,framebuffer:N}:(E.dispose(!0),v.dispose(),N.detachColorTexture(),
B.bindFramebuffer(null),N.dispose());return L};C.drawStretchedTexture=function(B,v,E,F,L,N){B.bindFramebuffer(E);E=B.getViewport();B.setViewport(0,0,N.descriptor.width,N.descriptor.height);N=v.program;B.useProgram(N);N.setUniform4f("color",1,1,1,1);N.bindTexture(L,"tex");B.bindVAO(F);B.setPipelineState(v.pipeline);B.drawArrays(5,0,q.vertexCount(F,"geometry"));B.bindFramebuffer(null);B.setViewport(E.x,E.y,E.width,E.height)};C.unload=function(){if(e.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:B,
vao:v,sourceTexture:E}=this.powerOfTwoStretchInfo;v.dispose(!0);E.dispose();B.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}e.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);if(e.isSome(this.loadingController)){const B=this.loadingController;this.loadingPromise=this.loadingController=null;B.abort()}this.events.emit("unloaded")};u._createClass(D,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"requiresFrameUpdates",
get:function(){return this.data instanceof HTMLVideoElement}}]);return D}(z.ContentObject);z.DDS_ENCODING="image/vnd-ms.dds";z.KTX2_ENCODING="image/ktx2";z.BASIS_ENCODING="image/x.basis";a.Texture=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,u,f,p,t,w){function e(){return n.apply(this,
arguments)}function n(){n=u._asyncToGenerator(function*(){f.isNone(c)&&(c=p.getBasisTranscoder(),r=yield c);return c});return n.apply(this,arguments)}function b(d,g,A,q,y){g=w.getBytesPerElementFormat(g?37496:37492);return Math.ceil(A*q*g*(y&&1<d?(4**d-1)/(3*4**(d-1)):1))}function h(d){return 1<=d.getNumImages()&&!d.isUASTC()}function k(d){return 1<=d.getFaces()&&d.isETC1S()}function l(){l=u._asyncToGenerator(function*(d,g,A){f.isNone(r)&&(r=yield e());const q=new r.BasisFile(new Uint8Array(A));if(!h(q))return null;
q.startTranscoding();d=z(d,g,q.getNumLevels(0),q.getHasAlpha(),q.getImageWidth(0,0),q.getImageHeight(0,0),(y,x)=>q.getImageTranscodedSizeInBytes(0,y,x),(y,x,D)=>q.transcodeImage(D,0,y,x,0,0));q.close();q.delete();return d});return l.apply(this,arguments)}function m(){m=u._asyncToGenerator(function*(d,g,A){f.isNone(r)&&(r=yield e());const q=new r.KTX2File(new Uint8Array(A));if(!k(q))return null;q.startTranscoding();d=z(d,g,q.getLevels(),q.getHasAlpha(),q.getWidth(),q.getHeight(),(y,x)=>q.getImageTranscodedSizeInBytes(y,
0,0,x),(y,x,D)=>q.transcodeImage(D,y,0,0,x,0,-1,-1));q.close();q.delete();return d});return m.apply(this,arguments)}function z(d,g,A,q,y,x,D,C){const {compressedTextureETC:B,compressedTextureS3TC:v}=d.capabilities,[E,F]=B?q?[1,37496]:[0,37492]:v?q?[3,33779]:[2,33776]:[13,6408];q=g.hasMipmap?A:Math.min(1,A);A=[];for(let L=0;L<q;L++)A.push(new Uint8Array(D(L,E))),C(L,E,A[L]);D=1<A.length;return new t(d,{...g,samplingMode:D?9987:9729,hasMipmap:D,internalFormat:F,width:y,height:x},{type:"compressed",
levels:A})}let r=null,c=null;a.createTextureBasis=function(d,g,A){return l.apply(this,arguments)};a.createTextureKTX2=function(d,g,A){return m.apply(this,arguments)};a.estimateMemoryBasis=function(d,g){if(f.isNone(r))return d.byteLength;d=new r.BasisFile(new Uint8Array(d));g=h(d)?b(d.getNumLevels(0),d.getHasAlpha(),d.getImageWidth(0,0),d.getImageHeight(0,0),g):0;d.close();d.delete();return g};a.estimateMemoryKTX2=function(d,g){if(f.isNone(r))return d.byteLength;d=new r.KTX2File(new Uint8Array(d));
g=k(d)?b(d.getLevels(),d.getHasAlpha(),d.getWidth(),d.getHeight(),g):0;d.close();d.delete();return g};a.loadBasis=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,u,f,p){let t;u.getBasisTranscoder=function(){if(p.isNone(t)){const w=e=>f.getAssetUrl(`esri/libs/basisu/${e}`);t=(new Promise(function(e,n){a(["../../chunks/basis_transcoder"],e,n)})).then(function(e){return e.basis_transcoder}).then(({default:e})=>
e({locateFile:w}).then(n=>{n.initializeBasis();delete n.then;return n}))}return t};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(a,u,f,p){function t(k){return k.charCodeAt(0)+(k.charCodeAt(1)<<8)+(k.charCodeAt(2)<<16)+(k.charCodeAt(3)<<24)}function w(k,l){var m=new Int32Array(k,0,31);if(542327876!==m[0])return e.error("Invalid magic number in DDS header"),
null;if(!(m[20]&4))return e.error("Unsupported format, must contain a FourCC code"),null;var z=m[21];let r;switch(z){case n:z=8;r=33776;break;case b:z=16;r=33778;break;case h:z=16;r=33779;break;default:return e.error("Unsupported FourCC code:",String.fromCharCode(z&255,z>>8&255,z>>16&255,z>>24&255)),null}let c=1,d=m[4],g=m[3];if(0!==(d&3)||0!==(g&3))e.warn("Rounding up compressed texture size to nearest multiple of 4."),d=d+3&-4,g=g+3&-4;const A=d,q=g;m[2]&131072&&!1!==l&&(c=Math.max(1,m[7]));1===
c||f.isPowerOfTwo(d)&&f.isPowerOfTwo(g)||(e.warn("Ignoring mipmaps of non power of two sized compressed texture."),c=1);let y=m[1]+4;const x=[];for(let D=0;D<c;++D)m=(d+3>>2)*(g+3>>2)*z,l=new Uint8Array(k,y,m),x.push(l),y+=m,d=Math.max(1,d>>1),g=Math.max(1,g>>1);return{textureData:{type:"compressed",levels:x},internalFormat:r,width:A,height:q}}const e=u.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),n=t("DXT1"),b=t("DXT3"),h=t("DXT5");a.createDDSTexture=function(k,l,m){const {textureData:z,internalFormat:r,
width:c,height:d}=w(m,l.hasMipmap);l.samplingMode=1<z.levels.length?9987:9729;l.hasMipmap=1<z.levels.length;l.internalFormat=r;l.width=c;l.height=d;return new p(k,l,z)};a.createDDSTextureData=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v){const E=["polyline","polygon","extent"];p=function(F){function L(I,G,K,H){I=F.call(this,I,G,K,H)||this;I._uniformSize=1;return I}u._inheritsLoose(L,F);var N=L.prototype;N.doLoad=function(){var I=u._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?q.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const G=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1);if(0>G)throw new t("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=G}});return function(){return I.apply(this,arguments)}}();N.getMaterialParameters=
function(I){var G=w.get(this.symbolLayer,"material","color");G=this._getCombinedOpacityAndColor(G);I={width:1,color:G,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>G[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:I,stipplePattern:this.symbolLayer.stipplePattern?D.createStipplePattern(this.symbolLayer.stipplePattern.map(e.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?f.toUnitRGBA(this.symbolLayer.stippleOffColor):
null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(I.width=e.pt2px(1)):(G=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1),I.width=e.pt2px(G));return this._fastUpdates&&this._fastUpdates.visualVariables?{...I,...this._fastUpdates.materialParameters}:I};N.destroy=function(){F.prototype.destroy.call(this);this._context.stage.remove(this._lineMaterial);this._lineMaterial=null;this._context.stage.remove(this._ringMaterial);
this._ringMaterial=null};N.getDrivenSize=function(I){return this._drivenProperties.size&&I.size?e.pt2px(l.getDriverAxisSizeValueAny(I.size)):1};N.getSizeFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?g.getAttributeValue(this._fastUpdates.visualVariables.size.field,I):null};N.getDrivenColor=function(I){const G=h.fromValues(1,1,1,1);this._drivenProperties.color&&I.color&&(G[0]=I.color[0],G[1]=I.color[1],G[2]=I.color[2],0<I.color.length&&(G[3]=
I.color[3]));this._drivenProperties.opacity&&I.opacity&&(G[3]=I.opacity);return G};N.getColorFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?g.getAttributeValue(this._fastUpdates.visualVariables.color.field,I):null};N.getOpacityFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?g.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,I):null};N.createGraphics3DGraphic=function(I){const G=
I.graphic;if(!this._validateGeometry(G.geometry,E,this.symbolLayer.type))return null;const K=this.setGraphicElevationContext(G,new r.ElevationContext);this.ensureDrapedStatus("on-the-ground"===K.mode);return this.draped?this._createAsOverlay(I,this._context.layer.uid):this._createAs3DShape(I,K,G.uid)};N.applyRendererDiff=function(I,G){for(const K in I.diff)switch(K){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,G,this._vvConvertOptions))w.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),
w.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};N.layerOpacityChanged=function(){w.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);w.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};N.updateMaterialLayerOpacity=function(I){const G=I.params.color;var K=w.get(this.symbolLayer,"material","color");K=this._getCombinedOpacity(K);
I.setParameterValues({color:[G[0],G[1],G[2],K],transparent:1>K||this.needsDrivenTransparentPass})};N.layerElevationInfoChanged=function(I,G,K){const H=this._elevationContext.mode;K=z.elevationModeChangeUpdateType(L.elevationModeChangeTypes,K,H);if(K!==z.SymbolUpdateType.UPDATE)return K;const J=z.needsElevationUpdates2D(H);return this.updateGraphics3DGraphicElevationInfo(I,G,()=>J)};N.slicePlaneEnabledChanged=function(){w.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
w.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};N.physicalBasedRenderingChanged=function(){return!0};N.pixelRatioChanged=function(){return!0};N._getGeometryAsPolygonOrPolyline=function(I){switch(I.type){case "extent":if(I instanceof B)return v.fromExtent(I);break;case "polygon":case "polyline":return I}return null};N._createAs3DShape=function(I,G,K){const H=this._getGeometryAsPolygonOrPolyline(I.graphic.geometry);var J=
"polygon"===H.type?H.rings:H.paths,M=[];const O=[],Q=[],S=k.create(),V=A.geometryToRenderInfo(H,this._context.elevationProvider,this._context.renderCoordsHelper,G);this._logGeometryCreationWarnings(V,J,"polygon"===H.type?"rings":"paths","LineSymbol3DLayer");for(J=0;J<V.lines.length;J++){const {position:Y,mapPosition:W}=V.lines[J];if(w.isSome(this._context.clippingExtent)&&(k.empty(S),k.expandWithBuffer(S,W),!k.intersectsClippingArea(S,this._context.clippingExtent)))continue;const ba=this._createGeometry(I,
Y,W,H.type);M.push(ba);O.push("polygon"===H.type?this.ringMaterial:this.lineMaterial);Q.push(n.IDENTITY)}if(0===M.length)return null;I=new y.Object3D({geometries:M,materials:O,transformations:Q,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:K}});M=new d.Graphics3DObject3DGraphicLayer(this,I,M,null,null,m.perVertexElevationAligner,G);M.alignedSampledElevation=V.sampledElevation;M.needsElevationUpdates=z.needsElevationUpdates2D(G.mode);return M};N._createGeometry=function(I,G,K,
H){const J=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return A.createGeometry({removeDuplicateStartEnd:"polygon"===H?1:0,uniformSize:this._uniformSize,attributeData:{position:G,mapPosition:K,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(I.renderingInfo),color:J?null:this.getDrivenColor(I.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(I.graphic),colorFeature:this.getColorFeatureAttributeData(I.graphic),opacityFeature:this.getOpacityFeatureAttributeData(I.graphic)}})};
N._createAsOverlay=function(I,G){const K=I.graphic,H=this._getGeometryAsPolygonOrPolyline(K.geometry);var J="polygon"===H.type?H.rings:H.paths;const M="polygon"===H.type?this.ringMaterial:this.lineMaterial;M.renderPriority=this._renderPriority;const O=[],Q=k.create(),S=k.empty(),V=A.geometryToRenderInfoDraped(H,this._context.overlaySR);this._logGeometryCreationWarnings(V,J,"polygon"===H.type?"rings":"paths","LineSymbol3DLayer");for(const Y of V.lines)k.empty(Q),k.expandWithBuffer(Q,Y.position),k.intersectsClippingArea(Q,
this._context.clippingExtent)&&(k.expandWithAABB(S,Q),J=this._createGeometry(I,Y.position,null,H.type),J=new x.RenderGeometry(J,M,G,K.uid),b.set(J.boundingSphere,.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0,.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1]))),O.push(J));return new c(this,O,S)};u._createClass(L,[{key:"lineMaterial",get:function(){w.isNone(this._lineMaterial)&&(this._lineMaterial=new C.RibbonLineMaterial(this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},
{key:"ringMaterial",get:function(){w.isNone(this._ringMaterial)&&(this._ringMaterial=new C.RibbonLineMaterial(this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}}]);return L}(g.Graphics3DSymbolLayer);p.elevationModeChangeTypes={definedChanged:z.SymbolUpdateType.RECREATE,staysOnTheGround:z.SymbolUpdateType.NONE,onTheGroundChanged:z.SymbolUpdateType.RECREATE};a.Graphics3DLineSymbolLayer=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l){function m(d,g,A){const q=[];for(const {index:y,count:x}of d){if(1>=x)continue;
d=3*y;const D=d+3*x;q.push({position:g.subarray(d,D),mapPosition:A?A.subarray(d,D):void 0})}return q}const z=w.create(),r=w.create(),c=4/Math.PI;a.createGeometry=function(d){const g=[],A=[];{const {attributeData:{position:v},removeDuplicateStartEnd:E}=d;var q=v.length;q=(q=v[0]===v[q-3]&&v[1]===v[q-2]&&v[2]===v[q-1])&&1===E;var y=v.length/3-(q?1:0),x=new Uint32Array(2*(y-1)),D=q?p.slice(v,0,v.length-3):v,C=0;for(var B=0;B<y-1;B++)x[C++]=B,x[C++]=B+1;A.push(["position",{size:3,data:D,exclusive:q}]);
g.push(["position",x])}q=A[0][1].data;y=new Uint16Array(g[0][1].length);x=d.attributeData.mapPosition;f.isNone(x)||(g.push(["mapPos",g[0][1]]),A.push(["mapPos",{size:3,data:x}]));f.isSome(d.attributeData.colorFeature)||(A.push(["color",{size:4,data:f.unwrapOr(d.attributeData.color,b.WHITE_UNIT)}]),g.push(["color",y]));f.isSome(d.attributeData.sizeFeature)||(A.push(["size",{size:1,data:[f.unwrapOr(d.attributeData.size,1)]}]),g.push(["size",y]));x=d.attributeData.colorFeature;f.isNone(x)||(A.push(["colorFeatureAttribute",
{size:1,data:new Float32Array([x])}]),g.push(["color",y]));x=d.attributeData.sizeFeature;f.isNone(x)||(A.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([x])}]),g.push(["sizeFeatureAttribute",y]));x=d.attributeData.opacityFeature;f.isNone(x)||(A.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([x])}]),g.push(["opacityFeatureAttribute",y]));if("round"===d.join){y=q.length/3;x=new Float32Array(y);t.set(z,0,0,0);d=f.unwrapOr(d.uniformSize,1);for(D=-1;D<y;++D)C=0>D?y+D:D,B=(D+
1)%y,t.set(r,q[3*B]-q[3*C],q[3*B+1]-q[3*C+1],q[3*B+2]-q[3*C+2]),t.normalize(r,r),0<=D&&(C=(Math.PI-u.acosClamped(t.dot(z,r)))*c*(1.863798+-2.0062872/(1+d/18.2313)**.8856294),x[D]=Math.max(Math.floor(C),0)),t.scale(z,r,-1);A.push(["subdivisions",{size:1,data:x}]);g.push(["subdivisions",g[0][1]])}return new l.Geometry(A,g,2)};a.geometryToRenderInfo=function(d,g,A,q){const {position:y,outlines:x}=n.pathsToTriangulationInfo("polygon"===d.type?d.rings:d.paths,d.hasZ,"polygon"===d.type?1:0),D=new Float64Array(y.length);
d=h.applyPerVertexElevationAlignment(y,d.spatialReference,0,D,0,y,0,y.length/3,g,A,q);g=null!=d;return{lines:g?m(x,y,D):[],projectionSuccess:g,sampledElevation:d}};a.geometryToRenderInfoDraped=function(d,g){const {position:A,outlines:q}=n.pathsToTriangulationInfo("polygon"===d.type?d.rings:d.paths,!1,"polygon"===d.type?1:0);d=e.projectBuffer(A,d.spatialReference,0,A,g,0,A.length/3);for(g=2;g<A.length;g+=3)A[g]=k.DRAPED_Z;return{lines:d?m(q,A):[],projectionSuccess:d}};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,u){a.createStipplePattern=function(f){return u.isNone(f)?f:f.slice()};a.createStipplePatternSimple=function(f){return[f,f]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H){const J=["mesh"];p=function(da){function ha(R,U,Z,T){R=da.call(this,R,U,Z,T)||this;R._materials=new Map;R._textures=new Map;R.ensureDrapedStatus(!1);return R}u._inheritsLoose(ha,da);var fa=ha.prototype;fa.doLoad=function(){var R=u._asyncToGenerator(function*(){F.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new H.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new H.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return R.apply(this,arguments)}}();fa.destroy=function(){da.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),R=>R.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};fa.createGraphics3DGraphic=function(R){const U=R.graphic;if(!this._validateGeometry(U.geometry,J,"fill on mesh-3d"))return null;const Z=this.setGraphicElevationContext(U,new D.ElevationContext);
return this._createAs3DShape(U,R.renderingInfo,Z,U.uid)};fa.layerOpacityChanged=function(R,U){const Z=this._getLayerOpacity();this._materials.forEach(T=>{T.material.setParameterValues({layerOpacity:Z});const P=T.material.params;this._setMaterialTransparentParameter(P,T);T.material.setParameterValues({transparent:P.transparent})});R.forEach(T=>{T=U(T);t.isSome(T)&&T.layerOpacityChanged(Z,this._context.isAsync)});return!0};fa.layerElevationInfoChanged=function(R,U){return this.updateGraphics3DGraphicElevationInfo(R,
U,x.needsElevationUpdates3D)};fa.slicePlaneEnabledChanged=function(R,U){this._materials.forEach(Z=>{Z.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});R.forEach(Z=>{Z=U(Z);t.isSome(Z)&&Z.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};fa.physicalBasedRenderingChanged=function(){const R=this._usePBR();this._materials.forEach(U=>U.material.setParameterValues({usePBR:R}));return!0};fa.pixelRatioChanged=function(){return!0};
fa._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};fa._colorOrTextureUid=function(R){return t.isNone(R)?"-":R instanceof f?R.toHex():R.contentHash};fa._materialPropertiesDefault=function(R,U){const Z=this._requiresSymbolVertexColors(),T=!!R.vertexAttributes.color;R=!!R.vertexAttributes.tangent;return{hasSymbolVertexColors:Z,hasVertexColors:T,hasVertexTangents:R,uid:`vc:${T},vt:${R},vct${U},svc:${Z}`}};fa._materialProperties=function(R,U,
Z){R=this._materialPropertiesDefault(R,Z);if(!U.material)return R;const {color:T,colorTexture:P,normalTexture:X,doubleSided:aa,alphaCutoff:ja,alphaMode:ia}=U.material;Z=this._colorOrTextureUid(T);var ka=this._colorOrTextureUid(P),na=this._colorOrTextureUid(X);R.color=T;R.colorTexture=P;R.normalTexture=X;R.uid=`${R.uid},cmuid:${Z},ctmuid:${ka},ntmuid:${na},ds:${aa},ac:${ja},am:${ia}`;if(U.material instanceof c){const {metallic:ta,roughness:pa,metallicRoughnessTexture:xa,emissiveColor:Da,emissiveTexture:Ka,
occlusionTexture:Fa}=U.material;U=this._colorOrTextureUid(xa);Z=this._colorOrTextureUid(Da);ka=this._colorOrTextureUid(Ka);na=this._colorOrTextureUid(Fa);R.metallic=ta;R.roughness=pa;R.metallicRoughnessTexture=xa;R.emissiveColor=Da;R.emissiveTexture=Ka;R.occlusionTexture=Fa;R.uid=`${R.uid},mrm:${ta},mrr:${pa},mrt:${U},emuid:${Z},etmuid:${ka},otmuid:${na}`}return R};fa._setInternalColorValueParameters=function(R,U){U.diffuse=f.toUnitRGB(R);U.opacity=R.a};fa._getLoadableTextureResource=function(R){return R.data?
R.data:R.url};fa._getInternalTextureId=function(R){const U=this._getLoadableTextureResource(R);if(U){var Z=R.contentHash,T=this._textures.get(Z);T||(T=new G.Texture(U,{mipmap:!0,wrap:this._castTextureWrap(R.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(Z,T),this._context.stage.add(T));return T.id}};fa._castTextureWrap=function(R="repeat"){return"string"===typeof R?(R=this._castTextureWrapIndividual(R),{s:R,t:R}):{s:this._castTextureWrapIndividual(R.horizontal),t:this._castTextureWrapIndividual(R.vertical)}};
fa._castTextureWrapIndividual=function(R){switch(R){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};fa._setInternalMaterialParameters=function(R,U){t.isSome(R.color)&&this._setInternalColorValueParameters(R.color,U);t.isSome(R.colorTexture)&&(U.textureId=this._getInternalTextureId(R.colorTexture));t.isSome(R.normalTexture)&&(U.normalTextureId=this._getInternalTextureId(R.normalTexture));t.isSome(R.emissiveColor)&&(U.emissiveFactor=f.toUnitRGB(R.emissiveColor));t.isSome(R.emissiveTexture)&&
(U.emissiveTextureId=this._getInternalTextureId(R.emissiveTexture));t.isSome(R.occlusionTexture)&&(U.occlusionTextureId=this._getInternalTextureId(R.occlusionTexture));t.isSome(R.metallicRoughnessTexture)&&(U.metallicRoughnessTextureId=this._getInternalTextureId(R.metallicRoughnessTexture))};fa._setExternalMaterialParameters=function(R){var U=this._drivenProperties.color;let Z=t.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;U?R.externalColor=l.ONES:(U=t.isSome(this.symbolLayer.material)?
this.symbolLayer.material.color:null,t.isSome(U)?R.externalColor=f.toUnitRGBA(U):(Z=null,R.externalColor=l.ONES));Z&&(R.colorMixMode=Z);R.castShadows=!!this.symbolLayer.castShadows};fa._hasTransparentVertexColors=function(R){R=R.vertexAttributes.color;if(t.isNone(R))return!1;for(let U=3;U<R.length;U+=4)if(255!==R[U])return!0;return!1};fa._getOrCreateMaterial=function(R,U){var Z=U.material&&U.material.color,T=U.material&&U.material.colorTexture,P=U.material&&"blend"===U.material.alphaMode;Z=!(U.material&&
"opaque"===U.material.alphaMode)&&(this._hasTransparentVertexColors(R)||t.isSome(Z)&&1>Z.a||t.isSome(T)&&T.transparent||P);R=this._materialProperties(R,U,Z);if(T=this._materials.get(R.uid))return T.material;Z={material:null,isComponentTransparent:Z,alphaMode:U.material?U.material.alphaMode:"opaque"};T=null==R.metallicRoughnessTexture&&null==R.metallic&&null==R.roughness;P={usePBR:this._usePBR(),isSchematic:T,vertexColors:R.hasVertexColors,symbolColors:R.hasSymbolVertexColors,vertexTangents:R.hasVertexTangents,
ambient:k.ZEROS,diffuse:k.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};T||(P.mrrFactors=[null!=R.metallic?R.metallic:1,null!=R.roughness?R.roughness:1,.5]);U.material&&(P.doubleSided=U.material.doubleSided,P.cullFace=U.material.doubleSided?0:2,P.textureAlphaCutoff=U.material.alphaCutoff);this._setInternalMaterialParameters(R,P);
this._setExternalMaterialParameters(P);this._setMaterialTransparentParameter(P,Z);U=new K.DefaultMaterial(P);Z.material=U;this._materials.set(R.uid,Z);this._context.stage.add(U);return U};fa._usePBR=function(){return this._context.physicalBasedRenderingEnabled};fa._setMaterialTransparentParameter=function(R,U){R.transparent=this.needsDrivenTransparentPass||U.isComponentTransparent||1>R.layerOpacity||1>R.opacity||R.externalColor&&1>R.externalColor[3];R.textureAlphaMode="auto"===U.alphaMode?R.transparent?
3:1:"opaque"===U.alphaMode?1:"mask"===U.alphaMode?2:0};fa._addDebugNormals=function(R,U,Z,T){var P=U.length,X=R.spatialReference.isGeographic?20015077/180:1;const aa=.1*Math.max(R.extent.width*X,R.extent.height*X,R.extent.zmax-R.extent.zmin),ja=[],ia=[];R=[];X=[];for(let Da=0;Da<P;Da++){var ka=U[Da],na=ka.vertexAttributes.get("position"),ta=ka.vertexAttributes.get("normal");const Ka=ka.indices.get("position");ka=ka.indices.get("normal");na=na.data;ta=ta.data;for(let Fa=0;Fa<Ka.length;Fa++){var pa=
3*Ka[Fa];const Ha=3*ka[Fa];for(var xa=0;3>xa;xa++)ja.push(na[pa+xa]);for(xa=0;3>xa;xa++)ja.push(na[pa+xa]+ta[Ha+xa]*aa);ia.push(ia.length);ia.push(ia.length);if(0===Fa%3){this._calculateFaceNormal(na,Ka,Fa,V);this._getFaceVertices(na,Ka,Fa,O,Q,S);h.add(O,O,Q);h.add(O,O,S);h.scale(O,O,1/3);for(pa=0;3>pa;pa++)R.push(O[pa]);for(pa=0;3>pa;pa++)R.push(O[pa]+V[pa]*aa);X.push(X.length);X.push(X.length)}}}P=new L.Geometry([["position",{data:ja,size:3,exclusive:!0}]],[["position",new Uint32Array(ia)]],2);
U.push(P);Z.push(this._debugVertexNormalMaterial);T.push(b.clone(T[0]));P=new L.Geometry([["position",{data:R,size:3,exclusive:!0}]],[["position",new Uint32Array(X)]],2);U.push(P);Z.push(this._debugFaceNormalMaterial);T.push(b.clone(T[0]))};fa._createAs3DShape=function(R,U,Z,T){R=R.geometry;if("mesh"!==R.type)return null;U=this._createGeometryInfo(R,U);if(!U)return null;const {geometries:P,materials:X,transformations:aa,objectTransformation:ja}=U;F.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(R,
P,X,aa);T=new I.Object3D({geometries:P,materials:X,transformations:aa,metadata:{layerUid:this._context.layer.uid,graphicUid:T}});T.transformation=ja;U=y.perObjectElevationAligner;R=this._createEdgeMaterial();R=t.isSome(R)?{baseMaterial:X[0],edgeMaterials:[R],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;R=new C.Graphics3DObject3DGraphicLayer(this,T,P,null,null,U,Z,R);R.needsElevationUpdates=x.needsElevationUpdates3D(Z.mode);R.useObjectOriginAsAttachmentOrigin=
!0;R.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(T);R.alignedSampledElevation=U(R,R.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return R};fa.getCenterPointInElevationSR=function(R){const U=q.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);m.projectVectorToDehydratedPoint([R.transformation[12],R.transformation[13],R.transformation[14]],this._context.renderCoordsHelper.spatialReference,U);return U};fa._createComponentNormals=
function(R,U,Z,T){switch(Z.shading||"flat"){case "source":return this._createComponentNormalsSource(R,U,Z,T);case "flat":return this._createComponentNormalsFlat(R,T);case "smooth":return this._createComponentNormalsSmooth(R,T)}};fa._createComponentNormalsSource=function(R,U,Z,T){if(t.isNone(U))return this._createComponentNormalsFlat(R,T);let P=!1;if(!Z.trustSourceNormals)for(Z=0;Z<T.length;Z+=3){this._calculateFaceNormal(R,T,Z,V);for(let X=0;3>X;X++){const aa=3*T[Z+X];O[0]=U[aa+0];O[1]=U[aa+1];O[2]=
U[aa+2];0>h.dot(V,O)&&(U[aa+0]=-U[aa+0],U[aa+1]=-U[aa+1],U[aa+2]=-U[aa+2],P=!0)}}return{normals:U,indices:T,didFlipNormals:P}};fa._createComponentNormalsFlat=function(R,U){const Z=new Float32Array(U.length),T=new Uint32Array(3*U.length);for(let P=0;P<U.length;P+=3){const X=this._calculateFaceNormal(R,U,P,V);for(let aa=0;3>aa;aa++)Z[P+aa]=X[aa],T[P+aa]=P/3}return{normals:Z,indices:T,didFlipNormals:!1}};fa._createComponentNormalsSmooth=function(R,U){const Z={};for(var T=0;T<U.length;T+=3){var P=this._calculateFaceNormal(R,
U,T,V);for(var X=0;3>X;X++){var aa=U[T+X];let ja=Z[aa];ja||(ja={normal:k.create(),count:0},Z[aa]=ja);h.add(ja.normal,ja.normal,P);ja.count++}}R=new Float32Array(3*U.length);T=new Uint32Array(3*U.length);for(P=0;P<U.length;P++){X=Z[U[P]];1!==X.count&&(h.normalize(X.normal,X.normal),X.count=1);for(aa=0;3>aa;aa++)R[3*P+aa]=X.normal[aa];T[P]=P}return{normals:R,indices:T,didFlipNormals:!1}};fa._getFaceVertices=function(R,U,Z,T,P,X){const aa=3*U[Z+0],ja=3*U[Z+1];U=3*U[Z+2];T[0]=R[aa+0];T[1]=R[aa+1];T[2]=
R[aa+2];P[0]=R[ja+0];P[1]=R[ja+1];P[2]=R[ja+2];X[0]=R[U+0];X[1]=R[U+1];X[2]=R[U+2]};fa._calculateFaceNormal=function(R,U,Z,T){this._getFaceVertices(R,U,Z,O,Q,S);h.subtract(Q,Q,O);h.subtract(S,S,O);h.cross(O,Q,S);h.normalize(T,O);return T};fa._getOrCreateComponents=function(R){return R.components?R.components:ca};fa._createPositionBuffer=function(R,U){let Z=R.vertexAttributes.position;const T=1===U.reprojection?U.transformBeforeProject:null;t.isSome(T)&&(Z=A.transformPosition(Z,new Float64Array(Z.length),
T));if(0===U.reprojection)return U.needsBufferCopy?new Float64Array(Z):Z;U=t.isSome(T)?Z:new Float64Array(Z.length);m.projectBuffer(Z,R.spatialReference,0,U,this._context.renderCoordsHelper.spatialReference,0,Z.length/3);return U};fa._createNormalBuffer=function(R,U,Z){let T=R.vertexAttributes.normal;if(t.isNone(T))return null;var P=1===Z.reprojection?Z.transformBeforeProject:null;t.isSome(P)&&(T=A.transformNormal(T,new Float32Array(T.length),P));if("local"===this._context.layerView.view.viewingMode||
0===Z.reprojection)return Z.needsBufferCopy&&R.vertexAttributes.normal===T?new Float32Array(T):T;Z=R.vertexAttributes.position;P=t.isSome(P)?T:new Float32Array(T.length);return A.projectNormalToPCPF(T,Z,U,R.spatialReference,P)};fa._createTangentBuffer=function(R,U,Z){let T=R.vertexAttributes.tangent;if(t.isNone(T))return null;var P=1===Z.reprojection?Z.transformBeforeProject:null;t.isSome(P)&&(T=A.transformTangent(T,new Float32Array(T.length),P));if("local"===this._context.layerView.view.viewingMode||
0===Z.reprojection)return Z.needsBufferCopy&&R.vertexAttributes.normal===T?new Float32Array(T):T;Z=R.vertexAttributes.position;P=t.isSome(P)?T:new Float32Array(T.length);return A.projectTangentToPCPF(T,Z,U,R.spatialReference,P)};fa._createColorBuffer=function(R){return R.vertexAttributes.color};fa._createSymbolColorBuffer=function(R){if(this._requiresSymbolVertexColors()){R=this._getVertexOpacityAndColor(R);const U=E.parseColorMixMode(t.get(this.symbolLayer,"material","colorMixMode")),Z=new Uint8Array(4);
E.encodeSymbolColor(R,U,Z);return Z}return null};fa._createBuffers=function(R,U){var Z=R.vertexAttributes&&R.vertexAttributes.position;if(!Z)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var T=R.vertexAttributes.normal;const P=R.vertexAttributes.uv;var X=R.vertexAttributes.tangent;if(t.isSome(T)&&T.length!==Z.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(t.isSome(X)&&X.length/
4!==Z.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(t.isSome(P)&&P.length/2!==Z.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;X=this._computeReprojectionInfo(R);Z=this._createPositionBuffer(R,X);T=this._createColorBuffer(R);U=this._createSymbolColorBuffer(U);const aa=this._createNormalBuffer(R,Z,X),ja=this._createTangentBuffer(R,
Z,X);R=0===X.reprojection&&t.isSome(X.objectTransformation)?X.objectTransformation:this._transformOriginLocal(R,Z,aa,ja);X=0===X.reprojection&&t.isSome(X.geometryTransformation)?X.geometryTransformation:b.create();return{positionBuffer:Z,normalBuffer:aa,tangentBuffer:ja,uvBuffer:P,colorBuffer:T,symbolColorBuffer:U,objectTransformation:R,geometryTransformation:X}};fa._computeReprojectionInfo=function(R){const U=t.isSome(R.transform)&&R.transform.geographic?0:2===this._context.renderCoordsHelper.viewingMode?
0:1;var Z=null;if(t.isSome(R.transform)){if(0===U)return Z=b.create(),m.computeLinearTransformation(R.spatialReference,R.transform.origin,Z,this._context.renderCoordsHelper.spatialReference),R=b.clone(R.transform.localMatrix),{reprojection:U,objectTransformation:Z,geometryTransformation:R,needsBufferCopy:!1};Z=n.fromTranslation(b.create(),R.transform.origin);n.multiply(Z,Z,R.transform.localMatrix);return{reprojection:U,transformBeforeProject:Z,needsBufferCopy:!0}}return{reprojection:U,needsBufferCopy:!0}};
fa._transformOriginLocal=function(R,U,Z,T){const P=this._context.renderCoordsHelper.spatialReference;var X=R.anchor;M[0]=X.x;M[1]=X.y;M[2]=X.z;X=b.create();m.computeLinearTransformation(R.spatialReference,M,X,P);R=d.BufferViewVec3f64.fromTypedArray(U);n.invert(Y,X);g.transformMat4(R,R,Y);if(t.isSome(Z)||t.isSome(T))w.fromMat4(W,X),w.transpose(W,W),t.isSome(Z)&&(Z=d.BufferViewVec3f.fromTypedArray(Z),g.transformMat3(Z,Z,W)),t.isSome(T)&&(T=d.BufferViewVec3f.fromTypedArray(T,4*T.BYTES_PER_ELEMENT),g.transformMat3(T,
T,W));return X};fa._validateFaces=function(R,U){R=R.vertexAttributes.position.length/3;if(U=U.faces){let Z=-1;for(let T=0;T<U.length;T++){const P=U[T];P>Z&&(Z=P)}if(R<=Z)return this.logger.warn(`Vertex index ${Z} is out of bounds of the mesh position buffer`),!1}else if(0!==R%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};fa._getOrCreateFaces=function(R,U){return U.faces?
U.faces:N.generateDefaultIndexArray(R.vertexAttributes.position.length/3)};fa._isOutsideClippingArea=function(R){if(!this._context.clippingExtent)return!1;var U=R.vertexAttributes&&R.vertexAttributes.position;if(!U)return!1;const Z=this._context.elevationProvider.spatialReference,T=U.length/3;R.spatialReference.equals(Z)||(U=new Float64Array(U.length),m.projectBuffer(R.vertexAttributes.position,R.spatialReference,0,U,Z,0,T));z.empty(ba);z.expandWithBuffer(ba,U,0,T);return!z.intersectsClippingArea(ba,
this._context.clippingExtent)};fa._createGeometryInfo=function(R,U){if(!m.canProjectWithoutEngine(R.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(R))return null;U=this._createBuffers(R,U);if(t.isNone(U))return null;const {positionBuffer:Z,uvBuffer:T,colorBuffer:P,symbolColorBuffer:X,normalBuffer:aa,tangentBuffer:ja,objectTransformation:ia,geometryTransformation:ka}=
U;var na=this._getOrCreateComponents(R);U=[];const ta=[],pa=[];let xa=!1;for(const Ka of na){if(!this._validateFaces(R,Ka))return null;na=this._getOrCreateFaces(R,Ka);if(0===na.length)continue;var Da=this._createComponentNormals(Z,aa,Ka,na);Da.didFlipNormals&&(xa=!0);const Fa=[["position",{size:3,data:Z,exclusive:!0}],["normal",{size:3,data:Da.normals,exclusive:!0}]];Da=[["position",na],["normal",Da.indices]];t.isSome(P)&&(Fa.push(["color",{size:4,data:P,exclusive:!0}]),Da.push(["color",na]));t.isSome(X)&&
(Fa.push(["symbolColor",{size:4,data:X,exclusive:!0}]),Da.push(["symbolColor",new Uint16Array(na.length)]));t.isSome(T)&&(Fa.push(["uv0",{size:2,data:T,exclusive:!0}]),Da.push(["uv0",na]));t.isSome(ja)&&(Fa.push(["tangent",{size:4,data:ja,exclusive:!0}]),Da.push(["tangent",na]));na=new L.Geometry(Fa,Da);U.push(na);ta.push(ka);pa.push(this._getOrCreateMaterial(R,Ka))}xa&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:U,transformations:ta,materials:pa,objectTransformation:ia}};fa._createEdgeMaterial=function(){const R={opacity:this._getLayerOpacity()};return v.createMaterial(this.symbolLayer,R)};return ha}(B.Graphics3DSymbolLayer);const M=k.create(),O=k.create(),Q=k.create(),S=k.create(),V=k.create(),Y=b.create(),W=e.create(),ba=z.create(),ca=[new r];a.Graphics3DMeshFillSymbolLayer=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){var r;const c=t.getLogger("esri.geometry.support.MeshComponent");f=r=function(d){function g(q){q=d.call(this,q)||this;q.faces=null;q.material=null;q.shading="source";q.trustSourceNormals=!1;return q}a._inheritsLoose(g,d);g.from=function(q){return k.ensureClass(r,q)};var A=g.prototype;A.castFaces=function(q){return z.castArray(q,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},c)};A.castMaterial=function(q){return q&&"object"===typeof q&&("metallic"in
q||"roughness"in q||"metallicRoughnessTexture"in q)?k.ensureClass(m,q):k.ensureClass(l,q)};A.clone=function(){return new r({faces:p.clone(this.faces),shading:this.shading,material:p.clone(this.material),trustSourceNormals:this.trustSourceNormals})};A.cloneWithDeduplication=function(q,y){q={faces:p.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(q,y):null,trustSourceNormals:this.trustSourceNormals};return new r(q)};return g}(f.JSONSupport);u.__decorate([w.property({json:{write:!0}})],
f.prototype,"faces",void 0);u.__decorate([e.cast("faces")],f.prototype,"castFaces",null);u.__decorate([w.property({type:l,json:{write:!0}})],f.prototype,"material",void 0);u.__decorate([e.cast("material")],f.prototype,"castMaterial",null);u.__decorate([w.property({type:String,json:{write:!0}})],f.prototype,"shading",void 0);u.__decorate([w.property({type:Boolean})],f.prototype,"trustSourceNormals",void 0);return f=r=u.__decorate([h.subclass("esri.geometry.support.MeshComponent")],f)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;p=m=function(z){function r(d){d=z.call(this,d)||this;d.color=null;d.colorTexture=null;d.normalTexture=null;d.alphaMode="auto";d.alphaCutoff=.5;d.doubleSided=!0;return d}a._inheritsLoose(r,z);var c=r.prototype;c.clone=function(){return this.cloneWithDeduplication(null,new Map)};c.cloneWithDeduplication=function(d,g){const A=t.isSome(d)?d.get(this):null;if(A)return A;g=new m(this.clonePropertiesWithDeduplication(g));t.isSome(d)&&d.set(this,g);return g};c.clonePropertiesWithDeduplication=
function(d){return{color:t.isSome(this.color)?this.color.clone():null,colorTexture:t.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(d):null,normalTexture:t.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(d):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return r}(p.JSONSupport);u.__decorate([w.property({type:f,json:{write:!0}})],p.prototype,"color",void 0);u.__decorate([w.property({type:l,json:{write:!0}})],p.prototype,
"colorTexture",void 0);u.__decorate([w.property({type:l,json:{write:!0}})],p.prototype,"normalTexture",void 0);u.__decorate([w.property({nonNullable:!0,json:{write:!0}})],p.prototype,"alphaMode",void 0);u.__decorate([w.property({nonNullable:!0,json:{write:!0}})],p.prototype,"alphaCutoff",void 0);u.__decorate([w.property({nonNullable:!0,json:{write:!0}})],p.prototype,"doubleSided",void 0);return p=m=u.__decorate([k.subclass("esri.geometry.support.MeshMaterial")],p)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){var z;const r=new WeakMap;let c=0;f=z=function(d){function g(q){q=d.call(this,q)||this;q.wrap="repeat";return q}a._inheritsLoose(g,d);var A=g.prototype;A.writeData=function(q,y,x,D){q instanceof HTMLImageElement?(q={type:"image-element",src:l.toJSON(q.src,D),crossOrigin:q.crossOrigin},y[x]=q):q instanceof HTMLCanvasElement?(q=q.getContext("2d").getImageData(0,0,q.width,q.height),q={type:"canvas-element",imageData:this.encodeImageData(q)},y[x]=q):q instanceof HTMLVideoElement?
(q={type:"video-element",src:l.toJSON(q.src,D),autoplay:q.autoplay,loop:q.loop,muted:q.muted,crossOrigin:q.crossOrigin,preload:q.preload},y[x]=q):(q={type:"image-data",imageData:this.encodeImageData(q)},y[x]=q)};A.readData=function(q){switch(q.type){case "image-element":var y=new Image;y.src=q.src;y.crossOrigin=q.crossOrigin;return y;case "canvas-element":return q=this.decodeImageData(q.imageData),y=document.createElement("canvas"),y.width=q.width,y.height=q.height,y.getContext("2d").putImageData(q,
0,0),y;case "image-data":return this.decodeImageData(q.imageData);case "video-element":return y=document.createElement("video"),y.src=q.src,y.crossOrigin=q.crossOrigin,y.autoplay=q.autoplay,y.loop=q.loop,y.muted=q.muted,y.preload=q.preload,y}};A.clone=function(){const q={url:this.url,data:this.data,wrap:this.cloneWrap()};return new z(q)};A.cloneWithDeduplication=function(q){var y=q.get(this);if(y)return y;y=this.clone();q.set(this,y);return y};A.cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};A.encodeImageData=function(q){let y="";for(let x=0;x<q.data.length;x++)y+=String.fromCharCode(q.data[x]);return{data:btoa(y),width:q.width,height:q.height}};A.decodeImageData=function(q){const y=atob(q.data),x=new Uint8ClampedArray(y.length);for(let D=0;D<y.length;D++)x[D]=y.charCodeAt(D);return m.wrapImageData(x,q.width,q.height)};A.imageDataContainsTransparent=function(q){for(let y=3;y<q.data.length;y+=4)if(255!==q.data[y])return!0;
return!1};g.from=function(q){return"string"===typeof q?new z({url:q}):q instanceof HTMLImageElement||q instanceof HTMLCanvasElement||q instanceof ImageData||q instanceof HTMLVideoElement?new z({data:q}):w.ensureClass(z,q)};a._createClass(g,[{key:"url",get:function(){return this._get("url")||null},set:function(q){this._set("url",q);q&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(q){this._set("data",q);q&&this._set("url",null)}},{key:"transparent",
get:function(){var q=this.data,y=this.url;return q instanceof HTMLCanvasElement?this.imageDataContainsTransparent(q.getContext("2d").getImageData(0,0,q.width,q.height)):q instanceof ImageData?this.imageDataContainsTransparent(q):y&&(q=y.substr(y.length-4,4).toLowerCase(),y=y.substr(0,15).toLocaleLowerCase(),".png"===q||"data:image/png;"===y)?!0:!1},set:function(q){null!=q?this._override("transparent",q):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const q="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",y=(x="")=>`d:${x},t:${this.transparent},w:${q}`;if(null!=this.url)return y(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return y(this.data.src);r.has(this.data)||r.set(this.data,++c);return y(r.get(this.data))}return y()}}]);return g}(p.JSONSupport);u.__decorate([t.property({type:String,json:{write:l.write}})],f.prototype,"url",null);u.__decorate([t.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
t.property()],f.prototype,"data",null);u.__decorate([k.writer("data")],f.prototype,"writeData",null);u.__decorate([b.reader("data")],f.prototype,"readData",null);u.__decorate([t.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],f.prototype,"transparent",null);u.__decorate([t.property({json:{write:!0}})],f.prototype,"wrap",void 0);u.__decorate([t.property({readOnly:!0})],f.prototype,"contentHash",null);return f=z=u.__decorate([h.subclass("esri.geometry.support.MeshTexture")],
f)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(a,u,f){function p(r,c){const {format:d,quality:g,rotation:A,disableDecorations:q}=r||{};var y=b(r,c.padding);var x=c.width-y.left-y.right;c=c.height-y.top-y.bottom;y={x:0,y:0,width:x,height:c};if(r&&r.area){null!=r.area.x&&(y.x=Math.floor(r.area.x));null!=r.area.y&&(y.y=Math.floor(r.area.y));var D=null!=r.area.width?Math.floor(r.area.width):null,C=null!=r.area.height?Math.floor(r.area.height):
null;y.width=x-y.x;y.height=c-y.y;null!=D&&null!=C?(y.width=Math.min(y.width,D),y.height=Math.min(y.height,C)):null==D&&null!=C?(D=Math.min(y.width,D),y.height*=D/y.width,y.width=D):null!=D&&null==C&&(D=Math.min(y.height,C),y.width*=D/y.height,y.height=D)}y=n(y,r);D=Math.floor(Math.max(y.x,0));C=Math.floor(Math.max(y.y,0));x={x:D,y:C,width:Math.floor(Math.min(y.width,x-D)),height:Math.floor(Math.min(y.height,c-C))};c=x.width/x.height;y=y.width/y.height;y!==c&&(y>c?(c=Math.floor(x.width/y),x={x:x.x,
y:Math.floor(x.y+(x.height-c)/2),width:x.width,height:c}):(c=Math.floor(x.height*y),x={x:Math.floor(x.x+(x.width-c)/2),y:x.y,width:c,height:x.height}));const {width:B,height:v}=e(r,x);a:switch(d){case "png":case "jpg":case "jpeg":c=d;break a;case null:case void 0:c="png";break a;default:c="png"}y=m[c];y=f.clamp(null!=g?g:y,0,100);return{format:c,quality:y,area:x,width:B,height:v,rotation:A,disableDecorations:!!q,ignoreBackground:!(!r||!r.ignoreBackground),ignorePadding:!(!r||!r.ignorePadding)}}function t(r,
c){return r.toDataURL(l[c.format],c.quality/100)}function w(r,c,d){d||(h||(h=document.createElement("canvas"),h.width=1,h.height=1),d=h);return d.getContext("2d").createImageData(r,c)}function e(r,c){if(!r)return c;const d=r.width;r=r.height;if(null!=d&&null!=r)return{width:Math.floor(d),height:Math.floor(r)};if(null==d&&null==r)return c;c=c.width/c.height;return null==r?{width:Math.floor(d),height:Math.floor(d/c)}:{width:Math.floor(r*c),height:Math.floor(r)}}function n(r,c){if(!c||null==c.width||
null==c.height)return r;c=c.width/c.height;const d=r.width/r.height;if(d===c)return r;if(d<c)return c=Math.floor(r.height*c),r.x-=(c-r.width)/2,r.width=c,r;c=Math.floor(r.width/c);r.y-=(c-r.height)/2;r.height=c;return r}function b(r,c){return!c||r&&r.ignorePadding?z:c}let h=null,k=!0;const l={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},m={png:100,jpg:98,jpeg:98},z={top:0,right:0,bottom:0,left:0};a.completeUserSettings=p;a.createEmptyImageData=function(r,c,d){if(!r||!c)throw Error("Cannot construct image data without dimensions");
if(k)try{return new ImageData(r,c)}catch(g){k=!1}return w(r,c,d)};a.encodeResult=function(r,c,d,g){if(g.premultipliedAlpha){{var A=r.data;const y=A.length;for(let x=0;x<y;x+=4){var q=A[x+3];0<q&&(q/=255,A[x+0]/=q,A[x+1]/=q,A[x+2]/=q)}}}d.width=r.width;d.height=r.height;A=d.getContext("2d");A.putImageData(r,0,0);g.flipY&&(A.save(),A.globalCompositeOperation="copy",A.scale(1,-1),A.translate(0,-A.canvas.height),A.drawImage(A.canvas,0,0),A.restore());r=A.getImageData(0,0,r.width,r.height);c=t(d,c);d.width=
0;d.height=0;return{dataUrl:c,data:r}};a.resampleHermite=function(r,c,d,g=0,A=0,q=r.width-g,y=r.height-A,x=!1){const {data:D}=r,{width:C,height:B,data:v}=c;q/=C;y/=B;const E=Math.ceil(q/2),F=Math.ceil(y/2);r=r.width;for(let I=0;I<B;I++)for(let G=0;G<C;G++){const K=4*(G+(x?B-I-1:I)*C);let H=0,J=0,M=0,O=0,Q=0,S=0;const V=(I+.5)*y;for(let Y=Math.floor(I*y);Y<(I+1)*y;Y++){var L=Math.abs(V-(Y+.5))/F;const W=(G+.5)*q;L*=L;for(let ba=Math.floor(G*q);ba<(G+1)*q;ba++){var N=Math.abs(W-(ba+.5))/E;N=Math.sqrt(L+
N*N);if(1<=N)continue;N=2*N*N*N-3*N*N+1;const ca=4*(g+ba+(A+Y)*r);S+=N*D[ca+3];J+=N;!d&&255>D[ca+3]&&(N=N*D[ca+3]/255);M+=N*D[ca];O+=N*D[ca+1];Q+=N*D[ca+2];H+=N}}v[K]=M/H;v[K+1]=O/H;v[K+2]=Q/H;v[K+3]=S/J}return c};a.screenshotSuperSampleSettings=function(r,c,d){if(!c)return r;const {framebufferWidth:g,framebufferHeight:A,pixelRatio:q,region:y}=r;c=b(r,d);d=c.left+c.right;const x=c.top+c.bottom,D=g-d,C=A-x,B=Math.min(8,Math.min((2048-d)/D,(2048-x)/C));return 1.5>B?r:{...r,framebufferWidth:Math.round(D*
B)+d,framebufferHeight:Math.round(C*B)+x,pixelRatio:q*B,resample:{region:{x:Math.round((y.x-c.left)*B)+c.left,y:Math.round((y.y-c.top)*B)+c.top,width:Math.round(y.width*B),height:Math.round(y.height*B)},width:g,height:A}}};a.toDataUrl=t;a.toRenderSettings=function(r,c){const d=p(r,c),g=d.area,A=d.width/g.width,q=b(d,c.padding),y=q.left+q.right,x=q.top+q.bottom;return{framebufferWidth:Math.floor((c.width-y)*A+y),framebufferHeight:Math.floor((c.height-x)*A+x),region:{x:Math.floor(g.x*A)+q.left,y:Math.floor(g.y*
A)+q.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:A,layers:r&&r.layers?r.layers:[],disableDecorations:d.disableDecorations,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};a.wrapImageData=function(r,c,d,g){if(!c||!d)throw Error("Cannot construct image data without dimensions");if(k)try{return new ImageData(r,c,d)}catch(A){k=!1}c=w(c,d,g);c.data.set(r,0);return c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;w=m=function(z){function r(d){d=z.call(this,d)||this;d.emissiveColor=null;d.emissiveTexture=null;d.occlusionTexture=null;d.metallic=1;d.roughness=1;d.metallicRoughnessTexture=null;return d}a._inheritsLoose(r,z);var c=r.prototype;c.clone=function(){return this.cloneWithDeduplication(null,new Map)};c.cloneWithDeduplication=function(d,g){const A=p.isSome(d)?d.get(this):null;if(A)return A;g=new m(this.clonePropertiesWithDeduplication(g));p.isSome(d)&&d.set(this,
g);return g};c.clonePropertiesWithDeduplication=function(d){return{...z.prototype.clonePropertiesWithDeduplication.call(this,d),emissiveColor:p.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:p.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(d):null,occlusionTexture:p.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(d):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:p.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(d):null}};return r}(k);u.__decorate([t.property({type:f,json:{write:!0}})],w.prototype,"emissiveColor",void 0);u.__decorate([t.property({type:l,json:{write:!0}})],w.prototype,"emissiveTexture",void 0);u.__decorate([t.property({type:l,json:{write:!0}})],w.prototype,"occlusionTexture",void 0);u.__decorate([t.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,"metallic",void 0);u.__decorate([t.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,"roughness",void 0);u.__decorate([t.property({type:l,json:{write:!0}})],w.prototype,"metallicRoughnessTexture",void 0);return w=m=u.__decorate([h.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],w)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(d,g,A,q){const {loggerTag:y,stride:x}=g;return 0!==d.length%x?(q.error(y,`Invalid array length, expected a multiple of ${x}`),new A([])):d}function m(d,g,A,q,y){if(!d)return d;if(d instanceof g)return l(d,q,g,y);for(const x of A)if(d instanceof x)return l(new g(d),q,g,y);if(Array.isArray(d))return l(new g(d),q,g,y);A=A.map(x=>`'${x.name}'`);y.error(`Failed to set property, expected one of ${A}, but got ${d.constructor.name}`);return new g([])}function z(d,
g,A){{const q=Array(d.length);for(let y=0;y<d.length;y++)q[y]=d[y];d=q}g[A]=d}var r;const c=w.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=r=function(d){function g(q){q=d.call(this,q)||this;q.color=null;q.position=new Float64Array(0);q.uv=null;q.normal=null;q.tangent=null;return q}u._inheritsLoose(g,d);var A=g.prototype;A.castColor=function(q){return m(q,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},c)};A.castPosition=function(q){q&&q instanceof
Float32Array&&c.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return m(q,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},c)};A.castUv=function(q){return m(q,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},c)};A.castNormal=function(q){return m(q,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},c)};A.castTangent=function(q){return m(q,Float32Array,
[Float64Array],{loggerTag:".tangent\x3d",stride:4},c)};A.clone=function(){const q={position:t.clone(this.position),uv:t.clone(this.uv),normal:t.clone(this.normal),tangent:t.clone(this.tangent),color:t.clone(this.color)};return new r(q)};A.clonePositional=function(){const q={position:t.clone(this.position),normal:t.clone(this.normal),tangent:t.clone(this.tangent),uv:this.uv,color:this.color};return new r(q)};return g}(p.JSONSupport);f.__decorate([e.property({json:{write:z}})],a.MeshVertexAttributes.prototype,
"color",void 0);f.__decorate([n.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);f.__decorate([e.property({nonNullable:!0,json:{write:z}})],a.MeshVertexAttributes.prototype,"position",void 0);f.__decorate([n.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);f.__decorate([e.property({json:{write:z}})],a.MeshVertexAttributes.prototype,"uv",void 0);f.__decorate([n.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);f.__decorate([e.property({json:{write:z}})],
a.MeshVertexAttributes.prototype,"normal",void 0);f.__decorate([n.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);f.__decorate([e.property({json:{write:z}})],a.MeshVertexAttributes.prototype,"tangent",void 0);f.__decorate([n.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=r=f.__decorate([k.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);f=a.MeshVertexAttributes;a.castArray=m;a.default=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(D,C,B,v,E,F){if(C){var L=B.count,N=h.getSphericalPCPF(E);
if(d(E))for(B=0;B<L;B++)v.getVec(B,A),C.getVec(B,q),b.computeLinearTransformation(N,A,y,N),p.fromMat4(x,y),1===D&&p.transpose(x,x),e.transformMat3(q,q,x),F.setVec(B,q);else for(E=0;E<L;E++){v.getVec(E,A);C.getVec(E,q);b.computeLinearTransformation(N,A,y,N);p.fromMat4(x,y);var I=l.y2lat(B.get(E,1));I=Math.cos(I);0===D&&(I=1/I);x[0]*=I;x[1]*=I;x[2]*=I;x[3]*=I;x[4]*=I;x[5]*=I;1===D&&p.transpose(x,x);e.transformMat3(q,q,x);e.normalize(q,q);F.setVec(E,q)}return F}}function c(D){return d(D)||D.isWebMercator}
function d(D){return D.isWGS84||k.isCGCS2000(D)||k.isMars(D)||k.isMoon(D)}const g=u.getLogger("esri.geometry.support.meshUtils.normalProjection"),A=n.create(),q=n.create(),y=w.create(),x=t.create();a.projectFromPCPF=function(D,C,B){b.projectBuffer(D,h.getSphericalPCPF(B),0,C,B,0,D.length/3);return C};a.projectNormalFromPCPF=function(D,C,B,v,E){if(!c(v))return g.error("Cannot convert to spatial reference from PCPF"),E;r(1,m.BufferViewVec3f.fromTypedArray(D),m.BufferViewVec3f64.fromTypedArray(C),m.BufferViewVec3f64.fromTypedArray(B),
v,m.BufferViewVec3f.fromTypedArray(E));return E};a.projectNormalToPCPF=function(D,C,B,v,E){if(!c(v))return g.error("Cannot convert spatial reference to PCPF"),E;r(0,m.BufferViewVec3f.fromTypedArray(D),m.BufferViewVec3f64.fromTypedArray(C),m.BufferViewVec3f64.fromTypedArray(B),v,m.BufferViewVec3f.fromTypedArray(E));return E};a.projectTangentFromPCPF=function(D,C,B,v,E){if(!c(v))return g.error("Cannot convert to spatial reference from PCPF"),E;r(1,m.BufferViewVec3f.fromTypedArray(D,16),m.BufferViewVec3f64.fromTypedArray(C),
m.BufferViewVec3f64.fromTypedArray(B),v,m.BufferViewVec3f.fromTypedArray(E,16));for(C=3;C<D.length;C+=4)E[C]=D[C];return E};a.projectTangentToPCPF=function(D,C,B,v,E){if(!c(v))return g.error("Cannot convert spatial reference to PCPF"),E;r(0,m.BufferViewVec3f.fromTypedArray(D,4*Float32Array.BYTES_PER_ELEMENT),m.BufferViewVec3f64.fromTypedArray(C),m.BufferViewVec3f64.fromTypedArray(B),v,m.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT));for(C=3;C<D.length;C+=4)E[C]=D[C];return E};
a.projectToPCPF=function(D,C,B){b.projectBuffer(D,C,0,B,h.getSphericalPCPF(C),0,D.length/3);return B};a.transformNormal=function(D,C,B){if(f.isNone(D))return C;p.normalFromMat4(x,B);D=m.BufferViewVec3f.fromTypedArray(D);B=m.BufferViewVec3f.fromTypedArray(C);z.transformMat3(B,D,x);p.isOrthoNormal(x)||z.normalize(B,B);return C};a.transformPosition=function(D,C,B){if(f.isNone(D))return C;D=m.BufferViewVec3f64.fromTypedArray(D);const v=m.BufferViewVec3f64.fromTypedArray(C);z.transformMat4(v,D,B);return C};
a.transformTangent=function(D,C,B){if(f.isNone(D))return C;p.normalFromMat4(x,B);B=m.BufferViewVec3f.fromTypedArray(D,4*Float32Array.BYTES_PER_ELEMENT);const v=m.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT);z.transformMat3(v,B,x);p.isOrthoNormal(x)||z.normalize(v,v);if(D!==C)for(B=3;B<D.length;B+=4)C[B]=D[B];return C};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],
function(a,u,f){a.encodeSymbolColor=function(p,t,w){if(f.isNone(p)||2===t)w[0]=255,w[1]=255,w[2]=255,w[3]=255;else{var e=u.clamp(Math.round(85*p[3]),0,85);t=0===e||4===t?0:3===t?85:170;w[0]=u.clamp(Math.round(255*p[0]),0,255);w[1]=u.clamp(Math.round(255*p[1]),0,255);w[2]=u.clamp(Math.round(255*p[2]),0,255);w[3]=e+t}};a.parseColorMixMode=function(p){switch(p){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;default:return 1}};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){const y=f.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");f=function(W){function ba(da){da=W.call(this,da,C)||this;da.techniqueConfig=new q.NativeLineTechniqueConfiguration;return da}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.getTechniqueConfig=function(da){this.techniqueConfig.output=da;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=
1>this.params.color[3]||1>this.params.width;da=p.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=da;this.techniqueConfig.stippleOffColorEnabled=da&&p.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=da&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};ca.getPassParameters=function(){return this.params};ca.intersect=function(da,ha,fa,R,U,Z,T,P,X){X?g.intersectDrapedRenderLineGeometry(da,
R,Z,1,T):this.intersectLineGeometry(da,ha,fa,R,T)};ca.intersectLineGeometry=function(da,ha,fa,R,U){if(R.options.selectionMode&&!A.isInstanceHidden(ha))if(r.isTranslationMatrix(fa)){ha=da.vertexAttributes.get("position").data;var Z=R.camera,T=J;w.copy(T,R.point);e.set(M[0],T[0]-2,T[1]+2,0);e.set(M[1],T[0]+2,T[1]+2,0);e.set(M[2],T[0]+2,T[1]-2,0);e.set(M[3],T[0]-2,T[1]-2,0);for(da=0;4>da;da++)if(!Z.unprojectFromRenderScreen(M[da],O[da]))return;h.fromPoints(Z.eye,O[0],O[1],Q);h.fromPoints(Z.eye,O[1],
O[2],S);h.fromPoints(Z.eye,O[2],O[3],V);h.fromPoints(Z.eye,O[3],O[0],Y);da=Number.MAX_VALUE;for(let X=0;X<ha.length-5;X+=3)if(B[0]=ha[X]+fa[12],B[1]=ha[X+1]+fa[13],B[2]=ha[X+2]+fa[14],v[0]=ha[X+3]+fa[12],v[1]=ha[X+4]+fa[13],v[2]=ha[X+5]+fa[14],!(0>h.signedDistance(Q,B)&&0>h.signedDistance(Q,v)||0>h.signedDistance(S,B)&&0>h.signedDistance(S,v)||0>h.signedDistance(V,B)&&0>h.signedDistance(V,v)||0>h.signedDistance(Y,B)&&0>h.signedDistance(Y,v))){Z.projectToRenderScreen(B,L);Z.projectToRenderScreen(v,
N);if(0>L[2]&&0<N[2]){e.subtract(E,B,v);var P=Z.frustum;P=-h.signedDistance(P[4],B)/e.dot(E,h.normal(P[4]));e.scale(E,E,P);e.add(B,B,E);Z.projectToRenderScreen(B,L)}else if(0<L[2]&&0>N[2])e.subtract(E,v,B),P=Z.frustum,P=-h.signedDistance(P[4],v)/e.dot(E,h.normal(P[4])),e.scale(E,E,P),e.add(v,v,E),Z.projectToRenderScreen(v,N);else if(0>L[2]&&0>N[2])continue;L[2]=0;N[2]=0;P=b.distance2(b.fromPoints(L,N,K),T);P<da&&(da=P,e.copy(I,B),e.copy(G,v))}fa=R.rayBeginPoint;R=R.rayEndPoint;4>da&&(da=Number.MAX_VALUE,
b.closestLineSegmentPoint(b.fromPoints(I,G,K),b.fromPoints(fa,R,H),F)&&(e.subtract(F,F,fa),da=e.length(F),e.scale(F,F,1/da),da/=e.distance(fa,R)),U(da,F))}else y.error("intersection assumes a translation-only matrix")};ca.computeAttachmentOrigin=function(da,ha){da=da.vertexAttributes;if(!da)return!1;da=da.get("position");return l.computeAttachmentOriginLines(da,null,!1,ha)};ca.createBufferWriter=function(){const da=this.params.vertexColors?d.PositionColorLayout:d.PositionLayout;return p.isNone(this.params.stipplePattern)?
new d.DefaultBufferWriter(da):new D(da.clone().vec3f("auxpos1"))};ca.getGLMaterial=function(da){return 0===da.output||4===da.output?new x(da):void 0};return ba}(z.Material);let x=function(W){function ba(da){da=W.call(this,da)||this;da.updateParameters();return da}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.updateParameters=function(){this._technique=this._techniqueRep.releaseAndAcquire(q.NativeLineTechnique,this._material.getTechniqueConfig(this._output),this._technique)};ca.beginSlot=function(da){return 3===
da};ca._updateOccludeeState=function(da){da.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:da.hasOccludees}),this.updateParameters())};ca.ensureParameters=function(da){0===this._output&&this._updateOccludeeState(da)};ca.bind=function(da){this._technique.bindPass(this._material.getPassParameters(),da)};ca.getPipelineState=function(da,ha){return this._technique.getPipelineState(ha)};return ba}(m),D=function(){function W(ca){this.vertexBufferLayout=
ca}var ba=W.prototype;ba.allocate=function(ca){return this.vertexBufferLayout.createBuffer(ca)};ba.elementCount=function(ca){return ca.indices.get("position").length};ba.write=function(ca,da,ha,fa){c.writeDefaultAttributes(da,this.vertexBufferLayout,ca.transformation,ca.invTranspTransformation,ha,fa);this.writeAuxpos1(ca,da,ha,fa)};ba.writeAuxpos1=function(ca,da,ha,fa){var R=ha.getField("auxpos1",k.BufferViewVec3f);ha=da.indices.get("position");da=da.vertexAttributes.get("position").data;ca=ca.transformation;
const U=R.typedBufferStride;R=R.typedBuffer;fa*=U;for(let X=0;X<ha.length;X+=2){var Z=3*ha[X],T=da[Z],P=da[Z+1];const aa=da[Z+2];Z=ca[0]*T+ca[4]*P+ca[8]*aa+ca[12];const ja=ca[1]*T+ca[5]*P+ca[9]*aa+ca[13];T=ca[2]*T+ca[6]*P+ca[10]*aa+ca[14];for(P=0;2>P;++P)R[fa]=Z,R[fa+1]=ja,R[fa+2]=T,fa+=U}};return W}();const C={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...z.materialParametersDefaults},B=n.create(),
v=n.create(),E=n.create(),F=n.create(),L=t.createRenderScreenPointArray3(),N=t.createRenderScreenPointArray3(),I=n.create(),G=n.create(),K=b.create(),H=b.create(),J=n.create(),M=[t.createRenderScreenPointArray3(),t.createRenderScreenPointArray3(),t.createRenderScreenPointArray3(),t.createRenderScreenPointArray3()],O=[n.create(),n.create(),n.create(),n.create()],Q=h.create(),S=h.create(),V=h.create(),Y=h.create();a.NativeLineMaterial=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports",
"../../../support/buffer/InterleavedLayout","./bufferWriterUtils"],function(a,u,f){const p=u.newLayout().vec3f("position"),t=u.newLayout().vec3f("position").vec2f("uv0");u=u.newLayout().vec3f("position").vec4u8("color");let w=function(){function e(b){this.vertexBufferLayout=b}var n=e.prototype;n.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};n.elementCount=function(b){return b.indices.get("position").length};n.write=function(b,h,k,l){f.writeDefaultAttributes(h,this.vertexBufferLayout,
b.transformation,b.invTranspTransformation,k,l)};return e}();a.DefaultBufferWriter=w;a.PositionColorLayout=u;a.PositionLayout=p;a.PositionUVLayout=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){h=function(d){function g(q,y,x){y=d.call(this,q,y,x)||this;y.stipplePattern=null;y.stippleTextureBind=null;y.stippleTextureRepository=q.stippleTextureRepository;return y}f._inheritsLoose(g,d);var A=g.prototype;A.initializeProgram=function(q){var y=g.shader.get();const x=this.configuration;y=y.build({output:x.output,attributeColor:x.vertexColors,slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:x.stippleEnabled,
stippleOffColorEnabled:x.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:x.stippleIntegerRepeatsEnabled});return new m.Program(q.rctx,y,l.Default3D)};A.dispose=function(){d.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};A.bindPass=function(q,y){n.bindProjectionMatrix(this.program,y.camera.projectionMatrix);if(this.stipplePattern!==q.stipplePattern){var x=q.stipplePattern;this.stippleTextureBind=
this.stippleTextureRepository.swap(this.stipplePattern,x);this.stipplePattern=x}this.configuration.stippleEnabled&&(x=t.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program)*y.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/x),this.program.setUniform2f("ndcToPixel",y.camera.fullViewport[2]/2,y.camera.fullViewport[3]/2));this.program.setUniform4fv("constantColor",q.color);this.program.setUniform1f("alphaCoverage",
Math.min(1,q.width*y.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(q=t.unwrap(q.stippleOffColor),this.program.setUniform4f("stippleOffColor",q[0],q[1],q[2],3<q.length?q[3]:1));4===this.configuration.output&&e.bindOutputHighlight(this.program,y)};A.bindDraw=function(q){n.bindView(this.program,q);w.bindSliceUniformsWithOrigin(this.program,this.configuration,q);this.program.rebindTextures()};A.initializePipeline=function(){const q=this.configuration,y=c.separateBlendingParams(770,1,
771,771),x=(D,C=null,B=null)=>c.makePipelineState({blending:C,depthTest:z.depthCompareLess,depthWrite:B,colorWrite:c.defaultColorWriteParams,stencilWrite:q.sceneHasOcludees?z.stencilWriteMaskOn:null,stencilTest:q.sceneHasOcludees?D?z.stencilToolMaskBaseParams:z.stencilBaseAllZerosParams:null});return 0===q.output?(this._occludeePipelineState=x(!0,q.transparent||q.stippleEnabled?y:null,c.defaultDepthWriteParams),x(!1,q.transparent||q.stippleEnabled?y:null,c.defaultDepthWriteParams)):x(!1)};A.getPipelineState=
function(q){return q?this._occludeePipelineState:this.pipeline};f._createClass(g,[{key:"primitiveType",get:function(){return 1}}]);return g}(h.ShaderTechnique);h.shader=new b.ReloadableShaderModule(r.NativeLineShader,()=>new Promise(function(d,g){a(["./NativeLine.glsl"],d,g)}));b=function(d){function g(){var A=d.apply(this,arguments)||this;A.output=0;A.slicePlaneEnabled=!1;A.vertexColors=!1;A.transparent=!1;A.stippleEnabled=!1;A.stippleOffColorEnabled=!1;A.stippleIntegerRepeatsEnabled=!1;A.sceneHasOcludees=
!1;return A}f._inheritsLoose(g,d);return g}(k.ShaderTechniqueConfiguration);p.__decorate([k.parameter({count:8})],b.prototype,"output",void 0);p.__decorate([k.parameter()],b.prototype,"slicePlaneEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"vertexColors",void 0);p.__decorate([k.parameter()],b.prototype,"transparent",void 0);p.__decorate([k.parameter()],b.prototype,"stippleEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"stippleOffColorEnabled",void 0);p.__decorate([k.parameter()],
b.prototype,"stippleIntegerRepeatsEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"sceneHasOcludees",void 0);u.NativeLineTechnique=h;u.NativeLineTechniqueConfiguration=b;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b){function h(l){const m=new b.ShaderBuilder;m.include(f.Transform,{linearDepth:!1});m.include(p.VertexColor,l);m.include(w.LineStipple,l);m.vertex.uniforms.add("proj","mat4").add("view","mat4");m.attributes.add("position","vec3");m.varyings.add("vpos","vec3");m.vertex.code.add(n.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);l.stippleEnabled&&(m.attributes.add("auxpos1","vec3"),m.vertex.uniforms.add("ndcToPixel","vec2"),m.vertex.code.add(n.glsl`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${l.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `));m.vertex.code.add(n.glsl`}`);4===l.output&&m.include(t.OutputHighlight);m.include(u.Slice,l);m.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");m.fragment.code.add(n.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${l.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${n.glsl.float(e.symbolAlphaCutoff)}) {
      discard;
    }

    ${0===l.output?n.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===l.output?n.glsl`outputHighlight();`:""}
  }
  `);return m}var k=Object.freeze({__proto__:null,build:h});a.NativeLineShader=k;a.build=h})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L){A=function(J){function M(Q,S,V,Y){Q=J.call(this,Q,S,V,Y)||this;Q._resources=null;Q._optionalFields=[];Q._instanceIndexToGraphicUid=new Map;Q.hasLoadedPBRTextures=!1;Q.ensureDrapedStatus(!1);Q.hasLoadedPBRTextures=V.physicalBasedRenderingEnabled;return Q}u._inheritsLoose(M,J);var O=M.prototype;O.getCachedSize=function(){const [Q,S,V]=p.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:Q,depth:S,height:V}};O.doLoad=
function(){var Q=u._asyncToGenerator(function*(S){if(!this._drivenProperties.size&&q.validateSymbolLayerSize(this.symbolLayer))throw Error();const V=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(V.resource?V.resource.primitive:m.defaultPrimitive,S):yield this._createResourcesForUrl(V.resource.href,S);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()});return function(S){return Q.apply(this,
arguments)}}();O.setMaterialTransparencyParams=function(Q,S=p.get(this.symbolLayer,"material","color")){S=this._getCombinedOpacity(S);const V=1>S||this.needsDrivenTransparentPass;Q.transparent=V;Q.opacity=S;Q.cullFace=V?0:2;return Q};O._createResourcesForPrimitive=function(){var Q=u._asyncToGenerator(function*(S,V){if(!C.isValidPrimitive(S))throw Error(`Unknown object symbol primitive: ${S}`);var Y=this.symbolLayer;const W=l.create(z.objectSymbolLayerPrimitiveBoundingBox(S)),ba=b.fromArray(l.size(W)),
ca=b.fromArray(z.objectSymbolLayerSizeWithResourceSize(ba,Y)),da=n.length(ca);var ha={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:b.ONES,diffuse:b.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const fa=ha.usePBR;this.setMaterialTransparencyParams(ha);const R=this.symbol;if("point-3d"===R.type&&R.verticalOffset){const {screenLength:U,
minWorldLength:Z,maxWorldLength:T}=R.verticalOffset;ha.verticalOffset={screenLength:t.pt2px(U),minWorldLength:Z||0,maxWorldLength:null!=T?T:Infinity};ha.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ha.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ha.externalColor=h.ONES:(Y=p.isSome(Y.material)&&Y.material.color,Y=p.isSome(Y)?f.toUnitRGBA(Y):h.ONES,ha.externalColor=Y);this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions(W,ca,ba,p.none));this._fastUpdates.enabled?(Object.assign(ha,this._fastUpdates.materialParameters),ha.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ha.instanced.push("color"),this._optionalFields.push("color"));ha=new L.DefaultMaterial(ha);ha=C.primitiveLodResources(S,ha);if(!ha)throw Error(`Unknown object symbol primitive: ${S}`);S=F.materialsFromLodResources(ha).map(U=>({opacity:1,transparent:U.params.transparent}));
Y=this._createStageResources(ha,fa);V=yield this._createLodRenderer(ha,V);return{lodResources:ha,lodRenderer:V,stageResources:Y,symbolSize:ca,extentPadding:da,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:S,physicalBasedRenderingEnabled:fa,resourceBoundingBox:W,resourceSize:ba,dispose:p.none,pivotOffset:p.none}});return function(S,V){return Q.apply(this,arguments)}}();O._createResourcesForUrl=function(){var Q=u._asyncToGenerator(function*(S,V){var Y=["transformation"],W={materialParamsMixin:{instanced:Y,
slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(p.none,p.none,p.none,p.none));this._fastUpdates.enabled?(Object.assign(W.materialParamsMixin,this._fastUpdates.materialParameters),Y.push("featureAttribute"),this._optionalFields.push("featureAttribute")):
this._hasPerInstanceColor()&&(Y.push("color"),this._optionalFields.push("color"));Y=this.symbol;if("point-3d"===Y.type&&Y.verticalOffset){const {screenLength:ia,minWorldLength:ka,maxWorldLength:na}=Y.verticalOffset;W.materialParamsMixin.verticalOffset={screenLength:t.pt2px(ia),minWorldLength:ka||0,maxWorldLength:null!=na?na:Infinity};W.materialParamsMixin.castShadows=!1}W.signal=V;W.usePBR=this._context.physicalBasedRenderingEnabled;Y=W.usePBR;var ba=yield x.fetch(S,W);S=ba.isEsriSymbolResource;W=
ba.isWosr;const ca=ba.remove,da=y.makeLodResources(ba.lods);y.fillEstimatedMinScreenSpaceRadius(da);da.levels.sort((ia,ka)=>ia.minScreenSpaceRadius-ka.minScreenSpaceRadius);da.levels[0].minScreenSpaceRadius=Math.min(2,da.levels[0].minScreenSpaceRadius);const ha=this._context,fa=this._getExternalColorParameters(this.symbolLayer.material);var R=p.get(this.symbolLayer,"material","color");const U=this._getCombinedOpacity(R,{hasIntrinsicColor:!0}),Z=this.needsDrivenTransparentPass;var T=F.materialsFromLodResources(da);
R=F.materialsFromLodResources(da).map(ia=>({opacity:ia.params.opacity||1,transparent:ia.params.transparent}));T.forEach(ia=>{const ka=ia.params;ia.setParameterValues(fa);const na=ka.opacity*U;ia.setParameterValues({opacity:na,transparent:1>na||Z||ka.transparent});ha.screenSizePerspectiveEnabled&&ia.setParameterValues({screenSizePerspective:ha.sharedResources.screenSizePerspectiveSettings})});ba=ba.referenceBoundingBox;const P=b.fromArray(l.size(ba)),X=b.fromArray(da.levels[0].pivotOffset),aa=b.fromArray(z.objectSymbolLayerSizeWithResourceSize(P,
this.symbolLayer)),ja=n.length(aa);v.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(ba,aa,P,X))&&T.forEach(ia=>ia.setParameterValues(this._fastUpdates.materialParameters));T=this._createStageResources(da,Y);V=yield this._createLodRenderer(da,V);return{lodResources:da,lodRenderer:V,stageResources:T,symbolSize:aa,extentPadding:ja,isEsriSymbolResource:S,isWosr:W,originalMaterialParameters:R,physicalBasedRenderingEnabled:Y,resourceBoundingBox:ba,
resourceSize:P,dispose:ca,pivotOffset:X}});return function(S,V){return Q.apply(this,arguments)}}();O._createStageResources=function(Q,S){const V=this._context.stage,Y=F.materialsFromLodResources(Q);S!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();V.addMany(Y);S=F.texturesFromLodResources(Q);V.addMany(S);Q=F.geometriesFromLodResources(Q);V.addMany(Q);return{materials:Y,textures:S,geometries:Q}};O._createLodRenderer=function(){var Q=u._asyncToGenerator(function*(S,
V){const Y=this._context.stage;S=new E.LodRenderer(S,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:W=>this._instanceIndexToGraphicUid.get(W),notifyGraphicGeometryChanged:W=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(W)),notifyGraphicVisibilityChanged:W=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(W))},this._fastUpdates.enabled?{applyTransform:(W,ba,ca)=>{W.getFeatureAttribute(ba,K);w.copy(ca,v.evaluateModelTransform(this._fastUpdates.materialParameters,
K,ca))},scaleFactor:(W,ba,ca)=>{ba.getFeatureAttribute(ca,K);return v.evaluateModelTransformScale(W,this._fastUpdates.materialParameters,K)}}:null);S.slicePlane=this._context.slicePlaneEnabled;yield Y.addRenderPlugin(S.slots,S,V);return S});return function(S,V){return Q.apply(this,arguments)}}();O._getExternalColorParameters=function(Q){const S={};this._drivenProperties.color?S.externalColor=h.ONES:p.isSome(Q)&&p.isSome(Q.color)?S.externalColor=f.toUnitRGBA(Q.color):(S.externalColor=h.ONES,S.colorMixMode=
"ignore");return S};O.destroy=function(){J.prototype.destroy.call(this);const Q=this._context.stage;if(p.isSome(this._resources)){Q.removeRenderPlugin(this._resources.lodRenderer);const S=this._resources.stageResources;Q.removeMany(S.materials);Q.removeMany(S.textures);Q.removeMany(S.geometries);p.isSome(this._resources.dispose)&&this._resources.dispose()}this._resources=null};O.createGraphics3DGraphic=function(Q){const S=Q.graphic;if(!this._validateGeometry(S.geometry))return null;const V=D.placePointOnGeometry(S.geometry);
if(p.isNone(V))return this.logger.warn(`unsupported geometry type for icon symbol: ${S.geometry.type}`),null;const Y=this.setGraphicElevationContext(S,new d.ElevationContext);return this._createAs3DShape(S,V,Q.renderingInfo,Y,S.uid)};O.notifyDestroyGraphicLayer=function(Q){this._instanceIndexToGraphicUid.delete(Q.instanceIndex)};O.graphicLayerToGraphicId=function(){return 0};O.layerOpacityChanged=function(){if(p.isNone(this._resources))return!0;const Q=this._drivenProperties.opacity,S=!this.isPrimitive,
V=this._resources.stageResources.materials,Y=this._resources.originalMaterialParameters;for(let ca=0;ca<V.length;ca++){const da=V[ca];var W=p.get(this.symbolLayer,"material","color"),ba=Y[ca];W=this._getCombinedOpacity(W,{hasIntrinsicColor:S})*ba.opacity;ba=1>W||Q||ba.transparent;da.setParameterValues({opacity:W,transparent:ba});this.isPrimitive&&da.setParameterValues({cullFace:ba?0:2})}return!0};O.layerElevationInfoChanged=function(Q,S){return this.updateGraphics3DGraphicElevationInfo(Q,S,c.needsElevationUpdates3D)};
O.slicePlaneEnabledChanged=function(){if(p.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const Q of this._resources.stageResources.materials)Q.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};O.physicalBasedRenderingChanged=function(){if(p.isNone(this._resources))return!0;const {stageResources:Q,isWosr:S}=this._resources;for(const V of Q.materials)this.isPrimitive?V.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0}):S||V.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};O.pixelRatioChanged=function(){return!0};O.applyRendererDiff=function(Q,S){if(p.isNone(this._resources))return!0;const {stageResources:{materials:V},lodRenderer:Y,resourceBoundingBox:W,symbolSize:ba,resourceSize:ca,pivotOffset:da}=this._resources;for(const ha in Q.diff)switch(ha){case "visualVariables":if(v.updateFastSymbolUpdatesState(this._fastUpdates,
S,this._fastVisualVariableConvertOptions(W,ba,ca,da))){for(const fa of V)fa.setParameterValues(this._fastUpdates.materialParameters);Y.notifyShaderTransformationChanged()}else return!1;break;default:return!1}return!0};O.computeComplexity=function(){if(p.isNone(this._resources))return J.prototype.computeComplexity.call(this);const Q=F.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((V,Y)=>V+Y.indices.get("position").length,0)/3,S=B.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer);return{primitivesPerFeature:Q,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:S}};O.hasLodRenderer=function(){return p.isSome(this._resources)};O._createAs3DShape=function(Q,S,V,Y,W){if(!this.hasLodRenderer()||p.isNone(this._resources))return null;Q=this.getFastUpdateAttrValues(Q);const ba=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?q.mixinColorAndOpacity(V.color,V.opacity):null;var ca=this._context.clippingExtent;k.projectPointToVector(S,N,this._context.elevationProvider.spatialReference);
if(p.isSome(ca)&&!l.containsPoint(ca,N))return null;ca=this._requiresTerrainElevation(Y);const da=this._computeGlobalTransform(S,Y,G,ca?H:null);V=this._computeLocalTransform(this._resources,this.symbolLayer,V,I);const ha=this._resources.lodRenderer.instanceData,fa=ha.addInstance();this._instanceIndexToGraphicUid.set(fa,W);ha.setLocalTransform(fa,V,!1);ha.setGlobalTransform(fa,da);Q&&ha.setFeatureAttribute(fa,Q);ba&&ha.setColor(fa,ba);W=new g(this,fa,r.perLodInstanceElevationAligner,Y);ca&&(W.alignedSampledElevation=
H.sampledElevation);W.needsElevationUpdates=c.needsElevationUpdates3D(Y.mode);D.extendPointGraphicElevationContext(W,S,this._context.elevationProvider);return W};O._computeGlobalTransform=function(Q,S,V,Y){S=c.evaluateElevationAlignmentAtPoint(Q,this._context.elevationProvider,S,this._context.renderCoordsHelper,Y);N[0]=Q.x;N[1]=Q.y;N[2]=S;k.computeLinearTransformation(Q.spatialReference,N,V,this._context.renderCoordsHelper.spatialReference);return V};O._computeLocalTransform=function(Q,S,V,Y){w.identity(Y);
this._applyObjectRotation(V,!1,Y);this._applyObjectRotation(S,!0,Y);this._applyObjectScale(Q,V,Y);this._applyAnchor(Q,S,Y);return Y};O._applyObjectScale=function(Q,S,V){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(Q=q.computeObjectScale(this._drivenProperties.size&&S.size?S.size:Q.symbolSize,Q.symbolSize,Q.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===Q[0]&&1===Q[1]&&1===Q[2]||w.scale(V,V,Q))};O.prepareSymbolLayerPatch=function(Q){if("partial"===Q.diff.type){var S=
Q.diff.diff;this._preparePatchTransform(Q,S);this._preparePatchColor(Q,S)}};O.updateGeometry=function(Q,S){if(p.isNone(this._resources))return!0;const V=S&&D.placePointOnGeometry(S);if(p.isNone(V))return!1;S=this.getGeometryElevationMode(S);if(Q.elevationContext.mode!==S)return!1;S=this._requiresTerrainElevation(Q.elevationContext);this._computeGlobalTransform(V,Q.elevationContext,G,S?H:null);S&&(Q.alignedSampledElevation=H.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(Q.instanceIndex,
G,!0);D.extendPointGraphicElevationContext(Q,V,this._context.elevationProvider);return!0};O._preparePatchTransform=function(Q,S){if((S.heading||S.tilt||S.roll||S.width||S.height||S.depth||S.anchor||S.anchorPosition)&&!p.isNone(this._resources)){var V=(Z,T,P)=>p.unwrapOr(null!=Z&&"complete"===Z.type?Z.newValue:T,P),Y=V(S.heading,this.symbolLayer.heading,0),W=V(S.tilt,this.symbolLayer.tilt,0),ba=V(S.roll,this.symbolLayer.roll,0),ca=V(S.width,this.symbolLayer.width,void 0),da=V(S.height,this.symbolLayer.height,
void 0),ha=V(S.depth,this.symbolLayer.depth,void 0),fa=V(S.anchor,this.symbolLayer.anchor,void 0);V=V(S.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete S.heading;delete S.tilt;delete S.roll;delete S.width;delete S.height;delete S.depth;delete S.anchor;delete S.anchorPosition;var R={heading:Y,tilt:W,roll:ba,anchor:fa,anchorPosition:V},U=this._resources;1===this.loadStatus&&Q.symbolLayerStatePatches.push(()=>{U.symbolSize=b.fromArray(z.objectSymbolLayerSizeWithResourceSize(U.resourceSize,
{width:ca,height:da,depth:ha,isPrimitive:this.symbolLayer.isPrimitive}))});Q.graphics3DGraphicPatches.push((Z,T)=>{T=this._computeLocalTransform(U,R,T,I);U.lodRenderer.instanceData.setLocalTransform(Z.instanceIndex,T,!0)})}};O._preparePatchColor=function(Q,S){if(S.material&&"partial"===S.material.type&&(S=S.material.diff,S.color&&"complete"===S.color.type&&null!=S.color.newValue&&null!=S.color.oldValue)){var V=S.color.newValue,Y=p.isSome(V)?f.toUnitRGBA(V):h.ONES;delete S.color;var W=this._resources;
p.isNone(W)||Q.graphics3DGraphicPatches.push(ba=>{this._hasPerInstanceColor()?(W.lodRenderer.instanceData.setColor(ba.instanceIndex,Y),ba=this.setMaterialTransparencyParams({},V)):ba=this.setMaterialTransparencyParams({externalColor:Y},V);for(const ca of W.stageResources.materials)ca.setParameterValues(ba)})}};O._requiresTerrainElevation=function(Q){return"absolute-height"!==Q.mode};O._applyObjectRotation=function(Q,S,V){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&
S))return q.computeObjectRotation(Q.heading,Q.tilt,Q.roll,V)};O._computeAnchor=function(Q,S,V){const Y=b.create();switch(V.anchor){case "center":n.copy(Y,l.center(Q));n.negate(Y,Y);break;case "top":S=l.center(Q);n.set(Y,-S[0],-S[1],-Q[5]);break;case "bottom":S=l.center(Q);n.set(Y,-S[0],-S[1],-Q[2]);break;case "relative":S=l.center(Q);Q=l.size(Q);V=(V=V.anchorPosition)?b.fromValues(V.x,V.y,V.z):b.ZEROS;n.multiply(Y,Q,V);n.add(Y,Y,S);n.negate(Y,Y);break;default:p.isSome(S)?n.negate(Y,S):n.copy(Y,b.ZEROS)}return Y};
O._applyAnchor=function(Q,S,V){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(Q=this._computeAnchor(Q.resourceBoundingBox,Q.pivotOffset,S))&&w.translate(V,V,Q)};O._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};O._fastVisualVariableConvertOptions=function(Q,S,V,Y){const W=p.isSome(Q)?b.fromArray(l.size(Q)):b.ONES;Q=p.isSome(Q)?this._computeAnchor(Q,Y,this.symbolLayer):b.ZEROS;Y=this._context.renderCoordsHelper.unitInMeters;
V=q.computeObjectScale(p.isSome(S)?S:void 0,S,V,Y);const ba=b.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:W,symbolSize:p.isSome(S)?S:b.ONES,unitInMeters:Y,transformation:{anchor:Q,scale:V,rotation:ba}}};u._createClass(M,[{key:"extentPadding",get:function(){return p.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",
get:function(){return p.get(this._resources,"lodRenderer")}}]);return M}(A.Graphics3DSymbolLayer);const N=b.create(),I=e.create(),G=e.create(),K=h.create(),H={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DObjectSymbolLayer=A;a.default=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/symbolLayerUtils3D":function(){define(["exports","../../core/has","../../chunks/vec3f64","../../geometry/support/aaBoundingBox"],function(a,u,f,p){const t=p.fromValues(-.5,-.5,-.5,
.5,.5,.5),w=p.fromValues(-.5,-.5,0,.5,.5,1),e=p.fromValues(-.5,-.5,0,.5,.5,.5);a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON=e;a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE=t;a.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER=w;a.objectSymbolLayerPrimitiveBoundingBox=function(n){switch(n){case "sphere":case "cube":case "diamond":return t;case "cylinder":case "cone":case "inverted-cone":return w;case "tetrahedron":return e}};a.objectSymbolLayerSizeWithResourceSize=function(n,{isPrimitive:b,width:h,depth:k,
height:l}){b=b?10:1;if(null==h&&null==l&&null==k)return[b*n[0],b*n[1],b*n[2]];h=f.fromValues(h,k,l);let m;for(k=0;3>k;k++)if(l=h[k],null!=l){m=l/n[k];break}for(k=0;3>k;k++)null==h[k]&&(h[k]=n[k]*m);return h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,u,f,p,t,w,e,n,b){let h=function(){function c(g,A,q,y){this.graphics3DSymbolLayer=g;this.instanceIndex=A;this.elevationAligner=q;this.elevationContext=y;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var d=c.prototype;d.initialize=function(){};d.setVisibility=function(g){const A=this.lodRenderer.instanceData;g!==A.getVisible(this.instanceIndex)&&A.setVisible(this.instanceIndex,g)};d.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};d.alignWithElevation=function(g,A,q){this.elevationAligner&&(e.setContextFeature(this.elevationContext.featureExpressionInfoContext,q),g=this.elevationAligner(this,this.elevationContext,g,A),null!=g&&(this.alignedSampledElevation=g))};d.getCenterObjectSpace=function(g=t.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,r);return p.transformMat4(g,
this.lodRenderer.baseBoundingSphere.center,r)};d.getBoundingBoxObjectSpace=function(g=w.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,r);const A=this.lodRenderer.baseBoundingBox;w.empty(g);for(let q=0;8>q;++q)p.set(l,0===(q&1)?A[0]:A[3],0===(q&2)?A[1]:A[4],0===(q&4)?A[2]:A[5]),p.transformMat4(l,l,r),w.expandWithVec3(g,l);return g};d.computeAttachmentOrigin=function(g){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,r);g.render.origin[0]+=
r[12];g.render.origin[1]+=r[13];g.render.origin[2]+=r[14];g.render.num++};d.getProjectedBoundingBox=function(){var g=a._asyncToGenerator(function*(A,q,y,x,D){D=this.getBoundingBoxObjectSpace(D);var C=z;const B=w.isPoint(D)?1:C.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,r);for(var v=0;v<B;v++){const E=C[v];l[0]=D[E[0]];l[1]=D[E[1]];l[2]=D[E[2]];p.transformMat4(l,l,r);k[3*v]=l[0];k[3*v+1]=l[1];k[3*v+2]=l[2]}if(!A(k,0,B))return null;w.empty(D);A=null;this.calculateRelativeScreenBounds&&
(A=this.calculateRelativeScreenBounds());for(C=0;C<3*B;C+=3){for(v=0;3>v;v++)D[v]=Math.min(D[v],k[C+v]),D[v+3]=Math.max(D[v+3],k[C+v]);A&&y.push({location:k.slice(C,C+3),screenSpaceBoundingRect:A})}if(q&&(w.center(D,m),"absolute-height"!==this.elevationContext.mode)){let E;y=n.demResolutionForBoundingBox(D,q);try{E=yield q.service.queryElevation(m[0],m[1],x,y,"ground")}catch(F){}u.isSome(E)&&w.offset(D,0,0,-this.alignedSampledElevation+E)}return D});return function(A,q,y,x,D){return g.apply(this,
arguments)}}();d.addObjectState=function(g,A){0===g&&(g=new b.Object3DStateID(g),this.addHighlightId(g),A.addExternal(q=>{this.removeHighlightId(q)},g))};d.removeObjectState=function(g){this.highlights&&this.highlights.forEach(A=>g.remove(A))};d.addHighlightId=function(g){this.highlights=this.highlights||new Set;this.highlights.add(g);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};d.removeHighlightId=function(g){this.highlights&&(this.highlights.delete(g),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};a._createClass(c,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return c}();const k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=t.create(),m=t.create(),z=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],r=f.create();return h})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,
u){function f(t){const w=[];t.stageResources.geometries.forEach((e,n)=>{w.push({material:t.stageResources.materials[n],geometry:e,textures:t.stageResources.textures})});return{components:w,minScreenSpaceRadius:t.lodThreshold,pivotOffset:t.pivotOffset}}function p(t,w=.05){t=u.computeFaceCount(t);return Math.sqrt(t/(w*Math.PI))}a.estimateMinScreenSpaceRadius=p;a.fillEstimatedMinScreenSpaceRadius=function(t){t.levels.forEach(w=>{w.minScreenSpaceRadius||(w.minScreenSpaceRadius=p(w))})};a.makeLodLevelResources=
f;a.makeLodResources=function(t){return{levels:t.map(w=>f(w))}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v){function E(){E=u._asyncToGenerator(function*(I,G){var K=F(f.adjustStaticAGOUrl(I));if("wosr"===K.fileType)return I=yield G.cache?G.cache.loadWOSR(K.url,G):A.load(K.url,G),K=A.processLoadResult(I,G),{lods:[K],referenceBoundingBox:K.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:I.remove};I=yield G.cache?G.cache.loadGLTF(K.url,G,G.usePBR):d.load(new c.DefaultLoadingContext(G.streamDataRequester),K.url,G,G.usePBR);var H=p.get(I.model.meta,
"ESRI_proxyEllipsoid");if(I.meta.isEsriSymbolResource&&p.isSome(H)&&-1!==I.meta.uri.indexOf("/RealisticTrees/"))a:for(var J=0;J<I.model.lods.length;++J){var M=I.model.lods[J];I.customMeta.esriTreeRendering=!0;for(var O of M.parts){M=O.attributes.normal;if(p.isNone(M))break a;const S=O.attributes.position,V=S.count,Y=h.create(),W=h.create(),ba=h.create(),ca=r.createBuffer(l.BufferViewVec4u8,V),da=r.createBuffer(l.BufferViewVec3f,V),ha=e.invert(n.create(),O.transform);for(let fa=0;fa<V;fa++){S.getVec(fa,
W);M.getVec(fa,Y);b.transformMat4(W,W,O.transform);b.subtract(ba,W,H.center);b.divide(ba,ba,H.radius);const R=ba[2];var Q=b.length(ba);Q=Math.min(.45+.55*Q*Q,1);b.divide(ba,ba,H.radius);b.transformMat4(ba,ba,ha);b.normalize(ba,ba);J+1!==I.model.lods.length&&1<I.model.lods.length&&(-1<R?b.lerp(ba,ba,Y,.2):b.lerp(ba,ba,Y,Math.min(-4*R-3.8,1)));da.setVec(fa,ba);ca.set(fa,0,255*Q);ca.set(fa,1,255*Q);ca.set(fa,2,255*Q);ca.set(fa,3,255)}O.attributes.normal=da;O.attributes.color=ca}}O=I.meta.isEsriSymbolResource?
{usePBR:G.usePBR,isSchematic:!1,treeRendering:I.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:G.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]};G={...G.materialParamsMixin,treeRendering:I.customMeta.esriTreeRendering};if(null!=K.specifiedLodIndex)return H=L(I,O,G,K.specifiedLodIndex),J=H[0].boundingBox,0!==K.specifiedLodIndex&&(J=L(I,O,G,0)[0].boundingBox),{lods:H,referenceBoundingBox:J,isEsriSymbolResource:I.meta.isEsriSymbolResource,isWosr:!1,remove:I.remove};K=L(I,O,G);return{lods:K,referenceBoundingBox:K[0].boundingBox,
isEsriSymbolResource:I.meta.isEsriSymbolResource,isWosr:!1,remove:I.remove}});return E.apply(this,arguments)}function F(I){const G=I.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return G?{fileType:"gltf",url:G[1],specifiedLodIndex:null!=G[4]?Number(G[4]):null}:I.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:I,specifiedLodIndex:null}:{fileType:"unknown",url:I,specifiedLodIndex:null}}function L(I,G,K,H){const J=I.model,M=w.create(),O=[],Q=new Map,S=new Map;J.lods.forEach((V,Y)=>{if(void 0===H||
Y===H){var W={name:V.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:p.isSome(V.lodThreshold)?V.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:k.empty()};O.push(W);V.parts.forEach(ba=>{var ca=ba.material+(ba.attributes.normal?"_normal":"")+(ba.attributes.color?"_color":"")+(ba.attributes.texCoord0?"_texCoord0":"")+(ba.attributes.tangent?"_tangent":"");const da=J.materials.get(ba.material),ha=p.isSome(ba.attributes.texCoord0);var fa=p.isSome(ba.attributes.normal);
if(!Q.has(ca)){if(ha){if(p.isSome(da.textureColor)&&!S.has(da.textureColor)){var R=J.textures.get(da.textureColor);S.set(da.textureColor,new y.Texture(R.data,{...R.parameters,preMultiplyAlpha:!0}))}p.isSome(da.textureNormal)&&!S.has(da.textureNormal)&&(R=J.textures.get(da.textureNormal),S.set(da.textureNormal,new y.Texture(R.data,{...R.parameters,preMultiplyAlpha:!0})));p.isSome(da.textureOcclusion)&&!S.has(da.textureOcclusion)&&(R=J.textures.get(da.textureOcclusion),S.set(da.textureOcclusion,new y.Texture(R.data,
{...R.parameters,preMultiplyAlpha:!0})));p.isSome(da.textureEmissive)&&!S.has(da.textureEmissive)&&(R=J.textures.get(da.textureEmissive),S.set(da.textureEmissive,new y.Texture(R.data,{...R.parameters,preMultiplyAlpha:!0})));p.isSome(da.textureMetallicRoughness)&&!S.has(da.textureMetallicRoughness)&&(R=J.textures.get(da.textureMetallicRoughness),S.set(da.textureMetallicRoughness,new y.Texture(R.data,{...R.parameters,preMultiplyAlpha:!0})))}R=da.color[0]**(1/D.COLOR_GAMMA);var U=da.color[1]**(1/D.COLOR_GAMMA),
Z=da.color[2]**(1/D.COLOR_GAMMA),T=da.emissiveFactor[0]**(1/D.COLOR_GAMMA),P=da.emissiveFactor[1]**(1/D.COLOR_GAMMA);const X=da.emissiveFactor[2]**(1/D.COLOR_GAMMA);Q.set(ca,new x.DefaultMaterial({...G,transparent:"BLEND"===da.alphaMode,textureAlphaMode:N(da.alphaMode),textureAlphaCutoff:da.alphaCutoff,diffuse:[R,U,Z],ambient:[R,U,Z],opacity:da.opacity,doubleSided:da.doubleSided,doubleSidedType:"winding-order",cullFace:da.doubleSided?0:2,vertexColors:!!ba.attributes.color,vertexTangents:!!ba.attributes.tangent,
normals:fa?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:p.isSome(da.textureColor)&&ha?S.get(da.textureColor).id:void 0,colorMixMode:da.colorMixMode,normalTextureId:p.isSome(da.textureNormal)&&ha?S.get(da.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:p.isSome(da.textureOcclusion)&&ha?S.get(da.textureOcclusion).id:void 0,emissiveTextureId:p.isSome(da.textureEmissive)&&ha?S.get(da.textureEmissive).id:void 0,metallicRoughnessTextureId:p.isSome(da.textureMetallicRoughness)&&
ha?S.get(da.textureMetallicRoughness).id:void 0,emissiveFactor:[T,P,X],mrrFactors:[da.metallicFactor,da.roughnessFactor,G.mrrFactors[2]],isSchematic:!1,...K}))}a:{fa=ba.indices||ba.attributes.position.count;switch(ba.primitiveType){case 4:fa=g.trianglesToTriangles(fa);break a;case 5:fa=g.triangleStripToTriangles(fa);break a;case 6:fa=g.triangleFanToTriangles(fa);break a}fa=void 0}R=fa;fa=ba.attributes.position.count;U=r.createBuffer(l.BufferViewVec3f,fa);m.transformMat4(U,ba.attributes.position,ba.transform);
U=[["position",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]];Z=[["position",R]];p.isSome(ba.attributes.normal)&&(T=r.createBuffer(l.BufferViewVec3f,fa),t.normalFromMat4(M,ba.transform),m.transformMat3(T,ba.attributes.normal,M),U.push(["normal",{data:T.typedBuffer,size:T.elementCount,exclusive:!0}]),Z.push(["normal",R]));p.isSome(ba.attributes.tangent)&&(T=r.createBuffer(l.BufferViewVec4f,fa),t.normalFromMat4(M,ba.transform),z.transformMat3(T,ba.attributes.tangent,M),U.push(["tangent",{data:T.typedBuffer,
size:T.elementCount,exclusive:!0}]),Z.push(["tangent",R]));p.isSome(ba.attributes.texCoord0)&&(T=r.createBuffer(l.BufferViewVec2f,fa),C.normalizeIntegerBuffer(T,ba.attributes.texCoord0),U.push(["uv0",{data:T.typedBuffer,size:T.elementCount,exclusive:!0}]),Z.push(["uv0",R]));p.isSome(ba.attributes.color)&&(T=r.createBuffer(l.BufferViewVec4u8,fa),4===ba.attributes.color.elementCount?ba.attributes.color instanceof l.BufferViewVec4f?z.scale(T,ba.attributes.color,255):ba.attributes.color instanceof l.BufferViewVec4u8?
B.copy(T,ba.attributes.color):ba.attributes.color instanceof l.BufferViewVec4u16&&z.scale(T,ba.attributes.color,1/256):(B.fill(T,255,255,255,255),P=new l.BufferViewVec3u8(T.buffer,0,4),ba.attributes.color instanceof l.BufferViewVec3f?m.scale(P,ba.attributes.color,255):ba.attributes.color instanceof l.BufferViewVec3u8?v.copy(P,ba.attributes.color):ba.attributes.color instanceof l.BufferViewVec3u16&&m.scale(P,ba.attributes.color,1/256)),U.push(["color",{data:T.typedBuffer,size:T.elementCount,exclusive:!0}]),
Z.push(["color",R]));ba=new q.Geometry(U,Z);W.stageResources.geometries.push(ba);W.stageResources.materials.push(Q.get(ca));ha&&(p.isSome(da.textureColor)&&W.stageResources.textures.push(S.get(da.textureColor)),p.isSome(da.textureNormal)&&W.stageResources.textures.push(S.get(da.textureNormal)),p.isSome(da.textureOcclusion)&&W.stageResources.textures.push(S.get(da.textureOcclusion)),p.isSome(da.textureEmissive)&&W.stageResources.textures.push(S.get(da.textureEmissive)),p.isSome(da.textureMetallicRoughness)&&
W.stageResources.textures.push(S.get(da.textureMetallicRoughness)));W.numberOfVertices+=fa;ca=ba.boundingInfo;p.isSome(ca)&&(k.expandWithVec3(W.boundingBox,ca.getBBMin()),k.expandWithVec3(W.boundingBox,ca.getBBMax()))})}});return O}function N(I){switch(I){case "BLEND":return 0;case "MASK":return 2;case "OPAQUE":return 1;default:return 0}}a.fetch=function(I,G){return E.apply(this,arguments)};a.gltfToEngineResources=L;a.parseUrl=F;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports",
"../geometry/support/buffer/math/common"],function(a,u){function f(n,b,h){if(n.count!==b.count)u.logger.error("source and destination buffers need to have the same number of elements");else{var k=n.count,l=h[0],m=h[1],z=h[2],r=h[3],c=h[4],d=h[5],g=h[6],A=h[7],q=h[8],y=h[9],x=h[10],D=h[11],C=h[12],B=h[13],v=h[14];h=h[15];var E=n.typedBuffer;n=n.typedBufferStride;var F=b.typedBuffer;b=b.typedBufferStride;for(let N=0;N<k;N++){const I=N*n;var L=N*b;const G=F[L],K=F[L+1],H=F[L+2];L=F[L+3];E[I]=l*G+c*K+
q*H+C*L;E[I+1]=m*G+d*K+y*H+B*L;E[I+2]=z*G+g*K+x*H+v*L;E[I+3]=r*G+A*K+D*H+h*L}}}function p(n,b,h){if(n.count!==b.count)u.logger.error("source and destination buffers need to have the same number of elements");else{var k=n.count,l=h[0],m=h[1],z=h[2],r=h[3],c=h[4],d=h[5],g=h[6],A=h[7];h=h[8];var q=n.typedBuffer;n=n.typedBufferStride;var y=b.typedBuffer;b=b.typedBufferStride;for(let D=0;D<k;D++){const C=D*n;var x=D*b;const B=y[x],v=y[x+1],E=y[x+2];x=y[x+3];q[C]=l*B+r*v+g*E;q[C+1]=m*B+c*v+A*E;q[C+2]=z*
B+d*v+h*E;q[C+3]=x}}}function t(n,b,h){const k=Math.min(n.count,b.count),l=n.typedBuffer;n=n.typedBufferStride;const m=b.typedBuffer;b=b.typedBufferStride;for(let z=0;z<k;z++){const r=z*n,c=z*b;l[r]=h*m[c];l[r+1]=h*m[c+1];l[r+2]=h*m[c+2];l[r+3]=h*m[c+3]}}function w(n,b,h){const k=Math.min(n.count,b.count),l=n.typedBuffer;n=n.typedBufferStride;const m=b.typedBuffer;b=b.typedBufferStride;for(let z=0;z<k;z++){const r=z*n,c=z*b;l[r]=m[c]>>h;l[r+1]=m[c+1]>>h;l[r+2]=m[c+2]>>h;l[r+3]=m[c+3]>>h}}var e=Object.freeze({__proto__:null,
transformMat4:f,transformMat3:p,scale:t,shiftRight:w});a.scale=t;a.shiftRight=w;a.transformMat3=p;a.transformMat4=f;a.vec4=e})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),function(a,u,f,p,t,w,e,n){a.mat3=f.mat3;a.mat4=p.mat4;a.scalar=t.scalar;a.vec2=w.vec2;a.vec3=e.vec3;a.vec4=n.vec4;a.createBuffer=function(b,h){return new b(new ArrayBuffer(h*
b.ElementCount*u.elementTypeSize(b.ElementType)))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function u(p,t,w){const e=p.typedBuffer;p=p.typedBufferStride;const n=t.typedBuffer,b=t.typedBufferStride;t=w?w.count:t.count;let h=(w&&w.dstIndex?w.dstIndex:0)*p;w=(w&&w.srcIndex?w.srcIndex:0)*b;for(let k=0;k<t;++k){for(let l=0;9>l;++l)e[h+l]=n[w+l];h+=p;w+=b}}var f=Object.freeze({__proto__:null,copy:u});a.copy=u;a.mat3=f})},"esri/chunks/mat42":function(){define(["exports"],
function(a){function u(p,t,w){const e=p.typedBuffer;p=p.typedBufferStride;const n=t.typedBuffer,b=t.typedBufferStride;t=w?w.count:t.count;let h=(w&&w.dstIndex?w.dstIndex:0)*p;w=(w&&w.srcIndex?w.srcIndex:0)*b;for(let k=0;k<t;++k){for(let l=0;16>l;++l)e[h+l]=n[w+l];h+=p;w+=b}}var f=Object.freeze({__proto__:null,copy:u});a.copy=u;a.mat4=f})},"esri/chunks/scalar":function(){define(["exports"],function(a){function u(t,w,e){const n=t.typedBuffer;t=t.typedBufferStride;const b=w.typedBuffer,h=w.typedBufferStride;
w=e?e.count:w.count;let k=(e&&e.dstIndex?e.dstIndex:0)*t;e=(e&&e.srcIndex?e.srcIndex:0)*h;for(let l=0;l<w;++l)n[k]=b[e],k+=t,e+=h}function f(t,w){const e=t.count;w||(w=new t.TypedArrayConstructor(e));for(let n=0;n<e;n++)w[n]=t.get(n);return w}var p=Object.freeze({__proto__:null,copy:u,makeDense:f});a.copy=u;a.makeDense=f;a.scalar=p})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,u){function f(e,n,b){const h=e.typedBuffer;e=e.typedBufferStride;const k=
n.typedBuffer,l=n.typedBufferStride;n=b?b.count:n.count;let m=(b&&b.dstIndex?b.dstIndex:0)*e;b=(b&&b.srcIndex?b.srcIndex:0)*l;for(let z=0;z<n;++z)h[m]=k[b],h[m+1]=k[b+1],m+=e,b+=l}function p(e,n,b){const h=e.typedBuffer,k=e.typedBufferStride,l=n.typedBuffer,m=n.typedBufferStride,z=b?b.count:n.count;let r=(b&&b.dstIndex?b.dstIndex:0)*k,c=(b&&b.srcIndex?b.srcIndex:0)*m;if(u.isInteger(n.elementType))if(b=u.maximumValue(n.elementType),u.isSigned(n.elementType))for(n=0;n<z;++n)h[r]=Math.max(l[c]/b,-1),
h[r+1]=Math.max(l[c+1]/b,-1),r+=k,c+=m;else for(n=0;n<z;++n)h[r]=l[c]/b,h[r+1]=l[c+1]/b,r+=k,c+=m;else f(e,n,b);return e}function t(e,n,b,h){var k,l;const m=e.typedBuffer,z=e.typedBufferStride;e=null!=(k=null==h?void 0:h.count)?k:e.count;h=(null!=(l=null==h?void 0:h.dstIndex)?l:0)*z;for(l=0;l<e;++l)m[h]=n,m[h+1]=b,h+=z}var w=Object.freeze({__proto__:null,copy:f,normalizeIntegerBuffer:p,fill:t});a.copy=f;a.fill=t;a.normalizeIntegerBuffer=p;a.vec2=w})},"esri/chunks/vec33":function(){define(["exports"],
function(a){function u(t,w,e){const n=t.typedBuffer;t=t.typedBufferStride;const b=w.typedBuffer,h=w.typedBufferStride;w=e?e.count:w.count;let k=(e&&e.dstIndex?e.dstIndex:0)*t;e=(e&&e.srcIndex?e.srcIndex:0)*h;for(let l=0;l<w;++l)n[k]=b[e],n[k+1]=b[e+1],n[k+2]=b[e+2],k+=t,e+=h}function f(t,w,e,n,b){var h,k;const l=t.typedBuffer,m=t.typedBufferStride;t=null!=(h=null==b?void 0:b.count)?h:t.count;b=(null!=(k=null==b?void 0:b.dstIndex)?k:0)*m;for(k=0;k<t;++k)l[b]=w,l[b+1]=e,l[b+2]=n,b+=m}var p=Object.freeze({__proto__:null,
copy:u,fill:f});a.copy=u;a.fill=f;a.vec3=p})},"esri/chunks/vec43":function(){define(["exports"],function(a){function u(t,w,e){const n=t.typedBuffer;t=t.typedBufferStride;const b=w.typedBuffer,h=w.typedBufferStride;w=e?e.count:w.count;let k=(e&&e.dstIndex?e.dstIndex:0)*t;e=(e&&e.srcIndex?e.srcIndex:0)*h;for(let l=0;l<w;++l)n[k]=b[e],n[k+1]=b[e+1],n[k+2]=b[e+2],n[k+3]=b[e+3],k+=t,e+=h}function f(t,w,e,n,b,h){var k,l;const m=t.typedBuffer,z=t.typedBufferStride;t=null!=(k=null==h?void 0:h.count)?k:t.count;
h=(null!=(l=null==h?void 0:h.dstIndex)?l:0)*z;for(l=0;l<t;++l)m[h]=w,m[h+1]=e,m[h+2]=n,m[h+3]=b,h+=z}var p=Object.freeze({__proto__:null,copy:u,fill:f});a.copy=u;a.fill=f;a.vec4=p})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,u,f,p,t,w,e,n){let b=function(){function k(m){this.streamDataRequester=
m}var l=k.prototype;l.loadJSON=function(){var m=u._asyncToGenerator(function*(z,r){return this.load("json",z,r)});return function(z,r){return m.apply(this,arguments)}}();l.loadBinary=function(){var m=u._asyncToGenerator(function*(z,r){return n.isDataProtocol(z)?(e.throwIfAborted(r),n.dataToArrayBuffer(z)):this.load("binary",z,r)});return function(z,r){return m.apply(this,arguments)}}();l.loadImage=function(){var m=u._asyncToGenerator(function*(z,r){return this.load("image",z,r)});return function(z,
r){return m.apply(this,arguments)}}();l.load=function(){var m=u._asyncToGenerator(function*(z,r,c){if(w.isNone(this.streamDataRequester))return(yield f(r,{responseType:h[z]})).data;z=yield p.result(this.streamDataRequester.request(r,z,c));if(!0===z.ok)return z.value;e.throwIfAbortError(z.error);throw new t("",`Request for resource failed: ${z.error}`);});return function(z,r,c){return m.apply(this,arguments)}}();return k}();const h={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(a,u,f,p,t,w,e){function n(){n=u._asyncToGenerator(function*(d,g,A={},q=!0){const y=yield e.Resource.load(d,z,g,A),x=`gltf_${m++}`,D={lods:[],materials:new Map,textures:new Map,meta:b(y)};d=!(!y.json.asset.extras||"symbolResource"!==
y.json.asset.extras.ESRI_type);yield h(y,function(){var C=u._asyncToGenerator(function*(B,v,E,F){var L=void 0!==B.mode?B.mode:4;const N=4===L||5===L||6===L?L:null;f.isNone(N)?z.warnUnsupported("Unsupported primitive mode ("+c[L]+"). Skipping primitive."):y.hasPositions(B)?(L=yield y.getMaterial(B,A,q),v={transform:p.clone(v),attributes:{position:yield y.getPositionData(B,A),normal:null,texCoord0:null,color:null,tangent:null},indices:yield y.getIndexData(B,A),primitiveType:N,material:l(D,L,x)},y.hasNormals(B)&&
(v.attributes.normal=yield y.getNormalData(B,A)),y.hasTangents(B)&&(v.attributes.tangent=yield y.getTangentData(B,A)),y.hasTextureCoordinates(B)&&(v.attributes.texCoord0=yield y.getTextureCoordinates(B,A)),y.hasVertexColors(B)&&(v.attributes.color=yield y.getVertexColors(B,A)),B=null,f.isSome(D.meta)&&f.isSome(D.meta.ESRI_lod)&&"screenSpaceRadius"===D.meta.ESRI_lod.metric&&(B=D.meta.ESRI_lod.thresholds[E]),D.lods[E]=D.lods[E]||{parts:[],name:F,lodThreshold:B},D.lods[E].parts.push(v)):z.warn("Skipping primitive without POSITION vertex attribute.")});
return function(B,v,E,F){return C.apply(this,arguments)}}());return{model:D,meta:{isEsriSymbolResource:d,uri:y.uri},customMeta:{}}});return n.apply(this,arguments)}function b(d){let g=null;d.json.nodes.forEach(A=>{A=A.extras;f.isSome(A)&&(A.ESRI_proxyEllipsoid||A.ESRI_lod)&&(g=A)});return g}function h(d,g){return k.apply(this,arguments)}function k(){k=u._asyncToGenerator(function*(d,g){function A(C,B){return q.apply(this,arguments)}function q(){q=u._asyncToGenerator(function*(C,B){const v=y.nodes[C];
C=d.getNodeTransform(C);z.warnUnsupportedIf(null!=v.weights,"Morph targets are not supported.");if(null!=v.mesh){const E=y.meshes[v.mesh];for(const F of E.primitives)yield g(F,C,B,E.name)}for(const E of v.children||[])yield A(E,B)});return q.apply(this,arguments)}const y=d.json;var x=y.scenes[y.scene||0].nodes;const D=1<x.length;for(const C of x){x=y.nodes[C];const B=[A(C,0)];x.extensions&&x.extensions.MSFT_lod&&Array.isArray(x.extensions.MSFT_lod.ids)&&!D&&B.push(...x.extensions.MSFT_lod.ids.map((v,
E)=>A(v,E+1)));yield Promise.all(B)}});return k.apply(this,arguments)}function l(d,g,A){const q=x=>{const D=`${A}_tex_${x&&x.id}${x&&x.name?"_"+x.name:""}`;if(x&&!d.textures.has(D)){const C=w.makeTextureSource(x.data,{wrap:{s:x.wrapS,t:x.wrapT},mipmap:r.some(B=>B===x.minFilter),noUnpackFlip:!0});d.textures.set(D,C)}return D},y=`${A}_mat_${g.id}_${g.name}`;d.materials.has(y)||(g=w.makeMaterialParameters({color:[g.color[0],g.color[1],g.color[2]],opacity:g.color[3],alphaMode:g.alphaMode,alphaCutoff:g.alphaCutoff,
doubleSided:g.doubleSided,colorMixMode:g.ESRI_externalColorMixMode,textureColor:g.colorTexture?q(g.colorTexture):void 0,textureNormal:g.normalTexture?q(g.normalTexture):void 0,textureOcclusion:g.occlusionTexture?q(g.occlusionTexture):void 0,textureEmissive:g.emissiveTexture?q(g.emissiveTexture):void 0,textureMetallicRoughness:g.metallicRoughnessTexture?q(g.metallicRoughnessTexture):void 0,emissiveFactor:[g.emissiveFactor[0],g.emissiveFactor[1],g.emissiveFactor[2]],metallicFactor:g.metallicFactor,
roughnessFactor:g.roughnessFactor}),d.materials.set(y,g));return y}let m=0;const z=new t.DefaultErrorContext,r=[9987,9985],c="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(d,g){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,u,f){const p=f.getLogger("esri.views.3d.glTF");f=function(){function t(){}
var w=t.prototype;w.error=function(e){throw new u("gltf-loader-error",e);};w.errorUnsupported=function(e){throw new u("gltf-loader-unsupported-feature",e);};w.errorUnsupportedIf=function(e,n){e&&this.errorUnsupported(n)};w.assert=function(e,n){e||this.error(n)};w.warn=function(e){p.warn(e)};w.warnUnsupported=function(e){this.warn("[Unsupported Feature] "+e)};w.warnUnsupportedIf=function(e,n){e&&this.warnUnsupported(n)};return t}();a.DefaultErrorContext=f;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/glTF/LoaderResult":function(){define(["exports"],function(a){a.makeMaterialParameters=function(u={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...u}};a.makeTextureSource=function(u,f={}){return{data:u,
parameters:{wrap:{s:10497,t:10497,...f.wrap},noUnpackFlip:!0,mipmap:!1,...f}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./fillDefaults ./pathUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(E){switch(E.componentType){case 5120:return new h.BufferViewVec2i8(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case 5121:return new h.BufferViewVec2u8(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case 5122:return new h.BufferViewVec2i16(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case 5123:return new h.BufferViewVec2u16(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*
E.entryCount);case 5125:return new h.BufferViewVec2u32(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case 5126:return new h.BufferViewVec2f(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);default:f.neverReached(E.componentType)}}function c(E){return d.apply(this,arguments)}function d(){d=u._asyncToGenerator(function*(E){return new Promise((F,L)=>{const N=new Blob([E]),I=new FileReader;I.onload=()=>{F(JSON.parse(I.result))};I.onerror=G=>{L(G)};I.readAsText(N)})});
return d.apply(this,arguments)}function g(E,F){return A.apply(this,arguments)}function A(){A=u._asyncToGenerator(function*(E,F){return new Promise((L,N)=>{const I=new Blob([E],{type:F}),G=URL.createObjectURL(I),K=new Image;K.addEventListener("load",()=>{URL.revokeObjectURL(G);"decode"in K?K.decode().then(()=>L(K),()=>L(K)):L(K)});K.addEventListener("error",H=>{URL.revokeObjectURL(G);N(H)});K.src=G})});return A.apply(this,arguments)}let q=function(){function E(L,N,I,G,K){this.context=L;this.errorContext=
N;this.uri=I;this.json=G;this.glbBuffer=K;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=z.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();N.errorUnsupportedIf(null==G.scenes,"Scenes must be defined.");N.errorUnsupportedIf(null==G.meshes,"Meshes must be defined");N.errorUnsupportedIf(null==G.nodes,"Nodes must be defined.");this.computeNodeParents()}
E.load=function(){var L=u._asyncToGenerator(function*(N,I,G,K){if(p.isDataProtocol(G)){var H=p.dataComponents(G);if("model/gltf-binary"!==H.mediaType)try{const J=JSON.parse(H.isBase64?atob(H.data):H.data);return new E(N,I,G,J)}catch{}H=p.dataToArrayBuffer(G);if(E.isGLBData(H))return this.fromGLBData(N,I,G,H)}if(G.endsWith(".gltf"))return K=yield N.loadJSON(G,K),new E(N,I,G,K);H=yield N.loadBinary(G,K);if(E.isGLBData(H))return this.fromGLBData(N,I,G,H);K=yield N.loadJSON(G,K);return new E(N,I,G,K)});
return function(N,I,G,K){return L.apply(this,arguments)}}();E.isGLBData=function(L){L=new l.BinaryStreamReader(L);return 4<=L.remainingBytes()&&1179937895===L.readUint32()};E.fromGLBData=function(){var L=u._asyncToGenerator(function*(N,I,G,K){K=yield E.parseGLBData(I,K);return new E(N,I,G,K.json,K.binaryData)});return function(N,I,G,K){return L.apply(this,arguments)}}();E.parseGLBData=function(){var L=u._asyncToGenerator(function*(N,I){const G=new l.BinaryStreamReader(I);N.assert(12<=G.remainingBytes(),
"GLB binary data is insufficiently large.");var K=G.readUint32(),H=G.readUint32();const J=G.readUint32();N.assert(1179937895===K,"Magic first 4 bytes do not fit to expected GLB value.");N.assert(I.byteLength>=J,"GLB binary data is smaller than header specifies.");N.errorUnsupportedIf(2!==H,"An unsupported GLB container version was detected. Only version 2 is supported.");I=0;let M,O;for(;8<=G.remainingBytes();)K=G.readUint32(),H=G.readUint32(),0===I?(N.assert(1313821514===H,"First GLB chunk must be JSON."),
N.assert(0<=K,"No JSON data found."),M=yield c(G.readUint8Array(K))):1===I?(N.errorUnsupportedIf(5130562!==H,"Second GLB chunk expected to be BIN."),O=G.readUint8Array(K)):N.warnUnsupported("More than 2 GLB chunks detected. Skipping."),I+=1;M||N.error("No GLB JSON chunk detected.");return{json:M,binaryData:O}});return function(N,I){return L.apply(this,arguments)}}();var F=E.prototype;F.getBuffer=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.json.buffers[N],K=this.errorContext;if(null==
G.uri)return K.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;let H=this.bufferCache.get(N);H||(I=yield this.context.loadBinary(this.resolveUri(G.uri),I),H=new Uint8Array(I),this.bufferCache.set(N,H),K.assert(H.byteLength===G.byteLength,"Buffer byte lengths should match."));return H});return function(N,I){return L.apply(this,arguments)}}();F.getAccessor=function(){var L=u._asyncToGenerator(function*(N,I){N=this.json.accessors[N];var G=this.errorContext;G.errorUnsupportedIf(null==
N.bufferView,"Some accessor does not specify a bufferView.");G.errorUnsupportedIf(N.type in["MAT2","MAT3","MAT4"],`AttributeType ${N.type} is not supported`);G=this.json.bufferViews[N.bufferView];I=yield this.getBuffer(G.buffer,I);const K=C[N.type],H=B[N.componentType],J=K*H,M=G.byteStride||J;return{raw:I.buffer,byteStride:M,byteOffset:I.byteOffset+(G.byteOffset||0)+(N.byteOffset||0),entryCount:N.count,isDenselyPacked:M===J,componentCount:K,componentByteSize:H,componentType:N.componentType,min:N.min,
max:N.max,normalized:!!N.normalized}});return function(N,I){return L.apply(this,arguments)}}();F.getIndexData=function(){var L=u._asyncToGenerator(function*(N,I){if(null==N.indices)return null;N=yield this.getAccessor(N.indices,I);if(N.isDenselyPacked)switch(N.componentType){case 5121:return new Uint8Array(N.raw,N.byteOffset,N.entryCount);case 5123:return new Uint16Array(N.raw,N.byteOffset,N.entryCount);case 5125:return new Uint32Array(N.raw,N.byteOffset,N.entryCount)}else switch(N.componentType){case 5121:return k.makeDense(this.wrapAccessor(h.BufferViewUint8,
N));case 5123:return k.makeDense(this.wrapAccessor(h.BufferViewUint16,N));case 5125:return k.makeDense(this.wrapAccessor(h.BufferViewUint32,N))}});return function(N,I){return L.apply(this,arguments)}}();F.getPositionData=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.errorContext;G.errorUnsupportedIf(null==N.attributes.POSITION,"No POSITION vertex data found.");N=yield this.getAccessor(N.attributes.POSITION,I);G.errorUnsupportedIf(5126!==N.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+
v[N.componentType]);G.errorUnsupportedIf(3!==N.componentCount,"POSITION vertex attribute must have 3 components, but found "+N.componentCount.toFixed());return this.wrapAccessor(h.BufferViewVec3f,N)});return function(N,I){return L.apply(this,arguments)}}();F.getNormalData=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.errorContext;G.assert(null!=N.attributes.NORMAL,"No NORMAL vertex data found.");N=yield this.getAccessor(N.attributes.NORMAL,I);G.errorUnsupportedIf(5126!==N.componentType,
"Expected type FLOAT for NORMAL vertex attribute, but found "+v[N.componentType]);G.errorUnsupportedIf(3!==N.componentCount,"NORMAL vertex attribute must have 3 components, but found "+N.componentCount.toFixed());return this.wrapAccessor(h.BufferViewVec3f,N)});return function(N,I){return L.apply(this,arguments)}}();F.getTangentData=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.errorContext;G.assert(null!=N.attributes.TANGENT,"No TANGENT vertex data found.");N=yield this.getAccessor(N.attributes.TANGENT,
I);G.errorUnsupportedIf(5126!==N.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+v[N.componentType]);G.errorUnsupportedIf(4!==N.componentCount,"TANGENT vertex attribute must have 4 components, but found "+N.componentCount.toFixed());return new h.BufferViewVec4f(N.raw,N.byteOffset,N.byteStride,N.byteOffset+N.byteStride*N.entryCount)});return function(N,I){return L.apply(this,arguments)}}();F.getTextureCoordinates=function(){var L=u._asyncToGenerator(function*(N,I){const G=
this.errorContext;G.assert(null!=N.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");N=yield this.getAccessor(N.attributes.TEXCOORD_0,I);G.errorUnsupportedIf(2!==N.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+N.componentCount.toFixed());if(5126===N.componentType)return this.wrapAccessor(h.BufferViewVec2f,N);G.errorUnsupportedIf(!N.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return r(N)});return function(N,
I){return L.apply(this,arguments)}}();F.getVertexColors=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.errorContext;G.assert(null!=N.attributes.COLOR_0,"No COLOR_0 vertex data found.");N=yield this.getAccessor(N.attributes.COLOR_0,I);G.errorUnsupportedIf(4!==N.componentCount&&3!==N.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+N.componentCount.toFixed());if(4===N.componentCount){if(5126===N.componentType)return this.wrapAccessor(h.BufferViewVec4f,N);
if(5121===N.componentType)return this.wrapAccessor(h.BufferViewVec4u8,N);if(5123===N.componentType)return this.wrapAccessor(h.BufferViewVec4u16,N)}else if(3===N.componentCount){if(5126===N.componentType)return this.wrapAccessor(h.BufferViewVec3f,N);if(5121===N.componentType)return this.wrapAccessor(h.BufferViewVec3u8,N);if(5123===N.componentType)return this.wrapAccessor(h.BufferViewVec3u16,N)}G.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+v[N.componentType])});return function(N,
I){return L.apply(this,arguments)}}();F.hasPositions=function(L){return void 0!==L.attributes.POSITION};F.hasNormals=function(L){return void 0!==L.attributes.NORMAL};F.hasVertexColors=function(L){return void 0!==L.attributes.COLOR_0};F.hasTextureCoordinates=function(L){return void 0!==L.attributes.TEXCOORD_0};F.hasTangents=function(L){return void 0!==L.attributes.TANGENT};F.getMaterial=function(){var L=u._asyncToGenerator(function*(N,I,G){const K=this.errorContext;var H=this.materialCache.get(N.material);
if(!H){H=null!=N.material?m.material(this.json.materials[N.material]):m.material();const J=H.pbrMetallicRoughness,M=this.hasVertexColors(N);let O;J.baseColorTexture&&(K.errorUnsupportedIf(0!==(J.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),O=yield this.getTexture(J.baseColorTexture.index,I));let Q;H.normalTexture&&(0!==(H.normalTexture.texCoord||0)?K.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."):Q=yield this.getTexture(H.normalTexture.index,
I));let S;H.occlusionTexture&&G&&(0!==(H.occlusionTexture.texCoord||0)?K.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."):S=yield this.getTexture(H.occlusionTexture.index,I));let V;H.emissiveTexture&&G&&(0!==(H.emissiveTexture.texCoord||0)?K.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."):V=yield this.getTexture(H.emissiveTexture.index,I));let Y;J.metallicRoughnessTexture&&G&&(0!==(J.metallicRoughnessTexture.texCoord||0)?K.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."):
Y=yield this.getTexture(J.metallicRoughnessTexture.index,I));H={alphaMode:H.alphaMode,alphaCutoff:H.alphaCutoff,color:J.baseColorFactor,doubleSided:!!H.doubleSided,colorTexture:O,normalTexture:Q,name:H.name,id:null!=N.material?N.material:-1,occlusionTexture:S,emissiveTexture:V,emissiveFactor:H.emissiveFactor,metallicFactor:J.metallicFactor,roughnessFactor:J.roughnessFactor,metallicRoughnessTexture:Y,vertexColors:M,ESRI_externalColorMixMode:H.extras.ESRI_externalColorMixMode}}return H});return function(N,
I,G){return L.apply(this,arguments)}}();F.getTexture=function(){var L=u._asyncToGenerator(function*(N,I){const G=this.errorContext;var K=this.json.textures[N];const H=m.textureSampler(null!=K.sampler?this.json.samplers[K.sampler]:{});G.errorUnsupportedIf(null==K.source,"Source is expected to be defined for a texture.");K=this.json.images[K.source];var J=this.textureCache.get(N);if(!J){K.uri?I=yield this.context.loadImage(this.resolveUri(K.uri),I):(G.errorUnsupportedIf(null==K.bufferView,"Image bufferView must be defined."),
G.errorUnsupportedIf(null==K.mimeType,"Image mimeType must be defined."),J=this.json.bufferViews[K.bufferView],I=yield this.getBuffer(J.buffer,I),G.errorUnsupportedIf(null!=J.byteStride,"byteStride not supported for image buffer"),I=yield g(new Uint8Array(I.buffer,I.byteOffset+(J.byteOffset||0),J.byteLength),K.mimeType));J=O=>33071===O||33648===O||10497===O;const M=O=>{G.error(`Unexpected TextureSampler WrapMode: ${O}. Using default REPEAT(10497).`);return 10497};J={data:I,wrapS:J(H.wrapS)?H.wrapS:
M(H.wrapS),wrapT:J(H.wrapT)?H.wrapT:M(H.wrapT),minFilter:H.minFilter,name:K.name,id:N};this.textureCache.set(N,J)}return J});return function(N,I){return L.apply(this,arguments)}}();F.getNodeTransform=function(L){if(void 0===L)return x;var N=this.nodeTransformCache.get(L);if(!N){N=this.getNodeTransform(this.getNodeParent(L));const I=this.json.nodes[L];if(I.matrix)N=w.multiply(e.create(),N,I.matrix);else if(I.translation||I.rotation||I.scale)N=e.clone(N),I.translation&&w.translate(N,N,I.translation),
I.rotation&&(D[3]=n.getAxisAngle(D,I.rotation),w.rotate(N,N,D[3],D)),I.scale&&w.scale(N,N,I.scale);this.nodeTransformCache.set(L,N)}return N};F.wrapAccessor=function(L,N){return new L(N.raw,N.byteOffset,N.byteStride,N.byteOffset+N.byteStride*(N.entryCount-1)+N.componentByteSize*N.componentCount)};F.resolveUri=function(L){return p.makeAbsolute(L,this.baseUri)};F.getNodeParent=function(L){return this.nodeParentMap.get(L)};F.checkVersionSupported=function(){const L=t.Version.parse(this.json.asset.version,
"glTF");y.validate(L)};F.checkRequiredExtensionsSupported=function(){const L=this.json,N=this.errorContext;L.extensionsRequired&&0!==L.extensionsRequired.length&&N.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+L.extensionsRequired.join(", "))};F.computeNodeParents=function(){this.json.nodes.forEach((L,N)=>{L.children&&L.children.forEach(I=>{this.nodeParentMap.set(I,N)})})};return E}();const y=new t.Version(2,0,"glTF"),x=w.fromXRotation(e.create(),Math.PI/
2),D=b.create(),C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},B={[5120]:1,[5121]:1,[5122]:2,[5123]:2,[5126]:4,[5125]:4},v={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,u){let f=function(){function p(w,e,n=""){this.major=w;this.minor=e;this._context=n}var t=p.prototype;t.lessThan=function(w,e){return this.major<w||w===this.major&&
this.minor<e};t.since=function(w,e){return!this.lessThan(w,e)};t.validate=function(w){if(this.major!==w.major)throw new u((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:w});};t.clone=function(){return new p(this.major,this.minor,this._context)};p.parse=function(w,e=""){const [n,b]=w.split(".");var h=/^\s*\d+\s*$/;if(!n||!n.match||!n.match(h))throw new u((e&&
e+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:w});if(!b||!b.match||!b.match(h))throw new u((e&&e+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:w});w=parseInt(n,10);h=parseInt(b,10);return new p(w,h,e)};return p}();a.Version=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){let u=function(){function f(t){this.data=
t;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var p=f.prototype;p.readUint32=function(){const t=this.offset4;this.offset4+=1;return this.dataUint32[t]};p.readUint8Array=function(t){const w=4*this.offset4;this.offset4+=t/4;return new Uint8Array(this.data,w,t)};p.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return f}();a.BinaryStreamReader=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports",
"../../../../core/compilerUtils"],function(a,u){const f={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},p={pbrMetallicRoughness:f,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},t={ESRI_externalColorMixMode:"tint"},w={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};a.material=(e={})=>{const n={...f,...e.pbrMetallicRoughness};var b={...t,...e.extras};switch(b.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:u.neverReached(b.ESRI_externalColorMixMode),
b.ESRI_externalColorMixMode="tint"}return{...p,...e,pbrMetallicRoughness:n,extras:b}};a.textureSampler=e=>({...w,...e});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(u){let f,p;u.replace(/^(.*\/)?([^/]*)$/,(t,w,e)=>{f=w||"";p=e||"";return""});return{dirPart:f,filePart:p}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports",
"../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,u,f){a.triangleFanToTriangles=function(p){var t="number"===typeof p?p:p.length;if(3>t)return new Uint16Array(0);t-=2;const w=65536>=t?new Uint16Array(3*t):new Uint32Array(3*t);if("number"===typeof p){p=0;for(var e=0;e<t;++e)w[p++]=0,w[p++]=e+1,w[p++]=e+2;return w}{e=p[0];let n=p[1],b=0;for(let h=0;h<t;++h){const k=p[h+2];w[b++]=e;w[b++]=n;n=w[b++]=k}return w}};a.triangleStripToTriangles=function(p){var t="number"===
typeof p?p:p.length;if(3>t)return new Uint16Array(0);t-=2;const w=65536>=t?new Uint16Array(3*t):new Uint32Array(3*t);if("number"===typeof p){p=0;for(var e=0;e<t;e+=1)0===e%2?(w[p++]=e,w[p++]=e+1):(w[p++]=e+1,w[p++]=e),w[p++]=e+2}else{e=0;for(let k=0;k<t;k+=1)if(0===k%2){var n=p[k],b=p[k+1],h=p[k+2];w[e++]=n;w[e++]=b;w[e++]=h}else n=p[k+1],b=p[k],h=p[k+2],w[e++]=n,w[e++]=b,w[e++]=h}return w};a.trianglesToTriangles=function(p,t=f.generateDefaultIndexArray){return"number"===typeof p?t(p):u.isUint16Array(p)||
u.isUint8Array(p)?new Uint32Array(p):p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){function c(){c=u._asyncToGenerator(function*(F,L){F=yield d(F,L);L=yield D(F.textureDefinitions,L);return{resource:F,textures:L}});return c.apply(this,arguments)}function d(F,L){return g.apply(this,arguments)}function g(){g=u._asyncToGenerator(function*(F,L){const N=e.isSome(L)&&L.streamDataRequester;if(N)return A(F,N,L);F=yield p.result(f(F,e.unwrap(L)));if(!0===F.ok)return F.value.data;n.throwIfAbortError(F.error);y(F.error)});return g.apply(this,arguments)}
function A(F,L,N){return q.apply(this,arguments)}function q(){q=u._asyncToGenerator(function*(F,L,N){F=yield p.result(L.request(F,"json",N));if(!0===F.ok)return F.value;n.throwIfAbortError(F.error);y(F.error.details.url)});return q.apply(this,arguments)}function y(F){throw new t("",`Request for object resource failed: ${F}`);}function x(F){const L=k.empty();F.forEach(N=>{N=N.boundingInfo;e.isSome(N)&&(k.expandWithVec3(L,N.getBBMin()),k.expandWithVec3(L,N.getBBMax()))});return L}function D(F,L){return C.apply(this,
arguments)}function C(){C=u._asyncToGenerator(function*(F,L){const N=[];for(const G in F){const K=F[G];var I=K.images[0].data;if(!I){v.warn("Externally referenced texture data is not yet supported");continue}I=K.encoding+";base64,"+I;const H="/textureDefinitions/"+G,J={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};I=e.isSome(L)&&L.disableTextures?Promise.resolve(null):l.requestImage(I,L);N.push(I.then(M=>({refId:H,image:M,params:J,alphaChannelUsage:"rgba"===K.channels?K.alphaChannelUsage||
"transparency":"none"})))}F=yield Promise.all(N);L={};for(const G of F)L[G.refId]=G;return L});return C.apply(this,arguments)}function B(F){switch(F){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}const v=w.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),E=new b.Version(1,2,"wosr");a.createTextureResources=D;a.load=function(F,L){return c.apply(this,arguments)};a.processLoadResult=function(F,L){const N=[],
I=[],G=[],K=[],H=F.resource;var J=b.Version.parse(H.version||"1.0","wosr");E.validate(J);J=H.model.name;const M=H.model.geometries,O=H.materialDefinitions;F=F.textures;let Q=0;const S=new Map;for(let fa=0;fa<M.length;fa++){var V=M[fa],Y=V,W=Y.params,ba=W.topology;var ca=!0;W.vertexAttributes||(v.warn("Geometry must specify vertex attributes"),ca=!1);switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:ba=W.faces;if(!ba)v.warn("Indexed geometries must specify faces"),
ca=!1;else if(W.vertexAttributes)for(const R in W.vertexAttributes)(W=ba[R])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(v.warn(`Unsupported indexed geometry indices type '${W.valueType}', only UInt32 is currently supported`),ca=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(v.warn(`Unsupported indexed geometry values per element '${W.valuesPerElement}', only 1 is currently supported`),ca=!1)):(v.warn(`Indexed geometry does not specify face indices for '${R}' attribute`),ca=!1);
break;default:v.warn(`Unsupported topology '${ba}'`),ca=!1}Y.params.material||(v.warn("Geometry requires material"),ca=!1);Y=Y.params.vertexAttributes;for(const R in Y)Y[R].values||(v.warn("Geometries with externally defined attributes are not yet supported"),ca=!1);if(ca){ca=V.params;ca={id:1,material:ca.material,texture:ca.texture,region:ca.texture};W=V.params.vertexAttributes;Y=[];for(const R in W)ba=W[R],Y.push([R,{data:ba.values,size:ba.valuesPerElement,exclusive:!0}]);W=[];if("PerAttributeArray"!==
V.params.topology){V=V.params.faces;for(const R in V)W.push([R,new Uint32Array(V[R].values)])}if((V=F&&F[ca.texture])&&!S.has(ca.texture)){const {image:R,params:U}=V;ba=new z.Texture(R,U);K.push(ba);S.set(ca.texture,ba)}ba=(ba=S.get(ca.texture))?ba.id:void 0;var da=G[ca.material]?G[ca.material][ca.texture]:null;if(!da){da=ca.material.substring(ca.material.lastIndexOf("/")+1);da=O[da].params;1===da.transparency&&(da.transparency=0);var ha=V&&V.alphaChannelUsage;ha=0<da.transparency||"transparency"===
ha||"maskAndTransparency"===ha;V={ambient:h.fromArray(da.diffuse),diffuse:h.fromArray(da.diffuse),opacity:1-(da.transparency||0),transparent:ha,textureAlphaMode:V?B(V.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:ba,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:da.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};e.isSome(L)&&L.materialParamsMixin&&Object.assign(V,L.materialParamsMixin);da=new r.DefaultMaterial(V);G[ca.material]||(G[ca.material]={});G[ca.material][ca.texture]=
da}I.push(da);ca=new m.Geometry(Y,W);Q+=W.position?W.position.length:0;N.push(ca)}}return{name:J,stageResources:{textures:K,materials:I,geometries:N},pivotOffset:H.model.pivotOffset,boundingBox:x(N),numberOfVertices:Q,lodThreshold:null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){function C(K,H,J){const M=K.allocateHead();K=K.view;x.encodeDoubleVec3(H.modelOrigin,J,K.modelOriginHi,K.modelOriginLo,M);K.model.copyFrom(M,H.model,J);K.modelNormal.copyFrom(M,H.modelNormal,J);H.color&&K.color&&K.color.copyFrom(M,H.color,J);H.featureAttribute&&K.featureAttribute&&K.featureAttribute.copyFrom(M,H.featureAttribute,J)}let B=function(K){const H=K.baseBoundingSphere.radius;K=K.levels.map(J=>J.minScreenSpaceRadius);return new d.LevelSelector(H,
K)},v=function(){function K(J,M,O,Q){this.type="Lod";this.isGround=!1;this._inverseViewport=t.create();this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new l;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=J;this._optionalFields=M;this._metadata=O;this._instanceBufferLayout=q.DefaultMaterial.getInstanceBufferLayout({instancedDoublePrecision:!0,
instanced:M});this._glInstanceBufferLayout=h.glLayout(this._instanceBufferLayout,1);this._instanceData=new r.InstanceData(this._optionalFields,Q);this._instanceData.on("instance-added",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-removed",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",S=>{this.requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(S.index)});this._instanceData.on("instance-visibility-changed",S=>{this.requestUpdateCycle(!0);
this._metadata.notifyGraphicVisibilityChanged(S.index)});this._instanceData.on("instance-highlight-changed",()=>{this.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length}var H=K.prototype;H.initializeRenderContext=function(){var J=u._asyncToGenerator(function*(M,O){this._context=M;const Q=M.renderContext.rctx;this._levels=yield f.all(this._symbol.levels.map(S=>{this._defaultRenderInstanceData.push(new A.RenderInstanceData(Q,this._instanceBufferLayout));this._highlightRenderInstanceData.push(new A.RenderInstanceData(Q,
this._instanceBufferLayout));return g.LodLevel.create(M,S,O)}));this._levelSelector=B(this)});return function(M,O){return J.apply(this,arguments)}}();H.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(J=>J.destroy());this._defaultRenderInstanceData.forEach(J=>J.destroy());this._highlightRenderInstanceData.forEach(J=>J.destroy())};H.prepareRender=function(J,M){b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES||(this._enableLevelSelection&&(J=M.equals(this._lastCamera),this._lastCamera.copyFrom(M),
J||this.requestUpdateCycle()),J=this._needFullCycle?this._instanceData.size:2E3,this._needFullCycle=!1,this.updateInstances(M,J),this.needsUpdates&&this._context.requestRender())};H.render=function(J){var M=J.rctx;const O=4===J.slot?3:6===J.slot?5:null;if(O){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(J.pass))return!1;var Q=J.camera;this._inverseViewport[0]=1/Q.fullViewport[2];this._inverseViewport[1]=1/Q.fullViewport[3];Q={slot:O,origin:[0,0,0],camera:Q,inverseViewport:this._inverseViewport,
shadowMap:J.shadowMap,shadowMappingEnabled:J.shadowMap.enabled,ssaoHelper:J.ssaoHelper,ssaoEnabled:J.ssaoHelper.enabled,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:J.sliceHelper&&J.sliceHelper.plane,hudVisibilityTexture:J.offscreenRenderingHelper?J.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:J.offscreenRenderingHelper?J.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,
ssrEnabled:!1,lighting:J.scenelightingData,transparencyPassType:J.transparencyPassType,terrainLinearDepthTexture:J.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:J.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:J.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:J.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:J.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};M.bindVAO();M=6!==J.pass;
5!==J.pass&&7!==J.pass&&this._renderComponents(J,O,Q,this._defaultRenderInstanceData);M&&this._renderComponents(J,O,Q,this._highlightRenderInstanceData);return!0}};H.intersect=function(J,M,O,Q){if(this.baseMaterial.isVisible()){var S=e.create();w.subtract(S,Q,O);var V=Y=>{this._instanceData.getCombinedModelTransform(Y,L);J.transform.set(L);w.transformMat4(N,O,J.transform.inverse);w.transformMat4(I,Q,J.transform.inverse);const W=this._instanceData.getState(Y),ba=this._instanceData.getLodLevel(Y);z.assert(W&
r.StateFlags.ACTIVE,"invalid instance state");z.assert(0<=ba&&ba<this._levels.length,"invaid lod level");this._levels[ba].intersect(J,M,N,I,Y,this._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(V):this.octree.forEachAlongRay(O,S,V)}};H.queryDepthRange=function(J){return this.queryDepthRangeOctree(J)};H.notifyShaderTransformationChanged=function(){this.invalidateOctree()};H.requestUpdateCycle=function(J=!1){this._updateCyclesWithStaticCamera=-1;J&&(this._needFullCycle=!0);
this.needsUpdates&&this._context.requestRender()};H.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};H.buildOctree=function(){const J=new c.InstanceOctree(this._instanceData,this.baseBoundingSphere);var M=this._instanceData;M=M.view?M.view.state:null;for(let O=0;O<this._instanceData.capacity;++O)M.get(O)&r.StateFlags.ACTIVE&&J.addInstance(O);return J};H.queryDepthRangeOctree=function(J){var M=J.eye;const O=J.viewForward;var Q=this.octree.findClosest(O,1,J.frustum);
const S=this.octree.findClosest(O,-1,J.frustum);return null!=Q&&null!=S?(this._instanceData.view.boundingSphere.getVec(Q,F),w.subtract(F,F,M),Q=w.dot(F,O)-F[3],this._instanceData.view.boundingSphere.getVec(S,F),w.subtract(F,F,M),M=w.dot(F,O)+F[3],{near:Math.max(J.near,Q),far:Math.min(J.far,M)}):{near:Infinity,far:-Infinity}};H.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(J=>{J.startUpdateCylce()});this._highlightRenderInstanceData.forEach(J=>
{J.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};H.updateInstances=function(J,M){const O=this._enableLevelSelection,Q=this._levelSelector;Q.updateCamera(J);this._defaultRenderInstanceData.forEach(ca=>{ca.beginUpdate()});this._highlightRenderInstanceData.forEach(ca=>{ca.beginUpdate()});J=this._instanceData;const S=this._instanceData.view,V=J.capacity;let Y=this._instanceIndex;M=Math.min(J.size,M);for(let ca=0;ca<M;++ca){0===Y&&this.startUpdateCycle();const da=S.state.get(Y);
var W=0;if(da&r.StateFlags.ALLOCATED){var ba=S.lodLevel.get(Y);da&r.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[ba].freeTail();da&r.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[ba].freeTail();da&r.StateFlags.REMOVE?J.freeInstance(Y):da&r.StateFlags.VISIBLE?(ba=0,O&&(S.modelOrigin.getVec(Y,E),ba=Q.selectLevel(E,J.getCombinedMedianScaleFactor(Y))),W=da&~(r.StateFlags.ACTIVE|r.StateFlags.TRANSFORM_CHANGED),0<=ba&&(da&r.StateFlags.HIGHLIGHT?(C(this._highlightRenderInstanceData[ba],
S,Y),W|=r.StateFlags.HIGHLIGHT_ACTIVE):(C(this._defaultRenderInstanceData[ba],S,Y),W|=r.StateFlags.DEFAULT_ACTIVE)),S.state.set(Y,W),S.lodLevel.set(Y,ba)):(W=da&~(r.StateFlags.ACTIVE|r.StateFlags.TRANSFORM_CHANGED),S.state.set(Y,W));this._octree&&(ba=!!(da&r.StateFlags.ACTIVE),W=!!(W&r.StateFlags.ACTIVE),!ba&&W?this._octree.addInstance(Y):ba&&!W?this._octree.removeInstance(Y):ba&&W&&da&r.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(Y),this._octree.addInstance(Y)));Y=(Y+1)%V}else Y=(Y+
1)%V,M++}this._instanceIndex=Y;this._defaultRenderInstanceData.forEach(ca=>{ca.endUpdate()});this._highlightRenderInstanceData.forEach(ca=>{ca.endUpdate()})};H._renderComponents=function(J,M,O,Q){this.levels.forEach((S,V)=>{S.components.forEach(Y=>{this._renderComponent(J,M,O,Q[V],Y,V)})})};H._renderComponent=function(J,M,O,Q,S,V){var Y=S.glMaterials.get(J.pass);if(Y&&Y.beginSlot(M)&&0!==Q.size){var W=J.rctx,ba=W.capabilities.instancing;Y.ensureParameters(O);var ca=Y.technique,da=ca.program;M=Y.getPipelineState(M);
W.setPipelineState(M);W.useProgram(da);Y.bind(O);W.bindVAO(S.vao);ca.ensureAttributeLocations(S.vao);J.isHighlightPass&&k.bindOutputHighlight(da,O);ca.bindDraw(O,{},{});b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===J.pass&&(da.setUniform4fv("externalColor",G[Math.min(V,G.length-1)]),da.setUniform1i("colorMixMode",y.colorMixModes.replace));J=Q.capacity;O=Q.headIndex;V=Q.tailIndex;Y=Q.firstIndex;var ha=this._glInstanceBufferLayout;da=(fa,R)=>{D.bindVertexBufferLayout(W,m.Default3D,Q.buffer,ha,fa);
ba.drawArraysInstanced(ca.primitiveType,0,S.vertexCount,R-fa);D.unbindVertexBufferLayout(W,m.Default3D,Q.buffer,ha)};S.material.params.transparent&&null!=Y?O>V?(z.assert(Y>=V&&Y<=O,"invalid firstIndex"),da(Y,O),da(V,Y)):O<V&&(Y<=O?(z.assert(0<=Y&&Y<=O,"invalid firstIndex"),da(Y,O),da(V,J),da(0,Y)):(z.assert(Y>=V&&Y<=J,"invalid firstIndex"),da(Y,J),da(0,O),da(V,Y))):O>V?da(V,O):O<V&&(da(0,O),da(V,J));W.bindVAO(null)}};u._createClass(K,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",
get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlane",get:function(){return this._slicePlane},set:function(J){this._slicePlane=J}},{key:"intersectionHandlerId",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},
{key:"memoryUsage",get:function(){const J={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(M=>{M=M.memoryUsage;J.cpu+=M.cpu;J.gpu+=M.gpu});this._highlightRenderInstanceData.forEach(M=>{M=M.memoryUsage;J.cpu+=M.cpu;J.gpu+=M.gpu});return J}},{key:"renderStats",get:function(){const J=this._instanceData.size,M=[];this._levels.forEach((O,Q)=>{Q=this._defaultRenderInstanceData[Q].size+this._highlightRenderInstanceData[Q].size;O=O.triangleCount;M.push({renderedInstances:Q,renderedTriangles:Q*O,trianglesPerInstance:O})});
return{totalInstances:J,renderedInstances:M.reduce((O,Q)=>O+Q.renderedInstances,0),renderedTriangles:M.reduce((O,Q)=>O+Q.renderedTriangles,0),levels:M}}},{key:"slots",get:function(){return[4,6]}},{key:"needsHighlight",get:function(){return 0<this._highlightRenderInstanceData.reduce((J,M)=>J+M.size,0)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this.buildOctree());return this._octree}}]);
return K}();const E=e.create(),F=n.create(),L=p.create(),N=e.create(),I=e.create(),G=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];a.LodRenderer=v;a.setLevelSelectorFactory=function(K){B=K};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.StateFlags=void 0;(function(A){A[A.ALLOCATED=1]="ALLOCATED";A[A.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";A[A.VISIBLE=4]="VISIBLE";A[A.HIGHLIGHT=8]="HIGHLIGHT";A[A.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";A[A.REMOVE=32]="REMOVE";A[A.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";A[A.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let z=function(A){this.localTransform=A.getField("localTransform",h.BufferViewMat4f64);this.globalTransform=A.getField("globalTransform",
h.BufferViewMat4f64);this.modelOrigin=A.getField("modelOrigin",h.BufferViewVec3f64);this.model=A.getField("model",h.BufferViewMat3f);this.modelNormal=A.getField("modelNormal",h.BufferViewMat3f);this.modelScaleFactors=A.getField("modelScaleFactors",h.BufferViewVec2f);this.boundingSphere=A.getField("boundingSphere",h.BufferViewVec4f64);this.color=A.getField("color",h.BufferViewVec4f);this.featureAttribute=A.getField("featureAttribute",h.BufferViewVec4f);this.state=A.getField("state",h.BufferViewUint8);
this.lodLevel=A.getField("lodLevel",h.BufferViewUint8)};f=function(A){function q(x,D){var C=A.call(this)||this;C._capacity=0;C._size=0;C._next=0;{let B=l.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=x.indexOf("color")&&(B=B.vec4f("color"));0<=x.indexOf("featureAttribute")&&(B=B.vec4f("featureAttribute"));x=B=B.u8("state").u8("lodLevel").alignTo(8)}C._layout=x;C._shaderTransformation=
D;return C}u._inheritsLoose(q,A);var y=q.prototype;y.addInstance=function(){this._size+1>this._capacity&&this.grow();const x=this.findSlot();this._view.state.set(x,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:x});return x};y.removeInstance=function(x){const D=this._view.state;m.assert(0<=x&&x<this._capacity&&D.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");this.getStateFlag(x,a.StateFlags.ACTIVE)?this.setStateFlags(x,a.StateFlags.REMOVE):this.freeInstance(x);this.emit("instance-removed",
{index:x})};y.freeInstance=function(x){const D=this._view.state;m.assert(0<=x&&x<this._capacity&&D.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");D.set(x,0);this._size--};y.setLocalTransform=function(x,D,C=!0){this._view.localTransform.setMat(x,D);C&&this.updateModelTransform(x)};y.getLocalTransform=function(x,D){this._view.localTransform.getMat(x,D)};y.setGlobalTransform=function(x,D,C=!0){this._view.globalTransform.setMat(x,D);C&&this.updateModelTransform(x)};y.getGlobalTransform=function(x,
D){this._view.globalTransform.getMat(x,D)};y.updateModelTransform=function(x){const D=this._view;var C=r;const B=c;D.localTransform.getMat(x,d);D.globalTransform.getMat(x,g);const v=w.multiply(g,g,d);n.set(C,v[12],v[13],v[14]);D.modelOrigin.setVec(x,C);p.fromMat4(B,v);D.model.setMat(x,B);C=k.scaleFromMatrix(r,v);C.sort();D.modelScaleFactors.set(x,0,C[1]);D.modelScaleFactors.set(x,1,C[2]);p.invert(B,B);p.transpose(B,B);D.modelNormal.setMat(x,B);this.setStateFlags(x,a.StateFlags.TRANSFORM_CHANGED);
this.emit("instance-transform-changed",{index:x})};y.getModelTransform=function(x,D){const C=this._view;C.model.getMat(x,c);C.modelOrigin.getVec(x,r);D[0]=c[0];D[1]=c[1];D[2]=c[2];D[3]=0;D[4]=c[3];D[5]=c[4];D[6]=c[5];D[7]=0;D[8]=c[6];D[9]=c[7];D[10]=c[8];D[11]=0;D[12]=r[0];D[13]=r[1];D[14]=r[2];D[15]=1};y.applyShaderTransformation=function(x,D){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,D)};y.getCombinedModelTransform=function(x,D){this.getModelTransform(x,D);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,x,D);return D};y.getCombinedLocalTransform=function(x,D){this._view.localTransform.getMat(x,D);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,D);return D};y.getCombinedMaxScaleFactor=function(x){let D=this._view.modelScaleFactors.get(x,1);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(r,this,x),D*=Math.max(x[0],x[1],x[2]));return D};y.getCombinedMedianScaleFactor=function(x){let D=this._view.modelScaleFactors.get(x,
0);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(r,this,x),x.sort(),D*=x[1]);return D};y.getModel=function(x,D){this._view.model.getMat(x,D)};y.setFeatureAttribute=function(x,D){this._view.featureAttribute.setVec(x,D)};y.getFeatureAttribute=function(x,D){this._view.featureAttribute.getVec(x,D)};y.setColor=function(x,D){this._view.color.setVec(x,D)};y.getColor=function(x,D){this._view.color.getVec(x,D)};y.setVisible=function(x,D){D!==this.getVisible(x)&&(this.setStateFlag(x,
a.StateFlags.VISIBLE,D),this.emit("instance-visibility-changed",{index:x}))};y.getVisible=function(x){return this.getStateFlag(x,a.StateFlags.VISIBLE)};y.setHighlight=function(x,D){D!==this.getHighlight(x)&&(this.setStateFlag(x,a.StateFlags.HIGHLIGHT,D),this.emit("instance-highlight-changed",{index:x}))};y.getHighlight=function(x){return this.getStateFlag(x,a.StateFlags.HIGHLIGHT)};y.getState=function(x){return this._view.state.get(x)};y.getLodLevel=function(x){return this._view.lodLevel.get(x)};
y.countFlags=function(x){let D=0;for(let C=0;C<this._capacity;++C)this.getState(C)&x&&++D;return D};y.setStateFlags=function(x,D){const C=this._view.state;D|=C.get(x);C.set(x,D)};y.clearStateFlags=function(x,D){const C=this._view.state;D=C.get(x)&~D;C.set(x,D)};y.setStateFlag=function(x,D,C){C?this.setStateFlags(x,D):this.clearStateFlags(x,D)};y.getStateFlag=function(x,D){return!!(this._view.state.get(x)&D)};y.grow=function(){const x=Math.max(1024,Math.floor(2*this._capacity)),D=this._layout.createBuffer(x);
if(this._buffer){const C=new Uint8Array(this._buffer.buffer);(new Uint8Array(D.buffer)).set(C)}this._capacity=x;this._buffer=D;this._view=new z(this._buffer)};y.findSlot=function(){const x=this._view.state;let D=this._next;for(;x.get(D)&a.StateFlags.ALLOCATED;)D=(D+1)%this._capacity;this._next=(D+1)%this._capacity;return D};u._createClass(q,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},
{key:"view",get:function(){return this._view}}]);return q}(f);const r=b.create(),c=t.create(),d=e.create(),g=e.create();a.InstanceData=f;a.InstanceDataView=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,u,f,p,t,w,
e){e=function(n){function b(k,l){var m=n.call(this,z=>t.wrap(m._instanceData.view.boundingSphere.getVec(z,m._tmpSphere)),{maximumDepth:25})||this;m._tmpSphere=t.create();m._tmpMat4=f.create();m._instanceData=k;m._boundingSphere=l;return m}u._inheritsLoose(b,n);var h=b.prototype;h.addInstance=function(k){const l=this._instanceData.view.boundingSphere,m=this._instanceData.getCombinedModelTransform(k,this._tmpMat4);p.transformMat4(this._tmpSphere,this._boundingSphere.center,m);this._tmpSphere[3]=this._boundingSphere.radius*
w.maxScale(m);l.setVec(k,this._tmpSphere);this.add([k])};h.removeInstance=function(k){this.remove([k])};return b}(e);a.InstanceOctree=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,u){let f=function(){function p(w,e){this.thresholdScale=1;this._camera=new u;this._worldSpaceRadius=w;this._thresholds=e.map(n=>n)}var t=p.prototype;t.updateCamera=function(w){this._camera.copyFrom(w)};
t.selectLevel=function(w,e){w=this._camera.computeScreenPixelSizeAt(w);e=this._worldSpaceRadius*e/w;w=this._thresholds;let n=-1;for(let b=0;b<w.length;++b)e>=w[b]*this.thresholdScale&&(n=b);return n};return p}();a.LevelSelector=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,u,f,p,t,w){let e=function(){function n(h,k){this.minScreenSpaceRadius=h;this.components=k}n.create=function(){var h=u._asyncToGenerator(function*(k,l,m){const z=yield Promise.all(l.components.map(r=>k.schedule(()=>new w.LodComponentData(k,r),m)));return new n(l.minScreenSpaceRadius,z)});return function(k,l,m){return h.apply(this,arguments)}}();var b=n.prototype;b.destroy=function(){this.components.forEach(h=>{h.destroy()})};b.intersect=function(h,k,l,m,z,r){this.components.forEach(c=>{c.intersect(h,
k,l,m,z,r)})};u._createClass(n,[{key:"boundingBox",get:function(){if(!this._boundingBox){const h=t.empty();this.components.forEach(k=>{f.isSome(k.boundingInfo)&&(t.expandWithVec3(h,k.boundingInfo.bbMin),t.expandWithVec3(h,k.boundingInfo.bbMax))});this._boundingBox=h}return this._boundingBox}},{key:"boundingSphere",get:function(){if(!this._boundingSphere){const h=this.boundingBox,k=p.create();t.center(h,k);this._boundingSphere={center:k,radius:.5*t.diameter(h)}}return this._boundingSphere}},{key:"triangleCount",
get:function(){return this.components.reduce((h,k)=>h+k.triangleCount,0)}}]);return n}();a.LodLevel=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../intersectorUtils ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),function(a,u,
f,p,t,w,e,n){let b=function(){function h(l,m){const z=l.renderContext.rctx,r=m.geometry;m=m.material;this.materialRep=l.materialRep;m.setParameterValues({instancedDoublePrecision:!0});l=m.createBufferWriter();const c=l.vertexBufferLayout,d=l.elementCount(r),g=l.allocate(d);l.write({},r,g,0);this.geometry=r;this.material=m;this.glMaterials=w.acquireMaterials(m,this.materialRep);this.vertexBufferLayout=c;this.vbo=e.createVertex(z,35044,g.buffer);this.vao=new n(z,p.Default3D,{geometry:f.glLayout(c)},
{geometry:this.vbo});this.vertexCount=d}var k=h.prototype;k.destroy=function(){w.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};k.intersect=function(l,m,z,r,c,d){const g=this.geometry.id,A=c.toString();this.material.intersect(this.geometry,null,l.transform.transform,l,z,r,(q,y,x,D)=>{if(0<=q&&(null==m||m(l.rayBeginPoint,l.rayEndPoint,q))){var C={type:"external",metadata:{layerUid:d.layerUid,graphicUid:d.graphicUid(c)}};if(null==l.results.min.drapedLayerOrder||
D>=l.results.min.drapedLayerOrder)if(null==l.results.min.dist||q<l.results.min.dist)l.results.min.set(C,A,q,y,l.transform.transform,D,null,g,x),l.results.min.intersector="LodRenderer";0!==l.options.store&&(null==l.results.max.drapedLayerOrder||D>=l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||q>l.results.max.dist)&&(l.results.max.set(C,A,q,y,l.transform.transform,D,null,g,x),l.results.min.intersector="LodRenderer");if(2===l.options.store){const B=new t.IntersectorResult(l.results.min.ray);
B.set(C,A,q,y,l.transform.transform,D,null,g,x);B.intersector="LodRenderer";l.results.all.push(B)}}})};u._createClass(h,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return h}();a.LodComponentData=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/support/buffer/BufferView",
"../Util","./BackedBufferObject"],function(a,u,f,p,t){let w=function(n){this.modelOriginHi=n.getField("modelOriginHi",f.BufferViewVec3f);this.modelOriginLo=n.getField("modelOriginLo",f.BufferViewVec3f);this.model=n.getField("model",f.BufferViewMat3f);this.modelNormal=n.getField("modelNormal",f.BufferViewMat3f);this.color=n.getField("instanceColor",f.BufferViewVec4f);this.featureAttribute=n.getField("instanceFeatureAttribute",f.BufferViewVec4f)},e=function(){function n(h,k){this._tailIndex=this._headIndex=
0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=h;this._instanceBufferLayout=k;this._elementSize=k.stride;this._capacity=1}var b=n.prototype;b.destroy=function(){this._buffer&&this._buffer.destroy()};b.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};b.startUpdateCylce=function(){this._captureFirstIndex=!0};b.beginUpdate=function(){p.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};
b.endUpdate=function(){p.assert(this._updating,"not updating");this.size<.3*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};b.allocateHead=function(){p.assert(this._updating,"not updating");this.isFull&&this.grow();const h=this.headIndex;this._captureFirstIndex&&(this._firstIndex=h,this._captureFirstIndex=!1);this.incrementHead();p.assert(this._headIndex!==this._tailIndex,"invalid pointers");
return h};b.freeTail=function(){p.assert(this._updating,"not updating");p.assert(0<this.size,"invalid size");const h=this._tailIndex===this._firstIndex;this.incrementTail();h&&(this._firstIndex=this._tailIndex)};b.grow=function(){this.resize(Math.max(1024,Math.floor(2*this._capacity)))};b.shrink=function(){this.resize(Math.max(1024,Math.floor(.5*this._capacity)))};b.resize=function(h){p.assert(this._updating,"not updating");if(h!==this._capacity){var k=new t(this._rctx,this._elementSize,h);if(this._buffer){this._firstIndex&&
(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const l=this.size,m=this.compactInstances(k);p.assert(m===l,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=m;this._prevHeadIndex=0}this._resized=!0;this._capacity=h;this._buffer=k;this._view=new w(this._instanceBufferLayout.createView(this._buffer.array))}};b.compactInstances=function(h){const k=this._headIndex,l=this._tailIndex;return l<k?(this._buffer.copyRange(l,k,h),k-l):l>k?(this._buffer.copyRange(l,
this._capacity,h),0<k&&this._buffer.copyRange(0,k,h,this._capacity-l),k+(this._capacity-l)):0};b.incrementHead=function(h=1){this._headIndex=(this._headIndex+h)%this._capacity};b.incrementTail=function(h=1){this._tailIndex=(this._tailIndex+h)%this._capacity};b.transferRange=function(h,k){h<k?this._buffer.transferRange(h,k):h>k&&(0<k&&this._buffer.transferRange(0,k),this._buffer.transferRange(h,this._capacity))};u._createClass(n,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",
get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const h=this._headIndex,k=this._tailIndex;return h>=k?h-k:h+this._capacity-k}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},
{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return n}();a.RenderInstanceData=e;a.RenderInstanceDataView=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject"],function(a,u){return function(){function f(t,w,e){this._elementSize=w;this._buffer=u.createVertex(t,35044);this.resize(e)}
var p=f.prototype;p.destroy=function(){this._buffer.dispose()};p.copyRange=function(t,w,e,n=0){t=new Uint8Array(this.array,t*this.elementSize,(w-t)*this.elementSize);(new Uint8Array(e.array,n*this.elementSize)).set(t)};p.transferAll=function(){this._buffer.setData(this._array)};p.transferRange=function(t,w){t*=this._elementSize;this._buffer.setSubData(this._array,t,t,w*this._elementSize)};p.resize=function(t){const w=t*this._elementSize,e=new ArrayBuffer(w);this._array&&(t>=this._capacity?(new Uint8Array(e)).set(new Uint8Array(this._array)):
(new Uint8Array(e)).set((new Uint8Array(this._array)).subarray(0,t*this._elementSize)));this._array=e;this._buffer.setData(w);this._capacity=t};a._createClass(f,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return f}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){function v(H,J,M){switch(J){case "world":for(const O of H.vertices)b.add(I,O.pos,H.offset),M.worldUpAtPosition(I,N),O.setFrameFromUpVector(N),O.computeRotationAxisAndAngleFromUpVector();break;case "path":b.add(I,H.vertices[0].pos,H.offset);M.worldUpAtPosition(I,N);D.computeMinimumRotationTangentFrame(H,N);for(const O of H.vertices)H=p.sign(b.dot(O.frame.right,O.vRight)),b.cross(O.rotationFrame.up,O.vRight,O.vLeft),b.scale(O.rotationFrame.up,
O.rotationFrame.up,H),b.normalize(O.rotationFrame.up,O.rotationFrame.up),J=b.dot(O.rotationFrame.up,O.frame.up),M=b.dot(O.rotationFrame.up,O.frame.right),b.scale(I,O.frame.up,-M),b.scale(G,O.frame.right,J),b.add(I,I,G),b.normalize(O.rotationFrame.right,I),D.vertexSpaceToProfileSpace(O.rotationRight,O.frame,O.rotationFrame.right),b.negate(I,O.vLeft),O.rotationAngle=-H*(Math.PI-p.acosClamped(b.dot(I,O.vRight))),0<Math.abs(O.rotationAngle)&&(H=p.reciprocalClamped(Math.cos(.5*O.rotationAngle)),w.set(O.miterStretch,
1+(H-1)*O.rotationRight[0]*O.rotationRight[0],(H-1)*O.rotationRight[0]*O.rotationRight[1],(H-1)*O.rotationRight[0]*O.rotationRight[1],1+(H-1)*O.rotationRight[1]*O.rotationRight[1])),O.maxStretchDistance=Math.abs(Math.min(O.vLeftLength,O.vRightLength)*p.reciprocalClamped(Math.cos(.5*(Math.PI-O.rotationAngle))))}}function E(H,J,M){switch(H){case "symbol-value":return M;case "proportional":return J;default:return H}}function F(H,J,M,O){H=H.stageObject;const Q=H.geometryRecords,S=Q.length;var V=0;O.spatialReference;
for(let da=0;da<S;da++){const ha=Q[da].geometry;if(!x.isPathGeometry(ha))continue;const fa=ha.path,R=fa.builder.path;ha.geometrySR;{var Y=R;var W=J,ba=M,ca=O;let U=0;for(const Z of Y.vertices){const T=r.evaluateElevationAlignmentAtPoint(Z.posES,ba,W,ca,K);U+=K.sampledElevation;b.add(N,Z.pos,Y.offset);ca.setAltitude(N,T);b.subtract(Z.pos,N,Y.offset)}Y.updatePathVertexInformation();Y=U/Y.vertices.length}V+=Y;"world"!==ha.upVectorAlignment&&v(R,ha.upVectorAlignment,O);fa.onPathChanged();ha.invalidateBoundingInfo();
H.geometryVertexAttrsUpdated(da)}return V/S}const L=["polyline"];z=function(H){function J(O,Q,S,V){O=H.call(this,O,Q,S,V)||this;O._intrinsicSize=n.fromValues(1,1);O.upVectorAlignment="path";O.stencilWidth=.1;O.ensureDrapedStatus(!1);return O}u._inheritsLoose(J,H);var M=J.prototype;M.doLoad=function(){var O=u._asyncToGenerator(function*(){const Q=t.isSome(this.symbolLayer.width)?this.symbolLayer.width:t.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size,S=t.isSome(this.symbolLayer.height)?
this.symbolLayer.height:Q;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[Q,1,S],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?q.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var V=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var Y=this.symbolLayer.profile||"circle";switch(Y){default:this._profile=D.Profile.circle(10);break;case "quad":this._profile=D.Profile.rect()}var W=[0,0];"center"!==V&&(W={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[V],this._profile.translate(W[0],W[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new D.MiterExtruder(0,3);break;case "bevel":this._extruder=
new D.MiterExtruder(0,1);break;case "miter":this._extruder=new D.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new D.SimpleExtruder}V=this.symbolLayer.cap||"butt";switch(V){case "none":this._startCap=new D.NoCapBuilder;this._endCap=new D.NoCapBuilder;break;default:this._startCap=new D.TriangulationCapBuilder(this._profile,0);this._endCap=new D.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new D.TriangulationCapBuilder(this._profile,-.5);this._endCap=new D.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":Y="quad"===Y?!0:!1,this._startCap=new D.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:Y,subdivisions:3}),this._endCap=new D.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:Y,subdivisions:3})}Y=t.get(this.symbolLayer,"material","color");W=this._getCombinedOpacityAndColor(Y);Y=k.fromArray(W);W=W[3];const ba=1>W||this.needsDrivenTransparentPass;V={diffuse:Y,ambient:Y,opacity:W,transparent:ba,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:ba||"none"===V?0:2,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(e.set(this._intrinsicSize,Q,S),!A.isValidSize(this._intrinsicSize[0])||!A.isValidSize(this._intrinsicSize[1])))throw new f("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||e.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(Object.assign(V,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new B.PathMaterial(V)):(V.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new C.DefaultMaterial(V));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return O.apply(this,arguments)}}();M.destroy=
function(){H.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};M.createGraphics3DGraphic=function(O){const Q=O.graphic;if(!this._validateGeometry(Q.geometry,L,this.symbolLayer.type))return null;const S=this.setGraphicElevationContext(Q,new c.ElevationContext);return this._createAs3DShape(Q,O.renderingInfo,S,Q.uid)};M.layerOpacityChanged=function(){var O=t.get(this.symbolLayer,"material","color");O=this._getCombinedOpacity(O);this._material.setParameterValues({opacity:O,
transparent:1>O||this.needsDrivenTransparentPass});return!0};M.layerElevationInfoChanged=function(O,Q){return this.updateGraphics3DGraphicElevationInfo(O,Q,r.needsElevationUpdates3D)};M.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};M.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};M.pixelRatioChanged=function(){return!0};
M.applyRendererDiff=function(O,Q){for(const S in O.diff)switch(S){case "visualVariables":if(q.updateFastSymbolUpdatesState(this._fastUpdates,Q,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};M.getVertexData=function(O){let Q=0;const S=O.paths,V=[],Y=O.spatialReference,W=this._context.elevationProvider.spatialReference,ba=this._context.renderCoordsHelper.spatialReference;for(var ca of S)Q+=ca.length;ca=new Float64Array(3*
Q);const da=new Float64Array(3*Q),ha=new Float64Array(3*Q);let fa=0;for(const R of S){V.push({index:fa,numVertices:R.length});for(const U of R)ca[fa++]=U[0],ca[fa++]=U[1],ca[fa++]=O.hasZ?U[2]:0}O=!0;Y.equals(W)?this._copyVertices(ca,0,da,0,Q):O=l.projectBuffer(ca,Y,0,da,W,0,Q);W.equals(ba)?this._copyVertices(da,0,ha,0,Q):l.projectBuffer(da,W,0,ha,ba,0,Q);return{pathVertexDataInfos:V,vertexDataGS:ca,vertexDataES:da,vertexDataRS:ha,projectionSuccess:O,terrainElevation:0}};M._copyVertices=function(O,
Q,S,V,Y){Q*=3;V*=3;for(let W=0;W<Y;++W)S[V++]=O[Q++],S[V++]=O[Q++],S[V++]=O[Q++]};M._createAs3DShape=function(O,Q,S,V){var Y=O.geometry,W=[];const ba=[],ca=[],da=Y.spatialReference,ha=m.create(),fa=this._context.renderCoordsHelper,R=this.getVertexData(Y);if(!R.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<R.pathVertexDataInfos.length){for(Y=0;Y<R.pathVertexDataInfos.length;++Y){var U=R.pathVertexDataInfos[Y],
Z=U.index;U=U.numVertices;if(2>U)continue;if(t.isSome(this._context.clippingExtent)&&(m.empty(ha),m.expandWithBuffer(ha,R.vertexDataES,3*Z,U),!m.intersectsClippingArea(ha,this._context.clippingExtent)))continue;var T=[];for(var P=Z;P<Z+3*U;){const ja=P++,ia=P++,ka=P++,na=new D.PathVertex;b.set(na.posGS,R.vertexDataGS[ja],R.vertexDataGS[ia],R.vertexDataGS[ka]);b.set(na.posES,R.vertexDataES[ja],R.vertexDataES[ia],R.vertexDataES[ka]);const ta=r.evaluateElevationAlignmentAtPoint(na.posES,this._context.elevationProvider,
S,fa,null);b.set(N,R.vertexDataRS[ja],R.vertexDataRS[ia],R.vertexDataRS[ka]);fa.setAltitude(N,ta);b.set(na.pos,N[0],N[1],N[2]);T.push(na)}Z=new D.Path(T);v(Z,this.upVectorAlignment,this._context.renderCoordsHelper);Z=new D.Builder(Z,this._profile,this._extruder,this._startCap,this._endCap);U=null;this._fastUpdates.enabled?(P=this._fastUpdates.visualVariables,U=P.size?g.getAttributeValue(P.size.field,O):0,T=P.color?g.getAttributeValue(P.color.field,O):0,P=P.opacity?g.getAttributeValue(P.opacity.field,
O):0,U=new D.FastUpdatePathGeometry(Z,U,T,P)):(U=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(U[0]*=E(Q.size[0],"symbol-value"===Q.size[2]?this.symbolLayer.height||0:Q.size[2],this.symbolLayer.width||0),U[1]*=E(Q.size[2],"symbol-value"===Q.size[0]?this.symbolLayer.width||0:Q.size[0],this.symbolLayer.height||0)),T=null,this._drivenProperties.color&&(T=Q.color),this._drivenProperties.opacity&&null!=Q.opacity&&(T=T?[T[0],T[1],T[2],Q.opacity]:[1,1,1,Q.opacity]),Z=new D.StaticPathGeometry(Z),
Z.bake(U),T&&Z.bakeVertexColors(T),U=Z);const {vertexAttributes:X,indices:aa}=U.createGeometryData();Z=new x.PathGeometry(X,aa,U,da,this.upVectorAlignment,this.stencilWidth);W.push(Z);ba.push(this._material);ca.push(U.xform)}if(0<W.length)return O=new y.Object3D({geometries:W,materials:ba,transformations:ca,metadata:{layerUid:this._context.layer.uid,graphicUid:V}}),W=new d.Graphics3DObject3DGraphicLayer(this,O,W,null,null,F,S),W.alignedSampledElevation=R.terrainElevation,W.needsElevationUpdates=r.needsElevationUpdates3D(S.mode),
W}else 0!==Y.paths.length&&Y.paths.some(X=>0<X.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return J}(g.Graphics3DSymbolLayer);const N=k.create(),I=h.create(),G=h.create(),K={verticalDistanceToGround:0,sampledElevation:0};a.Graphics3DPathSymbolLayer=z;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;a.default=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2":function(){define(["exports",
"./common"],function(a,u){function f(B,v){B[0]=v[0];B[1]=v[1];B[2]=v[2];B[3]=v[3];return B}function p(B){B[0]=1;B[1]=0;B[2]=0;B[3]=1;return B}function t(B,v,E,F,L){B[0]=v;B[1]=E;B[2]=F;B[3]=L;return B}function w(B,v){if(B===v){const E=v[1];B[1]=v[2];B[2]=E}else B[0]=v[0],B[1]=v[2],B[2]=v[1],B[3]=v[3];return B}function e(B,v){const E=v[0],F=v[1],L=v[2];v=v[3];let N=E*v-L*F;if(!N)return null;N=1/N;B[0]=v*N;B[1]=-F*N;B[2]=-L*N;B[3]=E*N;return B}function n(B,v){const E=v[0];B[0]=v[3];B[1]=-v[1];B[2]=
-v[2];B[3]=E;return B}function b(B){return B[0]*B[3]-B[2]*B[1]}function h(B,v,E){const F=v[0],L=v[1],N=v[2];v=v[3];const I=E[0],G=E[1],K=E[2];E=E[3];B[0]=F*I+N*G;B[1]=L*I+v*G;B[2]=F*K+N*E;B[3]=L*K+v*E;return B}function k(B,v,E){const F=v[0],L=v[1],N=v[2];v=v[3];const I=Math.sin(E);E=Math.cos(E);B[0]=F*E+N*I;B[1]=L*E+v*I;B[2]=F*-I+N*E;B[3]=L*-I+v*E;return B}function l(B,v,E){const F=v[1],L=v[2],N=v[3],I=E[0];E=E[1];B[0]=v[0]*I;B[1]=F*I;B[2]=L*E;B[3]=N*E;return B}function m(B,v){const E=Math.sin(v);
v=Math.cos(v);B[0]=v;B[1]=E;B[2]=-E;B[3]=v;return B}function z(B,v){B[0]=v[0];B[1]=0;B[2]=0;B[3]=v[1];return B}function r(B){return"mat2("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+")"}function c(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2)}function d(B,v,E,F){B[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];E[3]=F[3]-B[2]*E[1];return[B,v,E]}function g(B,v,E){B[0]=v[0]+E[0];B[1]=v[1]+E[1];B[2]=v[2]+E[2];B[3]=v[3]+E[3];return B}function A(B,v,E){B[0]=v[0]-E[0];B[1]=v[1]-E[1];B[2]=v[2]-E[2];B[3]=v[3]-E[3];return B}
function q(B,v){return B[0]===v[0]&&B[1]===v[1]&&B[2]===v[2]&&B[3]===v[3]}function y(B,v){const E=B[0],F=B[1],L=B[2];B=B[3];const N=v[0],I=v[1],G=v[2];v=v[3];return Math.abs(E-N)<=u.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(F-I)<=u.EPSILON*Math.max(1,Math.abs(F),Math.abs(I))&&Math.abs(L-G)<=u.EPSILON*Math.max(1,Math.abs(L),Math.abs(G))&&Math.abs(B-v)<=u.EPSILON*Math.max(1,Math.abs(B),Math.abs(v))}function x(B,v,E){B[0]=v[0]*E;B[1]=v[1]*E;B[2]=v[2]*E;B[3]=v[3]*E;return B}function D(B,v,
E,F){B[0]=v[0]+E[0]*F;B[1]=v[1]+E[1]*F;B[2]=v[2]+E[2]*F;B[3]=v[3]+E[3]*F;return B}var C=Object.freeze({__proto__:null,copy:f,identity:p,set:t,transpose:w,invert:e,adjoint:n,determinant:b,multiply:h,rotate:k,scale:l,fromRotation:m,fromScaling:z,str:r,frob:c,LDU:d,add:g,subtract:A,exactEquals:q,equals:y,multiplyScalar:x,multiplyScalarAndAdd:D,mul:h,sub:A});a.LDU=d;a.add=g;a.adjoint=n;a.copy=f;a.determinant=b;a.equals=y;a.exactEquals=q;a.frob=c;a.fromRotation=m;a.fromScaling=z;a.identity=p;a.invert=
e;a.mat2=C;a.mul=h;a.multiply=h;a.multiplyScalar=x;a.multiplyScalarAndAdd=D;a.rotate=k;a.scale=l;a.set=t;a.str=r;a.sub=A;a.subtract=A;a.transpose=w})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,u,f){f=function(p){function t(w,e,n,b,h,k){w=p.call(this,w,e)||this;w.path=n;w.geometrySR=b;w.upVectorAlignment=h;w.stencilWidth=k;return w}u._inheritsLoose(t,p);return t}(f.Geometry);a.PathGeometry=f;a.isPathGeometry=
function(p){return"upVectorAlignment"in p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ../materials/internal/MaterialUtil".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){function c(){return{up:k.create(),right:k.create()}}let d=function(){function W(){this.pos=k.create();this.posES=k.create();this.posGS=k.create();this.vRight=k.create();this.vLeft=k.create();this.frame=c();this.rotationFrame=c();this.rotationRight=b.create();this.rotationAngle=0;this.miterStretch=t.create()}var ba=W.prototype;ba.setFrameFromUpVector=function(ca){h.copy(this.frame.up,ca);h.add(M,this.vLeft,this.vRight);h.normalize(M,M);h.scale(J,this.frame.up,
h.dot(M,this.frame.up));h.subtract(S,M,J);h.normalize(S,S);h.cross(this.frame.right,S,this.frame.up)};ba.computeRotationAxisAndAngleFromUpVector=function(){h.copy(this.rotationFrame.up,this.frame.up);h.copy(this.rotationFrame.right,this.frame.right);n.set(this.rotationRight,1,0);h.scale(J,this.frame.up,h.dot(this.frame.up,this.vLeft));h.subtract(J,this.vLeft,J);h.negate(J,J);h.normalize(J,J);h.scale(M,this.frame.up,h.dot(this.frame.up,this.vRight));h.subtract(M,this.vRight,M);h.normalize(M,M);h.cross(O,
this.rotationFrame.up,this.vLeft);this.rotationAngle=f.sign(h.dot(O,this.vRight))*(Math.PI-f.acosClamped(h.dot(J,M)));if(0<Math.abs(this.rotationAngle)){const ca=f.reciprocalClamped(Math.cos(.5*this.rotationAngle));p.set(this.miterStretch,1+(ca-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return W}(),g=function(){function W(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var ba=W.prototype;ba.addVertex=function(ca,da){this.vertices.push(b.clone(ca));this.vertexNormals.push(b.clone(da));return this.vertices.length-1};ba.addUV=function(ca){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(ca);return this.uvs.length-1};ba.addPole=function(ca,da=null){this.poles.push({position:b.clone(ca),normal:da?b.clone(da):null});return this.poles.length-1};ba.addSegment=function(ca,da=null,ha=null){this.vertexIndices.push(ca.v0);this.vertexIndices.push(ca.v1);
da&&(this.uvIndices.push(da.v0),this.uvIndices.push(da.v1));ha&&(this.poleIndices.push(ha.v0),this.poleIndices.push(ha.v1))};ba.hasUV=function(){return null!=this.uvs};ba.translate=function(ca,da){for(const ha of this.vertices)ha[0]+=ca,ha[1]+=da;for(const ha of this.poles)ha.position[0]+=ca,ha.position[1]+=da};W.circle=function(ca=20){const da=new W,ha={v0:0,v1:0};da.addPole(b.fromValues(0,0));for(var fa=0;fa<ca;++fa){var R=2*fa*Math.PI/ca,U=Math.cos(R);const Z=Math.sin(R);R=b.fromValues(.5*U,.5*
Z);U=b.fromValues(U,Z);da.addVertex(R,U);da.addUV(fa/ca)}da.addUV(1);for(fa=0;fa<ca-1;++fa)U={v0:fa,v1:fa+1},da.addSegment(U,U,ha);da.addSegment({v0:ca-1,v1:0},{v0:ca-1,v1:ca},ha);return da};W.rect=function(){const ca=new W,da=b.fromValues(-.5,-.5),ha=b.fromValues(.5,-.5),fa=b.fromValues(.5,.5),R=b.fromValues(-.5,.5),U=b.fromValues(0,-1),Z=b.fromValues(1,0),T=b.fromValues(0,1),P=b.fromValues(-1,0);ca.addUV(0);ca.addUV(1);ca.addPole(b.fromValues(0,.5),T);ca.addPole(b.fromValues(0,.5));ca.addPole(b.fromValues(0,
-.5));ca.addPole(b.fromValues(0,-.5),U);const X={v0:0,v1:1};ca.addVertex(da,U);ca.addVertex(ha,U);ca.addSegment({v0:0,v1:1},X,{v0:3,v1:3});ca.addVertex(ha,Z);ca.addVertex(fa,Z);ca.addSegment({v0:2,v1:3},X,{v0:2,v1:1});ca.addVertex(fa,T);ca.addVertex(R,T);ca.addSegment({v0:4,v1:5},X,{v0:0,v1:0});ca.addVertex(R,P);ca.addVertex(da,P);ca.addSegment({v0:6,v1:7},X,{v0:1,v1:2});return ca};u._createClass(W,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return W}(),A=function(){function W(ba){this.vertices=
[];this.offset=k.create();this.xform=e.create();this.vertices=ba;h.copy(this.offset,this.vertices[Math.floor((ba.length-1)/2)].pos);for(const ca of this.vertices)h.subtract(ca.pos,ca.pos,this.offset);w.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}W.prototype.updatePathVertexInformation=function(){const ba=this.vertices.length;let ca=this.vertices[0];ca.index=0;h.set(ca.vLeft,0,0,0);ca.vLeftLength=0;h.subtract(ca.vRight,this.vertices[1].pos,ca.pos);ca.vRightLength=
h.length(ca.vRight);h.normalize(ca.vRight,ca.vRight);let da=ca;for(let ha=1;ha<ba;++ha)ca=this.vertices[ha],ca.index=ha,h.copy(ca.vLeft,da.vRight),ca.vLeftLength=da.vRightLength,ha<ba-1?(h.subtract(ca.vRight,this.vertices[ha+1].pos,ca.pos),ca.vRightLength=h.length(ca.vRight),h.normalize(ca.vRight,ca.vRight)):(h.copy(ca.vRight,ca.vLeft),ca.vRightLength=ca.vLeftLength),da=ca};return W}(),q=function(){function W(){}var ba=W.prototype;ba.numProfilesPerJoin=function(){return 1};ba.extrude=function(ca,
da,ha){for(let fa=0;fa<da.vertices.length;++fa)ha(ca.index,ca.frame,da.vertices[fa],da.vertexNormals[fa],!1)};return W}(),y=function(){function W(ca=.8*Math.PI,da=1){this.cutoffAngle=ca;this.numBendSubdivisions=da}var ba=W.prototype;ba.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};ba.extrude=function(ca,da,ha){var fa=V;if(Math.abs(ca.rotationAngle)>=this.cutoffAngle)for(var R=0;R<this.numBendSubdivisions+1;++R){w.identity(Y);w.rotate(Y,Y,.5*-ca.rotationAngle+R*ca.rotationAngle/
this.numBendSubdivisions,ca.rotationFrame.up);var U=fa,Z=ca.frame,T=Y;h.transformMat4(U.up,Z.up,T);h.transformMat4(U.right,Z.right,T);for(U=0;U<da.vertices.length;++U)0<=n.dot(da.vertices[U],ca.rotationRight)*ca.rotationAngle?ha(ca.index,fa,da.vertices[U],da.vertexNormals[U],!1):(n.transformMat2(G,da.vertices[U],ca.miterStretch),ha(ca.index,ca.frame,G,da.vertexNormals[U],!0))}else for(fa=0;fa<this.numBendSubdivisions+1;++fa)for(R=0;R<da.vertices.length;++R)U=0<=n.dot(da.vertices[R],ca.rotationRight)*
ca.rotationAngle,n.transformMat2(G,da.vertices[R],ca.miterStretch),ha(ca.index,ca.frame,G,da.vertexNormals[R],U?!1:!0)};return W}();const x={generateUV:!1};let D=function(){function W(){}W.prototype.rebuildConnectingProfileGeometry=function(ba,ca,da){for(let ha=0;ha<ca.vertices.length;++ha)da(ba.index,ba.frame,ca.vertices[ha],ca.vertexNormals[ha],0,0)};return W}(),C=function(W){function ba(){return W.call(this)||this}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.getNumVertices=function(){return 0};
ca.getNumIndices=function(){return 0};ca.rebuildCapGeometry=function(){};ca.buildTopology=function(){};return ba}(D),B=function(W){function ba(da,ha=0,fa=!1){var R=W.call(this)||this;R.profile=da;R.profilePlaneOffset=ha;R.flip=fa;return R}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.getNumVertices=function(){return this.profile.vertices.length};ca.getNumIndices=function(){return 3*this.profile.numSegments};ca.rebuildConnectingProfileGeometry=function(da,ha,fa){for(let R=0;R<ha.vertices.length;++R)fa(da.index,
da.frame,ha.vertices[R],ha.vertexNormals[R],this.profilePlaneOffset,0)};ca.rebuildCapGeometry=function(da,ha){const fa=K;n.set(fa,0,0);const R=this.flip?1:-1;for(let U=0;U<this.profile.vertices.length;++U)ha(da.index,da.frame,this.profile.vertices[U],fa,this.profilePlaneOffset,R)};ca.buildTopology=function(da,ha){da=this.vertexBufferStart+this.profile.vertexIndices[0];for(let fa=1;fa<this.profile.numSegments;++fa){const R=this.vertexBufferStart+this.profile.vertexIndices[2*fa],U=this.vertexBufferStart+
this.profile.vertexIndices[2*fa+1];this.flip?ha(U,R,da):ha(da,R,U)}};return ba}(D),v=function(W){function ba(da){var ha=W.call(this)||this;ha.flip=!1;ha.sign=0;ha.breakNormals=!1;ha.numSegments=3;ha.profile=da.profile;ha.flip=da.flip;ha.sign=ha.flip?1:-1;ha.breakNormals=da.breakNormals;ha.numSegments=da.subdivisions;return ha}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.getNumVertices=function(){let da=0;da=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(da+=this.profile.vertices.length);
return da+=this.profile.poles.length};ca.getNumIndices=function(){let da;da=2*this.profile.numSegments*(this.numSegments-1);for(let ha=0;ha<this.profile.numSegments;++ha)da=this.profile.poleIndices[this.profile.vertexIndices[2*ha]]===this.profile.poleIndices[this.profile.vertexIndices[2*ha+1]]?da+1:da+2;return 3*da};ca.rebuildCapGeometry=function(da,ha){const fa=da.frame,R=.5*this.sign,U=G,Z=K;n.set(Z,0,0);for(var T=0;T<this.profile.poles.length;++T){var P=this.profile.poles[T];P.normal?ha(da.index,
fa,P.position,P.normal,R,0):ha(da.index,fa,P.position,Z,R,this.sign)}if(this.breakNormals)for(T=0;T<this.profile.vertices.length;++T)ha(da.index,fa,this.profile.vertices[T],this.profile.vertexNormals[T],0,0);for(T=0;T<this.numSegments-1;++T){var X=(1-(T+1)/this.numSegments)*Math.PI*.5;P=Math.sin(X);X=Math.cos(X);for(let aa=0;aa<this.profile.vertices.length;++aa){const ja=this.profile.poles[this.profile.poleIndices[aa]];n.subtract(U,this.profile.vertices[aa],ja.position);n.scale(U,U,P);ja.normal?(n.add(U,
U,ja.position),ha(da.index,fa,U,ja.normal,R*X,0)):(n.normalize(Z,U),n.scale(Z,Z,P),n.add(U,U,ja.position),ha(da.index,fa,U,Z,R*X,this.sign*X))}}};ca.buildTopology=function(da,ha){da=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const fa=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let R=0;R<this.profile.numSegments;++R){const U=this.profile.vertexIndices[2*
R],Z=this.profile.vertexIndices[2*R+1],T=this.vertexBufferStart+this.profile.poleIndices[U],P=this.vertexBufferStart+this.profile.poleIndices[Z];let X=da+U,aa=da+Z;for(let ja=0;ja<this.numSegments-1;++ja){const ia=fa+ja*this.profile.vertices.length+U,ka=fa+ja*this.profile.vertices.length+Z;this.flip?(ha(ia,aa,X),ha(aa,ia,ka)):(ha(X,aa,ia),ha(ka,ia,aa));X=ia;aa=ka}this.flip?(ha(T,aa,X),T!==P&&ha(T,P,aa)):(ha(X,aa,T),T!==P&&ha(aa,P,T))}};return ba}(D),E=function(){function W(ca,da,ha,fa,R,U=x){this.options=
U;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=da;this.path=ca;this.extruder=ha;this.startCap=fa;this.endCap=R;ca=this.path.vertices.length-2;this.numExtrusionProfiles=ha.numProfilesPerJoin()*ca+2;this.numNormalsTotal=this.numVerticesTotal=da.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;da=this.startCap.getNumVertices();this.numVerticesTotal+=da;
this.numNormalsTotal+=da;this.endCap.vertexBufferStart=this.numVerticesTotal;da=this.endCap.getNumVertices();this.numVerticesTotal+=da;this.numNormalsTotal+=da;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,
this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}var ba=W.prototype;ba.emitVertex=function(ca,da,ha,fa,R){this.profileRightAxisData[4*this._extrusionVertexCount]=da.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=da.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=da.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=da.up[0];this.profileUpAxisData[4*
this._extrusionVertexCount+1]=da.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=da.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=ha[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ha[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=fa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=fa[1];this.pathVertexData[this._extrusionVertexCount]=ca;R?(ca=this.path.vertices[ca],this.profileRightAxisData[4*this._extrusionVertexCount+
3]=ca.rotationRight[0]*ca.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=ca.rotationRight[1]*ca.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};ba.emitCapVertex=function(ca,da,ha,fa,R,U){this.profileRightAxisData[4*this._extrusionVertexCount]=da.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=da.right[1];this.profileRightAxisData[4*
this._extrusionVertexCount+2]=da.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=da.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=da.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=da.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=ha[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ha[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=fa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+
3]=fa[1];this.pathVertexData[this._extrusionVertexCount]=ca;this.profileRightAxisData[4*this._extrusionVertexCount+3]=R;this.profileUpAxisData[4*this._extrusionVertexCount+3]=U;++this._extrusionVertexCount};ba.emitTriangle=function(ca,da,ha){this.vertexIndices[3*this._triangleCount]=ca;this.vertexIndices[3*this._triangleCount+1]=da;this.vertexIndices[3*this._triangleCount+2]=ha;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[ca];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[da];
this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[ha];this.normalIndices[3*this._triangleCount]=ca;this.normalIndices[3*this._triangleCount+1]=da;this.normalIndices[3*this._triangleCount+2]=ha;++this._triangleCount};ba.rebuildGeometry=function(){var ca=(fa,R,U,Z,T)=>this.emitVertex(fa,R,U,Z,T);const da=(fa,R,U,Z,T,P)=>this.emitCapVertex(fa,R,U,Z,T,P);this._extrusionVertexCount=0;for(var ha of this.path.vertices)this.originData[3*ha.index]=ha.pos[0],this.originData[3*ha.index+1]=
ha.pos[1],this.originData[3*ha.index+2]=ha.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,da);for(ha=1;ha<this.path.vertices.length-1;++ha)this.extruder.extrude(this.path.vertices[ha],this.profile,ca);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,da);this.startCap.rebuildCapGeometry(this.path.vertices[0],da);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],da);if(this.profile.hasUV()&&
this.options.generateUV)for(ca=0;ca<this.profile.uvs.length;++ca)this.uvData[2*ca]=this.profile.uvs[ca],this.uvData[2*ca+1]=0};ba.buildTopology=function(){const ca=(U,Z,T)=>this.emitTriangle(U,Z,T);this._triangleCount=0;const da=this.profile.vertices.length,ha=this.profile.numSegments,fa=this.numExtrusionProfiles-1;var R=ha*fa*6;this.startCap.indexBufferStart=R;this.startCap.firstProfileVertexIndex=0;R+=this.startCap.getNumIndices();this.endCap.indexBufferStart=R;this.endCap.firstProfileVertexIndex=
da*(this.numExtrusionProfiles-1);R+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(R);this.normalIndices=new Uint32Array(R);this.pathVertexIndices=new Uint32Array(R);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(R));for(R=0;R<ha;++R){const U=this.profile.vertexIndices[2*R],Z=this.profile.vertexIndices[2*R+1];for(let T=0;T<fa;++T){const P=T*da+U,X=(T+1)*da+Z,aa=T*da+Z;ca(P,(T+1)*da+U,X);ca(P,X,aa)}}this.startCap.buildTopology(this.path.vertices[0],ca);
this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],ca)};ba.onPathChanged=function(){this.rebuildGeometry()};return W}(),F=function(){function W(ba){this.builder=ba}W.prototype.onPathChanged=function(){this.builder.onPathChanged()};u._createClass(W,[{key:"xform",get:function(){return this.builder.path.xform}}]);return W}(),L=function(W){function ba(da){da=W.call(this,da)||this;da.vertexAttributePosition=null;da.vertexAttributeNormal=null;da.vertexAttributeColor=null;da.vertexAttributePosition=
new Float32Array(3*da.builder.numVerticesTotal);da.vertexAttributeNormal=new Float32Array(3*da.builder.numNormalsTotal);da.vertexAttributeColor=new Uint8Array(4);da.vertexAttributeColor[0]=255;da.vertexAttributeColor[1]=255;da.vertexAttributeColor[2]=255;da.vertexAttributeColor[3]=255;return da}u._inheritsLoose(ba,W);var ca=ba.prototype;ca.bakeVertexColors=function(da){this.vertexAttributeColor[0]=255*da[0];this.vertexAttributeColor[1]=255*da[1];this.vertexAttributeColor[2]=255*da[2];this.vertexAttributeColor[3]=
255*(3<da.length?da[3]:1)};ca.bake=function(da){this.size=da;for(let U=0;U<this.builder.numVerticesTotal;++U){var ha=this.builder.pathVertexData[U],fa=0===ha||ha===this.builder.path.vertices.length-1;ha*=3;var R=I;h.set(R,this.builder.originData[ha++],this.builder.originData[ha++],this.builder.originData[ha]);ha=4*U;const Z=J,T=G,P=M,X=O,aa=Q;let ja=0,ia=0;h.set(X,this.builder.profileRightAxisData[ha],this.builder.profileRightAxisData[ha+1],this.builder.profileRightAxisData[ha+2]);h.set(aa,this.builder.profileUpAxisData[ha],
this.builder.profileUpAxisData[ha+1],this.builder.profileUpAxisData[ha+2]);n.set(T,this.builder.profileVertexAndNormalData[ha]*da[0],this.builder.profileVertexAndNormalData[ha+1]*da[1]);if(fa)h.cross(P,aa,X),ja=this.builder.profileRightAxisData[ha+3]*da[0],ia=this.builder.profileUpAxisData[ha+3];else{fa=K;const ka=H;n.set(fa,this.builder.profileRightAxisData[ha+3],this.builder.profileUpAxisData[ha+3]);const na=n.length(fa);n.normalize(fa,fa);const ta=n.dot(T,fa);if(Math.abs(ta)>na){n.set(ka,-fa[1],
fa[0]);const pa=n.dot(T,ka);n.scale(fa,fa,na*f.sign(ta));n.scale(ka,ka,pa);n.add(T,fa,ka)}h.set(P,0,0,0)}h.set(Z,X[0]*T[0]+aa[0]*T[1],X[1]*T[0]+aa[1]*T[1],X[2]*T[0]+aa[2]*T[1]);this.vertexAttributePosition[3*U]=R[0]+Z[0]+P[0]*ja;this.vertexAttributePosition[3*U+1]=R[1]+Z[1]+P[1]*ja;this.vertexAttributePosition[3*U+2]=R[2]+Z[2]+P[2]*ja;R=G;n.set(R,this.builder.profileVertexAndNormalData[ha+2],this.builder.profileVertexAndNormalData[ha+3]);this.vertexAttributeNormal[3*U]=X[0]*R[0]+aa[0]*R[1]+P[0]*ia;
this.vertexAttributeNormal[3*U+1]=X[1]*R[0]+aa[1]*R[1]+P[1]*ia;this.vertexAttributeNormal[3*U+2]=X[2]*R[0]+aa[2]*R[1]+P[2]*ia}};ca.createGeometryData=function(){const da=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],ha=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(da.push(["color",new Uint32Array(this.builder.vertexIndices.length)]),ha.push(["color",
{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:ha,indices:da}};ca.onPathChanged=function(){W.prototype.onPathChanged.call(this);this.bake(this.size)};ca.intersect=function(da,ha,fa){const R=this.builder.vertexIndices;r.intersectTriangles(da,ha,0,R.length/3,R,{size:3,data:this.vertexAttributePosition},void 0,void 0,fa)};return ba}(F),N=function(W){function ba(ca,da,ha,fa){var R=W.call(this,ca)||this;R.sizeAttributeValue=da;R.colorAttributeValue=ha;R.opacityAttributeValue=fa;R.vvData=
null;R.baked=new L(ca);R.vvData=new Float32Array(4*R.builder.path.vertices.length);for(ca=0;ca<R.builder.path.vertices.length;++ca)R.vvData[4*ca]=da,R.vvData[4*ca+1]=ha,R.vvData[4*ca+2]=fa,R.vvData[4*ca+3]=0===ca||ca===R.builder.path.vertices.length-1?1:0;return R}u._inheritsLoose(ba,W);ba.prototype.createGeometryData=function(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",
{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}};return ba}(F);const I=k.create(),G=b.create(),K=
b.create(),H=b.create(),J=k.create(),M=k.create(),O=k.create(),Q=k.create(),S=k.create(),V=c(),Y=e.create();a.Builder=E;a.CapBuilder=D;a.Extruder=function(){};a.FastUpdatePathGeometry=N;a.MiterExtruder=y;a.NoCapBuilder=C;a.Path=A;a.PathGeometryData=F;a.PathVertex=d;a.Profile=g;a.RoundCapBuilder=v;a.SimpleExtruder=q;a.StaticPathGeometry=L;a.TriangulationCapBuilder=B;a.computeMinimumRotationTangentFrame=function(W,ba){let ca=null;const da=W.vertices.length,ha=k.create(),fa=k.create(),R=k.create(),U=
k.create(),Z=k.create(),T=k.create(),P=l.create();let X=W.vertices[0];h.copy(fa,ba);h.set(ha,0,1,0);z.makeOrthoBasisDirUpFallback(X.vRight,fa,ha,ha,R,fa,.99619469809);h.copy(X.frame.up,fa);h.copy(X.frame.right,R);ca=X;for(ba=1;ba<da;++ba){X=W.vertices[ba];h.add(Z,X.vLeft,X.vRight);let aa=h.length(Z);0<aa?(aa=1/Math.sqrt(aa),Z[0]*=aa,Z[1]*=aa,Z[2]*=aa):(Z[0]=X.vRight[0],Z[1]=X.vRight[1],Z[2]=X.vRight[2]);h.add(T,ca.pos,ca.frame.up);l.fromPositionAndNormal(X.pos,Z,P);l.intersectRay(P,m.wrap(T,X.vLeft),
U)?(h.subtract(U,U,X.pos),h.normalize(fa,U),h.cross(R,Z,fa),h.normalize(R,R)):z.makeOrthoBasisDirUpFallback(Z,ca.frame.up,ca.frame.right,ha,R,fa,.99619469809);h.copy(X.frame.up,fa);h.copy(X.frame.right,R);ca=X}};a.makeFrame=c;a.profileSpaceToVertexSpace=function(W,ba,ca){W[0]=ca[0]*ba.right[0]+ca[1]*ba.up[0];W[1]=ca[0]*ba.right[1]+ca[1]*ba.up[1];W[2]=ca[0]*ba.right[2]+ca[1]*ba.up[2]};a.vertexSpaceToProfileSpace=function(W,ba,ca){n.set(W,h.dot(ca,ba.right),h.dot(ca,ba.up))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function u(){return[1,0,0,1]}function f(e){return[e[0],e[1],e[2],e[3]]}function p(e,n,b,h){return[e,n,b,h]}function t(e,n){return new Float64Array(e,n,4)}var w=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t});a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat2f64=w})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){const d=l.assert;l=function(y){function x(C){C=y.call(this,C,A)||this;C.supportsEdges=!0;C._vertexAttributeLocations=m.pathVertexAttributeLocations;C.techniqueConfig=new m.PathTechniqueConfiguration;C.vertexBufferLayout=x.getVertexBufferLayout(C.params);return C}u._inheritsLoose(x,y);var D=x.prototype;D.getTechniqueConfig=function(C,B){this.techniqueConfig.output=C;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;if(0===C||7===C)this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,
this.techniqueConfig.receiveSSAO=B&&B.ssaoEnabled?this.params.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=B?B.transparencyPassType:3;this.techniqueConfig.multipassTerrainEnabled=B?B.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=B?B.cullAboveGround:!1;return this.techniqueConfig};D.getPassParameters=function(){return this.params};D.isVisibleInPass=function(C){return 4===C||6===C||7===C?this.params.castShadows:!0};D.isVisible=function(){const C=this.params;return y.prototype.isVisible.call(this)?
0<C.opacity:!1};D.intersect=function(C,B,v,E,F,L,N){if(k.isPathGeometry(C)){B=C.path;v=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var I=this.params.vvSizeOffset,G=this.params.vvSizeFactor;const K=this.params.vvSizeMinSize,H=this.params.vvSizeMaxSize,J=B.sizeAttributeValue;v[0]*=f.clamp(I[0]+J*G[0],K[0],H[0]);v[1]*=f.clamp(I[2]+J*G[2],K[2],H[2])}I=Math.max(v[0],v[1]);C=C.boundingInfo;p.isNone(C)?this._intersectTriangles(B,v,F,L,N):(C=t.fromValues(C.bbMin[0]-I,C.bbMin[1]-
I,C.bbMin[2]-I,C.bbMax[0]+I,C.bbMax[1]+I,C.bbMax[2]+I),I=[L[0]-F[0],L[1]-F[1],L[2]-F[2]],G=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]),c.intersectAabbInvDir(C,F,[G/I[0],G/I[1],G/I[2]],E.tolerance)&&this._intersectTriangles(B,v,F,L,N))}};D._intersectTriangles=function(C,B,v,E,F){C.baked.size&&C.baked.size[0]===B[0]&&C.baked.size[1]===B[1]||C.baked.bake(B);C.baked.intersect(v,E,F)};D.computeAttachmentOrigin=function(C,B){C=C.vertexAttributes;if(!C)return null;C=C.get("position");return n.computeAttachmentOriginLines(C,
null,!1,B)};D.createBufferWriter=function(){return new q(this.vertexBufferLayout)};D.getGLMaterial=function(C){if(0===C.output||7===C.output||1===C.output||2===C.output||4===C.output||3===C.output&&this.params.castShadows)return new g(C)};x.getVertexBufferLayout=function(C){let B=e.newLayout().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");if(C.vvColorEnabled||C.vvSizeEnabled||C.vvOpacityEnabled)B=B.vec4f("featureValue");return B};return x}(h.Material);
let g=function(y){function x(C){C=y.call(this,C)||this;C.updateParameters();return C}u._inheritsLoose(x,y);var D=x.prototype;D.updateParameters=function(C){this._technique=this._techniqueRep.releaseAndAcquire(m.PathTechnique,this._material.getTechniqueConfig(this._output,C),this._technique)};D.beginSlot=function(C){return C===(this._technique.configuration.transparent?5:3)};D._updateOccludeeState=function(C){C.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:C.hasOccludees})};
D._updateShadowState=function(C){C.shadowMappingEnabled!==this._technique.configuration.receiveShadows&&this._material.setParameterValues({receiveShadows:C.shadowMappingEnabled})};D.ensureParameters=function(C){if(0===this._output||7===this._output)this._updateShadowState(C),this._updateOccludeeState(C);this.updateParameters(C)};D.bind=function(C){this._technique.bindPass(this._material.getPassParameters(),C)};return x}(b);const A={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,
0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...z.Default,...h.materialParametersDefaults};let q=function(){function y(D){this.vertexBufferLayout=D}var x=y.prototype;x.allocate=function(D){return this.vertexBufferLayout.createBuffer(D)};x.elementCount=function(D){return D.indices.get("position").length};x.write=function(D,C,B,v){const E=F=>{if(C.vertexAttributes.has(F)){const L=C.vertexAttributes.get(F),
N=C.indices.get(F);d(4===L.size);const I=B.getField(F,w.BufferViewVec4f);if(I)r.writeBufferVec4(N,L.data,I,v);else throw Error("unable to acquire view for "+F);}};E("profileRight");E("profileUp");E("profileVertexAndNormal");this.vertexBufferLayout.hasField("featureValue")&&E("featureValue");r.writeDefaultAttributes(C,this.vertexBufferLayout,D.transformation,D.invTranspTransformation,B,v)};return y}();a.PathMaterial=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){const A=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);l=function(q){function y(){return q.apply(this,arguments)||this}f._inheritsLoose(y,q);var x=y.prototype;x.initializeProgram=function(D){var C=y.shader.get();const B=this.configuration;C=C.build({OITEnabled:0===B.transparencyPassType,output:B.output,viewingMode:D.viewingMode,slicePlaneEnabled:B.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!1,receiveShadows:B.receiveShadows,vvSize:B.vvSize,vvColor:B.vvColor,vvInstancingEnabled:!0,vvOpacity:B.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:B.receiveSSAO,doubleSidedMode:B.doubleSidedMode,multipassTerrainEnabled:B.multipassTerrainEnabled,cullAboveGround:B.cullAboveGround});return new r.Program(D.rctx,C,A)};x.bindPass=function(D,C){var B,v;h.bindProjectionMatrix(this.program,C.camera.projectionMatrix);this.program.setUniform3fv("size",
D.size);C.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",C.camera.nearFar),this.program.setUniform2fv("inverseViewport",C.inverseViewport),n.bindMultipassTerrainTexture(this.program,C));0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",D.opacity);0===this.configuration.output?(C.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",D.ambient),this.program.setUniform3fv("diffuse",D.diffuse),this.program.setUniform3fv("specular",
D.specular),this.program.setUniform1f("opacity",D.opacity)):1!==this.configuration.output&&3!==this.configuration.output||h.bindNearFar(this.program,C.camera.nearFar);w.setVVUniforms(this.program,D);null==(B=C.shadowMap)?void 0:B.bind(this.program);null==(v=C.ssaoHelper)?void 0:v.bind(this.program)};x.bindDraw=function(D){h.bindView(this.program,D);t.bindSliceUniformsWithOrigin(this.program,this.configuration,D);this.program.rebindTextures();0!==this.configuration.output&&7!==this.configuration.output||
h.bindCameraPosition(this.program,D.origin,D.camera.viewInverseTransposeMatrix);0===this.configuration.output&&b.bindReadShadowMapView(this.program,D);2===this.configuration.output&&e.VertexNormal.bindUniforms(this.program,D.camera.viewInverseTransposeMatrix)};x.setPipelineState=function(D){const C=this.configuration,B=3===D,v=2===D;return g.makePipelineState({blending:0!==C.output&&7!==C.output||!C.transparent?null:B?z.blendingDefault:z.OITBlending(D),culling:(C.slicePlaneEnabled?!1:!C.transparent&&
0!==C.doubleSidedMode)&&g.frontFaceCullingParams,depthTest:{func:z.OITDepthTest(D)},depthWrite:B||v?g.defaultDepthWriteParams:null,colorWrite:g.defaultColorWriteParams,stencilWrite:C.sceneHasOcludees?c.stencilWriteMaskOn:null,stencilTest:C.sceneHasOcludees?c.stencilBaseAllZerosParams:null,polygonOffset:B||v?null:z.OITPolygonOffset})};x.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return y}(l.ShaderTechnique);l.shader=new k.ReloadableShaderModule(d.PathShader,
()=>new Promise(function(q,y){a(["../shaders/Path.glsl"],q,y)}));k=function(q){function y(){var x=q.apply(this,arguments)||this;x.output=0;x.doubleSidedMode=0;x.receiveShadows=!1;x.receiveSSAO=!1;x.vvSize=!1;x.vvColor=!1;x.vvOpacity=!1;x.slicePlaneEnabled=!1;x.transparent=!1;x.sceneHasOcludees=!1;x.transparencyPassType=3;x.multipassTerrainEnabled=!1;x.cullAboveGround=!1;return x}f._inheritsLoose(y,q);return y}(m.ShaderTechniqueConfiguration);p.__decorate([m.parameter({count:8})],k.prototype,"output",
void 0);p.__decorate([m.parameter({count:3})],k.prototype,"doubleSidedMode",void 0);p.__decorate([m.parameter()],k.prototype,"receiveShadows",void 0);p.__decorate([m.parameter()],k.prototype,"receiveSSAO",void 0);p.__decorate([m.parameter()],k.prototype,"vvSize",void 0);p.__decorate([m.parameter()],k.prototype,"vvColor",void 0);p.__decorate([m.parameter()],k.prototype,"vvOpacity",void 0);p.__decorate([m.parameter()],k.prototype,"slicePlaneEnabled",void 0);p.__decorate([m.parameter()],k.prototype,
"transparent",void 0);p.__decorate([m.parameter()],k.prototype,"sceneHasOcludees",void 0);p.__decorate([m.parameter({count:4})],k.prototype,"transparencyPassType",void 0);p.__decorate([m.parameter()],k.prototype,"multipassTerrainEnabled",void 0);p.__decorate([m.parameter()],k.prototype,"cullAboveGround",void 0);u.PathTechnique=l;u.PathTechniqueConfiguration=k;u.pathVertexAttributeLocations=A;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports",
"./PositionAttribute.glsl","../../shaderModules/interfaces"],function(a,u,f){a.PathVertexPosition=function(p,t){p.attributes.add("featureValue","vec4");p.vertex.code.add(f.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);p.vertex.uniforms.add("size","vec3");t.vvSize?(p.vertex.uniforms.add("vvSizeMinSize","vec3"),p.vertex.uniforms.add("vvSizeMaxSize","vec3"),p.vertex.uniforms.add("vvSizeOffset","vec3"),p.vertex.uniforms.add("vvSizeFactor","vec3"),p.vertex.code.add(f.glsl`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):p.vertex.code.add(f.glsl`vec2 getSize(){
return size.xy;
}`);t.vvOpacity?(p.vertex.constants.add("vvOpacityNumber","int",8),p.vertex.code.add(f.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):p.vertex.code.add(f.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);t.vvColor?(p.vertex.constants.add("vvColorNumber","int",8),p.vertex.code.add(f.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):p.vertex.code.add(f.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);p.include(u.PositionAttribute);p.attributes.add("profileRight","vec4");p.attributes.add("profileUp","vec4");p.attributes.add("profileVertexAndNormal","vec4");p.vertex.code.add(f.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);p.vertex.code.add(f.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);p.vertex.code.add(f.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);p.vertex.code.add(f.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.setVVUniforms=function(p,t){t.vvSizeEnabled&&(p.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),p.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),p.setUniform3fv("vvSizeOffset",t.vvSizeOffset),p.setUniform3fv("vvSizeFactor",t.vvSizeFactor));t.vvColorEnabled&&(p.setUniform1fv("vvColorValues",t.vvColorValues),p.setUniform4fv("vvColorColors",t.vvColorColors));t.vvOpacityEnabled&&(p.setUniform1fv("vvOpacityValues",t.vvOpacityValues),p.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){function g(q){const y=new d.ShaderBuilder;y.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");y.varyings.add("vpos","vec3");y.include(t.PathVertexPosition,q);if(0===q.output||7===q.output)y.include(p.Transform,{linearDepth:!1}),q.receiveShadows&&y.include(z.ReadShadowMap,q),y.include(u.ForwardLinearDepth,q),y.varyings.add("vnormal","vec3"),y.varyings.add("vcolor","vec4"),q.multipassTerrainEnabled&&y.varyings.add("depth",
"float"),y.vertex.code.add(c.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${q.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===q.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);q.multipassTerrainEnabled&&(y.fragment.include(n.ReadLinearDepth),y.include(k.multipassTerrainTest,q));7===q.output&&(y.include(f.Slice,q),y.fragment.uniforms.add("camPos","vec3"),y.fragment.uniforms.add("localOrigin","vec3"),y.fragment.uniforms.add("opacity","float"),y.fragment.code.add(c.glsl`
      void main() {
        discardBySlice(vpos);
        ${q.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));0===q.output&&(y.include(f.Slice,q),y.include(h.EvaluateSceneLighting,q),y.include(b.EvaluateAmbientOcclusion,q),q.receiveShadows&&y.include(z.ReadShadowMap,q),y.include(l.Normals,q),y.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),y.fragment.include(r.ColorConversion),y.fragment.code.add(c.glsl`
      void main() {
        discardBySlice(vpos);
        ${q.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${q.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===q.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${q.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===q.output||3===q.output)y.include(p.Transform,{linearDepth:!0}),y.vertex.uniforms.add("nearFar","vec2"),y.varyings.add("depth","float"),y.vertex.code.add(c.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),y.include(f.Slice,q),y.include(w.OutputDepth,q),y.fragment.uniforms.add("timeElapsed","float"),y.fragment.code.add(c.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);2===q.output&&(y.include(p.Transform,{linearDepth:!1}),y.include(m.NormalUtils,q),y.vertex.uniforms.add("viewNormal","mat4"),y.varyings.add("vnormal","vec3"),y.vertex.code.add(c.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),y.include(f.Slice,q),y.fragment.uniforms.add("waterColor","vec4"),y.fragment.code.add(c.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));4===q.output&&(y.include(p.Transform,{linearDepth:!1}),y.include(m.NormalUtils,q),y.vertex.uniforms.add("viewNormal","mat4"),y.varyings.add("vnormal","vec3"),y.vertex.code.add(c.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),y.include(f.Slice,q),y.include(e.OutputHighlight),y.fragment.code.add(c.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return y}var A=Object.freeze({__proto__:null,build:g});a.PathShader=A;a.build=g})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v){const E=["polyline","polygon","extent"];r=function(I){function G(H,J,M,O){H=I.call(this,H,J,M,O)||this;H._needsUV=!1;H._hasOutline=!1;return H}u._inheritsLoose(G,I);var K=G.prototype;K.doLoad=function(){var H=u._asyncToGenerator(function*(){});return function(){return H.apply(this,arguments)}}();K.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};K.ensureFillMaterial=function(){if(!p.isSome(this._material)){var H=
p.get(this.symbolLayer,"material","color");H=this._getCombinedOpacityAndColor(H);this._material=A.createMaterial(this.symbolLayer,{color:H,transparent:1>H[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof B.PatternMaterial;this._context.stage.add(this._material)}};K.ensureOutlineMaterial=function(){const H=this.symbolLayer.outline;!p.isSome(this._outlineMaterial)&&
this._isValidOutline(H)&&(this._hasOutline=!0,this._outlineMaterial=(J=>{const M=H.stipplePattern?D.createStipplePattern(H.stipplePattern.map(t.pt2px)):null,O=H.stippleOffColor?f.toUnitRGBA(H.stippleOffColor):null;return 1.5<J?new v.RibbonLineMaterial({width:J,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:M,stippleIntegerRepeats:!0,stippleOffColor:O}):new C.NativeLineMaterial({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,
width:J,stipplePattern:M,stippleIntegerRepeats:!0,stippleOffColor:O})})(t.pt2px(H.size)),this._context.stage.add(this._outlineMaterial))};K._isValidOutline=function(H){return p.isSome(H)&&H.size&&0<H.size&&p.isSome(H.color)};K.destroy=function(){I.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};K.createGraphics3DGraphic=function(H){const J=H.graphic;if(!this._validateGeometry(J.geometry,
E,this.symbolLayer.type))return null;H=this._getVertexOpacityAndColor(H.renderingInfo,255);const M=this.setGraphicElevationContext(J,new l.ElevationContext);this.ensureDrapedStatus("on-the-ground"===M.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(J,H):this._createAs3DShape(J,H,M)};K.layerOpacityChanged=function(){if(p.isSome(this._material)){var H=this._material.params.color,J=p.get(this.symbolLayer,"material","color");J=this._getCombinedOpacity(J);this._material.setParameterValues({color:[H[0],
H[1],H[2],J],transparent:1>J||this.needsDrivenTransparentPass})}p.isSome(this._outlineMaterial)&&(H=this._outlineMaterial.params.color,this._outlineMaterial.setParameterValues({color:[H[0],H[1],H[2],this._getOutlineOpacity()]}));return!0};K.layerElevationInfoChanged=function(H,J,M){const O=this._elevationContext.mode;M=k.elevationModeChangeUpdateType(G.elevationModeChangeTypes,M,O);if(M!==k.SymbolUpdateType.UPDATE)return M;const Q=k.needsElevationUpdates2D(O);return this.updateGraphics3DGraphicElevationInfo(H,
J,()=>Q)};K.slicePlaneEnabledChanged=function(){p.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});p.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};K.physicalBasedRenderingChanged=function(){return!0};K.pixelRatioChanged=function(){return!0};K._createAs3DShape=function(H,J,M){const O=g.geometryAsPolygon(H.geometry);if(p.isNone(O))return null;L.renderData=
g.geometryToRenderInfo(O,this._context.elevationProvider,this._context.renderCoordsHelper,M);L.color=J;J=L.renderData.position.length/3;this._needsUV&&(L.uvMapSpace=new Float32Array(4*J),L.boundingRect=new Float64Array(9*J));L.outNum=0;L.outGeometries=[];L.outTransforms=[];L.outMaterials=[];this._createAs3DShapeFill(L);this._hasOutline&&this._createAs3DShapeOutline(L);this._logGeometryCreationWarnings(L.renderData,O.rings,"rings","FillSymbol3DLayer");if(0===L.outNum)return null;this._needsUV&&q.createMapSpaceUVCoords(h.BufferViewVec4f.fromTypedArray(L.uvMapSpace),
h.BufferViewVec3f64.fromTypedArray(L.renderData.position),this._context.renderCoordsHelper,h.BufferViewMat3f64.fromTypedArray(L.boundingRect));H=new y.Object3D({geometries:L.outGeometries,materials:L.outMaterials,transformations:L.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:H.uid}});H=new z.Graphics3DObject3DGraphicLayer(this,H,L.outGeometries,null,null,A.uvElevationAligner,M);H.alignedSampledElevation=L.renderData.sampledElevation;H.needsElevationUpdates=k.needsElevationUpdates2D(M.mode);
return H};K._createAs3DShapeFill=function(H){var J=H.renderData.polygons;for(const {position:M,mapPosition:O,holeIndices:Q,index:S,count:V}of J){if(p.isSome(this._context.clippingExtent)&&(b.empty(F),b.expandWithBuffer(F,O),!b.intersectsClippingArea(F,this._context.clippingExtent)))continue;J=w.earcut(O,Q,3);0!==J.length&&(J=new Uint32Array(J),J=g.createColorGeometry({indices:J,attributeData:{position:M,color:H.color,mapPosition:O,uvMapSpace:this._needsUV?new Float32Array(H.uvMapSpace.buffer,4*S*
H.uvMapSpace.BYTES_PER_ELEMENT,4*V):null,boundingRect:this._needsUV?new Float64Array(H.boundingRect.buffer,9*S*H.boundingRect.BYTES_PER_ELEMENT,9*V):null}}),H.outGeometries.push(J),H.outMaterials.push(p.unwrap(this._material)),H.outTransforms.push(e.IDENTITY),H.outNum++)}};K._createAs3DShapeOutline=function(H){if(this._hasOutline){var J=H.renderData.outlines,M=this._outlineMaterial instanceof C.NativeLineMaterial;for(let O=0;O<J.length;++O){const {mapPosition:Q,position:S}=J[O];if(p.isSome(this._context.clippingExtent)&&
(b.empty(F),b.expandWithBuffer(F,Q),!b.intersectsClippingArea(F,this._context.clippingExtent)))continue;const V=d.createGeometry({removeDuplicateStartEnd:M?0:1,attributeData:{position:S,mapPosition:Q}}),Y=V.vertexAttributes.get("position");Y.data===S&&(Y.data=new Float64Array(S));H.outGeometries.push(V);H.outMaterials.push(p.unwrap(this._outlineMaterial));H.outTransforms.push(e.IDENTITY);H.outNum++}}};K._createAsOverlay=function(H,J){const M=g.geometryAsPolygon(H.geometry);if(p.isNone(M))return null;
p.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;p.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);N.renderData=g.geometryToRenderInfoDraped(M,this._context.overlaySR);N.color=J;J=N.renderData.position.length/3;this._needsUV&&(N.uvMapSpace=new Float32Array(4*J));N.outNum=0;N.outGeometries=[];N.outBoundingBox=b.empty();N.layerUid=this._context.layer.uid;N.graphicsUid=H.uid;this._createAsOverlayFill(N);this._hasOutline&&
this._createAsOverlayOutline(N);this._logGeometryCreationWarnings(N.renderData,M.rings,"rings","FillSymbol3DLayer");if(0===N.outNum)return null;this._needsUV&&q.createMapSpaceUVCoordsDraped(h.BufferViewVec4f.fromTypedArray(N.uvMapSpace),h.BufferViewVec3f64.fromTypedArray(N.renderData.position),this._context.overlaySR);return 0<N.outNum?new m(this,N.outGeometries,N.outBoundingBox):null};K._createAsOverlayFill=function(H){var J=H.renderData.polygons;for(const {position:M,holeIndices:O,index:Q,count:S}of J){b.empty(F);
b.expandWithBuffer(F,M);if(!b.intersectsClippingArea(F,this._context.clippingExtent))continue;J=w.earcut(M,O,3);if(0===J.length)continue;b.expandWithAABB(H.outBoundingBox,F);J=new Uint32Array(J);J=g.createColorGeometry({indices:J,attributeData:{position:M,color:H.color,uvMapSpace:this._needsUV?new Float32Array(H.uvMapSpace.buffer,4*Q*H.uvMapSpace.BYTES_PER_ELEMENT,4*S):null}});J=new x.RenderGeometry(J,p.unwrap(this._material),H.layerUid,H.graphicsUid);const V=F;n.set(J.boundingSphere,.5*(V[0]+V[3]),
.5*(V[1]+V[4]),0,.5*Math.sqrt((V[3]-V[0])*(V[3]-V[0])+(V[4]-V[1])*(V[4]-V[1])));H.outGeometries.push(J);H.outNum++}};K._createAsOverlayOutline=function(H){if(this._hasOutline){var J=H.renderData.outlines;for(let O=0;O<J.length;++O){var {position:M}=J[O];b.empty(F);b.expandWithBuffer(F,M);if(!b.intersectsClippingArea(F,this._context.clippingExtent))continue;b.expandWithAABB(H.outBoundingBox,F);M=d.createGeometry({removeDuplicateStartEnd:this._outlineMaterial instanceof C.NativeLineMaterial?0:1,attributeData:{position:M}});
M=new x.RenderGeometry(M,p.unwrap(this._outlineMaterial),H.layerUid,H.graphicsUid);const Q=F;n.set(M.boundingSphere,.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0,.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1])));H.outGeometries.push(M);H.outNum++}}};K._getOutlineOpacity=function(){const H=p.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(p.isSome(H)?H.a:0)};K._getOutlineColor=function(){const H=p.get(this.symbolLayer,"outline","color"),J=this._getOutlineOpacity();
return c.mixinColorAndOpacity(p.isSome(H)?f.toUnitRGB(H):null,J)};u._createClass(G,[{key:"test",get:function(){return{createAsOverlay:(H,J)=>this._createAsOverlay(H,J),createAs3DShape:(H,J,M)=>this._createAs3DShape(H,J,M)}}}]);return G}(r.Graphics3DSymbolLayer);r.elevationModeChangeTypes={definedChanged:k.SymbolUpdateType.RECREATE,staysOnTheGround:k.SymbolUpdateType.NONE,onTheGroundChanged:k.SymbolUpdateType.RECREATE};const F=b.create(),L={renderData:null,color:null,uvMapSpace:null,boundingRect:null,
outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},N={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=r;a.default=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b){function h(z,r,c){if(f.isSome(z)){if("none"===z.style||"solid"===z.style)return"none"===z.style&&(r.color=p.fromValues(0,0,0,0),r.transparent=!0),new n.ColorMaterial(r);r.style=k(z.style);r.draped=c.isDraped;return new b.PatternMaterial(r)}return new n.ColorMaterial(r)}function k(z){switch(z){case "horizontal":return 0;case "vertical":return 1;case "cross":return 2;case "forward-diagonal":return 3;case "backward-diagonal":return 4;case "diagonal-cross":return 5}}function l(z){return z.material instanceof
b.PatternMaterial&&!z.material.params.draped}function m(z,r){if(l(z)){var c=z.geometry.vertexAttributes;z=c.get("position").data;const d=c.get("uvMapSpace").data;c=c.get("boundingRect").data;e.createMapSpaceUVCoords(t.BufferViewVec4f.fromTypedArray(d),t.BufferViewVec3f64.fromTypedArray(z),r,t.BufferViewMat3f64.fromTypedArray(c))}}a.createMaterial=function(z,r,c){return h(z&&z.pattern||null,r,c)};a.createMaterialFromPattern=h;a.parsePatternStyle=k;a.requiresUVUpdates=l;a.updateMapSpaceUVCoords=m;a.uvElevationAligner=
function(z,r,c,d){r=w.perVertexElevationAligner(z,r,c,d);z=z.stageObject.geometryRecords;for(c=0;c<z.length;c++)m(z[c],d);return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(N,I,G,K,H,J,M){w.set(N,I*H[0]+G*J[0]+K*M[0],I*H[1]+G*J[1]+K*M[1],I*H[2]+G*J[2]+K*M[2])}const m=e.create(),z=e.create(),r=h.create(),c=e.create(),d=e.create(),g=e.create(),A=t.create(),q=t.create(),y=t.create(),x=e.create(),D=e.create(),C=e.create(),B=f.create(),v=e.create(),E=e.create(),F=e.create(),L=e.create();a.createMapSpaceUVCoords=function(N,I,G,K,H=1){w.set(c,1,0,0);w.set(d,0,1,0);w.set(g,0,0,1);w.set(L,0,0,0);for(var J=0;J<I.count-1;J++)I.getVec(J,
z),w.add(L,L,z);w.scale(m,L,1/(I.count-1));J=I.count-1;if(J=h.fromManyPointsSampleAt(I,r,0,Math.floor(J/3),Math.floor(2/3*J))){u.isSome(G)?(G.basisMatrixAtPosition(m,B),w.set(v,B[0],B[1],B[2]),w.set(E,B[4],B[5],B[6]),w.set(F,B[8],B[9],B[10])):(w.set(v,1,0,0),w.set(E,0,1,0),w.set(F,0,0,1));G=h.normal(r);0>w.dot(G,F)&&w.scale(G,G,-1);w.copy(g,G);J=w.dot(G,E);var M=w.dot(G,v);Math.abs(J)<Math.abs(M)?(w.scaleAndAdd(c,v,G,-M),w.normalize(c,c),w.cross(d,c,G),w.normalize(d,d),w.scale(d,d,-1)):(w.scaleAndAdd(d,
E,G,-J),w.normalize(d,d),w.cross(c,d,G),w.normalize(c,c))}p.set(A,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);p.set(q,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(G=0;G<I.count;G++)I.getVec(G,z),J=w.dot(c,z),M=w.dot(d,z),A[0]=Math.min(A[0],J),A[1]=Math.min(A[1],M),q[0]=Math.max(q[0],J),q[1]=Math.max(q[1],M);G=w.dot(g,m);l(x,A[0],A[1],G,c,d,g);l(D,q[0],A[1],G,c,d,g);l(C,A[0],q[1],G,c,d,g);w.subtract(D,D,x);w.scale(D,D,.5);w.subtract(C,C,x);w.scale(C,C,.5);w.add(x,x,D);w.add(x,x,C);
G=A[1]%H;y[0]=A[0]-A[0]%H;y[1]=A[1]-G;for(G=0;G<I.count;G++)for(I.getVec(G,z),N.setValues(G,(w.dot(c,z)-y[0])/H,(w.dot(d,z)-y[1])/H,y[0]/H,y[1]/H),J=0;3>J;J++)K.set(G,J,x[J]),K.set(G,J+3,D[J]),K.set(G,J+6,C[J])};a.createMapSpaceUVCoordsDraped=function(N,I,G,K=1){if(G.isGeographic){const H=new Float64Array(I.typedBuffer.length),J=3*I.count;for(let M=0;M<J;M+=3)n.lonLatToWebMercatorComparable(I.typedBuffer,M,H,M,b.getReferenceEllipsoid(G));I=k.BufferViewVec3f64.fromTypedArray(H)}p.set(A,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY);for(G=0;G<I.count;G++)I.getVec(G,z),A[0]=Math.min(A[0],z[0]),A[1]=Math.min(A[1],z[1]);G=A[1]%K;y[0]=A[0]-A[0]%K;y[1]=A[1]-G;for(G=0;G<I.count;G++)I.getVec(G,z),N.setValues(G,(z[0]-y[0])/K,(z[1]-y[1])/K,y[0]/K,y[1]/K)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique".split(" "),
function(a,u,f,p,t,w,e,n){let b=function(l){function m(r){r=l.call(this,r,k)||this;r.supportsEdges=!0;r.techniqueConfig=new n.ColorMaterialTechniqueConfiguration;return r}u._inheritsLoose(m,l);var z=m.prototype;z.getTechniqueConfig=function(r,c){this.techniqueConfig.output=r;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;
this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.transparencyPassType=c?c.transparencyPassType:3;this.techniqueConfig.enableOffset=c?c.camera.relativeElevation<t.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=c?c.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=c?c.cullAboveGround:!1;return this.techniqueConfig};
z.getPassParameters=function(){return this.params};z.intersect=function(r,c,d,g,A,q,y){e.intersectTriangleGeometry(r,c,g,A,q,void 0,y)};z.getGLMaterial=function(r){return 0===r.output||7===r.output||4===r.output||1===r.output&&this.params.writeLinearDepth?new h(r):void 0};z.createBufferWriter=function(){return new w.DefaultBufferWriter(w.PositionColorLayout)};return m}(p.Material),h=function(l){function m(r){r=l.call(this,r)||this;r.updateParameters();return r}u._inheritsLoose(m,l);var z=m.prototype;
z.updateParameters=function(r){this._technique=this._techniqueRep.releaseAndAcquire(n.ColorMaterialTechnique,this._material.getTechniqueConfig(this._output,r),this._technique)};z.beginSlot=function(r){return 4===this._output?3===r:r===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)};z._updateOccludeeState=function(r){r.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:r.hasOccludees})};z.ensureParameters=
function(r){0!==this._output&&7!==this._output||this._updateOccludeeState(r);this.updateParameters(r)};z.bind=function(r){this._technique.bindPass(this._material.getPassParameters(),r)};z.getPipelineState=function(r,c){return this._technique.getPipelineState(c)};return m}(f);const k={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...p.materialParametersDefaults};a.ColorMaterial=b;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){h=function(A){function q(){return A.apply(this,arguments)||this}f._inheritsLoose(q,A);var y=q.prototype;y.initializeProgram=function(x){var D=q.shader.get();const C=this.configuration;D=D.build({output:C.output,OITEnabled:0===C.transparencyPassType,attributeColor:C.vertexColors,slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:C.multipassTerrainEnabled,cullAboveGround:C.cullAboveGround});
return new z.Program(x.rctx,D,l.Default3D)};y.bindPass=function(x,D){n.bindProjectionMatrix(this.program,D.camera.projectionMatrix);this.program.setUniform4fv("eColor",x.color);4===this.configuration.output&&w.bindOutputHighlight(this.program,D);(1===this.configuration.output||D.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",D.camera.nearFar);D.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",D.inverseViewport),e.bindMultipassTerrainTexture(this.program,
D))};y.bindDraw=function(x){n.bindView(this.program,x);this.program.rebindTextures();t.bindSliceUniformsWithOrigin(this.program,this.configuration,x)};y.setPipelineState=function(x,D){const C=this.configuration,B=3===x,v=2===x;return d.makePipelineState({blending:0!==C.output&&7!==C.output||!C.transparent?null:B?m.blendingDefault:m.OITBlending(x),culling:d.cullingParams(C.cullFace),depthTest:{func:m.OITDepthTest(x)},depthWrite:B||v?C.writeDepth&&d.defaultDepthWriteParams:null,colorWrite:d.defaultColorWriteParams,
stencilWrite:C.sceneHasOcludees?r.stencilWriteMaskOn:null,stencilTest:C.sceneHasOcludees?D?r.stencilToolMaskBaseParams:r.stencilBaseAllZerosParams:null,polygonOffset:B||v?C.polygonOffset&&g:m.getOITPolygonOffset(C.enableOffset)})};y.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};y.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};
return q}(h.ShaderTechnique);h.shader=new b.ReloadableShaderModule(c.ColorMaterialShader,()=>new Promise(function(A,q){a(["./ColorMaterial.glsl"],A,q)}));const g={factor:1,units:1};b=function(A){function q(){var y=A.apply(this,arguments)||this;y.output=0;y.cullFace=0;y.slicePlaneEnabled=!1;y.vertexColors=!1;y.transparent=!1;y.polygonOffset=!1;y.enableOffset=!0;y.writeDepth=!0;y.sceneHasOcludees=!1;y.transparencyPassType=3;y.multipassTerrainEnabled=!1;y.cullAboveGround=!1;return y}f._inheritsLoose(q,
A);return q}(k.ShaderTechniqueConfiguration);p.__decorate([k.parameter({count:8})],b.prototype,"output",void 0);p.__decorate([k.parameter({count:3})],b.prototype,"cullFace",void 0);p.__decorate([k.parameter()],b.prototype,"slicePlaneEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"vertexColors",void 0);p.__decorate([k.parameter()],b.prototype,"transparent",void 0);p.__decorate([k.parameter()],b.prototype,"polygonOffset",void 0);p.__decorate([k.parameter()],b.prototype,"enableOffset",void 0);
p.__decorate([k.parameter()],b.prototype,"writeDepth",void 0);p.__decorate([k.parameter()],b.prototype,"sceneHasOcludees",void 0);p.__decorate([k.parameter({count:4})],b.prototype,"transparencyPassType",void 0);p.__decorate([k.parameter()],b.prototype,"multipassTerrainEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"cullAboveGround",void 0);u.ColorMaterialTechnique=h;u.ColorMaterialTechniqueConfiguration=b;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){function m(r){const c=new l.ShaderBuilder,d=1===r.output;c.include(f.Transform,{linearDepth:d});c.include(p.VertexColor,r);c.vertex.uniforms.add("proj","mat4").add("view","mat4");c.attributes.add("position","vec3");c.varyings.add("vpos","vec3");r.multipassTerrainEnabled&&c.varyings.add("depth","float");d&&(c.include(t.OutputDepth,r),c.vertex.uniforms.add("cameraNearFar","vec2"),c.varyings.add("linearDepth","float"));c.vertex.code.add(k.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${d?k.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);c.include(u.Slice,r);c.fragment.include(h.ColorConversion);r.multipassTerrainEnabled&&(c.fragment.include(e.ReadLinearDepth),c.include(n.multipassTerrainTest,r));c.fragment.uniforms.add("eColor","vec4");4===r.output&&c.include(w.OutputHighlight);c.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${r.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${r.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${k.glsl.float(b.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===r.output?k.glsl`gl_FragColor = vec4(color.a);`:""}

    ${0===r.output?k.glsl`gl_FragColor = highlightSlice(color, vpos); ${r.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===r.output?k.glsl`outputHighlight();`:""};
    ${1===r.output?k.glsl`outputDepth(linearDepth);`:""};
  }
  `);return c}var z=Object.freeze({__proto__:null,build:m});a.ColorMaterialShader=z;a.build=m})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){let m=function(d){function g(q){q=d.call(this,q,c)||this;q.supportsEdges=!0;q._vertexAttributeLocations=l.patternVertexAttributeLocations;q.techniqueConfig=new l.PatternTechniqueConfiguration;return q}u._inheritsLoose(g,d);var A=g.prototype;A.getTechniqueConfig=function(q,y){this.techniqueConfig.output=q;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;
this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.style=this.params.style;this.techniqueConfig.patternSpacing=this.params.patternSpacing;this.techniqueConfig.lineWidth=this.params.lineWidth;this.techniqueConfig.draped=this.params.draped;this.techniqueConfig.transparencyPassType=y?y.transparencyPassType:3;this.techniqueConfig.enableOffset=y?y.camera.relativeElevation<e.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=
y?y.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=y?y.cullAboveGround:!1;return this.techniqueConfig};A.getPassParameters=function(){return this.params};A.intersect=function(q,y,x,D,C,B,v){k.intersectTriangleGeometry(q,y,D,C,B,void 0,v)};A.getGLMaterial=function(q){return 0===q.output||7===q.output||4===q.output||1===q.output&&this.params.writeLinearDepth?new z(q):void 0};A.createBufferWriter=function(){const q=p.newLayout().vec3f("position").vec4u8("color").vec4f("uvMapSpace");
this.params.draped||q.mat3f("boundingRect");return new r(q)};return g}(w.Material),z=function(d){function g(q){q=d.call(this,q)||this;q.updateParameters();return q}u._inheritsLoose(g,d);var A=g.prototype;A.updateParameters=function(q){this._technique=this._techniqueRep.releaseAndAcquire(l.PatternTechnique,this._material.getTechniqueConfig(this._output,q),this._technique)};A.beginSlot=function(q){return 4===this._output?3===q:q===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?
5:8:3)};A._updateOccludeeState=function(q){q.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:q.hasOccludees})};A.ensureParameters=function(q){0!==this._output&&7!==this._output||this._updateOccludeeState(q);this.updateParameters(q)};A.bind=function(q){this._technique.bindPass(this._material.getPassParameters(),q)};A.getPipelineState=function(q,y){return this._technique.getPipelineState(y)};return g}(t),r=function(d){function g(){return d.apply(this,
arguments)||this}u._inheritsLoose(g,d);var A=g.prototype;A.write=function(q,y,x,D){for(const B of this.vertexBufferLayout.fieldNames){const v=y.vertexAttributes.get(B),E=y.indices.get(B);if(v&&E)switch(B){case "position":n.assert(3===v.size);var C=x.getField(B,f.BufferViewVec3f);C&&b.writePosition(E,v.data,q.transformation,C,D);break;case "color":n.assert(3===v.size||4===v.size);(C=x.getField(B,f.BufferViewVec4u8))&&b.writeColor(E,v.data,v.size,C,D);break;case "uvMapSpace":n.assert(4===v.size);(C=
x.getField(B,f.BufferViewVec4f))&&b.writeBufferVec4(E,v.data,C,D);break;case "boundingRect":n.assert(9===v.size),(C=x.getField(B,f.BufferViewMat3f))&&this.writeBoundingRect(E,v.data,q.transformation,C,D)}}};A.writeBoundingRect=function(q,y,x,D,C){const B=D.typedBuffer;D=D.typedBufferStride;const v=q.length;C*=D;for(let F=0;F<v;++F){const L=9*q[F];var E=y[L];const N=y[L+1],I=y[L+2];B[C]=x[0]*E+x[4]*N+x[8]*I+x[12];B[C+1]=x[1]*E+x[5]*N+x[9]*I+x[13];B[C+2]=x[2]*E+x[6]*N+x[10]*I+x[14];for(E=3;9>E;++E)B[C+
E]=y[L+E];C+=D}};return g}(h.DefaultBufferWriter);const c={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...w.materialParametersDefaults};a.PatternMaterial=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){h=function(A){function q(){return A.apply(this,arguments)||this}f._inheritsLoose(q,A);var y=q.prototype;y.initializeProgram=function(x){var D=q.shader.get();const C=this.configuration;D=D.build({output:C.output,attributeColor:C.vertexColors,slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:C.style,patternSpacing:C.patternSpacing,lineWidth:C.lineWidth,draped:C.draped,OITEnabled:0===C.transparencyPassType,
multipassTerrainEnabled:C.multipassTerrainEnabled,cullAboveGround:C.cullAboveGround});return new m.Program(x.rctx,D,g)};y.bindPass=function(x,D){n.bindProjectionMatrix(this.program,D.camera.projectionMatrix);this.program.setUniform4fv("matColor",x.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/D.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/D.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/D.camera.perScreenPixelRatio);
4===this.configuration.output&&w.bindOutputHighlight(this.program,D);(1===this.configuration.output||D.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",D.camera.nearFar);D.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",D.inverseViewport),e.bindMultipassTerrainTexture(this.program,D))};y.bindDraw=function(x){n.bindView(this.program,x);n.bindCameraPosition(this.program,x.origin,x.camera.viewInverseTransposeMatrix);t.bindSliceUniformsWithOrigin(this.program,
this.configuration,x);this.program.rebindTextures()};y.setPipelineState=function(x,D){const C=this.configuration,B=3===x,v=2===x;return c.makePipelineState({blending:0===C.output||7===C.output?C.transparent&&B?l.blendingDefault:l.OITBlending(x):null,culling:c.cullingParams(C.cullFace),depthTest:{func:l.OITDepthTest(x)},depthWrite:B?C.writeDepth&&c.defaultDepthWriteParams:l.OITDepthWrite(x),colorWrite:c.defaultColorWriteParams,stencilWrite:C.sceneHasOcludees?z.stencilWriteMaskOn:null,stencilTest:C.sceneHasOcludees?
D?z.stencilToolMaskBaseParams:z.stencilBaseAllZerosParams:null,polygonOffset:B||v?C.polygonOffset&&d:l.getOITPolygonOffset(C.enableOffset)})};y.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};y.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};return q}(h.ShaderTechnique);h.shader=new b.ReloadableShaderModule(r.PatternShader,
()=>new Promise(function(A,q){a(["./Pattern.glsl"],A,q)}));const d={factor:1,units:1};b=function(A){function q(){var y=A.apply(this,arguments)||this;y.output=0;y.cullFace=0;y.slicePlaneEnabled=!1;y.vertexColors=!1;y.transparent=!0;y.polygonOffset=!1;y.writeDepth=!0;y.sceneHasOcludees=!1;y.enableOffset=!0;y.transparencyPassType=3;y.multipassTerrainEnabled=!1;y.cullAboveGround=!1;return y}f._inheritsLoose(q,A);return q}(k.ShaderTechniqueConfiguration);p.__decorate([k.parameter({count:8})],b.prototype,
"output",void 0);p.__decorate([k.parameter({count:3})],b.prototype,"cullFace",void 0);p.__decorate([k.parameter()],b.prototype,"slicePlaneEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"vertexColors",void 0);p.__decorate([k.parameter()],b.prototype,"transparent",void 0);p.__decorate([k.parameter()],b.prototype,"polygonOffset",void 0);p.__decorate([k.parameter()],b.prototype,"writeDepth",void 0);p.__decorate([k.parameter()],b.prototype,"sceneHasOcludees",void 0);p.__decorate([k.parameter({count:6})],
b.prototype,"style",void 0);p.__decorate([k.parameter()],b.prototype,"patternSpacing",void 0);p.__decorate([k.parameter()],b.prototype,"lineWidth",void 0);p.__decorate([k.parameter()],b.prototype,"enableOffset",void 0);p.__decorate([k.parameter()],b.prototype,"draped",void 0);p.__decorate([k.parameter({count:4})],b.prototype,"transparencyPassType",void 0);p.__decorate([k.parameter()],b.prototype,"multipassTerrainEnabled",void 0);p.__decorate([k.parameter()],b.prototype,"cullAboveGround",void 0);const g=
new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]);u.PatternTechnique=h;u.PatternTechniqueConfiguration=b;u.patternVertexAttributeLocations=g;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){function m(c){const d=new l.ShaderBuilder;c.draped||d.extensions.add("GL_OES_standard_derivatives");const g=1===c.output;d.include(f.Transform,{linearDepth:g});d.include(p.VertexColor,c);d.vertex.uniforms.add("proj","mat4");d.vertex.uniforms.add("view","mat4");g&&(d.include(t.OutputDepth,c),d.vertex.uniforms.add("cameraNearFar","vec2"),d.varyings.add("linearDepth","float"));c.draped?d.vertex.uniforms.add("worldToScreenRatio","float"):(d.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),d.vertex.uniforms.add("camPos","vec3"),d.attributes.add("boundingRect","mat3"));d.attributes.add("position","vec3");d.attributes.add("uvMapSpace","vec4");d.varyings.add("vpos","vec3");d.varyings.add("vuv","vec2");c.multipassTerrainEnabled&&d.varyings.add("depth","float");const A=3===c.style||4===c.style||5===c.style;A&&d.vertex.code.add(k.glsl`
      const mat2 rotate45 = mat2(${k.glsl.float(.70710678118)}, ${k.glsl.float(-.70710678118)},
                                 ${k.glsl.float(.70710678118)}, ${k.glsl.float(.70710678118)});
    `);c.draped||(d.vertex.code.add(k.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),d.vertex.code.add(k.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),d.vertex.code.add(k.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${k.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `));d.vertex.code.add(k.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${A?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${A?" * rotate45":""};

      ${c.draped?k.glsl`
            float ratio = worldToScreenRatio;
          `:k.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;

            // Logarithmically discretize ratio to avoid jittering
            float step = 0.1;
            ratio = log(ratio);
            ratio = ceil(ratio / step) * step;
            ratio = exp(ratio);
          `}

      vec2 uvOffset = mod(uvCellOrigin * ratio, ${k.glsl.float(c.patternSpacing)});
      return uvOffset + (uv * ratio);
    }
  `);d.vertex.code.add(k.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${c.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${g?k.glsl`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);d.include(u.Slice,c);d.fragment.include(h.ColorConversion);d.fragment.uniforms.add("matColor","vec4");c.draped&&d.fragment.uniforms.add("texelSize","float");4===c.output&&d.include(w.OutputHighlight);c.multipassTerrainEnabled&&(d.fragment.include(e.ReadLinearDepth),d.include(n.multipassTerrainTest,c));4!==c.output&&(d.fragment.code.add(k.glsl`
      const float lineWidth = ${k.glsl.float(c.lineWidth)};
      const float spacing = ${k.glsl.float(c.patternSpacing)};
      const float spacingINV = ${k.glsl.float(1/c.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),c.draped||d.fragment.code.add(k.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));d.fragment.code.add(k.glsl`
    void main() {
      discardBySlice(vpos);
      ${c.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${c.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==c.output?k.glsl`color.a *= ${z(c)};`:""}

      if (color.a < ${k.glsl.float(b.symbolAlphaCutoff)}) {
        discard;
      }

      ${7===c.output?k.glsl`gl_FragColor = vec4(color.a);`:""}

      ${0===c.output?k.glsl`gl_FragColor = color; ${c.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===c.output?k.glsl`outputHighlight();`:""}
      ${1===c.output?k.glsl`outputDepth(linearDepth);`:""};
    }
  `);return d}function z(c){function d(g){return c.draped?k.glsl`coverage(vuv.${g}, texelSize)`:k.glsl`sample(vuv.${g})`}switch(c.style){case 3:case 0:return d("y");case 4:case 1:return d("x");case 5:case 2:return k.glsl`
        1.0 - (1.0 - ${d("x")}) * (1.0 - ${d("y")})
      `;default:return"0.0"}}var r=Object.freeze({__proto__:null,build:m});a.PatternShader=r;a.build=m})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){function A(D,C,B){D&&D.forEach(v=>{const E=C(v);p.isSome(E)&&B(E,v.graphic)})}const q=[0,0,1];l=function(D){function C(v,E,F,L){v=D.call(this,v,E,F,L)||this;v._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};v.ensureDrapedStatus(!1);return v}u._inheritsLoose(C,D);var B=C.prototype;B.doLoad=function(){var v=u._asyncToGenerator(function*(){if(!this._drivenProperties.size){const E=m.validateSymbolLayerSize(this.symbolLayer.size);if(E)throw new f("graphics3dtextsymbollayer:invalid-size",
E);}this._createTextRenderParameters()});return function(){return v.apply(this,arguments)}}();B._createTextRenderParameters=function(){this._textRenderParameters=c.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};B.destroy=function(){D.prototype.destroy.call(this)};B.createGraphics3DGraphic=function(v){v=v.graphic;const E=z.placePointOnGeometry(v.geometry);if(p.isNone(E))return this.logger.warn(`unsupported geometry type for text symbol: ${v.geometry.type}`),
null;const F=this.symbolLayer.text;if(!F)return null;const L=e.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(v,E,F,L)};B.createLabel=function(v,E,F,L){v=v.graphic;const N=z.placePointOnGeometry(v.geometry);if(p.isNone(N))return this.logger.warn(`unsupported geometry type for label: ${v.geometry.type}`),null;const I=E.text;return!I||/^\s+$/.test(I)?null:this._createAs3DShape(v,N,I,E,E,F,L)};B.setGraphicElevationContext=function(v,
E,F=0){v=D.prototype.setGraphicElevationContext.call(this,v,E);v.addOffsetRenderUnits(F);return v};B.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};B.layerElevationInfoChanged=function(v,E){A(v,E,(F,L)=>{this.updateGraphicElevationContext(L,F)});return b.SymbolUpdateType.UPDATE};B.slicePlaneEnabledChanged=function(v,E){A(v,E,F=>{for(const L of F.stageObject.geometryRecords)L.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});
return!0};B.physicalBasedRenderingChanged=function(){return!0};B.pixelRatioChanged=function(){return!1};B.updateGraphicElevationContext=function(v,E){this.setGraphicElevationContext(v,E.elevationContext,E.metadata.elevationOffset);E.needsElevationUpdates=b.needsElevationUpdates2D(E.elevationContext.mode)||"absolute-height"===E.elevationContext.mode};B._defaultElevationInfoNoZ=function(){return y};B._createAs3DShape=function(v,E,F,L,N=x,I,G){const K=this.setGraphicElevationContext(v,new h.ElevationContext,
N.elevationOffset);var H="polyline"===p.get(v.geometry,"type"),J=v.uid;v=this._context.stage.renderView.renderingContext;var M=m.namedAnchorToHUDMaterialAnchorPos[N.anchor in m.namedAnchorToHUDMaterialAnchorPos?N.anchor:"center"];v=p.isNone(G)?new d(v,F,this._textRenderParameters):null;M={occlusionTest:!0,screenOffset:N.screenOffset,anchorPos:M,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:N.centerOffsetUnits,debugDrawBorder:N.debugDrawBorder,drawInSecondSlot:!0};p.isSome(v)&&(M.textureId=v.id,
M.texCoordScale=v.texcoordScale);p.isSome(G)&&(M.textureId=G.id);if(p.isSome(L)&&p.isSome(L.verticalOffset)){const {screenLength:S,minWorldLength:V,maxWorldLength:Y}=L.verticalOffset;M.verticalOffset={screenLength:t.pt2px(S),minWorldLength:V||0,maxWorldLength:null!=Y?Y:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:S,screenSizePerspectiveSettingsLabels:V}=this._context.sharedResources;M.screenSizePerspective=V.overridePadding(this._textRenderParameters.haloSize);
M.screenSizePerspectiveAlignment=S}H&&(M.shaderPolygonOffset=1E-4);M.slicePlaneEnabled=this._context.slicePlaneEnabled;p.isSome(I)?(G=JSON.stringify(M),L=I.get(G),p.isNone(L)&&(L=new g.HUDMaterial(M),I.add(G,L))):L=new g.HUDMaterial(M);L=[L];G=N.translation;H=p.isSome(v)?[v.displayWidth,v.displayHeight]:[0,0];G=[r.createPointGeometry(q,G,null,H,N.centerOffset,[0,0],null)];J=z.createStageObjectForHUD(this._context,E,G,L,null,null,K,this._context.layer.uid,J);if(null===J)return null;H=n.perObjectElevationAligner;
I=new k.Graphics3DObject3DGraphicLayer(this,J.object,G,p.isNone(I)?L:null,p.isSome(v)?[v]:null,H,K);I.alignedSampledElevation=J.sampledElevation;I.needsElevationUpdates=b.needsElevationUpdates2D(K.mode)||"absolute-height"===K.mode;const {displayWidth:O,displayHeight:Q}=p.isSome(v)?v:N;I.getScreenSize=(S=w.create())=>{S[0]=O;S[1]=Q;return S};I.metadata={labelText:F,elevationOffset:N.elevationOffset};z.extendPointGraphicElevationContext(I,E,this._context.elevationProvider);return I};return C}(l.Graphics3DSymbolLayer);
const y={mode:"relative-to-ground",offset:0},x={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=l;a.default=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["exports","../../../../Color","../../../../core/maybe","../../../../core/screenUtils",
"../../../../chunks/vec4f64"],function(a,u,f,p,t){let w=function(){function e(b){this.definition=b;this.key=JSON.stringify(b);this.haloSize=Math.round(b.halo.size);this.fillStyle=this.colorToRGBA(b.color);this.haloStyle=this.colorToRGB(b.halo.color)}var n=e.prototype;n.colorToRGB=function(b){return`rgb(${b.slice(0,3).map(h=>Math.floor(255*h)).toString()})`};n.colorToRGBA=function(b){return`rgba(${b.slice(0,3).map(h=>Math.floor(255*h)).toString()},${b[3]})`};e.fromSymbol=function(b,h=1){var k=f.get(b,
"material","color");k=f.isSome(k)?u.toUnitRGBA(k):t.ZEROS;var l=b.halo;const m=null!=b.size?p.pt2px(b.size):12;b={family:b.font&&b.font.family?b.font.family:"sans-serif",weight:b.font&&b.font.weight?b.font.weight:"normal",style:b.font&&b.font.style?b.font.style:"normal"};l=f.isSome(l)&&f.isSome(l.color)&&0<l.size?{size:p.pt2px(l.size),color:u.toUnitRGBA(l.color)}:{size:0,color:t.ZEROS};return new e({size:m,color:k,font:b,halo:l,pixelRatio:h})};return e}();a.TextRenderParameters=w;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./ContentObject ./TextRenderer ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(a,u,f,p,t,w,e,n){const b={canvas:null};return function(h){function k(m,z,r){var c=h.call(this)||this;c.type=4;c._glTexture=null;c.events=new u;c._requiresPowerOfTwo=!n(m.gl);
c._renderer=new w.TextRenderer(z,r);return c}a._inheritsLoose(k,h);var l=k.prototype;l.createDescriptor=function(m){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:m.parameters.maxMaxAnisotropy}};l.load=function(m){if(p.isSome(this._glTexture))return this._glTexture;const z=w.getTextHelperCanvas(b,this.textureWidth,this.textureHeight),r=z.getContext("2d");r.save();this._renderer.render(r,0,this.textureHeight-
this._renderer.renderedHeight);this._glTexture=new e(m,this.createDescriptor(m),z);r.restore();return this._glTexture};l.unload=function(){p.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};a._createClass(k,[{key:"width",get:function(){return this._renderer.renderedWidth}},{key:"height",get:function(){return this._renderer.renderedHeight}},{key:"textureWidth",get:function(){const m=this.width;return this._requiresPowerOfTwo?f.nextHighestPowerOfTwo(m):
m}},{key:"textureHeight",get:function(){const m=this.height;return this._requiresPowerOfTwo?f.nextHighestPowerOfTwo(m):m}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"texcoordScale",get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}},{key:"requiresFrameUpdates",get:function(){return!1}}]);return k}(t.ContentObject)})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],function(a,u,f){function p(n,b,h){n.canvas||(n.canvas=document.createElement("canvas"));n.canvas.width=b;n.canvas.height=h;return n.canvas}let t=function(){function n(h,k,l=2048){this.text=h;this._parameters=k;this.maxSize=l;this._lineWidths=[];this._displayWidth=this._renderPixelRatio=null;this.key=`${this._parameters.key}--${h}`;this._lines=h.split(/\r?\n/);this._lineHeight=this.computeLineHeight()}var b=n.prototype;b.getLineXOffset=
function(h){return Math.round((this.renderedWidth-this._lineWidths[h]*this.renderPixelRatio)/2)};b.render=function(h,k=0,l=0){const m=this.renderedLineHeight;var z=this.renderedHaloSize,r=h.textAlign,c=this.renderedWidth;r=("center"===r?.5*c:"right"===r?c:0)+z;c=z+1;h.save();0<z&&this.renderHalo(h,r,c,k,l);this.setFontProperties(h,this.renderedFontSize);l+=c;k+=r;for(z=0;z<this._lines.length;++z)h.globalCompositeOperation="destination-out",h.fillStyle="rgb(0, 0, 0)",r=this._lines[z],c=this.getLineXOffset(z),
h.fillText(r,k+c,l),h.globalCompositeOperation="source-over",h.fillStyle=this._parameters.fillStyle,h.fillText(r,k+this.getLineXOffset(z),l),l+=m;h.restore()};b.renderHalo=function(h,k,l,m,z){const r=this.renderedWidth,c=this.renderedHeight,d=p(e,Math.max(r,512),Math.max(c,512)),g=d.getContext("2d");g.clearRect(0,0,r,c);this.setFontProperties(g,this.renderedFontSize);g.fillStyle=this._parameters.haloStyle;g.strokeStyle=this._parameters.haloStyle;const A=3>this.renderedHaloSize;g.lineJoin=A?"miter":
"round";A?this.renderHaloEmulated(g,k,l):this.renderHaloNative(g,k,l);h.globalAlpha=this._parameters.definition.halo.color[3];h.drawImage(d,0,0,r,c,m,z,r,c);h.globalAlpha=1};b.renderHaloEmulated=function(h,k,l){const m=this.renderedLineHeight,z=this.renderedHaloSize;for(let r=0;r<this._lines.length;++r){const c=this._lines[r],d=this.getLineXOffset(r);for(const [g,A]of w)h.fillText(c,k+d+z*g,l+z*A);l+=m}};b.renderHaloNative=function(h,k,l){const m=this.renderedLineHeight,z=this.renderedHaloSize;for(let r=
0;r<this._lines.length;++r){const c=2*z,d=this._lines[r],g=this.getLineXOffset(r);for(let A=0;5>A;A++)h.lineWidth=(.6+.1*A)*c,h.strokeText(d,k+g,l);l+=m}};b.setFontProperties=function(h,k){const l=this._parameters.definition.font;h.font=`${l.style} ${l.weight} ${k}px ${l.family}, sans-serif`;h.textAlign="left";h.textBaseline="top"};b._ensureTextWidth=function(){if(f.isSome(this._displayWidth))return this._displayWidth;const h=p(e,512,512).getContext("2d");this.setFontProperties(h,this._parameters.definition.size);
let k=0,l=2*this._parameters.haloSize;this._lineWidths.length=0;var m=this._parameters.definition.font;if("italic"===m.style||"oblique"===m.style||"string"===typeof m.weight&&("bold"===m.weight||"bolder"===m.weight)||"number"===typeof m.weight&&600<m.weight)l+=.3*h.measureText("A").width;for(const z of this._lines)m=Math.round(h.measureText(z).width+l),this._lineWidths.push(m),k=Math.max(k,m);return this._displayWidth=k};b.computeLineHeight=function(){return Math.ceil(1.275*this._parameters.definition.size+
2*this._parameters.haloSize)+1};u._createClass(n,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",
get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(f.isNone(this._renderPixelRatio)){const h=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(h,Math.min(this.maxSize/(this.displayWidth*h),this.maxSize/(this.displayHeight*h))):h}return this._renderPixelRatio}}]);return n}();const w=[];for(let n=0;360>
n;n+=22.5)w.push([Math.cos(Math.PI*n/180),Math.sin(Math.PI*n/180)]);const e={canvas:null};a.TextRenderer=t;a.default=t;a.getTextHelperCanvas=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C){const B=["polyline","polygon","extent"];A=function(G){function K(J,M,O,Q){return G.call(this,J,M,O,Q)||this}u._inheritsLoose(K,G);var H=K.prototype;H.doLoad=function(){var J=u._asyncToGenerator(function*(){});return function(){return J.apply(this,arguments)}}();H.destroy=function(){G.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};H.createGraphics3DGraphic=function(J){J=J.graphic;if(!this._validateGeometry(J.geometry,
B,this.symbolLayer.type))return null;const M=this.setGraphicElevationContext(J,new c.ElevationContext);this.ensureDrapedStatus("on-the-ground"===M.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(J):this._createAs3DShape(J,M,J.uid)};H.ensureMaterial=function(){if(!p.isSome(this._material)){var J={...C.defaultWaterMaterialParameters},M=this.symbolLayer.color;p.isSome(M)&&(J.color=f.toUnitRGBA(M));M=this._getCombinedOpacity(M,{hasIntrinsicColor:!0});J.color=[J.color[0],J.color[1],
J.color[2],M];J.transparent=1>M||this.needsDrivenTransparentPass;J.waveDirection=p.isSome(this.symbolLayer.waveDirection)?K.headingVectorFromAngle(this.symbolLayer.waveDirection):b.fromValues(0,0);M=C.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];J.waveStrength=M.waveStrength;J.waveTextureRepeat=M.textureRepeat;J.waveVelocity=M.waveVelocity;J.flowStrength=M.perturbationStrength;J.slicePlaneEnabled=this._context.slicePlaneEnabled;J.isDraped=this.draped;this._material=
new D.WaterMaterial(J);this._context.stage.add(this._material)}};H.layerOpacityChanged=function(){if(p.isNone(this._material))return!0;const J=this._material.params.color,M=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[J[0],J[1],J[2],M],transparent:1>M||this.needsDrivenTransparentPass});return!0};H.layerElevationInfoChanged=function(J,M,O){const Q=this._elevationContext.mode;O=r.elevationModeChangeUpdateType(K.elevationModeChangeTypes,
O,Q);if(O!==r.SymbolUpdateType.UPDATE)return O;const S=r.needsElevationUpdates2D(Q);return this.updateGraphics3DGraphicElevationInfo(J,M,()=>S)};H.slicePlaneEnabledChanged=function(){p.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.pixelRatioChanged=function(){return!0};H._createAs3DShape=function(J,M,O){J=q.geometryAsPolygon(J.geometry);if(p.isNone(J))return null;N.renderData=
q.geometryToRenderInfo(J,this._context.elevationProvider,this._context.renderCoordsHelper,M);const Q=N.renderData.position.length/3;N.uvCoords=new Float64Array(2*Q);N.outNum=0;N.outGeometries=[];N.outTransforms=[];N.outMaterials=[];this._create3DShapeGeometries(N);this._logGeometryCreationWarnings(N.renderData,J.rings,"rings","WaterSymbol3DLayer");if(0===N.outNum)return null;this._createUVCoordsFromVertices(N.uvCoords,N.renderData.mapPosition,Q,this._context.elevationProvider.spatialReference);O=
new y.Object3D({geometries:N.outGeometries,materials:N.outMaterials,transformations:N.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:O}});O=new g.Graphics3DObject3DGraphicLayer(this,O,N.outGeometries,null,null,z.perVertexElevationAligner,M);O.alignedSampledElevation=N.renderData.sampledElevation;O.needsElevationUpdates=r.needsElevationUpdates2D(M.mode);return O};H._createUVCoordsFromVertices=function(J,M,O,Q){Q=t.getMetersPerUnitForSR(Q);m.empty(E);for(var S=0;S<
O;S++)n.set(F,M[3*S],M[3*S+1]),m.expandPointInPlace(E,F);h.scale(E,E,Q);S=E[1]%K.unitSizeOfTexture;v[0]=E[0]-E[0]%K.unitSizeOfTexture;v[1]=E[1]-S;for(S=0;S<O;S++)J[2*S]=(M[3*S]*Q-v[0])/K.unitSizeOfTexture,J[2*S+1]=(M[3*S+1]*Q-v[1])/K.unitSizeOfTexture};H._create3DShapeGeometries=function(J){var M=J.renderData.polygons;const O=J.uvCoords;for(const {count:Q,index:S,position:V,mapPosition:Y,holeIndices:W}of M){if(p.isSome(this._context.clippingExtent)&&(l.empty(L),l.expandWithBuffer(L,Y),!l.intersectsClippingArea(L,
this._context.clippingExtent)))continue;M=w.earcut(Y,W,3);if(0===M.length)continue;M=new Uint32Array(M);const ba=new Float64Array(O.buffer,2*S*O.BYTES_PER_ELEMENT,2*Q);M=q.createWaterGeometry({indices:M,attributeData:{position:V,uv0:ba,mapPosition:Y}});J.outGeometries.push(M);J.outMaterials.push(p.unwrap(this._material));J.outTransforms.push(e.IDENTITY);J.outNum++}};H._createAsOverlay=function(J){const M=q.geometryAsPolygon(J.geometry);if(p.isNone(M))return null;p.unwrap(this._material).renderPriority=
this._renderPriority;I.renderData=q.geometryToRenderInfoDraped(M,this._context.overlaySR);const O=I.renderData.position.length/3;I.uvCoords=new Float64Array(2*O);I.outNum=0;I.outGeometries=[];I.outBoundingBox=l.empty();I.layerUid=this._context.layer.uid;I.graphicsUid=J.uid;this._createAsOverlayWater(I);this._logGeometryCreationWarnings(I.renderData,M.rings,"rings","WaterSymbol3DLayer");if(0===I.outNum)return null;this._createUVCoordsFromVertices(I.uvCoords,I.renderData.position,O,this._context.overlaySR);
return 0<I.outNum?new d(this,I.outGeometries,I.outBoundingBox):null};H._createAsOverlayWater=function(J){const M=J.uvCoords;var O=J.renderData.polygons;for(const {position:S,holeIndices:V,index:Y,count:W}of O)if(l.empty(L),l.expandWithBuffer(L,S),l.intersectsClippingArea(L,this._context.clippingExtent)&&(l.expandWithAABB(J.outBoundingBox,L),O=w.earcut(S,V,3),0!==O.length)){O=new Uint32Array(O);var Q=new Float64Array(M.buffer,2*Y*M.BYTES_PER_ELEMENT,2*W);O=q.createWaterGeometry({indices:O,attributeData:{position:S,
uv0:Q}});O=new x.RenderGeometry(O,p.unwrap(this._material),J.layerUid,J.graphicsUid);Q=L;h.set(O.boundingSphere,.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0,.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1])));J.outGeometries.push(O);J.outNum++}};K.headingVectorFromAngle=function(J){const M=b.create();J=k.toRadian(J);M[0]=Math.sin(J);M[1]=Math.cos(J);return M};u._createClass(K,[{key:"test",get:function(){return{create3DShape:J=>this._createAs3DShape(J.graphic,J.elevationContext,J.graphicUid),ensureMaterial:()=>
this.ensureMaterial()}}}]);return K}(A.Graphics3DSymbolLayer);A.unitSizeOfTexture=100;A.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,onTheGroundChanged:r.SymbolUpdateType.RECREATE};const v=b.create(),E=m.create(),F=b.create(),L=l.create(),N={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},I={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,
outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=A;a.default=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),function(a,u,f,p,t,w,e,n,b,h){p=function(k){function l(z){z=
k.call(this,z,h.defaultWaterMaterialParameters)||this;z.animation=new f.AnimationTimer;z.techniqueConfig=new e.WaterTechniqueConfiguration;return z}u._inheritsLoose(l,k);var m=l.prototype;m.getTechniqueConfig=function(z,r){this.techniqueConfig.output=z;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.useSSR=
this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.transparencyPassType=r?r.transparencyPassType:3;this.techniqueConfig.enableOffset=r?r.camera.relativeElevation<t.OITPolygonOffsetLimit:!0;this.techniqueConfig.multipassTerrainEnabled=r?r.multipassTerrainEnabled:!1;this.techniqueConfig.cullAboveGround=r?r.cullAboveGround:!1;return this.techniqueConfig};m.update=function(z){this.animation.enabled=35E3>Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*
Math.min(z.camera.relativeElevation,z.camera.distance);z=this.animation.advance(z.dt);return this.animation.enabled&&z};m.intersect=function(z,r,c,d,g,A,q){b.intersectTriangleGeometry(z,r,d,g,A,void 0,q)};m.getGLMaterial=function(z){if(0===z.output&&this.params.isDraped)return z.output=5,new w.WaterGLMaterial(z);switch(z.output){case 0:case 2:case 4:case 7:return new w.WaterGLMaterial(z)}};m.createBufferWriter=function(){return new n.DefaultBufferWriter(n.PositionUVLayout)};return l}(p.Material);
a.WaterMaterial=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,u,f,p){let t=function(){function w(n=!0){this.enabled=n;this._time=0}var e=w.prototype;e.advance=function(n){this.enabled&&(this._time+=n);return f.isNone(this._forcedTime)&&this.enabled&&0!==n};e.stopAtTime=function(n){this._forcedTime=n};u._createClass(w,
[{key:"time",get:function(){return f.isSome(this._forcedTime)?this._forcedTime:p.Milliseconds(this._time)}}]);return w}();a.AnimationTimer=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports","../../../../../chunks/vec2f64","../../lib/Material"],function(a,u,f){u={waveStrength:.06,waveTextureRepeat:32,waveDirection:u.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,
color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...f.materialParametersDefaults};a.defaultWaterMaterialParameters=u;a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,
perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,
waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Loadable",
"./symbolComplexity"],function(a,u,f,p){return function(t){function w(n,b,h){b=t.call(this,b)||this;b.symbol=n;b.convert=h;b.graphics3DSymbol=null;b.referenced=0;return b}a._inheritsLoose(w,t);var e=w.prototype;e.getSymbolLayerSize=function(n){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(n):null};e.doLoad=function(){var n=a._asyncToGenerator(function*(b){b=yield this.symbol.fetchSymbol({signal:b});b.id=this.symbol.id;this.graphics3DSymbol=this.convert(b);yield this.graphics3DSymbol.load()});
return function(b){return n.apply(this,arguments)}}();e.createGraphics3DGraphic=function(n){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(n,this):null};e.globalPropertyChanged=function(n,b){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(n,b):!1};e.applyRendererDiff=function(n,b){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(n,b):!1};e.prepareSymbolPatch=function(n){u.isSome(this.graphics3DSymbol)&&
this.graphics3DSymbol.prepareSymbolPatch(n)};e.updateGeometry=function(n,b){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(n,b):!1};e.onRemoveGraphic=function(){};e.getFastUpdateStatus=function(){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};e.destroy=function(){u.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};a._createClass(w,[{key:"extentPadding",
get:function(){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return u.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:p.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return w}(f.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(B){B=h.getGraphics3DSymbol(B.graphics3DGraphic.graphics3DSymbol);return p.isSome(B)?B.symbol.symbolLayers.getItemAt(0):null}function m(B,v){var E=v.graphics3DGraphic.graphic.geometry;if(p.isNone(E))return null;if(p.isSome(v.disablePlacement))return v.labelClass.labelPlacement?(q.warnOncePerTick(z(B.placement,v.disablePlacement.logEntityDescription)),r(v)):B;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(v.labelClass.labelPlacement)return q.warnOncePerTick(z(B.placement,
`'${E}' geometries`)),r(v)}return B}function z(B,v){return`the requested label placement '${B}' is currently unsupported for ${v} in SceneView`}function r(B){const v=B.graphics3DGraphic.graphic.geometry;if(p.isNone(v))return null;switch(v.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return B=l(B),p.isSome(B)&&"extrude"===B.type?y["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return y["above-center"];case "mesh":return y["above-center"]}}function c(B,v=D){({graphics3DGraphic:B}=B);B=B._graphics[0];(B=p.isSome(B)?B.stageObject.geometryRecords[0].material:null)&&B instanceof k.HUDMaterial?(B=B.params.anchorPos,v[0]=2*(B[0]-.5),v[1]=2*(B[1]-.5)):(v[0]=0,v[1]=0);return v}function d(B,v,E){E=p.isSome(E)?E.getBoundingBoxObjectSpace(C):C;E=e.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);B.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*v.normalizedOffset[0];const F=
B.translation[2],L=E[2]/2*v.normalizedOffset[1];B.translation[2]=0;B.elevationOffset=F+L;E=w.length(E);B.centerOffset[2]=E/2*v.normalizedOffset[2]}function g(B){const v=B.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:F}=B;var L=h.getGraphics3DSymbol(F.graphics3DSymbol);L=p.isSome(L)?L.symbol:null;B=y[v]||r(B);if("point-3d"===L.type&&L.supportsCallout()&&L.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:A(L.verticalOffset),anchor:null,
normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&("point-3d"!==L.type||!L.supportsCallout()||!L.verticalOffset||F.isDraped)){a:switch(B.placement){case "above-center":L=!0;break a;default:L=!1}return L?{placement:"above-center",verticalOffset:A(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,B.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(q.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+v+" placement)"),
null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function A(B){const {screenLength:v,minWorldLength:E,maxWorldLength:F}=B;return{screenLength:v,minWorldLength:E,maxWorldLength:F}}const q=f.getLogger("esri.views.3d.layers.graphics.labelPlacement"),y={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};u={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const B in u){const v=y[B];u[B].forEach(E=>{y[E]=v})}Object.freeze&&(Object.freeze(y),Object.keys(y).forEach(function(B){Object.freeze(y[B]);Object.freeze(y[B].normalizedOffset)}));const x=[0,0],D=[0,0],C=b.create();a.get=function(B){var v=g(B);if(p.isNone(v))return null;if(v.anchor)var E=v;else{E=B.labelClass.labelPlacement;var F=y[E],L=F||r(B);E&&!F&&q.warnOncePerTick(`the requested label placement '${E}' is not currently supported in SceneView`);
E=m(L,B)}if(p.isNone(E))return null;F=!!v.hasLabelVerticalOffset;v={anchor:E.anchor,verticalOffset:v.verticalOffset,screenOffset:t.create(),centerOffset:n.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:e.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=B.graphics3DGraphic.graphic.geometry;if(p.isNone(F))B=null;else{switch(F.type){case "point":L=l(B);if(!p.isNone(L))switch(F=B.graphics3DGraphic._graphics[0],p.isSome(F)?F.getCenterObjectSpace(v.translation):w.set(v.translation,0,0,
0),L.type){case "icon":case "text":({graphics3DGraphic:L}=B);F=p.isSome(F)?F.getScreenSize():null;!L.isDraped&&p.isSome(F)?(B=c(B),x[0]=F[0]/2*(E.normalizedOffset[0]-B[0]),x[1]=F[1]/2*(E.normalizedOffset[1]-B[1]),v.screenOffset[0]=x[0],v.hasLabelVerticalOffset?(v.centerOffset[1]=x[1],v.centerOffsetUnits="screen"):v.screenOffset[1]=x[1]):v.hasLabelVerticalOffset||"center"===v.anchor||(y[B.labelClass.labelPlacement]&&q.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),
v.anchor="center");break;case "object":d(v,E,F)}break;case "polygon":F=l(B);if(!p.isNone(F))switch(F.type){case "extrude":B=B.graphics3DGraphic._graphics[0],p.isSome(B)?(B.getBoundingBoxObjectSpace(C),b.center(C,v.translation),v.translation[2]=b.height(C)/2):w.set(v.translation,0,0,0),d(v,E,B)}break;case "mesh":d(v,E,B.graphics3DGraphic._graphics[0])}B=v}return B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],
function(a){let u=function(){function f(t){this._stage=t;this._materials=new Map}var p=f.prototype;p.get=function(t){return this._materials.get(t)};p.add=function(t,w){this._materials.set(t,w);this._stage.add(w)};p.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return f}();a.MaterialCollection=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){var g;a.TextTextureAtlas=g=function(A){function q(x){x=A.call(this,x)||this;x.type=4;x.id=b.generateUID();x.events=new t;x.glTexture=null;x.needsClear=!1;x.elementsToAddOrUpdate=new Map;x.elementsToRemove=new Map;x.elementsToRender=new Map;x.elements=new Map;x.stageObjects=new Map;x.updating=!1;return x}u._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(this);const x=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(x);this.update2DCanvasSize();this.resetAtlasCursor()};y.unload=function(){n.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};y.createDescriptor=function(x){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:x.parameters.maxMaxAnisotropy}};y.load=
function(x){if(n.isSome(this.glTexture))return this.glTexture;this.glTexture=new d(x,this.createDescriptor(x),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(c.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this.glTexture};y.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=n.removeMaybe(this.frameWorker);this.glTexture&&(this.stage.remove(this),this.glTexture=null);this.canvas.width=
0;this.canvas.height=0;this.ctx=this.canvas=null};y.create2DCanvas=function(){const x=document.createElement("canvas");x.setAttribute("id","canvas2d");x.setAttribute("style","display:none");x.setAttribute("width",(512).toString());x.setAttribute("height",(512).toString());return x};y.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};y.createAtlasRegion=function(x=512){this.atlas={size:{width:x,
height:x},cursor:{x:0,y:0},lineHeight:0}};y.computeAtlasResolution=function(x,D){x=Math.max(x,D);x=e.nextHighestPowerOfTwo(x+256);return x=Math.min(x,4096)};y.resizeAtlas=function(x,D){D=D||x;const C=this.atlas;C.size.width=x;C.size.height=D;n.isSome(this.glTexture)&&this.glTexture.resize(x,D);this.update2DCanvasSize()};y.resetAtlasCursor=function(){const x=this.atlas;x.cursor.x=2;x.cursor.y=4;x.lineHeight=0;this.needsClear=!0};y.getAtlasUsage=function(){const x=this.atlas;return(x.cursor.x+x.cursor.y*
x.size.width)/(x.size.width*x.size.height)};y.getExpectedAtlasUsage=function(){const x=this.elementsToRemove.size,D=this.elementsToAddOrUpdate.size,C=this.elements.size;return this.getAtlasUsage()/C*(C+D-x)};y.addAtlasElement=function(x,D,C,B){const v=this.atlas,{renderedWidth:E,renderedHeight:F,displayWidth:L,displayHeight:N}=x.textRenderer;x.placement.offset.x=v.cursor.x;x.placement.offset.y=v.cursor.y;x.placement.size.width=E;x.placement.size.height=F;x.placement.size.displayWidth=L;x.placement.size.displayHeight=
N;x.placement.uvMinMax=[x.placement.offset.x/v.size.width,1-(x.placement.offset.y+F)/v.size.height,(x.placement.offset.x+E)/v.size.width,1-x.placement.offset.y/v.size.height];v.cursor.x+=C;v.lineHeight=Math.max(v.lineHeight,B);this.elements.set(D,x)};y.removeAtlasElement=function(x){if(x&&this.elements.has(x.textId)){const D=x.placement.offset,C=x.placement.size;this.ctx.clearRect(D.x,D.y,C.width,C.height);this.elements.delete(x.textId)}};y.ensureStageObjects=function(x){var D=this.stageObjects.get(x);
if(D)return D;D=new Set;this.stageObjects.set(x,D);return D};y.addStageObject=function(x,D){this.ensureStageObjects(x).add(D)};y.removeStageObject=function(x,D){(x=this.stageObjects.get(x))&&x.delete(D)&&(D.geometries[0].vertexAttributes.get("size").data=[0,0],D.geometryVertexAttrsUpdated(0))};y._processAddition=function(x,D){const C=this.atlas;var B=x.textId;const v=x.textRenderer.renderedWidth+2,E=x.textRenderer.renderedHeight+2+2;if(C.cursor.x+v<C.size.width&&C.cursor.y+E<C.size.height)this.addAtlasElement(x,
B,v,E),this.elementsToRender.set(B,x),this.elementsToAddOrUpdate.delete(B);else if(C.cursor.y+E+C.lineHeight<C.size.height)C.cursor.x=2,C.cursor.y+=C.lineHeight,C.lineHeight=0,this.addAtlasElement(x,B,v,E),this.elementsToRender.set(B,x),this.elementsToAddOrUpdate.delete(B);else{x=this.getExpectedAtlasUsage();(B=.85<x&&4096>C.size.width)&&this.resizeAtlas(2*C.size.width,2*C.size.height);if(!D||!B&&.95<x&&4096===C.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};y.processRemovals=
function(){this.elementsToRemove.forEach((x,D)=>{const C=this.stageObjects.get(D);C&&0!==C.size||this.removeAtlasElement(x);C&&0===C.size&&this.stageObjects.delete(D)});this.elementsToRemove.clear()};y.repack=function(){this.processRemovals();this.elements.forEach((x,D)=>{x.rendered=!1;this.elementsToAddOrUpdate.set(D,x)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};y.processRenderingRequest=function(x){this.ctx.clearRect(x.placement.offset.x,x.placement.offset.y,
x.placement.size.width,x.placement.size.height);x.textRenderer.render(this.ctx,x.placement.offset.x,x.placement.offset.y);const D=this.stageObjects.get(x.textId);D&&D.forEach(C=>{C.geometries[0].vertexAttributes.get("uv0").data=new Float32Array(x.placement.uvMinMax);C.geometries[0].vertexAttributes.get("size").data=[x.placement.size.displayWidth,x.placement.size.displayHeight];C.geometryVertexAttrsUpdated(0)});x.rendered=!0};y.runTask=function(x,D=!0){if(this.glTexture){var C=!1;w.someMap(this.elementsToAddOrUpdate,
(v,E)=>(v=this.elements.get(E))&&v.rendered?((v=this.stageObjects.get(E))&&v.forEach(F=>{const L=F.geometries[0].vertexAttributes,N=this.elements.get(E);L.get("uv0").data=new Float32Array(N.placement.uvMinMax);L.get("size").data=new Float32Array([N.placement.size.displayWidth,N.placement.size.displayHeight]);F.geometryVertexAttrsUpdated(0)}),this.elementsToAddOrUpdate.delete(E),!1):1===this._processAddition(this.elementsToAddOrUpdate.get(E),D)?C=!0:!1);if(C)this.runTask(c.noBudget,!1);else{var B=
!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);w.someMap(this.elementsToRender,(v,E)=>{this.processRenderingRequest(v);this.elementsToRender.delete(E);B=!0;x.madeProgress();return x.done});B&&n.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&g.test.orderedRepackingEnabled&&this.repackOrdered()}}};y.addTextTexture=function(x,D){const C=x.key;this.elementsToAddOrUpdate.has(C)||
this.elementsToAddOrUpdate.set(C,{textId:C,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:x,rendered:!1});this.addStageObject(C,D);this.elementsToRemove.delete(C);this.setDirty()};y.removeTextTexture=function(x,D){x=x.key;this.elementsToRemove.set(x,this.elements.get(x));this.removeStageObject(x,D)};y.setDirty=function(){this.updating=!0};y.repackOrdered=function(){if(0!==this.elements.size){var x=[];this.elements.forEach((C,B)=>x.push({element:C,
key:B}));var D=!0;for(let C=0;C<x.length-1;C++)if(0<x[C].key.localeCompare(x[C+1].key)){D=!1;break}if(!D||this.elementsToRemove.size){x.sort((C,B)=>C.key.localeCompare(B.key));this.elements.clear();for(const {element:C,key:B}of x)this.elements.set(B,C);this.repack();this.setDirty()}}};u._createClass(q,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:x,stageObjects:D,elementsToRemove:C,atlas:B}=this,v=this;return{elements:x,stageObjects:D,elementsToRemove:C,atlas:B,resizeAtlas:(E,F)=>v.resizeAtlas(E,F),run:(E,F)=>v.runTask(E,F)}}}]);return q}(p);a.TextTextureAtlas.test={orderedRepackingEnabled:!1};f.__decorate([h.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);f.__decorate([h.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=g=f.__decorate([r.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);a.default=a.TextTextureAtlas;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,u,f,p,t,w,e,n,b){let h=function(){function l(){this.gltfCache=new Map;this.wosrCache=
new Map;this.evictHandles=new f}var m=l.prototype;m.loadGLTF=function(z,r,c){return this.fromCache(this.gltfCache,c?`gltfPBR:${z}`:`gltf:${z}`,d=>n.load(new e.DefaultLoadingContext(d.streamDataRequester),z,d,c),r)};m.loadWOSR=function(z,r){return this.fromCache(this.wosrCache,`wosr:${z}:${r.disableTextures}`,c=>b.load(z,c),r)};m.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};m.fromCache=function(z,r,c,d){return new Promise((g,A)=>{if(w.isAborted(d))A(w.createAbortError());
else{var q=w.onAbort(d,()=>{this.remove(z,r);A(w.createAbortError())}),y=z.get(r);if(y)this.evictHandles.remove(r),y.refCount++,y.item.then(g,A);else{y=w.createAbortController();var x={refCount:1,abortController:y,item:c({...d,signal:y.signal}).then(D=>{x.abortController=null;D.remove=()=>this.remove(z,r);return D})};z.set(r,x);x.item.then(D=>{t.isSome(q)&&q.remove();g(D)},D=>{t.isSome(q)&&q.remove();A(D)})}}})};m.remove=function(z,r){const c=z.get(r);c&&(c.refCount--,0===c.refCount&&this.evictHandles.add(p.timeoutHandle(()=>
{z.delete(r);t.isSome(c.abortController)&&c.abortController.abort()},k),r))};u._createClass(l,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return l}(),k=1E4;a.ObjectResourceCache=h;a.test={overrideEvictDelay(l){k=l;return{remove(){k=1E4}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){const y=e.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(C){function B(E){E=C.call(this,E)||this;E.tiles=new t;E.tileSize=512;E._idToTile=new Map;E._handles=new w;E._clients=new Set;E._dirty=!1;E._newTiles=new b;return E}u._inheritsLoose(B,C);var v=B.prototype;v.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(h.init(this,["tileSize","cameraOnSurface.location",
"tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(q.TaskPriority.FEATURE_TILE_TREE,this))};v.destroy=function(){this._frameWorker=n.removeMaybe(this._frameWorker);this._handles=n.destroyMaybe(this._handles)};v.addClient=function(){const E=x++;this._clients.add(E);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(E)}};v._removeClient=function(E){this._clients.delete(E);this._hasClients||
this._clear()};v._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(q.noBudget))};v._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};v.runTask=function(E){this._dirty=!1;this._pendingTiles||(this._startUpdate(),n.isSome(this._frameWorker)&&(this._frameWorker.priority=q.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(E);
!this._pendingTiles&&n.isSome(this._frameWorker)&&(this._frameWorker.priority=q.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};v._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new g.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=
this._getRootTiles()):this._clear())};v._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};v._getRootTiles=function(){return this.rootTileIds.map(E=>new d.FeatureTileDescriptor3D(E[0],E[1],E[2],this.tilingScheme))};v._purgeHorizonTiles=function(E){E.sort((F,L)=>{F=F.measures.screenRect;L=L.measures.screenRect;return F[1]+F[3]-(L[1]+L[3])});c.empty(D);for(let F=0;F<E.length;F++)if(c.expand(D,E.data[F].measures.screenRect),10<c.height(D))return E.data.slice(F,
E.length);return[]};v._subdivideTilesForView=function(E){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!E.done;){const F=this._pendingTiles.pop();E.madeProgress();if(!this.filterExtentRect||c.intersects(this.filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),0!==F.measures.visibility&&(F.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):this._newTiles.push(F))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),
this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};v._updateTiles=function(E){for(var F of this.tiles.items)F.used=!1;E=E.filter(L=>{const N=this._idToTile.get(L.id);N?(N.copyMeasurementsFrom(L),N.used=!0):this._idToTile.set(L.id,L);return!N});F=this.tiles.items.filter(L=>L.used?!1:(this._idToTile.delete(L.id),!0));this.tiles.removeMany(F);this.tiles.addMany(E);this.sortTiles()};v.sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((E,F)=>E.measures.visibility!==
F.measures.visibility?2===E.measures.visibility?-1:1:E.measures.distance-F.measures.distance);this.tiles.forEach((E,F)=>E.loadPriority=F)};u._createClass(B,[{key:"tilingScheme",get:function(){const E=this.tilingSchemeOwner.tilingScheme;return E?E.clone():null}},{key:"filterExtent",set:function(E){if(E&&!E.spatialReference.equals(this.viewState.spatialReference))y.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var F=this._get("filterExtent");
F===E||F&&E&&F.equals(E)||(E=E?E.clone():null,this._set("filterExtent",E),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(!this.filterExtent||!this.tilingScheme)return null;const E=c.create();A.toBoundingRect(this.filterExtent,E,this.tilingScheme.spatialReference);return E}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(E){E!==this._get("suspended")&&(this._set("suspended",
E),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return B}(p);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"tilingSchemeOwner",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);f.__decorate([k.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);f.__decorate([k.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);f.__decorate([k.property()],
a.FeatureTileTree3D.prototype,"tileSize",void 0);f.__decorate([k.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);f.__decorate([k.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);f.__decorate([k.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);f.__decorate([k.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"rootTileIds",null);f.__decorate([k.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);f.__decorate([k.property({readOnly:!0})],
a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=f.__decorate([r.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let x=0;const D=c.create();a.default=a.FeatureTileTree3D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,u){let f=function(){function p(w,e,n,b=null){this.lij=[0,0,0];this.extent=u.create();this.loadPriority=
this.resolution=0;this.measures={visibility:2,screenRect:u.create(),distance:0,shouldSplit:!1};this.used=!1;b&&this.acquire(w,e,n,b)}var t=p.prototype;t.acquire=function(w,e,n,b){this.tilingScheme=b;this.id=p.id(w,e,n);this.lij[0]=w;this.lij[1]=e;this.lij[2]=n;b.getExtent(w,e,n,this.extent);this.resolution=b.resolutionAtLevel(w)};t.release=function(){this.tilingScheme=null};t.getChildren=function(w){const e=this.lij[0]+1,n=2*this.lij[1],b=2*this.lij[2];if(!w)return[new p(e,n,b,this.tilingScheme),
new p(e,n+1,b,this.tilingScheme),new p(e,n,b+1,this.tilingScheme),new p(e,n+1,b+1,this.tilingScheme)];w[0].acquire(e,n,b,this.tilingScheme);w[1].acquire(e,n+1,b,this.tilingScheme);w[2].acquire(e,n,b+1,this.tilingScheme);w[3].acquire(e,n+1,b+1,this.tilingScheme);return w};t.copyMeasurementsFrom=function(w){this.measures.visibility=w.measures.visibility;this.measures.shouldSplit=w.measures.shouldSplit;this.measures.distance=w.measures.distance;u.set(w.measures.screenRect,this.measures.screenRect)};
p.id=function(w,e,n){return`${w}/${e}/${n}`};return p}();a.FeatureTileDescriptor3D=f;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),function(a,
u,f,p,t,w,e,n,b){let h=function(){function A(y){this.camera=new b;this.focusOnMap=[0,0];this.screenRect=t.create();this.tileSize=y.tileSize;this.renderCoordsHelper=y.renderCoordsHelper;this.tilingScheme=y.tilingScheme;this.visibility=new n.FeatureTileVisibility3D(y.renderCoordsHelper)}var q=A.prototype;q.begin=function(y,x,D){this.camera.copyFrom(y);this.surfaceElevation=D;this.focusOnMap[0]=x.x;this.focusOnMap[1]=x.y;t.fromValues(0,0,y.fullWidth,y.fullHeight,this.screenRect);this.visibility.begin(this.camera,
D)};q.end=function(){this.visibility.end()};q.updateTile=function(y){y.measures.visibility=this.visibility.calculate(y);y.measures.distance=t.distance(y.extent,this.focusOnMap);0!==y.measures.visibility&&this.updateScreenMeasure(y)};q.updateScreenMeasure=function(y){const x=y.measures.screenRect;t.empty(x);let D=0;const C=y.lij[0]+2,B=y.lij[1]<<2,v=y.lij[2]<<2;var E=this.tileSizeWithBias(y);E*=E;for(let F=0;4>F;F++)for(let L=0;4>L;L++)if(D+=this.computeScreenArea(y,C,B+F,v+L,x),D>E){y.measures.shouldSplit=
!0;return}y.measures.shouldSplit=!1};q.tileSizeWithBias=function(y){return 1===y.measures.visibility?5*this.tileSize:this.tileSize};q.computeScreenArea=function(y,x,D,C,B){this.projectToScreen(x,D,C,1===y.measures.visibility,m);t.empty(k);for(y=0;4>y;y++)t.expandPointInPlace(k,m[y]);t.expand(B,k);t.intersection(k,this.screenRect,l);return e.areaPoints2d(m[0],m[1],m[2])+e.areaPoints2d(m[0],m[2],m[3])};q.projectToScreen=function(y,x,D,C,B){this.tilingScheme.ensureMaxLod(y);this.tilingScheme.getExtent(y,
x,D,z);this.toRenderCoords(z,0,3,c[0]);this.toRenderCoords(z,2,3,c[1]);this.toRenderCoords(z,2,1,c[2]);this.toRenderCoords(z,0,1,c[3]);C&&(this.projectToPlane(c,this.camera.frustum[4]),this.projectToPlane(c,this.camera.frustum[3]),this.projectToPlane(c,this.camera.frustum[2]));for(y=0;4>y;y++)this.camera.projectToRenderScreen(c[y],g),this.camera.renderToScreen(g,B[y])};q.projectToPlane=function(y,x){for(var D=0;4>D;D++)d[D]=w.signedDistance(x,y[D]);D=Math.max(d[0],d[1],d[2],d[3]);if(0<D)for(x=f.scale(r,
w.normal(x),-D),D=0;4>D;D++)f.add(y[D],y[D],x)};q.toRenderCoords=function(y,x,D,C){r[0]=y[x];r[1]=y[D];r[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(r,this.tilingScheme.spatialReference,C);return C};return A}();const k=t.create(),l=t.create(),m=[u.createScreenPointArray(),u.createScreenPointArray(),u.createScreenPointArray(),u.createScreenPointArray()],z=t.create(),r=p.create(),c=[p.create(),p.create(),p.create(),p.create()],d=[0,0,0,0],g=u.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=
h;a.default=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/ray ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),function(a,u,f,p,t,w,e,n,b,h,k){let l=function(){function d(A){this.renderCoordsHelper=
A;this.surfaceElevation=0;this.cache=new Map;this.frustum=new h.Frustum(A);this.extendedFrustum=new h.Frustum(A);this.intersector=new k.FrustumExtentIntersection({renderCoordsHelper:A});this.renderCoordsHelper=A}var g=d.prototype;g.begin=function(A,q){this.surfaceElevation=q;this.aboveGround=this.renderCoordsHelper.getAltitude(A.eye)>q;this.frustum.update(A);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(A)};g.end=function(){this.cache.clear()};g.calculate=function(A){if(this.allTilesInvisible)return 0;
const q=1===this.renderCoordsHelper.viewingMode&&2<=A.lij[0]&&6>A.lij[0],y=this.getOrCalculateSingleTileVisibility(A,!q);return 0!==y&&q?this.calculateAggregatedChildrenVisibility(A):y};g.shortenFrustumFarPlane=function(A){var q=h.Frustum.nearFarLineIndices;const y=A.mutablePoints;for(const x of q){const [D,C]=x;q=y[D];p.subtract(m,y[C],q);p.scale(m,m,.95);p.add(y[C],q,m)}A.updatePoints(y)};g.calculateAggregatedChildrenVisibility=function(A){let q=0;var y=this.cache.get(A.id);if(null!=y)return y;
y=c.acquire();A.getChildren(y);for(const x of y){const D=this.calculate(x);if(0!==D&&(q=D,2===D))break}c.release(y);this.cache.set(A.id,q);return q};g.getOrCalculateSingleTileVisibility=function(A,q){var y=this.cache.get(A.id);if(null!=y)return y;y=this.calculateSingleTileVisibility(A);q&&this.cache.set(A.id,y);return y};g.calculateSingleTileVisibility=function(A){if(!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&12>A.lij[0]){if(0===this.calculateSingleTileVisibilitySided(A,!1))return this.calculateSingleTileVisibilitySided(A,
!0)}else return this.calculateSingleTileVisibilitySided(A,this.aboveGround)};g.calculateSingleTileVisibilitySided=function(A,q){this.intersector.update(A.extent,A.tilingScheme.spatialReference,this.surfaceElevation,q);A=w.getReferenceEllipsoid(A.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,A)?this.intersector.isVisibleInFrustum(this.frustum,A,!0)?2:1:0};g.updateExtendedFrustum=function(A){this.extendedFrustum.update(A);this.shortenFrustumFarPlane(this.extendedFrustum);
var q=this.renderCoordsHelper.worldUpAtPosition(A.eye,m);this.aboveGround||p.negate(q,q);q=u.acosClamped(-p.dot(q,A.viewForward));this.allTilesInvisible=q>(Math.PI+A.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=q>A.fovY/2)){A=this.extendedFrustumParameters();q=this.extendedFrustum.mutablePoints;for(let y=0;4>y;y++){const x=A.pointIndices[y],D=q[x],C=this.renderCoordsHelper.getAltitude(D);if(A.needsAltitudeAdjustment(C)){this.renderCoordsHelper.worldUpAtPosition(D,m);switch(x){case 4:case 7:case 0:case 3:e.projectVector(this.extendedFrustum.planes[0],
m,m);break;case 5:case 6:case 1:case 2:e.projectVector(this.extendedFrustum.planes[1],m,m)}p.scale(m,m,A.direction);this.renderCoordsHelper.intersectInfiniteManifold(n.wrap(D,m),A.zWithMargin,D)}}this.extendedFrustum.updatePoints(q);e.fromPoints(q[0],q[1],q[2],z);e.fromPoints(q[1],q[2],q[3],r);0>p.dot(e.normal(z),e.normal(r))&&(A=this.extendedFrustum.mutablePoints,this.aboveGround?[A[0],A[1]]=[A[1],A[0]]:[A[3],A[2]]=[A[2],A[3]],this.extendedFrustum.updatePoints(A))}};g.extendedFrustumParameters=function(){return this.aboveGround?
this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()};g.extendedFrustumParametersAboveSurface=function(){const A=this.surfaceElevation-1;return{zWithMargin:A,pointIndices:h.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(q){return q>A}}};g.extendedFrustumParametersBelowSurface=function(){const A=this.surfaceElevation+1;return{zWithMargin:A,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(q){return q<A}}};return d}();
const m=t.create(),z=e.create(),r=e.create(),c=new f(Array,d=>{4!==d.length&&(d[0]=new b.FeatureTileDescriptor3D,d[1]=new b.FeatureTileDescriptor3D,d[2]=new b.FeatureTileDescriptor3D,d[3]=new b.FeatureTileDescriptor3D)},d=>{d[0].release();d[1].release();d[2].release();d[3].release()});a.FeatureTileVisibility3D=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64",
"../../../geometry/support/frustum"],function(a,u,f,p,t){function w(n,b,h){n.origin=b;n.endpoint=h;f.direction(n.direction,b,h)}let e=function(){function n(h){this.renderCoordsHelper=h;this.frustum=t.create();this._points=t.createPoints();this.lines=Array(12);this._origin=p.create();this._direction=p.create();this._altitude=null;for(h=0;12>h;h++)this.lines[h]={origin:null,direction:p.create(),endpoint:null}}var b=n.prototype;b.update=function(h){t.fromMatrix(h.viewMatrix,h.projectionMatrix,this.frustum,
this._points);f.copy(this._origin,h.eye);f.copy(this._direction,h.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this.updateLines()};b.updatePoints=function(h){for(let k=0;k<this._points.length;k++)f.copy(this._points[k],h[k]);t.computePlanes(this.frustum,this._points);this.updateLines()};b.intersectsSphere=function(h){return t.intersectsSphere(this.frustum,h)};b.intersectsRay=function(h){return t.intersectsRay(this.frustum,h)};b.intersectsLineSegment=function(h,k){return t.intersectsLineSegment(this.frustum,
h,k)};b.intersectsPoint=function(h){return t.intersectsPoint(this.frustum,h)};b.updateLines=function(){const h=this._points;for(let k=0;4>k;k++){const l=k+4;w(this.lines[k],h[k],h[l]);w(this.lines[k+4],h[k],3===k?h[0]:h[k+1]);w(this.lines[k+8],h[l],3===k?h[4]:h[l+1])}};u._createClass(n,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},{key:"direction",get:function(){return this._direction}},
{key:"altitude",get:function(){return this._altitude}}]);return n}();e.planePointIndices=t.planePointIndices;e.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];a.Frustum=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ./intersectionUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){const c=.5*Math.PI,d=c/Math.PI*180;let g=function(){function B(E){this.renderCoordsHelper=E.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:e.create(),direction:e.create()};for(E=0;4>E;E++)this.extent[E]={origin:e.create(),direction:e.create(),cap:{next:null,direction:e.create()}},this.planes[E]=m.create();this.planes[4]=m.create();this.planes[5]=m.create();this.planesWithoutFar=this.planes.slice(0,5)}var v=B.prototype;
v.update=function(E,F,L,N=!0){const I=this.extent;this.toRenderBoundingExtent(E,F,L);w.add(this.center.origin,I[0].origin,I[2].origin);w.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);N||w.scale(this.center.direction,this.center.direction,-1);for(L=0;4>L;L++){const G=I[L];this.renderCoordsHelper.worldUpAtPosition(G.origin,G.direction);const K=I[3===L?0:L+1];G.cap.next=K.origin;w.direction(G.cap.direction,G.origin,
K.origin);m.fromVectorsAndPoint(G.direction,G.cap.direction,G.origin,this.planes[L]);N||w.scale(G.direction,G.direction,-1)}m.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this.planes[4]);N?m.negate(this.planes[4],this.planes[5]):(m.copy(this.planes[4],this.planes[5]),m.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(E[0]-E[2]),Math.abs(E[1]-E[3]));this.maxSpanSpatialReference=F;this.minGlobalAltitude=.9*b.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};
v.isVisibleInFrustum=function(E,F,L=!1){if(null==E)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?d:c*F))return!0;if(E.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(E)}if(0===this.maxSpan)return F=this.extent[0],!L&&E.intersectsRay(z.wrap(F.origin,F.direction))?!0:!1;for(F=0;F<this.extent.length;F++){var N=this.extent[F];if(!L&&E.intersectsRay(z.wrap(N.origin,N.direction))||E.intersectsLineSegment(l.fromPoints(N.origin,
N.cap.next,C),N.cap.direction))return!0}L=L?this.planes:this.planesWithoutFar;for(F=0;F<E.lines.length;F++)if(N=E.lines[F],r.frustumLineSegment(L,N.origin,N.endpoint,N.direction))return!0;return!1};v.toRenderBoundingExtentGlobal=function(E,F,L){k.center(E,q);q[2]=L;n.computeLinearTransformation(F,q,y,this.renderCoordsHelper.spatialReference);p.invert(x,y);h.empty(D);for(const {x0:N,x1:I,y0:G,y1:K}of A)for(let H=0;5>H;H++){const J=H/4;q[0]=f.lerp(E[N],E[I],J);q[1]=f.lerp(E[G],E[K],J);q[2]=L;n.projectVectorToVector(q,
F,q,this.renderCoordsHelper.spatialReference);w.transformMat4(q,q,x);h.expandWithVec3(D,q)}w.set(this.extent[0].origin,D[0],D[1],D[2]);w.set(this.extent[1].origin,D[3],D[1],D[2]);w.set(this.extent[2].origin,D[3],D[4],D[2]);w.set(this.extent[3].origin,D[0],D[4],D[2]);for(E=0;4>E;++E)w.transformMat4(this.extent[E].origin,this.extent[E].origin,y)};v.toRenderBoundingExtentLocal=function(E,F){w.set(this.extent[0].origin,E[0],E[1],F);w.set(this.extent[1].origin,E[2],E[1],F);w.set(this.extent[2].origin,
E[2],E[3],F);w.set(this.extent[3].origin,E[0],E[3],F)};v.toRenderBoundingExtent=function(E,F,L){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(E,F,L);break;case 2:this.toRenderBoundingExtentLocal(E,L);break;default:u.neverReached(this.renderCoordsHelper.viewingMode)}};v.isVisibleInFrustumGlobal=function(E){if(0>w.dot(this.center.direction,E.direction))return!0;for(let F=0;4>F;F++)if(0>w.dot(this.extent[F].direction,E.direction))return!0;return!1};return B}();
const A=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],q=e.create(),y=t.create(),x=t.create(),D=h.create(),C=l.create();a.FrustumExtentIntersection=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,u,f,p){const t=f.create();a.projectToBoundingBox=function(w,e,n){if(null==w||u.isNone(n))return!1;
let b;t[0]=null!=w.xmin?w.xmin:0;t[1]=null!=w.ymin?w.ymin:0;t[2]=null!=w.zmin?w.zmin:0;b=p.projectBuffer(t,w.spatialReference,0,e,n,0,1);t[0]=null!=w.xmax?w.xmax:0;t[1]=null!=w.ymax?w.ymax:0;t[2]=null!=w.zmax?w.zmax:0;b=b&&p.projectBuffer(t,w.spatialReference,0,e,n,3,1);null==w.xmin&&(e[0]=-Infinity);null==w.ymin&&(e[1]=-Infinity);null==w.zmin&&(e[2]=-Infinity);null==w.xmax&&(e[3]=Infinity);null==w.ymax&&(e[4]=Infinity);null==w.zmax&&(e[5]=Infinity);return b};a.toBoundingRect=function(w,e,n){if(null==
w)return!1;let b;t[0]=null!=w.xmin?w.xmin:0;t[1]=null!=w.ymin?w.ymin:0;t[2]=null!=w.zmin?w.zmin:0;b=p.projectBuffer(t,w.spatialReference,0,t,n,0,1);e[0]=t[0];e[1]=t[1];t[0]=null!=w.xmax?w.xmax:0;t[1]=null!=w.ymax?w.ymax:0;t[2]=null!=w.zmax?w.zmax:0;b=b&&p.projectBuffer(t,w.spatialReference,0,t,n,0,1);e[2]=t[0];e[3]=t[1];null==w.xmin&&(e[0]=-Infinity);null==w.ymin&&(e[1]=-Infinity);null==w.xmax&&(e[2]=Infinity);null==w.ymax&&(e[3]=Infinity);return b};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){f=function(C){function B(){var E=C.apply(this,arguments)||this;E._propertiesPool=new A.PropertiesPool({camera:q},a._assertThisInitialized(E));E._lastSeenCameraProjectionValues=new q;E.events=new p;E.viewingMode=1;E._cameraChanged=!1;E.updateQueue=[];E.processingUpdates=!1;return E}a._inheritsLoose(B,C);var v=B.prototype;v.init=function(E,F){this._set("viewingMode",E);this._set("spatialReference",F);this._set("constraints",new c["default"]({mode:this.viewingMode}))};
v.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new A.PropertiesPool({camera:q},this)};v.createInitialCamera=function(){if(1===this.viewingMode){const E=z.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new q(m.fromValues(4*E,0,0),m.fromValues(E,0,0),m.fromValues(0,0,1))}else this.camera=new q(m.fromValues(0,0,100),m.fromValues(0,0,0),m.fromValues(0,1,0))};v.switchCameraController=function(E){this.cameraController=E;return E.state!==
g.State.Rejected};v.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};v.updateCamera=function(E){this.updateQueue.push(E);this.processUpdateQueue()};v.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var E=this.updateQueue.shift();y.copyFrom(this._get("camera"));E(y);this.camera=y;this.processingUpdates=!1;this.processUpdateQueue()}};v.cameraProjectionChanged=function(E,
F){return E.fov!==F.fov||E.fullViewport[0]!==F.fullViewport[0]||E.fullViewport[1]!==F.fullViewport[1]||E.fullViewport[2]!==F.fullViewport[2]||E.fullViewport[3]!==F.fullViewport[3]||E.padding[0]!==F.padding[0]||E.padding[1]!==F.padding[1]||E.padding[2]!==F.padding[2]||E.padding[3]!==F.padding[3]?!0:!1};a._createClass(B,[{key:"animation",get:function(){return this.cameraController instanceof d.AnimationController&&t.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},
{key:"camera",get:function(){return this._get("camera")},set:function(E){E!==y&&y.copyFrom(E);y.computeUp(this.viewingMode);x.camera=y;this.events.emit("before-camera-change",x);E=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,y)&&(this._lastSeenCameraProjectionValues.copyFrom(y),D.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",D));if(!E||!E.equals(y))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(y)),
this._cameraChanged=!E||!E.almostEquals(y)){const F=l.afterDispatch(()=>{this._cameraChanged=!1;F.remove()})}}},{key:"contentCamera",get:function(){return t.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(E){this._contentCamera=t.isSome(E)?E.clone():null}},{key:"fixedContentCamera",get:function(){return!!t.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return 1===this.viewingMode}},{key:"isLocal",get:function(){return 2===this.viewingMode}},{key:"navigating",
get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(E){this.stopActiveCameraController()?(E&&(E.watch("state",F=>{if(F===g.State.Finished||F===g.State.Stopped)this._set("cameraController",null),this.updateCamera(L=>E.onControllerEnd(L))},!0),E.onControllerStart(this.camera)),this._set("cameraController",
E)):E&&(E.state=g.State.Rejected)}}]);return B}(f);u.__decorate([w.property({readOnly:!0,type:r})],f.prototype,"animation",null);u.__decorate([w.property({type:q})],f.prototype,"camera",null);u.__decorate([w.property({})],f.prototype,"_contentCamera",void 0);u.__decorate([w.property({type:q})],f.prototype,"contentCamera",null);u.__decorate([w.property({readOnly:!0})],f.prototype,"fixedContentCamera",null);u.__decorate([w.property({readOnly:!0})],f.prototype,"constraints",void 0);u.__decorate([w.property({readOnly:!0})],
f.prototype,"events",void 0);u.__decorate([w.property({readOnly:!0})],f.prototype,"isGlobal",null);u.__decorate([w.property({readOnly:!0})],f.prototype,"isLocal",null);u.__decorate([w.property({readOnly:!0})],f.prototype,"viewingMode",void 0);u.__decorate([w.property({readOnly:!0})],f.prototype,"spatialReference",void 0);u.__decorate([w.property({readOnly:!0})],f.prototype,"navigating",null);u.__decorate([w.property({readOnly:!0})],f.prototype,"stationary",null);u.__decorate([w.property()],f.prototype,
"_cameraChanged",void 0);u.__decorate([w.property()],f.prototype,"cameraController",null);u=f=u.__decorate([k.subclass("esri.views.3d.state.ViewState")],f);const y=new q,x={camera:null},D={camera:null};return u})},"esri/views/3d/support/PropertiesPool":function(){define(["exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(a,u,f){let p=function(){function t(e,n){this.owner=n;this.properties={};this.afterDispatchHandle=null;for(const b in e)n=new u.ReentrantObjectPool(e[b],
null,null,2,2),this.properties[b]={pool:n,acquired:[]};this.afterDispatchHandle=f.afterDispatch(()=>this.release())}var w=t.prototype;w.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const n=this.properties[e];for(const b of n.acquired)f.isValueInUse(b)||n.pool.release(b);n.pool.destroy();n.pool=null;n.acquired=null}this.owner=this.properties=null};w.get=function(e){const n=this.owner._get(e);e=this.properties[e];
let b=e.pool.acquire();for(e.acquired.push(b);b===n;)e.acquired.push(b),b=e.pool.acquire();return b};w.release=function(){for(const e in this.properties){const n=this.properties[e];let b=0;for(const h of n.acquired)f.isValueInUse(h)?n.acquired[b++]=h:n.pool.release(h);n.acquired.length=b}};return t}();a.PropertiesPool=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K){const H=e.getLogger("esri.views.3d.state.ViewStateManager");t=function(Y){function W(ca){ca=Y.call(this,ca)||this;ca.propertiesPool=new I.PropertiesPool({frustum:E.Frustum},a._assertThisInitialized(ca));ca.handles=new w;ca.cameraSetByUser=!1;ca.gotoOperation=null;ca.ready=!1;ca.updateDevicePixelRatio=null;ca.test={contentCameraResetState:new Map};return ca}a._inheritsLoose(W,Y);var ba=W.prototype;ba.installContentCameraReset=
function(ca){this.handles.remove("contentCameraReset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const da=this.zoom,ha=this.view.state.camera.distance**2,fa=g.fromArray(this.view.state.camera.center),R=ca.sticky?this.contentCamera.clone():null;this.handles.add([this.watch("contentCamera",()=>{ca.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",U=>{this.test.contentCameraResetState.set("view.zoom",
Math.abs(U-da)/2);2<Math.abs(U-da)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=R)}),this.view.state.watch("camera",U=>{U=d.squaredDistance(fa,U.center);this.test.contentCameraResetState.set("camera.center",U/ha);U>ha?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=R)})],"contentCameraReset");return!0};ba.paddingToArray=function(ca,da,ha){ca?A.set(ha,ca.top||0,ca.right||0,ca.bottom||0,ca.left||0):A.set(ha,0,0,0,0);for(ca=0;4>ca;ca++)ha[ca]=
Math.round(ha[ca]*da)};ba.initialize=function(){this.handles.add([k.on(this.view,"state.events","before-camera-change",ca=>this.updateElevation(ca.camera))]);k.once(this.view.state,"camera",ca=>this.updateElevation(ca),!0);this.handles.add(b.addFrameTask({prepare:()=>this.prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(k.on(this.view,"state.events","camera-projection-changed",()=>
this.notifyChange("scale")))};ba.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};ba.init=function(){this.constraintsManager=new v["default"]({view:this.view});this.prepareFrame();var ca=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const da of ca)this.set(da.name,da.value);this.cameraSetByUser||((ca=this.view.get("map.initialViewProperties.viewpoint")||
this.view.initialExtent)&&this.isCompatible(ca)?this.setInitialView(ca):2===this.view.state.viewingMode&&this.handles.add(k.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this.setInitialView(this.view.groundExtent)}),"pending-initial-view"))};ba.deinit=function(){this.cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),
this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};ba.goTo=function(){var ca=a._asyncToGenerator(function*(da,ha){ha={animate:!0,...ha};n.isSome(this.gotoOperation)&&this.gotoOperation.abort(ha.animate);this.gotoOperation=new F.GoToOperation(da,ha,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(da,ha){return ca.apply(this,arguments)}}();ba.debugSetCameraOnContent=function(){this.setStateCamera(B.cameraOnContentAlongViewDirection(this.view),
{applyConstraints:!1})};ba.step=function(ca){const da=this.view.state,ha=da&&this.view.state.cameraController;ha&&(da.updateCamera(fa=>{ha.stepController(ca,fa)}),ha.steppingFinished&&ha.finishController())};ba.cancelGoToOperation=function(){n.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};ba.getInitialProperties=function(){const ca=new Set,da=[];for(const {propertyName:ha,overrides:fa}of M){const R=ca.has(ha),U=this._isOverridden(ha);!R&&U&&da.push({name:ha,value:this._get(ha)});
this._clearOverride(ha);(R||U)&&fa.forEach(Z=>ca.add(Z))}return da};ba.setInitialView=function(ca){if(ca&&!this.cameraSetByUser)if(ca instanceof f)this.setStateCamera(N.externalToInternal(this.view,ca),{applyConstraints:!1});else if(ca instanceof p)if(ca.targetGeometry instanceof y){var da=N.fromExtent(this.view,ca.targetGeometry,0,.5,0);n.isSome(da)&&this.setStateCamera(N.externalToInternal(this.view,da),{applyConstraints:!0})}else da={applyConstraints:!ca.camera},ca=this.viewpointToCamera(ca),this.setStateCamera(ca,
da);else da=N.fromExtent(this.view,ca,0,.5,0),n.isSome(da)&&this.setStateCamera(N.externalToInternal(this.view,da),{applyConstraints:!0})};ba.updatePropertyBeforeReady=function(ca,da){if(this.ready)return!1;this._override(ca,da);da&&-1!==J.indexOf(ca)&&this._override("hasInitialView",!0);return!0};ba.isCompatible=function(ca){return n.isNone(ca)?!1:ca instanceof p?ca.camera?this.isCompatible(ca.camera):this.isCompatible(ca.targetGeometry):ca instanceof f?this.isCompatible(ca.position):ca.spatialReference&&
D.canProject(ca.spatialReference,this.view.spatialReference)};ba.getPreservingHeadingTilt=function(ca=O){this.cameraSetByUser?(ca.heading=this.camera.heading,ca.tilt=this.camera.tilt):(ca.heading=0,ca.tilt=.5);return ca};ba.centerPointAtDistanceToCamera=function(ca,da,ha=S){const {heading:fa,tilt:R}=this.getPreservingHeadingTilt();ca=N.getObserverForPointAtDistance(this.view,fa,R,ca,da,1);if(n.isNone(ca))return null;ha.copyFrom(this.view.state.camera);ha.eye=ca.eye;ha.center=ca.center;ha.up=ca.up;
return ha};ba.centerToCamera=function(ca){const da=this.view.pointsOfInterest.centerOnContent;da.runTask();return this.centerPointAtDistanceToCamera(ca,da.distance)};ba.extentToCamera=function(ca){const {heading:da,tilt:ha}=this.getPreservingHeadingTilt();ca=N.fromExtent(this.view,ca,da,ha,1,Q);return n.isSome(ca)?N.externalToInternal(this.view,ca):null};ba.scaleToCamera=function(ca){if(null==ca)return null;const da=this.view.pointsOfInterest.centerOnContent;da.runTask();const ha=da.renderLocation;
ca=N.scaleToDistance(this.view,ca,da.location.latitude);return this.centerPointAtDistanceToCamera(ha,ca)};ba.zoomToCamera=function(ca){return this.scaleToCamera(N.zoomToScale(this.view,ca))};ba.viewpointToCamera=function(ca){return N.externalToInternal(this.view,G.toCamera(this.view,ca))};ba.setStateCamera=function(ca,da){if(n.isNone(ca)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;da.doNotCancelGoToOperation||this.cancelGoToOperation();this.view.state.updateCamera(ha=>
{da.positionAndOrientationOnly?(ha.eye=ca.eye,ha.center=ca.center,ha.up=ca.up):ha.copyFrom(ca);da.applyConstraints&&C.applyAll(this.view,ha)});da.applyConstraints||(this.view.state.cameraController=new L.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:ca}));return!0};ba.prepareFrame=function(){const {container:ca,canvas:da}=this.view;if(ca&&da){n.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var ha=this.view.pixelRatio,fa=Math.round(ca.clientWidth*ha),R=Math.round(ca.clientHeight*
ha);if(0!==fa&&0!==R){if(da.width!==fa||da.height!==R)da.width=fa,da.height=R;if(this.view.state){const U=this.view.state.camera;if(U.fullWidth!==fa||U.fullHeight!==R||U.pixelRatio!==ha)S.copyFrom(U),S.pixelRatio!==ha&&(this.paddingToArray(this.padding,ha,V),S.padding=V),S.fullWidth=fa,S.fullHeight=R,S.pixelRatio=ha,this.view.state.camera=S}}}};ba.updateElevation=function(ca){var da=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const ha=this.view.renderCoordsHelper.getAltitude(ca.eye);
da=da?B.surfaceElevationBelowRenderLocation(this.view,ca.eye):0;ca.relativeElevation=ha-da};a._createClass(W,[{key:"camera",get:function(){const ca=this._get("camera");if(!this.ready)return ca;const da=N.internalToExternal(this.view,this.view.state.camera);return da&&ca&&da.equals(ca)?ca:da},set:function(ca){this.updatePropertyBeforeReady("camera",ca)||this.setStateCamera(N.externalToInternal(this.view,ca),{applyConstraints:!1})||H.error("#camera\x3d","Invalid camera",ca)}},{key:"contentCamera",get:function(){const ca=
this._get("contentCamera");if(!this.ready)return ca;const da=N.internalToExternal(this.view,this.view.state.contentCamera);return da&&ca&&da.equals(ca)?ca:da},set:function(ca){this.updatePropertyBeforeReady("contentCamera",ca)||(ca=N.externalToInternal(this.view,ca),n.isNone(ca)?this.view.state.contentCamera=null:(this.updateElevation(ca),this.view.state.contentCamera=ca))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(ca){this.updatePropertyBeforeReady("center",
ca)||(ca?this.isCompatible(ca)?this.setStateCamera(this.centerToCamera(ca),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():H.error("#center\x3d","Invalid center",ca):H.error("#center\x3d","Center has an incompatible spatial reference (center: "+(ca.spatialReference?ca.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",ca):H.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");
var ca=this.view;ca=N.toExtent(ca,ca.state.camera,ca.pointsOfInterest.centerOnContent.renderLocation);return n.isSome(ca)?ca:this._get("extent")},set:function(ca){this.updatePropertyBeforeReady("extent",ca)||(ca?this.isCompatible(ca)?this.setStateCamera(this.extentToCamera(ca),{applyConstraints:!0})||H.error("#extent\x3d","Invalid extent",ca):H.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(ca.spatialReference?ca.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+
")",ca):H.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const ca=this.propertiesPool.get("frustum");ca.renderCoordsHelper=this.view.renderCoordsHelper;ca.update(this.view.state.camera);return ca}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const ca=this.view.pointsOfInterest.centerOnContent;return N.distanceToScale(this.view,ca.distance,ca.location.latitude)}return this._get("scale")},
set:function(ca){this.updatePropertyBeforeReady("scale",ca)||this.setStateCamera(this.scaleToCamera(ca),{applyConstraints:!0})||H.error("#scale\x3d","Invalid scale",ca)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var ca=this.view.state.camera,da=ca.padding;const ha=ca.pixelRatio;ca=this._get("padding");const fa=Math.round(da[0]/ha),R=Math.round(da[1]/ha),U=Math.round(da[2]/ha);da=Math.round(da[3]/ha);return null!=ca&&ca.top===fa&&ca.right===R&&ca.bottom===U&&ca.left===
da?ca:{top:fa,right:R,bottom:U,left:da}},set:function(ca){this.updatePropertyBeforeReady("padding",ca)||(this.paddingToArray(ca,this.view.state.camera.pixelRatio,V),this.view.state.updateCamera(da=>da.padding=V))}},{key:"screenCenter",get:function(){const ca=this.padding;return h.createScreenPoint((this.view.width-(ca.left+ca.right))/2+ca.left,(this.view.height-(ca.top+ca.bottom))/2+ca.top)}},{key:"viewpoint",get:function(){return this.ready?G.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(ca){if(!this.updatePropertyBeforeReady("viewpoint",ca))if(ca)if(this.isCompatible(ca))this.setStateCamera(this.viewpointToCamera(ca),{applyConstraints:!ca.camera})||H.error("#viewpoint\x3d","Invalid viewpoint",ca);else{var da=n.isSome(ca.camera)?ca.camera.position:ca.targetGeometry;da=n.isSome(da)&&da.spatialReference;H.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(da?da.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",ca)}else H.error("#viewpoint\x3d",
"Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?N.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(ca){this.updatePropertyBeforeReady("zoom",ca)||this.setStateCamera(this.zoomToCamera(ca),{applyConstraints:!0})||H.error("#zoom\x3d","Invalid zoom",ca)}}]);return W}(t);u.__decorate([l.property({type:f,dependsOn:["view.state.camera","ready"]})],t.prototype,"camera",null);u.__decorate([l.property({type:f,dependsOn:["view.state.contentCamera","ready"]})],
t.prototype,"contentCamera",null);u.__decorate([l.property({type:x})],t.prototype,"center",null);u.__decorate([l.property({type:y})],t.prototype,"extent",null);u.__decorate([l.property({readOnly:!0})],t.prototype,"frustum",null);u.__decorate([l.property({readOnly:!0})],t.prototype,"hasInitialView",null);u.__decorate([l.property({readOnly:!0,type:Boolean})],t.prototype,"ready",void 0);u.__decorate([l.property({type:Number})],t.prototype,"scale",null);u.__decorate([l.property()],t.prototype,"padding",
null);u.__decorate([l.property({readOnly:!0})],t.prototype,"screenCenter",null);u.__decorate([l.property({constructOnly:!0})],t.prototype,"view",void 0);u.__decorate([l.property({type:p})],t.prototype,"viewpoint",null);u.__decorate([l.property({type:Number})],t.prototype,"zoom",null);u.__decorate([l.property({constructOnly:!0})],t.prototype,"updateDevicePixelRatio",void 0);u=t=u.__decorate([c.subclass("esri.views.3d.state.ViewStateManager")],t);const J="camera viewpoint extent scale center zoom".split(" "),
M=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],O={heading:0,tilt:0},Q=new f,S=new K,V=q.create();return u})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){a.ConstraintsManager=function(A){function q(x){var D=A.call(this,x)||this;D._handles=new t;D.nearFarHeuristic=d.createNearFarHeuristic(x.view.state.viewingMode,x.view.basemapTerrain,x.view.renderCoordsHelper.spatialReference);return D}u._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",x=>this._updateCameraNearFar(x.camera)),this.view.watch("dataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(n.init(this.view,"dataExtent",x=>this._updateLocalSurfaceDistance(x)));this._updateNearFar();2!==this.view.state.viewingMode&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new g["default"]({view:this.view}))};y.destroy=function(){this._handles=e.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};y._clipDistanceNearFarChanged=function(){const x=this.view.constraints&&this.view.constraints.clipDistance;x&&"auto"!==x.mode&&this.view.state.updateCamera(D=>{this._updateCameraNearFarManual(D,x);return!0})};y._updateNearFar=function(){this.view.state.updateCamera(x=>{this._updateCameraNearFar(x);return!0})};y._updateCameraNearFar=function(x){const D=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(D?D.mode:"auto")?this._updateCameraNearFarManual(x,
D):this._updateCameraNearFarAuto(x,D)};y._updateCameraNearFarAuto=function(x,D){this.nearFarHeuristic.compute(x.eye,x.center,this.view.dataExtent,c.surfaceElevationBelowRenderLocation(this.view,x.eye),x);D&&D.autoUpdate(x.near,x.far)};y._updateCameraNearFarManual=function(x,D){D&&(x.near=D.near,x.far=D.far)};y._updateCollision=function(){var x,D,C;const B=null==(x=this.view.map)?void 0:null==(D=x.ground)?void 0:null==(C=D.navigationConstraint)?void 0:C.type;x=B?"stay-above"===B:!0;D=this.view.state.constraints.collision;
x!==D.enabled&&((D.enabled=x)&&this._reapplyConstraints(8),(x=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==x.mode||this._updateTiltAuto())};y._updateAltitude=function(){const x=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=x&&2!==this.view.state.viewingMode?{min:x.min,max:x.max}:null;this._reapplyConstraints()};y._updateTiltMax=function(){const x=this.view.constraints&&this.view.constraints.tilt;x&&"auto"!==x.mode&&(this._updateTiltManual(x),
this._reapplyConstraints())};y._updateTilt=function(){const x=this.view.constraints&&this.view.constraints.tilt;"manual"===(x?x.mode:"auto")?this._updateTiltManual(x):this._updateTiltAuto();this._reapplyConstraints()};y._updateTiltManual=function(x){const D=this.view.state.constraints;D.tilt=D.createConstantMaxTilt(w.deg2rad(x.max))};y._updateTiltAuto=function(){const x=this.view.state.constraints;x.tilt=x.createDefaultTilt();this._updateTiltAutoMax()};y._updateTiltAutoMax=function(){const x=this.view.constraints&&
this.view.constraints.tilt;if(x&&"auto"===x.mode){var D=this.view.state.constraints;D.tilt&&(D=D.tilt(this.view.state.camera.distance).max,x.autoUpdate(w.rad2deg(D)))}};y._updateLocalSurfaceDistance=function(x){var D=Math.max(x.width,x.height);0>=D||(x.hasZ&&(D=Math.max(D,x.zmax-x.zmin)),x=this.view.state,D=3*D/Math.atan(x.camera.fov/2),D!==x.constraints.distance&&(x.constraints.distance=D))};y._reapplyConstraints=function(x=15){this.view.state.updateCamera(D=>r.applyAll(this.view,D,{selection:x,
interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0}))};return q}(p);f.__decorate([b.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);f.__decorate([b.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=f.__decorate([z.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);a.default=a.ConstraintsManager;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid".split(" "),function(a,u,f,p,t,w){function e(l,m,z,r){z=2/z;l/m>z?(r.far=l,r.near=r.far/m):(r.near=z,r.far=r.near*m);return r}let n=function(){function l(m,z){this.elevationProvider=m;this._referenceEllipsoid=w.getReferenceEllipsoid(z);this.unitInMeters=f.getMetersPerUnitForSR(z,this._referenceEllipsoid.metersPerDegree)}
l.prototype.compute=function(m,z,r,c,d){d||(d={near:0,far:0});var g=m[2]*this.unitInMeters,A=g;c=g-c;var q=this.elevationProvider?this.elevationProvider.elevationBounds:null;q&&(g=0<=c?A-this.unitInMeters*q.min:this.unitInMeters*q.max-A);A=Math.max(r.xmax-r.xmin,r.ymax-r.ymin,4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin));p.subtract(k,z,m);h[0]=0<k[0]?r.xmax:r.xmin;h[1]=0<k[1]?r.ymax:r.ymin;h[2]=0<k[2]?A/2:-A/2;p.subtract(h,h,m);p.normalize(k,k);m=1.1*p.dot(h,k)*this.unitInMeters;z=Math.sqrt(g*(g+2*this._referenceEllipsoid.radius));
r=Math.max(r.xmax-r.xmin,r.ymax-r.ymin);q=1E-4*r*this.unitInMeters;g=u.clamp((g-q)/(.001*r*this.unitInMeters-q),0,1);g=u.lerp(z,m,g*g*g);g*=Math.max(Math.log(Math.abs(c)),1);g=Math.min(g,Math.max(34064E4,A));g/=this.unitInMeters;return e(g,2E4,this.unitInMeters,d)};return l}(),b=function(){function l(m){this._referenceEllipsoid=w.getReferenceEllipsoid(m)}l.prototype.compute=function(m,z,r,c,d){d||(d={near:0,far:0});m=p.length(m)-this._referenceEllipsoid.radius;m=Math.max(Math.abs(m-c),Math.abs(m));
c=Math.sqrt(m*(m+2*(this._referenceEllipsoid.radius+Math.min(0,c))));m=u.clamp(2E4-(Math.log(m)-7.983)/9.011*19E3,1E3,2E4);return e(1.2*c,m,1,d)};return l}();const h=t.create(),k=t.create();a.createNearFarHeuristic=function(l,m,z){return 1===l?new b(z):new n(m,z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/mathUtils ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vectorStacks ../camera/constraintUtils/surfaceCollision ../../../geometry/projectionEllipsoid ../camera/intersectionUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){a.SurfaceCollisionConstraint=function(A){function q(x){x=A.call(this,x)||this;x.handles=new t;return x}u._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",x=>this.handleElevationChangeEvent(x)))};y.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};y.handleElevationChangeEvent=function(x){this.view.state.cameraController||g.eyeWithinExtent(this.view,this.view.state.camera,
x.extent,x.spatialReference)&&this.applyToCurrentCamera()};y.applyToCurrentCamera=function(){this.view.state.updateCamera(x=>{c.applySurfaceCollisionConstraint(this.view,x,1)})};return q}(p);f.__decorate([w.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=f.__decorate([k.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);a.default=a.SurfaceCollisionConstraint;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){let r=
function(){function c(g,A,q){this.target=g;this.options=A;this.view=q;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((y,x)=>{this.resolveCallback=y;this.rejectCallback=x;y=w.createAbortController();if(t.isSome(this.options.signal))w.onAbort(this.options.signal,()=>{this.abort()});this.abortController=y;this.waitForReady()})}var d=c.prototype;d.then=function(g,A){return this.promise.then(g,A)};d.catch=function(g){return this.promise.catch(g)};d.resolve=
function(g){this.state="finished";return this.resolveCallback(g)};d.reject=function(g){this.state="finished";return this.rejectCallback(g)};d.abort=function(g=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(w.createAbortError());break;case "wait-for-animation-finish":!g&&t.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(w.createAbortError())}};
d.waitForReady=function(){this.state="wait-for-ready";this.view.ready?this.createViewPoint():e.whenOnce(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},g=>{this.reject(g)})};d.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,m.create(this.view,this.target,this.abortController.signal).then(g=>{"finished"!==this.state&&(g=this.getCameraFromViewpoint(g),
t.isNone(g)||(this.options.animate?t.isNone(this.animationController)||this.startAnimation(g,this.animationController):(this.view.stateManager.setStateCamera(g.camera,{applyConstraints:!g.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},g=>{this.reject(g)}))};d.getCameraFromViewpoint=function(g){const A=!!(this.target instanceof f&&this.target.camera||this.target instanceof u);var q=g.camera;if(t.isNone(q))return null;if(!this.view.stateManager.isCompatible(q))return g=
(g=q.position)&&g.spatialReference,this.reject(new p("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${g?g.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:q})),null;q=l.externalToInternal(this.view,q);return t.isNone(q)?(this.reject(new p("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:g,camera:q,isFullySpecified:A}};d.startAnimation=function(g,A){this.state="wait-for-animation-finish";
const q=A.viewAnimation;if(t.isNone(q))this.reject(new p("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{q.update(g.viewpoint,"running");if(!A.active||t.isNone(A.viewAnimation)||A.viewAnimation.target!==g.viewpoint||this.view.state.cameraController!==A)return this.abort();if(g.isFullySpecified){var y=new k.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:g.camera});z.applySurfaceCollisionConstraint(this.view,g.camera,1)}else n.applyAll(this.view,
g.camera);A.begin(g.camera,this.options);var x=D=>{if(!t.isNone(this.view.state))switch(A.state){case b.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case b.State.Ready:case b.State.Rejected:case b.State.Running:case b.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(D)}}};q.when(()=>{const D=this.view.state.cameraController;
y&&(D&&D.active?D instanceof h.PointToPointAnimationController&&t.isSome(D.viewAnimation)&&D.viewAnimation.target===g.viewpoint&&(this.view.state.cameraController=y):t.isSome(A.viewAnimation)&&A.viewAnimation.target===g.viewpoint&&"finished"===A.state&&(this.view.state.cameraController=y))},D=>x(D));A.asyncResult={resolve:()=>x(),reject:D=>x(D)}}};d.getAnimationController=function(){let g;var A=null;A=this.view.state.cameraController;A instanceof h.PointToPointAnimationController&&(A.updateStateFromViewAnimation(),
A.active&&(g=A,A=g.viewAnimation));return null!=g||(g=new h.PointToPointAnimationController({view:this.view,mode:"animation"}),A=g.viewAnimation,this.view.state.switchCameraController(g))?g:(t.isSome(A)&&A.stop(),this.reject(new p("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return c}();a.GoToOperation=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/mathUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils/surfaceCollision ../../../../geometry/projectionEllipsoid ../../camera/intersectionUtils ./CameraController".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){a.SurfaceCollisionCorrectionController=function(A){function q(x){x=A.call(this,x)||this;x.handles=new p;return x}u._inheritsLoose(q,A);var y=q.prototype;y.onControllerStart=function(){this.state=g.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",x=>this.handleElevationChangeEvent(x)));this.applyCorrection()};y.onControllerEnd=function(){this.handles.removeAll()};y.stepController=function(){};y.handleElevationChangeEvent=function(x){d.eyeWithinExtent(this.view,
this.desiredCamera,x.extent,x.spatialReference)&&this.applyCorrection()};y.applyCorrection=function(){this.view.state.updateCamera(x=>{x.copyViewFrom(this.desiredCamera);r.applySurfaceCollisionConstraint(this.view,x,1)||this.constraintEnabled||(this.state=g.State.Stopped)})};u._createClass(q,[{key:"desiredCamera",set:function(x){this._set("desiredCamera",x.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return q}(g.CameraController);f.__decorate([t.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);f.__decorate([t.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=f.__decorate([h.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./mathUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Point".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L){function N(ua){return 360-B.cyclicalDeg.normalize(ua)}function I(ua){return B.cyclicalDeg.normalize(360-ua)}function G(ua){h.isSome(ua)&&ua.resolver&&ua.resolver.reject();return null}function K(ua,Ba,Ea,Ga=null){if(!Ba)return G(Ga);var ma=ua.spatialReference||v.WGS84;if(h.isSome(Ba.camera)){ua=Ba.get("camera.position.spatialReference");if(!y.canProject(ua,ma))return G(Ga);Ba=Ba.camera.clone();ua.equals(ma)||(Ba.position=y.project(Ba.position,
ma));ua=Ba;h.isSome(Ga)&&Ga.resolver&&Ga.resolver.resolve(ua);return ua}if(h.isNone(Ba.targetGeometry))return G(Ga);var ya=Ba.get("targetGeometry.spatialReference");if(ya&&!y.canProject(ya,ma))return G(Ga);ma=D.internalToExternal(ua,ua.state.camera);ya=1;null!=Ba.rotation&&(ma.heading=N(Ba.rotation),ya=0);null!=Ea&&(ma.tilt=Ea);if("point"===Ba.targetGeometry.type){const Ma=Ba.targetGeometry;Ea=Ba.targetGeometry.clone();Ba=null!=Ba.scale?D.scaleToDistance(ua,Ba.scale,Ma.latitude):ua.state.camera.distance;
return D.fromCenterDistance(ua,Ea,Ba,ma,ya,Ga)}return D.fromExtent(ua,Ba.targetGeometry.extent,ma.heading,ma.tilt,ya,Ga)}function H(){H=u._asyncToGenerator(function*(ua,Ba,Ea){if(Ba&&ua.spatialReference){var Ga={target:null};if("declaredClass"in Ba||Array.isArray(Ba))Ga.target=Ba;else{for(var ma in Ba)Ga[ma]=Ba[ma];Ba.center&&!Ga.target&&(Ga.target=Ba.center)}Ba=Ga}else Ba=null;if(!Ba)throw new b("viewpointutils-create:no-target","Missing target for creating viewpoint");Ga=new f({fov:ua.camera.fov});
ma=new w({camera:Ga});if(Ba.target instanceof w)return ua=yield ba(ua,Ba.target,Ba,Ea,ma),aa(ua);if(Ba.target instanceof f)return aa(da(ua,Ba.target,ma));var ya=null!=Ba.scale||null!=Ba.zoom;if(Ba.target instanceof E){var Ma=Ba.target.xmin===Ba.target.xmax||Ba.target.ymin===Ba.target.ymax;return ya||Ma?aa(yield ha(ua,Ba,Ba.target.center,Ga,Ea,ma)):aa(yield Z(ua,Ba,Ba.target,Ga,Ea,ma))}Ma={boundingBox:g.empty(),hasZ:!1,screenSpaceObjects:[]};var Ra=ya?D.scaleToResolution(ua,J(ua,Ba)):void 0;yield Y(ua,
Ba.target,Ra,Ma);if(isFinite(Ma.boundingBox[0])){g.center(Ma.boundingBox,ja);Fa.x=ja[0];Fa.y=ja[1];Fa.z=ja[2];Fa.spatialReference=ua.spatialReference;isFinite(Fa.z)&&Ma.hasZ?Ra=g.isPoint(Ma.boundingBox):(Fa.z=void 0,Ra=A.isPoint(g.toRect(Ma.boundingBox,ta)));if(ya||Ra)return aa(yield ha(ua,Ba,Fa,Ga,Ea,ma));ya=Ma.screenSpaceObjects;if(ya.length){Ra=Number.NEGATIVE_INFINITY;for(let ea=0;ea<ya.length;ea++){const Ua=ya[ea].screenSpaceBoundingRect;Ra=Math.max(Ra,Math.abs(Ua[0]),Math.abs(Ua[1]),Math.abs(Ua[2]),
Math.abs(Ua[3]))}ya=.66-Ra/Math.min(ua.width,ua.height)*2}else ya=.66;return aa(yield P(ua,Ba,Fa,Ma.boundingBox,ya,Ga,Ea,ma))}return Ba.position?(Ea=x.cameraOnContentAlongViewDirection(ua),r.copy(pa,Ea.viewForward),D.directionToHeadingTilt(ua,Ea.eye,pa,Ea.up,Ka),Ga.position=new L(Ba.position),Ga.heading=null!=Ba.heading?Ba.heading:Ka.heading,Ga.tilt=null!=Ba.tilt?Ba.tilt:Ka.tilt,ua=O(ua,null,Ga,ma),aa(ua)):aa(yield R(ua,Ba,Ga,Ea,ma))});return H.apply(this,arguments)}function J(ua,Ba){return null==
Ba.scale&&null!=Ba.zoom?D.zoomToScale(ua,Ba.zoom):Ba.scale}function M(ua,Ba){let Ea=!1;null!=Ba.heading?(ua.heading=Ba.heading,Ea=!0):null!=Ba.rotation&&(ua.heading=N(Ba.rotation),Ea=!0);null!=Ba.tilt&&(ua.tilt=Ba.tilt,Ea=!0);null!=Ba.fov&&(ua.fov=Ba.fov);return Ea}function O(ua,Ba,Ea,Ga){const ma=ua.spatialReference||v.WGS84;Ba=h.isSome(Ba)?Ba:D.externalToInternal(ua,Ea);if(h.isNone(Ba))return Ga;Ga.targetGeometry=d.projectVectorToPoint(Ba.center,ua.renderSpatialReference,ma);Ga.scale=D.computeScale(ua,
Ba);Ga.rotation=I(Ea.heading);Ga.camera=Ea;return Ga}function Q(ua,Ba,Ea){if(Ba){if(!y.canProject(Ba.spatialReference,ua.spatialReference))throw new b("viewpointutils:incompatible-spatialreference",`Spatial reference (${Ba.spatialReference?Ba.spatialReference.wkid:"unknown"}) is incompatible with the view (${ua.spatialReference.wkid})`,{geometry:Ba});var Ga=[];if(!Ba.hasZ&&ua.basemapTerrain){switch(Ba.type){case "point":var ma=Ba;break;case "multipoint":case "polyline":ma=Ba.extent.center;break;case "mesh":ma=
Ba.origin;break;case "extent":ma=Ba.center;break;case "polygon":ma=Ba.centroid}ma&&y.canProject(ma,ua.basemapTerrain.spatialReference)?ja[2]=h.unwrapOr(C.getElevationAtPoint(ua.elevationProvider,ma),0):ja[2]=0}(0,Ha[Ba.type])(Ba,Ma=>{Ga.push(Ma[0],Ma[1],Ma[2])},ja);var ya=Ga.length/3;if(0!==ya&&(ma=Array(Ga.length),d.projectBuffer(Ga,Ba.spatialReference,0,ma,ua.spatialReference,0,ya)))for(Ba.hasZ&&(Ea.hasZ=!0),ua=0;ua<ma.length;ua+=3)Ba.hasZ?(ja[0]=ma[ua+0],ja[1]=ma[ua+1],ja[2]=ma[ua+2]):(ja[0]=ma[ua+
0],ja[1]=ma[ua+1]),g.expandWithVec3(Ea.boundingBox,ja)}}function S(ua,Ba,Ea,Ga){return V.apply(this,arguments)}function V(){V=u._asyncToGenerator(function*(ua,Ba,Ea,Ga){const ma=yield e.result(ua.whenViewForGraphic(Ba));if(!1!==ma.ok&&!h.isNone(ma.value)&&"whenGraphicBounds"in ma.value)if(Ea=yield e.result(ma.value.whenGraphicBounds(Ba,{minDemResolution:Ea})),!1===Ea.ok)Q(ua,Ba.geometry,Ga);else{var {screenSpaceObjects:ya,boundingBox:Ma}=Ea.value;g.expandWithAABB(Ga.boundingBox,Ma);ya&&ya.forEach(Ra=>
{Ga.screenSpaceObjects.push(Ra)});isFinite(Ma[2])&&(Ga.hasZ=!0)}else Q(ua,Ba.geometry,Ga)});return V.apply(this,arguments)}function Y(ua,Ba,Ea,Ga){return W.apply(this,arguments)}function W(){W=u._asyncToGenerator(function*(ua,Ba,Ea,Ga){if(Array.isArray(Ba)&&2===Ba.length){const ma=Ba[0],ya=Ba[1];if("number"===typeof ma&&"number"===typeof ya){Fa.x=ma;Fa.y=ya;Fa.z=void 0;Fa.spatialReference=ua.spatialReference.isGeographic?ua.spatialReference:v.WGS84;Q(ua,Fa,Ga);return}}Ba&&"function"===typeof Ba.map?
yield k.eachAlways(Ba.map(ma=>Y(ua,ma,Ea,Ga))):Ba instanceof F?Q(ua,Ba,Ga):Ba instanceof t&&(yield S(ua,Ba,Ea,Ga))});return W.apply(this,arguments)}function ba(ua,Ba,Ea,Ga,ma){return ca.apply(this,arguments)}function ca(){ca=u._asyncToGenerator(function*(ua,Ba,Ea,Ga,ma){if(h.isSome(Ba.camera))return da(ua,Ba.camera,ma);ma.scale=Ba.scale;ma.rotation=Ba.rotation;ma.targetGeometry=h.isSome(Ba.targetGeometry)?Ba.targetGeometry.clone():null;ma.camera=null;null!=Ea.heading?ma.rotation=I(Ea.heading):null!=
Ea.rotation&&(ma.rotation=Ea.rotation);Ba=J(ua,Ea);null!=Ba&&(ma.scale=Ba);Ga=new D.AsyncContext(Ga);K(ua,ma,Ea.tilt,Ga);ma.camera=yield Ga.resolver.promise;return ma});return ca.apply(this,arguments)}function da(ua,Ba,Ea){const Ga=ua.spatialReference,ma=Ba.position.spatialReference;if(!y.canProject(ma,Ga))return null;Ba=Ba.clone();Ba.fov=ua.camera.fov;ma.equals(Ga)||(Ba.position=y.project(Ba.position,Ga));return O(ua,null,Ba,Ea)}function ha(ua,Ba,Ea,Ga,ma,ya){return fa.apply(this,arguments)}function fa(){fa=
u._asyncToGenerator(function*(ua,Ba,Ea,Ga,ma,ya){if(h.isNone(Ea))throw new b("createfromcenter","invalid point");ya.targetGeometry=Ea.clone();const Ma=x.cameraOnContentAlongViewDirection(ua);if(Ba.position)return Ea=ya.targetGeometry,ma=ua.renderSpatialReference,d.projectPointToVector(Ba.position,xa,ma),d.projectPointToVector(Ea,Da,ma),ya.targetGeometry=new L(Ea),Ga.position=new L(Ba.position),r.subtract(pa,Da,xa),D.directionToHeadingTilt(ua,xa,pa,Ma.up,Ga),ya.scale=D.distanceToScale(ua,r.distance(xa,
Da),ya.targetGeometry.latitude),ya.rotation=I(Ga.heading),ya.camera=Ga,ya;if(Ba.zoomFactor){var Ra=Ma.distance/Ba.zoomFactor;const ea=r.scale(ja,Ma.viewForward,-Ra);Ma.eye=r.add(ja,Ma.center,ea);ya.scale=D.distanceToScale(ua,Ra,Ea.latitude)}D.internalToExternal(ua,Ma,Ga);Ra=M(Ga,Ba)?0:1;Ba.zoomFactor||(ya.scale=J(ua,Ba),null==ya.scale&&(d.projectPointToVector(Ea,ja,ua.renderSpatialReference),q.intersectsPoint(Ma.frustum,ja)?ya.scale=D.distanceToScale(ua,r.distance(Ma.eye,ja),Ea.latitude):ya.scale=
D.computeScale(ua,Ma)),Ba=new D.AsyncContext(ma),D.fromCenterScale(ua,ya.targetGeometry,ya.scale,Ga,Ra,Ba),ya.camera=yield Ba.resolver.promise);return ya});return fa.apply(this,arguments)}function R(ua,Ba,Ea,Ga,ma){return U.apply(this,arguments)}function U(){U=u._asyncToGenerator(function*(ua,Ba,Ea,Ga,ma){var ya=x.cameraOnContentAlongViewDirection(ua);ya=d.projectVectorToPoint(ya.center,ua.renderSpatialReference,ua.spatialReference);return ha(ua,Ba,ya,Ea,Ga,ma)});return U.apply(this,arguments)}function Z(ua,
Ba,Ea,Ga,ma,ya){return T.apply(this,arguments)}function T(){T=u._asyncToGenerator(function*(ua,Ba,Ea,Ga,ma,ya){ya.targetGeometry=Ea.clone();const Ma=x.cameraOnContentAlongViewDirection(ua);D.internalToExternal(ua,Ma,Ga);Ba=M(Ga,Ba)?0:1;ma=new D.AsyncContext(ma);D.fromExtent(ua,Ea,Ga.heading,Ga.tilt,Ba,ma);ya.camera=yield ma.resolver.promise;return ya});return T.apply(this,arguments)}function P(ua,Ba,Ea,Ga,ma,ya,Ma,Ra){return X.apply(this,arguments)}function X(){X=u._asyncToGenerator(function*(ua,
Ba,Ea,Ga,ma,ya,Ma,Ra){Ra.targetGeometry=Ea.clone();const ea=x.cameraOnContentAlongViewDirection(ua);var Ua=0;Ea.hasZ?Ua=Ea.z:ua.basemapTerrain&&(Ua=h.unwrap(C.getElevationAtPoint(ua.elevationProvider,Ea)));r.set(ja,Ea.x,Ea.y,Ua);d.computeLinearTransformation(ua.spatialReference,ja,ia,ua.renderSpatialReference);l.fromMat4(ka,ia);l.transpose(ka,ka);g.empty(na);Ea=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Qa=0;Qa<Ea.length;Qa++){const ra=Ea[Qa];let va=Ga[ra[2]];isFinite(va)||
(va=Ua);r.set(ja,Ga[ra[0]],Ga[ra[1]],va);d.projectVectorToVector(ja,ua.spatialReference,ja,ua.renderSpatialReference);g.expandWithVec3(na,r.transformMat3(ja,ja,ka))}Ga=g.width(na);Ua=g.height(na);Ea=g.depth(na);Qa=1/Math.tan(ea.fovY/2);ma=Math.max(.5*Math.sqrt(Ga*Ga+Ea*Ea)*Math.max(Qa,1/Math.tan(ea.fovX/2))+.5*Ua,.5*Ua*Qa+.5*Math.max(Ga,Ea))/ma;D.internalToExternal(ua,ea,ya);Ba=M(ya,Ba)?0:1;Ra.scale=D.distanceToScale(ua,ma,Ra.targetGeometry.latitude);Ma=new D.AsyncContext(Ma);D.fromCenterScale(ua,
Ra.targetGeometry,Ra.scale,ya,Ba,Ma);Ra.camera=yield Ma.resolver.promise;return Ra});return X.apply(this,arguments)}function aa(ua){ua&&h.isSome(ua.camera)&&(ua.rotation=I(ua.camera.heading));return ua}const ja=c.create(),ia=z.create(),ka=m.create(),na=g.create(),ta=A.create(),pa=c.create(),xa=c.create(),Da=c.create(),Ka={heading:0,tilt:0},Fa=new L,Ha={point(ua,Ba,Ea){Ea[0]=ua.x;Ea[1]=ua.y;ua.hasZ&&(Ea[2]=ua.z);Ba(Ea)},polygon(ua,Ba,Ea){const Ga=ua.hasZ;for(let ma=0;ma<ua.rings.length;ma++){const ya=
ua.rings[ma];for(let Ma=0;Ma<ya.length;Ma++)Ea[0]=ya[Ma][0],Ea[1]=ya[Ma][1],Ga&&(Ea[2]=ya[Ma][2]),Ba(Ea)}},polyline(ua,Ba,Ea){const Ga=ua.hasZ;for(let ma=0;ma<ua.paths.length;ma++){const ya=ua.paths[ma];for(let Ma=0;Ma<ya.length;Ma++)Ea[0]=ya[Ma][0],Ea[1]=ya[Ma][1],Ga&&(Ea[2]=ya[Ma][2]),Ba(Ea)}},multipoint(ua,Ba,Ea){const Ga=ua.points;ua=ua.hasZ;for(let ma=0;ma<Ga.length;ma++)Ea[0]=Ga[ma][0],Ea[1]=Ga[ma][1],ua&&(Ea[2]=Ga[ma][2]),Ba(Ea)},extent(ua,Ba,Ea){ua.hasZ?(Ba(r.set(Ea,ua.xmin,ua.ymin,ua.zmin)),
Ba(r.set(Ea,ua.xmax,ua.ymin,ua.zmin)),Ba(r.set(Ea,ua.xmin,ua.ymax,ua.zmin)),Ba(r.set(Ea,ua.xmax,ua.ymax,ua.zmin)),Ba(r.set(Ea,ua.xmin,ua.ymin,ua.zmax)),Ba(r.set(Ea,ua.xmax,ua.ymin,ua.zmax)),Ba(r.set(Ea,ua.xmin,ua.ymax,ua.zmax)),Ba(r.set(Ea,ua.xmax,ua.ymax,ua.zmax))):(Ba(r.set(Ea,ua.xmin,ua.ymin,Ea[2])),Ba(r.set(Ea,ua.xmax,ua.ymin,Ea[2])),Ba(r.set(Ea,ua.xmin,ua.ymax,Ea[2])),Ba(r.set(Ea,ua.xmax,ua.ymax,Ea[2])))},mesh(ua,Ba,Ea){if(ua=ua.vertexAttributes&&ua.vertexAttributes.position)for(let Ga=0;Ga<
ua.length;Ga+=3)Ba(r.set(Ea,ua[Ga+0],ua[Ga+1],ua[Ga+2]))}};a.create=function(ua,Ba,Ea){return H.apply(this,arguments)};a.fromCamera=function(ua,Ba,Ea=null){h.isNone(Ea)&&(Ea=new w);return O(ua,null,Ba.clone(),Ea)};a.headingToRotation=I;a.rotationToHeading=N;a.toCamera=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(A,q,y){for(const x of A)q&&!q(x)||y.push(x);return y}function m(A){r||(r=new h.Intersector(A));r.viewingMode=A;return r}let z=function(){function A(y,x,D){this.viewingMode=y;this.layerProvider=x;this.view=D;this.externalIntersectionHandlers=new f;this.tolerance=h.Intersector.DEFAULT_TOLERANCE;this.tmpRay=e.create();this.validateHUDIntersector=new h.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var q=A.prototype;q.intersectScreen=
function(y,x){return this.intersectRay(this.getPickRay(y,this.tmpRay),m(this.viewingMode),x)};q.intersectScreenFreePointFallback=function(y,x){return this.intersectRayFreePointFallback(this.getPickRay(y,this.tmpRay),x)};q.intersectRayFreePointFallback=function(y,x){return this.intersectRay(y,m(this.viewingMode),x)||this.intersectRayFreePointLocal(y,x)};q.intersectRay=function(y,x,D,C){x.options.selectionMode=!1;x.options.store=0;this.computeIntersection(y,x,C);return x.results.min?x.results.min.getIntersectionPoint(D):
!1};q.getCenterRayWithSubpixelOffset=function(y,x,D=.5,C=.5){y.getRenderCenter(g,D,C);g[0]+=.0466;g[1]-=.0123;return b.fromRenderAtEye(y,g,x)};q.intersectIntersectorScreen=function(y,x,D){this.computeIntersection(this.getPickRay(y,this.tmpRay),x,D)};q.intersectToolIntersectorScreen=function(y,x,D){y=this.getPickRay(y,this.tmpRay);this.intersectToolIntersectorRay(y,x,D)};q.intersectToolIntersectorRay=function(y,x,D){x.options.selectionMode=!0;this.computeIntersection(y,x,D);const C=x.results.min;this.view.basemapTerrain&&
this.view.basemapTerrain.opaque||C.hasIntersectionPoint&&"TerrainRenderer"!==C.intersector||(x.options.selectionMode=!1,this.computeIntersection(y,x,D))};q.setTolerance=function(y=h.Intersector.DEFAULT_TOLERANCE){this.tolerance=y};q.addIntersectionHandler=function(y){this.externalIntersectionHandlers.push(y);this.externalIntersectionHandlers.sort((x,D)=>"Terrain"===x.type?1:"Terrain"===D.type?-1:0)};q.removeIntersectionHandler=function(y){this.externalIntersectionHandlers.removeUnordered(y);this.externalIntersectionHandlers.sort((x,
D)=>"Terrain"===x.type?1:"Terrain"===D.type?-1:0)};q.getPickRay=function(y,x=e.create()){return b.fromScreen(this.view.state.camera,y,x)};q.intersectRayFreePointLocal=function(y,x){if(2!==this.viewingMode||u.isNone(y))return!1;var D=this.view.dataExtent,C=Math.max(D.xmax-D.xmin,D.ymax-D.ymin,8*Math.max(D.xmax-D.xmin,D.ymax-D.ymin));if(0===C)return t.add(x,y.origin,t.normalize(n.sv3d.get(),y.direction)),!0;var B=this.view.state.camera;const v=Math.max(0,D.xmin-B.eye[0],B.eye[0]-D.xmax);D=Math.max(0,
D.ymin-B.eye[1],B.eye[1]-D.ymax);B=C/Math.max(1,Math.max(0,Math.log(C/(Math.abs(B.relativeElevation)+Number.MIN_VALUE)))**2);B=Math.max(B,Math.min(Math.sqrt(v*v+D*D),C));C=t.scale(n.sv3d.get(),y.direction,B/t.length(y.direction));t.add(x,y.origin,C);return!0};q.intersectElevationFromScreen=function(y,x,D=0,C=null){return this.intersectElevation(this.getPickRay(y,this.tmpRay),x,D,C)};q.intersectElevation=function(y,x,D=0,C=null){if(u.isNone(y))return null;var B=u.isSome(x)?x.mode:"absolute-height",
v=u.isSome(x)?u.unwrapOr(x.offset,0):0,E="on-the-ground"!==B?v+D:0;x=E/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===B)return this.view.renderCoordsHelper.intersectInfiniteManifold(y,E,d)?(D=this.view.computeMapPointFromVec3d(d),D.z-=v,D):null;v=this.view.state.camera;const F=p.castRenderScreenPointArray3(n.sv3d.get());v.projectToRenderScreen(y.origin,F);E=this.prepareFilters(null,c);const L=this.view.slicePlane,N=u.isSome(L)?k.sliceFilterPredicate(L):null,I=new h.Intersector(this.viewingMode);
I.options.store=0;I.options.verticalOffset=x;x=y.origin;y=t.add(n.sv3d.get(),x,y.direction);I.reset(x,y);I.point=F;I.camera=v;I.filterPredicate=null;const G=u.isSome(C)?"type"in C&&"graphics"===C.type?K=>K.metadata.layerUid!==C.uid:K=>K.metadata.graphicUid!==C.uid:null;switch(B){case "relative-to-scene":I.intersect(E.layers,F,v,this.tolerance,null,K=>(u.isNone(G)||G(K))&&K.metadata&&K.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(K=>{"I3S"!==K.type&&"Terrain"!==K.type||K.intersect(I,
K.slicePlane?N:null,I.rayBeginPoint,I.rayEndPoint,F)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(K=>{K.isGround&&K.intersect(I,K.slicePlane?N:null,I.rayBeginPoint,I.rayEndPoint,F)})}return I.results.min.getIntersectionPoint(d)?(B=this.view.computeMapPointFromVec3d(d),B.z=D,B):null};q.computeIntersection=function(y,x,D){if(!u.isNone(y)){var C=this.view.state.camera,B=p.castRenderScreenPointArray3(n.sv3d.get());C.projectToRenderScreen(y.origin,B);
var v=this.prepareFilters(D,c);x.options.selectOpaqueTerrainOnly=!D||!("include"in D||"exclude"in D);var E=y.origin,F=t.add(n.sv3d.get(),y.origin,y.direction);x.reset(E,F);x.intersect(v.layers,B,C,this.tolerance);y=this.view.slicePlane;var L=u.isSome(y)?k.sliceFilterPredicate(y):null;x.intersect(v.sliceableLayers,B,C,this.tolerance,L);var N=D&&(D.requiresGroundFeedback||D.enableDraped);this.externalIntersectionHandlers.forAll(I=>{x.options.isFiltered=!v.filterLayerUid(I.intersectionHandlerId);(I.isGround&&
N||!x.options.isFiltered)&&I.intersect(x,I.slicePlane?L:null,E,F,B)});y=n.sv3d.get();if(D&&D.enableDraped&&x.results.ground.getIntersectionPoint(y)){D=this.view.basemapTerrain.overlayManager.renderer;const I=this.view.renderCoordsHelper.spatialReference,G=n.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(y,G,this.view.spatialReference);G[2]=u.unwrapOr(this.view.elevationProvider.getElevation(y[0],y[1],y[2],I,"ground"),0);D.intersect(x,G,v.filterRenderGeometry)}x.sortResults();y=x.results.hud;
if(y.hasIntersectionPoint){const I=p.castRenderScreenPointArray3(n.sv3d.get()),G=n.sv3d.get(),K=n.sv3d.get();this.unprojectHUDResultRay(y.center,I,G,K);D=t.distance(y.center,G)/t.distance(G,K)*.99;this.validateHUDIntersector.reset(G,K);this.validateHUDIntersector.intersect(v.layers,I,C,this.tolerance);this.validateHUDIntersector.intersect(v.sliceableLayers,I,C,this.tolerance,L);this.externalIntersectionHandlers.forAll(H=>{v.filterLayerUid(H.intersectionHandlerId)&&H.intersect(this.validateHUDIntersector,
H.slicePlane?L:null,G,K,I)});C=this.validateHUDIntersector.results.min;if(null==C.dist||D<=C.dist)x.results.min.copyFrom(y),x.results.all.splice(0,0,y)}}};q.prepareFilters=function(y,x){const D=[],C=[];this.layerProvider.forEachLayer(B=>{B.isPickable&&(B.isSliceable?C:D).push(B)});x.include=y&&y.include;x.exclude=y&&y.exclude;x.layers.length=0;x.sliceableLayers.length=0;l(D,x.filterLayer,x.layers);l(C,x.filterLayer,x.sliceableLayers);return x};q.unprojectHUDResultRay=function(y,x,D,C){const B=this.view.state.camera;
B.projectToRenderScreen(y,x);y=p.castRenderScreenPointArray3(n.sv3d.get());y[0]=x[0];y[1]=x[1];y[2]=0;B.unprojectFromRenderScreen(y,D);y[2]=1;B.unprojectFromRenderScreen(y,C)};return A}(),r;const c={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer(A){return c.filterLayerUid(A.apiLayerUid)},filterLayerUid(A){const {include:q,exclude:y}=c;return u.isNone(A)?null==q&&null==y:(null==q||q.has(A))&&(null==y||!y.has(A))},filterRenderGeometry(A){return c.filterLayerUid(A.layerUid)}},d=w.create(),
g=p.createRenderScreenPointArray();a.SceneIntersectionHelper=z;a.isIntersectionHandler=function(A){return"object"===typeof A&&"intersect"in A};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(c,d,g,A,q,y,x){for(const D of d)d=D.getElevation(g,A,q,y,x),w.isSome(d)&&(c=w.isSome(c)?Math.max(d,c):d);return c}a.CombinedElevationProvider=function(c){function d(A){A=c.call(this,A)||this;A.im=[];A.ground=[];A.scene=[];A.handles=new Map;return A}u._inheritsLoose(d,c);var g=d.prototype;g.destroy=function(){this._elevationQuery=w.destroyMaybe(this._elevationQuery)};g.getElevation=function(A,q,y,x,D){let C;C=r(null,this.im,A,q,y,x,D);w.isNone(C)&&(C=
r(C,this.ground,A,q,y,x,D));"scene"===D&&(C=r(C,this.scene,A,q,y,x,D));return C};g.queryElevation=function(A,q,y,x,D,C=null,B=0){const v=e.createResolver();this.elevationQuery.queryElevation(A,q,C,B).then(E=>{"scene"===D&&(E=r(E,this.scene,A,q,y,x,D));v.resolve(E)}).catch(E=>{e.isAbortError(E)?v.reject(E):v.resolve(this.getElevation(A,q,y,x,D))});return v.promise};g.register=function(A,q){this.handles.set(q,q.on("elevation-change",y=>this.emit("elevation-change",y)));this[A].push(q)};g.unregister=
function(A){this.handles.has(A)&&(this.handles.get(A).remove(),this.handles.delete(A));for(const q of[this.im,this.ground,this.scene]){const y=q.indexOf(A);-1<y&&q.splice(y,1)}};u._createClass(d,[{key:"elevationQuery",get:function(){w.isNone(this._elevationQuery)&&(this._elevationQuery=new z.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return d}(t.EventedMixin(p));
f.__decorate([n.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,"view",void 0);f.__decorate([n.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=f.__decorate([m.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,u,f,p,t,w,e,n){f=function(){function h(l,m){this.spatialReference=l;this.view=m}var k=h.prototype;k.getElevation=function(l,m,z){return this.view.elevationProvider.getElevation(l,m,0,this.spatialReference,z)};k.queryElevation=function(){var l=u._asyncToGenerator(function*(m,z,r,c,d){return this.view.elevationProvider.queryElevation(m,z,0,this.spatialReference,d,r,c)});return function(m,z,r,c,d){return l.apply(this,arguments)}}();return h}();let b=function(){function h(l,m,z,r){this.spatialReference=
m;this._getElevationQueryProvider=z;this._queries=[];this._queryOptions={...r,ignoreInvisibleLayers:!0};this._frameTask=l.registerTask(e.TaskPriority.ELEVATION_QUERY,this)}var k=h.prototype;k.destroy=function(){this._frameTask.remove()};k.queryElevation=function(l,m,z,r=0){return new Promise((c,d)=>{const g={x:l,y:m,minDemResolution:r,result:{resolve:c,reject:d},signal:z};this._queries.push(g);w.onAbort(z,()=>{p.remove(this._queries,g);d(w.createAbortError())})})};k.runTask=function(){const l=this._queries;
this._queries=[];const m=this._getElevationQueryProvider();if(m){var z=l.map(g=>[g.x,g.y]),r=l.reduce((g,A)=>Math.min(g,A.minDemResolution),Infinity);z=new n({points:z,spatialReference:this.spatialReference});var c=1<l.length&&l.some(g=>!!g.signal)?w.createAbortController():null,d=t.isSome(c)?c.signal:l[0].signal;if(t.isSome(c)){let g=0;l.forEach(A=>w.onAbort(A.signal,()=>{g++;A.result.reject(w.createAbortError());g===l.length&&c.abort()}))}m.queryElevation(z,{...this._queryOptions,minDemResolution:r,
signal:d}).then(g=>{l.forEach((A,q)=>{t.isSome(A.signal)&&A.signal.aborted?A.result.reject(w.createAbortError()):A.result.resolve(g.geometry.points[q][2])})}).catch(g=>{l.forEach(A=>A.result.reject(g))})}else l.forEach(g=>g.result.reject())};u._createClass(h,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const l=this;return{update:()=>0<l._queries.length&&l.runTask()}}}]);return h}();a.ElevationQuery=b;a.ViewElevationProvider=f;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function u(){const p=!!a("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},
tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:p?.8:1,polylineLodFactor:p?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,
lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:p},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:p?600:750,additionalCacheMemory:p?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:p?1.2:2,polylineLodFactor:p?1.2:2},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,
highQualityTransparency:!0,memoryLimit:p?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:p?null:4096,maximumPixelRatio:p?1:null}}}let f=function(){function p(){}p.isValidProfile=function(t){return t in p.profiles};p.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};p.apply=function(t,w){t=p.profiles[t];w.graphics3D.maxTotalNumberOfFeatures=t.graphics3D.maxTotalNumberOfFeatures;w.graphics3D.maxTotalNumberOfPrimitives=t.graphics3D.maxTotalNumberOfPrimitives;
w.graphics3D.polygonLodFactor=t.graphics3D.polygonLodFactor;w.graphics3D.polylineLodFactor=t.graphics3D.polylineLodFactor;{const e=w.sceneService["3dObject"],n=t.sceneService["3dObject"];e.lodFactor=n.lodFactor;e.lodCrossfadeinDuration=n.lodCrossfadeinDuration;e.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration;e.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}w.sceneService.point.lodFactor=t.sceneService.point.lodFactor;w.sceneService.integratedMesh.lodFactor=t.sceneService.integratedMesh.lodFactor;
w.sceneService.pointCloud.lodFactor=t.sceneService.pointCloud.lodFactor;w.sceneService.uncompressedTextureDownsamplingEnabled=t.sceneService.uncompressedTextureDownsamplingEnabled;w.tiledSurface.lodBias=t.tiledSurface.lodBias;w.tiledSurface.angledSplitBias=t.tiledSurface.angledSplitBias;w.tiledSurface.reduceTileLevelDifferences=t.tiledSurface.reduceTileLevelDifferences;w.tiledSurface.textureFadeDuration=t.tiledSurface.textureFadeDuration;w.antialiasingEnabled=t.antialiasingEnabled;w.physicallyBasedRenderingEnabled=
t.physicalBasedRenderingEnabled;w.highQualityTransparency=t.highQualityTransparency;w.memoryLimit=t.memoryLimit;w.additionalCacheMemory=t.additionalCacheMemory;w.frameRate=t.frameRate;w.maximumRenderResolution=t.maximumRenderResolution;w.maximumPixelRatio=t.maximumPixelRatio};return p}();f.debug={reset(){const p=u();for(const t in p)f.profiles[t]=p[t]}};(f||(f={})).profiles=u();return f})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){p=function(m){function z(){var r=m.apply(this,arguments)||this;r.color=new f([0,255,255]);r.haloColor=null;r.haloOpacity=1;r.fillOpacity=.25;r.shadowOpacity=.4;r.shadowColor=new f([0,0,0]);r.shadowDifference=.2;return r}a._inheritsLoose(z,m);z.toEngineOptions=function(r){const c=f.toUnitRGBA(r.color),d=t.isSome(r.haloColor)?f.toUnitRGBA(r.haloColor):c,g=f.toUnitRGBA(r.shadowColor);return{color:l.fromValues(c[0],c[1],c[2],c[3]),haloColor:l.fromValues(d[0],d[1],d[2],
d[3]),haloOpacity:r.haloOpacity,haloOpacityOccluded:.25*r.haloOpacity,fillOpacity:r.fillOpacity,fillOpacityOccluded:.25*r.fillOpacity,shadowOpacity:r.shadowOpacity,shadowColor:l.fromValues(g[0],g[1],g[2],g[3]),occludedShadowOpacity:r.shadowOpacity*(1-r.shadowDifference)}};return z}(p);u.__decorate([w.property({type:f})],p.prototype,"color",void 0);u.__decorate([w.property({type:f})],p.prototype,"haloColor",void 0);u.__decorate([w.property()],p.prototype,"haloOpacity",void 0);u.__decorate([w.property()],
p.prototype,"fillOpacity",void 0);u.__decorate([w.property()],p.prototype,"shadowOpacity",void 0);u.__decorate([w.property({type:f})],p.prototype,"shadowColor",void 0);u.__decorate([w.property()],p.prototype,"shadowDifference",void 0);return p=u.__decorate([k.subclass("esri.views.3d.support.HighlightOptions")],p)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function u(){return new Float32Array(4)}function f(A){const q=new Float32Array(4);q[0]=A[0];q[1]=A[1];q[2]=A[2];q[3]=A[3];
return q}function p(A,q,y,x){const D=new Float32Array(4);D[0]=A;D[1]=q;D[2]=y;D[3]=x;return D}function t(A,q){return new Float32Array(A,q,4)}function w(){return u()}function e(){return p(1,1,1,1)}function n(){return p(1,0,0,0)}function b(){return p(0,1,0,0)}function h(){return p(0,0,1,0)}function k(){return p(0,0,0,1)}const l=u(),m=e(),z=n(),r=b(),c=h(),d=k();var g=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,zeros:w,ones:e,unitX:n,unitY:b,unitZ:h,unitW:k,ZEROS:l,ONES:m,
UNIT_X:z,UNIT_Y:r,UNIT_Z:c,UNIT_W:d});a.ONES=m;a.UNIT_W=d;a.UNIT_X=z;a.UNIT_Y=r;a.UNIT_Z=c;a.ZEROS=l;a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.ones=e;a.unitW=k;a.unitX=n;a.unitY=b;a.unitZ=h;a.vec4f32=g;a.zeros=w})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/asyncUtils ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){f=function(){function l(z,r,c=null){this.spatialReference=r;this.unitInMeters=w.getMetersPerUnitForSR(this.spatialReference,e.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServicePromise=p.result(this.loadGeometryService(z,c))}var m=l.prototype;m.loadGeometryService=function(){var z=u._asyncToGenerator(function*(r,c){if(c)return c;try{return yield n.create(r&&r.get("portalItem"))}catch{throw new t("mapcoordshelper:missing-geometry-service",
"Must specify geometryService in esri/config");}});return function(r,c){return z.apply(this,arguments)}}();m.awaitGeometryService=function(){var z=u._asyncToGenerator(function*(){const r=yield this._geometryServicePromise;if(!0===r.ok)return r.value;throw r.error;});return function(){return z.apply(this,arguments)}}();m.toGeographic=function(){var z=u._asyncToGenerator(function*(r){var c=yield this.awaitGeometryService();let d=!0;Array.isArray(r[0])&&"number"!==typeof r[0]||(r=[r],d=!1);r=r.map(g=>
g instanceof h?g:new h(g,this.spatialReference));r=new b({geometries:r,outSpatialReference:k.WGS84});c=(yield c.project(r)).map(g=>"point"===g.type?[g.x,g.y]:void 0);return d?c:c[0]});return function(r){return z.apply(this,arguments)}}();return l}();a.MapCoordsHelper=f;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/support/ProjectParameters".split(" "),
function(a,u,f,p,t,w,e){function n(){return b.apply(this,arguments)}function b(){b=f._asyncToGenerator(function*(k=null,l){if(p.geometryServiceUrl)return new (yield new Promise(function(m,z){a(["../../tasks/GeometryService"],function(r){m(Object.freeze({__proto__:null,"default":r}))},z)})).default({url:p.geometryServiceUrl});if(!k)throw new t("internal:geometry-service-url-not-configured");k="portal"in k?k.portal||w.getDefault():k;yield k.load({signal:l});if(k.helperServices&&k.helperServices.geometry&&
k.helperServices.geometry.url)return new (yield new Promise(function(m,z){a(["../../tasks/GeometryService"],function(r){m(Object.freeze({__proto__:null,"default":r}))},z)})).default({url:k.helperServices.geometry.url});throw new t("internal:geometry-service-url-not-configured");});return b.apply(this,arguments)}function h(){h=f._asyncToGenerator(function*(k,l,m=null,z){m=yield n(m,z);const r=new e;r.geometries=[k];r.outSpatialReference=l;if((k=yield m.project(r,{signal:z}))&&Array.isArray(k)&&1===
k.length)return k[0];throw new t("internal:geometry-service-projection-failed");});return h.apply(this,arguments)}u.create=n;u.projectGeometry=function(k,l){return h.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h){f=function(k){function l(m){m=k.call(this,m)||this;m.geometries=null;m.outSpatialReference=null;m.transformation=null;m.transformForward=null;return m}a._inheritsLoose(l,k);l.prototype.toJSON=function(){const m=this.geometries.map(function(c){return c.toJSON()}),z=this.geometries[0],r={};r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());r.inSR=z.spatialReference.wkid||JSON.stringify(z.spatialReference.toJSON());r.geometries=JSON.stringify({geometryType:h.getJsonType(z),
geometries:m});this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(r.transformForward=this.transformForward);return r};return l}(f.JSONSupport);u.__decorate([p.property()],f.prototype,"geometries",void 0);u.__decorate([p.property({json:{read:{source:"outSR"}}})],f.prototype,"outSpatialReference",void 0);u.__decorate([p.property()],f.prototype,"transformation",void 0);u.__decorate([p.property()],f.prototype,"transformForward",
void 0);return f=u.__decorate([b.subclass("esri.rest.support.ProjectParameters")],f)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b){let h=function(r){function c(){var d=
r.apply(this,arguments)||this;d.minTotalNumberOfFeatures=2E3;d.maxTotalNumberOfFeatures=5E4;d.maxTotalNumberOfPrimitives=17E5;d.polygonLodFactor=1;d.polylineLodFactor=1;return d}a._inheritsLoose(c,r);return c}(f);u.__decorate([p.property()],h.prototype,"minTotalNumberOfFeatures",void 0);u.__decorate([p.property()],h.prototype,"maxTotalNumberOfFeatures",void 0);u.__decorate([p.property()],h.prototype,"maxTotalNumberOfPrimitives",void 0);u.__decorate([p.property()],h.prototype,"polygonLodFactor",void 0);
u.__decorate([p.property()],h.prototype,"polylineLodFactor",void 0);h=u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],h);let k=function(r){function c(){var d=r.apply(this,arguments)||this;d.lodFactor=1;return d}a._inheritsLoose(c,r);return c}(f);u.__decorate([p.property()],k.prototype,"lodFactor",void 0);k=u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],k);let l=function(r){function c(){var d=r.apply(this,arguments)||this;
d.lodCrossfadeinDuration=0;d.lodCrossfadeoutDuration=0;d.lodCrossfadeUncoveredDuration=0;return d}a._inheritsLoose(c,r);return c}(k);l=u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],l);let m=function(r){function c(){var d=r.apply(this,arguments)||this;d["3dObject"]=new l;d.point=new k;d.integratedMesh=new k;d.pointCloud=new k;d.uncompressedTextureDownsamplingEnabled=!1;return d}a._inheritsLoose(c,r);return c}(f);u.__decorate([p.property({type:l})],m.prototype,
"3dObject",void 0);u.__decorate([p.property({type:k})],m.prototype,"point",void 0);u.__decorate([p.property({type:k})],m.prototype,"integratedMesh",void 0);u.__decorate([p.property({type:k})],m.prototype,"pointCloud",void 0);u.__decorate([p.property()],m.prototype,"uncompressedTextureDownsamplingEnabled",void 0);m=u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],m);let z=function(r){function c(){var d=r.apply(this,arguments)||this;d.lodBias=0;d.angledSplitBias=
1;d.reduceTileLevelDifferences=!0;d.textureFadeDuration=500;return d}a._inheritsLoose(c,r);return c}(f);u.__decorate([p.property()],z.prototype,"lodBias",void 0);u.__decorate([p.property()],z.prototype,"angledSplitBias",void 0);u.__decorate([p.property()],z.prototype,"reduceTileLevelDifferences",void 0);u.__decorate([p.property()],z.prototype,"textureFadeDuration",void 0);z=u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],z);f=function(r){function c(){var d=
r.apply(this,arguments)||this;d.graphics3D=new h;d.sceneService=new m;d.tiledSurface=new z;d.antialiasingEnabled=!0;d.physicallyBasedRenderingEnabled=!1;d.highQualityTransparency=!0;return d}a._inheritsLoose(c,r);return c}(f);u.__decorate([p.property({type:h})],f.prototype,"graphics3D",void 0);u.__decorate([p.property({type:m})],f.prototype,"sceneService",void 0);u.__decorate([p.property({type:z})],f.prototype,"tiledSurface",void 0);u.__decorate([p.property()],f.prototype,"antialiasingEnabled",void 0);
u.__decorate([p.property()],f.prototype,"physicallyBasedRenderingEnabled",void 0);u.__decorate([p.property()],f.prototype,"highQualityTransparency",void 0);u.__decorate([p.property()],f.prototype,"memoryLimit",void 0);u.__decorate([p.property()],f.prototype,"additionalCacheMemory",void 0);u.__decorate([p.property()],f.prototype,"frameRate",void 0);u.__decorate([p.property()],f.prototype,"maximumRenderResolution",void 0);u.__decorate([p.property()],f.prototype,"maximumPixelRatio",void 0);return f=
u.__decorate([b.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],f)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){let m=function(){function z(c,d,g,A){this.viewingMode=c;this.spatialReference=d;this.unitInMeters=g;this.coordinateSystem=A;this._coordinateSystem=b.create(A)}var r=z.prototype;r.getAltitude=function(c){return b.altitudeAt(this.coordinateSystem,c)};r.setAltitude=function(c,d,g=c){return b.setAltitudeAt(this.coordinateSystem,g,d,c)};r.setAltitudeOfTransformation=function(c,d){b.setAltitudeOfTransformation(this.coordinateSystem,d,c,d)};r.worldUpAtPosition=function(c,
d){return b.normalAt(this.coordinateSystem,c,d)};r.worldBasisAtPosition=function(c,d,g){return b.axisAt(this.coordinateSystem,c,d,g)};r.basisMatrixAtPosition=function(c,d){const g=this.worldBasisAtPosition(c,0,k.sv3d.get()),A=this.worldBasisAtPosition(c,1,k.sv3d.get());c=this.worldBasisAtPosition(c,2,k.sv3d.get());t.set(d,g[0],g[1],g[2],0,A[0],A[1],A[2],0,c[0],c[1],c[2],0,0,0,0,1);return d};r.intersectManifoldClosestSilhouette=function(c,d,g){b.elevate(this.coordinateSystem,d,this._coordinateSystem);
b.intersectRayClosestSilhouette(this._coordinateSystem,c,g);return g};r.intersectManifold=function(c,d,g){b.elevate(this.coordinateSystem,d,this._coordinateSystem);d=k.sv3d.get();return b.intersectRay(this._coordinateSystem,c,d)?w.copy(g,d):null};r.intersectInfiniteManifold=function(c,d,g){if(1===this.viewingMode)return this.intersectManifold(c,d,g);b.elevate(this.coordinateSystem,d,this._coordinateSystem);d=this._coordinateSystem.value;const A=k.sv3d.get();return h.intersectRay(d.plane,c,A)?w.copy(g,
A):null};r.toRenderCoords=function(c,d,g){return l.isDehydratedPoint(c)?e.projectPointToVector(c,d,this.spatialReference):e.projectVectorToVector(c,d,g,this.spatialReference)};r.fromRenderCoords=function(c,d,g=null){return l.isDehydratedPoint(d)?(f.isSome(g)&&(d.spatialReference=g),e.projectVectorToDehydratedPoint(c,this.spatialReference,d)):d instanceof n?e.projectVectorToPoint(c,this.spatialReference,d):e.projectVectorToVector(c,this.spatialReference,d,g)?d:null};z.create=function(c,d){switch(c){case 2:return new z(2,
d,p.getMetersPerUnitForSR(d),b.createLocal());case 1:return new z(1,d,1,b.createGlobal(d))}};u._createClass(z,[{key:"extent",set:function(c){c&&b.setExtent(this.coordinateSystem,c,this.coordinateSystem)}}]);return z}();a.RenderCoordsHelper=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){a.ResourceControllerMain=function(q){function y(){var x=q.apply(this,arguments)||this;x.updating=!1;return x}u._inheritsLoose(y,q);return y}(p);f.__decorate([b.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=f.__decorate([z.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var A;(function(q){let y=function(x){function D(){var B=x.apply(this,arguments)||this;B._scheduler=
null;B._memoryController=null;B._streamDataLoader=null;B._cameraChangeTime=0;B._handles=new t;B._frameTask=null;B._scheduleTask=g.ImmediateTask;return B}u._inheritsLoose(D,x);var C=D.prototype;C.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=g.newScheduler(this.now);this._memoryController=c.newMemoryController(this.view);this._streamDataLoader=new d["default"];this._streamDataLoader.setup(r.maxDownloadSlots,r.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",
(B,v)=>this._cameraChangedHandler(B,v),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=e.addFrameTask({update:B=>this.frame(B)});this._scheduleTask=this._scheduler.registerTask(g.TaskPriority.RESOURCE_CONTROLLER)};C.destroy=function(){this._handles=w.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=w.removeMaybe(this._frameTask);this._streamDataLoader=
w.destroyMaybe(this._streamDataLoader);this._memoryController=w.destroyMaybe(this._memoryController);this._scheduler=w.destroyMaybe(this._scheduler)};C.schedule=function(B,v,E){return this._scheduleTask.schedule(B,v,E)};C.createStreamDataRequester=function(B){const v=this._streamDataLoader;return{request(E,F,L){return v.request(E,F,B,L)},get busy(){return!v.hasDownloadSlots(B)}}};C.frame=function(B){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(n.SecondsFromMilliseconds(B.deltaTime)),
!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(B)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};C._cameraChangedHandler=function(B,v){B&&v&&B.almostEquals(v)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};C._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};u._createClass(D,[{key:"updating",get:function(){var B,v;return!!(null!=
(B=this._memoryController)&&B.updating||null!=(v=this._streamDataLoader)&&v.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"state",get:function(){const B=this.view;return B.animation?0:B.interacting||300>=this._scheduler.now-this._cameraChangeTime?1:2}},{key:"test",get:function(){return{getQueueStats:B=>this._streamDataLoader.test.loadQueue.getStatsForType(B),state:this.state}}}]);return D}(a.ResourceControllerMain);
f.__decorate([b.property({constructOnly:!0})],y.prototype,"view",void 0);f.__decorate([b.property({constructOnly:!0})],y.prototype,"now",void 0);f.__decorate([b.property()],y.prototype,"_scheduler",void 0);f.__decorate([b.property()],y.prototype,"_memoryController",void 0);f.__decorate([b.property()],y.prototype,"_streamDataLoader",void 0);f.__decorate([b.property({readOnly:!0})],y.prototype,"updating",null);y=f.__decorate([z.subclass("esri.views.3d.support.ResourceController")],y);q.ResourceController=
y})(A||(A={}));a.newResourceController=function(q,y=()=>performance.now()){return new A.ResourceController({view:q,now:y})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.downloadSlotsPerClient=[10,10,10,10,5];a.maxDownloadSlots=30;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),
function(a,u,f,p,t,w,e){const n=p.getLogger("esri.views.3d.support.MemoryController");let b=function(){function h(l){this._view=l;this.events=new f;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new w.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var k=h.prototype;k.destroy=function(){this.events=null;this._cacheStorage.destroy()};
k.getMemCache=function(l,m){return new w.MemCache(l,this._cacheStorage,m)};k.disableMemCache=function(){this._additionalCacheMemory=-4096};k.resetStableQuality=function(){this._stableQuality=0};k.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var l=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(l){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<
this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,l=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>
this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,l=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==l&&(this._updating=l,this.events.emit("updating-changed",this.updating))}};k._updateQuality=function(l){l=Math.min(Math.max(l,this.minQuality),1);if(l===this._quality)return!1;this._quality=l;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};k._layersUpdating=function(){return this._view.allLayerViews.some(l=>
!!l.updating)};k._updateMemory=function(){let l=0,m=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(l+=this._view.basemapTerrain.getUsedMemory());var z=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;t.isSome(z)&&(l+=z.usedMemory);this._view.allLayerViews&&this._view.allLayerViews.forEach(c=>{if(e.isMemoryManagedLayerView(c)){const d=c.ignoresMemoryFactor()?this._quality:1;l+=c.getUsedMemory()*d;m+=c.getUnloadedMemory()*d}});var r=null==
this._warnMemoryUsage||Math.round(10*l)!==Math.round(10*this._warnMemoryUsage);z=1048576*this._maxMemory;if(l>z&&r){this._warnMemoryUsage=l;r=d=>(d/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const c=Math.round(100*this._quality);n.warn(`Memory Limit exceeded! Limit: ${r(z)} Current: ${r(l)} Projected: ${r(l+m)} Quality: ${c}%`)}this._memoryUsed=l/z;this._memoryPredicted=(l+m)/z;this._cacheStorage.maxSize=Math.max(0,z-l+1048576*this._additionalCacheMemory);this.events.emit("memory-used",
this._memoryUsed)};u._createClass(h,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(l){null!=l&&0<l&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<l&&this._updateQuality(1),this._maxMemory=l)}},{key:"additionalCacheMemory",set:function(l){null!=l&&0<=l&&(this._additionalCacheMemory=l)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",
get:function(){const l=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const m=l._numQualityChanges;l._numQualityChanges=0;return m}}}}]);return h}();a.newMemoryController=function(h){return new b(h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(u){return"function"===typeof u.getUsedMemory};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ./StreamDataLoaderTask ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){function y(D){if(2>D.byteLength)return"unknown";D=new Uint8Array(D,0,D.byteLength);return 137===D[0]&&80===D[1]?"image/png":71===D[0]&&73===D[1]?"image/gif":66===D[0]&&77===D[1]?"image/bmp":255===D[0]&&216===D[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(D){function C(){var v=D.apply(this,arguments)||this;v.tasks=new Map;v.onLoadQueue=[];v.doneQueue=[];v.updating=!1;return v}u._inheritsLoose(C,D);var B=C.prototype;B.setup=function(v,E,F){this.loadQueue=
new d.AsyncWorkerQueue((L,N)=>this.startLoading(L,N),(L,N)=>this.doneLoadingCallback(L,N),v,E);F&&(this.taskHandle=F.registerTask(q.TaskPriority.STREAM_DATA_LOADER,this))};B.destroy=function(){this.taskHandle=b.removeMaybe(this.taskHandle);this.tasks.forEach(v=>{v.abortController&&v.abortController.abort()});this.loadQueue.destroy();this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};B.hasDownloadSlots=function(v){return this.loadQueue.hasQuota(v)};B.request=function(v,E,F,L={}){const N=
h.createResolver();N.__signal=b.isSome(L)?L.signal:null;const I=this.createOrUpdateTask(v,E,F,L,N);h.onAbort(L,()=>this.cancelRequest(I,N));return N.promise};B.createTask=function(v,E,F,L,N,I){v=new g(v,E,F,L,N);this.updateTask(v,I);this.tasks.set(N,v);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(v);return v};B.cancelRequest=function(v,E){w.removeUnordered(v.resolvers,E);E.reject(h.createAbortError());0===v.resolvers.length&&(2===v.status&&(v.status=4,this.loadQueue.cancel(v),
v.abortController.abort(),v.request=null,v.abortController=null),v.status=4,this.tasks.delete(v.key),0===this.tasks.size&&this._set("updating",!1))};B.taskKey=function(v,E,F){return`${v}:${E}:${F}`};B.updateTask=function(v,E){v.resolvers.push(E)};B.createOrUpdateTask=function(v,E,F,L,N){var I=b.isSome(L)&&L.uid||v;I=this.taskKey(I,E,F);const G=this.tasks.get(I);return G?(this.updateTask(G,N),G):this.createTask(v,L,E,F,I,N)};B.doneLoadingCallback=function(v,E){this.loadQueue&&(A.assert(2===v.status),
v.status=3,this.taskHandle?this.doneQueue.push({task:v,err:E}):this.doneLoading(v,E))};B.runTask=function(v){for(;!v.done&&0<this.onLoadQueue.length;){var E=this.onLoadQueue.shift();h.throwIfAborted(E.task.abortController);E.task.abortController=null;E.callback(E.task);v.madeProgress()}for(;!v.done&&0<this.doneQueue.length;)E=this.doneQueue.shift(),3!==E.task.status&&(E.err=E.err||h.createAbortError()),this.doneLoading(E.task,E.err),v.madeProgress()};B.doneLoading=function(v,E){let F=v.result instanceof
HTMLImageElement?0:v.resolvers.length;for(const L of v.resolvers)if(E)h.isAbortError(E)?L.reject(E):L.reject(new e("stream-data-loader:request-error",`Failed to request resource at '${v.url}'. ${E}`,{url:v.url,error:E}));else{--F;const N=0>=F?v.result:n.clone(v.result);L.resolve(N)}this.tasks.delete(v.key);0===this.tasks.size&&this._set("updating",!1)};B.startLoading=function(v,E){if(4===v.status)return!1;v.startTime=performance.now();v.status=2;let F,L;switch(v.docType){case "binary":L="array-buffer";
F=0;break;case "image":L="image";break;case "image+type":L="array-buffer";break;default:L="json"}v.abortController=h.createAbortController();const N=v.abortController.signal;v.request=p(v.url,{...v.options,responseType:L,timeout:F,signal:N});let I=()=>{};const G=H=>{v.duration=performance.now()-v.startTime;v.size=H instanceof ArrayBuffer?H.byteLength:v.size||0;v.result=H;this.taskHandle?this.onLoadQueue.push({callback:E,task:v}):(v.abortController=null,E(v))},K=H=>{2===v.status&&E(v,H);I()};if("image+type"!==
v.docType)return v.request.then(H=>G(H.data),K),!0;v.request.then(H=>{H=H.data;const J=y(H);L="image";v.size=H.byteLength;if("unknown"===J)v.request=p(v.url,{responseType:L,timeout:F,signal:N}),v.request.then(O=>G(O.data),K);else{H=new Blob([H],{type:J});var M=window.URL.createObjectURL(H);I=()=>window.URL.revokeObjectURL(M);v.request=p(M,{responseType:L,timeout:F,signal:N});v.request.then(O=>G(new x(O.data,J,I)),K)}},K);return!0};u._createClass(C,[{key:"running",get:function(){return 0<this.doneQueue.length||
0<this.onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this.loadQueue}}}]);return C}(t);f.__decorate([k.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=f.__decorate([c.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);let x=function(){function D(C,B,v){this.image=C;this.type=B;this.release=v}u._createClass(D,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return D}();f=a.StreamDataLoader;a.ImageWithType=
x;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,u,f){let p=function(e){this.typeWorkerQuota=e;this.tasks=[];this.numWorkers=0;this.statistics=new t},t=function(){this.speed=this.duration=this.size=this.requests=0},w=function(){function e(b,h,k,l){this._workerFunc=b;this._callbackFunc=h;this._maxTotalNumWorkers=k;this._totalNumWorkers=
0;this._clients=l.map(m=>new p(m))}var n=e.prototype;n.hasQuota=function(b){return(b=this._clients[b])?this._totalNumWorkers<this._maxTotalNumWorkers||b.numWorkers+b.tasks.length<b.typeWorkerQuota:!1};n.push=function(b){const h=this._clients[b.client];h&&(this._totalNumWorkers<this._maxTotalNumWorkers?(h.numWorkers++,this._totalNumWorkers++,this._workerFunc(b,(k,l)=>this._taskCallback(k,l))):h.tasks.push(b))};n.cancel=function(b){this._taskFinished(b);b._cancelled=!0};n.destroy=function(){this._clients.length=
0};n._taskFinished=function(b){const h=this._clients[b.client];this._totalNumWorkers--;h.numWorkers--;h.statistics.requests++;h.statistics.size+=b.size||0;h.statistics.duration+=b.duration||0;h.statistics.speed=0<h.statistics.duration?h.statistics.size/h.statistics.duration:0;f.assert(0<=h.numWorkers);this._next()};n._next=function(){for(const b of this._clients)if(b&&b.numWorkers<b.typeWorkerQuota&&this._processQueue(b))return;for(const b of this._clients)if(b&&this._processQueue(b))break};n._processQueue=
function(b){for(;0<b.tasks.length;)if(this._workerFunc(b.tasks.shift(),(h,k)=>this._taskCallback(h,k)))return b.numWorkers++,this._totalNumWorkers++,!0;return!1};n._taskCallback=function(b,h){b._cancelled||(this._callbackFunc(b,h),this._taskFinished(b))};n.getStatsForType=function(b){return(b=this._clients[b])?{quota:b.typeWorkerQuota,workers:b.numWorkers,queueSize:b.tasks.length,requestStats:b.statistics}:null};u._createClass(e,[{key:"test",get:function(){const b=this;return{set workerFunc(h){b._workerFunc=
h}}}}]);return e}();a.AsyncWorkerQueue=w;a.BaseTask=function(e){this.client=e;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./AsyncWorkerQueue"],function(a,u){return function(f){function p(t,w,e,n,b){n=f.call(this,n)||this;n.url=t;n.options=w;n.docType=e;n.key=b;n.result=null;n.status=1;n.request=null;n.abortController=null;n.resolvers=[];
n.startTime=0;return n}a._inheritsLoose(p,f);return p}(u.BaseTask)})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,u,f,p){return function(t){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var w=t.resourceController.memoryController;this.totalMemory=1048576*w.maxMemory;
this.usedMemory=Math.round(w.usedMemory*this.totalMemory);this.quality=w.memoryFactor;this.load=t.resourceController.scheduler.load;this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;w=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=a.isSome(w)?w.usedMemory:0;t.allLayerViews.items.forEach(e=>{(u.isMemoryManagedLayerView(e)||p.isSurfaceLayerView(e))&&this.layerPerformanceInfos.push(new f(e,t))});this.layerPerformanceInfos.sort((e,n)=>n.memory-e.memory)}})},
"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,u){return function(f,p){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=f.layer;this.memory=u.isSurfaceLayerView(f)?p.basemapTerrain.getUsedMemoryForLayerView(f):f.getUsedMemory();a.isPerformanceInfoLayerView(f)&&(f=f.performanceInfo,this.displayedNumberOfFeatures=f.displayedNumberOfFeatures,
this.maximumNumberOfFeatures=f.maximumNumberOfFeatures,this.totalNumberOfFeatures=f.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(u){return"performanceInfo"in u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/maybe ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./RasterTile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical ./TileTexture".split(" "),
function(a,u,f,p,t,w,e,n){function b(y){return"vector-tile"===(null==y?void 0:y.type)}function h(y){return"imagery-tile"===(null==y?void 0:y.type)||"wcs"===(null==y?void 0:y.type)}function k(y){return"imagery-tile-3d"===(null==y?void 0:y.type)}function l(y){return"tile-3d"===(null==y?void 0:y.type)}function m(y){return"vector-tile-3d"===(null==y?void 0:y.type)}function z(y){return"wmts-3d"===(null==y?void 0:y.type)}function r(y){return"elevation-3d"===(null==y?void 0:y.type)}function c(y,x,D,C){return d[C].checkIfTileInfoSupportedForViewSR(y,
D,x)}const d={[1]:e.terrainUtilsSpherical,[2]:w.terrainUtilsPlanar},g=80/180*Math.PI,A=110/180*Math.PI,q={force512VTL:!1};a.checkIfTileInfoSupportedForView=c;a.computeSkirtScale=function(y,x,D){const C=d[y.viewingMode];if(C.isInsideExtent(y,x))var B=u.unwrapOr(y.getElevation(x[0],x[1],x[1],y.spatialReference),0);else{if(!C.isInsideExtent(y,x,1.2))return 0;var v=y.getTileWithElevation(x[0],x[1],x[1],y.spatialReference);B=u.isSome(v)?v.elevationBounds[0]:y.elevationBounds.min;v=u.isSome(v)?v.elevationBounds[1]:
y.elevationBounds.max;B=.5*(B+v);y=C.tiltToExtentEdge(y,x,B);if(y>g&&y<A)return 0}x=x[2]-B;return Math.abs(x)<D?0:0>x?-1:1};a.getLayerWithExtentRange=function(y){return k(y)?{fullExtent:y.fullExtent,minScale:y.layer.minScale,maxScale:y.layer.maxScale,tilemapCache:null}:y.layer};a.getTiledLayerInfo=function(y,x,D){let C,B;if("wmts"===y.type){if(y=y.activeLayer){const v=y.tileMatrixSet;if(v)C=v.tileInfo,B=v.fullExtent;else if(y=y.tileMatrixSets)if(y=y.find(E=>null==c(E.tileInfo,E.fullExtent,x,D)))return{tileInfo:y.tileInfo,
fullExtent:y.fullExtent}}}else B=h(y)?y.getCompatibleFullExtent(x):y.fullExtent,C=b(y)&&!q.force512VTL?y.compatibleTileInfo256:h(y)?y.getCompatibleTileInfo(x,B,2===D):y.tileInfo;return C&&B&&null==c(C,B,x,D)?{tileInfo:C,fullExtent:B}:{tileInfo:null,fullExtent:null}};a.isElevationLayerView=r;a.isImageryTileLayerView=k;a.isImageryTileRenderInfo=function(y){var x;return(null==y?void 0:null==(x=y.sourceLayerInfo)?void 0:x.data)instanceof t};a.isProjectableRasterLayer=h;a.isRasterTileRenderInfo=function(y){var x;
y=null==y?void 0:null==(x=y.sourceLayerInfo)?void 0:x.data;return y instanceof HTMLImageElement||y instanceof p.ImageWithType||y instanceof HTMLCanvasElement||y instanceof ImageData};a.isSurfaceLayerView=function(y){return y&&(l(y)||k(y)||r(y)||m(y)||z(y))};a.isTextureTileRenderInfo=function(y){var x;return(null==y?void 0:null==(x=y.sourceLayerInfo)?void 0:x.data)instanceof n};a.isTileLayerView=l;a.isVectorTileLayer=b;a.isVectorTileLayerView=m;a.isVectorTileRenderInfo=function(y){var x;return(null==
y?void 0:null==(x=y.sourceLayerInfo)?void 0:x.data)instanceof f.VectorTile};a.isWMTSLayerView=z;a.releaseTileData=function(y){u.isSome(y)&&"release"in y&&y.release();return null};a.test=q;a.useFetchTileForLayer=function(y){return y.fetchTile&&!1!==y.hasOverriddenFetchTile};a.weakAssert=function(y,x){y||console.warn("Terrain: "+x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(a,u,f,p,t,w,e,n){n=function(h){function k(m,z,r,c,d=null){r=h.call(this,m,r,c,[4096,4096])||this;r._memCache=d;r._referenced=0;r._hasSymbolBuckets=!1;r._memoryUsedByLayerData=0;r.layerData=new Map;r.layerCount=0;r.status="loading";r.allSymbolsFadingOut=!1;r.lastOpacityUpdate=0;r.symbols=new Map;r.isCoverage=!1;r.neededForCoverage=!1;r.decluttered=!1;r.invalidating=!1;r.parentTile=null;r.childrenTiles=new Set;r._processed=!1;r._referenced=1;r.styleRepository=z;r.id=m.id;r.transforms.tileUnitsToPixels=
t.create();return r}u._inheritsLoose(k,h);var l=k.prototype;l.setData=function(m){this.changeDataImpl(m);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};l.deleteLayerData=function(m){let z=!1;for(const r of m)this.layerData.has(r)&&(m=this.layerData.get(r),this._memoryUsedByLayerData-=m.memoryUsed,3===m.type&&this.symbols.has(r)&&(this.symbols.delete(r),z=!0),m.destroy(),this.layerData.delete(r),this.layerCount--);f.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);z&&this.emit("symbols-changed");this.requestRender()};l.processed=function(){return this._processed};l.hasData=function(){return 0<this.layerCount};l.dispose=function(){"unloaded"!==this.status&&(b.delete(this),k._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};l.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};l.retain=function(){++this._referenced};
l.changeDataImpl=function(m){let z=!1;if(m){m=this._createRenderBuckets(m);for(const [r,c]of m)this.layerData.has(r)&&(m=this.layerData.get(r),this._memoryUsedByLayerData-=c.memoryUsed,m.destroy(),this.layerData.delete(r),this.layerCount--),3===c.type&&(this.symbols.set(r,c.symbols),z=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(r,c),this.layerCount++;f.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,
r]of this.layerData)3===r.type&&(this._hasSymbolBuckets=!0);z&&this.emit("symbols-changed")};l.attachWithContext=function(m){this.stage={context:m,trashDisplayObject(z){z.processDetach()},untrashDisplayObject(){return!1}}};l.setTransform=function(m,z){h.prototype.setTransform.call(this,m,z);var r=z/(m.resolution*m.pixelRatio);z=this.size[0]/this.coordRange[0]*r;r*=this.size[1]/this.coordRange[1];const c=[0,0];m.toScreen(c,this.coords);const d=this.transforms.tileUnitsToPixels;p.identity(d);p.translate(d,
d,c);p.rotate(d,d,Math.PI*m.rotation/180);p.scale(d,d,[z,r,1])};k._destroyRenderBuckets=function(m){if(m){var z=new Set;m.forEach(r=>{z.has(r)||(r.destroy(),z.add(r))});m.clear()}};l._createRenderBuckets=function(m){const z=new Map,r=new Map;for(const c of m){m=this._deserializeBucket(c,r);for(const d of m.layerUIDs)z.set(d,m)}return z};l._deserializeBucket=function(m,z){let r=z.get(m);if(r)return r;switch((new Uint32Array(m))[0]){case 1:r=new w.FillRenderBucket(m,this.styleRepository);break;case 2:r=
new w.LineRenderBucket(m,this.styleRepository);break;case 3:r=new w.SymbolRenderBucket(m,this.styleRepository,this);break;case 4:r=new w.CircleRenderBucket(m,this.styleRepository)}z.set(m,r);return r};u._createClass(k,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<e.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||
performance.now()-this.lastOpacityUpdate<e.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return k}(n.TiledDisplayObject);const b=new Map;a.VectorTile=n;a.printAllocations=function(){b.forEach((h,k)=>{console.log(`\n${k.key}:`);h[0].forEach(l=>console.log(l));
console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");h[1].forEach(l=>console.log(l))})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function u(){const e=new Float32Array(9);e[0]=1;e[4]=1;e[8]=1;return e}function f(e){const n=new Float32Array(9);n[0]=e[0];n[1]=e[1];n[2]=e[2];n[3]=e[3];n[4]=e[4];n[5]=e[5];n[6]=e[6];n[7]=e[7];n[8]=e[8];return n}function p(e,n,b,h,k,l,m,z,r){const c=new Float32Array(9);c[0]=e;c[1]=n;c[2]=b;c[3]=h;c[4]=
k;c[5]=l;c[6]=m;c[7]=z;c[8]=r;return c}function t(e,n){return new Float32Array(e,n,9)}var w=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t});a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat3f32=w})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./decluttering/util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){t=function(){function z(c,d){this.layerUIDs=[];this.isDestroyed=!1;this.data=c;this.memoryUsed=c.byteLength;let g=1;c=new Uint32Array(c);this.layerUIDs=[];const A=c[g++];for(let q=0;q<A;q++)this.layerUIDs[q]=c[g++];this.bufferDataOffset=g;d&&(this.layer=d.getStyleLayerByUID(this.layerUIDs[0]))}var r=z.prototype;r.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};r.prepareForRendering=function(c){f.isNone(this.data)||(this.doPrepareForRendering(c,
this.data,this.bufferDataOffset),this.data=null)};u._createClass(z,[{key:"isPreparedForRendering",get:function(){return f.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return z}();w=function(z){function r(d,g){g=z.call(this,d,g)||this;g.type=2;g.lineIndexStart=0;g.lineIndexCount=0;d=new Uint32Array(d);let A=g.bufferDataOffset;g.lineIndexStart=d[A++];g.lineIndexCount=d[A++];const q=d[A++];if(0<q){const y=new Map;for(let x=0;x<q;x++){const D=d[A++],C=d[A++],B=d[A++];
y.set(D,[C,B])}g.patternMap=y}g.bufferDataOffset=A;return g}u._inheritsLoose(r,z);var c=r.prototype;c.hasData=function(){return 0<this.lineIndexCount};c.triangleCount=function(){return this.lineIndexCount/3};c.doDestroy=function(){f.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();f.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();f.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};c.doPrepareForRendering=function(d,g,A){g=new Uint32Array(g);var q=new Int32Array(g.buffer);const y=g[A++];this.lineVertexBuffer=p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;q=g[A++];this.lineIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,4*A,q));A+=q;A=this.layer.lineMaterial;this.lineVertexArrayObject=new l(d,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return r}(t);e=function(z){function r(d,
g){g=z.call(this,d,g)||this;g.type=1;g.fillIndexStart=0;g.fillIndexCount=0;g.outlineIndexStart=0;g.outlineIndexCount=0;d=new Uint32Array(d);let A=g.bufferDataOffset;g.fillIndexStart=d[A++];g.fillIndexCount=d[A++];g.outlineIndexStart=d[A++];g.outlineIndexCount=d[A++];const q=d[A++];if(0<q){const y=new Map;for(let x=0;x<q;x++){const D=d[A++],C=d[A++],B=d[A++];y.set(D,[C,B])}g.patternMap=y}g.bufferDataOffset=A;return g}u._inheritsLoose(r,z);var c=r.prototype;c.hasData=function(){return 0<this.fillIndexCount||
0<this.outlineIndexCount};c.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};c.doDestroy=function(){f.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();f.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();f.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;f.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();f.isSome(this.outlineVertexBuffer)&&
this.outlineVertexBuffer.dispose();f.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};c.doPrepareForRendering=function(d,g,A){g=new Uint32Array(g);var q=new Int32Array(g.buffer),y=g[A++];this.fillVertexBuffer=p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;y=g[A++];this.fillIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,4*A,y));A+=y;y=g[A++];this.outlineVertexBuffer=
p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;q=g[A++];this.outlineIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,4*A,q));A+=q;g=this.layer;A=g.fillMaterial;g=g.outlineMaterial;this.fillVertexArrayObject=new l(d,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new l(d,g.getAttributeLocations(),g.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return r}(t);n=function(z){function r(d,
g,A){g=z.call(this,d,g)||this;g.type=3;g.iconPerPageElementsMap=new Map;g.glyphPerPageElementsMap=new Map;g.symbolInstances=[];g.isIconSDF=!1;g.opacityChanged=!1;g.lastOpacityUpdate=0;g.symbols=[];const q=new Uint32Array(d),y=new Int32Array(d);d=new Float32Array(d);let x=g.bufferDataOffset;g.isIconSDF=!!q[x++];var D=q[x++];for(var C=0;C<D;C++){var B=q[x++],v=q[x++],E=q[x++];g.iconPerPageElementsMap.set(B,[v,E])}D=q[x++];for(C=0;C<D;C++)B=q[x++],v=q[x++],E=q[x++],g.glyphPerPageElementsMap.set(B,[v,
E]);D=q[x++];C=q[x++];g.iconOpacity=new Int32Array(D);g.textOpacity=new Int32Array(C);x=m.deserializeSymbols(q,y,d,x,g.symbols,A);g.bufferDataOffset=x;return g}u._inheritsLoose(r,z);var c=r.prototype;c.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};c.triangleCount=function(){let d=0;for(const [,g]of this.iconPerPageElementsMap)d+=g[1];for(const [,g]of this.glyphPerPageElementsMap)d+=g[1];return d/3};c.doDestroy=function(){f.isSome(this.iconVertexArrayObject)&&
this.iconVertexArrayObject.dispose();f.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();f.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();f.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;f.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();f.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();f.isSome(this.textOpacityBuffer)&&
this.textOpacityBuffer.dispose();f.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};c.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var d=f.unwrap(this.iconOpacity),g=f.unwrap(this.iconOpacityBuffer);0<d.length&&d.byteLength===g.size&&g.setSubData(d);d=f.unwrap(this.textOpacity);g=f.unwrap(this.textOpacityBuffer);0<d.length&&d.byteLength===
g.size&&g.setSubData(d)}};c.doPrepareForRendering=function(d,g,A){g=new Uint32Array(g);var q=new Int32Array(g.buffer),y=g[A++];this.iconVertexBuffer=p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;y=g[A++];this.iconIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,4*A,y));A+=y;y=g[A++];this.textVertexBuffer=p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;q=g[A++];this.textIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,4*A,q));A+=q;this.iconOpacityBuffer=
p.createVertex(d,35044,f.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=p.createVertex(d,35044,f.unwrap(this.textOpacity).buffer);g=this.layer;A=g.iconMaterial;g=g.textMaterial;this.iconVertexArrayObject=new l(d,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new l(d,g.getAttributeLocations(),g.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};
return r}(t);b=function(z){function r(d,g){g=z.call(this,d,g)||this;g.type=4;g.circleIndexStart=0;g.circleIndexCount=0;d=new Uint32Array(d);let A=g.bufferDataOffset;g.circleIndexStart=d[A++];g.circleIndexCount=d[A++];g.bufferDataOffset=A;return g}u._inheritsLoose(r,z);var c=r.prototype;c.hasData=function(){return 0<this.circleIndexCount};c.triangleCount=function(){return this.circleIndexCount/3};c.doDestroy=function(){f.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();
f.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();f.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};c.doPrepareForRendering=function(d,g,A){g=new Uint32Array(g);var q=new Int32Array(g.buffer);const y=g[A++];this.circleVertexBuffer=p.createVertex(d,35044,new Int32Array(q.buffer,4*A,y));A+=y;q=g[A++];this.circleIndexBuffer=p.createIndex(d,35044,new Uint32Array(g.buffer,
4*A,q));A+=q;A=this.layer.circleMaterial;this.circleVertexArrayObject=new l(d,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return r}(t);a.CircleRenderBucket=b;a.FillRenderBucket=e;a.LineRenderBucket=w;a.RenderBucketBase=t;a.SymbolRenderBucket=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"./core"],function(a,u,f,p){let t=function(b){this.tile=b;this.parent=null;this.children=new Set},w=function(){function b(){this.nodes=new Map;this.roots=new Set}var h=b.prototype;h.create=function(k){const l=new t(k);let m;const z=[];this.nodes.forEach(r=>{this._canConnectDirectly(l,r)&&z.push(r);!m&&this._canConnectDirectly(r,l)&&(m=r)});if(m){for(const r of z)m.children.delete(r),l.children.add(r),r.parent=l;m.children.add(l);l.parent=m}else{this.roots.add(l);for(const r of z)l.children.add(r),
r.parent=l,this.roots.delete(r)}this.nodes.set(k.key.id,l);return l};h.destroy=function(k){f.isSome(k.parent)?(k.parent.children.delete(k),k.children.forEach(l=>{f.isSome(k.parent)&&k.parent.children.add(l)})):this.roots.delete(k);k.children.forEach(l=>{(l.parent=k.parent)||this.roots.add(l)});this.nodes.delete(k.tile.key.id)};h.clear=function(){this.roots.clear();this.nodes.clear()};h._canConnectDirectly=function(k,l){let {level:m,row:z,col:r}=l.tile.key;for({world:l}=l.tile.key;0<m;){m--;z>>=1;
r>>=1;if(k.tile.key.level===m&&k.tile.key.row===z&&k.tile.key.col===r&&k.tile.key.world===l)return!0;if(this.nodes.has(`${m}/${z}/${r}/${l}`))break}return!1};return b}(),e=function(){function b(){this._tileGraph=new w;this._tileArray=null}var h=b.prototype;h.has=function(k){return"string"===typeof k?this._tileGraph.nodes.has(k):this._tileGraph.nodes.has(k.key.id)};h.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(k=>{this._tileArray.push(k.tile)}));return this._tileArray};
h.getRoots=function(){const k=[];this._tileGraph.roots.forEach(l=>{k.push(l.tile)});return k};h.getParent=function(k){k=this._tileGraph.nodes.get("string"===typeof k?k:k.key.id);return f.isSome(k.parent)&&k.parent.tile};h.getChildren=function(k){const l=[];this._tileGraph.nodes.get("string"===typeof k?k:k.key.id).children.forEach(m=>{l.push(m.tile)});return l};h.get=function(k){return this._tileGraph.nodes.get(k).tile};h.removeKey=function(k){k=this._tileGraph.nodes.get(k);this._tileGraph.destroy(k);
this._tileArray=null};h.forEach=function(k){this._tileGraph.nodes.forEach((l,m)=>k(l.tile,m))};h.add=function(k){this._tileGraph.create(k);this._tileArray=null};h.remove=function(k){k=this._tileGraph.nodes.get(k.key.id);this._tileGraph.destroy(k);this._tileArray=null};h.clear=function(){this._tileGraph.clear();this._tileArray=[]};return b}(),n=function(){function b(k,l,m){this._rows=Math.ceil(l/m);this._columns=Math.ceil(k/m);this._cellSize=m;this.cells=Array(this._rows);for(k=0;k<this._rows;k++)for(this.cells[k]=
Array(this._columns),l=0;l<this._columns;l++)this.cells[k][l]=[]}var h=b.prototype;h.getCell=function(k,l){l=Math.min(Math.max(Math.floor(l/this._cellSize),0),this._rows-1);k=Math.min(Math.max(Math.floor(k/this._cellSize),0),this._columns-1);return this.cells[l]&&this.cells[l][k]||null};h.getCellSpan=function(k,l,m,z){return[Math.min(Math.max(Math.floor(k/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(m/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(z/this._cellSize),0),this.rows-1)]};u._createClass(b,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return b}();a.GridIndex=n;a.TileForest=e;a.TileGraph=w;a.TileNode=t;a.deserializeSymbols=function(b,h,k,l,m,z){const r=h[l++];for(let g=0;g<r;g++){const A=new p.VTLSymbol(z);A.xTile=h[l++];A.yTile=h[l++];A.hash=h[l++];A.priority=h[l++];var c=
h[l++];for(var d=0;d<c;d++){const q=h[l++],y=h[l++],x=h[l++],D=h[l++],C=!!h[l++],B=h[l++],v=k[l++],E=k[l++],F=h[l++],L=h[l++];A.colliders.push({xTile:q,yTile:y,dxPixels:x,dyPixels:D,hard:C,partIndex:B,width:F,height:L,minLod:v,maxLod:E})}c=b[l++];for(d=0;d<c;d++)A.textVertexRanges.push([b[l++],b[l++]]);c=b[l++];for(d=0;d<c;d++)A.iconVertexRanges.push([b[l++],b[l++]]);m.push(A)}return l};a.tileCoordChange=function(b,h,k,l,m,z){k-=m;if(0<=k)return(h>>k)+(l-(z<<k))*(b>>k);k=-k;return h-(z-(l<<k))*(b>>
k)<<k};a.writeOpacityToBuffers=function(b,h,k){for(const [g,A]of b.symbols){{var l=b,m=h,z=k,r=A;const q=l.layerData.get(g);if(3===q.type){for(const y of r){r=y.unique;var c=void 0;if(y.selectedForRendering){var d=r.parts[0];c=d.startOpacity;d=d.targetOpacity;l.allSymbolsFadingOut=l.allSymbolsFadingOut&&0===d;c=z?Math.floor(127*c)|d<<7:d?255:0;c|=c<<24|c<<16|c<<8}else c=0;for(const [x,D]of y.iconVertexRanges)for(d=x;d<x+D;d+=4)q.iconOpacity[d/4]=c;y.selectedForRendering?(c=r.parts[1],r=c.startOpacity,
c=c.targetOpacity,l.allSymbolsFadingOut=l.allSymbolsFadingOut&&0===c,r=z?Math.floor(127*r)|c<<7:c?255:0,c=r<<24|r<<16|r<<8|r):c=0;for(const [x,D]of y.textVertexRanges)for(r=x;r<x+D;r+=4)q.textOpacity[r/4]=c}q.lastOpacityUpdate=m;q.opacityChanged=!0}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(u){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=
[];this.iconVertexRanges=[];this.tile=u};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),function(a,u,f,p,t,w,e){f=function(n){function b(k,l,m,z=m){var r=n.call(this)||this;r.triangleCountReportedInDebug=0;r.transforms={dvs:t.create(),tileMat3:t.create()};r.triangleCount=0;r.key=new e(k);r.bounds=l;r.size=m;r.coordRange=z;return r}
u._inheritsLoose(b,n);var h=b.prototype;h.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};h.setTransform=function(k,l){l/=k.resolution*k.pixelRatio;const m=this.transforms.tileMat3,[z,r]=k.toScreenNoRotation([0,0],this.coords);p.set(m,this.size[0]/this.coordRange[0]*l,0,0,0,this.size[1]/this.coordRange[1]*l,0,z,r,1);p.multiply(this.transforms.dvs,k.displayViewMat3,m)};u._createClass(b,[{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},
set:function(k){this._coords=[k[0],k[3]];this._bounds=k}}]);return b}(w.DisplayObject);a.TiledDisplayObject=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(a,u,f,p,t){const w=1/p("mapview-transitions-duration");f=function(e){function n(){var h=e.apply(this,arguments)||this;h._fadeOutResolver=null;h._fadeInResolver=
null;h._clips=null;h.computedVisible=!0;h.computedOpacity=1;h.fadeTransitionEnabled=!1;h.inFadeTransition=!1;h._isReady=!1;h._opacity=1;h._stage=null;h._visible=!0;return h}u._inheritsLoose(n,e);var b=n.prototype;b.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=t.createResolver();this.requestRender();return this._fadeInResolver.promise};
b.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=t.createResolver();this.requestRender();return this._fadeOutResolver.promise};b.beforeRender=function(h){this.updateTransitionProperties(h.deltaTime,h.state.scale)};b.afterRender=function(h){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=
null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};b.remove=function(){var h;null==(h=this.parent)?void 0:h.removeChild(this)};b.setTransform=function(h){};b.processRender=function(h){this.stage&&this.computedVisible&&this.doRender(h)};b.requestRender=function(){this.stage&&this.stage.requestRender()};b.processDetach=function(){this.onDetach();this.emit("detach")};b.updateTransitionProperties=function(h,k){if(this.fadeTransitionEnabled){k=
this._fadeOutResolver||!this.visible?0:this.opacity;const l=this.computedOpacity;l===k?this.computedVisible=this.visible:(h*=w,this.computedOpacity=l>k?Math.max(k,l-h):Math.min(k,l+h),this.computedVisible=0<this.computedOpacity,h=k===this.computedOpacity,this.inFadeTransition=!h,h||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};b.onAttach=function(){};b.onDetach=function(){};b.doRender=function(h){};b.ready=function(){this._isReady||(this._isReady=
!0,this.emit("isReady"),this.requestRender())};u._createClass(n,[{key:"clips",get:function(){return this._clips},set:function(h){this._clips=h;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(h){this._opacity!==h&&(this._opacity=Math.min(1,Math.max(h,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(h){if(this._stage!==h){var k=this._stage;(this._stage=h)?this._stage.untrashDisplayObject(this)||
(this.onAttach(),this.emit("attach")):k.trashDisplayObject(this)}}},{key:"visible",get:function(){return this._visible},set:function(h){this._visible!==h&&(this._visible=h,this.requestRender())}}]);return n}(f);a.DisplayObject=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,u){let f=function(){function p(w,e,n,b){this.set(w,e,n,b)}p.getId=function(w,e,n,b){return"object"===
typeof w?`${w.level}/${w.row}/${w.col}/${w.world}`:`${w}/${e}/${n}/${b}`};var t=p.prototype;t.acquire=function(w,e,n,b){this.set(w,e,n,b)};t.contains=function(w){const e=w.level-this.level;return this.row===w.row>>e&&this.col===w.col>>e&&this.world===w.world};t.equals=function(w){return this.level===w.level&&this.row===w.row&&this.col===w.col&&this.world===w.world};t.clone=function(){return new p(this)};t.release=function(){this.world=this.col=this.row=this.level=0};t.set=function(w,e,n,b){if(null==
w)this.world=this.col=this.row=this.level=0;else if("object"===typeof w)this.level=w.level||0,this.row=w.row||0,this.col=w.col||0,this.world=w.world||0;else if("string"===typeof w){const [h,k,l,m]=w.split("/");this.level=parseFloat(h);this.row=parseFloat(k);this.col=parseFloat(l);this.world=parseFloat(m)}else this.level=+w,this.row=+e,this.col=+n,this.world=+b||0;return this};t.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};t.getParentKey=function(){return 0>=this.level?
null:new p(this.level-1,this.row>>1,this.col>>1,this.world)};t.getChildKeys=function(){const w=this.level+1,e=this.row<<1,n=this.col<<1,b=this.world;return[new p(w,e,n,b),new p(w,e,n+1,b),new p(w,e+1,n,b),new p(w,e+1,n+1,b)]};t.compareRowMajor=function(w){return this.row<w.row?-1:this.row>w.row?1:this.col<w.col?-1:this.col>w.col?1:0};a._createClass(p,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(w){this.set(w)}}]);return p}();f.pool=new u(f,
null,null,25,50);return f})},"esri/views/3d/terrain/RasterTile":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../webgl/rasterUtils"],function(a,u,f){const p={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};return function(){function t(e,n,b=null,h=null){this._interpolation=this._bandIds=this._symbolizerParameters=
this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=e;this.source=n;this.width=b||n.width;this.height=h||n.height}var w=t.prototype;w.bind=function(e){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(e,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(e),
this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=f.createTransformTexture(e,this.transformGrid)));return!0};w.getUniforms=function(){const e=f.getBasicGridUniforms(this.scale,this.offset),{symbolizerParameters:n,transformGrid:b,width:h,height:k,opacity:l}=this,m=f.getCommonUniforms(b,[h,k],[this.source.width,this.source.height],l),z=n.colormap?f.getColormapUniforms(n.colormap,n.colormapOffset):null,r="stretch"===this.symbolizerParameters.type?f.getStretchUniforms(this.symbolizerParameters):
null,c="hillshade"===this.symbolizerParameters.type?f.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:e,common:m,colormap:z,stretch:r,hillshade:c}};w.getTextures=function(){const e=[],n=[];this._rasterTexture&&(n.push(this._rasterTexture),e.push("u_image"),this._transformGridTexture&&(n.push(this._transformGridTexture),e.push("u_transformGrid")),this._colormapTexture&&(n.push(this._colormapTexture),e.push("u_colormap")));return{names:e,textures:n}};w.release=function(){this._rasterTexture=
u.disposeMaybe(this._rasterTexture);this._transformGridTexture=u.disposeMaybe(this._transformGridTexture);this._colormapTexture=u.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};w._updateRasterTexture=function(e,n){const b=this.source?this.source.extractBands(n):null;if(b&&b.pixels&&0<b.pixels.length){n=u.isNone(n)&&u.isNone(this.bandIds)||u.isSome(n)&&u.isSome(this.bandIds)&&n.join("")===this.bandIds.join("");if(this._rasterTexture){if(n)return;
this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=f.createRasterTexture(e,b,this.interpolation||"nearest",this.isRendereredSource)}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};w._updateColormapTexture=function(e){const n=this._colormap,b=this.symbolizerParameters.colormap;if(!b)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!n)this._colormapTexture=f.createColormapTexture(e,
b),this._colormap=b;else if(b.length!==n.length||b.some((h,k)=>h!==n[k]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=f.createColormapTexture(e,b),this._colormap=b};a._createClass(t,[{key:"source",get:function(){return this._source},set:function(e){this._source=e;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...p,
maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||p},set:function(e){this._symbolizerParameters=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){u.isSome(e)&&0<e.length?this._bandIds&&e.every((n,b)=>this._bandIds[b]?n===this._bandIds[b]:!1)||(this._bandIds=e,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===
e?9729:9728)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}},{key:"memoryUsage",get:function(){if(u.isNone(this._memoryUsed)){const e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map(n=>n.descriptor.width*n.descriptor.height*4).reduce((n,b)=>n+b,0)}return this._memoryUsed}}]);return t}()})},"esri/views/webgl/rasterUtils":function(){define(["exports",
"./FramebufferObject","./Texture"],function(a,u,f){a.createColormapTexture=function(p,t){return new f(p,{width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},t)};a.createFrameBuffer=function(p,t,w,e){e=new f(p,{width:t,height:w,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:e?5121:5126,wrapMode:33071,flipped:!1});return new u(p,{colorTarget:0,depthStencilTarget:3,width:t,height:w},e)};a.createRasterTexture=
function(p,t,w="nearest",e=!1){var n;const b=(e=!(e&&"u8"===t.pixelType))?5126:5121,h=null==t.pixels||0===t.pixels.length?null:e?t.getAsRGBAFloat():t.getAsRGBA(),k=null==(n=p.capabilities.textureFloat)?void 0:n.textureFloatLinear;return new f(p,{width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:"webgl2"===p.webglVersion&&e?34836:6408,samplingMode:!k||"bilinear"!==w&&"cubic"!==w?9728:9729,dataType:b,wrapMode:33071,flipped:!1},h)};a.createTransformTexture=function(p,t){var w=
4*t.size[0],e=t.size[1];const n={width:w,height:e,target:3553,pixelFormat:6408,internalFormat:"webgl2"===p.webglVersion?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1};w=new Float32Array(w*e*4);e=0;for(let b=0;b<t.coefficients.length;b++)w[e++]=t.coefficients[b],2===b%3&&(w[e++]=1);return new f(p,n,w)};a.getBasicGridUniforms=function(p,t){return{u_scale:p,u_offset:t}};a.getColormapUniforms=function(p,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:p?p.length/4-1:null}};a.getCommonUniforms=
function(p,t,w,e=1,n=!0,b=!1){return{u_flipY:n,u_isFloatTexture:b,u_applyTransform:p?!0:!1,u_opacity:e,u_transformSpacing:p?p.spacing:null,u_transformGridSize:p?p.size:null,u_targetImageSize:t,u_srcImageSize:w}};a.getShadedReliefUniforms=function(p){return{u_hillshadeType:p.hillshadeType,u_sinZcosAs:p.sinZcosAs,u_sinZsinAs:p.sinZsinAs,u_cosZs:p.cosZs,u_weights:p.weights,u_factor:p.factor,u_minValue:p.minValue,u_maxValue:p.maxValue}};a.getStretchUniforms=function(p){return{u_bandCount:p.bandCount,
u_minOutput:p.outMin,u_maxOutput:p.outMax,u_minCutOff:p.minCutOff,u_maxCutOff:p.maxCutOff,u_factor:p.factor,u_useGamma:p.useGamma,u_gamma:p.gamma,u_gammaCorrection:p.gammaCorrection}};a.getUniformLocationInfos=function(p,t){p=p.gl;t=t.glName;const w=p.getProgramParameter(t,p.ACTIVE_UNIFORMS),e=new Map;let n;for(let b=0;b<w;b++)(n=p.getActiveUniform(t,b))&&e.set(n.name,{location:p.getUniformLocation(t,n.name),info:n});return e};a.setTextures=function(p,t,w,e){w.length===e.length&&(e.some(n=>null==
n)||w.some(n=>null==n)||w.forEach((n,b)=>{t.setUniform1i(n,b);p.bindTexture(e[b],b)}))};a.setUniforms=function(p,t,w){Object.keys(w).forEach(e=>{var n=t.get(e)||t.get(e+"[0]");if(n){var b=w[e];if(null!==n&&null!=b)switch({info:n}=n,n.type){case 5126:1<n.size?p.setUniform1fv(e,b):p.setUniform1f(e,b);break;case 35664:p.setUniform2fv(e,b);break;case 35665:p.setUniform3fv(e,b);break;case 35666:p.setUniform4fv(e,b);break;case 35675:p.setUniformMatrix3fv(e,b);break;case 35676:p.setUniformMatrix4fv(e,b);
break;case 5124:1<n.size?p.setUniform1iv(e,b):p.setUniform1i(e,b);break;case 35670:p.setUniform1i(e,b?1:0);break;case 35667:case 35671:p.setUniform2iv(e,b);break;case 35668:case 35672:p.setUniform3iv(e,b);break;case 35669:case 35673:p.setUniform4iv(e,b)}}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3 ./vec3f64 ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,u,f,p,t,w,e){function n(c,d,g=0){c=c.extent;return 0===g?t.containsPoint(c,d):t.containsPointWithMargin(c,d,g*Math.min(c[2]-c[0],c[3]-c[1]))}function b(c,d,g,A){f.copy(l,g);l[A]=d[A];A=f.subtract(l,l,d);var q=f.subtract(m,c,d);q=f.dot(q,A);const y=f.dot(A,A);d=0>=q?d:y<=q?g:f.add(l,d,f.scale(A,A,q/y));c=f.subtract(l,c,d);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function h(c,d,g){c=c.extent;z[0]=c[0];z[1]=c[1];z[2]=g;r[0]=c[2];r[1]=c[3];r[2]=g;c=g=Infinity;d[0]<z[0]?
g=b(d,z,r,0):d[0]>r[0]&&(g=b(d,r,z,0));d[1]<z[1]?c=b(d,z,r,1):d[1]>r[1]&&(c=b(d,r,z,1));return Math.min(g,c)}function k(c,d,g){if(c.spatialReference.isGeographic)return new u("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var A=e.checkUnsupported(c);if(A)return A;{var q=c.lods;A=q[0].resolution*2**q[0].level;var y=[A*c.size[0],A*c.size[1]];const x=[c.origin.x,c.origin.y];g=t.fromExtent(g);const D=t.create();e.computeRowColExtent(g,y,x,D);
y=(D[2]-D[0])*(D[3]-D[1]);y>w.MAX_ROOT_TILES?(q=q[0].scale*2**q[0].level,A=Math.max((g[3]-g[1])/c.size[1],(g[2]-g[0])/c.size[0])*q/A,g=Math.floor(Math.log(A)/Math.log(10)),A=Math.ceil(A/10**g)*10**g,A=new u("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(q).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+A.toLocaleString()+".",{level0Scale:q,suggestedLevel0Scale:A,requiredNumRootTiles:y,allowedNumRootTiles:w.MAX_ROOT_TILES})):
A=null}return A?A:d&&!c.spatialReference.equals(d)?new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}const l=p.create(),m=p.create(),z=p.create(),r=p.create();p=Object.freeze({__proto__:null,isInsideExtent:n,tiltToExtentEdge:h,checkIfTileInfoSupportedForViewSR:k});a.checkIfTileInfoSupportedForViewSR=k;a.isInsideExtent=n;a.terrainUtilsPlanar=p;a.tiltToExtentEdge=h})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports",
"../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,u,f,p,t){function w(){return!0}function e(){return 0}function n(h,k){const l=h.lods.length-1,m=h.spatialReference,z=f.canProjectToWGS84ComparableLonLat(m)||p.isMars(m)||p.isMoon(m);if(m.isWebMercator){if(!t.makeWebMercatorAuxiliarySphere(l).compatibleWith(h))return new u("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(z){if(!t.makeGCSWithTileSize(h.spatialReference,
h.size[0],l).compatibleWith(h))return h.spatialReference.isWGS84?new u("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new u("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new u("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(k&&!h.spatialReference.equals(k))return new u("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}var b=Object.freeze({__proto__:null,isInsideExtent:w,tiltToExtentEdge:e,checkIfTileInfoSupportedForViewSR:n});a.checkIfTileInfoSupportedForViewSR=n;a.isInsideExtent=w;a.terrainUtilsSpherical=b;a.tiltToExtentEdge=e})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function u(p){this._texture=p;this._refCount=1}var f=u.prototype;f.retain=function(){++this._refCount};
f.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};f.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(u,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return u}()})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(a,u,f,p,t,w){let e=function(){function b(k){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=k.viewState;this.view=k.view;this.pointsOfInterest=k.pointsOfInterest;this.objectResourceCache=k.objectResourceCache;this.streamDataRequester=k.resourceController.createStreamDataRequester(4);this.textures=new t.TextureCollection(this.streamDataRequester,k.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,
t:33071}},k.resourceController.scheduler);const l=p.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=w.getSettings(k.viewingMode,l);this.screenSizePerspectiveSettingsLabels=w.getLabelSettings(k.viewingMode,l)}var h=b.prototype;h.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};h.addGraphicsOwner=function(k){if(!k)return{remove(){}};this.graphicsOwners.push(k);const l="layer"in k?k.watch("layer.screenSizePerspectiveEnabled",
()=>this.updateScreenSizePerspectiveEnabled()):null;this.updateScreenSizePerspectiveEnabled();return{remove:()=>{l&&(l.remove(),u.removeUnordered(this.graphicsOwners,k),this.updateScreenSizePerspectiveEnabled())}}};h.updateScreenSizePerspectiveEnabled=function(){var k=this.graphicsOwners.some(l=>!0===l.get("layer.screenSizePerspectiveEnabled"));k&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new f,k=()=>this.updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
k,!0),this.viewState.events.on("camera-projection-changed",k)]),this.updateScreenSizePerspectiveSettings()):!k&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};h.updateScreenSizePerspectiveSettings=function(){n.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;n.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(n);this.screenSizePerspectiveSettingsLabels.update(n);this.view._stage.renderView.setNeedsRender()};
return b}();const n={distance:0,fovY:0};a.SharedSymbolResources=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../webgl-engine/lib/Texture ../webgl-engine/lib/WebGLDriverTest ../../support/Scheduler".split(" "),function(a,u,f,p,t,w,e,n){let b=function(){function h(l,m,z,r){this._streamDataRequester=l;
this._stage=m;this._textureOptions=z;this._textureRequests=new Map;this._frameTask=f.isSome(r)?r.registerTask(n.TaskPriority.TEXTURE_UNLOAD):n.ImmediateTask}var k=h.prototype;k.destroy=function(){this._frameTask.remove();this._textureRequests.forEach(l=>this.releaseTextureRequest(l));this._textureRequests.clear()};k.fromUrl=function(){var l=u._asyncToGenerator(function*(m,z,r){p.throwIfAborted(r);const c=f.isSome(r)&&r.signal,d=this.makeUid(m,z);let g=this._textureRequests.get(d);if(!g){r=p.createAbortController();
const A=this._streamDataRequester.request(m,"image",{uid:d,signal:r.signal});g={referenceCount:0,texture:null,textureAsync:null,abortController:r};this._textureRequests.set(d,g);g.textureAsync=A.then(q=>{q=this.createTexture(m,q,z);g.texture=q;g.abortController=null;this.addToStage(q);return{uid:d,texture:q}},q=>{g.abortController=null;throw q;})}g.referenceCount++;return(new Promise((A,q)=>{p.onAbort(c,()=>{q(p.createAbortError())});g.textureAsync.then(A,q)})).catch(A=>{this.release(d);throw A;})});
return function(m,z,r){return l.apply(this,arguments)}}();k.fromData=function(l,m){l=this.makeUid(l);let z=this._textureRequests.get(l);z||(z={referenceCount:0,texture:m(),textureAsync:null,abortController:null},this.addToStage(z.texture),this._textureRequests.set(l,z));z.referenceCount++;return{uid:l,texture:z.texture}};k.release=function(l){if(this._textureRequests){var m=this._textureRequests.get(l);m?(1>m.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+l),m.referenceCount--,
1>m.referenceCount&&this._frameTask.schedule(()=>this.releaseNow(l))):console.warn(`TextureCollection: texture doesn't exist: '${l}'`)}};k.releaseNow=function(l){if(this._textureRequests){var m=this._textureRequests.get(l);!m||0<m.referenceCount||(this.releaseTextureRequest(m),this._textureRequests.delete(l))}};k.releaseTextureRequest=function(l){l.texture?this.removeFromStage(l.texture):l.abortController&&(l.abortController.abort(),l.abortController=null)};k.createTexture=function(l,m,z){const r=
{...this._textureOptions,powerOfTwoResizeMode:2};if(t.isSVG(l)){if(z||0===m.width&&0===m.height)l=m.width?m.height/m.width:1,z=z||64,1<l?(m.width=Math.round(z/l),m.height=z):(m.width=z,m.height=Math.round(z*l));this._stage.renderView&&e.testWebGLDriver(this._stage.renderView.renderingContext).svgAlwaysPremultipliesAlpha&&(r.preMultiplyAlpha=!1)}r.width=m.width;r.height=m.height;return new w.Texture(m,r)};k.addToStage=function(l){this._stage.add(l)};k.removeFromStage=function(l){this._stage.remove(l)};
k.makeUid=function(l,m){return null!=m?`${l}.${m}px`:l};u._createClass(h,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return h}();a.TextureCollection=b;a.default=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L){a.PointsOfInterest=function(H){function J(O){O=H.call(this,O)||this;O._handles=new t;O._tmpRay=c.create();O._centerRayDirty=!0;O._surfaceAltitudeAtCenter=0;O._surfaceAltitudeAtCenterDirty=!0;O._contentAltitudeAtCenter=0;O._contentAltitudeAtCenterDirty=!0;O._propertiesPool=new A.PropertiesPool({renderPointOfView:N},u._assertThisInitialized(O));O.renderPointOfView=r.create();O._pois=[];O._debugCenters=new Map;return O}u._inheritsLoose(J,
H);var M=J.prototype;M.initialize=function(){var O;const {state:Q,basemapTerrain:S,renderCoordsHelper:V,map:Y}=this.view;this._surfaceIntersector=new E.Intersector(Q.viewingMode);this._surfaceIntersector.options.backfacesTerrain=Q.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=0;this._contentIntersector=new E.Intersector(Q.viewingMode);var W=()=>this._estimateSurfaceAltitudeAtCenter();const ba=this.view.resourceController.scheduler,ca=w.unwrap(null==
(O=this.view.basemapTerrain)?void 0:O.elevationQueryCache);O={state:Q,scheduler:ba,surface:S,renderCoordsHelper:V};this._set("centerOnSurfaceInfrequent",new x["default"]({...O,task:L.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:W}));this._set("centerOnSurfaceFrequent",new x["default"]({...O,task:L.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:W}));this._set("centerOnContent",new x["default"]({...O,task:L.TaskPriority.POINT_OF_INTEREST_FREQUENT,
estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new y["default"]({...O,cache:ca,task:L.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:Y}));this._set("contentCameraOnSurface",new y["default"]({...O,cache:ca,task:L.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:Y,cameraName:"contentCamera"}));this._set("surfaceGeometryUpdates",new v["default"]({...O,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));
this._set("contentGeometryUpdates",new D.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:V}));this._set("surfaceOrigin",new B.StableSurfaceCenter({cache:ca,view:this.view}));this._set("focus",new C["default"]({state:Q,scheduler:ba,surface:S,renderCoordsHelper:V,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(da,ha)=>this._estimateSurfaceIntersectionAtRenderPoint(da,ha)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,
this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);W=this.view.graphics;this._debugCenters.set(this.centerOnContent,new g.GraphicsHandle(W,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new g.GraphicsHandle(W,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new g.GraphicsHandle(W,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new g.GraphicsHandle(W,"blue","CameraOfInterestOnSurface"));
this._debugCenters.set(this.focus,new g.GraphicsHandle(W,"green","Focus"));this._handles.add([Q.watch("camera",da=>this._cameraChanged(da),!0),S.watch("extent",()=>this._updateCenterPointsOfInterest()),e.whenFalse(S,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),e.init(d,"SHOW_POI",da=>this._setDebug(da))]);
this._cameraChanged(this.view.state.camera);for(const da of this._pois)da.runTask()};M.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const O of this._pois)O.destroy();this.surfaceOrigin.destroy()};M._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const O=this.centerRay;if(w.isNone(O))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(O,
this._contentIntersector,I,K)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};M._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const O=this.centerRay;if(w.isNone(O))return this._surfaceAltitudeAtCenter;const Q=O.origin,
S=z.add(I,O.origin,O.direction);this._surfaceIntersector.resetWithRay(O);this._surfaceIntersector.camera=this.view.state.camera;this.view.basemapTerrain.intersect(this._surfaceIntersector,null,Q,S);this._surfaceIntersector.results.min.getIntersectionPoint(I)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I));return this._surfaceAltitudeAtCenter};M._estimateSurfaceIntersectionAtRenderPoint=function(O,Q){O=q.fromRenderAtEye(this.view.state.camera,O,G);if(w.isNone(O))return null;
const S=O.origin,V=z.add(I,O.origin,O.direction);this._surfaceIntersector.resetWithRay(O);this._surfaceIntersector.camera=this.view.state.camera;this.view.basemapTerrain.intersect(this._surfaceIntersector,null,S,V);return this._surfaceIntersector.results.min.getIntersectionPoint(Q)?Q:null};M._cameraChanged=function(O){this._updateCenterPointsOfInterest();O=O.eye;z.exactEquals(this.renderPointOfView,O)||this._set("renderPointOfView",z.copy(this._propertiesPool.get("renderPointOfView"),O))};M._updateCenterPointsOfInterest=
function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const O of this._pois)O.updateRenderLocation()};M._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};M._setDebug=function(O){if(O)for(const Q of this._pois)this._handles.add(e.init(Q,"renderLocation",S=>this._debugCenters.get(Q).showPoint(S,Q.renderCoordsHelper.spatialReference)),"debug");else this._debugCenters.forEach(Q=>Q.remove()),
this._handles.remove("debug")};u._createClass(J,[{key:"updating",get:function(){var O;return!!(null!=(O=this.surfaceGeometryUpdates)&&O.updating||this._pois.some(Q=>Q.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const O of this._pois)O.runTask()},
surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return J}(p);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);f.__decorate([n.property({readOnly:!0})],
a.PointsOfInterest.prototype,"contentCameraOnSurface",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,
"surfaceGeometryUpdates",void 0);f.__decorate([n.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);f.__decorate([n.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=f.__decorate([m.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const N=Array,I=r.create(),G=c.create(),K={exclude:new Set([F.TERRAIN_ID])};a.default=a.PointsOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,u,f,p,t,w,e,n,b){u=function(){function h(l,m,z=""){this.graphics=l;this._symbol=new e({symbolLayers:[new n({material:{color:m},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new b({text:z,halo:{color:"white",size:1/.75},material:{color:m},size:12})]})}var k=h.prototype;k.showPoint=function(l,m){t.isNone(m)||(this.remove(),l=new w({x:l[0],y:l[1],z:l[2],spatialReference:m}),this._graphic=new f({geometry:l,symbol:this._symbol}),this.graphics.add(this._graphic))};k.remove=
function(){t.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return h}();a.GraphicsHandle=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=Array;a.CameraOnSurface=function(q){function y(D){D=q.call(this,D)||this;D._dirty=!1;D._propertiesPool=new c.PropertiesPool({location:z,renderLocation:g},u._assertThisInitialized(D));D._estimatedSurfaceAltitude=0;D._pendingElevationQueryController=null;D.cameraName="camera";D.renderLocation=m.create();D.tmpPoint=new z;return D}u._inheritsLoose(y,q);var x=y.prototype;x.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const D=()=>this._setDirty();this.handles.add(t.on(this.map,"ground.layers","change",D,D,D))}this._updateRenderLocation()};x.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};x.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};x._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};x._cancelPendingRequest=function(){const D=this._pendingElevationQueryController;
D&&(this._pendingElevationQueryController=null,D.abort(),this.notifyChange("updating"))};x.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var D=p.createAbortController();this.map.ground.queryElevation(this.tmpPoint,{signal:D.signal,cache:this.cache}).then(C=>this._updateSurfaceAltitude(C.geometry.z)).catch(C=>{p.isAbortError(C)||
this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===D&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));D=null});this._pendingElevationQueryController=D}else this._updateSurfaceAltitude(0)};x._updateSurfaceAltitude=function(D){this._estimatedSurfaceAltitude!==D&&(this._estimatedSurfaceAltitude=D,this._updateRenderLocation())};x._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(A,this._estimatedSurfaceAltitude,
this._camera.eye);l.exactEquals(this._get("renderLocation"),A)||this._set("renderLocation",l.copy(this._propertiesPool.get("renderLocation"),A))};u._createClass(y,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"scale",get:function(){const D=this._camera,C=l.distance(D.eye,this.renderLocation);return r.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,
state:{camera:D}},C,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return y}(d.PointOfInterest);f.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);f.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);f.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"task",void 0);f.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);f.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);f.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);f.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);f.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);f.__decorate([w.property({readOnly:!0})],
a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=f.__decorate([k.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const A=m.create();a.default=a.CameraOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){a.PointOfInterest=function(l){function m(z){z=l.call(this,z)||this;z.handles=new t;return z}u._inheritsLoose(m,l);m.prototype.destroy=function(){this.handles.destroy()};return m}(p);f.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);f.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);f.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
f.__decorate([k.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);a.default=a.PointOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projectionEllipsoid ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=Array;a.CenterOnSurface=function(y){function x(C){C=y.call(this,C)||this;C._propertiesPool=new c.PropertiesPool({location:m,renderLocation:g},u._assertThisInitialized(C));C._currentSurfaceAltitude=0;C._latestSurfaceAltitude=0;C.distance=0;C.renderLocation=l.create();C.updating=!1;return C}u._inheritsLoose(x,y);var D=x.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};D.destroy=function(){this._frameWorker&&
(this._frameWorker.remove(),this._frameWorker=null);this._propertiesPool.destroy();this._propertiesPool=null};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};D._updateRenderLocation=function(){const C=A;var B=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,C),v=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;
!B&&v&&(B=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,C))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);v=q;B&&this.latestSurfaceAltitudeChangesDistanceSignificantly(C,v)&&(k.copy(C,v),this._currentSurfaceAltitude=this._latestSurfaceAltitude);B?this.distance=k.distance(this.state.camera.eye,C):(B=this.state.camera,k.scale(C,B.viewForward,this._get("distance")),k.add(C,C,B.eye));k.exactEquals(this._get("renderLocation"),C)||this._set("renderLocation",k.copy(this._propertiesPool.get("renderLocation"),
C))};D.calculateSurfaceIntersection=function(C,B){var v=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(v.ray,C,B))return!1;if(this.state.isGlobal){const E=z.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;C=E+C;const F=k.squaredLength(v.eye),L=F<C*C,N=k.distance(v.eye,B);L&&N>E/4&&(k.scale(B,v.viewForward,C-Math.sqrt(F)),k.add(B,B,v.eye))}else if(v=this.surface.ready&&this.surface.extent)B[0]=p.clamp(B[0],v[0],v[2]),B[1]=p.clamp(B[1],v[1],v[3]);return!0};D.latestSurfaceAltitudeChangesDistanceSignificantly=
function(C,B){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==C)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,B)){if(r.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const v=this.state.camera.eye;C=k.distance(v,C);B=k.distance(v,B);if(.05<Math.abs(B-C)/C)return!0}return!1};u._createClass(x,[{key:"location",get:function(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);
return C}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return x}(d.PointOfInterest);f.__decorate([t.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);f.__decorate([t.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);f.__decorate([t.property()],a.CenterOnSurface.prototype,"distance",void 0);f.__decorate([t.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"estimateSurfaceAltitudeAtCenter",void 0);f.__decorate([t.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);f.__decorate([t.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);f.__decorate([t.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=f.__decorate([h.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const A=l.create(),q=l.create();a.default=a.CenterOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],function(a,u,f){let p=function(){function w(n){this.handles=new f;this.events=new u;this.contentLayerViews=n.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",b=>this.layerViewsChanged(b)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var e=w.prototype;e.destroy=
function(){this.handles&&(this.handles.destroy(),this.handles=null)};e.layerViewsChanged=function(n){n.added.forEach(b=>{"esri.views.3d.layers.SceneLayerView3D"===b.declaredClass&&this.handles.add(b.on("visible-geometry-changed",()=>this.contentChanged()),b.uid)});n.removed.forEach(b=>this.handles.remove(b.uid))};e.contentChanged=function(){this.events.emit("request-update",t)};return w}();const t={};a.ContentGeometryUpdates=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){const A=Array;a.Focus=function(D){function C(v){v=D.call(this,v)||this;v._propertiesPool=new c.PropertiesPool({location:z,renderLocation:A},u._assertThisInitialized(v));v._dirty=!0;v.renderLocation=v._propertiesPool.get("renderLocation");return v}u._inheritsLoose(C,D);var B=C.prototype;B.initialize=function(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("camera",()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(g.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};B.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};B.runTask=function(){var v=this._get("renderLocation");const E=this.centerOnSurface.renderLocation;var F=this.renderCoordsHelper,L=this.state.camera;this._dirty=!1;F.worldUpAtPosition(E,q);F=Math.max(0,(Math.acos(l.dot(q,L.viewForward))-.5*Math.PI)*(L.aboveGround?1:-1));Number.isNaN(F)?v&&l.equals(v,E)||(v=this._propertiesPool.get("renderLocation"),
l.copy(v,E),this._set("renderLocation",v)):(F=1-p.clamp(F/(.5*Math.PI),0,1),F*=F*F,this._calculateScreenHorizontalEdgeOnSurface(x),L=this._propertiesPool.get("renderLocation"),l.lerp(L,E,x,F),v&&l.equals(v,L)||this._set("renderLocation",L))};B._calculateScreenHorizontalEdgeOnSurface=function(v){const E=this.state.camera;var F=E.getRenderCenter(t.createRenderScreenPointArray3());F[1]=E.aboveGround?E.padding[2]:E.fullHeight-E.padding[0];if(this.estimateSurfaceIntersectionAtRenderPoint(F,v))return v;
const L=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return E.unprojectFromRenderScreen(F,y)&&(l.subtract(y,y,E.eye),F=l.normalize(y,y),this.renderCoordsHelper.intersectManifold(r.wrap(E.eye,F),L,v))?v:this.renderCoordsHelper.setAltitude(v,L,E.eye)};B.updateRenderLocation=function(){this._dirty=!0};u._createClass(C,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",get:function(){const v=this._propertiesPool.get("location");
this.renderCoordsHelper.fromRenderCoords(this.renderLocation,v,this.state.spatialReference);return v}},{key:"running",get:function(){return this._dirty}}]);return C}(d.PointOfInterest);f.__decorate([w.property()],a.Focus.prototype,"_dirty",void 0);f.__decorate([w.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);f.__decorate([w.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);f.__decorate([w.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);f.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"updating",null);f.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"location",null);f.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=f.__decorate([k.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const q=m.create(),y=m.create(),x=m.create();a.default=a.Focus;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){a.StableSurfaceCenter=function(d){function g(q){q=d.call(this,q)||this;q.location=null;q._updateController=null;q._handles=new t;return q}u._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),e.on(this,"surface.layers","change",()=>this._update())]),this._update())};A.destroy=function(){this._handles.destroy()};A._update=
function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var q=c.center(this.surfaceView.extent);q=new r({x:q[0],y:q[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=w.createAbortController(),this.surface.queryElevation(q,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(y=>
{this._updateController=null;this._set("location",y.geometry)}).catch(y=>{w.isAbortError(y)||y&&"elevation-query:invalid-layer"===y.name||console.error("StableSurfaceCenter failed to update: ",y)})):this._set("location",q)}else this._set("location",null)};u._createClass(g,[{key:"renderLocation",get:function(){if(!this.location)return null;const q=z.create();this.view.renderCoordsHelper.toRenderCoords(this.location,q);return q}}]);return g}(p);f.__decorate([n.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,
"view",void 0);f.__decorate([n.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);f.__decorate([n.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);f.__decorate([n.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);f.__decorate([n.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);f.__decorate([n.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"renderLocation",null);a.StableSurfaceCenter=f.__decorate([m.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){a.SurfaceGeometryUpdates=function(q){function y(){var D=q.apply(this,arguments)||this;D.handles=new w;D._tileGeometryUpdateExtent=z.empty();D._tileGeometryUpdateSpatialReference=null;D.events=new t;D.updating=!1;return D}u._inheritsLoose(y,q);var x=y.prototype;x.initialize=function(){this.handles.add([this.surface.on("elevation-change",D=>this._tileGeometryChanged(D)),this.scheduler.registerTask(r.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};x.destroy=function(){this.handles&&
(this.handles.destroy(),this.handles=null)};x.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",c),z.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};x._tileGeometryChanged=function(D){this._tileGeometryUpdateSpatialReference=D.spatialReference;z.expand(this._tileGeometryUpdateExtent,D.tile.extent);this._set("updating",!0)};x._furthestCenterOnSurface=function(){let D=
this.centerOnSurfaces[0];for(let C=1;C<this.centerOnSurfaces.length;C++){const B=this.centerOnSurfaces[C];B.distance>D.distance&&(D=B)}return D};x._centerIntersectsExtent=function(D,C){const B=this.state.camera.eye,v=A,E=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(B,d,C);this.renderCoordsHelper.fromRenderCoords(E.renderLocation,g,C);d[0]<g[0]?(v[0]=d[0],v[2]=g[0]):(v[0]=g[0],v[2]=d[0]);d[1]<g[1]?(v[1]=d[1],v[3]=g[1]):(v[1]=g[1],v[3]=d[1]);return z.intersects(v,D)};u._createClass(y,
[{key:"running",get:function(){return this.updating}}]);return y}(p);f.__decorate([e.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);f.__decorate([e.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);f.__decorate([e.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);f.__decorate([e.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);f.__decorate([e.property({constructOnly:!0})],
a.SurfaceGeometryUpdates.prototype,"surface",void 0);f.__decorate([e.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=f.__decorate([l.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const c={},d=m.create(),g=m.create(),A=z.empty();a.default=a.SurfaceGeometryUpdates;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../layers/ElevationLayerView3D ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/updatingProperties ./ElevationBounds ./ElevationData ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./tileUtils ./UpsampleInfo ../../support/Scheduler ../../support/WatchUpdatingTracking".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca,da,ha,fa,R,U,Z,T,P,X,aa,ja,ia,ka){function na(Ba,Ea){return Ba[0]===Ea[0]&&Ba[1]===Ea[1]&&Ba[2]===Ea[2]}function ta(Ba){return Ba.isLeaf?!1:Ba.children[0].shouldLoad||Ba.children[1].shouldLoad||Ba.children[2].shouldLoad||Ba.children[3].shouldLoad||ta(Ba.children[0])||ta(Ba.children[1])||ta(Ba.children[2])||ta(Ba.children[3])}const pa=h.getLogger("esri.views.3d.terrain.TerrainSurface");t=function(Ba){function Ea(ma){var ya=
Ba.call(this,ma)||this;ya._elevationBounds=new Y.ElevationBounds;ya._rootExtent=N.create();ya._iteratorPool=new m(aa.IteratorPreorder,Ma=>Ma.remove=()=>ya._iteratorPool.release(Ma));ya._postorderIterator=new aa.IteratorPostorder;ya._hasPendingUpdates=!1;ya._pendingUpdates=0;ya._asyncWorkItems=0;ya._allTilesDirty=!0;ya._allTilesSorted=!0;ya._visible=!1;ya._usedMemory=-1;ya._performanceInfo=new Z;ya._viewChanged=!1;ya._inFrameTask=!1;ya._viewChangeUpdateDirty=!1;ya._overlayOpacity=1;ya._eyePosRenderSR=
v.create();ya._eyePosSurfaceSR=v.create();ya._splitLimits=new P.SplitLimits;ya._snapLevel=Infinity;ya._frustum=I.create();ya._viewProjectionMatrix=C.create();ya._layerViews=[[],[]];ya._layerIndexByUid=[new Map,new Map];ya._basemapLayerViewHandles=new Map;ya._handles=new b;ya._watchUpdatingTracking=new ka.WatchUpdatingTracking;ya._allTiles=new z;ya._upsampleInfoPool=new m(ja.UpsampleInfo);ya._getElevationData={spatialReference:null,rootTiles:null};ya._maxNumUpdating=1;ya.maxTextureScale=1.2;ya.rootTiles=
null;ya.backgroundImage=R.DEFAULT_TILE_BACKGROUND;ya.backgroundColor=null;ya._layerViewsDirty=!1;return ya}u._inheritsLoose(Ea,Ba);var Ga=Ea.prototype;Ga.initialize=function(){this._lercDecoder=H.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new m(ca.PlanarPatch):new m(da.SphericalPatch);var ma=this.view.resourceController.memoryController;this._upsampleMapCache=ma.getMemCache("esri.views.3d.terrain.upsample",ya=>ya.unloadMapData());this._elevationQueryCache=
new G.ElevationQueryTileCache(ma.getMemCache("elevation-query"));this._set("overlayManager",new ba.OverlayManager({surface:this}));this._handles.add([this.watch("overlayManager.hasHighlights",ya=>this._renderer.setNeedsHighlight(ya)),this.watch("overlayManager.rendersOccluded",ya=>this._renderer.setRenderOccludedOverlay(ya))],"overlayManager");this._renderer=new U({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:L.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,
updateOverlayOpacity:()=>this.updateOverlayOpacity(),allTiles:this._allTiles});this._handles.add([c.init(this,"baseOpacity",ya=>{this._handleLayerViewChanges();this._updateBaseOpacity(ya)},!0),c.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",ya=>{this._renderer.pointsOfInterest=ya;this._watchUpdatingTracking.removeAll();ya&&this._watchUpdatingTracking.add(ya.focus,"renderLocation",()=>()=>this._allTilesSorted=
!1)}),c.init(Q,"TERRAIN_TILE_TREE_SHOW_TILES",ya=>{ya&&!this._treeDebugger?(new Promise(function(Ma,Ra){a(["../layers/support/TerrainTileTree3DDebugger"],Ma,Ra)})).then(({TerrainTileTree3DDebugger:Ma})=>{!this._treeDebugger&&Q.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Ma({view:this.view}))}):ya||!this._treeDebugger||Q.TERRAIN_TILE_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)})]);this.extentHelper=ha.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,
spatialReference:this.view.spatialReference});this._handles.add(c.init(this.extentHelper,"stencilEnabledExtents",ya=>this._renderer.setStencilEnabledLayerExtents(ya)),"extentHelper");ma=this.view.defaultsFromMap?new e({getCollections:()=>{var ya,Ma,Ra;return null==(ya=this.view)?void 0:null==(Ma=ya.defaultsFromMap)?void 0:null==(Ra=Ma.mapCollectionPaths)?void 0:Ra.map(ea=>this.view.map.get(ea))},getChildrenFunction:ya=>ya&&"layers"in ya?ya.layers:null}):this.view.map.allLayers;ma=new fa.SurfaceTilingSchemeLogic({layers:ma,
extentHelper:this.extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",ma);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingSchemeAndExtent(),!0),this.tilingSchemeLogic.watch("extent",()=>this._updateTilingSchemeAndExtent(),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);this._mapDataRequester=
this.view.resourceController.createStreamDataRequester(1);this._frameTask=this.view.resourceController.scheduler.registerTask(ia.TaskPriority.TERRAIN_SURFACE,this);this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate());this._handles.add([this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),
!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),c.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",ya=>this._renderer.textureFadingEnabled=0<ya),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),this.view.watch("clippingArea",()=>this._clippingChanged())]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._updateClippingExtent();
this.notifyChange("extent")};Ga.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=l.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=l.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=l.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",l.destroyMaybe(this.tilingSchemeLogic));this.extentHelper=l.destroyMaybe(this.extentHelper);this._basemapLayerViewHandles.forEach((ma,
ya)=>this._unregisterTiledLayerView(ya));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",l.destroyMaybe(this.overlayManager));this._tilePool=l.destroyMaybe(this._tilePool);P["default"].prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer=l.destroyMaybe(this._renderer);this._iteratorPool=l.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=l.destroyMaybe(this._upsampleInfoPool);J.printAllocations();
X.printAllocations()};Ga.intersect=function(ma,ya,Ma,Ra){this._renderer.intersect(ma,ya,Ma,Ra)};Ga.getElevation=function(ma,ya,Ma,Ra){const ea=xa;ma=this.getTileWithElevation(ma,ya,Ma,Ra,ea);return l.isNone(ma)?null:W.ElevationData.sample(ea[0],ea[1],ma.renderData.geometryState.samplerData)};Ga.getTileWithElevation=function(ma,ya,Ma,Ra,ea=xa){const Ua=this._getElevationData.rootTiles;if(!Ua||!Ua.length||0===Ua[0].layerInfo[0].length)return null;ea[0]=ma;ea[1]=ya;ea[2]=Ma;if(!F.projectVectorToVector(ea,
Ra,ea,this._getElevationData.spatialReference))return pa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Qa of Ua)if(Qa.containsPoint(ea)){for(;Qa&&!Qa.rendered&&!Qa.isLeaf;)ma=0,ea[0]>.5*(Qa.extent[0]+Qa.extent[2])&&(ma+=1),ea[1]<.5*(Qa.extent[1]+Qa.extent[3])&&(ma+=2),Qa=Qa.children[ma];if((ea=Qa.renderData)&&ea.geometryState&&ea.geometryState.samplerData)return Qa;break}return null};Ga.getScale=function(ma){if(this.tilingScheme){if(!F.projectPointToVector(ma,
xa,this.spatialReference))return pa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(ma=this.rootTiles)for(let ya of ma)if(ya.containsPoint(xa)){for(;null!=ya.children[0];)ma=0,xa[0]>ya.children[0].extent[2]&&(ma+=1),xa[1]<ya.children[0].extent[1]&&(ma+=2),ya=ya.children[ma];return this._getLodBiasCorrectedScale(ya.level)}}return 1E100};Ga.queryVisibleScaleRange=function(ma,ya,Ma,Ra){ya=ya?this.tilingScheme.levelAtScale(ya):0;Ma=Ma?this.tilingScheme.levelAtScale(Ma):
Infinity;const ea=this.lodBias;this._renderer.queryVisibleLevelRange(ma,ya+ea,Ma+ea,Ra)};Ga._updateBaseOpacity=function(ma){const ya=this._renderer.opaque;this._renderer.opaque=1<=ma;this._renderer.isTransparent=this._allTransparentSurfaceLayers();if(ma=ya!==this._renderer.opaque){var Ma,Ra;null==(Ma=this.view)?void 0:null==(Ra=Ma._stage)?void 0:Ra.renderView.setRenderParameters({opaqueTerrain:this.opaque})}this._updateTileTextures(ma)};Ga._updateTilingSchemeAndExtent=function(){var ma=this.tilingSchemeLogic.extent;
const ya=ma&&!N.equals(ma,this._dataExtent);ya&&(l.isSome(this._dataExtent)?N.set(this._dataExtent,ma):this._dataExtent=N.create(ma));ma=this.tilingSchemeLogic.tilingScheme;const Ma=ma!==this.tilingScheme;if(Ma){var Ra;T.weakAssert(!!ma,"tiling scheme cannot be reset to undefined");this.tilingScheme&&this._removeAllTiles();this._set("tilingScheme",ma);this._updateClippingExtent();ma&&(this._updateTiledLayers(),this._renderer.setTileSize(ma.pixelSize),this.overlayManager.setSpatialReference(ma.spatialReference));
this._getElevationData.spatialReference=null!=(Ra=null==ma?void 0:ma.spatialReference)?Ra:null}(ya||Ma)&&this._updateRootTiles()};Ga._acquireTile=function(ma,ya,Ma,Ra){const ea=this._tilePool.acquire();Ka[0]=ma;Ka[1]=ya;Ka[2]=Ma;ea.init(Ka,Ra,this);return ea};Ga._updateRootTiles=function(){var ma=this._clippingExtent||this._dataExtent;const ya=this.tilingScheme;if(!l.isNone(ma)&&ya){var Ma=Da,Ra=ya.rootTilesInExtent(ma,Ma,5*R.MAX_ROOT_TILES),ea=Ua=>{Ua=this._acquireTile(0,Ua[1],Ua[2],null);2===Ua.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.lodSnapping)&&Ua.setPendingUpdate(2);this._loadTile(Ua);return Ua};if(this.rootTiles){if(Ra.length>R.MAX_ROOT_TILES){pa.warn(R.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}ma=this.rootTiles.map(Qa=>Qa.lij);const Ua=w.difference(ma,Ra,na);if(0<Ua.removed.length||0<Ua.added.length){const Qa=this.rootTiles.filter(ra=>-1<Ua.removed.findIndex(na.bind(null,ra.lij))?(this._purgeTile(ra),!1):!0);Ua.added.forEach(ra=>Qa.push(ea(ra)));this._setRootTiles(Qa)}}else Ra.length>R.MAX_ROOT_TILES&&
(pa.warn(R.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Ra=ya.rootTilesInExtent(ma,Ma,R.MAX_ROOT_TILES)),this._setRootTiles(Ra.map(Ua=>ea(Ua)));N.equals(Ma,this._rootExtent)||(this._rootExtent=N.create(Ma),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};Ga._setRootTiles=function(ma){this._set("rootTiles",ma);this._allTiles.clear();if(ma){const ya=this._iteratorPool.acquire();for(ya.reset(ma);!ya.done;)this._allTiles.push(ya.next());
ya.remove()}this._getElevationData.rootTiles=ma;this._renderer.setRootTiles(this.rootTiles);this._updateTileVisibility(ma)};Ga._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Ga._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),
this._updateTileVisibility(this.rootTiles)))};Ga._updateClippingStatus=function(ma){ma.updateClippingStatus(this._clippingExtent)&&ma.resetPendingUpdate(32)&&this._updateTileGeometry(ma)};Ga._updateTileVisibility=function(ma){if(ma){var ya=this._iteratorPool.acquire();ya.reset(ma);var Ma=aa.hasLoadableSiblings(ma);ma=Ma?this._elevationBounds.min:Infinity;for(Ma=Ma?this._elevationBounds.max:-Infinity;!ya.done;){const Ra=ya.next();this._updateClippingStatus(Ra);Ra.updateVisibility();Ra.setPendingUpdate(16);
Ra.loadable?(Ra.updateScreenDepth(this._viewProjectionMatrix),Ra.renderData&&(ma=Math.min(Ra.elevationBounds[0],ma),Ma=Math.max(Ra.elevationBounds[1],Ma))):ya.skipSubtree()}ya.remove();this._allTilesDirty=this._viewChanged=!0;isFinite(ma)&&isFinite(Ma)&&(this._elevationBounds.min!==ma||this._elevationBounds.max!==Ma)&&(this._elevationBounds.min=ma,this._elevationBounds.max=Ma,this.emit("elevation-bounds-change",null))}};Ga._updateViewDependentParameters=function(){const ma=this.view.state.camera,
ya=this.view.state.contentCamera,Ma=Math.tan(.5*ya.fovX),Ra=Math.tan(.5*ya.fovY),ea=this.tilingScheme.pixelSize,Ua=2**-this.lodBias*ma.pixelRatio;this._splitLimits.aboveGround=ma.aboveGround;this._splitLimits.fovX=Ma;this._splitLimits.fovY=Ra;this._splitLimits.relativeWidthLimit=ea/ma.width*this.maxTextureScale*Ua;this._splitLimits.relativeHeightLimit=ea/ma.height*this.maxTextureScale*Ua;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;
this.view.state.fixedContentCamera?(l.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=I.create()),I.copy(ya.frustum,this._splitLimits.frustum)):this._splitLimits.frustum=null;I.copy(ma.frustum,this._frustum);D.multiply(this._viewProjectionMatrix,ya.projectionMatrix,ya.viewMatrix);B.copy(this._eyePosRenderSR,ya.eye);F.projectVectorToVector(ma.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Ga._updateSkirts=function(){const ma=this.view.state.camera;
this.skirtScale=T.computeSkirtScale(this,this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?0:1.11*ma.near)};Ga._updateRenderData=function(ma){ma.rendered&&!ma.shouldLoad&&(ta(ma)?this._loadChildren(ma):ma.isLeaf&&ma.parent&&ma.parent.shouldLoad&&this._loadParent(ma))};Ga._updateTileGeometry=function(ma){ma.updateVisibility();this._renderer.updateTileGeometry(ma);this._elevationUpdate(ma);this._usedMemory=-1};Ga._elevationUpdate=function(ma){Ha.spatialReference=this.spatialReference;
Ha.tile=ma;Ha.extent=ma.extent;this.emit("elevation-change",Ha);N.containsPoint(ma.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};Ga.runTask=function(ma){this._handleLayerViewChanges(ma);this._frameTask.processQueue(ma);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(ma);this._sortTiles(ma);const ya=!this.view.state.fixedContentCamera;this._mergeAndSplit(ma,ya);ma.run(()=>this._updateElevation(ma));ma.run(()=>this._updateTextures(ma));ya||this._mergeAndSplit(ma,
!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();ma.done&&this.requestUpdate();this.notifyChange("updatingProgressValue")};Ga._updateTileStatus=function(ma){if(this._viewChanged&&this.rootTiles&&!ma.done){this._viewChanged=!1;var ya=this._iteratorPool.acquire();for(ya.reset(this.rootTiles);!ya.done;){var Ma=ya.next();if(Ma.loadable){var Ra=Ma.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===Ra){Ma.resetPendingUpdate(8);Ma.isLeaf&&(Ma.setPendingUpdate(2),ya.skipSubtree());
continue}Ma.resetPendingUpdate(2)&&Ma.updateAgentSuspension();4===Ra&&Ma.updateAgents(0)}ya.skipSubtree();if(!Ma.isLeaf){Ma.setPendingUpdate(8);Ma.resetPendingUpdate(2);Ra=this._iteratorPool.acquire();Ra.resetOne(Ma);for(Ma=Ra.next();!Ra.done;Ma=Ra.next())this._updateClippingStatus(Ma),Ma.updateVisibility(),Ma.loadable&&Ma.updateScreenDepth(this._viewProjectionMatrix);Ra.remove()}}ya.remove();this.requestUpdate();ma.madeProgress()}};Ga._sortTiles=function(ma){ma.done||this._allTilesSorted||(aa.sortTilesByPOI(this._allTiles,
this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),ma.madeProgress())};Ga._mergeAndSplit=function(ma,ya){if(!this.suspended&&this._allTilesDirty&&!ma.done){this._allTilesDirty=!1;this.requestUpdate();for(var Ma=0;!ma.done;){let Ra=!1;Ma=0;const ea=!this._allTiles.some(Ua=>{Ma+=Ua.usedMemory;if(Ua.resetPendingUpdate(8)){if(!ya)return Ua.setPendingUpdate(8),ma.done;this._mergeTile(Ua);Ra=!0;ma.madeProgress()}else Ua.resetPendingUpdate(2)&&
(this._splitTile(Ua),Ra=!0,ma.madeProgress());Ua.resetPendingUpdate(16)&&(this._updateRenderData(Ua),ma.madeProgress());return ma.done});Ra&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(ea){if(this._usedMemory=Ma,!Ra)break}else this._allTilesDirty=!0}0===Ma&&(this._allTilesDirty=!0);this._sortTiles(ma)}};Ga._updateElevation=function(ma){this._allTiles.some(ya=>{ya.resetPendingUpdate(32)&&(this._updateTileGeometry(ya),ya.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(ya),this._usedMemory=
-1),ma.madeProgress());return ma.done});return ma.hasProgressed};Ga._updateTextures=function(ma){this._allTiles.some(ya=>{ya.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(ya),this._usedMemory=-1,ma.madeProgress());return ma.done});return ma.hasProgressed};Ga._updateClippingExtent=function(){if(!this.spatialReference)return!1;const ma=N.create();let ya=null;S.toBoundingRect(this.view.clippingArea,ma,this.spatialReference)&&(ya=ma);if(N.equals(ya,this._clippingExtent))return!1;this._clippingExtent=
ya;this._renderer.clippingExtent=ya;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};Ga._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Ga._getLodBiasCorrectedScale=function(ma){const ya=this.tilingScheme.levels;ma=k.clamp(ma-this.lodBias,0,ya.length-1);const Ma=ma-Math.floor(ma);return ya[Math.floor(ma)].scale*(1-Ma)+ya[Math.ceil(ma)].scale*Ma};Ga._removeAllTiles=function(){this.rootTiles&&(this.rootTiles.forEach(ma=>
this._purgeTile(ma)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Ga._purgeChildTiles=function(ma){if(ma.isLeaf)return!1;let ya=this._purgeTile(ma.children[0]);ya=this._purgeTile(ma.children[1])||ya;ya=this._purgeTile(ma.children[2])||ya;ya=this._purgeTile(ma.children[3])||ya;ma.unsetChildren();return ya};Ga._purgeTile=function(ma){const ya=this._purgeChildTiles(ma)||ma.rendered;this._allTiles.removeUnordered(ma);ma.unload(this._renderer);this._tilePool.release(ma);
return ya};Ga._splitTile=function(ma){T.weakAssert(ma.isLeaf,"tile that is already split should not be split again!");const ya=ma.level+1,Ma=2*ma.lij[1],Ra=2*ma.lij[2];ma.setChildren(this._createTile(ya,Ma,Ra,ma),this._createTile(ya,Ma,Ra+1,ma),this._createTile(ya,Ma+1,Ra,ma),this._createTile(ya,Ma+1,Ra+1,ma));ma.setPendingUpdate(16);ma.updateAgentSuspension();this._allTiles.pushArray(ma.children);this._allTilesDirty=!0;this._emitTileScaleChange(ma,ya);++this._performanceInfo.numSplit};Ga._emitTileScaleChange=
function(ma,ya=ma.level){ua.spatialReference=this.spatialReference;ua.extent=ma.extent;ua.scale=this._getLodBiasCorrectedScale(ya);this.emit("scale-change",ua)};Ga._createTile=function(ma,ya,Ma,Ra){T.weakAssert(!!Ra,"_createTile sanity check");ma=this._acquireTile(ma,ya,Ma,Ra);ma.updateClippingStatus(this._clippingExtent);ma.loadable&&(ma.updateScreenDepth(this._viewProjectionMatrix),2===ma.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&ma.setPendingUpdate(2));return ma};Ga._mergeTile=
function(ma){T.weakAssert(!ma.hasPendingUpdate(2),"_mergeTile sanity check");this._purgeChildTiles(ma)&&(T.weakAssert(!ma.renderData,"_mergeTile sanity check"),this._loadTile(ma));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(ma)};Ga._loadChildren=function(ma){T.weakAssert(ma.rendered,"parent should be rendered");ma.unload(this._renderer);this._loadTile(ma.children[0]);this._loadTile(ma.children[1]);this._loadTile(ma.children[2]);this._loadTile(ma.children[3])};
Ga._loadParent=function(ma){ma=ma.parent;this._unloadChildren(ma);this._loadTile(ma)};Ga._unloadChildren=function(ma){ma.isLeaf||(this._unloadChildren(ma.children[0]),ma.children[0].unload(this._renderer),this._unloadChildren(ma.children[1]),ma.children[1].unload(this._renderer),this._unloadChildren(ma.children[2]),ma.children[2].unload(this._renderer),this._unloadChildren(ma.children[3]),ma.children[3].unload(this._renderer))};Ga._loadTile=function(ma){ma.load(this._renderer);ma.setPendingUpdate(16);
this.requestUpdate();this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(ma);this._elevationUpdate(ma)};Ga._elevationDataArrived=function(ma,ya,Ma){Ma=new W.ElevationData(ma.lij,ma.extent,Ma);ma.dataArrived(ya,0,Ma);Ma=[ma];ma=ma.level;const Ra=this._iteratorPool.acquire();for(Ra.reset(Ma);!Ra.done;){const ea=Ra.next();ea.findElevationBoundsForLayer(ya,ma);ea.computeElevationBounds()}Ra.remove();this._updateTileVisibility(Ma)};Ga._handleLayerViewChanges=function(ma=
ia.noBudget){if(this._layerViewsDirty){var ya=this._layerViewsDirty=!1,Ma=new Set,Ra=-1;for(const Ua of this.view.allLayerViews.items)if(Ma.add(Ua.uid),T.isSurfaceLayerView(Ua))if(this._basemapLayerViewHandles.has(Ua.uid)){var ea=this.layerClassFromLayerView(Ua);ea=this._layerIndexByUid[ea].get(Ua.uid);ea<Ra&&(ya=!0);Ra=ea}else this._registerTiledLayerView(Ua),Ua.layer.loaded&&(ya=!0);this._basemapLayerViewHandles.forEach((Ua,Qa)=>{Ma.has(Qa)||(this._unregisterTiledLayerView(Qa),ya=!0)});ya&&this._updateTiledLayers();
this._renderer.isTransparent=this._allTransparentSurfaceLayers();ma.madeProgress()}};Ga._allTransparentSurfaceLayers=function(){let ma=0===this.view.map.ground.opacity;for(const ya of this.view.allLayerViews.items)if(T.isSurfaceLayerView(ya)&&!T.isElevationLayerView(ya)&&!K.isBaseLayer(ya.layer)&&0!==ya.fullOpacity){ma=!1;break}return ma};Ga.layerClassFromLayerView=function(ma){return T.isElevationLayerView(ma)?0:1};Ga._registerTiledLayerView=function(ma){const ya=[],Ma=this.layerClassFromLayerView(ma);
ya.push(ma.watch("suspended",()=>this._updateTiledLayers()));ya.push(ma.watch("fullOpacity",()=>this._updateTileTextures(!1)));ya.push(ma.layer.watch("scaleRangeId",()=>this._restartAllAgents(Ma)));ma.on("data-changed",()=>{const Ra=this._layerIndexByUid[Ma].get(ma.uid);null!=Ra&&this._invalidateLayerData(Ra,Ma)});this._basemapLayerViewHandles.set(ma.uid,ya)};Ga._unregisterTiledLayerView=function(ma){const ya=this._basemapLayerViewHandles.get(ma);if(ya){for(let Ma=0;Ma<ya.length;Ma++)ya[Ma].remove();
this._basemapLayerViewHandles.delete(ma)}};Ga._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var ma=this.view.allLayerViews,ya=[[],[]],Ma=null,Ra=N.empty();ma.forEach(Ua=>{var Qa=Ua.layer;if(Qa&&!Ua.suspended&&T.isSurfaceLayerView(Ua)){var ra=Ua.fullExtent;ra?this.tilingScheme.compatibleWith(Ua.tileInfo)?(N.expand(Ra,ra),Qa=this.layerClassFromLayerView(Ua),1===Qa&&(ra=Ua.displayLevelRange,Infinity!==ra.maxLevel&&(null===Ma||ra.maxLevel>Ma)&&(Ma=ra.maxLevel)),ya[Qa].push(Ua)):
pa.warn("Terrain: tiling scheme of layer "+Qa.id+" is incompatible with other tiled layers, will not be drawn"):pa.warn("Terrain: Map or elevation layer does not have fullExtent: "+Qa.id)}});for(const Ua of R.LayerClasses){var ea=this._layerViews[Ua];ma=ya[Ua];ma.reverse();const Qa=ma.length;let ra=ea.length!==Qa;const va=Array(Qa),La=Array(ea.length);this._layerIndexByUid[Ua].clear();for(let Ta=0;Ta<Qa;Ta++){this._layerIndexByUid[Ua].set(ma[Ta].uid,Ta);const Pa=ea.indexOf(ma[Ta]);va[Ta]=Pa;Ta!==
Pa&&(ra=!0);-1<Pa&&(La[Pa]=Ta)}if(ra){ea=this._postorderIterator;for(ea.reset(this.rootTiles);!ea.done;)ea.next().modifyLayers(La,va,Ua);this._layerViews[Ua]=ma;this._restartAllAgents(Ua);this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ma)&&this._viewChangeUpdate()}};Ga._restartAllAgents=function(ma){const ya=this._postorderIterator;for(ya.reset(this.rootTiles);!ya.done;){const Ma=ya.next();Ma.restartAgents(ma);0===ma&&Ma.computeElevationBounds()}};Ga._hasFixedExtent=function(){return!!this._clippingExtent};
Ga.layerViewByIndex=function(ma,ya){return this._layerViews[ya][ma]};Ga.numLayers=function(ma){return this._layerViews[ma].length};Ga._updateTileTextures=function(ma){this._allTiles.forAll(ya=>{ya.updateAgents(1);ma?this.renderer.updateTileTexture(ya):ya.updateRenderData(1)});this._renderer.isTransparent=this._allTransparentSurfaceLayers()};Ga._invalidateLayerData=function(ma,ya){this._allTiles.forAll(Ma=>Ma.removeLayerAgent(ma,ya));this._allTiles.forAll(Ma=>Ma.invalidateLayerData(ma,ya))};Ga.setTileTreeDirty=
function(){this._allTilesDirty=!0};Ga.requestRender=function(ma=1){this.renderer.setNeedsRender(ma)};Ga.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Ga.requestTileData=function(ma,ya,Ma,Ra){const ea=this.layerViewByIndex(ya,Ma);ya=ea.layer;if(!ya.tilemapCache||T.isVectorTileLayerView(ea))return this._requestTileData(ma,Ma,ea,Ra);++this._asyncWorkItems;return ya.tilemapCache.fetchAvailability(ma.lij[0],ma.lij[1],ma.lij[2],{...Ra,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ua=>
{--this._asyncWorkItems;r.isAbortError(Ua)||this._dataMissing(ma,Ma,ea,{notInTilemap:!0});throw Ua;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(ma,Ma,ea,Ra),Ra.signal))};Ga._requestTileData=function(ma,ya,Ma,Ra){return 0===ya?this._requestElevationTileData(ma,Ma,Ra):this._requestMapTileData(ma,Ma,Ra)};Ga._requestElevationTileData=function(ma,ya,Ma){if(T.isElevationLayerView(ya)){var Ra=Qa=>{--this._asyncWorkItems;if(!r.isAborted(Ma)){var ra=this._layerIndexByUid[0].get(ya.uid);null==
ra?pa.warn("TerrainSurface: received data from unknown layer %d %s",0,ma.lij.toString()):(this._usedMemory=-1,this.requestUpdate(),this._elevationDataArrived(ma,ra,Qa))}},ea=Qa=>{--this._asyncWorkItems;r.isAbortError(Qa)||(this._dataMissing(ma,0,ya,Qa),this.requestUpdate())};++this._asyncWorkItems;if(T.useFetchTileForLayer(ya.layer))return ya.layer.fetchTile(ma.lij[0],ma.lij[1],ma.lij[2],{noDataValue:R.ELEVATION_NODATA_VALUE,signal:Ma.signal}).then(Qa=>{r.isAborted(Ma)?(pa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
ea(r.createAbortError())):this._frameTask.schedule(()=>Ra(Qa),Ma.signal)},ea);var Ua=ya.getTileUrl(ma.lij[0],ma.lij[1],ma.lij[2]);return this._elevationDataRequester.request(Ua,"binary",Ma).then(Qa=>this._lercDecoder.decode(Qa,{noDataValue:R.ELEVATION_NODATA_VALUE},Ma.signal)).then(Qa=>{Ra({values:Qa.pixelData,width:Qa.width,height:Qa.height,noDataValue:Qa.noDataValue,minValue:Qa.minValue,maxValue:Qa.maxValue})},ea)}T.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};
Ga._requestMapTileData=function(ma,ya,Ma){if(ya instanceof M)return Promise.reject();++this._asyncWorkItems;const Ra=(va,La)=>{--this._asyncWorkItems;T.releaseTileData(La);r.isAborted(Ma)||(this._dataMissing(ma,1,ya,va),this.requestUpdate())},ea=va=>La=>Ra(La,va),Ua=va=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();r.isAborted(Ma)?T.releaseTileData(va):this._mapTileDataArrived(ma,ya,va)},Ma.signal,ea(va)).catch(ea(va)),Qa=(va,La=null)=>this._frameTask.schedule(()=>Ra(va,
La)).catch(ea(La));if(T.isVectorTileLayerView(ya)){var ra=ya.schemaHelper.getLevelRowColumn(ma.lij);return ya.fetchTile(ra[0],ra[1],ra[2],Ma).then(Ua,Qa)}if(T.isImageryTileLayerView(ya))return ya.fetchTile(ma.lij[0],ma.lij[1],ma.lij[2],Ma).then(Ua,Qa);if(T.isTileLayerView(ya)&&T.useFetchTileForLayer(ya.layer))return ya.layer.fetchTile(ma.lij[0],ma.lij[1],ma.lij[2],Ma).then(va=>{r.isAborted(Ma)?(pa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
Qa(r.createAbortError())):Ua(va)},Qa);ra=ya.getTileUrl(ma.lij[0],ma.lij[1],ma.lij[2]);null!=ya.refreshInterval&&ya.refreshTimestamp&&(ra+=`${-1<ra.indexOf("?")?"\x26":"?"}_ts=${ya.refreshTimestamp}`);return this._mapDataRequester.request(ra,ya.hasMixedImageFormats?"image+type":"image",Ma).then(Ua,Qa)};Ga._mapTileDataArrived=function(ma,ya,Ma){ya=this._layerIndexByUid[1].get(ya.uid);null!=ya?ma.dataArrived(ya,1,Ma):(T.releaseTileData(Ma),pa.warn("TerrainSurface: received data from unknown layer"))};
Ga._dataMissing=function(ma,ya,Ma,Ra){Ma=this._layerIndexByUid[ya].get(Ma.uid);null!=Ma?ma.dataMissing(Ma,ya,Ra):pa.warn("TerrainSurface: received data from unknown layer")};Ga.updateTileOverlayParams=function(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(ma=>{ma.renderData&&this.overlayManager.setTileParameters(ma)}),this._renderer.setNeedsRender())};Ga.updateOverlayOpacity=function(){if(this.overlayManager){var ma=this.overlayManager.computeOpacity(this._eyePosSurfaceSR[2]);this._overlayOpacity!==
ma&&(this._overlayOpacity=ma,this._renderer.overlayOpacity=ma,this._renderer.setNeedsRender())}};Ga.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(ma=>this._usedMemory+=ma.usedMemory));return this._usedMemory};Ga.getUsedMemoryForLayerView=function(ma){let ya=0;const Ma=this.layerClassFromLayerView(ma),Ra=this._layerIndexByUid[Ma].get(ma.uid);this._allTiles.forAll(ea=>ya+=ea.getUsedMemoryForLayer(Ma,Ra));return ya};Ga.getTile=
function(ma){if(l.isNone(ma))return null;const ya=ma.split("/").map(Ua=>+Ua);if(0===ya[0])return this.rootTiles.find(Ua=>Ua.lij[1]===ya[1]&&Ua.lij[2]===ya[2]);ma=2**ya[0];const Ma=Math.floor(ya[1]/ma),Ra=Math.floor(ya[2]/ma);let ea;this.rootTiles.some(Ua=>Ua.lij[1]===Ma&&Ua.lij[2]===Ra?(ea=Ua,!0):!1);if(ea){for(ma=1<<ya[0]-1;ea.lij[0]<ya[0];){let Ua=ya[1]&ma?2:0;0<(ya[2]&ma)&&Ua++;if(!ea.children[Ua])return null;ea=ea.children[Ua];ma>>=1}T.weakAssert(ea.lij[0]===ya[0]&&ea.lij[1]===ya[1]&&ea.lij[2]===
ya[2],"not the right tile?");return ea}return null};u._createClass(Ea,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){var ma,ya,Ma=null==(ma=this.view.pointsOfInterest)?void 0:null==(ya=ma.contentCameraOnSurface)?void 0:ya.scale;Ma&&(ma=this.view.state.contentCamera,ma=O.directionToHeadingTilt(this.view,ma.eye,ma.viewForward,ma.up).tilt,90<ma&&(ma=180-ma),ma=2*(ma/90)**2,Ma=O.scaleToZoom(this.view,Ma)-ma,
.25<Math.abs(this._snapLevel-Ma)&&(Math.round(Ma)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Ma));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",
get:function(){return this._mapDataRequester}},{key:"extent",get:function(){return l.unwrapOr(this._clippingExtent,this._rootExtent)}},{key:"updating",get:function(){this._hasPendingUpdates||(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},
{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return!!this.rootTiles}},{key:"renderOrder",set:function(ma){this._renderer.renderOrder=ma;this._set("renderOrder",ma)}},{key:"skirtScale",get:function(){return this._renderer.skirtScale},set:function(ma){this._renderer.skirtScale=ma}},
{key:"spatialReference",get:function(){var ma,ya;return null!=(ma=null==(ya=this.tilingScheme)?void 0:ya.spatialReference)?ma:null}},{key:"_background",get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(ma){var ya,Ma;this._renderer.slicePlane=ma;this._set("slicePlaneEnabled",ma);null==(ya=this.view)?void 0:null==(Ma=ya._stage)?void 0:Ma.renderView.setRenderParameters({opaqueTerrain:this.opaque})}},{key:"velvetOverground",
set:function(ma){ma!==this.velvetOverground&&(this._renderer.velvetOverground=ma);this._set("velvetOverground",ma)}},{key:"visible",set:function(ma){ma!==this._visible&&(this._visible=ma,this._renderer.setVisibility(ma),this.suspended=!ma)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(ma){this._set("suspended",ma);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"running",get:function(){return this.updating&&
this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*R.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const ma=this._performanceInfo;ma.numNodes=this._allTiles.length;ma.numLeaves=ma.numVisible=ma.numRendered=ma.numLoadedPerLevel.length=ma.numRenderedPerLevel.length=0;this._allTiles.forAll(ya=>{ya.isLeaf&&ma.numLeaves++;const Ma=ya.level;ya.renderData&&(ma.numLoadedPerLevel[Ma]=
(ma.numLoadedPerLevel[Ma]||0)+1);ya.visible&&(ma.numVisible++,ya.rendered&&(ma.numRenderedPerLevel[Ma]=(ma.numRenderedPerLevel[Ma]||0)+1,ma.numRendered++))});return ma}},{key:"test",get:function(){const ma=this;return{renderer:ma._renderer,lercDecoder:ma._lercDecoder,forceReload:()=>{ma._mergeTile(ma.rootTiles[0]);ma._viewChangeUpdate()},getTiles:()=>ma._allTiles.toArray(),getRenderedTiles(){Fa.clear();ma._allTiles.forAll(ya=>{ya.visible&&ya.rendered&&Fa.push(ya)});aa.sortTiles(ma.renderOrder,Fa);
return Fa.toArray()}}}}]);return Ea}(n.EventedMixin(t));f.__decorate([y.property()],t.prototype,"_renderer",void 0);f.__decorate([y.property()],t.prototype,"_hasPendingUpdates",void 0);f.__decorate([y.property()],t.prototype,"_asyncWorkItems",void 0);f.__decorate([y.property()],t.prototype,"_allTilesDirty",void 0);f.__decorate([y.property()],t.prototype,"_allTilesSorted",void 0);f.__decorate([y.property()],t.prototype,"_viewChanged",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"_watchUpdatingTracking",
void 0);f.__decorate([y.property()],t.prototype,"_frameTask",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"snapLevel",null);f.__decorate([y.property({readOnly:!0})],t.prototype,"lodSnapping",null);f.__decorate([y.property({constructOnly:!0})],t.prototype,"view",void 0);f.__decorate([d.aliasOf("_renderer.cullBackFaces")],t.prototype,"cullBackFaces",void 0);f.__decorate([y.property({readOnly:!0,dependsOn:[]})],t.prototype,"extent",null);f.__decorate([y.property({readOnly:!0})],t.prototype,
"updating",null);f.__decorate([y.property(V.updatingProgress)],t.prototype,"updatingProgress",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"updatingProgressValue",null);f.__decorate([y.property()],t.prototype,"_maxNumUpdating",void 0);f.__decorate([y.property({aliasOf:"view.map.ground.opacity"})],t.prototype,"baseOpacity",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"overlayManager",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"viewingMode",null);f.__decorate([y.property()],
t.prototype,"maxTextureScale",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"ready",null);f.__decorate([y.property({value:1})],t.prototype,"renderOrder",null);f.__decorate([y.property({readOnly:!0})],t.prototype,"rootTiles",void 0);f.__decorate([y.property({readOnly:!0})],t.prototype,"spatialReference",null);f.__decorate([y.property()],t.prototype,"backgroundImage",void 0);f.__decorate([y.property({type:p,aliasOf:"view.map.ground.surfaceColor"})],t.prototype,"backgroundColor",void 0);
f.__decorate([y.property()],t.prototype,"_background",null);f.__decorate([y.property({value:!1})],t.prototype,"slicePlaneEnabled",null);f.__decorate([y.property({readOnly:!0})],t.prototype,"tilingScheme",void 0);f.__decorate([y.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],t.prototype,"tilingSchemeLocked",void 0);f.__decorate([y.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],t.prototype,"tilingSchemeDone",void 0);f.__decorate([y.property({readOnly:!0})],
t.prototype,"tilingSchemeLogic",void 0);f.__decorate([y.property({value:!0})],t.prototype,"velvetOverground",null);f.__decorate([d.aliasOf("_renderer.wireframe")],t.prototype,"wireframe",void 0);f.__decorate([y.property({value:!1})],t.prototype,"suspended",null);f.__decorate([y.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],t.prototype,"textureFadeDuration",void 0);f.__decorate([y.property()],t.prototype,"_layerViewsDirty",void 0);f.__decorate([d.aliasOf("_renderer.renderPatchBorders")],
t.prototype,"renderPatchBorders",void 0);f.__decorate([d.aliasOf("_renderer.renderingDisabled")],t.prototype,"renderingDisabled",void 0);f=t=f.__decorate([x.subclass("esri.views.3d.terrain.TerrainSurface")],t);const xa=E.create(),Da=N.create(),Ka=[0,0,0],Fa=new z,Ha={spatialReference:null,tile:null,extent:null,context:"ground"},ua={spatialReference:null,extent:null,scale:0};return f})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){let u=function(){function f(t){this.store=
t}var p=f.prototype;p.destroy=function(){this.store.destroy()};p.get=function(t){return this.store.get(t)};p.put=function(t,w){this.store.put(t,w,w.values.byteLength+256)};return f}();a.ElevationQueryTileCache=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],function(a,u,f,p){let t=function(e){function n(h=null){var k=e.call(this,"LercWorker",
"_decode",h,{strategy:"dedicated"})||this;k.schedule=h;k.ref=0;return k}u._inheritsLoose(n,e);var b=n.prototype;b.decode=function(h,k,l){return h&&0!==h.byteLength?this.invoke({buffer:h,options:k},l):Promise.resolve(null)};b.getTransferList=function(h){return[h.buffer]};b.release=function(){0>=--this.ref&&(w.forEach((h,k)=>{h===this&&w.delete(k)}),this.destroy())};return n}(p.WorkerHandle);const w=new Map;a.acquireDecoder=function(e=null){let n=w.get(f.unwrap(e));n||(f.isSome(e)?(n=new t(b=>e.schedule(b)),
w.set(e,n)):(n=new t,w.set(null,n)));++n.ref;return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,u,f,p,t,w,e,n){const b=t.getLogger("esri.core.workers.WorkerHandle");t=function(){function h(l,m,z,r={}){this._mainMethod=m;this._listeners=[];this._promise=n.open(l,{...r,schedule:z}).then(c=>{if(void 0===
this._thread){this._thread=c;this._promise=null;r.hasInitialize&&this.broadcast({},"initialize");for(const d of this._listeners)this._connectListener(d)}else c.close()});this._promise.catch(c=>b.error(`Failed to initialize ${l} worker: ${c}`))}var k=h.prototype;k.on=function(l,m){const z={removed:!1,eventName:l,callback:m,threadHandle:null};this._listeners.push(z);this._connectListener(z);return p.makeHandle(()=>{z.removed=!0;f.remove(this._listeners,z);this._thread&&w.isSome(z.threadHandle)&&z.threadHandle.remove()})};
k.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};k.invoke=function(l,m){return this.invokeMethod(this._mainMethod,l,m)};k.invokeMethod=function(l,m,z){if(this._thread){const r=this.getTransferList(m,l);return this._thread.invoke(l,m,{transferList:r,signal:z})}return this._promise?this._promise.then(()=>{e.throwIfAborted(z);return this.invokeMethod(l,m,z)}):Promise.reject(null)};k.broadcast=function(l,m){return this._thread?Promise.all(this._thread.broadcast(m,
l)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(l,m)):Promise.reject()};k._connectListener=function(l){this._thread&&this._thread.on(l.eventName,l.callback).then(m=>{l.removed||(l.threadHandle=m)})};u._createClass(h,[{key:"promise",get:function(){return this._promise}}]);return h}();a.WorkerHandle=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){t=function(m){function z(){var r=m.apply(this,arguments)||this;r.type="elevation-3d";return r}a._inheritsLoose(z,m);z.prototype.initialize=function(){var r=this.get("view.map.allLayers");r=r&&r.includes(this.layer);var c=this.get("view.map.ground.layers");c=c&&c.includes(this.layer);r&&!c&&(r=new f("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(Promise.reject(r)));this._addTilingSchemeMatchPromise()};
return z}(k.TiledLayerView3D(h.LayerView3D(l)));u.__decorate([p.property({readOnly:!0,aliasOf:"layer.fullExtent"})],t.prototype,"fullExtent",void 0);u.__decorate([p.property()],t.prototype,"layer",void 0);u.__decorate([p.property({readOnly:!0,aliasOf:"layer.tileInfo"})],t.prototype,"tileInfo",void 0);return t=u.__decorate([b.subclass("esri.views.3d.layers.ElevationLayerView3D")],t)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){a.LayerView3D=l=>{l=function(m){function z(){var c=m.apply(this,arguments)||this;c.slicePlaneEnabled=!1;c.supportsHeightUnitConversion=!1;return c}u._inheritsLoose(z,m);var r=z.prototype;r.postscript=function(c){m.prototype.postscript.call(this,c);k.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};r._validateHeightModelInfo=function(){var c=u._asyncToGenerator(function*(){var d=p.whenFalseOnce(this.view.defaultsFromMap,
"isHeightModelInfoSearching");this.handles.add(d);yield d;if(d=k.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw d;});return function(){return c.apply(this,arguments)}}();return z}(l);f.__decorate([t.property()],l.prototype,"view",void 0);f.__decorate([t.property()],l.prototype,"slicePlaneEnabled",void 0);return l=f.__decorate([h.subclass("esri.views.3d.layers.LayerView3D")],l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.TiledLayerView3D=z=>{z=function(r){function c(){return r.apply(this,arguments)||this}u._inheritsLoose(c,r);var d=c.prototype;d.getTileUrl=function(g,A,q){return this.layer.getTileUrl(g,A,q)};d._addTilingSchemeMatchPromise=function(){var g=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);g?this.addResolvingPromise(Promise.reject(g)):(g=t.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const A=this._getTileInfoCompatibilityError(this.tileInfo,
this.view.basemapTerrain.tilingScheme);if(A)throw A;}),this.addResolvingPromise(g))};d._getTileInfoSupportError=function(g,A){if(g=m.checkIfTileInfoSupportedForView(g,A,this.view.spatialReference,this.view.state.viewingMode)){A={layer:this.layer,error:g};switch(g.name){case "tilingscheme:local-gcs-not-supported":g=new p("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",A);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":g=
new p("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",A);break;default:g=new p("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",A)}return g}return null};d._getTileInfoCompatibilityError=function(g,A){return A.compatibleWith(g)?null:new p("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};d.levelRangeFromScaleRange=
function(g,A){const q={minLevel:0,maxLevel:Infinity};var y=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!y)return q;const x=y.levels[0];y=D=>{D=Math.log(x.scale/D)/Math.LN2;return 1E-9>.5-Math.abs(.5-D%1)?Math.round(D):Math.ceil(D)};null!=g&&0<g&&(q.minLevel=Math.max(0,y(g)));null!=A&&0<A&&(q.maxLevel=Math.max(0,y(A)));return q};d.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};u._createClass(c,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const g=this.tileInfo.lods;return this.levelRangeFromScaleRange(g[0].scale,g[g.length-1].scale)}},{key:"displayLevelRange",get:function(){var g=this.tileInfo.lods;g=this.levelRangeFromScaleRange(this.layer.minScale||g[0].scale,this.layer.maxScale||g[g.length-1].scale);this.layer.maxScale&&g.maxLevel++;return g}}]);return c}(z);f.__decorate([w.property({readOnly:!0})],
z.prototype,"imageFormatIsOpaque",null);f.__decorate([w.property({readOnly:!0})],z.prototype,"updating",void 0);f.__decorate([w.property(l.updatingProgress)],z.prototype,"updatingProgress",void 0);f.__decorate([w.property(l.updatingProgressValue)],z.prototype,"updatingProgressValue",void 0);f.__decorate([w.property({readOnly:!0})],z.prototype,"fullExtent",void 0);f.__decorate([w.property({readOnly:!0})],z.prototype,"isOpaque",null);f.__decorate([w.property({readOnly:!0})],z.prototype,"dataLevelRange",
null);f.__decorate([w.property({readOnly:!0})],z.prototype,"displayLevelRange",null);f.__decorate([w.property()],z.prototype,"layer",void 0);f.__decorate([w.property({readOnly:!0})],z.prototype,"tileInfo",void 0);return z=f.__decorate([k.subclass("esri.views.3d.layers.TiledLayerView3D")],z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:
1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let u=function(){function f(p=0,t=0){this.min=p;this.max=t;this.level=0;this.hasNoDataValues=!1}f.prototype.copyFrom=function(p){this.min=p.min;this.max=p.max;this.level=p.level;this.hasNoDataValues=p.hasNoDataValues};return f}();a.ElevationBounds=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports",
"../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(a,u,f,p){let t=function(){function w(n,b,h){this.samplerData=null;this.level=n[0];this.i=n[1];this.j=n[2];this.extent=b;n=h.noDataValue;const k=h.values;let l=Infinity,m=-Infinity,z=!0,r=!1;for(let c=0;c<k.length;c++){const d=k[c];d!==n?(l=d<l?d:l,m=d>m?d:m,z=!1):r=!0}z&&(m=l=0);this.samplerData={pixelData:h.values,width:h.width,height:h.height,noDataValue:n,safeWidth:.99999999*(h.width-1),dx:(h.width-1)/(b[2]-b[0]),dy:(h.width-
1)/(b[3]-b[1]),x0:b[0],y1:b[3]};this.bounds=[l,-3E38<m?m:0];this.hasNoDataValues=r}var e=w.prototype;e.release=function(){this.bounds=this.samplerData=null};e.computeMinMaxValue=function(n,b,h,k){k.min=Infinity;k.max=-Infinity;k.hasNoDataValues=!1;n-=this.level;if(0>=n)return k;var l=2**n;if(Math.floor(b/l)!==this.i||Math.floor(h/l)!==this.j)return k;var m=Infinity,z=-Infinity,r=this.samplerData.width,c=this.samplerData.pixelData,d=.5*p.ELEVATION_NODATA_VALUE;n=(r-1)/l;h=(h-this.j*l)*n;let g=(b-this.i*
l)*n;if(1>n){const y=Math.floor(h),x=Math.floor(g);var A=y+x*r;b=c[A];l=c[A+1];var q=c[A+r];A=c[A+r+1];if(b+l+q+A<d)return m=h-y,d=g-x,z=f.bilerp(b,l,q,A,m,d),r=f.bilerp(b,l,q,A,m+n,d),c=f.bilerp(b,l,q,A,m,d+n),n=f.bilerp(b,l,q,A,m+n,d+n),k.min=Math.min(z,r,c,n),k.max=Math.max(z,r,c,n),k;h=y;g=x;n=1}else h=Math.floor(h),g=Math.floor(g),n=Math.ceil(n);for(b=h;b<=h+n;b++)for(l=g;l<=g+n;l++)q=c[b+l*r],q<d?(m=Math.min(m,q),z=Math.max(z,q)):k.hasNoDataValues=!0;k.min=m;k.max=z;return k};w.sample=function(n,
b,h){for(const r of h){if(!r)continue;var k=r.safeWidth,l=r.width,m=r.pixelData;h=u.clamp(r.dy*(r.y1-b),0,k);k=u.clamp(r.dx*(n-r.x0),0,k);const c=Math.floor(h),d=Math.floor(k);var z=c*l+d;const g=z+l,A=m[z];l=m[g];z=m[z+1];m=m[g+1];if(A+l+z+m<.5*p.ELEVATION_NODATA_VALUE)return h-=c,k-=d,n=A+(z-A)*k,n+(l+(m-l)*k-n)*h}return null};return w}();a.ElevationData=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugUtils ../support/mathUtils ./Overlay ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S){function V(U,Z){const T=I.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(U[2]-U[0],U[3]-U[1],Z[2]-Z[0],Z[3]-Z[1]);for(let P=0;4>P;P++)if(Math.abs(Z[P]-U[P])>T)return!0;return!1}const Y=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let W;a.OverlayManager=function(U){function Z(P){P=U.call(this,P)||this;P._handles=new t;P._spatialReference=
null;P._renderSR=null;P._overlaySREqualsRenderSR=!0;P._drapeSources=new Map;P._drapeTargets=new Set;P._renderedAltitude=0;P._displayOpacity=0;P._displayOpacityTime=-1;P._placementDirty=!1;P._drawTexturesDirty=!1;P._drawTexturesAnimateDirty=!1;P._layerViewsDirty=!0;P._hasUnusedRenderTargets=!1;P._longitudeCyclical=null;P._latestOriginId=0;P._maxResolution=w("esri-mobile")?2048:4096;P._animationTimeLast=0;return P}u._inheritsLoose(Z,U);var T=Z.prototype;T.initialize=function(){const P=this.view,X=P.state.isGlobal&&
n.isSome(this._spatialReference)?k.getMetersPerUnitForSR(this._spatialReference):1;this.renderer=new J.OverlayRenderer({view:P,globalUnitScale:X,spatialReference:this._spatialReference});this.renderer.onHasHighlightsChanged=()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")};this.renderer.onRendersOccludedChanged=()=>{this._setDrawTexturesDirty();this.notifyChange("rendersOccluded")};this.renderer.onContentChanged=()=>this._setDrawTexturesDirty();this.renderer.onHasWaterChanged=
aa=>{var ja;return null==(ja=P._stage)?void 0:ja.renderView.setRenderParameters({hasOverlayWater:aa})};this.groundIntersector=new M.Intersector(this.view.state.viewingMode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([P.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setOverlayPlacementDirty()),this.surface.on("elevation-change",
()=>this.setOverlayPlacementDirty()),P.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),P.on("resize",()=>this.setOverlayPlacementDirty()),b.addFrameTask({preRender:aa=>{this.renderer.processSyncLayers();this._updateLayerViews();this.renderer.hasOverlays&&(this._dispatchRendererUpdate(aa),this._drawOverlayTextures(this.renderer.overlays));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),P.resourceController.scheduler.registerTask(S.TaskPriority.OVERLAY_MANAGER,
this),P._stage.renderView.events.on("force-camera-for-screenshot",aa=>{this._updateOverlays(aa);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)})]);this._updateLayerViews()};T.destroy=function(){this._drapeSources.forEach((P,X)=>this.unregisterDrapeSource(X));this._drapeTargets.forEach(P=>this._unregisterDrapeTarget(P));this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);n.isSome(W)&&(W.remove(),W=null)};T.setSpatialReference=function(P){this._spatialReference=
P;this.renderer.spatialReference=P;this._longitudeCyclical=null;const X=this.view.renderSpatialReference;n.isSome(P)&&n.isSome(X)?(this._renderSR=X,this._overlaySREqualsRenderSR=P.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=P.isWebMercator?new K.Cyclical(-2.0037508342787E7,2.0037508342787E7):new K.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.globalUnitScale=this._isSpherical&&n.isSome(this._spatialReference)?k.getMetersPerUnitForSR(this._spatialReference):
1)):this.renderer.disposeOverlays()};T.getGpuMemoryUsage=function(){return this.renderer.gpuMemoryUsage};T._updateLayerViews=function(){if(this._layerViewsDirty){var P=new Set;for(const X of this.view.allLayerViews.items)P.add(X.uid),"drapeSourceType"in X&&!this._drapeSources.has(X)&&this._registerDrapeSource(X,0),"drapeTargetType"in X&&!this._drapeTargets.has(X)&&this._registerDrapeTarget(X);this._drapeSources.forEach((X,aa)=>{0!==X||P.has(aa.uid)||this.unregisterDrapeSource(aa)});this._drapeTargets.forEach(X=>
{P.has(X.uid)||this._unregisterDrapeTarget(X)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};T.registerDrapeSource=function(P){this._registerDrapeSource(P,1)};T._registerDrapeSource=function(P,X){this._drapeSources.set(P,X);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);this.renderer.overlays.forEach(aa=>{this._updateDrapeSource(P,aa)});this._setOverlayContentDirty();this.notifyChange("running")};T._updateDrapeSource=function(P,X){n.isSome(P.setDrapingExtent)&&
n.isSome(this._spatialReference)&&P.setDrapingExtent(X,this._spatialReference)};T.unregisterDrapeSource=function(P){this._drapeSources.has(P)&&(this._drapeSources.delete(P),this.renderer.ensureDrapeSources(this._drapeSources),this._setOverlayContentDirty(),this.notifyChange("running"))};T._registerDrapeTarget=function(P){this._drapeTargets.add(P);this._updateDrapeTarget(P);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};T._updateDrapeTarget=function(P){this.renderer.overlays.forEach(X=>
P.setDrapingTextures(X))};T._unregisterDrapeTarget=function(P){this._drapeTargets.delete(P);this.renderer.ensureDrapeTargets(this._drapeTargets)};T._setOverlayContentDirty=function(){this.setOverlayPlacementDirty();this._setDrawTexturesDirty()};T.setOverlayPlacementDirty=function(){this._placementDirty=!0};T.runTask=function(){this._updateOverlays(this.view.state.camera)};T._updateOverlays=function(P){if(this._spatialReference){this._updateLayerViews();var X=H.computeOverlayResolution(P.fullWidth,
P.fullHeight,this._maxResolution);this._computeOverlayExtents(P,X,da);var aa=C.width(da.inner)/C.width(da.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);P=this._updateOverlay(0,da.inner,X,1);X=this._updateOverlay(1,da.outer,X,aa);if(P||X)this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty();this._placementDirty=!1;this.surface.updateOverlayOpacity()}};T._updateOverlay=function(P,X,aa,ja){if(0===this.renderer.overlays.length)return!1;const ia=this.renderer.overlays[P];
if(!V(X,ia.extent)&&aa===ia.resolution&&ia.pixelRatio===ja)return!1;C.set(ia.extent,X);ia.resolution=aa;ia.pixelRatio=ja;P=C.center(ia.extent);ia.renderLocalOrigin=O.fromValues(P[0],P[1],0,`OV_${this._latestOriginId++}`);this._drapeSources.forEach((ka,na)=>this._updateDrapeSource(na,ia));return!0};T.computeOpacity=function(P){if(!this.renderer.hasOverlays)return this._displayOpacity=0,this._displayOpacityTime=-1,1;if(3.5*P<this._renderedAltitude)this._displayOpacity=Math.sqrt(e.clamp((P-this._renderedAltitude/
10)/(this._renderedAltitude/3.5-this._renderedAltitude/10),0,1)),this._displayOpacityTime=performance.now();else if(1!==this._displayOpacity){P=performance.now();this._displayOpacityTime=0<this._displayOpacityTime?this._displayOpacityTime:P;P-=this._displayOpacityTime;const X=this.surface.textureFadeDuration;if(P<X)return this._displayOpacity+P/X*(1-this._displayOpacity);this._displayOpacity=1;this._displayOpacityTime=-1}return this._displayOpacity};T.setTileParameters=function(P){const X=P.renderData.overlay;
if(0<this.renderer.overlays.length){const aa=this.renderer.overlays[0],ja=this.renderer.overlays[1];P=C.intersection(P.extent,P.surface.extent,ha);this._rectInsideRect(P,aa.extent)||this._rectanglesOverlap(P,aa.extent)||this._rectanglesOverlap(P,ja.extent)?(this._setTileOverlayData(P,0,X),this._setTileOverlayData(P,1,X)):(this._clearTileOverlayData(0,X),this._clearTileOverlayData(1,X))}else this._clearTileOverlayData(0,X),this._clearTileOverlayData(1,X)};T.overlayPixelSizeInMapUnits=function(P){if(0===
this.renderer.overlays.length)return 0;const X=this.renderer.overlays[0],aa=this.renderer.overlays[1];P=this._pointIsInExtent(P,X.extent)?X:aa;return(P.extent[2]-P.extent[0])/P.resolution};T._setTileOverlayData=function(P,X,aa){if(0!==this.renderer.overlays.length){var ja=this.renderer.overlays[X].extent;aa.setScale(X,(P[2]-P[0])/(ja[2]-ja[0]),(P[3]-P[1])/(ja[3]-ja[1]));var ia=P[0];if(this._longitudeCyclical){ia=this._longitudeCyclical.minimalMonotonic(ja[0],ia);const ka=this._longitudeCyclical.minimalMonotonic(ja[0],
P[2]);ia>ka&&(ia=ka-(P[2]-P[0]))}aa.setOffset(X,(ia-ja[0])/(ja[2]-ja[0]),(P[1]-ja[1])/(ja[3]-ja[1]))}};T._clearTileOverlayData=function(P,X){X.setScale(P,-1,-1);X.setOffset(P,-1,-1)};T.reloadShaders=function(){var P=u._asyncToGenerator(function*(){Q.removeLoadedShaderModules();yield this.renderer.reloadShaders();this.runTask()});return function(){return P.apply(this,arguments)}}();T.stopAnimationsAtTime=function(P){this.renderer.stopAnimationsAtTime(P);this._drawTexturesAnimateDirty=!0};T._dispatchRendererUpdate=
function(P){const X=h.Milliseconds(P.time-this._animationTimeLast);X<N.DESIRED_DRAPED_ANIMATION_MS||(this._animationTimeLast=P.time,this.renderer.updateLogic({dt:X,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0))};T._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};T._intersectGroundFromView=function(P,X,aa,ja){aa=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(P,R,X,aa);if(n.isNone(aa))return!1;
X=aa.origin;aa=g.add(ca,aa.origin,aa.direction);this.groundIntersector.reset(X,aa);this.groundIntersector.intersect([],null,P);this.view.basemapTerrain.intersect(this.groundIntersector,null,X,aa);return this.groundIntersector.results.min.getIntersectionPoint(ja)};T._findHorizonBasedPointOfInterest=function(P,X){var aa=.5;aa=this.view.renderCoordsHelper.getAltitude(P.eye);const ja=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ia=e.clamp(ja.estimatedSurfaceAltitude,P.aboveGround?-Infinity:
aa+1E-5,P.aboveGround?aa-1E-5:Infinity);aa=P.aboveGround;if("global"===this.view.viewingMode){var ka=ca;v.closestPointOnSilhouette(v.fromRadius(D.getReferenceEllipsoid(this.view.spatialReference).radius+ia),B.wrap(P.eye,P.viewForward),ka);g.subtract(ka,ka,P.eye);ia=K.cyclicalPI.normalize(E.angleAroundAxis(P.viewForward,ka,P.viewRight))/P.fovY+.5;ka=0>=ia||1<=ia?.5:.55;aa=aa?ka*ia:ia+ka*(1-ia)}else ia=y.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-P.viewForward[2])),1,0),ia=q.transformMat4(ia,ia,P.projectionMatrix)[1],
ia=e.clamp(.5+.5*ia,0,1),aa=1===ia||0===ia?.5:aa?.55*ia:1-.55*(1-ia);return this._intersectGroundFromView(P,.5,aa,X)?g.sqrDist(X,P.eye)<ja.distance*ja.distance:!1};T._computeOverlayExtents=function(P,X,aa){var ja=this.surface.extent,ia=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ka=A.create();this._findHorizonBasedPointOfInterest(P,ka)||g.copy(ka,ia);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(P.eye);var na=g.distance(P.eye,ka);ia=L.viewAngle(this.view.renderCoordsHelper,
ia,P.eye);ia=Math.PI/2-Math.abs(ia-Math.PI/2);I.OVERLAY_SHOW_CENTER?(n.isNone(W)&&(W=new G.GraphicsHandle(this.view.graphics,"red")),W.showPoint(ka,this._renderSR)):n.isSome(W)&&W.remove();this._overlaySREqualsRenderSR||x.projectVectorToVector(ka,this._renderSR,ka,this._spatialReference);na=X*P.perRenderPixelRatio*na/2;var ta=!1;let pa=Infinity;this._isSpherical&&n.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(na/=Math.cos(F.y2lat(ka[1])),pa=this.surface.extent[3]):(ta=!0,
na/=D.getReferenceEllipsoid(this._spatialReference).metersPerDegree,pa=90),na>=pa&&(na=pa,ka[1]=0,this._spatialReference.isWebMercator&&(ka[0]=0)));let xa=1;ta&&(xa=1/Math.max(.2,Math.cos(Math.abs(e.deg2rad(ka[1])))),180<na*xa&&(xa=180/na));ta=Math.log(2)/12;na=Math.exp(Math.round(Math.log(na)/ta)*ta);ta=na*xa;const Da=.5*X/(32*ta);X=.5*X/(32*na);ka[0]=Math.round(ka[0]*Da)/Da;ka[1]=Math.round(ka[1]*X)/X;X=aa.inner;X[0]=ka[0]-ta;X[1]=ka[1]-na;X[2]=ka[0]+ta;X[3]=ka[1]+na;this._isSpherical&&this._shiftExtentToFitBounds(X,
Infinity,pa);aa=aa.outer;C.set(aa,X);6*ta>ja[2]-ja[0]?C.set(aa,ja):ia<=.25*Math.PI?(aa[0]-=ta,aa[1]-=na,aa[2]+=ta,aa[3]+=na):(x.projectVectorToVector(P.eye,this._renderSR,ca,this._spatialReference),d.subtract(ba,ka,ca),P=-Math.atan2(ba[1],ba[0])+.125*Math.PI,0>P&&(P+=2*Math.PI),q.scale(ba,Y[Math.floor(P/(.25*Math.PI))],2*na),ba[0]*=xa,ba[2]*=xa,q.add(aa,aa,ba));this._isSpherical&&(aa[0]=this._longitudeCyclical.clamp(aa[0]),aa[2]=this._longitudeCyclical.clamp(aa[2]),aa[1]=Math.max(aa[1],-pa),aa[3]=
Math.min(aa[3],pa));!this._isSpherical&&ja&&(P=C.intersection(X,ja,ha),ja=C.intersection(aa,ja,fa),C.contains(P,ja)&&(aa[2]=aa[0],aa[3]=aa[1]))};T._drawOverlayTextures=function(P){if(0!==P.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var X=this._drawOverlay(P[0]);P=this._drawOverlay(P[1]);0!==X&&0!==P||this.surface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(aa=>this._updateDrapeTarget(aa));this._drawTexturesAnimateDirty=!1;this._drawTexturesDirty?
(this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.requestUpdate()):this.surface.requestRender(0)}};T._drawOverlay=function(P){this._longitudeCyclical?P.setupGeometryViewsCyclical(this._longitudeCyclical):P.setupGeometryViewsDirect();return P.draw(this.renderer,this.view.state.camera.pixelRatio)};T._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const P=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(P)}};
T._rectanglesOverlap=function(P,X){return this._longitudeCyclical?(this._longitudeCyclical.contains(X[0],X[2],P[0])||this._longitudeCyclical.contains(X[0],X[2],P[2])||this._longitudeCyclical.contains(P[0],P[2],X[0]))&&!(P[1]>X[3]||P[3]<X[1]):C.intersects(P,X)};T._rectInsideRect=function(P,X){return this._longitudeCyclical?this._longitudeCyclical.contains(X[0],X[2],P[0])&&this._longitudeCyclical.contains(X[0],X[2],P[2])&&P[1]>X[1]&&P[3]<X[3]:C.contains(X,P)};T._pointIsInExtent=function(P,X){if(this._longitudeCyclical)return this._longitudeCyclical.contains(X[0],
X[2],P.x)&&P.y>=X[1]&&P.y<=X[3];const aa=P.x;P=P.y;return aa>X[0]&&aa<X[2]&&P>X[1]&&P<X[3]};T._shiftExtentToFitBounds=function(P,X,aa){let ja=0,ia=0;P[0]<-X?ja=P[0]+X:P[2]>X&&(ja=X-P[2]);P[1]<-aa?ia=P[1]+aa:P[3]>aa&&(ia=aa-P[3]);C.offset(P,ja,ia)};u._createClass(Z,[{key:"running",get:function(){return(this._placementDirty||this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||I.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},
{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||this.renderer.updating}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);
return Z}(p);f.__decorate([l.property()],a.OverlayManager.prototype,"_spatialReference",void 0);f.__decorate([l.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);f.__decorate([l.property()],a.OverlayManager.prototype,"_placementDirty",void 0);f.__decorate([l.property()],a.OverlayManager.prototype,"_layerViewsDirty",void 0);f.__decorate([l.property()],a.OverlayManager.prototype,"renderer",void 0);f.__decorate([l.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);
f.__decorate([l.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);f.__decorate([l.property({readOnly:!0})],a.OverlayManager.prototype,"updating",null);f.__decorate([l.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);f.__decorate([l.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=f.__decorate([c.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const ba=y.create(),
ca=A.create(),da={inner:C.create(),outer:C.create()},ha=C.create(),fa=C.create(),R=B.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,u){const f=u.Milliseconds(40);u=u.Milliseconds(50);a.DESIRED_ANIMATION_FPS=25;a.DESIRED_ANIMATION_MS=f;a.DESIRED_DRAPED_ANIMATION_FPS=20;a.DESIRED_DRAPED_ANIMATION_MS=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports",
"../../../../core/global"],function(a,u){a.removeLoadedShaderModules=function(){var f;const p=null==(f=u.require)?void 0:f.modules;if(p){f=Object.keys(p);for(const t of f)-1!==t.search(".glsl")&&delete p[t]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/frustum ./PatchGeometryFactory ./Tile".split(" "),
function(a,u,f,p,t,w,e){e=function(n){function b(k,l,m){var z=n.call(this,b.NumSubdivisionsAtLevel)||this;void 0!==k&&z.init(k,l,m);return z}u._inheritsLoose(b,n);var h=b.prototype;h.init=function(k,l,m){n.prototype.init.call(this,k,l,m);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=f.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=f.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
h.updateRadiusAndCenter=function(){this._updateCenter();const k=(this.extent[2]-this.extent[0])*Math.SQRT1_2,l=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._center[1][3]=Math.sqrt(k*k+l*l)};h._isVisible=function(k){return this.intersectsClippingArea&&t.intersectsAABB(k,p.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};h.createGeometry=function(k,l){w.createPlanarGlobePatch(k,this.extent,l,this.renderData);this.setMemoryDirty()};
return b}(e["default"]);e.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];a.PlanarPatch=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(F,L,N,I){const G=0<(N&2),K=L+(I?1024:0)+(G?2048:0);var H=y.get(K);if(!H){{H=L-1;const Q=L-1,S=L*L;var J=2*H+2*Q;let V=H*Q*6,Y=6*J,W=6*(2*H+Q-1);I&&(V*=2,Y*=2,W*=2);J=65536<S+J?new Uint32Array(V+Y):new Uint16Array(V+Y);let ba=0,ca=0,da=V,ha,fa;let R=0;for(let U=0;U<=Q;U++){G&&(R=0===U?W:U===Q?-W:0);da+=R;for(let Z=0;Z<=H;Z++){var M=d(Z,U,H,Q);if(-1<M){var O=0===U&&Z!==H?1:Z===H&&U!==Q?H+1:U===Q&&0!==Z?-1:0===Z&&0!==U?-(H+1):0;0!==O&&(ha=ba,fa=S+M,M=S+
(0===Z&&1===U?0:M+1),O=ba+O,I?(J[da+0]=ha,J[da+1]=fa,J[da+2]=fa,J[da+3]=M,J[da+4]=M,J[da+5]=ha,J[da+6]=M,J[da+7]=O,J[da+8]=O,J[da+9]=ha,J[da+10]=ha,J[da+11]=M,da+=12):(J[da+0]=ha,J[da+1]=fa,J[da+2]=M,J[da+3]=M,J[da+4]=O,J[da+5]=ha,da+=6))}++ba;Z<H&&U<Q&&(ha=U*(H+1)+Z,fa=ha+1,M=fa+(H+1),O=M-1,I?(J[ca+0]=ha,J[ca+1]=fa,J[ca+2]=fa,J[ca+3]=M,J[ca+4]=M,J[ca+5]=ha,J[ca+6]=M,J[ca+7]=O,J[ca+8]=O,J[ca+9]=ha,J[ca+10]=ha,J[ca+11]=M,ca+=12):(J[ca+0]=ha,J[ca+1]=fa,J[ca+2]=M,J[ca+3]=M,J[ca+4]=O,J[ca+5]=ha,ca+=6))}da-=
R}H=new q(J,V,Y)}y.set(K,H)}F.indices=H.values;F.numSurfaceIndices=H.numSurfaceIndices;F.numSkirtIndices=H.numSkirtIndices;F.numWithoutSkirtIndices=F.numSurfaceIndices+(N?6*(L-1)*(I?2:1):0)}function r(F,L,N,I){F<I[0]&&(I[0]=F);F>I[3]&&(I[3]=F);L<I[1]&&(I[1]=L);L>I[4]&&(I[4]=L);N<I[2]&&(I[2]=N);N>I[5]&&(I[5]=N)}function c(F,L){const N=L>F?1:0;return 2+4*N+(1-2*N)*(F+L)}function d(F,L,N,I){return 0===L?F:F===N?N+L:L===I?N+I+(N-F):0===F&&0<L?2*N+I+(I-L):-1}const g=h.newLayout().vec3f("position").vec2f("uv0"),
A=new b.BufferPool(F=>g.createBuffer(F),F=>F.count);let q=function(F,L,N){this.values=F;this.numSurfaceIndices=L;this.numSkirtIndices=N};const y=new Map,x=Array(l.MAX_PATCH_TESSELATION+1),D=Array(l.MAX_PATCH_TESSELATION+1),C=Array(l.MAX_PATCH_TESSELATION+1),B=Array(l.MAX_PATCH_TESSELATION+1),v=t.create(),E=t.create();a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=n.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=
0;this.uvOffsetAndScale=e.create()};a.clearCaches=function(){A.clear();y.clear()};a.createPlanarGlobePatch=function(F,L,N,I){const G=L[0],K=L[1],H=L[2]-G,J=L[3]-K,M=F.clippingArea,O=f.isSome(M)?Math.max(0,(M[0]-L[0])/H):0,Q=f.isSome(M)?Math.max(0,(M[1]-L[1])/J):0,S=f.isSome(M)?Math.min(1,(M[2]-L[0])/H):1;L=f.isSome(M)?Math.min(1,(M[3]-L[1])/J):1;const V=S>O?1/(S-O):1,Y=L>Q?1/(L-Q):1,W=-O*V,ba=-Q*Y,ca=.1*H,da=F.numVertsPerRow-1,ha=F.numVertsPerRow-1,fa=F.numVertsPerRow*F.numVertsPerRow,R=A.acquire(fa+
(2*da+2*ha)),U=R.position.typedBuffer,Z=R.uv0.typedBuffer,T=I.geometryInfo.boundingBox;n.empty(T);let P=0;for(let ka=0;ka<=ha;ka++){var X=ka/ha;let na=ba+X*Y;X=K+X*J;f.isSome(M)&&(X<M[1]?(X=M[1],na=0):X>M[3]&&(X=M[3],na=1));for(let ta=0;ta<=da;ta++){var aa=ta/da;let pa=W+aa*V;aa=G+aa*H;f.isSome(M)&&(aa<M[0]?(aa=M[0],pa=0):aa>M[2]&&(aa=M[2],pa=1));var ja=F.samplerData?k.ElevationData.sample(aa,X,F.samplerData)||0:0;aa-=N[0];const xa=X-N[1];ja-=N[2];r(aa,xa,ja,T);var ia=l.GEOMETRY_VERTEX_STRIDE*P;U[ia+
0]=aa;U[ia+1]=xa;U[ia+2]=ja;Z[ia+0]=pa;Z[ia+1]=na;ia=d(ta,ka,da,da);-1<ia&&(ia=l.GEOMETRY_VERTEX_STRIDE*(fa+ia),U[ia+0]=aa,U[ia+1]=xa,U[ia+2]=ja,Z[ia+0]=c(pa,na),Z[ia+1]=ca);++P}}I.geometryInfo.numVertsPerRow=F.numVertsPerRow;I.geometryInfo.vertexAttributes=R;I.geometryInfo.skirtLength=ca;w.set(I.geometryInfo.uvOffsetAndScale,O,Q,S-O,L-Q);z(I.geometryInfo,F.numVertsPerRow,0,F.wireframe)};a.createSphericalGlobePatch=function(F,L,N,I,G,K,H,J){var M=G[0];const O=G[1];var Q=G[2];G=G[3];const S=.1*H.radius*
(G-O),V=F.numVertsPerRow-1,Y=F.numVertsPerRow-1,W=F.numVertsPerRow*F.numVertsPerRow,ba=A.acquire(W+(2*V+2*Y)),ca=ba.position.typedBuffer,da=ba.uv0.typedBuffer,ha=I.geometryInfo.boundingBox;n.empty(ha);var fa=L[2]-L[0];const R=L[3]-L[1];var U=Q-M;Q=N[0];const Z=N[1];N=N[2];for(var T=0;T<=V;T++){var P=T/V,X=M+P*U;x[T]=Math.sin(X);D[T]=Math.cos(X);C[T]=P;B[T]=L[0]+P*fa}M=K&&!!(J&1);fa=K&&!!(J&2);U=0;for(T=0;T<=Y;T++){P=T/Y;var aa=u.lerp(O,G,P);X=Math.cos(aa);const ta=Math.sin(aa);K?(aa=H.halfSemiMajorAxis*
Math.log((1+ta)/(1-ta)),P=(aa-L[1])/R):aa=180*aa/Math.PI;for(let pa=0;pa<=V;pa++){const xa=C[pa];var ja=x[pa],ia=D[pa],ka=H.radius;F.samplerData&&(ka+=k.ElevationData.sample(B[pa],aa,F.samplerData)||0);ia=ia*X*ka-Q;ja=ja*X*ka-Z;ka=ta*ka-N;r(ia,ja,ka,ha);var na=l.GEOMETRY_VERTEX_STRIDE*U;ca[na+0]=ia;ca[na+1]=ja;ca[na+2]=ka;da[na+0]=xa;da[na+1]=P;na=d(pa,T,V,Y);if(-1<na){na=l.GEOMETRY_VERTEX_STRIDE*(W+na);const Da=M&&0===T?-1:fa&&T===Y?1:0;ia=0===Da?ia:-Q;ja=0===Da?ja:-Z;ka=0===Da?ka:H.radius*Da-N;
ca[na+0]=ia;ca[na+1]=ja;ca[na+2]=ka;da[na+0]=0===Da?c(xa,P):xa;da[na+1]=0===Da?S:P;0!==Da&&r(ia,ja,ka,ha)}++U}}I.geometryInfo.numVertsPerRow=F.numVertsPerRow;I.geometryInfo.vertexAttributes=ba;I.geometryInfo.skirtLength=S;w.set(I.geometryInfo.uvOffsetAndScale,0,0,1,1);z(I.geometryInfo,F.numVertsPerRow,K?J:0,F.wireframe)};a.intersectSkirts=function(F,L,N,I,G,K,H,J,M){const O=K.position;K=K.uv0;const Q=F[0],S=F[1];F=F[2];const V=L[0]-Q,Y=L[1]-S;L=L[2]-F;N*=3;for(I*=3;N<I;N+=3){var W=G[N],ba=G[N+1],
ca=G[N+2],da=O.get(W,0),ha=O.get(W,1),fa=O.get(W,2),R=O.get(ba,0),U=O.get(ba,1),Z=O.get(ba,2),T=O.get(ca,0),P=O.get(ca,1),X=O.get(ca,2);2<=K.get(W,0)&&(p.set(v,da,ha,fa),H(v),da+=v[0],ha+=v[1],fa+=v[2]);2<=K.get(ba,0)&&(p.set(v,R,U,Z),H(v),R+=v[0],U+=v[1],Z+=v[2]);2<=K.get(ca,0)&&(p.set(v,T,P,X),H(v),T+=v[0],P+=v[1],X+=v[2]);f.isSome(J)&&([da,ha,fa]=J.applyToVertex(da,ha,fa),[R,U,Z]=J.applyToVertex(R,U,Z),[T,P,X]=J.applyToVertex(T,P,X));W=R-da;U-=ha;Z-=fa;T-=da;P-=ha;X-=fa;ca=Y*X-P*L;R=L*T-X*V;const aa=
V*P-T*Y;ba=W*ca+U*R+Z*aa;if(!(Math.abs(ba)<=Number.EPSILON)){da=Q-da;ha=S-ha;fa=F-fa;ca=da*ca+ha*R+fa*aa;if(0<ba){if(0>ca||ca>ba)continue}else if(0<ca||ca<ba)continue;R=ha*Z-U*fa;fa=fa*W-Z*da;ha=da*U-W*ha;da=V*R+Y*fa+L*ha;if(0<ba){if(0>da||ca+da>ba)continue}else if(0<da||ca+da<ba)continue;fa=(T*R+P*fa+X*ha)/ba;0<=fa&&(W=m.computeNormal(W,U,Z,T,P,X,E),M(fa,W))}}};a.releaseGeometry=function(F){A.release(F.vertexAttributes);F.vertexAttributes=null;F.indices=null};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,u,f){let p=function(){function t(e,n){this._factoryCallback=e;this._lengthCallback=n;this._pool=new Map}var w=t.prototype;w.acquire=function(e){if(!t.test.disabled){var n=this._pool.get(e);if(n&&0!==n.length)return n.pop()}try{return this._factoryCallback(e)}catch(b){n=window.performance&&window.performance.memory;let h="";n&&(h=
`\n  totalJSHeapSize: ${n.totalJSHeapSize}, usedJSHeapSize: ${n.usedJSHeapSize}, jsHeapSizeLimit: ${n.jsHeapSizeLimit}`);console.log("Array allocation of size "+e+" failed: "+b+h);throw b;}};w.release=function(e){if(!t.test.disabled){var n=this._lengthCallback(e),b=this._pool.get(n);b||(b=new f({shrink:!0}),this._pool.set(n,b));b.push(e)}};w.clear=function(){this._pool.clear()};u._createClass(t,[{key:"test",get:function(){return{size:this._pool.size}}}]);return t}();p.test={disabled:!1};a.BufferPool=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/promiseUtils ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F){function L(O){O.dispose();O instanceof A?J.release(O):O instanceof q&&H.release(O)}const N=h.create(),I=h.create(),G=h.create(),K=l.create();l=function(){function O(S){this._numSubdivisionAtLevel=S;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=z.create();this._elevationBounds=n.create();this.layerInfo=[[],[]];this.extentInRadians=z.create();this.centerAtSeaLevel=h.create();
this._center=[h.create(),r.create(),h.create()];this.up=h.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}O.prune=function(){H.prune(0);J.prune(0);B.TilePerLayerInfo.prune()};var Q=O.prototype;Q.init=function(S,V,Y){this.lij[0]=S[0];this.lij[1]=S[1];this.lij[2]=S[2];this.ellipsoid=m.getReferenceEllipsoid(Y.tilingScheme.spatialReference);
Y.tilingScheme.getExtent(S[0],S[1],S[2],this.extent);Y.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;Y.upsampleMapCache.pop(E.tile2str(this));this._edgeLen2=this._edgeLen=0;this._center[1][3]=0;this.vlevel=S?S[0]:0;V&&V.elevationBounds?e.copy(this._elevationBounds,V.elevationBounds):e.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=
0;this._previouslyRendered=this._visible=!1;this._parent=V;this.unsetChildren();this._surface=Y;this.updateVisibility();for(const W of x.LayerClasses){S=Y.numLayers(W);V=this.layerInfo[W];for(const ba of V)ba.release();V.length=S;for(let ba=0;ba<S;ba++)V[ba]=B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),0===W&&this.findElevationBoundsForLayer(ba,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(Y.tilingScheme.pixelSize,x.MAX_PATCH_TESSELATION)};Q.release=function(){D.weakAssert(!this.renderData,
"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(E.tile2str(this));for(const S of x.LayerClasses){for(const V of this.layerInfo[S])V.release();this.layerInfo[S].length=0}this._surface=this._parent=null;this._usedMemory=-1};Q.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(E.tile2str(this))};Q.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const S=this.cachedMemory;0<S&&(this._surface.upsampleMapCache.put(E.tile2str(this),
this,S),this.setMemoryDirty())}};Q.setMemoryDirty=function(){this._usedMemory=-1};Q._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;const S=this.cpuImageMemorySize;for(const {data:V}of this.layerInfo[1])V instanceof v?this._mapTileMemory+=F.getGpuMemoryUsage(V.texture):V instanceof HTMLImageElement||V instanceof d.ImageWithType?this._mapTileMemory+=S:V instanceof y&&(this._mapTileMemory+=V.memoryUsage);for(const V of this.layerInfo[0])this._usedMemory+=V.data?S:0;this.renderData&&
(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=F.getGpuMemoryUsage(this.renderData.textureDescriptor));this.isCached&&this._surface.upsampleMapCache.updateSize(E.tile2str(this),this,this.cachedMemory)};Q.getUsedMemoryForLayer=function(S,V){V=this.layerInfo[S][V];if(!V||!V.data)return 0;if(1===S&&!this.isCached){S=V.data;if(S instanceof v)return F.getGpuMemoryUsage(S.texture);if(S instanceof HTMLImageElement||S instanceof d.ImageWithType)return this.cpuImageMemorySize;
if(S instanceof c.VectorTile||S instanceof y)return S.memoryUsage}else if(0===S)return this.cpuImageMemorySize;return 0};Q.updateScreenDepth=function(S){b.copy(K,this._center[1]);K[3]=1;k.transformMat4(K,K,S);this._screenDepth=0>K[2]?0:K[2]/K[3]};Q.shouldSplit=function(S,V,Y){if(p.isSome(S.frustum)&&!this._isVisible(S.frustum))return 0;const W=this.level;b.subtract(N,this._center[1],V);var ba=b.squaredLength(N);let ca=1;b.subtract(I,this._center[0],V);var da=b.squaredLength(I);da<ba&&(ba=da,ca=0);
b.subtract(I,this._center[2],V);da=b.squaredLength(I);da<ba&&(ba=da,ca=2);if(this._edgeLen2>ba&&W<S.maxLod)return 2;ba=Math.sqrt(ba);const ha=this._edgeLen/(S.fovX*ba*2);da=()=>{const U=W+Math.ceil(-f.log2(S.relativeWidthLimit/ha));return U!==this.vlevel?(this.vlevel=U,4):1};if(1===Y&&1===this._surface.snapLevel-W)return W>=S.maxLod?da():2;const fa=b.dot(this.up,N);Y=this._elevationBounds[1]-this._elevationBounds[0];const R=Y/this.edgeLen;return S.aboveGround&&0<fa&&.001>R&&0<fa/ba-Math.sin(this._curvatureHeight/
(this.edgeLen*Math.SQRT1_2)*Math.PI)-R?0:ha<S.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:W>=S.maxLod?da():6<W&&(b.subtract(I,this._center[ca],V),b.scale(G,this.up,fa),b.subtract(G,G,I),da=b.squaredLength(G),da>this.radius*this.radius&&(b.scale(G,G,this.radius/Math.sqrt(da)),b.add(G,G,this._center[ca]),b.subtract(G,V,G),Math.min(1,(Math.abs(b.dot(G,this.up))+.5*Y+this._curvatureHeight)/b.length(G))*(this._edgeLen/(S.fovY*ba*2))<.1/S.angledSplitBias*S.relativeHeightLimit))?
0:2};Q.setChildren=function(S,V,Y,W){D.weakAssert(!!(S&&V&&Y&&W),"Null child passed");this._children[0]=S;this._children[1]=V;this._children[2]=Y;this._children[3]=W};Q.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};Q.load=function(S){this.refMapData();for(const V of x.LayerClasses)this._createOrUpdateAgents(0,V);S.loadTile(this)};Q.unload=function(S){S.unloadTile(this);for(const V of x.LayerClasses){S=this.layerInfo[V];for(const Y of S)Y.loadingAgent&&
Y.loadingAgent!==C.TILE_AGENT_DONE&&(L(Y.loadingAgent),Y.loadingAgent=null),Y.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};Q.unloadMapData=function(){const S=this.layerInfo[1];for(const V of S)V.loadingAgent&&V.loadingAgent!==C.TILE_AGENT_DONE&&(L(V.loadingAgent),V.loadingAgent=null),V.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};Q.updateClippingStatus=function(S){if(z.equals(S,this._clippingArea))return!1;
var V=this._intersectsClippingArea;const Y=this._isWithinClippingArea;p.isSome(S)?(this._intersectsClippingArea=this.intersectsExtent(S),this._isWithinClippingArea=this._isWithinExtent(S)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=S;this.updateVisibility();S=Y&&this._isWithinClippingArea;V=!Y&&!V&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||S||V||this.setPendingUpdate(32);return!0};Q.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};
Q.getLayerInfo=function(S,V){return this.layerInfo[V][S]};Q.hasLayerData=function(S,V){S=this.layerInfo[V][S];return!(!S||!S.data||S.dataInvalidated)};Q.isSuspended=function(S){return this.hasPendingUpdate(2)?!0:0===S?!1:!this.loadable};Q.hasPendingUpdate=function(S){return(this._pendingUpdates&S)===S};Q.setPendingUpdate=function(S){this._pendingUpdates|=S;2===S||8===S?this._surface.setTileTreeDirty():this._surface.requestUpdate()};Q.resetPendingUpdate=function(S){return this.hasPendingUpdate(S)?
(this._pendingUpdates&=~S,!0):!1};Q.requestLayerData=function(S,V,Y){const W=this.layerInfo[V][S];if(W.waitingAgents.has(Y))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),Y.tile.lij.toString(),V,S),!0;W.waitingAgents.push(Y);if(W.data&&!W.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),Y.tile.lij.toString(),V,S),Y.dataArrived(this),!0;if(W.requestPromise)return!0;
p.abortMaybe(W.requestAbort);W.requestAbort=w.createAbortController();const ba=this._surface.requestTileData(this,S,V,W.requestAbort);if(!ba)return W.requestAbort=null,!1;S=()=>{W.requestPromise===ba&&(W.requestPromise=null,W.requestAbort=null)};W.requestPromise=ba;ba.then(S,S);return!0};Q.hasLij=function(S){return this.lij[0]===S[0]&&this.lij[1]===S[1]&&this.lij[2]===S[2]};Q.findByLij=function(S){return this.hasLij(S)?this:this.isLeaf?null:(S=this._children[0].findByLij(S)||this._children[1].findByLij(S)||
this._children[2].findByLij(S)||this._children[3].findByLij(S))?S:null};Q.distanceToSquared=function(S){return b.squaredLength(b.subtract(G,this._center[1],S))};Q.containsPoint=function(S){const V=this.extent;return S[0]>=V[0]&&S[1]>=V[1]&&S[0]<=V[2]&&S[1]<=V[3]};Q.unrequestLayerData=function(S,V,Y){S=this.layerInfo[V][S];V=S.waitingAgents;Y=null!=V.removeUnordered(Y);D.weakAssert(Y,"agent has not requested this piece of map data");1>V.length&&(S.abortRequest(),this._updateMemoryUsed())};Q.dataArrived=
function(S,V,Y){S=this.layerInfo[V][S];S.data=Y;S.dataInvalidated=!1;S.waitingAgents.forAll(W=>W.dataArrived(this));S.waitingAgents.clear();this._updateMemoryUsed()};Q.dataMissing=function(S,V,Y){Y.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${V}/${S} error ${Y}`);S=this.layerInfo[V][S];S.dataMissing=!0;S.waitingAgents.forAll(W=>W.dataMissing());S.waitingAgents.clear();this._updateMemoryUsed()};Q.updateRenderData=function(S){switch(S){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};
Q.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};Q.updateGeometry=function(){this.setPendingUpdate(32);for(const S of this.layerInfo[0])S.pendingUpdates|=32};Q.invalidateLayerData=function(S,V){this.layerInfo[V][S].invalidateSourceData();this.restartAgents(V)};Q.computeElevationBounds=function(){e.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const S=this.layerInfo[0];let V=!0;for(const Y of S)p.isSome(Y.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],
Y.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],Y.elevationBounds.max),Y.elevationBounds.hasNoDataValues||(V=!1));V&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};Q._updateCenter=function(){b.scale(G,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));b.add(this._center[1],this.centerAtSeaLevel,G);b.scale(G,this.up,
this._elevationBounds[0]);b.add(this._center[0],this.centerAtSeaLevel,G);b.scale(G,this.up,this._elevationBounds[1]);b.add(this._center[2],this.centerAtSeaLevel,G)};Q.findElevationBoundsForLayer=function(S,V){const Y=this.layerInfo[0][S];if(!(p.isSome(Y.elevationBounds)&&Y.elevationBounds.level>=V)&&(V=this._surface.layerViewByIndex(S,0),V=D.getLayerWithExtentRange(V),E.fallsWithinLayer(this,V,!1))){V=M;var W=!1;if(Y.data)S=Y.data,V.min=S.bounds[0],V.max=S.bounds[1],V.hasNoDataValues=S.hasNoDataValues,
V.level=this.lij[0],W=!0;else{let ba=0,ca,da;for(let ha=this._parent;ha&&(!da||ba<x.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(ba=this.vlevel-ha.level,ca=da||ca,da=ha.layerInfo[0][S].data,!da&&ca&&ba>=x.ELEVATION_DESIRED_RESOLUTION_LEVEL);ha=ha.parent);if(da=da||ca)da.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],V),Infinity!==V.min&&(V.level=da.level,W=!0)}W&&(p.isNone(Y.elevationBounds)&&(Y.elevationBounds=new g.ElevationBounds),Y.elevationBounds.copyFrom(V))}};Q.modifyLayers=function(S,V,
Y){Y=this.layerInfo[Y];for(var W of Y)W.loadingAgent&&W.loadingAgent!==C.TILE_AGENT_DONE&&(L(W.loadingAgent),W.loadingAgent=null),W.waitingAgents.clear();for(W=0;W<Y.length;++W)void 0===S[W]&&Y[W].release();S=Array(...Y);W=V.length;Y.length=W;for(let ba=0;ba<W;ba++){const ca=V[ba];Y[ba]=-1<ca?S[ca]:B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()};Q.restartAgents=function(S){this.renderData&&(this._createOrUpdateAgents(0,S),this.updateRenderData(S))};Q.updateAgents=
function(S){if(this.renderData){const V=this.layerInfo[S];for(const Y of V)Y.loadingAgent===C.TILE_AGENT_DONE&&(Y.loadingAgent=null);this._createOrUpdateAgents(0,S)}};Q.updateAgentSuspension=function(){for(const S of x.LayerClasses){const V=this.isSuspended(S);for(const Y of this.layerInfo[S])Y.loadingAgent&&Y.loadingAgent!==C.TILE_AGENT_DONE&&(Y.loadingAgent.setSuspension(V),Y.loadingAgent===C.TILE_AGENT_DONE&&this.updateRenderData(S))}};Q.removeLayerAgent=function(S,V){S=this.layerInfo[V][S];S.loadingAgent&&
S.loadingAgent!==C.TILE_AGENT_DONE&&S.loadingAgent.dispose();S.loadingAgent=null};Q.agentDone=function(S,V){const Y=this.layerInfo[V][S];Y.loadingAgent=C.TILE_AGENT_DONE;Y.data||Y.upsampleInfo||this._createOrUpdateAgents(S+1,V)};Q._createOrUpdateAgents=function(S,V){const Y=this.isSuspended(V),W=this.layerInfo[V];for(;S<W.length;++S){const ha=W[S];var ba=!1;const fa=this._surface.layerViewByIndex(S,V);var ca=D.getLayerWithExtentRange(fa);if(ha.loadingAgent)E.fallsWithinLayer(this,ca,!1)?(ha.loadingAgent!==
C.TILE_AGENT_DONE&&ha.loadingAgent.setSuspension(Y),ha.loadingAgent!==C.TILE_AGENT_DONE&&(ba=ha.loadingAgent.update())):ha.dispose();else if(E.fallsWithinLayer(this,ca,!1)){{ba=S;ca=V;var da=Y;const R=0===ca?J.acquire():H.acquire();R.init(this,ba,ca,da);ba=R}ha.loadingAgent=ba;(ba=ha.loadingAgent.startLoading())?ha.loadingAgent===C.TILE_AGENT_DONE&&this.setPendingUpdate(32):(L(ha.loadingAgent),ha.loadingAgent=C.TILE_AGENT_DONE)}ha.loadingAgent===C.TILE_AGENT_DONE&&this.updateRenderData(V);if(ba&&
fa.isOpaque)break}};Q._isWithinExtent=function(S){const V=this.extent;return V[0]>=S[0]&&S[2]>=V[2]&&V[1]>=S[1]&&S[3]>=V[3]};Q.intersectsExtent=function(S){const V=this.extent;return V[2]>=S[0]&&S[2]>=V[0]&&V[3]>=S[1]&&S[3]>=V[1]};u._createClass(O,[{key:"usedMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===
this._usedMemory&&this._updateMemoryUsed();let S=this._mapTileMemory;for(const {data:V}of this.layerInfo[1])V instanceof c.VectorTile&&(S+=V.memoryUsage);return S}},{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"numSubdivisionsAtLevel",get:function(){return this._numSubdivisionAtLevel}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",
get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[1][3]}},
{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){if(this._dirty){this._dirty=!1;const S=this._isVisible(this.surface.frustum);S!==this._visible&&(this._visible=S,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender());this.updateAgentSuspension()}return this._visible}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const S=!!this.renderData;S!==
this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=S,this._surface.renderer.setNeedsRender());return S}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(1===this._surface.lodSnapping){const S=this.level-this._surface.snapLevel;if(0===S)return!0;if(1===S)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const S=this._surface.tilingScheme.pixelSize;return S*S*4}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;
for(const S of x.LayerClasses){const V=this.layerInfo[S];for(const Y of V)if(Y.loadingAgent&&Y.loadingAgent!==C.TILE_AGENT_DONE&&Y.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return O}();const H=new t(q),J=new t(A),M=new g.ElevationBounds;a.SplitLimits=function(){this.angledSplitBias=this.maxLod=
this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.default=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,u,f){return function(p){function t(){var w=p.apply(this,arguments)||this;w._scaleRangeEnabled=!1;return w}a._inheritsLoose(t,p);a._createClass(t,[{key:"_desiredMinLevelDelta",get:function(){return u.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return t}(f.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),function(a,u,f,p,t,w){let e=function(){function h(){}var k=h.prototype;k.init=function(l,m,z,r){this.tile=l;this._layerIdx=m;this._layerClass=z;this._suspended=r;this._tileLayerInfo=l.getLayerInfo(m,z);
this._tileRequested=null;l=this._findAncestorWithData();this._setUpsampleTile(l)};k.startLoading=function(){return this._requestNext()};k.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};k.setSuspension=function(l){l!==this._suspended&&((this._suspended=l)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=
null):this._tileLayerInfo.data||this.update())};k.update=function(){const l=this._findAncestorWithData();this._setUpsampleTile(l);return this._requestNext()};k.dataArrived=function(l){this._setUpsampleTile(l);this._tileRequested=null;l===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};k.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};k._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};
k._requestNext=function(){if(this._suspended)return!0;const l=this._findNextDownload();if(this._tileRequested){if(l===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}f.isSome(l)?l.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=l):this._agentDone();return!!this._tileRequested};k._findNextDownload=function(){const l=this._layerIdx,m=this._layerClass;var z=this.tile.surface.layerViewByIndex(l,
m);const r=t.getLayerWithExtentRange(z),{minLevel:c,maxLevel:d}=z.dataLevelRange;z=this._desiredMinLevelDelta;const g=this._progressiveLevelModulo+z,A=this._scaleRangeEnabled?w.fallsWithinLayer:()=>!0;let q=this.tile;const y=q.level;let x;var D=this._tileLayerInfo.upsampleInfo;D=D?D.tile.level:-1;const C=f.get(r,"tilemapCache");for(;q&&A(q,r,!1)&&q.level>=c;){const B=q.level,v=y-B,E=q.layerInfo[m][l];if(E.data&&v>=z){B>D&&this._setUpsampleTile(q);E.dataInvalidated&&(x=q);break}if((f.isNone(C)||"unavailable"!==
C.getAvailability(q.lij[0],q.lij[1],q.lij[2]))&&B<=d&&!E.data&&!E.dataMissing){if(f.isNone(x)||q.level===c||0===B%p.PROGRESSIVE_LOADING_MODULO||y-x.level<z)x=q;if(v>=g)break}q=q.parent}f.isSome(x)&&y-x.level<z&&this._tileLayerInfo.upsampleInfo&&(x=null);return x};k._findAncestorWithData=function(){const l=this.tile.vlevel,m=this._desiredMinLevelDelta;let z;for(let r=this.tile;r;r=r.parent)if(r.hasLayerData(this._layerIdx,this._layerClass)){if(l-r.level>=m)return r;z=r}return z};k._setUpsampleTile=
function(l){this._tileLayerInfo.setUpsampleInfo(this.tile,l);this.tile.updateRenderData(this._layerClass)};u._createClass(h,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return h}();var n=function(h){function k(){return h.apply(this,arguments)||this}u._inheritsLoose(k,h);k.prototype.dispose=function(){};u._createClass(k,[{key:"_desiredMinLevelDelta",get:function(){throw b;
}},{key:"_progressiveLevelModulo",get:function(){throw b;}}]);return k}(e);const b=Error("Abstract method called on TileAgent");n=new n;a.TILE_AGENT_DONE=n;a.TileAgent=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,u,f,p){function t(b,h){h(b);if(!b.isLeaf)for(const k of b.children)t(k,h)}function w(b,h,k){b=b.screenDepth;h=
h.screenDepth;return b<h?-k:b>h?k:0}let e=function(){function b(){this._queue=new p;this._last=null;this.remove=()=>{}}var h=b.prototype;h.resetOne=function(k){this._queue.clear();this._queue.push(k);this._last=null};h.reset=function(k=null){this._queue.clear();f.isSome(k)&&this._queue.pushArray(k);this._last=null};h.skipSubtree=function(){this._last=null};h.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};u._createClass(b,
[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return b}(),n=function(){function b(){this.q=new p}var h=b.prototype;h.reset=function(k){this.q.clear();if(k)for(this.q.pushArray(k),k=0;k<this.q.length;++k){const l=this.q.data[k];l.isLeaf||this.q.pushArray(l.children)}};h.next=function(){return this.q.pop()};u._createClass(b,[{key:"done",get:function(){return 0===this.q.length}}]);return b}();a.IteratorPostorder=n;a.IteratorPreorder=e;a.compareTiles=
w;a.computeUpsampleInfo=function(b,h,k){let l=1,m=0,z=0;for(;b!==h;)if(l*=.5,m*=.5,z*=.5,b.lij[2]&1&&(m+=.5),0===(b.lij[1]&1)&&(z+=.5),b=b.parent,null==b)throw Error("tile was not a descendant of upsampleTile");k.init(h,m,z,l)};a.fallsWithinLayer=function(b,h,k){if(f.isNone(h))return!1;const l=h.fullExtent,m=b.extent;if(k){if(m[0]<l.xmin||m[1]<l.ymin||m[2]>l.xmax||m[3]>l.ymax)return!1}else if(l.xmin>m[2]||l.ymin>m[3]||l.xmax<m[0]||l.ymax<m[1])return!1;b=b.surface.tilingScheme.levels[b.lij[0]].scale;
return 0<h.minScale&&b>1.00000001*h.minScale||0<h.maxScale&&b<.99999999*h.maxScale?!1:!0};a.hasLoadableSiblings=function(b){for(let h=0;h<b.length;h++){const k=b[h],l=k.parent;if(l)for(let m=0;4>m;m++){const z=l.children[m];if(z&&z!==k&&z.loadable)return!0}}return!1};a.sortTiles=function(b,h){h.sort((k,l)=>w(k,l,b))};a.sortTilesByPOI=function(b,h){const k=new Map;b.forAll(l=>k.set(l,l.distanceToSquared(h)));b.sort((l,m)=>k.get(l)-k.get(m))};a.tile2str=function(b){return f.isSome(b)?b.lij.toString():
"null"};a.tilesAreRelated=function(b,h){if(!b||!h||b[0]===h[0])return!1;const k=b[0]<h[0],l=k?b:h;b=k?h:b;h=1<<b[0]-l[0];return Math.floor(b[1]/h)===l[1]&&Math.floor(b[2]/h)===l[2]};a.traverseTilesPreorder=function(b,h){if(Array.isArray(b))for(let k=0;k<b.length;k++)t(b[k],h);else t(b,h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,u,f){return function(p){function t(){var w=
p.call(this)||this;w._scaleRangeEnabled=!0;return w}a._inheritsLoose(t,p);a._createClass(t,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return u.PROGRESSIVE_LOADING_MODULO}}]);return t}(f.TileAgent)})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,u,f,p,t,w,e){let n=
function(){function k(){this.waitingAgents=new t;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}k.acquire=function(m){const z=b.acquire();z._init(m);return z};var l=k.prototype;l.release=function(){this.dispose();h.delete(this);b.release(this)};l.dispose=function(){this.loadingAgent=f.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=w.releaseTileData(this._data)};k.prune=function(){b.prune(0)};
l._init=function(m){this.waitingAgents.clear();this._data=w.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=m;this.elevationBounds=null};l.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};l.abortRequest=function(){this.requestAbort=f.abortMaybe(this.requestAbort);this.requestPromise=null};l._unsetUpsampleInfo=function(){this._upsampleInfo&&
(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};l.setUpsampleInfo=function(m,z){if(m===z||f.isNone(z))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===z)return;this._upsampleInfo.tile.unrefMapData()}z.refMapData();e.computeUpsampleInfo(m,z,this._upsampleInfo)}};u._createClass(k,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},
set:function(m){w.releaseTileData(this._data);this._data=m}}]);return k}();const b=new p(n,null,()=>{}),h=new Map;a.TilePerLayerInfo=n;a.printAllocations=function(){0<h.size&&(console.log(`${h.size} live TilePerLayerInfo allocations:`),h.forEach(k=>console.log(k,"\n")))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./PatchGeometryFactory ./Tile".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){k=function(z){function r(d,g,A){var q=z.call(this,l)||this;q.obb=Array(8);q.isWebMercator=!1;for(let y=0;8>y;y++)q.obb[y]=t.create();void 0!==d&&q.init(d,g,A);return q}u._inheritsLoose(r,z);var c=r.prototype;c.init=function(d,g,A){z.prototype.init.call(this,d,g,A);this.isWebMercator=A.tilingScheme.spatialReference.isWebMercator;g=this.ellipsoid.radius;A=this.extentInRadians[0];const q=this.extentInRadians[1],y=this.extentInRadians[2],x=this.extentInRadians[3];d=d[0];
const D=f.lerp(q,x,.5),C=f.lerp(A,y,.5);this._edgeLen=(y-A)*Math.cos(0===d?0:Math.min(Math.abs(q),Math.abs(x)))*g;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=g-Math.sqrt(g*g-this._edgeLen2/4);w.lonLatToSphericalPCPF(this.centerAtSeaLevel,C,D,this.ellipsoid.radius,0);g=t.fromArray(this.centerAtSeaLevel);p.normalize(g,g);this.up=g;this._updateOBB();this.updateRadiusAndCenter()};c.updateRadiusAndCenter=function(){if(0===this.lij[0])p.set(this._center[1],0,0,0),p.set(this._center[0],
0,0,0),p.set(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=e.getReferenceEllipsoid(this.surface.tilingScheme.spatialReference)),this._center[1][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const d=Math.max(p.squaredDistance(this._center[1],this.obb[0]),p.squaredDistance(this._center[1],this.obb[1]));this._center[1][3]=Math.sqrt(d)}};c._isVisible=function(d){if(!this.intersectsClippingArea)return!1;if(10>this.lij[0])return n.intersectsSphere(d,this._center[1]);
const g=this.obb;for(let A=0;6>A;A++){let q=d[A];4===A&&(q=b.copy(q,m),m[3]-=this.surface.view.state.camera.near);let y;for(y=0;8>y&&!b.isPointOutside(q,g[y]);y++);if(8===y)return!1}return!0};c.computeElevationBounds=function(){z.prototype.computeElevationBounds.call(this);this._updateOBB()};c.createGeometry=function(d,g){const A=this._isPole(this.lij[1],this.lij[0]);h.createSphericalGlobePatch(d,this.extent,g,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,A);this.setMemoryDirty()};
c._updateOBB=function(){var d=this.extentInRadians;const g=this.obb;for(let A=0;2>A;A++){const q=this.elevationBounds[A];let y=4*A;w.lonLatToSphericalPCPF(g[y++],d[0],d[1],this.ellipsoid.radius,q);w.lonLatToSphericalPCPF(g[y++],d[0],d[3],this.ellipsoid.radius,q);w.lonLatToSphericalPCPF(g[y++],d[2],d[3],this.ellipsoid.radius,q);w.lonLatToSphericalPCPF(g[y++],d[2],d[1],this.ellipsoid.radius,q)}this.isWebMercator&&(d=this._isPole(this.lij[1],this.lij[0]),2===d?(p.set(g[1],0,0,this.ellipsoid.radius),
p.set(g[2],0,0,this.ellipsoid.radius),p.set(g[5],0,0,this.ellipsoid.radius),p.set(g[6],0,0,this.ellipsoid.radius)):1===d&&(p.set(g[0],0,0,-this.ellipsoid.radius),p.set(g[3],0,0,-this.ellipsoid.radius),p.set(g[4],0,0,-this.ellipsoid.radius),p.set(g[7],0,0,-this.ellipsoid.radius)))};c._isPole=function(d,g){let A=0;d===(1<<g)-1&&(A+=1);0===d&&(A+=2);return A};return r}(k["default"]);const l=[128,64,32,16,16,8,8,4],m=b.create();a.SphericalPatch=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){function g(y,x){y&&!y.spatialReference.equals(x)&&(y=z.canProject(y.spatialReference,x)?z.project(y,x):null);return y}a.SurfaceExtentHelper=function(y){function x(C){C=y.call(this,C)||this;C._handles=new t;return C}u._inheritsLoose(x,y);var D=x.prototype;D.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};D.destroy=function(){this._handles.destroy();this._handles=null};D._computeStencilEnabledExtents=
function(){const C=[];this.layerViews.forEach(B=>{B=B.layer;"IntegratedMeshLayer"===B.operationalLayerType&&null!=this.spatialReference&&(B=g(B.fullExtent,this.spatialReference),null!=B&&C.push(m.fromExtent(B)))});return C};u._createClass(x,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}},{key:"spatialReference",
set:function(C){this.tilingScheme||this._set("spatialReference",C)}},{key:"tilingScheme",set:function(C){this._set("tilingScheme",C);this._set("spatialReference",C.spatialReference)}}]);return x}(p);f.__decorate([e.property({readOnly:!0,dependsOn:[]})],a.SurfaceExtentHelper.prototype,"layerViewsExtent",null);f.__decorate([e.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],a.SurfaceExtentHelper.prototype,"tiledLayersExtent",null);f.__decorate([e.property({readOnly:!0,dependsOn:["spatialReference"]})],
a.SurfaceExtentHelper.prototype,"stencilEnabledExtents",null);f.__decorate([e.property()],a.SurfaceExtentHelper.prototype,"spatialReference",null);f.__decorate([e.property()],a.SurfaceExtentHelper.prototype,"tilingScheme",null);f.__decorate([e.property()],a.SurfaceExtentHelper.prototype,"defaultTiledLayersExtent",void 0);f.__decorate([e.property({constructOnly:!0})],a.SurfaceExtentHelper.prototype,"layers",void 0);f.__decorate([e.property({constructOnly:!0})],a.SurfaceExtentHelper.prototype,"layerViews",
void 0);a.SurfaceExtentHelper=f.__decorate([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],a.SurfaceExtentHelper);let A=function(y){function x(){return y.apply(this,arguments)||this}u._inheritsLoose(x,y);var D=x.prototype;D._computeLayerViewsExtent=function(){return this._getGlobalExtent()};D._computeTiledLayersExtent=function(){return this._getGlobalExtent()};D._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:c.GEOGRAPHIC_WORLD_EXTENT};
return x}(a.SurfaceExtentHelper);f.__decorate([e.property({dependsOn:["spatialReference"]})],A.prototype,"layerViewsExtent",void 0);A=f.__decorate([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],A);let q=function(y){function x(){return y.apply(this,arguments)||this}u._inheritsLoose(x,y);var D=x.prototype;D.initialize=function(){this._handles.add([this.layers.on("change",C=>this._handleLayersChanged(C)),this.layerViews.on("change",()=>this.notifyChange("layerViewsExtent"))])};D._handleLayersChanged=
function(C){for(const B of C.removed)this._handles.remove(B.uid);for(const B of C.added)this._handles.add(w.init(B,"loaded",()=>this.notifyChange("tiledLayersExtent")),B.uid)};D._computeLayerViewsExtent=function(){const C=m.empty(),B=this.spatialReference;this.layerViews.forEach(F=>{const L=F.layer;!F.isResolved()||"graphics"===L.type&&L.internal||(F=g("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,B))&&m.expand(C,F)});const v=m.allFinite(C)?
C:null,E=this._get("layerViewsExtent");return m.equals(v,E)?E:v};D._computeTiledLayersExtent=function(){const C=this.tilingScheme;if(!C)return null;const B=this.spatialReference,v=m.empty();this.layers.forEach(function(L){if(L.loaded&&r.isTiledLayer(L)){const {tileInfo:N,fullExtent:I}=d.getTiledLayerInfo(L,B,2);N&&d.isProjectableRasterLayer(L)&&I?m.expand(v,I):N&&C.compatibleWith(N)&&I&&I.spatialReference.equals(B)&&m.expand(v,I)}});this.defaultTiledLayersExtent&&m.expand(v,this.defaultTiledLayersExtent);
const E=m.allFinite(v)?v:null,F=this._get("tiledLayersExtent");return m.equals(E,F)?F:E};return x}(a.SurfaceExtentHelper);q=f.__decorate([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],q);a.create=function(y,x){return 1===y?new A(x):new q(x)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ./terrainUtils ./TilingScheme".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){a.SurfaceTilingSchemeLogic=function(d){function g(q){q=d.call(this,q)||this;q._handles=new t;return q}u._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};A.destroy=function(){this._handles.destroy();this._waitTask=this._handles=
null};A._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var q;this.layers.some(x=>!z.isTiledLayer(x)||x.isRejected()?!1:!x.isFulfilled()||r.getTiledLayerInfo(x,this.viewSpatialReference,this.viewingMode).tileInfo?(q=x,!r.isVectorTileLayer(x)&&!r.isProjectableRasterLayer(x)):!1);if(q)if(q.isResolved()){var {tileInfo:y}=r.getTiledLayerInfo(q,this.viewSpatialReference,this.viewingMode);y=new c(y);this._set("tilingSchemeDone",!0);this._lockTilingScheme(y)}else this._updateWhen(q);
else this._set("tilingSchemeDone",!0)}};A._updateWhen=function(q){const y=q.when().catch(x=>x).then(()=>{y!==this._waitTask||this.destroyed||this._update()});this._waitTask=y};A._lockTilingScheme=function(q){if(1===this.viewingMode){const y=q.levels.length-1;q.spatialReference.isWebMercator?q=c.makeWebMercatorAuxiliarySphere(y):l.canProjectToWGS84ComparableLonLat(q.spatialReference)&&(q=c.makeGCSWithTileSize(q.spatialReference,q.pixelSize,y))}this.tilingSchemeLocked=!0;this.tilingScheme=q;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};A._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};A._setAdHocTilingScheme=function(){if(1===this.viewingMode){var q=this.extentHelper.spatialReference;const y=l.canProjectToWGS84ComparableLonLat(q)||m.isMars(q)||m.isMoon(q);q.isWebMercator?this.tilingScheme=c.WebMercatorAuxiliarySphere:y&&
(this.tilingScheme=c.makeGCSWithTileSize(q,256));this.extent=this.extentHelper.layerViewsExtent}else if(q=this.extentHelper.layerViewsExtent)this.tilingScheme=c.fromExtent(q,this.extentHelper.spatialReference),this.extent=q};return g}(p);f.__decorate([w.property()],a.SurfaceTilingSchemeLogic.prototype,"tilingScheme",void 0);f.__decorate([w.property()],a.SurfaceTilingSchemeLogic.prototype,"extent",void 0);f.__decorate([w.property({value:!1})],a.SurfaceTilingSchemeLogic.prototype,"tilingSchemeLocked",
void 0);f.__decorate([w.property({readOnly:!0,value:!1})],a.SurfaceTilingSchemeLogic.prototype,"tilingSchemeDone",void 0);f.__decorate([w.property({constructOnly:!0})],a.SurfaceTilingSchemeLogic.prototype,"viewSpatialReference",void 0);f.__decorate([w.property({constructOnly:!0})],a.SurfaceTilingSchemeLogic.prototype,"layers",void 0);f.__decorate([w.property({constructOnly:!0})],a.SurfaceTilingSchemeLogic.prototype,"extentHelper",void 0);f.__decorate([w.property({constructOnly:!0})],a.SurfaceTilingSchemeLogic.prototype,
"viewingMode",void 0);a.SurfaceTilingSchemeLogic=f.__decorate([k.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],a.SurfaceTilingSchemeLogic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../../support/requestImageUtils ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./TerrainConst ./TileRenderer ./tileUtils ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O){function Q(R,U,Z){g.set(Z,R[0]*U[2]+U[0],R[1]*U[3]+U[1],R[2]*U[2],R[3]*U[3])}const S=q.create(),V=A.create();let Y=function(){this.extent=A.create();this.maxLevel=this.minLevel=0;this.callback=null};p=function(R){function U(T){T=R.call(this,T)||this;T.type="Terrain";T.isGround=!0;T.tileSize=256;T.rctx=null;T._isTransparent=!1;T.renderDataPool=new w(B.PatchRenderData);T._patchGroups=new e({allocator:P=>P||{root:null,
origin:null,patches:new e},deallocator:P=>{P.root=null;P.origin=null;P.patches.clear();return P}});T.patchGroupsDirty=!0;T.patchGroupsMap=new Map;T.tileIterator=new F.IteratorPreorder;T.highestVisibleLODTile=null;T.visible=!0;T._opaque=!0;T._skirtScale=1;T._velvetOverground=!0;T.castShadows=!0;T._ssrEnabled=!1;T.emptyTex=null;T.tileRenderer=null;T.tileBackgroundInitialized=!1;T.tileBackgroundUpdating=!1;T.stencilEnabledLayerExtents=[];T.numTrianglesRendered=0;T.numTilesRendered=0;T.numTilesCulled=
0;T.numOriginsRendered=0;T.clippingExtent=null;T.overlayOpacity=1;T.needsHighlight=!1;T.renderOccludedFlags=1;T.visibleScaleRangeQueries=new e({initialSize:10});T.visibleScaleRangeQueriesInvPtr=0;T.visibleScaleRangeQueryQueue=new e({initialSize:30});T.visibleScaleRangeQueryPool=new w(Y);return T}a._inheritsLoose(U,R);var Z=U.prototype;Z.initialize=function(){this.stage.addRenderPlugin([2,7,9],this)};Z.destroy=function(){this.stage.removeRenderPlugin(this);C.clearCaches()};Z.setDebugScreenSizePerspective=
function(T){this.shaderTechniqueConfig.screenSizePerspective!==T&&(this.shaderTechniqueConfig.screenSizePerspective=T,this.setNeedsRender())};Z.setRootTiles=function(T){this.rootTiles=T;this.setNeedsRender()};Z.setNeedsHighlight=function(T){this.needsHighlight=T;this.setNeedsRender()};Z.setRenderOccludedOverlay=function(T){this.renderOccludedFlags=T?D.overlayRenderOccludedFlag:1;this.setNeedsRender()};Z.setStencilEnabledLayerExtents=function(T){this.stencilEnabledLayerExtents=T;this.setNeedsRender()};
Z.setTileSize=function(T){this.tileSize=T;this.tileRenderer&&(this.tileRenderer.tileSize=T);this.setNeedsRender()};Z.loadTile=function(T){T.renderData||(T.renderData=this.renderDataPool.acquire(),T.renderData.init(T),T.renderData.localOrigin=this._getLocalOriginOfTile(T));this.updateTileGeometry(T);this.updateTileTexture(T)};Z.queryVisibleLevelRange=function(T,P,X,aa){const ja=this.visibleScaleRangeQueryPool.acquire();g.copy(ja.extent,T);ja.minLevel=P?P:-Number.MAX_VALUE;ja.maxLevel=null!=X?X:Number.MAX_VALUE;
ja.callback=aa;this.visibleScaleRangeQueryQueue.push(ja);this.setNeedsRender()};Z.updateTileTexture=function(T){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(T),this.setNeedsRender(),T.resetPendingUpdate(64))};Z.updateTileGeometry=function(T){for(const P of T.layerInfo[0])P.pendingUpdates&=-33;T.resetPendingUpdate(32);T.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};Z.unloadTile=function(T){T.renderData&&(T.renderData.releaseGeometry()&&
this.setNeedsRender(),this.renderDataPool.release(T.renderData),T.renderData.clear(),T.renderData=null,T.setMemoryDirty(),this.setNeedsRender())};Z._getLocalOriginOfTile=function(T){const P=Math.max(0,7*Math.floor((T.lij[0]-3)/7));if(this.isGlobal&&0===P)return d.ZEROS;for(;T.parent&&T.lij[0]>P;)T=T.parent;return T.centerAtSeaLevel};Z.setVisibility=function(T){this.visible=T;this.setNeedsRender()};Z.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,
numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};Z.setNeedsRender=function(T=1){this.patchGroupsDirty=!0;this.context.requestRender(T)};Z.setTileBackground=function(T){this.tileBackground=T;this._updateTileBackground()};Z.initializeRenderContext=function(T){this.context=T;this.rctx=T.renderContext.rctx;this.shaderTechniques=T.shaderTechniqueRep;this.shaderTechniqueConfig=new O.TerrainTechniqueConfiguration;this.tileRenderer=new E.TileRenderer(this.rctx,this.tileSize,
this.shaderTechniques);this.tileBackground&&this._updateTileBackground();this.emptyTex=G.createEmptyTexture(this.rctx)};Z.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};Z.intersect=function(T,P,X,aa){if(this.rootTiles&&(!T.options.selectOpaqueTerrainOnly||!T.options.selectionMode||this._opaque)){var ja=ca,ia=da;c.subtract(ja,aa,X);c.set(ia,1/ja[0],1/ja[1],1/ja[2]);var ka=
T.results.min,na=T.results.max,ta=T.results.ground,pa=0===T.options.store,xa=!!T.results.ground.target,Da,Ka=J.getVerticalOffsetTerrain(T.verticalOffset),Fa=this.clippingExtent;this.allTiles.forAll(Ha=>{if(!(null===Ha.renderData||xa&&this._useStencilForTile(Ha))){if(T.options.invisibleTerrain){if(!Ha.visible&&Fa&&!Ha.intersectsExtent(Fa))return}else if(!Ha.visible)return;var ua=Ha.renderData.geometryInfo;q.set(S,ua.boundingBox);var Ba=Ha.renderData.localOrigin;t.isSome(Ka)&&(Ka.localOrigin=Ba,Ka.applyToAabb(S));
var Ea=-this._skirtScale*ua.skirtLength;if(0!==Ea){var Ga=Ha.up;q.expandWithOffset(S,Ea*Ga[0],Ea*Ga[1],Ea*Ga[2])}c.subtract(ha,X,Ba);if(M.intersectAabbInvDirBefore(S,ha,ia,T.tolerance,pa&&null!=ka.dist?ka.dist:Infinity)){var ma=(Ua,Qa,ra,va)=>{Ua.set(void 0,F.tile2str(Qa),ra,va,r.IDENTITY,void 0);Ua.intersector="TerrainRenderer";Ua.target={type:"external",metadata:{tile:Qa}}};Ga=(Ua,Qa)=>{0<=Ua&&(T.options.backfacesTerrain||0>c.dot(Qa,ja))&&(T.options.invisibleTerrain||!T.options.selectionMode||null==
P||P(X,aa,Ua))&&((null==ta.dist||Ua<ta.dist)&&ma(ta,Ha,Ua,Qa),T.options.isFiltered||(2===T.options.store&&(t.isNone(Da)?(Da=new K.IntersectorResult(T.ray),ma(Da,Ha,Ua,Qa),T.results.all.push(Da)):Ua<Da.dist&&ma(Da,Ha,Ua,Qa)),(null==ka.dist||Ua<ka.dist)&&ma(ka,Ha,Ua,Qa),0!==T.options.store&&(null==na.dist||Ua>na.dist)&&ma(na,Ha,Ua,Qa)))};var ya=fa;c.subtract(ya,aa,Ba);var Ma=ua.indices,Ra=ua.vertexAttributes,ea={data:Ra.getField("position",y.BufferViewVec3f).typedBuffer,size:3,stride:Ra.stride/4};ua=
ua.numWithoutSkirtIndices/3;M.intersectTriangles(ha,ya,0,ua,Ma,ea,null,Ka,Ga);0!==Ea&&C.intersectSkirts(ha,ya,ua,Ma.length/3,Ma,Ra,this.isGlobal?Ua=>c.scale(Ua,Ua,Ea/c.length(c.add(Ua,Ua,Ba))):Ua=>c.set(Ua,0,0,Ea),Ka,Ga)}}})}};Z.prepareRender=function(){1>this.overlayOpacity&&this.updateOverlayOpacity()};Z.render=function(T){if(9===T.slot){if(0===(T.renderOccludedMask&D.overlayRenderOccludedFlag))return!1}else if(T.slot!==(this.opaque?2:7))return!1;var P=T.pass;const X=1===T.scenelightingData.globalFactor,
aa=this._updatePatchGroups();switch(P){case 0:P=T.shadowMap&&T.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==P&&(this.shaderTechniqueConfig.receiveShadows=P);P=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==P&&(this.shaderTechniqueConfig.overlayMode=P);this._renderMaterialPass(T,0,aa,9===T.slot?3:1);break;case 4:case 6:this.castShadows&&X&&this._renderAuxiliaryPass(T,3,aa,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||
this._renderAuxiliaryPass(T,1,aa,0);break;case 3:this._renderAuxiliaryPass(T,2,aa,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(T,4,aa,2),T.rctx.clearSafe(256))}0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};Z._renderMaterialPass=function(T,P,X,aa){const {rctx:ja,camera:ia}=T;this._ssrEnabled=T.ssrParams.ssrEnabled;this._setTerrainTechnique(P,3===aa);const ka=this.shaderTechnique.program;ja.useProgram(ka);0!==this.shaderTechniqueConfig.overlayMode&&
1===aa&&T.ssrParams&&N.bindSSRUniforms(ka,T.ssrParams);T.shadowMap.bind(ka);T.ssaoHelper.bind(ka);this._bindOverlayData(ka,aa);ka.setUniformMatrix4fv("viewNormal",ia.viewInverseTransposeMatrix);I.bindProjectionMatrix(ka,ia.projectionMatrix);T.scenelightingData.setUniforms(ka,!0);P=ia.viewMatrix;c.set(ba,P[12],P[13],P[14]);c.normalize(ba,ba);ka.setUniform3fv("viewDirection",ba);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();
this.opaque?this._renderPatchGroups(T,ka,X,aa):T.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(T,ka,X,aa),T.offscreenRenderingHelper.tmpColor,T.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};Z._renderAuxiliaryPass=function(T,P,X,aa){this._setTerrainTechnique(P,3===aa);P=this.shaderTechnique.program;T.rctx.useProgram(P);if(5===T.pass){const ja=T.offscreenRenderingHelper;P.bindTexture(ja.depthTexture,"depthTex");P.setUniform4f("highlightViewportPixelSz",
0,0,1/ja.width,1/ja.height)}else P.setUniformMatrix4fv("viewNormal",T.camera.viewInverseTransposeMatrix),2!==T.pass&&4!==T.pass&&6!==T.pass||P.setUniform2fv("nearFar",T.camera.nearFar);this._renderPatchGroupsAuxiliary(T,P,X,aa)};Z._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=!0;var T=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;this.shaderTechniqueConfig.hasBackgroundColor=
!this.tileRenderer.backgroundIsGrid&&!!t.isSome(this.tileRenderer.backgroundColor);this.allTiles.forAll(P=>this.tileRenderer.updateTileTexture(P));this.setNeedsRender()};if("string"===typeof this.tileBackground){const P=this.tileBackground;x.requestImage(P).then(X=>{P===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(X,this.tileBackground===v.DEFAULT_TILE_BACKGROUND),T())})}else{const P=this.tileBackground?f.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(P,
!1);T()}}};Z._updatePatchGroups=function(){const T=this._patchGroups;if(!this.patchGroupsDirty)return T;this.highestVisibleLODTile=null;this._renderCollectOrigins(T);if(0!==this.renderOrder){for(let P=0;P<T.length;P++)F.sortTiles(this.renderOrder,T.data[P].patches);T.sort((P,X)=>{var aa=this.renderOrder;P=0===P.patches.length?-aa:0===X.patches.length?aa:F.compareTiles(P.patches.data[0],X.patches.data[0],aa);return P})}this.patchGroupsDirty=!1;return T};Z._renderCollectOrigins=function(T){var P=this.rootTiles;
const X=this.isGlobal;T.clear();for(const aa of P)P=T.pushNew(),P.root=aa,P.origin=X?d.ZEROS:aa.centerAtSeaLevel,P.patches.clear(),this._renderCollectOriginsForRoot(T,P);T.filterInPlace(aa=>0<aa.patches.length)};Z._renderCollectOriginsForRoot=function(T,P){const X=this.tileIterator;X.resetOne(P.root);const aa=this.patchGroupsMap;aa.clear();for(aa.set(P.origin,P);!X.done;){P=X.next();var ja=P.renderData;if(ja&&!P.visible)this.numTilesCulled++,X.skipSubtree();else{if(0===P.lij[0]%7){const ia=T.pushNew();
ia.root=P;ia.origin=P.centerAtSeaLevel;aa.set(P.centerAtSeaLevel,ia);ia.patches.clear()}if(!P.rendered)this.numTilesCulled++;else if(ja){(ja=aa.get(ja.localOrigin))&&ja.patches.push(P);if(!this.highestVisibleLODTile||P.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=P;X.skipSubtree()}}}};Z._scaleQueriesForTile=function(T){const P=T.extent;T=T.lij[0];let X=0;for(;X<this.visibleScaleRangeQueriesInvPtr;){const aa=this.visibleScaleRangeQueries.data[X],ja=aa.extent;T>=aa.minLevel&&
T<=aa.maxLevel&&ja[0]<=P[2]&&ja[2]>=P[0]&&ja[1]<=P[3]&&ja[3]>=P[1]?(this.visibleScaleRangeQueries.swapElements(X,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):X++}};Z._useStencilForTile=function(T){for(const P of this.stencilEnabledLayerExtents)if(T.intersectsExtent(P))return!0;return!1};Z._renderPatchGroupsAuxiliary=function(T,P,X,aa){this.shaderTechnique.bindPipelineState(T.rctx);const ja=0<this.stencilEnabledLayerExtents.length;P.setUniformMatrix4fv("proj",T.camera.projectionMatrix);
P.setUniform1f("skirtScale",this._skirtScale);0!==aa&&this._bindOverlayData(P,aa);for(let ia=0;ia<X.length;ia++){const ka=X.data[ia];this._bindPatchGroupData(P,ka,T.camera.eye,T.camera.viewMatrix);for(let na=0;na<ka.patches.length;na++)this._renderPatch(T.rctx,P,ka.patches.data[na],4,ja,aa)}T.rctx.bindVAO(null)};Z._renderPatchGroups=function(T,P,X,aa){const ja=T.rctx,ia=T.camera,ka=ia.viewMatrix;this.shaderTechnique.bindPipelineState(ja);if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var na=
H.getSettings(this.stage.viewingMode,this.ellipsoidRadius);na.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ia.fovY});M.bindScreenSizePerspective(na,P,"screenSizePerspective")}na=0<this.stencilEnabledLayerExtents.length;const ta=3===aa;ta&&(P.bindTexture(this.emptyTex,"tex"),P.setUniform1f("blend",1),P.setUniform4fv("texOffsetAndScale",A.ZEROS));var pa=t.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:A.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&
P.setUniform4fv("backgroundColor",pa);P.setUniform1f("skirtScale",ta?0:this._skirtScale);pa=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&P.bindTexture(this.emptyTex,"texNext");for(let Ka=0;Ka<X.length;Ka++){var xa=X.data[Ka];const Fa=xa.patches;this._bindPatchGroupData(P,xa,ia.eye,ka);L.bindSliceUniforms(P,this.shaderTechnique.configuration,T.sliceHelper&&T.sliceHelper.plane,xa.origin);T.shadowMap&&T.shadowMap.bindView(P,xa.origin);this.numOriginsRendered++;for(xa=0;xa<Fa.length;xa++){const Ha=
Fa.data[xa];var Da=Ha.renderData.textureReference;if(!t.isNone(Da)){if(!ta){this._scaleQueriesForTile(Ha);Q(Ha.renderData.geometryInfo.uvOffsetAndScale,Da.offsetAndScale,V);P.setUniform4fv("texOffsetAndScale",V);P.bindTexture(Da.texture.texture,"tex");Da=Ha.renderData.textureFadeFactor;const ua=1>Da?Ha.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&t.isSome(ua)&&1>Da?(Q(Ha.renderData.geometryInfo.uvOffsetAndScale,ua.offsetAndScale,V),P.setUniform1f("textureFadeFactor",
Da),P.setUniform4fv("nextTexOffsetAndScale",V),P.bindTexture(ua.texture.texture,"texNext")):P.setUniform1f("textureFadeFactor",1);Ha.renderData.textureIsFading&&this.setNeedsRender();P.setUniform1f("opacity",Ha.renderData.opacity);P.setUniform1i("compositeBackground",Ha.renderData.compositeBackgroundInShader?1:0);P.setUniform1f("textureOpacity",Ha.renderData.layerOpacity);P.setUniform1f("baseOpacity",Ha.renderData.baseOpacity)}Da=this._renderPatch(ja,P,Ha,pa,na,aa);Ha.renderOrder=this.numTilesRendered;
this.numTilesRendered++;this.numTrianglesRendered+=Da/3}}}ja.bindVAO(null)};Z._renderPatch=function(T,P,X,aa,ja,ia){if(t.isNone(X.renderData.vao.indexBuffer))return 0;0!==ia&&this._bindOverlayPatchData(P,X.renderData.overlay);ja&&(this._useStencilForTile(X)?this.stencilShaderTechnique.bindPipelineState(T):this.shaderTechnique.bindPipelineState(T));ja=0===this._skirtScale?X.renderData.geometryInfo.numWithoutSkirtIndices:X.renderData.vao.indexBuffer.size;T.bindVAO(X.renderData.vao);P.assertCompatibleVertexAttributeLocations(X.renderData.vao);
T.drawElements(aa,ja,X.renderData.vao.indexBuffer.indexType,0);return ja};Z._bindPatchGroupData=function(T,P,X,aa){T.setUniform3fv("origin",P.origin);z.translate(W,aa,P.origin);T.setUniformMatrix4fv("view",W);T.setUniform3f("camPos",X[0]-P.origin[0],X[1]-P.origin[1],X[2]-P.origin[2])};Z._bindOverlayData=function(T,P){if(0!==this.shaderTechniqueConfig.overlayMode){T.setUniform1f("overlayOpacity",this.overlayOpacity);var X=this.overlayRenderer.overlays;if(0<X.length){X=X[0];const aa=X.getColorTexture(P);
T.bindTexture(t.isSome(aa)?aa:this.emptyTex,"ovColorTex");2===this.shaderTechniqueConfig.overlayMode&&(P=X.getNormalTexture(P),T.bindTexture(t.isSome(P)?P:this.emptyTex,"ovWaterTex"))}}};Z._bindOverlayPatchData=function(T,P){T.setUniform4fv("overlayTexOffset",P.offsets);T.setUniform4fv("overlayTexScale",P.scales)};Z._setTerrainTechnique=function(T,P){this.shaderTechniqueConfig.output=T;0===T&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=
this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=P;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.releaseAndAcquire(O.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.releaseAndAcquire(O.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};Z._prepareScaleRangeQueries=function(){const T=this.visibleScaleRangeQueries,
P=this.visibleScaleRangeQueryQueue;for(;T.length<T.data.length&&0<P.length;){const X=P.pop();T.push(X)}this.visibleScaleRangeQueriesInvPtr=T.length};Z._processScaleRangeQueries=function(){const T=this.visibleScaleRangeQueries,P=this.visibleScaleRangeQueryPool;for(let X=0;X<T.length;X++){const aa=T.data[X];P.release(aa);aa.callback(X>=this.visibleScaleRangeQueriesInvPtr);aa.callback=null}T.clear()};a._createClass(U,[{key:"isGlobal",get:function(){return 1===this.stage.viewingMode}},{key:"updating",
get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(T){this._set("renderingDisabled",!!T);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(T){this._opaque!==T&&(this._opaque=T,this.setNeedsRender())}},{key:"needsLinearDepth",
get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(T){this._isTransparent!==T&&(this._isTransparent=T,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(T){T!==this._skirtScale&&(this._skirtScale=T,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(T){this.shaderTechniqueConfig.tileBorders!==T&&(this.shaderTechniqueConfig.tileBorders=
T,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(T){this.shaderTechniqueConfig.backfaceCullingEnabled!==T&&(this.shaderTechniqueConfig.backfaceCullingEnabled=T,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(T){this._set("renderOrder",T);this.setNeedsRender()}},{key:"velvetOverground",set:function(T){this._velvetOverground!==T&&(this._velvetOverground=
T,this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return J.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(T){this.shaderTechniqueConfig.slicePlaneEnabled!==T&&(this.shaderTechniqueConfig.slicePlaneEnabled=T,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(T){this.shaderTechniqueConfig.textureFadingEnabled!==T&&(this.shaderTechniqueConfig.textureFadingEnabled=T,this.setNeedsRender())}},{key:"wireframe",
set:function(T){this._get("wireframe")!==T&&(this._set("wireframe",T),this.allTiles.forAll(P=>{var X;return null==(X=P.renderData)?void 0:X.updateGeometry(this.rctx,T)}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return U}(p);u.__decorate([n.property()],p.prototype,"tileBackgroundInitialized",void 0);u.__decorate([n.property()],p.prototype,"tileBackgroundUpdating",void 0);u.__decorate([n.property({constructOnly:!0})],p.prototype,"overlayRenderer",
void 0);u.__decorate([n.property({constructOnly:!0})],p.prototype,"stage",void 0);u.__decorate([n.property({readOnly:!0})],p.prototype,"isGlobal",null);u.__decorate([n.property({constructOnly:!0})],p.prototype,"updateOverlayOpacity",void 0);u.__decorate([n.property({constructOnly:!0})],p.prototype,"allTiles",void 0);u.__decorate([n.property({constructOnly:!0})],p.prototype,"ellipsoidRadius",void 0);u.__decorate([n.property({readOnly:!0})],p.prototype,"updating",null);u.__decorate([n.property({value:!1})],
p.prototype,"renderingDisabled",null);u.__decorate([n.property()],p.prototype,"renderPatchBorders",null);u.__decorate([n.property()],p.prototype,"cullBackFaces",null);u.__decorate([n.property({value:1})],p.prototype,"renderOrder",null);u.__decorate([n.property()],p.prototype,"wireframe",null);u=p=u.__decorate([m.subclass("esri.views.3d.terrain.TerrainRenderer")],p);const W=r.create(),ba=d.create(),ca=d.create(),da=d.create(),ha=d.create(),fa=d.create();return u})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./TextureFader ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){let c=function(){function d(){this.geometryInfo=new n.PatchGeometry;this._textureRef=new h["default"](()=>this.tile.surface.textureFadeDuration);this.overlay=new k}var g=d.prototype;g.init=function(A){this.tile=A;this.clear();A=this.geometryInfo;A.indices=null;A.vertexAttributes=null;w.empty(A.boundingBox);A.numSurfaceIndices=0;A.numSkirtIndices=0;A.numWithoutSkirtIndices=0;A.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,
wireframe:!1};this.opacity=1;this.localOrigin=null;this.overlay.clear()};g.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};g.updateGeometry=function(A,q){if(!this._updateGeometryState(q))return!1;this._releaseGeometry();this._createGeometry(A);return!0};g.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};g.ensureTexture=function(A,q){t.isSome(this._texture)&&
this._texture.descriptor.width!==A&&this.releaseTexture();t.isNone(this._texture)&&(this._texture=q(),this.tile.setMemoryDirty());return this._texture};g.releaseTexture=function(){t.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};g._updateGeometryState=function(A){const q=this._getElevationInfo();var y=this.tile.level,x=8>y?this.tile.numSubdivisionsAtLevel[y]+1:2;q.samplerData&&(x=this.tile.maxTesselation,x=p.clamp((x>>Math.max(y-q.maxTileLevel,b.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-y)))+1,2,x+1));y=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)y=null;const D=this.geometryState;let C=!1;D.numVertsPerRow!==x&&(D.numVertsPerRow=x,C=!0);q.changed&&(D.samplerData=q.samplerData,C=!0);f.equals(D.clippingArea,y)||(D.clippingArea=y,C=!0);D.wireframe!==A&&(D.wireframe=A,C=!0);return C};g._createGeometry=function(A){this.tile.createGeometry(this.geometryState,this.localOrigin);const q=this.geometryInfo.vertexAttributes,y=
this.geometryInfo.indices,x=A.gl;this._vao=new r(A,m.Default3D,{geometry:e.glLayout(q.layout)},{geometry:z.createVertex(A,x.STATIC_DRAW,q.buffer)},z.createIndex(A,x.STATIC_DRAW,y))};g._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;n.releaseGeometry(this.geometryInfo);return!0};g.setTextureReference=function(A,q,y,x,D=0){A!==this._texture&&this.releaseTexture();this._textureRef.push(A,q,y,x,D)};g._getElevationInfo=function(){const A=this.geometryState.samplerData,
q=this.tile.layerInfo[0],y=q.length;let x=Array(y),D=0;var C=0;let B=!1;for(let F=0;F<y;F++){var v=q[F];if(v.upsampleInfo){v=v.upsampleInfo.tile;var E=v.layerInfo[0][F].data;E=E&&E.samplerData;A&&A[D]===E||(B=!0);x[D++]=E;C=Math.max(C,v.lij[0])}else v.data&&(E=this.tile.surface.layerViewByIndex(F,0),l.fallsWithinLayer(this.tile,E.layer,!1)&&(C=v.data,A&&A[D]===C.samplerData||(B=!0),x[D++]=C.samplerData,C=this.tile.lij[0]))}A&&A.length!==D&&(B=!0);0<D?x.length=D:x=null;return{changed:B,samplerData:x,
maxTileLevel:C}};u._createClass(d,[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength}},
{key:"textureDescriptor",get:function(){return t.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return d}();a.PatchRenderData=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec4f64"],function(a,u,f,p){let t=function(){function e(b){this._getFadeDuration=b;this._delayedTime=
this._fadeStart=0}var n=e.prototype;n.clear=function(){this._current=f.destroyMaybe(this._current);this._next=f.destroyMaybe(this._next);this._waiting=f.destroyMaybe(this._waiting);this._delayed=f.destroyMaybe(this._delayed)};n.push=function(b,h,k,l,m=0){this._delayed=f.destroyMaybe(this._delayed);b=f.isSome(b)?new w(b,h,k,l):null;this._push(b,m)};n._push=function(b,h){this._isFading||this.clear();if(f.isNone(this._current))this._current=b;else{var k=performance.now();0!==h?(this._delayed=b,this._delayedTime=
k+h):f.isNone(this._next)?(this._next=b,this._fadeStart=this._alignFadeStart(k)):f.isNone(b)||(f.destroyMaybe(this._waiting),this._waiting=b)}};n._alignFadeStart=function(b){const h=this._getFadeDuration();return b+h-b%h};u._createClass(e,[{key:"current",get:function(){if(f.isNone(this._current))return null;if(!this._isFading){var b=this._delayed||this._waiting||this._next||this._current;b!==this._current&&(this._current=null,this.clear(),this._current=b)}b=0;f.isSome(this._delayed)&&(b=performance.now(),
b>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null));f.isSome(this._next)&&(b=b||performance.now(),b-this._fadeStart>=this._fadeDuration&&(f.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(b)));return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(f.isNone(this._next))return 1;const b=Math.max(0,performance.now()-this._fadeStart),h=this._fadeDuration;
return b>h?0:1-b/h}},{key:"isFading",get:function(){return f.isSome(this._next)||f.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return f.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFading",get:function(){return 0<this._getFadeDuration()}}]);return e}(),w=function(){function e(n,b,h,k){this.texture=n;n.retain();this.offsetAndScale=p.fromValues(b,h,k,k)}e.prototype.destroy=function(){this.texture.release()};return e}();a.TextureReference=w;a.default=
t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function u(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var f=u.prototype;f.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};f.setScale=function(p,t,w){this._scales[2*p]=t;this._scales[2*p+1]=w};
f.setOffset=function(p,t,w){this._offsets[2*p]=t;this._offsets[2*p+1]=w};a._createClass(u,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return u}()})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../layers/support/layerUtils ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Program ../../webgl/ProgramCache ../../webgl/Renderbuffer ../../webgl/RenderingContext ../../webgl/ShaderCompiler ../../webgl/Texture ../../webgl/VertexArrayObject ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./RasterColorizerTechnique ./terrainUtils ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E){function F(I,G,K){K.layerIndex=G;const H=I.layerInfo[1][G];return H.data?(t.set(K.offset,0,0),K.tile=I,K.scale=1,K.sourceLod=I.lij,K.sourceLayerInfo=H,K):(I=H.upsampleInfo)?(G=I.tile.layerInfo[1][G],K.tile=I.tile,t.copy(K.offset,I.offset),K.scale=I.scale,K.sourceLod=I.tile.lij,K.sourceLayerInfo=G,K):null}b=function(){function I(K,H,J){this._rctx=K;this.tileSize=H;this._backgroundIsGrid=!1;this._blackTex=this._backgroundColor=this._backgroundTexture=
null;this._vectorTileHelper=new g.VectorTileRendererHelper3D;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._vaoQuad=v.createQuadVAO(this._rctx,B.Pos2Tex);K=new q.BlendLayersTechniqueConfiguration;K.mode=2;this._blendLayersTechnique=J.acquire(q.BlendLayersTechnique,K);K.mode=1;this._applyOpacityTechnique=J.acquire(q.BlendLayersTechnique,K);this._techniqueRep=J;this._blackTex=new D(v.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new C.FBOPool(this._rctx)}var G=I.prototype;
G.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad=p.disposeMaybe(this._vaoQuad);this._backgroundTexture=p.releaseMaybe(this._backgroundTexture);this._blackTex=p.releaseMaybe(this._blackTex);this._blendLayersTechnique=p.disposeMaybe(this._blendLayersTechnique);this._applyOpacityTechnique=p.disposeMaybe(this._applyOpacityTechnique);this._vectorTileHelper=p.disposeMaybe(this._vectorTileHelper)};G.updateTileTexture=function(K){var H=K.layerInfo[1];for(var J of H)J.pendingUpdates&=
-65;if(K.renderData){var M=K.surface,O=M.baseOpacity,Q=0;J=0;for(var S=this.tileSize,V=!1,Y=M.view.pixelRatio,W=H.length,ba=0;ba<H.length&&!V;ba++){const ca=M.layerViewByIndex(ba,1),da=ca.fullOpacity;L[ba]=da;n.isBaseLayer(ca.layer)&&W>=H.length&&(W=ba);if(0===da)continue;++J;const ha=F(K,ba,N);ha&&(x.isVectorTileLayerView(ca)?S=Math.max(S,this.tileSize*Y):1===O&&1===da&&(ca.isOpaque||this._dataToTexture(ha)&&p.isSome(ha.sourceLayerInfo.data)&&ha.sourceLayerInfo.data.descriptor.isOpaque)&&(V=!0),
++Q)}this._cleanupFBOPool(Y,H.length);O=S;S=f.nextHighestPowerOfTwo(O);H=S*S;M=O*O;H===M?S=O:(O=S/2,S=H-M<M-O*O?S:O);H=S/this.tileSize;--ba;if(0===Q){Q=0;if(K.surface.view.layerViewManager.updating||0<J)Q=5E3;this._backgroundTexture&&p.isNone(K.renderData.textureReference)&&(Q=0);this._useBackgroundTexture(K,Q)}else 1===Q&&(V||this._backgroundIsGrid||p.isSome(this._backgroundColor))&&this._useLayerTexture(K,ba,W,L[ba])||this._composeMapLayers(K,ba,W,V,L,S,H)}};G.setBackground=function(K,H){p.releaseMaybe(this._backgroundTexture);
this._backgroundIsGrid=H;K instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(K),this._backgroundColor=null):(this._backgroundTexture=new D(v.createColorTexture(this._rctx,K)),this._backgroundColor=e.fromValues(K[0]||0,K[1]||0,K[2]||0,K[3]||0))};G._buildTexture=function(K,H=9987){if(p.isNone(K))return null;const J={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:H,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};H=this._rctx;let M;if("number"===
typeof K)J.width=J.height=K,M=new D(new c(H,J));else if(K instanceof A.ImageWithType)J.isOpaque=K.isOpaque,M=new D(new c(H,J,K.image)),K.release();else try{M=new D(new c(H,J,K))}catch(O){M=new D(v.createEmptyTexture(H)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}K=H.bindTexture(M.texture,c.TEXTURE_UNIT_FOR_UPDATES);M.generateMipmap();H.bindTexture(K,c.TEXTURE_UNIT_FOR_UPDATES);return M};G._drawQuad=function(K){this._rctx.bindVAO(this._vaoQuad);
K.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(5,0,E.vertexCount(this._vaoQuad,"geometry"))};G._drawRasterData=function(K,H,J,M,O=1){if(!p.isNone(H)){var Q=this._rctx,S=K.program;Q.setPipelineState(K.pipeline);Q.useProgram(S);S.bindTexture(H,"tex");S.setUniform1f("scale",J);S.setUniform2f("offset",M[0],M[1]);S.setUniform1f("opacity",O);this._drawQuad(S)}};G.hasNearestInterpolation=function(K){K=K.sourceLayerInfo.data;return p.isNone(K)||!K.source?!1:"nearest"===K.interpolation};
G._drawImageryTileData=function(K,H=1){const J=K.sourceLayerInfo.data;if(!p.isNone(J)&&J.source){K.tile.surface.layerViewByIndex(K.layerIndex,1).ensureSymbolizerParameters(J);var M=this._getRasterColorizerTechnique(J.symbolizerParameters.type,!!J.symbolizerParameters.colormap),O=this._rctx,Q=M.program;O.setPipelineState(M.pipeline);O.useProgram(Q);if(J.bind(O)){J.opacity=H;J.scale=K.scale;J.offset=K.offset;var {names:S,textures:V}=J.getTextures();S.forEach((Y,W)=>Q.bindTexture(V[W],Y));M.bindPass(J.getUniforms());
this._drawQuad(Q);O.bindVAO()}}};G._getRasterColorizerTechnique=function(K,H){K=["stretch","lut","hillshade"].indexOf(K);this._rasterColorizerConfig||(this._rasterColorizerConfig=new y.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=K;this._rasterColorizerConfig.applyColormap=H;return this._rasterColorizerTechnique=this._techniqueRep.releaseAndAcquire(y.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};G._drawVectorData=function(K,H,J,M,O,Q,S){const V=H.sourceLayerInfo.data;if(p.isNone(V))return S;const Y=this._rctx,W=H.tile.surface.layerViewByIndex(H.layerIndex,1);let ba;Y.setPipelineState(K.pipeline);1>M?(ba=this._fboPool.acquire(O),Y.bindFramebuffer(ba),Y.setClearColor(1,1,1,0),Y.clearSafe(16640)):S&&Y.clearSafe(256);this._vectorTileHelper.render(Y,H.sourceLod,V,W.painter,W.layer.styleRepository,W.schemaHelper,Math.round(1/H.scale),
H.offset,this.tileSize,J);return p.isSome(ba)?(Y.bindFramebuffer(Q),this._drawRasterData(K,ba.colorTexture,1,[0,0],M),this._fboPool.release(ba),S):!0};G._useBackgroundTexture=function(K,H){K.renderData.opacity=K.surface.baseOpacity;K.renderData.compositeBackgroundInShader=!1;K.renderData.layerOpacity=1;K.renderData.baseOpacity=1;K.renderData.setTextureReference(this._backgroundTexture,0,0,1,H)};G._useLayerTexture=function(K,H,J,M){J=H<J;K.renderData.opacity=J?1:K.surface.baseOpacity;K.renderData.compositeBackgroundInShader=
!0;K.renderData.layerOpacity=M;K.renderData.baseOpacity=J?K.surface.baseOpacity:1;H=F(K,H,N);return this._dataToTexture(H)?(M=H.offset,K.renderData.setTextureReference(H.sourceLayerInfo.data,M[0],M[1],H.scale),!0):!1};G._composeMapLayers=function(K,H,J,M,O,Q,S){const V=this._rctx,Y=this._fboPool.acquire(Q);V.bindFramebuffer(Y);V.setViewport(0,0,Q,Q);V.setClearColor(0,0,0,0);V.setClearDepth(1);V.clearSafe(16640);let W=!1;!M&&p.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,
this._backgroundTexture.texture,1,w.ZEROS);M=K.surface.baseOpacity;let ba=!1,ca=9987;for(;0<=H;H--){const da=F(K,H,N);da&&(H<J&&1>M&&!ba&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,w.ZEROS,M),ba=!0),0!==O[H]&&(x.isVectorTileRenderInfo(da)?W=this._drawVectorData(this._blendLayersTechnique,da,S,O[H],Q,Y,W):x.isImageryTileRenderInfo(da)?(this._drawImageryTileData(da,O[H]),this.hasNearestInterpolation(da)&&(ca=9728)):this._dataToTexture(da)&&p.isSome(da.sourceLayerInfo.data)&&
this._drawRasterData(this._blendLayersTechnique,da.sourceLayerInfo.data.texture,da.scale,da.offset,O[H])))}J=K.renderData.ensureTexture(Q,()=>this._buildTexture(Q,ca));O=V.bindTexture(J.texture,c.TEXTURE_UNIT_FOR_UPDATES);S=J.descriptor;V.gl.copyTexImage2D(V.gl.TEXTURE_2D,0,S.pixelFormat,0,0,S.width,S.height,0);J.generateMipmap();V.bindTexture(O,c.TEXTURE_UNIT_FOR_UPDATES);V.bindFramebuffer(null);this._fboPool.release(Y);K.renderData.opacity=ba?1:M;K.renderData.compositeBackgroundInShader=!1;K.renderData.layerOpacity=
1;K.renderData.baseOpacity=1;K.renderData.setTextureReference(J,0,0,1)};G._dataToTexture=function(K){x.isRasterTileRenderInfo(K)&&this._rasterDataToTexture(K);return x.isTextureTileRenderInfo(K)};G._rasterDataToTexture=function(K){const H=K.sourceLayerInfo;H.data=this._buildTexture(H.data);K.tile.setMemoryDirty()};G._cleanupFBOPool=function(K,H){if(K!==this._lastPixelRatio||H!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=K,this._lastNumLayers=H};u._createClass(I,[{key:"backgroundIsGrid",
get:function(){return this._backgroundIsGrid}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return I}();const L=[],N={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};a.TileRenderer=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry","../../../../Viewpoint",
"../../ViewState","../../../../geometry/Point"],function(a,u,f,p,t){u=function(){function w(){this._renderParams={context:null,drawPhase:1,state:new p({viewpoint:new f({targetGeometry:new t(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,
hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var e=w.prototype;e.dispose=function(){this._renderParams=null};e.render=function(n,b,h,k,l,m,z,r,c,d){const g=m.adjustLevel(b[0]),A=this._renderParams;A.context=n;A.painter=k;A.glyphMosaic=k.glyphMosaic;A.spriteMosaic=k.spriteMosaic;A.pixelRatio=d;A.displayLevel=g;A.requiredLevel=g;d=m.getScale(b[0]);const [q,y]=m.getShift(b,z*d);b=.125*z*d/c;m=h.transforms.dvs;m[0]=b;m[4]=-b;m[6]=-1-q-r[0]*z*2;m[7]=
1+y+(1-r[1])*z*2-2;A.state.size[0]=c;A.state.size[1]=c;h.stage||h.attachWithContext(n);h.triangleCount=0;k.drawTile(A,h,l)};return w}();a.VectorTileRendererHelper3D=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Point ../../geometry/Extent".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C){var B;const v=[0,0];f=B=function(E){function F(N){N=E.call(this,N)||this;N._viewpoint2D={center:q.create(),rotation:0,scale:0,spatialReference:null};N.center=[0,0];N.extent=new C;N.id=0;N.inverseTransform=r.create();N.resolution=0;N.rotation=0;N.scale=0;N.transform=r.create();N.transformNoRotation=r.create();N.displayMat3=d.create();N.displayViewMat3=d.create();N.viewMat3=d.create();N.viewMat2d=z.create();N.worldScreenWidth=0;N.size=[0,0];
return N}a._inheritsLoose(F,E);var L=F.prototype;L.copy=function(N){const I=this.size,G=this.viewpoint;G&&I?(this.viewpoint=x.copy(G,N.viewpoint),this._set("size",g.copy(I,N.size))):(this.viewpoint=N.viewpoint.clone(),this._set("size",[N.size[0],N.size[1]]));this._set("pixelRatio",N.pixelRatio);return this};L.clone=function(){return new B({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};L.toMap=function(N,I,G){if(y.isVec2(I))return g.transformMat2d(N,I,this.inverseTransform);
v[0]=I;v[1]=G;return g.transformMat2d(N,v,this.inverseTransform)};L.toScreen=function(N,I,G){if(y.isVec2(I))return g.transformMat2d(N,I,this.transform);v[0]=I;v[1]=G;return g.transformMat2d(N,v,this.transform)};L.toScreenNoRotation=function(N,I,G){if(y.isVec2(I))return g.transformMat2d(N,I,this.transformNoRotation);v[0]=I;v[1]=G;return g.transformMat2d(N,v,this.transformNoRotation)};L.getScreenTransform=function(N,I){const {center:G}=this._viewpoint2D,K=this._get("pixelRatio")||1,H=this._get("size");
x.getMatrix(N,G,H,I,0,K);return N};L._update=function(){const {center:N,spatialReference:I,scale:G,rotation:K}=this._viewpoint2D,H=this._get("pixelRatio")||1,J=this._get("size"),M=new p({targetGeometry:new D(N[0],N[1],I),scale:G,rotation:K});this._set("viewpoint",M);if(J&&I&&G){this.resolution=x.getResolution(M);this.rotation=K;this.scale=G;this.spatialReference=I;g.copy(this.center,N);c.set(this.displayMat3,0!==J[0]?2/J[0]:0,0,0,0,0!==J[1]?-2/J[1]:0,0,-1,1,1);var O=c.identity(this.viewMat3),Q=A.fromValues(J[0]/
2,J[1]/2),S=A.fromValues(-J[0]/2,-J[1]/2),V=l.toRadian(K);c.translate(O,O,Q);c.rotate(O,O,V);c.translate(O,O,S);c.multiply(this.displayViewMat3,this.displayMat3,O);O=m.identity(this.viewMat2d);m.translate(O,O,Q);m.rotate(O,O,V);m.translate(O,O,S);x.getExtent(this.extent,M,J);x.getTransform(this.transform,M,J,H);m.invert(this.inverseTransform,this.transform);x.getTransformNoRotation(this.transformNoRotation,M,J,H);this.worldScreenWidth=x.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(F,[{key:"pixelRatio",set:function(N){this._set("pixelRatio",N);this._update()}},{key:"size",set:function(N){this._set("size",N);this._update()}},{key:"viewpoint",set:function(N){if(N){const I=this._viewpoint2D,G=N.targetGeometry;I.center[0]=G.x;I.center[1]=G.y;I.rotation=N.rotation;I.scale=N.scale;I.spatialReference=G.spatialReference}this._update()}}]);return F}(t.JSONSupport);u.__decorate([w.property({readOnly:!0})],f.prototype,"id",void 0);u.__decorate([w.property({value:1,
json:{write:!0}})],f.prototype,"pixelRatio",null);u.__decorate([w.property({json:{write:!0}})],f.prototype,"size",null);u.__decorate([w.property({type:p,json:{write:!0}})],f.prototype,"viewpoint",null);return f=B=u.__decorate([k.subclass("esri.views.2d.ViewState")],f)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,u){function f(C,B){C[0]=B[0];C[1]=B[1];C[2]=B[2];C[3]=B[3];C[4]=B[4];C[5]=B[5];return C}function p(C){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=0;C[5]=0;return C}function t(C,
B,v,E,F,L,N){C[0]=B;C[1]=v;C[2]=E;C[3]=F;C[4]=L;C[5]=N;return C}function w(C,B){const v=B[0],E=B[1],F=B[2],L=B[3],N=B[4];B=B[5];let I=v*L-E*F;if(!I)return null;I=1/I;C[0]=L*I;C[1]=-E*I;C[2]=-F*I;C[3]=v*I;C[4]=(F*B-L*N)*I;C[5]=(E*N-v*B)*I;return C}function e(C){return C[0]*C[3]-C[1]*C[2]}function n(C,B,v){const E=B[0],F=B[1],L=B[2],N=B[3],I=B[4];B=B[5];const G=v[0],K=v[1],H=v[2],J=v[3],M=v[4];v=v[5];C[0]=E*G+L*K;C[1]=F*G+N*K;C[2]=E*H+L*J;C[3]=F*H+N*J;C[4]=E*M+L*v+I;C[5]=F*M+N*v+B;return C}function b(C,
B,v){const E=B[0],F=B[1],L=B[2],N=B[3],I=B[4];B=B[5];const G=Math.sin(v);v=Math.cos(v);C[0]=E*v+L*G;C[1]=F*v+N*G;C[2]=E*-G+L*v;C[3]=F*-G+N*v;C[4]=I;C[5]=B;return C}function h(C,B,v){const E=B[1],F=B[2],L=B[3],N=B[4],I=B[5],G=v[0];v=v[1];C[0]=B[0]*G;C[1]=E*G;C[2]=F*v;C[3]=L*v;C[4]=N;C[5]=I;return C}function k(C,B,v){const E=B[0],F=B[1],L=B[2],N=B[3],I=B[4];B=B[5];const G=v[0];v=v[1];C[0]=E;C[1]=F;C[2]=L;C[3]=N;C[4]=E*G+L*v+I;C[5]=F*G+N*v+B;return C}function l(C,B){const v=Math.sin(B);B=Math.cos(B);
C[0]=B;C[1]=v;C[2]=-v;C[3]=B;C[4]=0;C[5]=0;return C}function m(C,B){C[0]=B[0];C[1]=0;C[2]=0;C[3]=B[1];C[4]=0;C[5]=0;return C}function z(C,B){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=B[0];C[5]=B[1];return C}function r(C){return"mat2d("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+")"}function c(C){return Math.sqrt(C[0]**2+C[1]**2+C[2]**2+C[3]**2+C[4]**2+C[5]**2+1)}function d(C,B,v){C[0]=B[0]+v[0];C[1]=B[1]+v[1];C[2]=B[2]+v[2];C[3]=B[3]+v[3];C[4]=B[4]+v[4];C[5]=B[5]+v[5];return C}function g(C,B,v){C[0]=
B[0]-v[0];C[1]=B[1]-v[1];C[2]=B[2]-v[2];C[3]=B[3]-v[3];C[4]=B[4]-v[4];C[5]=B[5]-v[5];return C}function A(C,B,v){C[0]=B[0]*v;C[1]=B[1]*v;C[2]=B[2]*v;C[3]=B[3]*v;C[4]=B[4]*v;C[5]=B[5]*v;return C}function q(C,B,v,E){C[0]=B[0]+v[0]*E;C[1]=B[1]+v[1]*E;C[2]=B[2]+v[2]*E;C[3]=B[3]+v[3]*E;C[4]=B[4]+v[4]*E;C[5]=B[5]+v[5]*E;return C}function y(C,B){return C[0]===B[0]&&C[1]===B[1]&&C[2]===B[2]&&C[3]===B[3]&&C[4]===B[4]&&C[5]===B[5]}function x(C,B){const v=C[0],E=C[1],F=C[2],L=C[3],N=C[4];C=C[5];const I=B[0],
G=B[1],K=B[2],H=B[3],J=B[4];B=B[5];return Math.abs(v-I)<=u.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(E-G)<=u.EPSILON*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(F-K)<=u.EPSILON*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(L-H)<=u.EPSILON*Math.max(1,Math.abs(L),Math.abs(H))&&Math.abs(N-J)<=u.EPSILON*Math.max(1,Math.abs(N),Math.abs(J))&&Math.abs(C-B)<=u.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))}var D=Object.freeze({__proto__:null,copy:f,identity:p,set:t,invert:w,determinant:e,multiply:n,
rotate:b,scale:h,translate:k,fromRotation:l,fromScaling:m,fromTranslation:z,str:r,frob:c,add:d,subtract:g,multiplyScalar:A,multiplyScalarAndAdd:q,exactEquals:y,equals:x,mul:n,sub:g});a.add=d;a.copy=f;a.determinant=e;a.equals=x;a.exactEquals=y;a.frob=c;a.fromRotation=l;a.fromScaling=m;a.fromTranslation=z;a.identity=p;a.invert=w;a.mat2d=D;a.mul=n;a.multiply=n;a.multiplyScalar=A;a.multiplyScalarAndAdd=q;a.rotate=b;a.scale=h;a.set=t;a.str=r;a.sub=g;a.subtract=g;a.translate=k})},"esri/chunks/mat2df32":function(){define(["exports"],
function(a){function u(){const b=new Float32Array(6);b[0]=1;b[3]=1;return b}function f(b){const h=new Float32Array(6);h[0]=b[0];h[1]=b[1];h[2]=b[2];h[3]=b[3];h[4]=b[4];h[5]=b[5];return h}function p(b,h,k,l,m,z){const r=new Float32Array(6);r[0]=b;r[1]=h;r[2]=k;r[3]=l;r[4]=m;r[5]=z;return r}function t(b,h){return new Float32Array(b,h,6)}function w(b,h,k,l){const m=h[l];h=h[l+1];b[l]=k[0]*m+k[2]*h+k[4];b[l+1]=k[1]*m+k[3]*h+k[5]}function e(b,h,k,l=0,m=0,z=2){for(m=m||h.length/z;l<m;l++)w(b,h,k,l*z)}var n=
Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t,transform:w,transformMany:e});a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat2df32=n;a.transform=w;a.transformMany=e})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function u(){return[1,0,0,1,0,0]}function f(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function p(e,n,b,h,k,l){return[e,n,b,h,k,l]}function t(e,n){return new Float64Array(e,n,6)}var w=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,
createView:t});a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.mat2df64=w})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function u(p){return p instanceof Float32Array&&2<=p.length}function f(p){return Array.isArray(p)&&2<=p.length}a.isVec2=function(p){return u(p)||f(p)};a.isVec2f32=u;a.isVec2f64=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/Ellipsoid ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){function A(P,X,aa,ja){return ja&&aa&&!ja.equals(aa)&&g.canProject(ja,aa)&&ja.isWebMercator?(ja.isWebMercator?(aa=X[1],89.99999<aa?aa=89.99999:-89.99999>aa&&(aa=-89.99999),aa=Math.sin(e.toRadian(aa)),P=h.set(P,e.toRadian(X[0])*c.earth.radius,.5*c.earth.radius*Math.log((1+aa)/(1-aa)))):(aa=e.toDegree(X[0]/c.earth.radius),P=h.set(P,aa-360*Math.floor((aa+180)/360),e.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*X[1]/c.earth.radius))))),P):h.copy(P,X)}function q(P){return P.wkid?
P:P.spatialReference||r.WGS84}function y(P,X){return X.type?h.set(P,X.x,X.y):h.copy(P,X)}function x(P,X){return Math.max(P.width/X[0],P.height/X[1])*G(P.spatialReference)}function D(P,X,aa,ja){return C.apply(this,arguments)}function C(){C=u._asyncToGenerator(function*(P,X,aa,ja){if(!P||Array.isArray(P)&&!P.length)return null;p.isCollection(P)&&(P=P.toArray());if(Array.isArray(P)&&P.length&&"object"===typeof P[0]){var ia=P.every(Da=>"attributes"in Da);var ka=P.some(Da=>!Da.geometry),na=P;if(ia&&ka&&
X&&X.allLayerViews){ia=new Map;for(var ta of P)P=ta.layer,ka=ia.get(P)||[],na=ta.attributes[P.objectIdField],null!=na&&ka.push(na),ia.set(P,ka);const Da=[];ia.forEach((Ka,Fa)=>{const Ha=X.allLayerViews.find(ua=>ua.layer.id===Fa.id);if("queryFeatures"in Ha){const ua=Fa.createQuery();ua.objectIds=Ka;ua.returnGeometry=!0;Da.push(Ha.queryFeatures(ua))}});ta=yield Promise.all(Da);P=[];for(var pa of ta)if(pa&&pa.features&&pa.features.length)for(var xa of pa.features)t.isSome(xa.geometry)&&P.push(xa.geometry);
na=P}for(const Da of na)ja=yield D(Da,X,aa,ja);return ja}if(Array.isArray(P)&&2===P.length&&"number"===typeof P[0]&&"number"===typeof P[1])ia=new z(P);else if(P instanceof m)ia=P;else if("geometry"in P)if(P.geometry)ia=P.geometry;else if(P.layer){const Da=P.layer;pa=X.allLayerViews.find(Ka=>Ka.layer.id===Da.id);"queryFeatures"in pa&&(xa=Da.createQuery(),xa.objectIds=[P.attributes[Da.objectIdField]],xa.returnGeometry=!0,pa=yield pa.queryFeatures(xa),ia=t.get(pa,"features",0,"geometry"))}if(t.isNone(ia))return null;
pa="point"===ia.type?new l({xmin:ia.x,ymin:ia.y,xmax:ia.x,ymax:ia.y,spatialReference:ia.spatialReference}):ia.extent;if(!pa)return null;xa=g.canProject(pa,aa);if(!pa.spatialReference.equals(aa)&&xa)pa=g.project(pa,aa);else if(!xa)return null;return ja=ja?ja.union(pa):pa.clone()});return C.apply(this,arguments)}function B(P){if(P&&(!Array.isArray(P)||"number"!==typeof P[0])&&("object"===typeof P||Array.isArray(P)&&"object"===typeof P[0])){if("layer"in P&&P.layer&&P.layer.minScale&&P.layer.maxScale){var X=
P.layer;return{min:X.minScale,max:X.maxScale}}if(Array.isArray(P)&&P.length&&P.every(aa=>"layer"in aa)){let aa=X=0;for(const ja of P)(P=ja.layer)&&P.minScale&&P.maxScale&&(X=P.minScale<X?P.minScale:X,aa=P.maxScale>aa?P.maxScale:aa);return X&&aa?{min:X,max:aa}:null}}}function v(P,X){return E.apply(this,arguments)}function E(){E=u._asyncToGenerator(function*(P,X){if(!P||!X)return new f({targetGeometry:new z,scale:0,rotation:0});let aa=X.spatialReference;const {constraints:ja,padding:ia,viewpoint:ka,
size:na}=X,ta=[ia?na[0]-ia.left-ia.right:na[0],ia?na[1]-ia.top-ia.bottom:na[1]];let pa=null;P instanceof f?pa=P:P.viewpoint?pa=P.viewpoint:P.target&&"esri.Viewpoint"===P.target.declaredClass&&(pa=P.target);let xa=null;if(pa&&pa.targetGeometry)xa=pa.targetGeometry;else if(P instanceof l)xa=P;else if(P||P&&("center"in P||"extent"in P||"target"in P))xa=(yield D(P.center,X,aa))||(yield D(P.extent,X,aa))||(yield D(P.target,X,aa))||(yield D(P,X,aa));!xa&&ka&&ka.targetGeometry?xa=ka.targetGeometry:!xa&&
X.extent&&(xa=X.extent);var Da=q(xa);aa||(aa=q(X.spatialReference||X.extent||xa));if(!g.canProject(xa,aa)&&Da&&!Da.equals(aa))return null;var Ka=y(k.create(),xa.center?xa.center:xa);Da=new z(A(Ka,Ka,Da,aa),aa);Ka=null;Ka=pa&&t.isSome(pa.targetGeometry)&&"point"===pa.targetGeometry.type?pa.scale:P.hasOwnProperty("scale")&&P.scale?P.scale:P.hasOwnProperty("zoom")&&-1!==P.zoom&&ja&&ja.effectiveLODs?ja.zoomToScale(P.zoom):Array.isArray(xa)||"point"===xa.type||"extent"===xa.type&&0===xa.width&&0===xa.height?
X.extent&&g.canProject(X.extent,aa)?x(g.project(X.extent,aa),ta):X.extent?x(X.extent,ta):ka.scale:g.canProject(xa.extent,aa)?x(g.project(xa.extent,aa),ta):x(xa.extent,ta);if(X=B(P))X.min&&X.min>Ka?Ka=X.min:X.max&&X.max<Ka&&(Ka=X.max);X=0;pa?X=pa.rotation:P.hasOwnProperty("rotation")?X=P.rotation:ka&&(X=ka.rotation);P=new f({targetGeometry:Da,scale:Ka,rotation:X});ja&&(P=ja.fit(P),ja.constrainByGeometry(P),ja.rotationEnabled||(P.rotation=X));return P});return E.apply(this,arguments)}function F(P,X){const aa=
P.targetGeometry,ja=X.targetGeometry;aa.x=ja.x;aa.y=ja.y;aa.spatialReference=ja.spatialReference;P.scale=X.scale;P.rotation=X.rotation;return P}function L(P,X,aa){return aa?h.set(P,.5*(X[0]-aa.right+aa.left),.5*(X[1]-aa.bottom+aa.top)):h.scale(P,X,.5)}function N(P,X,aa,ja){S(P,X,aa,ja);return n.invert(P,P)}function I(P){var X=P.scale;P=P.targetGeometry;P=t.isSome(P)&&d.isValid(P.spatialReference)?1/(39.37*w.getMetersPerUnitForSR(P.spatialReference)*96):1;return X*P}function G(P){return d.isValid(P)?
39.37*w.getMetersPerUnitForSR(P)*96:1}function K(P){return P.isWrappable?(P=d.getInfo(P),P.valid[1]-P.valid[0]):0}const H=180/Math.PI,J=function(){const P=k.create();return function(X,aa,ja){const ia=aa.targetGeometry;y(P,ia);aa=.5*I(aa);X.xmin=P[0]-aa*ja[0];X.ymin=P[1]-aa*ja[1];X.xmax=P[0]+aa*ja[0];X.ymax=P[1]+aa*ja[1];X.spatialReference=ia.spatialReference;return X}}(),M=function(){const P=k.create();return function(X,aa,ja){return h.sub(X,h.scale(X,aa,.5),L(P,aa,ja))}}(),O=function(){const P=b.create(),
X=k.create();return function(aa,ja,ia,ka){const na=I(ja);ja=e.toRadian(ja.rotation)||0;h.set(X,na,na);n.fromScaling(P,X);n.rotate(P,P,ja);n.translate(P,P,M(X,ia,ka));n.translate(P,P,[0,ka.top-ka.bottom]);return h.set(aa,P[4],P[5])}}(),Q=function(){const P=k.create(),X=k.create(),aa=k.create();return function(ja,ia,ka,na,ta,pa){h.negate(P,ia);h.scale(X,ka,.5*pa);h.set(aa,1/na*pa,-1/na*pa);n.identity(ja);n.translate(ja,ja,X);ta&&n.rotate(ja,ja,ta);n.scale(ja,ja,aa);n.translate(ja,ja,P);return ja}}(),
S=function(){const P=k.create();return function(X,aa,ja,ia){const ka=I(aa),na=e.toRadian(aa.rotation)||0;y(P,aa.targetGeometry);return Q(X,P,ja,ka,na,ia)}}(),V=function(){const P=k.create();return function(X,aa,ja,ia){const ka=I(aa);y(P,aa.targetGeometry);return Q(X,P,ja,ka,0,ia)}}(),Y=function(){const P=k.create(),X=k.create(),aa=[0,0,0];return function(ja,ia,ka){h.subtract(P,ja,ia);h.normalize(P,P);h.subtract(X,ja,ka);h.normalize(X,X);h.cross(aa,P,X);ja=Math.acos(h.dot(P,X)/(h.length(P)*h.length(X)))*
H;0>aa[2]&&(ja=-ja);isNaN(ja)&&(ja=0);return ja}}(),W=function(){const P=k.create();return function(X,aa,ja,ia){const ka=X.targetGeometry;F(X,aa);O(P,aa,ja,ia);ka.x+=P[0];ka.y+=P[1];return X}}(),ba=function(){const P=k.create();return function(X,aa,ja,ia){const ka=X.targetGeometry;F(X,aa);O(P,aa,ja,ia);ka.x-=P[0];ka.y-=P[1];return X}}(),ca=function(){const P=k.create();return function(X,aa,ja){F(X,aa);aa=X.targetGeometry;const ia=q(ja),ka=q(aa);y(P,ja);A(P,P,ia,ka);aa.x=P[0];aa.y=P[1];return X}}(),
da=function(){const P=k.create();return function(X,aa,ja,ia,ka){ka||(ka="center");h.sub(P,ja,ia);h.scale(P,P,.5);ja=P[0];ia=P[1];switch(ka){case "center":h.set(P,0,0);break;case "left":h.set(P,-ja,0);break;case "top":h.set(P,0,ia);break;case "right":h.set(P,ja,0);break;case "bottom":h.set(P,0,-ia);break;case "top-left":h.set(P,-ja,ia);break;case "bottom-left":h.set(P,-ja,-ia);break;case "top-right":h.set(P,ja,ia);break;case "bottom-right":h.set(P,ja,-ia)}T(X,aa,P);return X}}(),ha=function(){const P=
k.create();return function(X,aa,ja,ia,ka){F(X,aa);isNaN(ja)||0===ja||(U(P,ia,aa,ka),X.scale=aa.scale*ja,Z(P,P,X,ka),T(X,X,h.set(P,P[0]-ia[0],ia[1]-P[1])));return X}}(),fa=function(){const P=k.create();return function(X,aa,ja,ia,ka,na){F(X,aa);isNaN(ja)||0===ja||(U(P,ka,aa,na),X.scale=aa.scale*ja,X.rotation+=ia,Z(P,P,X,na),T(X,X,h.set(P,P[0]-ka[0],ka[1]-P[1])));return X}}(),R=function(){const P=k.create(),X=k.create();return function(aa,ja,ia,ka,na,ta,pa){M(X,ta,pa);h.add(P,na,X);return ka?fa(aa,ja,
ia,ka,P,ta):ha(aa,ja,ia,P,ta)}}(),U=function(){const P=b.create();return function(X,aa,ja,ia){return h.transformMat2d(X,aa,N(P,ja,ia,1))}}(),Z=function(){const P=b.create();return function(X,aa,ja,ia){return h.transformMat2d(X,aa,S(P,ja,ia,1))}}(),T=function(){const P=k.create(),X=b.create();return function(aa,ja,ia){F(aa,ja);const ka=I(ja),na=aa.targetGeometry;n.fromRotation(X,e.toRadian(ja.rotation)||0);n.scale(X,X,k.fromValues(ka,ka));h.transformMat2d(P,ia,X);na.x+=P[0];na.y+=P[1];return aa}}();
a.addPadding=W;a.angleBetween=Y;a.centerAt=ca;a.copy=F;a.create=v;a.createAsync=function(P,X){return v(P,X)};a.extentToScale=x;a.getAnchor=L;a.getExtent=J;a.getMatrix=Q;a.getOuterSize=function(P,X,aa){var ja=e.toRadian(X.rotation)||0;X=Math.abs(Math.cos(ja));ja=Math.abs(Math.sin(ja));return h.set(P,Math.round(aa[1]*ja+aa[0]*X),Math.round(aa[1]*X+aa[0]*ja))};a.getPaddingMapTranslation=O;a.getPaddingScreenTranslation=M;a.getResolution=I;a.getResolutionToScaleFactor=G;a.getTransform=S;a.getTransformNoRotation=
V;a.getWorldScreenWidth=function(P,X){return Math.round(K(P)/X)};a.getWorldWidth=K;a.padAndScaleAndRotateBy=R;a.pixelSize=function(P){return I(P)};a.removePadding=ba;a.resize=da;a.rotateBy=function(P,X,aa){F(P,X);P.rotation+=aa;return P};a.rotateTo=function(P,X,aa){F(P,X);P.rotation=aa;return P};a.scaleAndRotateBy=fa;a.scaleBy=ha;a.scaleTo=function(P,X,aa){F(P,X);P.scale=aa;return P};a.setExtent=function(P,X,aa,ja,ia){ca(P,X,aa.center);P.scale=x(aa,ja);ia&&ia.constraints&&ia.constraints.constrain(P);
return P};a.toMap=U;a.toScreen=Z;a.translateBy=T;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){e=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build();return new h.Program(r.rctx,c,b.Default3D)};z.initializePipeline=function(){const r=2===this.configuration.mode?k.simpleBlendingParams(1,771):1===this.configuration.mode?k.simpleBlendingParams(0,770):null;return k.makePipelineState({blending:r,colorWrite:k.defaultColorWriteParams})};return m}(e.ShaderTechnique);
e.shader=new w.ReloadableShaderModule(t.BlendLayersShader,()=>new Promise(function(l,m){a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.mode=0;return z}f._inheritsLoose(m,l);return m}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter({count:3})],t.prototype,"mode",void 0);u.BlendLayersTechnique=e;u.BlendLayersTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/BlendLayers.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f){function p(){const w=new f.ShaderBuilder;w.attributes.add("position","vec2");w.attributes.add("uv0","vec2");w.vertex.uniforms.add("scale","float");w.vertex.uniforms.add("offset","vec2");w.varyings.add("uv","vec2");w.vertex.code.add(u.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`);w.fragment.uniforms.add("tex","sampler2D");w.fragment.uniforms.add("opacity","float");w.fragment.code.add(u.glsl`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`);return w}var t=Object.freeze({__proto__:null,build:p});a.BlendLayersShader=t;a.build=p})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/rasterUtils ../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){n=function(z){function r(){return z.apply(this,arguments)||this}f._inheritsLoose(r,z);var c=r.prototype;c.initializeProgram=function(d){var g=r.shader.get();const A=this.configuration;g=g.build({output:A.colorizerType,applyColormap:A.applyColormap});this._context=d.rctx;return new k.Program(d.rctx,g,h.Default3D)};c.initializePipeline=function(){const d=2===this.configuration.mode?m.simpleBlendingParams(1,771):1===this.configuration.mode?m.simpleBlendingParams(0,
770):null;return m.makePipelineState({blending:d,colorWrite:m.defaultColorWriteParams})};c.bindPass=function(d){l.setUniforms(this.program,this.uniformLocationInfos,d.basic);l.setUniforms(this.program,this.uniformLocationInfos,d.common);t.isSome(d.colormap)&&l.setUniforms(this.program,this.uniformLocationInfos,d.colormap);0===this.configuration.colorizerType&&t.isSome(d.stretch)?l.setUniforms(this.program,this.uniformLocationInfos,d.stretch):2===this.configuration.colorizerType&&t.isSome(d.hillshade)&&
l.setUniforms(this.program,this.uniformLocationInfos,d.hillshade)};f._createClass(r,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=l.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return r}(n.ShaderTechnique);n.shader=new e.ReloadableShaderModule(w.RasterColorizerShader,()=>new Promise(function(z,r){a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],z,r)}));w=function(z){function r(){var c=
z.apply(this,arguments)||this;c.mode=2;c.colorizerType=0;c.applyColormap=!0;return c}f._inheritsLoose(r,z);return r}(b.ShaderTechniqueConfiguration);p.__decorate([b.parameter({count:3})],w.prototype,"mode",void 0);p.__decorate([b.parameter({count:3})],w.prototype,"colorizerType",void 0);p.__decorate([b.parameter()],w.prototype,"applyColormap",void 0);u.RasterColorizerTechnique=n;u.RasterColorizerTechniqueConfiguration=w;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e){function n(h){const k=new e.ShaderBuilder;k.include(u.BasicGrid);k.include(p.Common);k.include(f.Colormap);0===h.output?(h=h.applyColormap,k.fragment.uniforms.add("u_bandCount","int"),k.fragment.uniforms.add("u_minCutOff","float",3),k.fragment.uniforms.add("u_maxCutOff","float",3),k.fragment.uniforms.add("u_factor","float",3),k.fragment.uniforms.add("u_minOutput","float"),k.fragment.uniforms.add("u_maxOutput","float"),k.fragment.uniforms.add("u_useGamma","bool"),k.fragment.uniforms.add("u_gamma",
"float",3),k.fragment.uniforms.add("u_gammaCorrection","float",3),k.fragment.code.add(w.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`),h=h?w.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:w.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`,k.fragment.code.add(w.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${h}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }
      }
    `)):1===h.output?k.fragment.code.add(w.glsl`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`):2===h.output&&(h=h.applyColormap,k.fragment.uniforms.add("u_hillshadeType","int"),k.fragment.uniforms.add("u_sinZcosAs","float",6),k.fragment.uniforms.add("u_sinZsinAs","float",6),k.fragment.uniforms.add("u_cosZs","float",6),k.fragment.uniforms.add("u_weights","float",6),k.fragment.uniforms.add("u_factor","vec2"),k.fragment.uniforms.add("u_applyColormap","bool"),k.fragment.uniforms.add("u_minValue","float"),k.fragment.uniforms.add("u_maxValue","float"),k.fragment.uniforms.add("u_srcImageSize",
"vec2"),k.fragment.include(t.ColorConversion),k.fragment.code.add(w.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),k.fragment.code.add(w.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`),h=h?w.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:w.glsl`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`,k.fragment.code.add(w.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${h}
    }
  `));return k}var b=Object.freeze({__proto__:null,build:n});a.RasterColorizerShader=b;a.build=n})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.BasicGrid=function(f){f.attributes.add("position","vec2");f.attributes.add("uv0","vec2");f.vertex.uniforms.add("u_scale","float");f.vertex.uniforms.add("u_offset","vec2");f.varyings.add("v_texcoord","vec2");f.vertex.code.add(u.glsl`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Colormap=function(f){f.fragment.uniforms.add("u_colormap","sampler2D");f.fragment.uniforms.add("u_colormapOffset","float");f.fragment.uniforms.add("u_colormapMaxIndex","float");f.fragment.code.add(u.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","./Projection.glsl","../../shaderModules/interfaces"],function(a,u,f){a.Common=function(p){p.include(u.Projection);p.fragment.uniforms.add("u_image","sampler2D");p.fragment.uniforms.add("u_isFloatTexture","bool");p.fragment.uniforms.add("u_flipY","bool");p.fragment.uniforms.add("u_applyTransform","bool");p.fragment.uniforms.add("u_opacity","float");
p.fragment.code.add(f.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Projection=function(f){f.fragment.uniforms.add("u_transformGrid","sampler2D");f.fragment.uniforms.add("u_transformSpacing","vec2");f.fragment.uniforms.add("u_transformGridSize","vec2");f.fragment.uniforms.add("u_targetImageSize","vec2");f.fragment.code.add(u.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(a,u,f){let p=function(){function t(e){this.renderingContext=e;this._pools=new Map}var w=t.prototype;w.acquire=function(e){return this.getPool(e).acquire()};w.release=function(e){this.getPool(e.width).release(e)};w.clear=function(){this._pools.forEach(e=>e.destroy());this._pools.clear()};w.getPool=function(e){var n=
this._pools.get(e);n||(n=f.bind(f,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:e,height:e}),n=new u(n),this._pools.set(e,n));return n};return t}();a.FBOPool=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){e=function(m){function z(){return m.apply(this,arguments)||this}f._inheritsLoose(z,m);var r=z.prototype;r.initializeProgram=function(c){var d=z.shader.get();const g=this.configuration;d=d.build({overlayMode:g.overlayMode,output:g.output,viewingMode:c.viewingMode,slicePlaneEnabled:g.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:g.textureFadingEnabled&&!g.renderOccluded,hasBackgroundColor:g.hasBackgroundColor,useGrid:g.useGrid,
receiveShadows:g.receiveShadows&&!g.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:g.atmosphere,tileBorders:g.tileBorders,screenSizePerspective:g.screenSizePerspective,pbrMode:0,ssrEnabled:g.ssrEnabled,highStepCount:!1});return new h.Program(c.rctx,d,b.Default3D)};r.initializePipeline=function(){const c=this.configuration,d=c.backfaceCullingEnabled&&!c.renderOccluded;return l.makePipelineState({blending:c.renderOccluded?l.simpleBlendingParams(1,771):null,culling:d&&l.backFaceCullingParams,depthTest:!c.renderOccluded&&
{func:513},depthWrite:!c.renderOccluded&&l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams,stencilTest:c.stencilEnabled?k.renderWhenBitIsNotSet(1):null})};return z}(e.ShaderTechnique);e.shader=new w.ReloadableShaderModule(t.TerrainShader,()=>new Promise(function(m,z){a(["../core/shaderLibrary/terrain/Terrain.glsl"],m,z)}));t=function(m){function z(){var r=m.apply(this,arguments)||this;r.output=0;r.overlayMode=0;r.atmosphere=!1;r.receiveShadows=!1;r.slicePlaneEnabled=!1;r.backfaceCullingEnabled=
!1;r.stencilEnabled=!1;r.textureFadingEnabled=!1;r.hasBackgroundColor=!1;r.useGrid=!1;r.renderOccluded=!1;r.ssrEnabled=!1;r.tileBorders=!1;r.screenSizePerspective=!1;return r}f._inheritsLoose(z,m);return z}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter({count:8})],t.prototype,"output",void 0);p.__decorate([n.parameter({count:3})],t.prototype,"overlayMode",void 0);p.__decorate([n.parameter()],t.prototype,"atmosphere",void 0);p.__decorate([n.parameter()],t.prototype,"receiveShadows",void 0);
p.__decorate([n.parameter()],t.prototype,"slicePlaneEnabled",void 0);p.__decorate([n.parameter()],t.prototype,"backfaceCullingEnabled",void 0);p.__decorate([n.parameter()],t.prototype,"stencilEnabled",void 0);p.__decorate([n.parameter()],t.prototype,"textureFadingEnabled",void 0);p.__decorate([n.parameter()],t.prototype,"hasBackgroundColor",void 0);p.__decorate([n.parameter()],t.prototype,"useGrid",void 0);p.__decorate([n.parameter()],t.prototype,"renderOccluded",void 0);p.__decorate([n.parameter()],
t.prototype,"ssrEnabled",void 0);p.__decorate([n.parameter()],t.prototype,"tileBorders",void 0);p.__decorate([n.parameter()],t.prototype,"screenSizePerspective",void 0);u.TerrainTechnique=e;u.TerrainTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(d){const g=new z.ShaderBuilder;g.include(l.HeaderComment,{name:"Terrain Shader",output:d.output});g.include(h.Skirts);g.attributes.add("position","vec3");g.attributes.add("uv0","vec2");g.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===d.output){g.include(f.Transform,{linearDepth:!1});g.include(n.NormalUtils,d);g.include(k.TerrainTexture,d);const A=0!==d.overlayMode,q=2===d.overlayMode;A&&g.include(b.Overlay,
{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:d.ssrEnabled,highStepCount:d.highStepCount});q&&g.include(p.VertexTangent,d);g.varyings.add("vnormal","vec3");g.varyings.add("vpos","vec3");g.vertex.uniforms.add("viewNormal","mat4");d.receiveShadows&&g.varyings.add("linearDepth","float");d.tileBorders&&g.varyings.add("vuv","vec2");d.atmosphere&&(g.vertex.uniforms.add("lightingMainDirection","vec3"),g.varyings.add("wnormal","vec3"),g.varyings.add("wlight","vec3"));d.screenSizePerspective&&(g.vertex.uniforms.add("screenSizePerspective",
"vec4"),g.varyings.add("screenSizeDistanceToCamera","float"),g.varyings.add("screenSizeCosAngle","float"));g.vertex.code.add(m.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${d.atmosphere?m.glsl`
        wnormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        wlight = (view  * vec4(lightingMainDirection, 1.0)).xyz;`:""}
        ${d.tileBorders?m.glsl`vuv = uv;`:""}
        ${d.screenSizePerspective?m.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${d.receiveShadows?m.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${A?m.glsl`setOverlayVTC(uv);`:""}
        ${q?m.glsl`forwardVertexTangent(vnormal);`:m.glsl``}
      }
    `);g.extensions.add("GL_OES_standard_derivatives");g.extensions.add("GL_EXT_shader_texture_lod");g.include(u.Slice,d);g.include(e.EvaluateSceneLighting,d);g.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float");d.screenSizePerspective&&g.fragment.uniforms.add("screenSizePerspective","vec4");q&&(g.fragment.uniforms.add("ovWaterTex","sampler2D"),g.fragment.uniforms.add("view","mat4"));g.fragment.code.add(m.glsl`const vec3 ambient = vec3(0.2, 0.2, 0.2);
const vec3 diffuse = vec3(0.8, 0.8, 0.8);
const float diffuseHardness = 2.5;
const float sliceOpacity = 0.2;
float lum(vec3 c) {
float max = max(max(c.r, c.g), c.b);
float min = min(min(c.r, c.g), c.b);
return (min + max) * 0.5;
}`);d.atmosphere&&g.fragment.code.add(m.glsl`vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {
vec3 surfaceColor   = vec3(0.0);
vec3 fuzzySpecColor = vec3(1.0);
vec3 subColor       = vec3(0.0);
float rollOff       = 1.0;
vec3 Ln = normalize(lightPos);
vec3 Nn = normalize(normal);
vec3 Hn = normalize(view + Ln);
float ldn = dot(Ln, Nn);
float diffComp = max(0.0, ldn);
float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);
float ndv = dot(view, Ln);
vec3 diffContrib = surfaceColor * diffComp;
float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));
vec3 subContrib = subLamb * subColor;
vec3 vecColor = vec3(vdn);
vec3 diffuseContrib = (subContrib + diffContrib);
vec3 specularContrib = (vecColor * fuzzySpecColor);
return (diffContrib + specularContrib) * rollOff;
}`);g.fragment.code.add(m.glsl`
      void main() {
        ${d.receiveShadows?m.glsl`float shadow = readShadowMap(vpos, linearDepth);`:m.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);
        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));
        vec3 d = (1.0 - shadow/1.8) * diffuse * k;

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor() * opacity;
        ${A?m.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        vec3 atm = vec3(0.0);
        ${d.atmosphere?m.glsl`
            float ndotl = max(0.0, min(1.0, vndl));
            atm = atmosphere(wlight, wnormal, -viewDirection);
            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps
            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}
        vec3 albedo = atm + tileColor.rgb;
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${q?m.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${d.screenSizePerspective?m.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${d.tileBorders?m.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(1===d.output||3===d.output)g.include(f.Transform,{linearDepth:!0}),g.include(t.OutputDepth,{output:d.output}),g.include(n.NormalUtils,d),g.varyings.add("linearDepth","float"),g.vertex.uniforms.add("nearFar","vec2"),g.vertex.code.add(m.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),g.fragment.code.add(m.glsl`void main() {
outputDepth(linearDepth);
}`);2===d.output&&(g.include(f.Transform,{linearDepth:!1}),g.include(n.NormalUtils,d),g.varyings.add("vnormal","vec3"),g.varyings.add("vpos","vec3"),g.vertex.uniforms.add("viewNormal","mat4"),g.vertex.code.add(m.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),g.fragment.code.add(m.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));4===d.output&&(g.include(f.Transform,{linearDepth:!1}),g.include(n.NormalUtils,d),g.include(b.Overlay,{pbrMode:0}),g.vertex.code.add(m.glsl`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),g.include(w.OutputHighlight),g.fragment.code.add(m.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return g}var c=Object.freeze({__proto__:null,build:r});a.TerrainShader=c;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.VertexTangent=function(f,p){f.varyings.add("tbnTangent","vec3");f.varyings.add("tbnBiTangent","vec3");1===p.viewingMode?f.vertex.code.add(u.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):f.vertex.code.add(u.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);f.fragment.code.add(u.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../shading/EvaluateMainLighting.glsl","../shading/Water.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.Overlay=function(t,w){t.extensions.add("GL_OES_standard_derivatives");3!==w.pbrMode&&4!==w.pbrMode||t.include(f.Water,w);t.vertex.uniforms.add("overlayTexOffset","vec4");t.vertex.uniforms.add("overlayTexScale","vec4");t.varyings.add("vtcOverlay",
"vec4");t.vertex.code.add(p.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);t.fragment.uniforms.add("ovColorTex","sampler2D");t.fragment.uniforms.add("overlayOpacity","float");t.fragment.code.add(p.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);t.fragment.code.add(p.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(3===w.pbrMode||4===w.pbrMode)t.include(u.EvaluateMainLighting),t.fragment.code.add(p.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);
return vec4(final, colorInput.w);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.Skirts=function(f){f.vertex.code.add(u.glsl`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.TerrainTexture=function(f,p){f.varyings.add("vtc","vec2");f.vertex.uniforms.add("texOffsetAndScale","vec4");f.fragment.uniforms.add("tex","sampler2D");f.fragment.uniforms.add("compositeBackground","bool");f.fragment.uniforms.add("textureOpacity","float");f.fragment.uniforms.add("baseOpacity",
"float");p.textureFadingEnabled&&(f.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),f.varyings.add("nvtc","vec2"),f.fragment.uniforms.add("texNext","sampler2D"),f.fragment.uniforms.add("textureFadeFactor","float"));f.vertex.code.add(u.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${p.textureFadingEnabled?u.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:u.glsl``}
  }
  `);p.useGrid?(f.fragment.code.add(u.glsl`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}`),f.fragment.code.add(u.glsl`
    vec4 getTileColor() {
      vec4 color = ${p.textureFadingEnabled?u.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:u.glsl`texture2D(tex, vtc);`};
      if(!compositeBackground) {
        return color;
      }

      float line = lineFactor(vtc) * 0.1 + 0.9;
      vec4 gridColor = vec4(1.0, 0.972, 0.918, 1.0) * line * baseOpacity;
      float alpha = textureOpacity * color.a;
      return mix(gridColor, color, alpha);
    }`)):p.hasBackgroundColor?(f.fragment.uniforms.add("backgroundColor","vec4"),f.fragment.code.add(u.glsl`
    vec4 getTileColor() {
      vec4 color = ${p.textureFadingEnabled?u.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:u.glsl`texture2D(tex, vtc);`};
      float alpha = textureOpacity * color.a;
      return compositeBackground ? mix(backgroundColor * baseOpacity, color, alpha) : color;
    }`)):f.fragment.code.add(u.glsl`
    vec4 getTileColor() {
      return ${p.textureFadingEnabled?u.glsl`textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:u.glsl`texture2D(tex, vtc);`}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,u){let f=function(){function p(){this.offset=u.create();this.scale=0;this.tile=null}var t=
p.prototype;t.init=function(w,e,n,b){this.tile=w;this.offset[0]=e;this.offset[1]=n;this.scale=b};t.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return p}();a.UpsampleInfo=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x){var D;a.Stage=D=function(C){function B(E){E=C.call(this,E)||this;E._handles=new t;E._model=new q.Model;E._layers=new e;E._changeSet=new d.ChangeSet;E._layerSyncSet=new Set;return E}u._inheritsLoose(B,C);var v=B.prototype;v.initialize=function(){this._set("renderView",new y.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(x.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};v.destroy=function(){g.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};v.add=function(E){this._model.add(E);A.isWebGLLayer(E)&&(E.attachStage(this),this._addLayer(E));this.renderView.setNeedsRender()};v.remove=function(E){w.isNone(E)||(this.renderView.setNeedsRender(),this._model.remove(E),A.isWebGLLayer(E)&&(this._removeLayer(E),E.detachStage()))};v.addMany=function(E){w.isSome(E)&&(this._model.addMany(E),this.renderView.setNeedsRender())};v.removeMany=function(E){w.isSome(E)&&(this._model.removeMany(E),this.renderView.setNeedsRender())};
v.forEachOfType=function(E,F){this._model.forEachOfType(E,F)};v.handleEvent=function(E,F){this.destroyed||(this._model.dirtySet[E](F),this.renderView.setNeedsRender())};v.runTask=function(E){this._frameTask.processQueue(E);E.done||this._commit()};v._commit=function(){const E=this._model.dirtySet;D.DebugSettings.logDirtySet&&console.log("Dirty set: "+E.formatDebugInfo());E.commit(this._changeSet);D.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+
this._changeSet.removes.map(F=>F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.setNeedsRender()};v.schedule=function(E,F){return this._frameTask.schedule(E,F)};v.syncLayer=function(E){this._layerSyncSet.add(E);this.renderView.setNeedsRender()};v.processSyncLayers=function(){const E=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||1===F.updatePolicy)E.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)E.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};v.getObject=function(E){return this._model.getObject(E)};v._addLayer=function(E){this._layers.some(F=>F===E)||this._layers.push(E)};v._removeLayer=function(E){this._commit();null!=this._layers.removeUnordered(E)&&(this._model.dirtySet.getResidentRenderGeometries(E.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};v.addRenderPlugin=function(E,F,L){E=this.renderView.renderPlugins.add(E,F,L);L=()=>
{r.isIntersectionHandler(F)&&this.sceneIntersectionHelper.addIntersectionHandler(F)};if(n.isPromise(E))return E.then(L);L()};v.removeRenderPlugin=function(E){r.isIntersectionHandler(E)&&this.sceneIntersectionHelper.removeIntersectionHandler(E);this.renderView.renderPlugins.remove(E)};u._createClass(B,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating}},{key:"running",get:function(){return this._model.dirtySet.dirty}},
{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const E=this;return{getCount(F){return E._model.test.content.filter(L=>L.type===F).length},stopAnimations(F){return E._model.test.content.filter(L=>3===L.type).forEach(L=>w.applySome(L.animation,N=>N.stopAtTime(F)))},model:E._model}}}]);return B}(c.AutoDisposableMixin(p));a.Stage.DebugSettings={endFrameContentValidation:!1,
logDirtySet:!1};f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"resourceController",void 0);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);f.__decorate([b.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,
"container",void 0);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"renderSR",void 0);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);f.__decorate([b.property({readOnly:!0})],a.Stage.prototype,"updating",null);f.__decorate([b.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);f.__decorate([c.autoDispose(),b.property()],a.Stage.prototype,"renderView",void 0);a.Stage=D=f.__decorate([z.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../lib/localOrigin ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){const c=z.assert,d=z.logWithBase;a.Model=function(g){function A(){var y=g.call(this)||this;y.dirtySet=new l({model:u._assertThisInitialized(y)});y._id2origin=new Map;y._content=new Map;return y}u._inheritsLoose(A,g);var q=A.prototype;q.getObject=function(y){return this._content.get(y)};q.add=function(y){const x=y.id;c(!this._content.has(x),"Model/Stage already contains object to be added");this._content.set(x,y);r.isWebGLLayer(y)&&this.dirtySet.layerAdded(y)};
q.remove=function(y){c(this._content.has(y.id),"Model/Stage doesn't contain object to be removed");this._content.delete(y.id);y.unload();r.isWebGLLayer(y)&&this.dirtySet.layerRemoved(y)};q.addMany=function(y){for(const x of y)c(!this._content.has(x.id),"Model/Stage already contains object to be added"),this._content.set(x.id,x)};q.removeMany=function(y){for(const x of y)c(this._content.has(x.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(x.id),x.unload()};q.forEachOfType=
function(y,x){this._content.forEach(D=>{D.type===y&&x(D)})};q._getOrigin=function(y){var x=0,D=10*y[3]/1E4;1<D&&(x=Math.ceil(d(D,2)));D=1E4*2**x;const C=Math.round(y[0]/D),B=Math.round(y[1]/D);y=Math.round(y[2]/D);x=x+"_"+C+"_"+B+"_"+y;let v=this._id2origin.get(x);null==v&&(v=k.fromValues(C*D,B*D,y*D,x),this._id2origin.set(x,v));return v};q.getRenderGeometry=function(y,x){const {geometry:D,material:C,id:B,shaderTransformation:v,origin:E,instanceParameters:F}=x,L=new m.RenderGeometry(D,C,null,null,
B,D.boundingInfo,v,y.castShadow);L.updateTransformation(N=>y.getCombinedStaticTransformation(x,N));L.origin=E||this._getOrigin(L.boundingSphere);L.instanceParameters=F;return L};q.updateRenderGeometryTransformation=function(y,x,D){D.updateTransformation(B=>y.getCombinedStaticTransformation(x,B));const C=this._getOrigin(D.boundingSphere);return D.origin!==C};q.getStats=function(){const y={},x=Array.from(this._content.values());for(let D=0;5>D;++D)y[D]=x.filter(C=>C.type===D).length;return{contentTypes:y,
dirtySet:this.dirtySet.formatDebugInfo()}};u._createClass(A,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);return A}(p);f.__decorate([t.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=f.__decorate([h.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){f=function(r){function c(g){g=r.call(this,g)||this;g._residentGeomRecords=new Map;g._dirtyGeomRecords=new Map;g.dirty=!1;return g}a._inheritsLoose(c,r);var d=c.prototype;d.commit=function(g){this.dirty=!1;this._dirtyGeomRecords.forEach((A,q)=>this.commitLayer(q,g))};d.commitLayer=function(g,A){const q=this._dirtyGeomRecords.get(g);q&&(q.forEach((y,x)=>{const D=this._ensureGeomRecord(g,x);y.forEach((C,B)=>{var v=C[0],E=C[1],F=C[2];C=!1;if(E&2){var L=D.get(B);if(L){L=
L[1];if(F&4){const N=this.model.getObject(x);this.model.updateRenderGeometryTransformation(N,v,L)&&(C=!0)}C||A.updates.push({renderGeometry:L,updateType:F})}else z.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(E&4||C)(F=D.get(B))?(A.removes.push(F[1]),D.delete(B),F[0].disposed&&m.GeometryRecord.pool.release(F[0])):4===E&&z.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(E&1||C)E=this.model.getObject(x),E=this.model.getRenderGeometry(E,
v),v=[v,E],A.adds.push(E),D.set(B,v)});0===D.size&&this._residentGeomRecords.get(g).delete(x)}),0===this._residentGeomRecords.get(g).size&&this._residentGeomRecords.delete(g),this._dirtyGeomRecords.delete(g))};d.getResidentRenderGeometries=function(g,A){(g=this._residentGeomRecords.get(g))&&g.forEach(q=>q.forEach(y=>A.push(y[1])))};d._objectStateChanged=function(g,A){for(const q of A.geometryRecords)this._updateOrCreateDirtyRecord(A,q,null,2,0,0,2,5,g)};d.visibilityChanged=function(g){this._objectStateChanged(1,
g)};d.highlightChanged=function(g){this._objectStateChanged(8,g)};d.occlusionChanged=function(g){this._objectStateChanged(16,g)};d.vertexAttrsUpdated=function(g){this._updateOrCreateDirtyRecord(g.object,g.record,null,2,0,0,2,5,2)};d.layerAdded=function(g){g.objects.forAll(A=>this._layerObjectAdded(g,A))};d.layerRemoved=function(g){g.objects.forAll(A=>this._layerObjectRemoved(g,A))};d.layerObjectAdded=function(g){this._layerObjectAdded(g.layer,g.object)};d._layerObjectAdded=function(g,A){g=g.id;const q=
A.geometryRecords;for(let y=0;y<q.length;y++)this._objectGeometryAdded(A,q[y],g)};d.layerObjectRemoved=function(g){this._layerObjectRemoved(g.layer,g.object)};d.layerObjectsAdded=function(g){for(const A of g.objects)this._layerObjectAdded(g.layer,A)};d.layerObjectsRemoved=function(g){for(const A of g.objects)this._layerObjectRemoved(g.layer,A)};d._layerObjectRemoved=function(g,A){g=g.id;const q=A.geometryRecords;for(let y=0;y<q.length;y++)this._objectGeometryRemoved(A,q[y],g)};d.shaderTransformationChanged=
function(g){(g=this._residentGeomRecords.get(g.id))&&g.forEach((A,q)=>{(q=this.model.getObject(q))&&q.hasVolativeTransformation()&&A.forEach(y=>{y[1].shaderTransformationChanged()})})};d.objectTransformation=function(g){const A=this._getParentLayerId(g);this._ensureGeomRecord(A,g.id).forEach(q=>{this._updateOrCreateDirtyRecord(g,q[0],A,2,0,0,2,5,4)})};d.objectGeometryAdded=function(g){this._objectGeometryAdded(g.object,g.record)};d._objectGeometryAdded=function(g,A,q=null){this._updateOrCreateDirtyRecord(g,
A,q,1,4,0,0,0)};d.objectGeometryRemoved=function(g){this._objectGeometryRemoved(g.object,g.record)};d._objectGeometryRemoved=function(g,A,q=null){this._updateOrCreateDirtyRecord(g,A,q,4,1,2,0,0)};d._updateOrCreateDirtyRecord=function(g,A,q,y,x,D,C,B,v){q=t.unwrapOr(q,this._getParentLayerId(g));const E=A.id;g=this._ensureDirtyRecord(q,g.id);(q=g.get(E))?(A=q[1],A&x?(g.delete(E),q[0].disposed&&m.GeometryRecord.pool.release(q[0])):A&D?(q[1]=y,q[2]=v):A&C?q[2]|=v:A&B||z.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):
g.set(E,[A,y,v]);this.dirty=this._hasDirtyGeometryRecords};d._ensureGeomRecord=function(g,A){let q=this._residentGeomRecords.get(g);q||(q=new Map,this._residentGeomRecords.set(g,q));g=q.get(A);g||(g=new Map,q.set(A,g));return g};d._ensureDirtyRecord=function(g,A){let q=this._dirtyGeomRecords.get(g);q||(q=new Map,this._dirtyGeomRecords.set(g,q));g=q.get(A);g||(g=new Map,q.set(A,g));return g};d._getParentLayerId=function(g){return t.isSome(g.parentLayer)?g.parentLayer.id:w.NullUID};d.formatDebugInfo=
function(){const g=["ADD","UPD",void 0,"REM"];let A="";this._dirtyGeomRecords.forEach((q,y)=>{q.forEach((x,D)=>{0<A.length&&(A+="\n");A+=y+"."+D;const C=[];x.forEach(B=>{const v=B[1];C[v]||(C[v]=[]);C[v].push(B[0].geometry.id)});for(x=0;x<C.length;x++)if(C[x])for(A+=" "+g[x-1]+": ",D=0;D<C[x].length;D++)A+=C[x][D]+", "})});return A};a._createClass(c,[{key:"_hasDirtyGeometryRecords",get:function(){return p.someMap(this._dirtyGeomRecords,g=>p.someMap(g,A=>A&&0<A.size))}},{key:"test",get:function(){const g=
this;return{get residentLayerCount(){return g._residentGeomRecords.size},get residentObjectCount(){return Array.from(g._residentGeomRecords.values()).reduce((A,q)=>A+q.size,0)}}}}]);return c}(f);u.__decorate([e.property({constructOnly:!0})],f.prototype,"model",void 0);u.__decorate([e.property()],f.prototype,"dirty",void 0);return f=u.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],f)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../support/animationUtils ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRep ../lib/MagnifierHelper ../lib/Renderer ../lib/TextureRepository ../lib/WebGLDriverTest ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G){const K=e.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(H){function J(O){var Q=H.call(this,{})||this;Q.events=new t;Q.waterTextureRepository=new F.WaterTextureRepository;Q._magnifierHelper=new D.MagnifierHelper;Q._componentObjectCollection=null;Q._needsUpdate=!0;Q._needsRender=!0;Q._idleSuspend=!0;Q._needsWaterReflectionUpdate=!1;Q._logicUpdateLast=0;Q._container=O.container;Q._initializeContext(O.options);
k.init(Q.waterTextureRepository,"loadingState",()=>Q.setNeedsRender());Q._magnifierHelper.events.on("request-render",()=>Q.setNeedsRender());Q._stippleTextureRepository=new E.StippleTextureRepository(Q._rctx);Q._shaderTechniqueRepository=new g.ShaderTechniqueRepository({rctx:Q._rctx,viewingMode:O.viewingMode,stippleTextureRepository:Q._stippleTextureRepository,waterTextureRepository:Q.waterTextureRepository});Q._textureRepository=new B.TextureRepository(O,Q._shaderTechniqueRepository,Q._rctx);Q._textureRepository.events.on("changed",
S=>Q.setNeedsRender(S));Q._materialRepository=new x(Q._textureRepository,Q._shaderTechniqueRepository,()=>Q.setNeedsRender());Q._compositingHelper=new q(Q._rctx,Q._shaderTechniqueRepository);Q._renderer=new C(Q._materialRepository,Q._textureRepository,Q._shaderTechniqueRepository,Q._rctx,Q._compositingHelper,Q._magnifierHelper,(S=1)=>Q.setNeedsRender(S),(S,V)=>O.schedule(S,V),O);Q._screenshotManager=new N.ScreenshotManager(Q._rctx,(S,V,Y)=>Q._renderer.render(S,V,V,Y),()=>Q.setNeedsRender(),O.options.screenshot.renderOverlay,
S=>Q.events.emit("force-camera-for-screenshot",S));Q._registerFrameTask(O);return Q}u._inheritsLoose(J,H);var M=J.prototype;M.normalizeCtorArgs=function(){return{}};M.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null;v.clearTestWebGLDriver(this._rctx);H.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=
null};M.setNeedsRender=function(O=1){1===O?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};M.evaluateUpdating=function(){return this.needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating};M.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};M.updateLightSources=function(O,Q,S){this._renderer.updateLightSources(O,Q,S);
this.setNeedsRender()};M.setRenderParameters=function(O){void 0!==O.idleSuspend&&this._idleSuspend!==!!O.idleSuspend&&(this._idleSuspend=!!O.idleSuspend,this.setNeedsRender());this._renderer.setRenderParameters(O)};M.has=function(O){switch(O){case 0:return!!this._rctx.capabilities.compressedTextureETC;case 1:return!!this._rctx.capabilities.compressedTextureS3TC;case 2:return!!this._rctx.capabilities.shaderTextureLOD;case 3:return this._renderer.hasShadowsEnabled;default:return!1}};M.modify=function(O){this._renderer.modify(O);
O.clear()};M.takeScreenshot=function(O){return this._screenshotManager.takeScreenshot(O)};M.readAccumulatedShadow=function(O){return this._renderer.readAccumulatedShadow(O[0],O[1])};M.getMinimalDepthForArea=function(O,Q,S,V,Y=V){O=S.constrainWindowSize(O,Q,V*S.pixelRatio,Y*S.pixelRatio);Q=this._ensureDepthBuffer(O);this._renderer.readDepthPixels(S,O[0],O[1],O[2],O[3],Q);V=Number.MAX_VALUE;for(Y=0;Y<O[2]*O[3];Y++){const W=y.textureToDepth(4*Y,Q,S.nearFar);V>W&&W!==S.nearFar[0]&&W!==S.nearFar[1]&&(V=
W)}return V===Number.MAX_VALUE?void 0:V};M._ensureDepthBuffer=function(O){O=4*O[2]*O[3];if(n.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<O)this._tmpDepthBuffer=new Uint8Array(O);return this._tmpDepthBuffer};M.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};M.hotReloadShaders=function(){var O=u._asyncToGenerator(function*(){L.removeLoadedShaderModules();yield this._shaderTechniqueRepository.hotReload();this.setNeedsRender()});return function(){return O.apply(this,
arguments)}}();M._registerFrameTask=function(O){const Q=O.state,S={viewCamera:Q.camera,frameHasDecorations:!1};let V=!1;this._frameTask=b.addFrameTask({preRender:Y=>{V=this.evaluateUpdating();O.processSyncLayers();var W=h.Milliseconds(Y.time-this._logicUpdateLast);W>c.DESIRED_ANIMATION_MS&&(W={camera:Q.camera,dt:W},this._logicUpdateLast=Y.time,this._renderer.updateLogic(W)&&this.setNeedsRender(0))},render:()=>{if((this.needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||
this._needsWaterReflectionUpdate)&&0<Q.camera.fullWidth&&0<Q.camera.fullHeight){const Y=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this._renderer.render(null,Q.camera,Q.contentCamera,!1);Y&&this._renderer.hasWaterReflection&&(this.setNeedsRender(0),this._needsWaterReflectionUpdate=!0)}},postRender:()=>{V===this.updating&&V===this.evaluateUpdating()||this.notifyChange("updating")},update:()=>{S.viewCamera=
Q.camera;S.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(S)}})};M._initializeContext=function(O){this._canvas=O.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const Q=I.createContextOrErrorHTML(this._canvas,{alpha:O.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==O.stencil?!0:O.stencil,
powerPreference:"high-performance"},O.renderContext);this._rctx=new G["default"](Q,{disabledExtensions:O.deactivatedWebGLExtensions||{},debugWebGLExtensions:O.debugWebGLExtensions||{},maxAnisotropy:8});v.testWebGLDriver(this._rctx);this._loadShaderOnlyExtensions(this._rctx);!O.alpha&&this._rctx.contextAttributes.alpha&&K.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=w("safari")&&(this._container.style.backgroundColor="black");
this._container.appendChild(this._canvas)};M._loadShaderOnlyExtensions=function(O){O=O.capabilities;O.enable("standardDerivatives");O.enable("shaderTextureLOD");O.enable("textureFloat")};u._createClass(J,[{key:"performanceInfo",get:function(){const O=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==O.getUsedTextureMemory?O.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==O.getUsedRenderbufferMemory?O.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==
O.getUsedVBOMemory?O.getUsedVBOMemory():void 0}}},{key:"needsUpdate",get:function(){return this._needsUpdate}},{key:"updating",get:function(){return this.evaluateUpdating()}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(O){this._magnifierHelper.magnifier=O}},{key:"renderingContext",get:function(){return this._rctx}},
{key:"canvas",get:function(){return this._canvas}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"componentObjectCollection",get:function(){n.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new d.ComponentObjectCollection(this._renderer.renderPassManager));return this._componentObjectCollection},set:function(O){this._componentObjectCollection=O}}]);return J}(A.AutoDisposableMixin(p));
f.__decorate([l.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_rctx",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_container",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_canvas",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",void 0);f.__decorate([A.autoDispose(),l.property()],a.RenderView.prototype,"waterTextureRepository",void 0);
f.__decorate([A.autoDispose(),l.property()],a.RenderView.prototype,"_magnifierHelper",void 0);f.__decorate([A.autoDispose(),l.property()],a.RenderView.prototype,"_textureRepository",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_renderer",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_screenshotManager",void 0);f.__decorate([A.autoDispose()],a.RenderView.prototype,"componentObjectCollection",
null);f.__decorate([A.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);a.RenderView=f.__decorate([r.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/vec4f32 ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./interface ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/BucketedObjectStore ../../core/util/TwoVectorPosition ../../lib/ComponentUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I){const G=f.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");f=function(){function O(S){this._renderManager=S;this._objects=new B.BucketedObjectStore;this._renderSubmit=new y.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new L.BufferManager(S.rctx)}var Q=O.prototype;Q.dispose=function(){F.assert(0===this._objects.count,"ObjectCollection should be empty upon disposal");
this._componentBufferManager.destroy()};Q.createObject=function(S){const V=new c;V.toMapSpace=S.toMapSpace.slice();V.transform=S.transform;V.obb=l.clone(S.obb);V.components=new r(this._componentBufferManager,S.geometry.componentOffsets);V.renderable=this._createRenderable(S,V.components);V.intersectionGeometry=new g(S.geometry.positionData,V.components);this._objects.add(S.visible?d.VISIBLE_BIT:0,V);return V};Q.destroyObject=function(S){this._objects.remove(S);S.dispose();this._notifyDirty()};Q.setObjectVisibility=
function(S,V){V!==S.visible&&(this._objects.updateKey(S,V?S.bucketKey|d.VISIBLE_BIT:S.bucketKey&~d.VISIBLE_BIT),this._notifyDirty())};Q.preSubmit=function(S){const V=S.camera.eye;this._objects.forEach((Y,W)=>{W&d.VISIBLE_BIT&&Y.forEach(ba=>{const ca=e.squaredDistance(V,ba.obb.center);ba.renderable.meta.cameraDepthSquared=ca})})};Q.getMaterial=function(S){return S.renderable.material};Q.updateMaterial=function(S,V){S=S.renderable.material;V(S);S.dirty&&this._notifyDirty()};Q.setAllComponentVisibilities=
function(S,V){S.components.visibility.reset(V);S.components.visibilityDirty();this._notifyDirty()};Q.forEachVisibleComponent=function(S,V){return S.components.visibility.forEachComponent(V)};Q.getComponentCount=function(S){const V=S.components.visibility.componentCount();return{visible:V,invisible:S.components.count-V}};Q.setComponentData=function(S,V){const Y=S.renderable.material;if(d.isVaryingComponentParameters(V)){S=S.components;var W=S.materialDataBuffer;const ba=S.materialDataIndices,ca={castShadows:!0,
pickable:!0,externalColor:h.create(),externalColorMixMode:1};W=W.textureBuffer;const da=new Uint8Array(4),ha=new Uint32Array(da.buffer);let fa=0,R=0,U=0,Z=!1,T=0;for(let P=0;P<S.count;P++)V(P,ca),fa+=+(1>ca.externalColor[3]),R+=+(3===ca.externalColorMixMode&&1===ca.externalColor[3]),U+=+ca.castShadows,k.encodeSymbolColor(ca.externalColor,ca.externalColorMixMode,da),da[2]=da[2]&254|+ca.castShadows,W.setData(ba[P],0,da[0],da[1],da[2],da[3]),Z=Z||0<P&&T!==ha[0],T=ha[0],ca.pickable!==E.getVisibility(S.pickability,
P)&&(S.pickability=E.updateVisibilityWithCount(S.pickability,S.count,P,ca.pickable));Z?(Y.componentParameters=new D.ComponentParametersVarying,Y.componentParameters.castShadows=U===S.count?0:0===U?2:1,Y.componentParameters.transparent=fa===S.count?0:0===fa?2:1,Y.componentParameters.opaqueOverride=R===S.count?0:0===R?2:1,Y.componentParameters.texture=W,W.updateTexture()):(Y.componentParameters=new D.ComponentParametersUniform,Y.componentParameters.castShadows=ca.castShadows?0:2,Y.componentParameters.externalColor=
ca.externalColor,Y.componentParameters.externalColorMixMode=ca.externalColorMixMode)}else Y.componentParameters=new D.ComponentParametersUniform,Y.componentParameters.castShadows=V.castShadows?0:2,Y.componentParameters.externalColor=V.externalColor,Y.componentParameters.externalColorMixMode=V.externalColorMixMode;this._notifyDirty()};Q.getComponentAabb=function(S,V,Y){return S.intersectionGeometry.getComponentAabb(V,Y)};Q.getComponentObb=function(S){return S.obb};Q.getObjectTransform=function(S){return S.transform};
Q.getComponentPositions=function(S,V,Y){return S.intersectionGeometry.getComponentPositions(V,Y)};Q.intersect=function(S,V,Y,W,ba,ca){p.isSome(ba)&&(ba.localOrigin=S.transform.position);const da=t.invert(H,S.transform.rotationScale);e.sub(J,V,S.transform.position);e.sub(M,Y,S.transform.position);e.transformMat3(J,J,da);e.transformMat3(M,M,da);V=t.transpose(H,da);return S.intersectionGeometry.intersect(J,M,W,V,ba,ca)};Q.addEdges=function(S,V,Y,W){const {indices:ba,positions:ca}=S.intersectionGeometry;
return V.addComponentObject(S,S.transform,S.obb.center,ca,ba,S.components.offsets,Y,W)};Q.addComponentHighlight=function(S,V){S=S.components;p.isNone(S.highlightCounts)&&(S.highlightCounts=new Uint32Array(S.count+1));0===S.highlightCounts[V]++&&(S.highlightsDirty(),this._notifyDirty());S.highlightCounts[S.count]++};Q.removeComponentHighlight=function(S,V){S=S.components;if(p.isNone(S.highlightCounts))G.warn("Removing non-existing highlight.");else{var Y=S.highlightCounts[V],W=S.highlightCounts[S.count];
0===Y?G.warn("Removing non-existing highlight."):1<Y?(S.highlightCounts[V]=Y-1,S.highlightCounts[S.count]=W-1):(S.highlightCounts[V]=0,S.highlightsDirty(),this._notifyDirty(),1===W?S.highlightCounts=null:S.highlightCounts[S.count]=W-1)}};Q.clearHighlights=function(S){S=S.components;p.isSome(S.highlightCounts)&&(S.highlightCounts=null,S.highlightsDirty(),this._notifyDirty())};Q.getObjectGPUMemoryUsage=function(S){return S.renderable.meta.gpuMemoryEstimate};Q._createRenderable=function(S,V){const Y=
this._renderManager.rctx;var W=S.geometry,ba=W.vertices.layoutParameters,ca=N.createVertex(Y,35044,W.vertices.data);const da=p.applySome(W.indices,Z=>N.createIndex(Y,35044,Z));var ha=m.glLayout(x.createVertexBufferLayout(ba)),fa=new Uint16Array(W.vertices.count);for(var R=0;R<V.count;R++){var U=V.offsets[R];const Z=V.offsets[R+1],T=V.materialDataIndices[R];if(p.isSome(W.indices))for(;U<Z;U++)fa[W.indices[U]]=T;else for(;U<Z;U++)fa[U]=T}W=N.createVertex(Y,35044,fa.buffer);fa=new v.TwoVectorPosition(S.transform.position);
R=w.clone(S.transform.rotationScale);t.invert(R,R);t.transpose(R,R);V=new C.ComponentDrawParameters;e.copy(V.worldFromModel_TL,fa.low);e.copy(V.worldFromModel_TH,fa.high);t.copy(V.worldFromModel_RS,S.transform.rotationScale);t.copy(V.transformNormal_GlobalFromModel,R);b.copy(V.toMapSpace,S.toMapSpace);S=new D.ComponentMaterial;ha=new I(Y,S.attributeLocations,{data:ha,componentIndices:K},{data:ca,componentIndices:W},p.unwrap(da));ba=new q.RenderGeometry(ha,4,ba,p.isSome(da));ca={cameraDepthSquared:.5,
gpuMemoryEstimate:ca.byteSize+W.byteSize+(p.isSome(da)?da.byteSize:0)};return new A.Renderable(S,V,ba,ca)};Q._notifyDirty=function(){this._renderManager.notifyDirty()};u._createClass(O,[{key:"visibleObjects",get:function(){return this._objects.getBucket(d.VISIBLE_BIT)}},{key:"performanceInfo",get:function(){const S=this._objects.getPerformanceInfo(d.VISIBLE_BIT);return{shown:S.added,hidden:S.removed}}}]);return O}();const K=m.glLayout(z.newLayout().u16("componentIndex")),H=w.create(),J=n.create(),
M=n.create();a.ComponentObjectCollection=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),function(a,u,f,p,
t,w,e,n,b,h,k,l,m,z){function r(B=[0,0,0],v=[-1,-1,-1],E=[0,0,0,1]){return{center:b.clone(B),halfSize:n.clone(v),quaternion:t.clone(E)}}function c(B,v){const E=m.signedDistance(v,B.center);B=d(B,m.normal(v));return E>B?1:E<-B?-1:0}function d(B,v){p.conjugate(g,B.quaternion);e.transformQuat(A,v,g);B=B.halfSize;return Math.abs(A[0]*B[0])+Math.abs(A[1]*B[1])+Math.abs(A[2]*B[2])}const g=w.create(),A=b.create(),q=b.create(),y=k.create(),x=f.create(),D=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],C=(()=>{const B=
new Int8Array(162);let v=0;const E=F=>{for(let L=0;L<F.length;L++)B[v+L]=F[L];v+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,5,1,3,7,6]);E([0,2,3,
7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return B})();a.ObbArray=function(B){this.buffer=new ArrayBuffer(56*B);this.obbs=Array(B);for(let v=0;v<B;v++)this.obbs[v]={center:b.createView(this.buffer,56*v),halfSize:n.createView(this.buffer,56*v+24),quaternion:t.createView(this.buffer,56*v+36)}};a.clone=function(B){return r(B.center,B.halfSize,B.quaternion)};a.compute=function(B,v){v=v||r();z.computeOBB(B,v);return v};a.corners=function(B,v){for(let E=0;8>E;++E){const F=v[E];F[0]=E&1?-B.halfSize[0]:B.halfSize[0];
F[1]=E&2?-B.halfSize[1]:B.halfSize[1];F[2]=E&4?-B.halfSize[2]:B.halfSize[2];e.transformQuat(F,F,B.quaternion);e.add(F,F,B.center)}};a.create=r;a.intersectLine=function(B,v,E,F=0){p.conjugate(g,B.quaternion);e.subtract(A,v,B.center);v=e.transformQuat(A,A,g);E=e.transformQuat(q,E,g);let L=-Infinity,N=Infinity;for(let I=0;3>I;I++)if(1E-6<Math.abs(E[I])){const G=(F+B.halfSize[I]-v[I])/E[I],K=(-F-B.halfSize[I]-v[I])/E[I];L=Math.max(L,Math.min(G,K));N=Math.min(N,Math.max(G,K))}else if(v[I]>B.halfSize[I]+
F||v[I]<-B.halfSize[I]-F)return!1;return L<=N};a.intersectPlane=c;a.isVisible=function(B,v){return 0>=c(B,v[0])&&0>=c(B,v[1])&&0>=c(B,v[2])&&0>=c(B,v[3])&&0>=c(B,v[4])&&0>=c(B,v[5])};a.maximumDistancePlane=function(B,v){const E=m.signedDistance(v,B.center);B=d(B,m.normal(v));return E+B};a.minimumDistancePlane=function(B,v){const E=m.signedDistance(v,B.center);B=d(B,m.normal(v));return E-B};a.projectedArea=function(B,v,E,F,L){p.conjugate(g,B.quaternion);e.sub(A,v,B.center);e.transformQuat(A,A,g);var N=
A[0]<-B.halfSize[0]?-1:A[0]>B.halfSize[0]?1:0,I=A[1]<-B.halfSize[1]?-1:A[1]>B.halfSize[1]?1:0,G=A[2]<-B.halfSize[2]?-1:A[2]>B.halfSize[2]?1:0;v=Math.abs(N)+Math.abs(I)+Math.abs(G);if(0===v)return Infinity;v=1===v?4:6;N=6*(N+3*I+9*G+13);u.fromQuat(x,B.quaternion);u.scale(x,x,B.halfSize);for(I=0;I<v;I++)G=C[N+I],e.set(A,((G&1)<<1)-1,(G&2)-1,((G&4)>>1)-1),e.transformMat3(A,A,x),e.add(y,B.center,A),y[3]=1,h.transformMat4(y,y,E),G=1/Math.max(1E-6,y[3]),D[2*I]=y[0]*G,D[2*I+1]=y[1]*G;B=2*v-2;E=D[0]*(D[3]-
D[B+1])+D[B]*(D[1]-D[B-1]);for(v=2;v<B;v+=2)E+=D[v]*(D[v+3]-D[v-1]);return Math.abs(E)*F*L*.125};a.projectedRadius=d;a.set=function(B,v){e.copy(v.center,B.center);e.copy(v.halfSize,B.halfSize);p.copy(v.quaternion,B.quaternion)};a.toAaBoundingBox=function(B,v){v||(v=l.create());var E=u.fromQuat(x,B.quaternion);const F=B.halfSize[0]*Math.abs(E[0])+B.halfSize[1]*Math.abs(E[3])+B.halfSize[2]*Math.abs(E[6]),L=B.halfSize[0]*Math.abs(E[1])+B.halfSize[1]*Math.abs(E[4])+B.halfSize[2]*Math.abs(E[7]);E=B.halfSize[0]*
Math.abs(E[2])+B.halfSize[1]*Math.abs(E[5])+B.halfSize[2]*Math.abs(E[8]);v[0]=B.center[0]-F;v[1]=B.center[1]-L;v[2]=B.center[2]-E;v[3]=B.center[0]+F;v[4]=B.center[1]+L;v[5]=B.center[2]+E;return v};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function u(){const e=new Float32Array(4);e[3]=1;return e}function f(e){const n=new Float32Array(4);n[0]=e[0];n[1]=e[1];n[2]=e[2];n[3]=e[3];return n}function p(e,n,b,h){const k=new Float32Array(4);
k[0]=e;k[1]=n;k[2]=b;k[3]=h;return k}function t(e,n){return new Float32Array(e,n,4)}var w=Object.freeze({__proto__:null,create:u,clone:f,fromValues:p,createView:t});a.clone=f;a.create=u;a.createView=t;a.fromValues=p;a.quatf32=w})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function u(da,ha,fa,R,U,Z){if(!(1E-6>ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2]))for(l(E,fa,ha),l(F,R,ha),l(L,U,ha),f(da,ha,v),I[1]=v[0],N[1]=v[1],G[1]=N[1]-I[1],fa=[fa,R,U],R=[E,F,L],U=0;3>U;++U){f(da,fa[U],
v);I[0]=v[0];N[0]=v[1];f(da,R[U],v);I[2]=v[0];N[2]=v[1];G[0]=N[0]-I[0];G[2]=N[2]-I[2];const T=e(G);T<Z.quality&&(k(Z.b0,fa[U]),k(Z.b1,ha),k(Z.b2,R[U]),Z.quality=T)}}function f(da,ha,fa){const {data:R,size:U}=da;fa[0]=Number.POSITIVE_INFINITY;fa[1]=Number.NEGATIVE_INFINITY;for(da=0;da<R.length;da+=U){const Z=R[da]*ha[0]+R[da+1]*ha[1]+R[da+2]*ha[2];fa[0]=Math.min(fa[0],Z);fa[1]=Math.max(fa[1],Z)}}function p(da,ha,fa){k(fa.center,da);h(fa.halfSize,ha,.5);fa.quaternion[0]=0;fa.quaternion[1]=0;fa.quaternion[2]=
0;fa.quaternion[3]=1}function t(da,ha,fa,R,U,Z){f(da,ha,v);U[0]=v[0];Z[0]=v[1];f(da,fa,v);U[1]=v[0];Z[1]=v[1];f(da,R,v);U[2]=v[0];Z[2]=v[1]}function w(da,ha,fa,R,U,Z,T){Y[0]=da[0];Y[1]=da[1];Y[2]=da[2];Y[3]=ha[0];Y[4]=ha[1];Y[5]=ha[2];Y[6]=fa[0];Y[7]=fa[1];Y[8]=fa[2];var P=T.quaternion,X=Y,aa=X[0]+X[4]+X[8];if(0<aa)aa=Math.sqrt(aa+1),P[3]=.5*aa,aa=.5/aa,P[0]=(X[5]-X[7])*aa,P[1]=(X[6]-X[2])*aa,P[2]=(X[1]-X[3])*aa;else{aa=0;X[4]>X[0]&&(aa=1);X[8]>X[3*aa+aa]&&(aa=2);const ja=(aa+1)%3,ia=(aa+2)%3;let ka=
Math.sqrt(X[3*aa+aa]-X[3*ja+ja]-X[3*ia+ia]+1);P[aa]=.5*ka;ka=.5/ka;P[3]=(X[3*ja+ia]-X[3*ia+ja])*ka;P[ja]=(X[3*ja+aa]+X[3*aa+ja])*ka;P[ia]=(X[3*ia+aa]+X[3*aa+ia])*ka}n(W,R,U);h(W,W,.5);h(T.center,da,W[0]);h(V,ha,W[1]);n(T.center,T.center,V);h(V,fa,W[2]);n(T.center,T.center,V);h(T.halfSize,Z,.5)}function e(da){return da[0]*da[1]+da[0]*da[2]+da[1]*da[2]}function n(da,ha,fa){da[0]=ha[0]+fa[0];da[1]=ha[1]+fa[1];da[2]=ha[2]+fa[2]}function b(da,ha,fa){da[0]=ha[0]-fa[0];da[1]=ha[1]-fa[1];da[2]=ha[2]-fa[2]}
function h(da,ha,fa){da[0]=ha[0]*fa;da[1]=ha[1]*fa;da[2]=ha[2]*fa}function k(da,ha,fa=0){da[0]=ha[fa+0];da[1]=ha[fa+1];da[2]=ha[fa+2]}function l(da,ha,fa){const R=ha[0],U=ha[1];ha=ha[2];const Z=fa[0],T=fa[1];fa=fa[2];da[0]=U*fa-ha*T;da[1]=ha*Z-R*fa;da[2]=R*T-U*Z}function m(da,ha){var fa=ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2];0<fa&&(fa=1/Math.sqrt(fa),da[0]=ha[0]*fa,da[1]=ha[1]*fa,da[2]=ha[2]*fa)}function z(da,ha){const fa=ha[0]-da[0],R=ha[1]-da[1];da=ha[2]-da[2];return fa*fa+R*R+da*da}const r=[0,0,0],
c=[0,0,0],d=[0,0,0],g=[0,0,0],A=[0,0,0],q=[0,0,0],y=[0,0,0],x=[0,0,0],D=[0,0,0],C=[0,0,0],B=[0,0,0],v=[0,0],E=[0,0,0],F=[0,0,0],L=[0,0,0],N=[0,0,0],I=[0,0,0],G=[0,0,0],K=[0,0,0],H=[0,0,0],J=[0,0,0],M=[0,0,0],O=[0,0,0],Q=[0,0,0],S=[0,0,0],V=[0,0,0],Y=[1,0,0,0,1,0,0,0,1],W=[0,0,0];let ba=function(da){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ha=0;this.minProj=new Float64Array(this.buffer,ha,7);ha+=56;this.maxProj=new Float64Array(this.buffer,ha,7);ha+=56;for(var fa=
0;7>fa;++fa)this.minVert[fa]=new Float64Array(this.buffer,ha,3),ha+=24;for(fa=0;7>fa;++fa)this.maxVert[fa]=new Float64Array(this.buffer,ha,3),ha+=24;for(ha=0;7>ha;++ha)this.minProj[ha]=Number.POSITIVE_INFINITY,this.maxProj[ha]=Number.NEGATIVE_INFINITY;ha=Array(7);fa=Array(7);const {data:R,size:U}=da;for(da=0;da<R.length;da+=U){var Z=R[da];Z<this.minProj[0]&&(this.minProj[0]=Z,ha[0]=da);Z>this.maxProj[0]&&(this.maxProj[0]=Z,fa[0]=da);Z=R[da+1];Z<this.minProj[1]&&(this.minProj[1]=Z,ha[1]=da);Z>this.maxProj[1]&&
(this.maxProj[1]=Z,fa[1]=da);Z=R[da+2];Z<this.minProj[2]&&(this.minProj[2]=Z,ha[2]=da);Z>this.maxProj[2]&&(this.maxProj[2]=Z,fa[2]=da);Z=R[da]+R[da+1]+R[da+2];Z<this.minProj[3]&&(this.minProj[3]=Z,ha[3]=da);Z>this.maxProj[3]&&(this.maxProj[3]=Z,fa[3]=da);Z=R[da]+R[da+1]-R[da+2];Z<this.minProj[4]&&(this.minProj[4]=Z,ha[4]=da);Z>this.maxProj[4]&&(this.maxProj[4]=Z,fa[4]=da);Z=R[da]-R[da+1]+R[da+2];Z<this.minProj[5]&&(this.minProj[5]=Z,ha[5]=da);Z>this.maxProj[5]&&(this.maxProj[5]=Z,fa[5]=da);Z=R[da]-
R[da+1]-R[da+2];Z<this.minProj[6]&&(this.minProj[6]=Z,ha[6]=da);Z>this.maxProj[6]&&(this.maxProj[6]=Z,fa[6]=da)}for(da=0;7>da;++da)Z=ha[da],k(this.minVert[da],R,Z),Z=fa[da],k(this.maxVert[da],R,Z)},ca=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(da,ha){const {data:fa,size:R}=da;var U=fa.length/R;if(!(0>=U)){var Z=new ba(da);n(r,Z.minProj,Z.maxProj);h(r,r,.5);b(c,Z.maxProj,Z.minProj);var T=e(c),P=new ca;P.quality=T;14>U&&(da={data:new Float64Array(Z.buffer,
112,42),size:3});var X=[0,0,0],aa=[0,0,0],ja=[0,0,0];U=[0,0,0];var ia=[0,0,0],ka=[0,0,0],na=[0,0,0];var ta=da;var pa=z(Z.maxVert[0],Z.minVert[0]),xa=0;for(var Da=1;7>Da;++Da){const Ka=z(Z.maxVert[Da],Z.minVert[Da]);Ka>pa&&(pa=Ka,xa=Da)}k(X,Z.minVert[xa]);k(aa,Z.maxVert[xa]);if(1E-6>z(X,aa))ta=1;else{b(U,X,aa);m(U,U);{const {data:Ka,size:Fa}=ta;Z=Number.NEGATIVE_INFINITY;pa=0;for(xa=0;xa<Ka.length;xa+=Fa)B[0]=Ka[xa]-X[0],B[1]=Ka[xa+1]-X[1],B[2]=Ka[xa+2]-X[2],Da=U[0]*B[0]+U[1]*B[1]+U[2]*B[2],Da=B[0]*
B[0]+B[1]*B[1]+B[2]*B[2]-Da*Da/(U[0]*U[0]+U[1]*U[1]+U[2]*U[2]),Da>Z&&(Z=Da,pa=xa);k(ja,Ka,pa)}1E-6>Z?ta=2:(b(ia,aa,ja),m(ia,ia),b(ka,ja,X),m(ka,ka),l(na,ia,U),m(na,na),u(ta,na,U,ia,ka,P),ta=0)}switch(ta){case 1:p(r,c,ha);return;case 2:T=da;k(H,U);Math.abs(U[0])>Math.abs(U[1])&&Math.abs(U[0])>Math.abs(U[2])?H[0]=0:Math.abs(U[1])>Math.abs(U[2])?H[1]=0:H[2]=0;1E-6>H[0]*H[0]+H[1]*H[1]+H[2]*H[2]&&(H[0]=H[1]=H[2]=1);l(J,U,H);m(J,J);l(M,U,J);m(M,M);t(T,U,J,M,O,Q);b(S,Q,O);w(U,J,M,O,Q,S,ha);return}ta=da;
{Z=v;const {data:Ka,size:Fa}=ta;k(g,Ka);k(d,g);Z[0]=K[0]*na[0]+K[1]*na[1]+K[2]*na[2];Z[1]=Z[0];for(pa=Fa;pa<Ka.length;pa+=Fa)xa=Ka[pa]*na[0]+Ka[pa+1]*na[1]+Ka[pa+2]*na[2],xa<Z[0]&&(Z[0]=xa,k(g,Ka,pa)),xa>Z[1]&&(Z[1]=xa,k(d,Ka,pa))}na=X[0]*na[0]+X[1]*na[1]+X[2]*na[2];v[1]-1E-6<=na&&(d[0]=void 0);v[0]+1E-6>=na&&(g[0]=void 0);void 0!==d[0]&&(b(A,d,X),m(A,A),b(q,d,aa),m(q,q),b(y,d,ja),m(y,y),l(x,q,U),m(x,x),l(D,y,ia),m(D,D),l(C,A,ka),m(C,C),u(ta,x,U,q,A,P),u(ta,D,ia,y,q,P),u(ta,C,ka,A,y,P));void 0!==
g[0]&&(b(A,g,X),m(A,A),b(q,g,aa),m(q,q),b(y,g,ja),m(y,y),l(x,q,U),m(x,x),l(D,y,ia),m(D,D),l(C,A,ka),m(C,C),u(ta,x,U,q,A,P),u(ta,D,ia,y,q,P),u(ta,C,ka,A,y,P));t(da,P.b0,P.b1,P.b2,O,Q);da=[0,0,0];b(da,Q,O);P.quality=e(da);P.quality<T?w(P.b0,P.b1,P.b2,O,Q,da,ha):p(r,c,ha)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/typedArrayUtil",
"./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,u,f,p,t){function w(e,n,b){const h=[],k=[];let l=b.length,m=b.length;n.forEachComponent(z=>{0<e[z]?(l!==z-1&&(h.length&&h.push(b[l+1]-h[h.length-1]),h.push(b[z])),l=z):(m!==z-1&&(k.length&&k.push(b[m+1]-k[k.length-1]),k.push(b[z])),m=z);return!0});h.length&&h.push(b[l+1]-h[h.length-1]);k.length&&k.push(b[m+1]-k[k.length-1]);return{highlightRanges:h,defaultRanges:k}}return function(e){function n(h,k){var l=e.call(this)||
this;l.pickability=null;l.highlightCounts=null;l.cachedGeometryRanges=null;l.cachedHighlightRanges=null;l.cachedDefaultRanges=null;l.offsets=f.slice(k);k=l.count;l.visibility=new p.ComponentRangeRunLengthEncoded(k);l.materialDataBuffer=h.getBuffer(k);l.materialDataIndices=new Uint16Array(k);for(h=0;h<k;h++)l.materialDataIndices[h]=l.materialDataBuffer.acquireIndex();return l}a._inheritsLoose(n,e);var b=n.prototype;b.dispose=function(){e.prototype.dispose.call(this);for(let h=0;h<this.count;h++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[h])};
b.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};b.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};b.updateCachedHighlightRanges=function(){if((u.isNone(this.cachedHighlightRanges)||u.isNone(this.cachedDefaultRanges))&&u.isSome(this.highlightCounts)){const {highlightRanges:h,defaultRanges:k}=w(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=h;this.cachedDefaultRanges=k}};a._createClass(n,[{key:"count",
get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){u.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(u.isNone(this.highlightCounts))return null;this.updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(u.isNone(this.highlightCounts))return this.geometryRanges;this.updateCachedHighlightRanges();
return this.cachedDefaultRanges}}]);return n}(t.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let u=function(){function f(t){this._totalCount=t;this._indexRanges=[0,t]}var p=f.prototype;p.componentCount=function(){const t=this._indexRanges;let w=0;for(let e=0;e<t.length;e+=2)w+=t[e+1];return w};p.reset=function(t){if("all"===t||t.length===this._totalCount)this._indexRanges=[0,this._totalCount];
else{{const n=[];if(0!==t.length){var w=t[0],e=1;for(let b=1;b<t.length;b++){const h=t[b];w+e===h?e+=1:(n.push(w),n.push(e),w=h,e=1)}n.push(w);n.push(e)}t=n}this._indexRanges=t}};p.forEachComponent=function(t){const w=this._indexRanges;for(let n=0;n<w.length;n+=2){var e=w[n];const b=e+w[n+1];for(;e<b;e++)if(!t(e))return!1}return!0};p.forEachComponentRange=function(t){const w=this._indexRanges;for(let e=0;e<w.length;e+=2){const n=w[e];if(!t(n,n+w[e+1]))return!1}return!0};p.computeOffsetRanges=function(t){const w=
Array(this._indexRanges.length),e=this._indexRanges;for(let b=0;b<e.length;b+=2){var n=e[b];const h=t[n];n=t[n+e[b+1]];w[b]=h;w[b+1]=n-h}return w};return f}();a.ComponentRangeRunLengthEncoded=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","./interface","../../core/util/BucketedObjectStore","../../lib/AutoDisposable"],function(a,
u,f,p,t){p=function(w){function e(){return w.apply(this,arguments)||this}a._inheritsLoose(e,w);a._createClass(e,[{key:"visible",get:function(){return!!(this.bucketKey&f.VISIBLE_BIT)}}]);return e}(p.BucketStorable);u.__decorate([t.autoDispose()],p.prototype,"renderable",void 0);u.__decorate([t.autoDispose()],p.prototype,"components",void 0);return p})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],function(a){a.VISIBLE_BIT=1;a.isVaryingComponentParameters=
function(u){return"function"===typeof u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../lib/AutoDisposable"],function(a,u,f){f=function(w){function e(){var n=w.apply(this,arguments)||this;n._bucket=null;n._bucketIndex=0;return n}u._inheritsLoose(e,w);u._createClass(e,[{key:"bucketKey",get:function(){return this._bucket.key}}]);return e}(f.AutoDisposable);
let p=function(){function w(){this._buckets=new Map}var e=w.prototype;e.add=function(n,b){n=this._getBucket(n);b._bucket=n;b._bucketIndex=n.count;n.data.push(b);++n.statistics.added};e.remove=function(n){++n._bucket.statistics.removed;const b=n._bucket.data,h=b[b.length-1];b[n._bucketIndex]=h;h._bucketIndex=n._bucketIndex;b.pop();n._bucket=null;n._bucketIndex=0};e.updateKey=function(n,b){this.remove(n);this.add(b,n)};e.getBucket=function(n){return this._getBucket(n).data};e.getPerformanceInfo=function(n){return this._getBucket(n).statistics};
e.forEach=function(n){this._buckets.forEach(b=>n(b.data,b.key))};e._getBucket=function(n){var b=this._buckets.get(n);if(b)return b;b=new t(n);this._buckets.set(n,b);return b};u._createClass(w,[{key:"count",get:function(){let n=0;this._buckets.forEach(b=>n+=b.count);return n}}]);return w}(),t=function(){function w(e){this.key=e;this.data=[];this.statistics={added:0,removed:0}}u._createClass(w,[{key:"count",get:function(){return this.data.length}}]);return w}();a.BucketStorable=f;a.BucketedObjectStore=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,u,f,p,t,w,e,n,b,h){let k=function(){function z(c,d){this._indices=u.isSome(c.indices)?c.indices:b.generateDefaultIndexArray(c.positions.length/3);this._positions=new w.BufferViewVec3f(c.positions);this._components=d;this._componentIntersectionData=Array(d.count)}var r=z.prototype;r.getComponentAabb=function(c,d){if(u.isSome(this._perComponentAabbs)){for(let g=0;6>g;g++)d[g]=this._perComponentAabbs[6*c+g];return d}this._computePerComponentAabbs();return this.getComponentAabb(c,d)};r.getComponentPositions=
function(c,d){d.indices=this._indices;d.data=this._positions.typedBuffer;d.stride=this._positions.typedBufferStride;d.startIndex=this._components.offsets[c];d.endIndex=this._components.offsets[c+1]};r.intersect=function(c,d,g,A,q,y){const x={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},D=this._indices,C=this._components.offsets,B=h.computeInvDir(c,d,l);this._components.visibility.forEachComponent(v=>{if(!n.getVisibility(this._components.pickability,v))return!0;
var E=this.getComponentAabb(v,m);u.isSome(q)&&q.applyToAabb(E);if(!h.intersectAabbInvDir(E,c,B,g))return!0;E=C[v]/3;const F=C[v+1]/3,L=(I,G,K)=>{y(v,I,f.transformMat3(G,G,A),K)},N=F-E;u.isNone(q)&&N>e.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[v]&&(this._componentIntersectionData[v]=new e.ComponentIntersectionData(this._indices,E,F,x)),this._componentIntersectionData[v].intersectRay({r0:c,r1:d},L)):h.intersectTriangles(c,d,E,F,D,x,void 0,q,L);return!0})};r._computePerComponentAabbs=
function(){const c=this._components.count;this._perComponentAabbs=new Float32Array(6*c);for(let d=0;d<c;d++)this._computeAABB(d)};r._computeAABB=function(c){const d=this._indices,g=this._positions;var A=this._components.offsets,q=A[c];const y=A[c+1],x=[0,0,0];A=[Infinity,Infinity,Infinity];const D=[-Infinity,-Infinity,-Infinity];for(;q<y;q++)g.getVec(d[q],x),f.min(A,A,x),f.max(D,D,x);c*=6;this._perComponentAabbs[c++]=A[0];this._perComponentAabbs[c++]=A[1];this._perComponentAabbs[c++]=A[2];this._perComponentAabbs[c++]=
D[0];this._perComponentAabbs[c++]=D[1];this._perComponentAabbs[c]=D[2]};a._createClass(z,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return z}();const l=p.create(),m=t.create();return k})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],
function(a,u,f,p,t){function w(d,g,A){let q=0,y=Infinity;for(let D=0;3>D;++D){var x=d[D];if(g[D]<x){if(1E-6>=A[D])return!1;q=Math.max(q,(x-g[D])/A[D])}else-1E-6>=A[D]&&(y=Math.min(y,(x-g[D])/A[D]));if(q>=y)return!1;x=d[D+3];if(g[D]>x){if(-1E-6<=A[D])return!1;q=Math.max(q,(x-g[D])/A[D])}else 1E-6<=A[D]&&(y=Math.min(y,(x-g[D])/A[D]));if(q>=y)return!1}return!0}function e(d,g,A,q,y,x){let D=q;for(;A<D;){var C=d[A];g[6*C+y+3]<=x?++A:(--D,d[A]=d[D],d[D]=C)}C=A;for(D=q;C<D;)q=d[D-1],g[6*q+y]>=x?--D:(d[D-
1]=d[C],d[C]=q,++C);return{next:A,mid:C}}function n(d,g,A,q){if(q<=A)return p.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*d[A];for(var x=0;3>x;++x)r[x]=g[y+0+x],c[x]=g[y+3+x];for(A+=1;A<q;++A)for(y=6*d[A],x=0;3>x;++x)r[x]=Math.min(r[x],g[y+0+x]),c[x]=Math.max(c[x],g[y+3+x]);return p.fromValues(r[0],r[1],r[2],c[0],c[1],c[2])}function b(d){var g=d[3]-d[0];const A=d[4]-d[1],q=d[5]-d[2];g=g>A?g>q?0:A>q?1:2:A>q?1:q>g?2:0;return{axis:g,midValue:(d[g]+d[g+3])/2}}function h(d,g,A,q,y){A-=g;const x=new Float32Array(6*
A);for(let C=0;C<A;++C){var D=3*(C+g);const B=d[D+0]*y,v=d[D+1]*y;D=d[D+2]*y;for(let E=0;3>E;++E){const F=q[B+E],L=q[v+E],N=q[D+E];x[6*C+E]=Math.min(F,L,N);x[6*C+3+E]=Math.max(F,L,N)}}return x}function k(d,g,A,q){const y=q-A;var x=0;for(var D=A;D<q;++D)for(var C=0;3>C;++C)x=Math.max(g[3*D+C],x);q=65535>=x?new Uint16Array(3*y):new Uint32Array(3*y);for(x=0;x<y;++x)for(D=3*(d[x]+A),C=0;3>C;++C)q[3*x+C]=g[D+C];return q}let l=function(d,g,A,q,y){this.aabb=d;this.axis=g;this.d=A;this.midStartIndex=q;this.rightStartIndex=
y},m=function(){function d(A,q,y,x){this.globalTriangleVertexIndices=A;this.firstTriangleIndex=q;this.positionAttribute=x;this.bspNodeTree=[];this.vertexPositionBuffer=x.data;this.vertexPositionStride=x.stride;const D=y-q,C=65535>=D?new Uint16Array(D):new Uint32Array(D);this.indices=C;for(let B=0;B<D;++B)C[B]=B;{const B=h(A,q,y,x.data,x.stride),v=(E,F,L)=>{var N=n(C,B,E,F);const I=F-E;if(20>=I)return E=new l(N,void 0,0,E,F),this.bspNodeTree.push(E),E;const {axis:G,midValue:K}=b(N),H=e(C,B,E,F,G,K),
J=(M,O)=>{if(!(15<L)){var Q=O-M;if(!(20>Q||Q>=.8*I))return v(M,O,L+1)}};N=new l(N,G,K,H.next,H.mid);this.bspNodeTree.push(N);N.leftNode=J(E,H.next);N.rightNode=J(H.mid,F);return N};v(0,D,0);this.triangleVertexIndices=k(C,A,q,y)}}var g=d.prototype;g.intersectRayTriangleRange=function(A,q){{if(A>=q)return;const H=this.triangleVertexIndices,J=this.positionAttribute.data,M=this.positionAttribute.stride;var y=this.rayOrigin;const O=y[0],Q=y[1];y=y[2];var x=this.rayDirection;const S=x[0],V=x[1];x=x[2];
for(let Y=A,W=3*A;Y<q;++Y){var D=H[W]*M,C=J[D],B=J[D+1],v=J[D+2],E=H[W+1]*M;D=J[E];var F=J[E+1];E=J[E+2];var L=H[W+2]*M,N=J[L],I=J[L+1];L=J[L+2];W+=3;D-=C;F-=B;E-=v;N-=C;I-=B;L-=v;var G=V*L-I*x,K=x*N-L*S;const ba=S*I-N*V,ca=D*G+F*K+E*ba;if(!(Math.abs(ca)<=Number.EPSILON)){C=O-C;B=Q-B;v=y-v;G=C*G+B*K+v*ba;if(0<ca){if(0>G||G>ca)continue}else if(0<G||G<ca)continue;K=B*E-F*v;v=v*D-E*C;B=C*F-D*B;C=S*K+V*v+x*B;if(0<ca){if(0>C||G+C>ca)continue}else if(0<C||G+C<ca)continue;B=(N*K+I*v+L*B)/ca;0<=B&&(v=this.indices[Y]+
this.firstTriangleIndex,D=t.computeNormal(D,F,E,N,I,L,z),this.callback(B,D,v))}}}d.numFacesTested+=q-A};g.intersectRay=function(A,q){d.numFacesTested=0;var y=f.fromValues(A.r0[0],A.r0[1],A.r0[2]);{A=f.fromValues(A.r1[0],A.r1[1],A.r1[2]);const x=f.create();u.sub(x,A,y);A=x}1E-6>u.squaredLength(A)||(this.rayOrigin=y,this.rayDirection=A,y=this.triangleVertexIndices.length/3,this.callback=q,this.intersectRayBSP(this.bspNodeTree[0],0,y))};g.intersectRayBSP=function(A,q,y){const x=this.rayOrigin,D=this.rayDirection;
if(w(A.aabb,x,D)){var C=A.axis,B=A.d;if(x[C]<B||0>D[C]){const v=A.midStartIndex;if(q<v){const E=A.leftNode;void 0!==E?this.intersectRayBSP(E,q,v):this.intersectRayTriangleRange(q,v)}}this.intersectRayTriangleRange(A.midStartIndex,A.rightStartIndex);if(x[C]>B||0<D[C])q=A.rightStartIndex,q<y&&(A=A.rightNode,void 0!==A?this.intersectRayBSP(A,q,y):this.intersectRayTriangleRange(q,y))}};return d}();m.numFacesTested=0;const z=f.create(),r=f.fromValues(Infinity,Infinity,Infinity),c=f.fromValues(-Infinity,
-Infinity,-Infinity);a.ComponentIntersectionData=m;a.componentMinimalSizeForIntersectionData=40;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(a){function u(f=!0){return{isVisibleBit:!f,data:new Uint32Array(0)}}a.defaultVisibilities=u;a.getVisibility=function(f,p){if(null==f)return!0;const {isVisibleBit:t,data:w}=f,e=8*w.BYTES_PER_ELEMENT;return p<w.length*e?(f=p/e|0,p=0!==(w[f]&1<<p-f*e)===t):!f.isVisibleBit};
a.updateVisibilityWithCount=function(f,p,t,w){if(t>=p)return f;null==f&&(f=u());let e=f.data;const n=8*e.BYTES_PER_ELEMENT,b=t/n|0,h=t-n*b,k=e;w=w===f.isVisibleBit;t<k.length*n||!w||(t=Math.max(b+1,Math.ceil(1.5*k.length)),t=Math.min(t,((p-1)/n|0)+1),e=new Uint32Array(t),e.set(k));b<e.length&&(e[b]=e[b]&~(1<<h)|(w?1:0)<<h);f.data=e;return f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let u=
function(){function f(p,t,w,e){this.material=p;this.drawParameters=t;this.geometry=w;this.meta=e}f.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return f}();a.Renderable=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,u,f,p){let t=function(w){function e(n,
b,h,k){var l=w.call(this)||this;l.primitiveType=b;l.parameters=h;l.indexed=k;l.vao=n;return l}u._inheritsLoose(e,w);return e}(p.AutoDisposable);f.__decorate([p.autoDispose()],t.prototype,"vao",void 0);a.RenderGeometry=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,u){let f=function(){function p(w){this._objects=w}var t=p.prototype;t.submit=function(w,e){this._objects.preSubmit(e);
e=this._objects.visibleObjects;for(let n=0;n<e.length;n++){const b=e[n];b.renderable.material.submit(w,b)}};t.queryShadowCasterDepthRange=function(w){return this._objects.visibleObjects.length?u.computeDepthRange(w,this._objects.visibleObjects):null};return p}();a.RenderSubmitSystem=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){function l(N,I,G){return e.set(N,I.data[G+0],I.data[G+1],I.data[G+2])}function m(N,I){N.push(I[0]);N.push(I[1]);N.push(I[2])}function z(N,I,G,K){t.conjugate(C,N.quaternion);e.sub(B,I,N.center);e.transformQuat(B,B,C);const H=8*((B[0]<-N.halfSize[0]?-1:B[0]>N.halfSize[0]?1:0)+3*(B[1]<-N.halfSize[1]?-1:B[1]>N.halfSize[1]?1:0)+9*(B[2]<-N.halfSize[2]?-1:B[2]>N.halfSize[2]?1:0)+13);I=x[H];if(0===I)return I;f.fromQuat(D,N.quaternion);f.scale(D,D,N.halfSize);const J=(M,O)=>
{O=x[H+O+1];e.set(M,((O&1)<<1)-1,(O&2)-1,((O&4)>>1)-1);e.transformMat3(M,M,D);return e.add(M,N.center,M)};G.length=0;m(G,J(v,0));m(G,J(E,1));m(G,J(B,2));m(G,J(F,3));K(G);if(1===I)return I;G.length=0;m(G,v);m(G,F);m(G,J(B,4));m(G,J(L,5));K(G);if(2===I)return I;G.length=0;m(G,v);m(G,L);m(G,J(B,6));m(G,E);K(G);return I}function r(N,I){let G=0;for(let K=0;4>K;K++){const H=h.intersectPlane(N,I[K]);if(0<H)return-1;0===H&&(G|=1<<K)}return G}const c=new u({allocator:N=>N||{near:Infinity,far:-Infinity,mask:0,
object:null},deallocator:N=>{N.object=null;return N}}),d=k.empty(),g=n.create(),A=n.create(),q=new u({deallocator:null}),y=new u({deallocator:null}),x=(()=>{const N=new Int8Array(216);let I=0;const G=K=>{for(let H=0;H<K.length;H++)N[I+H]=K[H];I+=8};G([3,0,6,2,3,1,5,4]);G([2,0,2,3,1,5,4,0]);G([3,1,0,2,3,7,5,4]);G([2,0,1,3,2,6,4,0]);G([1,0,1,3,2,0,0,0]);G([2,1,5,7,3,2,0,0]);G([3,2,0,1,3,7,6,4]);G([2,2,0,1,3,7,6,0]);G([3,3,0,1,5,7,6,2]);G([2,0,1,5,4,6,2,0]);G([1,0,1,5,4,0,0,0]);G([2,1,3,7,5,4,0,0]);
G([1,0,2,6,4,0,0,0]);G([0,0,0,0,0,0,0,0]);G([1,1,3,7,5,0,0,0]);G([2,2,3,7,6,4,0,0]);G([1,2,3,7,6,0,0,0]);G([2,3,1,5,7,6,2,0]);G([3,4,0,1,5,7,6,2]);G([2,5,7,6,4,0,1,0]);G([3,5,0,1,3,7,6,4]);G([2,4,5,7,6,2,0,0]);G([1,4,5,7,6,0,0,0]);G([2,5,1,3,7,6,4,0]);G([3,6,0,2,3,7,5,4]);G([2,6,2,3,7,5,4,0]);G([3,7,6,2,3,1,5,4]);return N})(),D=p.create(),C=w.create(),B=n.create(),v=n.create(),E=n.create(),F=n.create(),L=n.create();a.computeDepthRange=function(N,I){const G=k.empty(),{eye:K,frustum:H,viewForward:J}=
N;for(N=0;N<I.length;N++){var M=I[N].obb;const O=e.dot(e.sub(B,M.center,K),J),Q=h.projectedRadius(M,J);if(k.within(G,O-Q)&&k.within(G,O+Q))continue;M=r(M,H);if(-1===M)continue;if(0===M){d.far=O+Q;d.near=O-Q;k.union(G,d);continue}const S=c.pushNew();S.near=O-Q;S.far=O+Q;S.mask=M;S.object=I[N]}for(I=0;I<c.length;I++){const O=c.data[I];k.within(G,O.near)&&k.within(G,O.far)||(d.far=O.far,d.near=Infinity,0===z(O.object.obb,K,q,Q=>{var S=y;for(var V=0;4>V&&0<Q.length;V++)if(0!==(O.mask&1<<V)){{var Y=H[V],
W=Q,ba=S;ba.length=0;const ca=W.length-3;l(g,W,ca);const da=b.signedDistance(Y,g);0>=da&&(ba.push(g[0]),ba.push(g[1]),ba.push(g[2]));let ha=0,fa=da;for(ha;ha<ca;ha+=3){l(A,W,ha);const R=b.signedDistance(Y,A);0>fa*R&&(e.lerp(g,A,g,R/(R-fa)),m(ba,g));0>=R&&m(ba,A);fa=R;e.copy(g,A)}0>fa*da&&(l(A,W,ca),e.lerp(g,A,g,da/(da-fa)),m(ba,g))}Y=Q;Q=S;S=Y}for(S=0;S<Q.length;S+=3)e.set(g,Q.data[S+0],Q.data[S+1],Q.data[S+2]),V=e.dot(e.sub(g,g,K),J),d.near=Math.min(d.near,V)})&&(d.near=0),k.union(G,d))}c.length=
0;return G};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function u(p,t){return{near:p,far:t}}function f(p,t,w){p.near=t;p.far=w;return p}a.ZERO={near:0,far:0};a.create=u;a.empty=function(p){return p?f(p,Infinity,-Infinity):u(Infinity,-Infinity)};a.set=f;a.union=function(p,t,w=p){w.near=Math.min(p.near,t.near);w.far=Math.max(p.far,t.far);return w};a.within=function(p,t){return p.near<=t&&t<=p.far};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout"],function(a,u){a.createVertexBufferLayout=function(f){const p=u.newLayout().vec3f("position");f.normals&&p.vec2i16("normalCompressed",{glNormalized:!0});1===f.textureCoordinates?p.vec2f("uv0"):2===f.textureCoordinates&&(p.vec2f("uv0"),p.vec4u16("uvRegion",{glNormalized:!0}));f.colors&&p.vec4u8("color",{glNormalized:!0});return p.alignTo(4)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ./ComponentTechnique ../../../../../../chunks/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(g){switch(g){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}let r=function(g){function A(){var y=g.apply(this,arguments)||this;y.baseColor=n.fromValues(1,1,1,1);y.usePBR=!1;y.hasParametersFromSource=!1;y.mrrFactors=w.fromValues(1,1,.5);y.emissiveFactor=w.fromValues(0,0,0);y.baseColorTexture=null;y.metallicRoughnessTexture=null;y.emissionTexture=null;y.occlusionTexture=null;y.normalTexture=null;y.overlayTexOffset=b.fromValues(-1,
-1,-1,-1);y.overlayTexScale=b.fromValues(0,0,0,0);y.overlayColor=null;y.overlayHighlight=null;y.overlayNormal=null;y.objectOpacity=1;y.commonMaterialParameters=new c;y.componentParameters=new d;y.alphaCutoff=m.defaultMaskAlphaCutoff;y.alphaDiscardMode=1;y.isIntegratedMesh=!1;y.polygonOffsetEnabled=!1;y.ellipsoidMode=1;y.sceneHasOcludees=!1;y._techniqueConfig=new h.ComponentTechniqueConfiguration;return y}u._inheritsLoose(A,g);var q=A.prototype;q.dispose=function(){this._technique=p.releaseMaybe(this._technique);
this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};q.getTechnique=function(y,x,D){const C=this._techniqueConfig;C.hasVertexColors=D.colors;C.hasNormals=D.normals;C.vertexTextureCoordinates=D.textureCoordinates;C.usePBR=this.usePBR;C.hasMetalnessAndRoughnessTexture=p.isSome(this.metallicRoughnessTexture);C.hasEmissionTexture=p.isSome(this.emissionTexture);C.hasOcclusionTexture=p.isSome(this.occlusionTexture);C.hasNormalTexture=p.isSome(this.normalTexture);
C.transparencyPassType=0===x.identifier&&null!=x.transparencyPassType?x.transparencyPassType:3;C.multipassTerrainEnabled=0===x.identifier&&null!=x.multipassTerrainParams?x.multipassTerrainParams.multipassTerrainEnabled:!1;C.cullAboveGround=0===x.identifier&&null!=x.multipassTerrainParams?x.multipassTerrainParams.cullAboveGround:!1;C.ellipsoidMode=this.ellipsoidMode;this.dirty&&(C.componentData=this.componentParameters.type,C.cullFace=this.commonMaterialParameters.cullFace,C.doubleSidedMode=this.commonMaterialParameters.doubleSided?
1:0,C.baseColorTexture=p.isSome(this.baseColorTexture),C.isSchematic=this.hasParametersFromSource&&!p.isSome(this.baseColorTexture),D=this._computeWhichMaterialPass(),C.blendingEnabled=1===D||2===D,C.alphaDiscardMode=this.alphaDiscardMode,C.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?3:2:1:0,C.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());C.slicePlaneEnabled=x.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===x.identifier?(C.output=
3,C.vertexDiscardMode=0):2===x.identifier?(C.output=4,C.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?C.vertexDiscardMode=x.transparent?2:1:C.vertexDiscardMode=0,C.output=z(x.subPass),1===x.subPass&&(C.sceneHasOcludees=x.sceneHasOcludees),0===x.subPass?(C.receiveAmbientOcclusion=x.ambientOcclusionEnabled,C.sceneHasOcludees=x.sceneHasOcludees,C.receiveShadows=x.shadowsEnabled,C.ssrEnabled=x.ssrParams.ssrEnabled):(C.receiveAmbientOcclusion=!1,C.receiveShadows=!1));return this._technique=
y.releaseAndAcquire(h.ComponentTechnique,C,this._technique)};q.submit=function(y,x){if(0!==this.objectOpacity){var D=x.renderable.geometry,C=x.components,B=x.renderable.drawParameters;x=x.renderable.meta.cameraDepthSquared;var v=C.geometryRanges,E=C.highlightRanges;C=C.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:y.materialOpaque.submitDraw(this,D,v,B,x);break;case 1:y.materialTransparent.submitDraw(this,D,v,B,x);break;case 2:y.materialOpaque.submitDraw(this,D,v,B,x);y.materialTransparent.submitDraw(this,
D,v,B,x);break;case 3:y.materialIntegratedMesh.submitDraw(this,D,v,B,x),this.overlayHighlight&&y.highlightIntegratedMesh.submitDraw(this,D,v,B,x)}p.isSome(y.shadowMap)&&2!==this.componentParameters.castShadows&&y.shadowMap.submitDraw(this,D,v,B,x);p.isSome(y.highlight)&&p.isSome(E)&&y.highlight.submitDraw(this,D,E,B,x);p.isSome(y.highlightShadowMap)&&2!==this.componentParameters.castShadows&&p.isSome(E)&&y.highlightShadowMap.submitDraw(this,D,E,B,x);p.isSome(y.defaultShadowMap)&&2!==this.componentParameters.castShadows&&
p.isSome(C)&&y.defaultShadowMap.submitDraw(this,D,C,B,x)}};q._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};u._createClass(A,[{key:"attributeLocations",get:function(){return k.attributeLocations}}]);return A}(l.MaterialBase);f.__decorate([l.parameter({vectorOps:e.vec4})],
r.prototype,"baseColor",void 0);f.__decorate([l.parameter()],r.prototype,"usePBR",void 0);f.__decorate([l.parameter()],r.prototype,"hasParametersFromSource",void 0);f.__decorate([l.parameter({vectorOps:t.vec3})],r.prototype,"mrrFactors",void 0);f.__decorate([l.parameter({vectorOps:t.vec3})],r.prototype,"emissiveFactor",void 0);f.__decorate([l.parameter({dispose:!0})],r.prototype,"baseColorTexture",void 0);f.__decorate([l.parameter({dispose:!0})],r.prototype,"metallicRoughnessTexture",void 0);f.__decorate([l.parameter({dispose:!0})],
r.prototype,"emissionTexture",void 0);f.__decorate([l.parameter({dispose:!0})],r.prototype,"occlusionTexture",void 0);f.__decorate([l.parameter({dispose:!0})],r.prototype,"normalTexture",void 0);f.__decorate([l.parameter({vectorOps:{equals:e.exactEquals,copy:e.copy}})],r.prototype,"overlayTexOffset",void 0);f.__decorate([l.parameter({vectorOps:{equals:e.exactEquals,copy:e.copy}})],r.prototype,"overlayTexScale",void 0);f.__decorate([l.parameter()],r.prototype,"overlayColor",void 0);f.__decorate([l.parameter()],
r.prototype,"overlayHighlight",void 0);f.__decorate([l.parameter()],r.prototype,"overlayNormal",void 0);f.__decorate([l.parameter()],r.prototype,"objectOpacity",void 0);f.__decorate([l.parameterBlock()],r.prototype,"commonMaterialParameters",void 0);f.__decorate([l.parameterBlock()],r.prototype,"componentParameters",void 0);f.__decorate([l.parameter()],r.prototype,"alphaCutoff",void 0);f.__decorate([l.parameter()],r.prototype,"alphaDiscardMode",void 0);f.__decorate([l.parameter()],r.prototype,"isIntegratedMesh",
void 0);f.__decorate([l.parameter()],r.prototype,"polygonOffsetEnabled",void 0);f.__decorate([l.parameter()],r.prototype,"ellipsoidMode",void 0);f.__decorate([l.parameter()],r.prototype,"sceneHasOcludees",void 0);let c=function(g){function A(){var q=g.apply(this,arguments)||this;q.doubleSided=!1;q.cullFace=2;q.slicePlaneEnabled=!0;return q}u._inheritsLoose(A,g);return A}(l.MaterialParameterBlock);f.__decorate([l.parameter()],c.prototype,"doubleSided",void 0);f.__decorate([l.parameter()],c.prototype,
"cullFace",void 0);f.__decorate([l.parameter()],c.prototype,"slicePlaneEnabled",void 0);let d=function(g){function A(){var q=g.apply(this,arguments)||this;q.externalColor=n.fromValues(1,1,1,1);q.externalColorMixMode=1;q.castShadows=0;return q}u._inheritsLoose(A,g);u._createClass(A,[{key:"transparent",get:function(){return 1>this.externalColor[3]?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}},{key:"visible",get:function(){return 0<this.externalColor[3]?
0:2}},{key:"type",get:function(){return 0}}]);return A}(l.MaterialParameterBlock);f.__decorate([l.parameter({vectorOps:e.vec4})],d.prototype,"externalColor",void 0);f.__decorate([l.parameter()],d.prototype,"externalColorMixMode",void 0);f.__decorate([l.parameter()],d.prototype,"castShadows",void 0);t=function(g){function A(){var q=g.apply(this,arguments)||this;q.texture=null;q.transparent=2;q.opaqueOverride=2;q.castShadows=2;return q}u._inheritsLoose(A,g);u._createClass(A,[{key:"type",get:function(){return 1}}]);
return A}(l.MaterialParameterBlock);f.__decorate([l.parameter()],t.prototype,"texture",void 0);f.__decorate([l.parameter()],t.prototype,"transparent",void 0);f.__decorate([l.parameter()],t.prototype,"opaqueOverride",void 0);f.__decorate([l.parameter()],t.prototype,"castShadows",void 0);a.CommonMaterialParameters=c;a.ComponentMaterial=r;a.ComponentParametersUniform=d;a.ComponentParametersVarying=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){c=function(x){function D(){return x.apply(this,arguments)||this}f._inheritsLoose(D,x);var C=D.prototype;C.bindPass=function(B){const v=this.program;h.VertexPosition.bindViewProjTransform(v,B.viewTransform);b.bindSliceUniforms(this.program,this.configuration,B.slicePlane);0===B.identifier&&(void 0!==B.ssrParams&&m.bindSSRUniforms(this.program,B.ssrParams),v.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",B.transformNormal_ViewFromGlobal),2===
B.subPass&&v.setUniform2fv("cameraNearFar",B.cameraNearFar),0===B.subPass&&B.lighting.setUniforms(this.program,B.integratedMesh));1===B.identifier&&this.program.setUniform2fv("cameraNearFar",B.cameraNearFar)};C.bindMaterial=function(B,v){const E=this.program;E.setUniform4fv("uBaseColor",B.baseColor);E.setUniform1f("uObjectOpacity",B.objectOpacity);E.setUniform1f("textureAlphaCutoff",B.alphaCutoff);1===B.componentParameters.type?B.componentParameters.texture.bind(E,"uComponentColorTex","uComponentColorTexInvDim"):
(E.setUniform4fv("uExternalColor",B.componentParameters.externalColor),E.setUniform1i("uExternalColorMixMode",B.componentParameters.externalColorMixMode));t.isSome(B.baseColorTexture)&&B.baseColorTexture.bind(E,"uBaseColorTexture","uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)l.bindPBRUniforms(this.program,B,this.configuration.isSchematic),t.isSome(B.metallicRoughnessTexture)&&B.metallicRoughnessTexture.bind(E,"texMetallicRoughness","texMetallicRoughnessSize"),
t.isSome(B.emissionTexture)&&B.emissionTexture.bind(E,"texEmission","texEmissionSize"),t.isSome(B.occlusionTexture)&&B.occlusionTexture.bind(E,"texOcclusion","texOcclusionSize"),t.isSome(B.normalTexture)&&B.normalTexture.bind(E,"normalTexture","normalTextureSize");B.isIntegratedMesh&&(0===v.identifier&&0===v.subPass?(E.bindTexture(B.overlayColor,"ovColorTex"),E.bindTexture(B.overlayNormal,"ovNormalTex")):2===v.identifier&&E.bindTexture(B.overlayHighlight,"ovColorTex"),E.setUniform1f("overlayOpacity",
1));2===v.identifier&&k.bindOutputHighlight(this.program,v);0===v.identifier&&0===v.subPass&&(v.ambientOcclusionEnabled&&v.bindAmbientOcclusion(E),v.shadowsEnabled&&v.bindShadowMap(E));0!==v.identifier||0!==v.subPass&&1!==v.subPass||!v.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("cameraNearFar",v.cameraNearFar),E.setUniform2fv("inverseViewport",v.inverseViewport),v.multipassTerrainParams.terrainLinearDepthTexture&&E.bindTexture(v.multipassTerrainParams.terrainLinearDepthTexture,
"terrainDepthTexture"))};C.bindDraw=function(B,v){h.VertexPosition.bindModelTransform(this.program,B);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",B.transformNormal_GlobalFromModel);this.program.rebindTextures();if(v.isIntegratedMesh){const E=v.overlayTexScale;v=v.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[B.toMapSpace[0]*E[0]+v[0],B.toMapSpace[1]*E[1]+v[1],B.toMapSpace[0]*E[2]+v[2],B.toMapSpace[1]*E[3]+v[3]]);this.program.setUniform4fv("overlayTexScale",
[B.toMapSpace[2]*E[0],B.toMapSpace[3]*E[1],B.toMapSpace[2]*E[2],B.toMapSpace[3]*E[3]])}};C.initializeProgram=function(B){const v=D.shader.get();var E=this.configuration;E=v.build({multipassTerrainEnabled:E.multipassTerrainEnabled,cullAboveGround:E.cullAboveGround,OITEnabled:0===E.transparencyPassType,output:E.output,normalType:0===E.integratedMeshMode?E.hasNormals?1:3:2,attributeColor:E.hasVertexColors,attributeTextureCoordinates:E.vertexTextureCoordinates,componentData:E.componentData,alphaDiscardMode:E.alphaDiscardMode,
baseColorTexture:E.baseColorTexture,doubleSidedMode:E.doubleSidedMode,receiveAmbientOcclusion:E.receiveAmbientOcclusion,receiveShadows:E.receiveShadows,slicePlaneEnabled:E.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:B.viewingMode,vertexDiscardMode:E.vertexDiscardMode,pbrMode:3===E.integratedMeshMode?4:E.usePBR?E.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:E.hasMetalnessAndRoughnessTexture,hasEmissionTexture:E.hasEmissionTexture,hasOcclusionTexture:E.hasOcclusionTexture,
hasNormalTexture:E.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:z.doublePrecisionRequiresObfuscation(B.rctx),overlayEnabled:2===E.integratedMeshMode||3===E.integratedMeshMode,ssrEnabled:E.ssrEnabled,highStepCount:!1,ellipsoidMode:E.ellipsoidMode});return new A.Program(B.rctx,E,v.attributeLocations)};C.setPipelineState=function(B){const v=this.configuration,E=0!==v.integratedMeshMode,F=3===B,L=2===B;return y.makePipelineState({blending:0!==v.output&&
7!==v.output||!v.blendingEnabled?null:F?g.blendingDefault:g.OITBlending(B),culling:y.cullingParams(v.cullFace),depthTest:{func:g.OITDepthTest(B)},depthWrite:F||L?y.defaultDepthWriteParams:null,colorWrite:y.defaultColorWriteParams,stencilWrite:E||v.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:E?q.replaceBitWhenDepthTestPasses(1):v.sceneHasOcludees?q.stencilBaseAllZerosParams:null,polygonOffset:F||L?v.polygonOffsetEnabled?{factor:2,units:2}:null:g.OITPolygonOffset})};C.initializePipeline=
function(){return this.setPipelineState(this.configuration.transparencyPassType)};return D}(c.ShaderTechnique);c.shader=new r.ReloadableShaderModule(n.ComponentShader,()=>new Promise(function(x,D){a(["./shader/ComponentShader.glsl"],x,D)}));n=function(x){function D(){var C=x.apply(this,arguments)||this;C.transformNormal_GlobalFromModel=w.create();C.toMapSpace=e.create();return C}f._inheritsLoose(D,x);return D}(h.VertexPosition.ModelTransform);r=function(x){function D(){var C=x.apply(this,arguments)||
this;C.output=0;C.hasVertexColors=!1;C.hasNormals=!1;C.vertexTextureCoordinates=0;C.componentData=0;C.slicePlaneEnabled=!1;C.cullFace=2;C.baseColorTexture=!1;C.receiveAmbientOcclusion=!0;C.receiveShadows=!0;C.vertexDiscardMode=0;C.doubleSidedMode=2;C.blendingEnabled=!0;C.alphaDiscardMode=1;C.integratedMeshMode=0;C.ssrEnabled=!1;C.polygonOffsetEnabled=!1;C.usePBR=!1;C.isSchematic=!1;C.hasMetalnessAndRoughnessTexture=!1;C.hasEmissionTexture=!1;C.hasOcclusionTexture=!1;C.hasNormalTexture=!1;C.sceneHasOcludees=
!1;C.transparencyPassType=3;C.ellipsoidMode=1;C.multipassTerrainEnabled=!1;C.cullAboveGround=!1;return C}f._inheritsLoose(D,x);return D}(d.ShaderTechniqueConfiguration);p.__decorate([d.parameter({count:8})],r.prototype,"output",void 0);p.__decorate([d.parameter()],r.prototype,"hasVertexColors",void 0);p.__decorate([d.parameter()],r.prototype,"hasNormals",void 0);p.__decorate([d.parameter({count:3})],r.prototype,"vertexTextureCoordinates",void 0);p.__decorate([d.parameter({count:2})],r.prototype,"componentData",
void 0);p.__decorate([d.parameter()],r.prototype,"slicePlaneEnabled",void 0);p.__decorate([d.parameter({count:3})],r.prototype,"cullFace",void 0);p.__decorate([d.parameter()],r.prototype,"baseColorTexture",void 0);p.__decorate([d.parameter()],r.prototype,"receiveAmbientOcclusion",void 0);p.__decorate([d.parameter()],r.prototype,"receiveShadows",void 0);p.__decorate([d.parameter({count:3})],r.prototype,"vertexDiscardMode",void 0);p.__decorate([d.parameter({count:3})],r.prototype,"doubleSidedMode",
void 0);p.__decorate([d.parameter()],r.prototype,"blendingEnabled",void 0);p.__decorate([d.parameter({count:4})],r.prototype,"alphaDiscardMode",void 0);p.__decorate([d.parameter({count:4})],r.prototype,"integratedMeshMode",void 0);p.__decorate([d.parameter()],r.prototype,"ssrEnabled",void 0);p.__decorate([d.parameter()],r.prototype,"polygonOffsetEnabled",void 0);p.__decorate([d.parameter()],r.prototype,"usePBR",void 0);p.__decorate([d.parameter()],r.prototype,"isSchematic",void 0);p.__decorate([d.parameter()],
r.prototype,"hasMetalnessAndRoughnessTexture",void 0);p.__decorate([d.parameter()],r.prototype,"hasEmissionTexture",void 0);p.__decorate([d.parameter()],r.prototype,"hasOcclusionTexture",void 0);p.__decorate([d.parameter()],r.prototype,"hasNormalTexture",void 0);p.__decorate([d.parameter()],r.prototype,"sceneHasOcludees",void 0);p.__decorate([d.parameter({count:4})],r.prototype,"transparencyPassType",void 0);p.__decorate([d.parameter({count:4})],r.prototype,"ellipsoidMode",void 0);p.__decorate([d.parameter()],
r.prototype,"multipassTerrainEnabled",void 0);p.__decorate([d.parameter()],r.prototype,"cullAboveGround",void 0);u.ComponentDrawParameters=n;u.ComponentTechnique=c;u.ComponentTechniqueConfiguration=r;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){function v(L){const N=new B.ShaderBuilder;N.include(h.VertexPosition,L);N.include(b.VertexNormal,L);N.include(n.VertexColor,L);N.include(e.TextureCoordinateAttribute,L);N.include(t.ForwardLinearDepth,L);N.include(f.ComponentData,L);N.include(D.DiscardOrAdjustAlpha,L);N.include(w.Slice,L);N.include(q.ReadBaseColorTexture,L);N.include(p.VertexDiscardByOpacity,L);N.fragment.uniforms.add("view","mat4");if(1===L.pbrMode||2===L.pbrMode)N.include(A.PhysicallyBasedRenderingParameters,
L),L.hasNormalTexture&&N.include(r.ComputeNormalTexture,L);3===L.output&&1===L.componentData?N.vertex.code.add(C.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):N.vertex.code.add(C.glsl`#define discardShadows(castShadows) {}`);const I=L.overlayEnabled&&0===L.output&&4===L.pbrMode;L.overlayEnabled&&(N.include(x.Overlay,L),1===L.viewingMode?N.vertex.code.add(C.glsl`
      const float invEllipsoidRadius = ${C.glsl.float(1/(1===L.ellipsoidMode?u.earth.radius:2===L.ellipsoidMode?u.mars.radius:u.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):N.vertex.code.add(C.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));I&&(N.varyings.add("tbnTangent","vec3"),N.varyings.add("tbnBiTangent","vec3"),N.varyings.add("groundNormal","vec3"),N.varyings.add("positionView","vec3"));N.vertex.code.add(C.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${C.glsl.float(D.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${I?C.glsl`
        positionView = position_view();
        ${1===L.viewingMode?C.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:C.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${L.overlayEnabled?C.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);7===L.output&&(N.fragment.include(m.ReadLinearDepth),L.multipassTerrainEnabled&&N.include(g.multipassTerrainTest,L),N.include(z.ComputeMaterialColor,L),N.fragment.code.add(C.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${L.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${L.overlayEnabled?C.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));0===L.output&&(N.fragment.include(m.ReadLinearDepth),L.multipassTerrainEnabled&&N.include(g.multipassTerrainTest,L),N.include(z.ComputeMaterialColor,L),N.include(c.ComputeShadingNormal,L),N.include(d.EvaluateSceneLighting,L),I&&N.fragment.uniforms.add("ovNormalTex","sampler2D"),L.receiveShadows?(N.include(y.ReadShadowMap,L),N.fragment.code.add(C.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):N.fragment.code.add(C.glsl`float evaluateShadow() { return 0.0; }`),N.fragment.code.add(C.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${L.multipassTerrainEnabled?C.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${L.overlayEnabled?C.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===L.pbrMode||2===L.pbrMode?(N.fragment.code.add(C.glsl`
        ${1===L.pbrMode?C.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),L.hasNormalTexture?N.fragment.code.add(C.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):N.fragment.code.add(C.glsl`vec3 shadingNormal = normalVertex;`),N.fragment.code.add(C.glsl`${1===L.viewingMode?C.glsl`vec3 normalGround = normalize(positionWorld());`:C.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),N.fragment.code.add(C.glsl`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(L.receiveShadows?N.fragment.code.add(C.glsl`float shadow = evaluateShadow();`):1===L.viewingMode?N.fragment.code.add(C.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):N.fragment.code.add(C.glsl`float shadow = 0.0;`),N.fragment.code.add(C.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${I?C.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),N.fragment.code.add(C.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${L.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===L.output||3===L.output)N.include(k.OutputDepth,L),N.fragment.code.add(C.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);2===L.output&&(N.include(c.ComputeShadingNormal,L),N.fragment.code.add(C.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===L.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));4===L.output&&(N.include(l.OutputHighlight),N.fragment.code.add(C.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${L.overlayEnabled?C.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return N}const E=new Map([["position",0],["normal",1],["normalCompressed",1],["color",2],["uv0",3],["uvRegion",4],["componentIndex",5]]);var F=Object.freeze({__proto__:null,attributeLocations:E,build:v});a.ComponentShader=F;a.attributeLocations=E;a.build=v})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(a,u,f){a.ComponentData=function(p,t){1===
t.componentData&&(p.vertex.uniforms.add("uComponentColorTex","sampler2D"),p.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),p.attributes.add("componentIndex","float"),p.varyings.add("vExternalColorMixMode","mediump float"),p.varyings.add("vExternalColor","vec4"),p.include(u.DecodeSymbolColor),p.vertex.code.add(f.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
);
return texture2D(uComponentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),p.fragment.code.add(f.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`));0===t.componentData&&(p.vertex.uniforms.add("uExternalColor","vec4"),p.fragment.uniforms.add("uExternalColorMixMode","int"),p.varyings.add("vExternalColor","vec4"),p.vertex.code.add(f.glsl`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = uExternalColor;
castShadows = true;
return uExternalColor;
}`),p.fragment.code.add(f.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = uExternalColorMixMode;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,u){a.VertexDiscardByOpacity=function(f,p){f=f.vertex;f.code.add(u.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(p.vertexDiscardMode){case 0:f.code.add(u.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case 2:f.code.add(u.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case 1:f.code.add(u.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.ComputeMaterialColor=function(t,w){t.include(u.VertexColor,
w);t.fragment.include(f.MixExternalColor);t=t.fragment;t.uniforms.add("uBaseColor","vec4");t.uniforms.add("uObjectOpacity","float");w.attributeColor?t.code.add(p.glsl`vec3 _baseColor() {
return uBaseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a * vColor.a;
}`):t.code.add(p.glsl`vec3 _baseColor() {
return uBaseColor.rgb;
}
float _baseOpacity() {
return uBaseColor.a;
}`);t.code.add(p.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = uObjectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define(["exports","../attributes/VertexNormal.glsl","../attributes/VertexPosition.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.ComputeShadingNormal=function(t,w){const e=t.fragment;0===w.doubleSidedMode?e.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`):1===w.doubleSidedMode?(t.include(f.VertexPosition,w),e.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),e.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
return dot(normal, viewDir) > 0.0 ? -normal : normal;
}`)):2===w.doubleSidedMode&&e.code.add(p.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);0===w.normalType||1===w.normalType?(t.include(u.VertexNormal,w),e.code.add(p.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`)):3===w.normalType?(t.extensions.add("GL_OES_standard_derivatives"),t.include(f.VertexPosition,w),e.code.add(p.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`)):2===w.normalType&&(1===w.viewingMode?(t.include(f.VertexPosition,w),e.code.add(p.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):2===w.viewingMode&&e.code.add(p.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),e.code.add(p.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,u,f,p){a.ReadBaseColorTexture=function(t,w){const e=t.fragment;w.baseColorTexture?(t.include(u.VertexTextureCoordinates,w),e.uniforms.add("uBaseColorTexture","sampler2D"),e.uniforms.add("uBaseColorTextureSize",
"vec2"),2===w.attributeTextureCoordinates?(t.include(f.TextureAtlasLookup),e.code.add(p.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(
uBaseColorTexture,
uBaseColorTextureSize,
vuv0,
vuvRegion
);
}`)):e.code.add(p.glsl`vec4 readBaseColorTexture() {
return texture2D(uBaseColorTexture, vuv0);
}`)):e.code.add(p.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function t(){this._dirty=!0}var w=t.prototype;w._setDirty=function(){this._dirty=!0};w._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const e of this._parameterBlocks)this[e]._setClean()};
w._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1};u._createClass(t,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return t}(),p=function(){function t(){this._dirty=!0}var w=t.prototype;w._setDirty=function(){this._dirty=!0};w._setClean=function(){this._dirty=!1};u._createClass(t,[{key:"dirty",get:function(){return this._dirty}}]);return t}();a.MaterialBase=
f;a.MaterialParameterBlock=p;a.parameter=function(t={}){return(w,e)=>{var n;const b=null!=(n=w._parameterCount)?n:0;w._parameterCount=b+1;if(t.vectorOps){const h=t.vectorOps;Object.defineProperty(w,e,{get(){return this[b]},set(k){const l=this[b];if(null==l)this[b]=k;else{if(h.equals(l,k))return;h.copy(l,k)}this._setDirty()}})}else Object.defineProperty(w,e,{get(){return this[b]},set(h){this[b]!==h&&(t.dispose&&this[b]&&this[b].dispose(),this[b]=h,this._setDirty())}})}};a.parameterBlock=function(){return(t,
w)=>{var e;const n=null!=(e=t._parameterCount)?e:0;t._parameterCount=n+1;t._parameterBlocks=t._parameterBlocks||[];t._parameterBlocks.push(n);Object.defineProperty(t,w,{get(){return this[n]},set(b){this[n]!==b&&(this[n]=b,this._setDirty())}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],
function(a,u,f,p,t){let w=function(){function n(h){this._low=p.create();this._high=p.create();h&&this.set(h)}var b=n.prototype;b.set=function(h){const k=this._low,l=this._high;f.copy(k,h);f.sub(l,h,k)};b.setElements=function(h,k,l){f.set(e,h,k,l);this.set(e)};b.get=function(h){return f.add(h,this._low,this._high)};b.getLowScaled=function(h){return f.scale(h,this._low,1)};u._createClass(n,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return n}();const e=
t.create();a.TwoVectorPosition=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,u){let f=function(){function p(w,e=1){this.rctx=w;this.fieldCount=e;this.buffers=[]}var t=p.prototype;t.garbageCollect=function(){this.buffers=this.buffers.filter(w=>0===w.activeCount?(w.dispose(),!1):!0)};t.destroy=function(){this.buffers.forEach(w=>w.dispose());this.buffers=
[]};t.getBuffer=function(w){for(const e of this.buffers)if(e.availableCount>=w)return e;if(w>u.MAX_INDEX_COUNT)return null;w=new u.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(w);return w};t.updateTextures=function(){for(const w of this.buffers)w.textureBuffer.updateTexture()};return p}();a.BufferManager=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./SimpleIndexManager","./TextureBackedBuffer"],function(a,u,f,p){let t=function(){function w(n,b=1){this.textureBuffer=new p.TextureBackedBuffer(n,b);this.indexManager=new f.SimpleIndexManager(65536)}var e=w.prototype;e.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};e.acquireIndex=function(){const n=this.indexManager.acquire();this.textureBuffer.resizeToFit(n);return n};e.releaseIndex=function(n){this.indexManager.release(n)};u._createClass(w,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},
{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return w}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,u){let f=function(){function p(w){this.maxCount=w;this._nextIndex=0;this.recycledIndices=[]}var t=p.prototype;t.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};t.release=function(w){this.recycledIndices.push(w)};u._createClass(p,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);return p}();a.SimpleIndexManager=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports",
"../../../../../geometry/support/buffer/BufferView","../../../../webgl/Texture"],function(a,u,f){let p=function(){function t(e,n=1){this.rctx=e;this.fieldCount=n;this.textureWidth=4096;this.dirty=!0;this.texture=new f(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new u.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var w=t.prototype;w.dispose=function(){this.texture.dispose();this.data=this.texture=
void 0};w.setData=function(e,n,b,h,k,l){e=e*this.fieldCount+n;this.dirty=!0;this.data.set(e,0,b);this.data.set(e,1,h);this.data.set(e,2,k);this.data.set(e,3,l)};w.setDataElement=function(e,n,b,h){e=e*this.fieldCount+n;this.dirty=!0;this.data.set(e,b,h)};w.resizeToFit=function(e){e*=this.fieldCount;e>=this.data.count&&(e=new u.BufferViewVec4u8(new ArrayBuffer(Math.ceil((e+1)/this.textureWidth)*this.textureWidth*4)),e.typedBuffer.set(this.data.typedBuffer),this.data=e)};w.updateTexture=function(){if(this.dirty){var e=
this.texture.descriptor.width;this.data.count>e*this.texture.descriptor.height&&this.texture.resize(e,this.data.count/e);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};w.bind=function(e,n,b){e.bindTexture(this.texture,n);e.setUniform2f(b,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return t}();a.TextureBackedBuffer=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define(["../../../../core/maybe",
"./glUtil3D","../shaders/CompositingTechnique","../../../webgl/Util"],function(a,u,f,p){let t=function(){function e(b,h){this._rctx=b;this._techniqueRepository=h}var n=e.prototype;n.dispose=function(){this._vao=a.disposeMaybe(this._vao)};n.compositeTransparent=function(b,h,k,l=1){const m=this._rctx;w.alphaMode=1;w.function=2;w.hasOpacityFactor=1!==l;l=this._techniqueRepository.acquire(f.CompositingTechnique,w);m.useProgram(l.program);l.bindPipelineState(m);l.program.bindTexture(b,"colorTexture");
l.program.bindTexture(h,"alphaTexture");l.program.bindTexture(k,"frontFaceTexture");b=this.ensureVAO();m.bindVAO(b);m.drawArrays(5,0,p.vertexCount(b,"geometry"));l.release()};n.compositeSpecial=function(b,h){this.composite(b,0,1,h)};n.composite=function(b,h=0,k=1,l=0,m=0){const z=this._rctx;w.alphaMode=h;w.function=l;w.hasOpacityFactor=1!==k;h=this._techniqueRepository.acquire(f.CompositingTechnique,w);z.useProgram(h.program);h.bindPipelineState(z);h.program.bindTexture(b,"tex");w.hasOpacityFactor&&
h.program.setUniform1f("opacity",k);3===l&&h.program.setUniform1i("overlayIdx",m);b=this.ensureVAO();z.bindVAO(b);z.drawArrays(5,0,p.vertexCount(b,"geometry"));h.release()};n.ensureVAO=function(){a.isNone(this._vao)&&(this._vao=u.createQuadVAO(this._rctx));return this._vao};return e}();const w=new f.CompositingTechniqueConfiguration;return t})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){w=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build(this.configuration);return new b.Program(r.rctx,c,n.Default3D)};z.initializePipeline=function(){if(1===this.configuration.function)return k.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return k.makePipelineState({colorWrite:k.defaultColorWriteParams});
case 1:return k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),colorWrite:k.defaultColorWriteParams});default:return k.makePipelineState({blending:k.simpleBlendingParams(1,771),colorWrite:k.defaultColorWriteParams})}};return m}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(h.CompositingShader,()=>new Promise(function(l,m){a(["./Compositing.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.function=0;z.alphaMode=0;z.hasOpacityFactor=!1;
return z}f._inheritsLoose(m,l);return m}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:4})],t.prototype,"function",void 0);p.__decorate([e.parameter({count:3})],t.prototype,"alphaMode",void 0);p.__decorate([e.parameter()],t.prototype,"hasOpacityFactor",void 0);u.CompositingTechnique=w;u.CompositingTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f,p){function t(e){const n=new p.ShaderBuilder;n.include(u.ScreenSpacePass);n.fragment.uniforms.add("tex","sampler2D");0===e.function&&(e.hasOpacityFactor?(n.fragment.uniforms.add("opacity","float"),n.fragment.code.add(f.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):n.fragment.code.add(f.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`));3===e.function&&(n.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&n.fragment.uniforms.add("opacity","float"),n.fragment.code.add(f.glsl`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5+ 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
      }`));1===e.function&&n.fragment.code.add(f.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);2===e.function&&(n.fragment.uniforms.add("colorTexture","sampler2D"),n.fragment.uniforms.add("alphaTexture","sampler2D"),n.fragment.uniforms.add("frontFaceTexture","sampler2D"),n.fragment.code.add(f.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`));return n}var w=Object.freeze({__proto__:null,build:t});a.CompositingShader=w;a.build=t})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(I,G){if(G.isVisible){var K=m.empty(),H=G.getSpatialQueryAccelerator();f.isSome(H)?c(K,I,H):d(K,I,G.objects);return K}}function c(I,G,K){var H=G.eye;const J=G.viewForward,M=G.frustum,O=S=>S.isVisible;var Q=K.objectCount;500>Q?(m.set(E,G.near,Math.min(I.near,G.far)),K.forEachInDepthRange(H,J,1,E,(S,V)=>{g(I,G,S);E.far=I.near;V.setRange(E)},M,O),m.set(E,Math.max(I.far,G.near),G.far),K.forEachInDepthRange(H,J,-1,E,(S,V)=>{g(I,G,S);E.near=I.far;V.setRange(E)},
M,O)):(Q=Math.max(Math.min(Q,500),Math.ceil(.1*Q)),H=K.findClosest(J,1,M,O,Q),K=K.findClosest(J,-1,M,O,Q),H&&K&&(q(I,G,H.boundingVolumeWorldSpace.bounds),q(I,G,K.boundingVolumeWorldSpace.bounds)))}function d(I,G,K){F.clear();K.forAll(H=>{H.isVisible&&0!==H.getNumGeometryRecords()&&F.add(H)});F.empty||(F.sort(G),m.set(E,G.near,Math.min(I.near,G.far)),F.forEachInDepthRange(E,1,(H,J)=>{J<I.near&&g(I,G,H)}),m.set(E,Math.max(I.far,G.near),G.far),F.forEachInDepthRange(E,-1,(H,J,M)=>{I.far=Math.max(I.far,
M)}))}function g(I,G,K){if(K.isVisible&&h.intersectsSphere(G.frustum,K.boundingVolumeWorldSpace.bounds)){var H=K.transformation,J=v;K.geometryRecords.forEach(M=>{t.multiply(J,H,M.getShaderTransformation());const O=l.maxScale(J);A(I,G,M.geometry.boundingInfo,J,O)})}}function A(I,G,K,H,J){if(!f.isNone(K)){var M=G.eye,O=G.viewForward;e.transformMat4(B,K.center,H);M=O[0]*(B[0]-M[0])+O[1]*(B[1]-M[1])+O[2]*(B[2]-M[2]);B[3]=K.radius*J;if(!(M-B[3]>I.near&&M+B[3]<I.far)&&h.intersectsSphere(G.frustum,B))if(100<
K.radius&&K.getChildren())for(K=K.getChildren(),M=0;8>M;++M)K[M]&&A(I,G,K[M],H,J);else N.unionDepthRangeWithAABB(I,G.viewProjectionMatrix,H,K.bbMin,K.bbMax)}}function q(I,G,K){var H=G.eye;G=G.viewForward;H=(K[0]-H[0])*G[0]+(K[1]-H[1])*G[1]+(K[2]-H[2])*G[2];I.near=Math.min(I.near,H-K[3]);I.far=Math.max(I.far,H+K[3])}let y=function(){function I(){this._items=new p({allocator:K=>K||{obj:null,distance:0,near:0,far:0},deallocator:K=>{K.obj=null;K.distance=0;K.near=0;K.far=0;return K}})}var G=I.prototype;
G.clear=function(){this._items.clear()};G.add=function(K){this._items.pushNew().obj=K};G.sort=function(K){const H=K.eye,J=K.viewForward;this._items.forAll(M=>{const O=M.obj.boundingVolumeWorldSpace.bounds,Q=(O[0]-H[0])*J[0]+(O[1]-H[1])*J[1]+(O[2]-H[2])*J[2];M.distance=Q;M.near=Q-O[3];M.far=Q+O[3]});this._items.sort((M,O)=>M.distance-O.distance)};G.forEachInDepthRange=function(K,H,J){if(1===H)for(H=0;H<this._items.length;++H){var M=this._items.data[H];M.far<K.near||M.near>K.far||J(M.obj,M.near,M.far)}else for(H=
this._items.length-1;0<=H;--H)M=this._items.data[H],M.far<K.near||M.near>K.far||J(M.obj,M.near,M.far)};u._createClass(I,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return I}(),x=function(){function I(){this.view=w.create();this.viewProj=w.create();this.frustum=h.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var G=I.prototype;
G.compute=function(K,H){this.reset();t.copy(this.view,K.viewMatrix);t.multiply(this.viewProj,K.projectionMatrix,this.view);h.copy(K.frustum,this.frustum);K=this.view;const J=K[2],M=K[6],O=K[10],Q=K[14];K=this.range;let S=0;H.forEach(W=>{if(W.instanceParameters.visible&&W.castShadow){if(W.hasShaderTransformation){W.computeBoundingSphere(W.getShaderTransformation(),B,1);var ba=B}else ba=W.boundingSphere;var ca=J*ba[0]+M*ba[1]+O*ba[2]+Q,da=ca-ba[3];ba=ca+ba[3];this.geometries[S]=W;this.near[S]=-ba;this.far[S]=
-da;++S}});if(0===this.geometries.length)return K;for(H=0;H<this.geometries.length;++H)this.near[H]>K.far&&(K.far=this.near[H]),2<this.near[H]&&this.far[H]<K.near&&(K.near=this.far[H]);H=this.looseRange;H.near=Math.max(.5*K.near,2);H.far=2*K.far;var V=0;let Y=0;for(let W=0;W<this.geometries.length;++W)this.near[W]<K.near&&(this.near[W]>=H.near?K.near=this.near[W]:this.nearCandidates[V++]=W),this.far[W]>K.far&&(this.far[W]<=H.far?K.far=this.far[W]:this.farCandidates[Y++]=W);if(0===this.nearCandidates.length&&
0===this.farCandidates.length)return K;this.nearCandidates.sort((W,ba)=>this.near[W]<this.near[ba]?-1:this.near[W]>this.near[ba]?1:0);this.farCandidates.sort((W,ba)=>this.far[W]<this.far[ba]?1:this.far[W]>this.far[ba]?-1:0);for(H=0;H<this.nearCandidates.length;++H)V=this.nearCandidates[H],this.near[V]<K.near&&(V=this.geometries[V],this.includeNearBoundingInfoRec(V.boundingInfo,V.getShaderTransformation()));for(H=0;H<this.farCandidates.length;++H)V=this.farCandidates[H],this.far[V]>K.far&&(V=this.geometries[V],
this.includeFarBoundingInfoRec(V.boundingInfo,V.getShaderTransformation()));return K};G.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};G.includeNearBoundingInfoRec=function(K,H){if(!f.isNone(K)){var J=K.getCenter();e.transformMat4(B,J,H);J=l.maxScale(H);var M=B[0],O=B[1],Q=B[2];J*=K.getBSRadius();var S=this.frustum;if(!(S[0][0]*M+S[0][1]*O+S[0][2]*
Q+S[0][3]>J||S[1][0]*M+S[1][1]*O+S[1][2]*Q+S[1][3]>J||S[2][0]*M+S[2][1]*O+S[2][2]*Q+S[2][3]>J||S[3][0]*M+S[3][1]*O+S[3][2]*Q+S[3][3]>J||(M=this.view[2]*M+this.view[6]*O+this.view[10]*Q+this.view[14],O=M+J,2>-(M-J)||-O>=this.range.near)))if(-O>this.looseRange.near)this.range.near=-O;else{if(100<J&&(J=K.getChildren(),void 0!==J)){for(K=0;8>K;++K)void 0!==J[K]&&this.includeNearBoundingInfoRec(J[K],H);return}N.unionDepthRangeWithAABB(this.range,this.viewProj,H,K.getBBMin(),K.getBBMax())}}};G.includeFarBoundingInfoRec=
function(K,H){if(!f.isNone(K)){var J=K.getBSRadius(),M=K.getCenter();e.transformMat4(B,M,H);var O=l.maxScale(H);M=B[0];var Q=B[1],S=B[2];J*=O;O=this.frustum;if(!(O[0][0]*M+O[0][1]*Q+O[0][2]*S+O[0][3]>J||O[1][0]*M+O[1][1]*Q+O[1][2]*S+O[1][3]>J||O[2][0]*M+O[2][1]*Q+O[2][2]*S+O[2][3]>J||O[3][0]*M+O[3][1]*Q+O[3][2]*S+O[3][3]>J||(M=this.view[2]*M+this.view[6]*Q+this.view[10]*S+this.view[14]-J,-M<=this.range.far)))if(-M<this.looseRange.far)this.range.far=-M;else{if(100<J&&(J=K.getChildren(),void 0!==J)){for(K=
0;8>K;++K)void 0!==J[K]&&this.includeFarBoundingInfoRec(J[K],H);return}N.unionDepthRangeWithAABB(this.range,this.viewProj,H,K.getBBMin(),K.getBBMax())}}};return I}(),D=function(){function I(){this.modelViewProj=w.create();this.clipPosition=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create()]}var G=I.prototype;G.unionDepthRangeWithAABB=function(K,H,J,M,O){var Q=this.modelViewProj;t.multiply(Q,H,J);H=!1;for(J=0;8>J;++J){const S=this.clipPosition[J],V=0===J||3===
J||4===J||7===J?M[0]:O[0],Y=0===J||1===J||4===J||5===J?M[1]:O[1],W=4>J?M[2]:O[2];S[0]=Q[0]*V+Q[4]*Y+Q[8]*W+Q[12];S[1]=Q[1]*V+Q[5]*Y+Q[9]*W+Q[13];S[2]=Q[2]*V+Q[6]*Y+Q[10]*W+Q[14];S[3]=Q[3]*V+Q[7]*Y+Q[11]*W+Q[15]}for(M=0;12>M;++M){O=this.clipTriangle(this.clipPosition[C[M][0]],this.clipPosition[C[M][1]],this.clipPosition[C[M][2]]);Q=!0;for(J=0;J<O.length;++J)if(2<=O[J][3]){Q=!1;break}if(!Q)for(H=!0,Q=0;Q<O.length;++Q)J=O[Q][3],J<K.near&&(K.near=J),J>K.far&&(K.far=J)}return H};G.inside=function(K,H){if(0===
H)return K[0]>=-K[3];if(1===H)return K[1]>=-K[3];if(2===H)return K[0]<=K[3];if(3===H)return K[1]<=K[3];z.assert(!1)};G.intersect=function(K,H,J){let M=0;0===J?M=(-K[3]-K[0])/(H[0]-K[0]+H[3]-K[3]):1===J?M=(-K[3]-K[1])/(H[1]-K[1]+H[3]-K[3]):2===J?M=(K[3]-K[0])/(H[0]-K[0]-H[3]+K[3]):3===J&&(M=(K[3]-K[1])/(H[1]-K[1]-H[3]+K[3]));return n.lerp(b.create(),K,H,M)};G.clipTriangle=function(K,H,J){K=[K,H,J];for(H=0;4>H;++H){J=K;K=[];for(let M=0;M<J.length;++M){const O=J[M],Q=J[(M+1)%J.length];this.inside(Q,
H)?(this.inside(O,H)||K.push(this.intersect(O,Q,H)),K.push(Q)):this.inside(O,H)&&K.push(this.intersect(O,Q,H))}}return K};return I}();const C=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=k.create(),v=w.create(),E=m.empty(),F=new y,L=new x,N=new D;a.DepthRangeFromRenderGeometries=x;a.depthRangeFromLayer=r;a.depthRangeFromScene=function(I,G,K){if(1E4>G.size)return L.compute(I,G);const H=m.empty();K.forAll(J=>{J.isVisible&&m.union(H,r(I,J))});return H};
a.textureToDepth=function(I,G,K){return z.unpackFloatRGBA(G,I)*(K[1]-K[0])+K[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./WebGLDriverTest ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H){a.MagnifierHelper=function(J){function M(){var Q=J.apply(this,arguments)||this;Q._handles=new w;Q._magnifier=null;Q._imageSources=null;Q._imageLoadTask=null;Q._resources=null;Q.events=new t;Q.attributeLocations=new Map([["position",0]]);Q.tmpScreenPoint=h.createScreenPointArray();Q.tmpRenderPoint=h.createRenderScreenPointArray();return Q}u._inheritsLoose(M,J);var O=M.prototype;O.dispose=function(){this._magnifier=null;this._handles.destroy();
n.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this.disposeResources()};O.render=function(Q,S){const V=this._validMagnifier;if(!n.isNone(V)){var Y=S.camera.pixelRatio,W=Math.ceil(Y*V.size);this.updateResources(Q,W);if(!n.isNone(this._resources)){var ba=this._resources.program;Q.useProgram(ba);var ca=this._resources.textures,da=Math.ceil(1/this.factor*W);ca.input.resize(da,da);var ha=S.camera.fullWidth,fa=S.camera.fullHeight;h.screenPointObjectToArray(V.position,
this.tmpScreenPoint);S=S.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var R=.5*da,U=.5*da;S[0]=e.clamp(S[0],R,ha-R-1);S[1]=e.clamp(S[1],U,fa-U-1);R=Math.floor(S[0]-R);U=Math.floor(S[1]-U);ba.bindTexture(ca.input,"textureInput");Q.gl.copyTexImage2D(ca.input.descriptor.target,0,ca.input.descriptor.pixelFormat,R,U,da,da,0);da=-1+(S[0]+V.offset.x*Y)/ha*2;Y=-1+(S[1]-V.offset.y*Y)/fa*2;ha=W/ha*2;W=W/fa*2;Q.bindVAO(this._resources.vao);ba.bindTexture(ca.overlay,"textureOverlay");ba.bindTexture(ca.mask,
"textureMask");ba.setUniform4f("drawPosition",da,Y,ha,W);ba.setUniform1i("maskEnabled",V.maskEnabled?1:0);ba.setUniform1i("overlayEnabled",V.overlayEnabled?1:0);Q.setPipelineState(this._resources.pipelineState);Q.drawArrays(5,0,4)}}};O.updateResourceLoading=function(){var Q=this;const S=this._validMagnifier;if(!n.isNone(S)){var V=S.maskUrl,Y=S.overlayUrl;!n.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===V&&this._imageLoadTask.overlayUrl===Y||(this._imageLoadTask.task.abort(),this._imageSources=
this._imageLoadTask=null);n.isSome(this._imageSources)||n.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:V,overlayUrl:Y,task:b.createTask(function(){var W=u._asyncToGenerator(function*(ba){const ca=n.isNone(V)||n.isNone(Y)?K.loadMagnifierResources(ba):null,da=n.isSome(V)?g.requestImage(V,{signal:ba}):ca.then(ha=>ha.mask);ba=n.isSome(Y)?g.requestImage(Y,{signal:ba}):ca.then(ha=>ha.overlay);Q._imageSources={mask:yield da,overlay:yield ba};Q.disposeResources();Q.events.emit("request-render")});
return function(ba){return W.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};O.updateResources=function(Q,S){this.enabled?n.isSome(this._resources)?this._resources.textures.size!==S&&(Q=this.createTextureResources(Q,S),n.isNone(Q)?this.disposeResources():(this.disposeTextureResources(this._resources.textures),this._resources.textures=Q)):(S=this.createTextureResources(Q,S),n.isNone(S)||(this._resources={textures:S,
program:this.createProgram(Q),vao:L.createQuadVAO(Q,F.Pos2,this.attributeLocations,0,1),pipelineState:H.makePipelineState({blending:H.simpleBlendingParams(1,771),depthTest:null,depthWrite:null,colorWrite:H.defaultColorWriteParams})})):this.disposeResources()};O.disposeResources=function(){n.isNone(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};O.disposeTextureResources=function(Q){Q.mask.dispose();
Q.overlay.dispose();Q.input.dispose()};O.createTextureResources=function(Q,S){if(n.isNone(this._imageSources))return null;this._imageSources.overlay.width=S;this._imageSources.overlay.height=S;this._imageSources.mask.width=S;this._imageSources.mask.height=S;const V=new v(Q,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0,preMultiplyAlpha:k.isSVG(this._imageSources.overlay.src)&&I.testWebGLDriver(Q).svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),
Y=new v(Q,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);return{input:new v(Q,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1}),mask:Y,overlay:V,size:S}};O.createProgram=function(Q){const S=G.build();return new N.Program(Q,S,this.attributeLocations)};u._createClass(M,[{key:"updating",get:function(){return n.isNone(this._imageSources)&&n.isSome(this._imageLoadTask)&&
!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(Q){Q!==this._magnifier&&(this._handles.removeAll(),this._magnifier=Q,Q=()=>{this.updateResourceLoading();this.events.emit("request-render")},n.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",Q)),Q())}},{key:"enabled",get:function(){return n.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return n.isSome(this._magnifier)&&this._magnifier.visible&&
n.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return n.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return M}(p);f.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);f.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);f.__decorate([l.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=f.__decorate([d.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],
a.MagnifierHelper);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(a,u,f){a.build=function(){const p=new f.ShaderBuilder;p.attributes.add("position","vec2");p.vertex.uniforms.add("proj","mat4");p.vertex.uniforms.add("drawPosition","vec4");p.varyings.add("vUV","vec2");p.vertex.code.add(u.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);p.fragment.uniforms.add("textureInput","sampler2D");p.fragment.uniforms.add("textureMask","sampler2D");p.fragment.uniforms.add("textureOverlay","sampler2D");p.fragment.uniforms.add("maskEnabled","bool");p.fragment.uniforms.add("overlayEnabled","bool");p.fragment.code.add(u.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return p};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,u,f,p,t){function w(){w=f._asyncToGenerator(function*(e){var n=new Promise(function(h,k){a(["./mask-svg"],function(l){h(Object.freeze({__proto__:null,"default":l}))},k)}),b=new Promise(function(h,k){a(["./overlay-svg"],function(l){h(Object.freeze({__proto__:null,
"default":l}))},k)});n=t.requestImage((yield n).default,{signal:e});b=t.requestImage((yield b).default,{signal:e});b={mask:yield n,overlay:yield b};p.throwIfAborted(e);return b});return w.apply(this,arguments)}u.loadMagnifierResources=function(e){return w.apply(this,arguments)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../support/debugFlags ../core/renderPasses/RenderPassManager ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./HighlightHelper ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPluginManager ./ShadowAccumulator ./ShadowHighlightHelper ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/renderers/MergedRenderer ../statistics/RendererPerformanceInfo ../../../webgl/Measurement".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G){let K=function(){function Y(ba,ca,da,ha,fa,R,U,Z,T){this._materialRep=ba;this._shaderTechniqueRepository=da;this._rctx=ha;this._compositingHelper=fa;this._magnifierHelper=R;this.requestRender=U;this._stage=T;this._materialRenderers=new Map;this._hasOverlayWater=this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this.performanceInfo=new I.RendererPerformanceInfo;
this._antialiasing=1;this._oitEnabled=!1;this._opaqueTerrain=this._multipassTerrain=!0;this._lighting=new L.SceneLighting;this._handles=new u;this.renderHiddenTransparentEdges=()=>{};this._smaaPass=new v.SmaaRenderPass(this._rctx,da);this._oitEnabled=this._hasOITSupport;this.requestRender();this._offscreenRendering=new g.OffscreenRendering(this._rctx,this._compositingHelper);this._sliceHelper=new B;this._shadowMap=new C(this._rctx,T.viewingMode,2);this._ssaoHelper=new E(da,this._rctx,()=>this.requestRender());
this._highlightHelper=new c(da,this._rctx);this._shadowHighlightHelper=new D.ShadowHighlightHelper(this._rctx,T.viewingMode);this._shadowAccumulator=new x.ShadowAccumulator(this._rctx,da,T,(P,X)=>{this.renderPassManager.shadowCastingEnabled=!0;this._renderPlugins.prepareRender(P,X);this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled},(P,X,aa,ja)=>{P.start(aa,X,ja);this.renderShadowCascades(4,P);aa.setGLViewport(this._rctx);this.ensureCameraBindParameters(aa)},()=>this.requestRender());
this._bindParameters={slot:null,camera:null,inverseViewport:b.create(),shadowMap:this._shadowMap,shadowMappingEnabled:this._shadowMap.enabled,ssaoHelper:this._ssaoHelper,ssaoEnabled:this._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:this._sliceHelper.plane,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,
lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,highlightColorTexture:null};this._renderContext=new A.RenderContext(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._renderContext.multipassTerrainParams={camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null};this._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null};this._renderContext.ssrParams=
{camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1};this._renderPlugins=new y.RenderPluginManager({renderContext:this._renderContext,shaderTechniqueRep:da,textureRep:ca,materialRep:this._materialRep,requestRender:this.requestRender,schedule:Z});this.renderPassManager=new k.RenderPassManager(this._rctx,this._shaderTechniqueRepository);this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager);this._handles.add([w.init(h,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",
P=>{this.renderHiddenTransparentEdges=P?()=>this.renderEdges(1):()=>{};this.requestRender()}),w.init(this._stage,"camera",()=>this.requestRender(),!0)])}var W=Y.prototype;W.dispose=function(){this._handles.destroy();this._smaaPass.disable();this._materialRenderers.forEach(ba=>ba.dispose());this._materialRenderers.clear();this._edgeView=p.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=p.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=
!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlightHelper.dispose();this._shadowHighlightHelper.dispose();this._shadowAccumulator.dispose();l.BoundingInfo.prune();this._content.clear()};W.ensureEdgeView=function(){p.isNone(this._edgeView)&&(this._edgeView=new F.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this.requestRender(),schedule:ba=>this._stage.resourceController.schedule(ba)}),
this._handles.add(this._edgeView.watch("updating",()=>this.requestRender(),!0)),this.requestRender());return this._edgeView};W.setRenderParameters=function(ba){const {renderPassManager:ca,_shadowMap:da,_ssaoHelper:ha}=this;void 0!==ba.screenSpaceReflectionsEnabled&&ca.screenSpaceReflectionsEnabled!==ba.screenSpaceReflectionsEnabled&&(ca.screenSpaceReflectionsEnabled=ba.screenSpaceReflectionsEnabled,this.requestRender());void 0===ba.shadowMap||da.enabled===ba.shadowMap&&ca.shadowCastingEnabled===ba.shadowMap||
(da.enabled=ba.shadowMap,ca.shadowCastingEnabled=ba.shadowMap,this.requestRender());void 0!==ba.shadowMapMaxCascades&&da.maxCascades!==ba.shadowMapMaxCascades&&(da.maxCascades=ba.shadowMapMaxCascades,this.requestRender());void 0!==ba.ssao&&ha.enabled!==ba.ssao&&(ha.enabled=ba.ssao,this.requestRender());void 0!==ba.ssaoAttenuation&&ha.attenuation!==ba.ssaoAttenuation&&(ha.attenuation=ba.ssaoAttenuation,this.requestRender());void 0!==ba.ssaoRadius&&ha.radius!==ba.ssaoRadius&&(ha.radius=ba.ssaoRadius,
this.requestRender());void 0!==ba.ssaoSamples&&ha.samples!==ba.ssaoSamples&&(ha.samples=ba.ssaoSamples,this.requestRender());ba.background&&this._offscreenRendering.background!==ba.background&&(this._offscreenRendering.background=ba.background,this.requestRender());var fa=ba.antialiasingEnabled?1:0;void 0!==ba.antialiasingEnabled&&this._antialiasing!==fa&&(this._antialiasing=fa,this.requestRender());void 0!==ba.highQualityTransparency&&this._multipassTerrain!==ba.highQualityTransparency&&(this._oitEnabled=
(this._multipassTerrain=ba.highQualityTransparency)&&this._hasOITSupport,this.requestRender());void 0!==ba.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(ba.defaultHighlightOptions),this._shadowHighlightHelper.setDefaultOptions(ba.defaultHighlightOptions),this.requestRender());void 0!==ba.slicePlane&&this._sliceHelper.plane!==ba.slicePlane&&(this._sliceHelper.plane=p.unwrap(ba.slicePlane),this.requestRender());fa=10<=this._rctx.parameters.maxTextureImageUnits&&ba.waterReflectionEnabled;
void 0!==ba.waterReflectionEnabled&&this._waterReflectionEnabled!==fa&&(this._waterReflectionEnabled=fa,this.requestRender());void 0!==ba.opaqueTerrain&&this._opaqueTerrain!==ba.opaqueTerrain&&(this._opaqueTerrain=ba.opaqueTerrain,this.requestRender());void 0!==ba.hasOverlayWater&&this._hasOverlayWater!==ba.hasOverlayWater&&(this._hasOverlayWater=ba.hasOverlayWater,this.requestRender());void 0!==ba.shadowAccumulationOptions&&this._shadowAccumulator.setOptions(ba.shadowAccumulationOptions)};W.modify=
function(ba){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ca,removes:da,updates:ha}=ba;if(0!==ca.length||0!==da.length||0!==ha.length){da.forAll(({id:R})=>this._content.delete(R));ca.forAll(R=>this._content.set(R.id,R));var fa=!1;q.splitRenderGeometryChangeSetByMaterial(ba).forEach((R,U)=>{let Z=this._materialRenderers.get(U);if(!Z)if(0<R.adds.length)Z=new N(this._rctx,this._materialRep,U),this._materialRenderers.set(U,Z);else return;Z.modify(R);Z.isEmpty&&
(fa=!0)});fa&&this._materialRenderers.forEach((R,U)=>{R.isEmpty&&(this._materialRenderers.delete(U),R.dispose())});this._hasHighlights=f.someMap(this._materialRenderers,R=>R.hasHighlights);this._hasOccludees=f.someMap(this._materialRenderers,R=>R.hasOccludees);this._hasWater=f.someMap(this._materialRenderers,R=>R.hasWater);this.requestRender()}};W.updateLogic=function(ba){let ca=!1;this._materialRenderers.forEach(da=>{da.updateLogic&&(ca=da.updateLogic(ba)||ca)});return ca};W.updateLightSources=function(ba,
ca,da){this._lighting.groundLightingFactor=ca;this._lighting.globalFactor=da;this._lighting.set(ba)};W.render=function(ba,ca,da,ha){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.lighting=this._lighting;this._renderContext.hasOccludees=this._hasOccludees;this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=3;var fa=this._offscreenRendering;fa.needLastFrameColorTexture=this.hasWaterReflection;fa.advanceCurrentRenderTarget();const R=
this._sliceHelper.plane;ha&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(ba);ca.setGLViewport(this._rctx);this.needsShadowAccumulation&&(this.renderPassManager.shadowCastingEnabled=!0);this._renderPlugins.prepareRender(ca,da);this.performanceInfo.advance(0);var U=this.computeDepthRange(ca);this.renderShadowMap(ba,ca,this._lighting.lightingMainDirection,U);this.performanceInfo.advance(1);fa.initializeFrame(ca);this.ensureBindParameters(ca);this.renderLinearDepth();this.performanceInfo.advance(2);
this.accumulateShadows(U,ca,da);this.renderNormal();this.performanceInfo.advance(3);this.ensureBindParametersSSR();this._ssaoHelper.computeSSAO(ca,fa.linearDepthTexture,fa.normalTexture);this.performanceInfo.advance(4);this.performanceInfo.stats.reset();this._renderContext.pass=0;fa.bindFramebuffer();this.renderSlot(0);this.renderOpaqueGeometry();this.performanceInfo.advance(5);ca=this._multipassTerrain&&!this._opaqueTerrain;this.renderTerrainLinearDepth(ca);this.setMultipassFlags(ca);this.setTerrainCulling(ca);
this.renderEdges(2);this.performanceInfo.advance(6);this.renderHiddenTransparentEdges();this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry();this.performanceInfo.advance(7);this.renderGeometryLinearDepth(ca);U=da=!1;da=this.renderHUDVisibility();ca||this.renderInternalSlot(20);this.performanceInfo.advance(9);this.renderEdges(1,ca);this.performanceInfo.advance(8);(U=this.renderTransparentTerrain())&&da&&(ca?this.renderLineCallouts(0):
fa.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,fa.framebuffer),this.performanceInfo.advance(16));this.performanceInfo.advance(10);this.setTerrainCulling(!1);U&&(fa.compositeTransparentTerrainOntoMain(),ca&&(this.renderEdges(2),this.performanceInfo.advance(6),this._oitEnabled?this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(),!1):this.renderTransparentGeometry(),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8)));ca&&this.renderLineCallouts(1);
this.setMultipassFlags(!1);this._shadowAccumulator.render();fa.renderToTargets(()=>{this.renderInternalSlot(8);this.renderSlot(15);this.renderSlot(16)},fa.currentColorTarget,fa.mainDepth);this.performanceInfo.advance(11);this._renderPlugins.needsLaserlineWithContrastControl&&fa.renderTmpAndCompositeToMain(()=>{this.renderSlot(17)},2);this.performanceInfo.advance(12);this.renderOccluded();this.performanceInfo.advance(13);fa=(ha=!ha&&this._magnifierHelper.enabled)&&p.isNone(ba)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,
this._offscreenRendering.tmpDepth):ba;this._rctx.bindFramebuffer(fa);this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0);this.performanceInfo.advance(14);this.renderHUD(1,fa);this.performanceInfo.advance(17);this.renderHighlights(fa,this._bindParameters);this.performanceInfo.advance(15);ha&&this._magnifierHelper.render(this._rctx,this._bindParameters);fa!==ba&&(this._rctx.bindFramebuffer(ba),
this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0));this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=R;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};W.readDepthPixels=function(ba,ca,da,ha,fa,R){const U=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this.ensureBindParameters(ba),this._renderContext.camera.setGLViewport(this._rctx),
this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(17664),this.renderGeometryAndTransparentTerrainPass(2));U.readPixels(ca,da,ha,fa,6408,5121,R)};W.readAccumulatedShadow=function(ba,ca){return this._shadowAccumulator.readAccumulatedShadow(ba,ca)};W.setMultipassFlags=function(ba){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=ba;this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=
ba};W.setTerrainCulling=function(ba){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=ba};W.renderSlot=function(ba){this._renderContext.slot=ba;return this._renderPlugins.render()};W.renderEdges=function(ba,ca=!1){const da=this._edgeView;p.isSome(da)&&da.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>da.render(this._bindParameters,ba),1,ca)};W.renderShadowMap=function(ba,ca,da,ha){const fa=this._shadowMap;if(fa.enabled){h.ENABLE_PROFILE_DEPTH_RANGE&&
t.begin("depthRange");h.ENABLE_PROFILE_DEPTH_RANGE&&t.end("depthRange");fa.start(ca,da,ha);if(this.needsShadowHighlight){const R=this._shadowHighlightHelper;this.renderShadowCascades(7,this._shadowMap,U=>fa.takeCascadeSnapshotTo(U,R.highlightShadowMapSlot));fa.clear();this.renderShadowCascades(6,this._shadowMap,U=>{fa.takeCascadeSnapshotTo(U,R.defaultSnapshotSlot);this.renderGeometryAndTransparentTerrainPass(7)})}else this.renderShadowCascades(4);fa.finish(ba);ca.setGLViewport(this._rctx)}};W.renderShadowCascades=
function(ba,ca=this._shadowMap,da=ha=>{}){for(const ha of ca.getCascades())ha.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(ha.camera),this.renderGeometryAndTransparentTerrainPass(ba),da(ha)};W.renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this.renderGeometryAndTransparentTerrainPass(2),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);
this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};W.renderTerrainLinearDepth=function(ba){ba?(ba=this._renderContext.pass,this._renderContext.pass=2,this._offscreenRendering.renderToTargets(()=>this.renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=ba):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);
this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};W.renderGeometryLinearDepth=function(ba){ba?(ba=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this.renderGeometryPass(2),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=ba):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);
this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};W.renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(3)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};W.computeDepthRange=function(ba){if(!this.needsDepthRange)return m.ZERO;
const ca=z.depthRangeFromScene(ba,this._content,this._stage.layers);m.union(ca,this.renderPlugins.queryDepthRange(ba));ca.near=Math.max(ba.near,ca.near);ca.far=Math.min(ba.far,ca.far);return ca};W.renderGeometryAndTransparentTerrainPass=function(ba){this._renderContext.pass=ba;this.renderGeometryPass(ba);this.renderTransparentTerrain()};W.renderGeometryPass=function(ba){this._renderContext.pass=ba;this.renderOpaqueGeometry();this.renderTransparentGeometry()};W.renderOpaqueGeometry=function(){this.renderSlot(1);
this.renderSlot(2);this.renderInternalSlot(3);this.renderSlot(4);this.renderSlot(14)};W.renderTransparentGeometry=function(){this.renderInternalSlot(5);this.renderSlot(6)};W.renderTransparentTerrain=function(){return this.renderSlot(7)};W.renderHUDVisibility=function(){let ba=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:
null;ba=this.renderInternalSlot(12)},this._multipassTerrain&&!this._opaqueTerrain);return ba};W.renderLineCallouts=function(ba){this._bindParameters.renderTransparentlyOccludedHUD=ba;0===ba?this._offscreenRendering.renderToTargets(()=>this.renderInternalSlot(20),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderInternalSlot(20)};W.renderHUD=function(ba,ca){this._oitEnabled?(this.renderOrderIndependentTransparency(()=>this.renderHUDElements(ba),
!0),this._rctx.bindFramebuffer(ca),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===ba?this._offscreenRendering.renderToTargets(()=>this.renderHUDElements(0),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(ba)};W.renderHUDElements=function(ba){this._bindParameters.renderTransparentlyOccludedHUD=ba;this.renderInternalSlot(21);this.renderInternalSlot(18);this.renderInternalSlot(19)};W.renderHighlights=
function(ba,ca){if(this.needsHighlight){var da=this._highlightHelper,ha=da.profilingCallback&&G.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=ca.highlightDepthTexture;var fa=this._offscreenRendering.renderToTargets(()=>{this.renderGeometryAndTransparentTerrainPass(5);this._rctx.clearSafe(256);this.renderHUDElements(2)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=fa.colorTexture;
this.needsShadowHighlight&&this._shadowHighlightHelper.render(ca,ba);da.render(this._renderContext.camera,fa,ba);p.isSome(ha)&&da.profilingCallback&&ha.stop(R=>{da.profilingCallback&&da.profilingCallback(R)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};W.accumulateShadows=function(ba,ca,da){this.needsShadowAccumulation&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,ba,ca,da),this._shadowAccumulator.accumulateFixedSamples(),
this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)};W.renderOrderIndependentTransparency=function(ba,ca){const da=fa=>{this._renderContext.transparencyPassType=fa;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._offscreenRendering.renderOITPass(()=>ba(),fa,ca)},ha=this._renderContext.pass;this._renderContext.pass=1;da(1);this._renderContext.pass=0;da(0);da(2);this._offscreenRendering.compositeTransparentOntoOpaque(ca);this._renderContext.transparencyPassType=
3;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=ha};W.renderOccluded=function(){let ba=0;this._materialRenderers.forEach((R,U)=>{U&&U.isVisible()&&8===U.renderOccluded&&(ba|=U.renderOccluded,J.push(U))});const ca=this._offscreenRendering,da=(R,U,Z,T,P)=>{0!==(ba&U)&&(ca.renderToTargets(Z,ca.tmpColor,ca.mainDepth,[0,0,0,0],T,P),ca.compositeOccludedOntoMain(R))};0!==J.length&&(this.renderInternalSlot(10,J),da(.5,8,()=>this.renderInternalSlot(11,
J),!1,!1),J.length=0);this._materialRenderers.forEach((R,U)=>{U&&U.isVisible()&&(4===U.renderOccluded||2===U.renderOccluded||16===U.renderOccluded)&&(ba|=U.renderOccluded,H.push(U))});const ha=this._renderPlugins.renderOccludedFlags;if(ba|=ha){var fa=R=>{this._renderContext.renderOccludedMask=R;1<ha&&this.renderSlot(9);this.renderInternalSlot(3,H);this.renderInternalSlot(5,H);this.renderInternalSlot(8,H);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=0;da(.5,4,()=>fa(4),!0,
2);da(.5,2,()=>fa(2),!0,2);da(1,16,()=>fa(16),!0,2);H.length=0}};W.renderAntiAliasing=function(ba,ca){if(1===ba){if(this._smaaPass.loadResources(()=>this.requestRender()),this._smaaPass.enable())return this._smaaPass.render({colorTexture:ca}),!0}else this._smaaPass.disable();return!1};W.ensureCameraBindParameters=function(ba){this._renderContext.camera=ba;this._bindParameters.camera=this._renderContext.camera;this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2];this._bindParameters.inverseViewport[1]=
1/this._renderContext.camera.fullViewport[3]};W.ensureBindParameters=function(ba){var ca;this.ensureCameraBindParameters(ba);ba=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap;this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled;this._bindParameters.ssaoHelper=this._renderContext.ssaoHelper;this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled;this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane;
this._bindParameters.hasOccludees=this._renderContext.hasOccludees;this._renderContext.multipassTerrainParams.camera=this._renderContext.camera;this._bindParameters.hudVisibilityTexture=ba.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(ca=ba.depthTexture)?ca:this.getFallbackDepthTexture()};W.ensureBindParametersSSR=function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=
V:(e.translate(M,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),e.translate(Q,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),e.invert(Q,Q),e.invert(O,this._renderContext.camera.projectionMatrix),e.multiply(S,Q,O),e.multiply(S,M,S),e.multiply(S,this._renderContext.lastFrameCamera.projectionMatrix,S),this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=
S),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this.hasWaterReflection};W.renderInternalSlot=function(ba,ca){const da=0===this._renderContext.pass?this.performanceInfo.stats:
null;let ha=!1;this._bindParameters.slot=ba;p.isSome(ca)?ca.forEach(fa=>{d.materialPredicate(fa,this._renderContext)&&(fa=this._materialRenderers.get(fa),p.isSome(fa)&&(ha=fa.render(ba,this._renderContext.pass,this._bindParameters)||ha))}):this._materialRenderers.forEach((fa,R)=>{d.materialPredicate(R,this._renderContext)&&(ha=fa.render(ba,this._renderContext.pass,this._bindParameters,da)||ha)});return ha};W.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=
r.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};W.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:(this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0)+(this._shadowHighlightHelper?this._shadowHighlightHelper.getGpuMemoryUsage():0),shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.gpuMemoryUsage:0}};a._createClass(Y,[{key:"hasWater",
get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},{key:"updating",get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||p.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMat||
e.equals(this._bindParameters.reprojectionMat,V)}},{key:"hasShadowsEnabled",get:function(){var ba;return!(null==(ba=this._shadowMap)||!ba.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat}},
{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowAccumulation}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowAccumulation}},{key:"needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",
get:function(){return this._shadowMap.enabled&&this._shadowHighlightHelper.isVisible&&this.needsHighlight}},{key:"needsShadowAccumulation",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"test",get:function(){const ba=this;return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,oitEnabled:this._oitEnabled,shadowHighlights:this._shadowHighlightHelper,
getFramebufferTexture:ca=>{var da;switch(ca){case 0:return ba._offscreenRendering.colorTexture;case 1:return ba._offscreenRendering.linearDepthTexture;case 2:return ba._offscreenRendering.normalTexture;case 3:return null==(da=ba._shadowMap)?void 0:da.test.depthTexture;case 4:return ba._offscreenRendering.hudVisibilityTexture;case 5:return ba._offscreenRendering.highlightTexture}}}}}]);return Y}();const H=[],J=[],M=n.create(),O=n.create(),Q=n.create(),S=n.create(),V=n.create();return K})},"esri/core/TimeProfiler":function(){define(["../chunks/_rollupPluginBabelHelpers"],
function(a){let u=function(){function f(t,w=.9){this._alpha=.9;this._max=this._min=this._smooth=this._sum=this._count=this._startTime=0;this._name=t;this._alpha=w;this.reset()}var p=f.prototype;p.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};p.begin=function(){this._startTime=performance.now()};p.end=function(){const t=performance.now()-this._startTime;this._count+=1;this._sum+=t;this._smooth=this._alpha*t+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,
t);this._max=Math.max(this._max,t)};p.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};a._createClass(f,[{key:"name",get:function(){return this._name}},{key:"count",get:function(){return this._count}},{key:"average",get:function(){return 0<this._count?this._sum/this._count:0}},{key:"smooth",get:function(){return this._smooth}},{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}}]);return f}();
(function(f){function p(n){n in w||(w[n]=new f(n));return w[n]}function t(n){console.log(p(n).toJSON())}const w={},e={};f.get=p;f.begin=function(n){p(n).begin()};f.end=function(n,b=!0){p(n).end();const h=performance.now();!b||n in e&&!(h>=e[n]+1E3)||(t(n),e[n]=h)};f.log=t;f.logAll=function(){for(const n in w)t(n)}})(u||(u={}));return u})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/boundedPlane ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){let c=function(){function q(x,D){this.rctx=x;this.shaderTechniqueRepository=D;this.canRender=!0;this._materialPassParams=new l.MaterialPassesParameters;this._shadowPassParams=new l.ShadowMapPassParameters;this._highlightPassParams=new l.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository));this.passes={materialOpaque:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository)),
materialTransparent:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository)),highlightShadowMap:this._registerPass(new m.RenderPass(x,this.shaderTechniqueRepository)),defaultShadowMap:this._registerPass(new m.RenderPass(x,
this.shaderTechniqueRepository))}}var y=q.prototype;y.register=function(x){this._systems.add(x)};y.prepareRender=function(x){0!==this._systems.size&&(this._passes.forEach(D=>D.prepareSubmit()),this._systems.forEach(D=>D.submit(this.passes,{camera:x})),this._passes.forEach(D=>D.finishSubmit()),this.shaderTechniqueRepository.frameUpdate())};y.render=function(x){if(0===this._systems.size)return!1;if(4===x.slot)switch(this._configure(x),x.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(x);
this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 5:this.passes.highlight.dispatch(this._highlightPassParams);break;case 4:this._shadowMapPass.dispatch(this._shadowPassParams);break;case 7:f.isSome(this.passes.highlightShadowMap)&&this.passes.highlightShadowMap.dispatch(this._shadowPassParams);
break;case 6:f.isSome(this.passes.defaultShadowMap)&&this.passes.defaultShadowMap.dispatch(this._shadowPassParams)}if(6===x.slot)switch(this._configure(x),x.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(x);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this._configureMaterialColorPass(x);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=
2;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===x.slot)switch(this._configure(x),x.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(x);this._materialPassParams.ssrParams=x.ssrParams;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);
break;case 3:this._materialPassParams.subPass=3;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 5:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};y.notifyDirty=function(){this.context.requestRender()};y.slots=function(){return[4,6,1]};y.initializeRenderContext=function(x){this.context=x};y.uninitializeRenderContext=function(){};y.queryDepthRange=function(x){const D={near:Infinity,far:-Infinity};this._systems.forEach(C=>{C=C.queryShadowCasterDepthRange(x);
f.isSome(C)&&r.union(D,C,D)});return D};y._configureMaterialColorPass=function(x){this._materialPassParams.bindShadowMap=D=>{x.shadowMap.bind(D);const C=this._materialPassParams.viewTransform;n.add(d,C.worldFromView_TL,C.worldFromView_TH);x.shadowMap.bindView(D,d)};this._materialPassParams.bindAmbientOcclusion=D=>x.ssaoHelper.bind(D);this._materialPassParams.ambientOcclusionEnabled=!!x.ssaoHelper&&x.ssaoHelper.ready;this._materialPassParams.sceneHasOcludees=x.hasOccludees};y._configure=function(x){this._updateParameters(x,
4===x.pass||7===x.pass||6===x.pass?this._shadowPassParams:5===x.pass?this._highlightPassParams:this._materialPassParams)};y._updateParameters=function(x,D){const C=x.camera,B=C.viewInverseTransposeMatrix;n.set(d,B[3],B[7],B[11]);A.set(d);n.copy(D.viewTransform.worldFromView_TH,A.high);n.copy(D.viewTransform.worldFromView_TL,A.low);p.fromMat4(D.viewTransform.viewFromCameraRelative_RS,C.viewMatrix);w.copy(D.viewTransform.projFromView,C.projectionMatrix);0===D.identifier?(this._materialPassParams.transparent=
6===x.slot,this._materialPassParams.integratedMesh=1===x.slot,this._materialPassParams.lighting=x.scenelightingData,p.transpose(g,D.viewTransform.viewFromCameraRelative_RS),p.invert(D.transformNormal_ViewFromGlobal,g),e.set(D.cameraNearFar,C.near,C.far)):1===D.identifier?e.set(D.cameraNearFar,C.near,C.far):2===D.identifier&&(D.highlightDepthTexture=x.highlightDepthTexture,h.copy(D.viewport,C.fullViewport));if(0===D.identifier||2===D.identifier)D.inverseViewport[0]=1/C.fullViewport[2],D.inverseViewport[1]=
1/C.fullViewport[3];k.copyWithoutVerify(x.sliceHelper.plane,D.slicePlane);n.subtract(D.slicePlane.origin,D.slicePlane.origin,d);D.slicePlaneEnabled=x.sliceHelper.isEnabled;this._materialPassParams.transparencyPassType=x.transparencyPassType;this._materialPassParams.multipassTerrainParams=x.multipassTerrainParams};y._registerPass=function(x){this._passes.push(x);return x};u._createClass(q,[{key:"shadowCastingEnabled",get:function(){return f.isSome(this.passes.shadowMap)},set:function(x){x?(this._materialPassParams.shadowsEnabled=
!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)}},{key:"screenSpaceReflectionsEnabled",get:function(){return f.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(x){this._materialPassParams.ssrParams.ssrEnabled=x?!0:!1}},{key:"needsHighlight",get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count}}]);return q}();const d=b.create(),g=t.create(),A=new z.TwoVectorPosition;
a.RenderPassManager=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../chunks/boundedPlane ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),function(a,u,f,p,t,w){a.HighlightPassParameters=function(){this.identifier=2;this.viewTransform=new w.VertexPosition.ViewProjectionTransform;this.slicePlane=
t.create();this.inverseViewport=f.create();this.viewport=p.create()};a.MaterialPassesParameters=function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new w.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=u.create();this.cameraNearFar=f.create();this.inverseViewport=f.create();this.slicePlane=t.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=!1;this.transparencyPassType=3};a.ShadowMapPassParameters=
function(){this.identifier=1;this.viewTransform=new w.VertexPosition.ViewProjectionTransform;this.cameraNearFar=f.create();this.slicePlane=t.create()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray"],function(a,u,f,p){let t=function(){function e(b,h,k=0){this._rctx=b;this._techniqueRepository=h;this._sorting=
k;this._draws=new p({initialSize:32,allocator:l=>l||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var n=e.prototype;n.submitDraw=function(b,h,k,l,m){const z=this._draws.pushNew();z.geometry=h;z.geometryRanges=k;z.material=b;z.bindDrawParams=l;z.depthSquaredHint=m;z.indexType=h.indexed?f.unwrap(h.vao.indexBuffer).indexType:0};n.dispatch=
function(b){const h=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let k=null;const l=this._draws.length;for(let r=0;r<l;r++){var m=this._draws.data[r];const c=m.geometry;var z=m.material.getTechnique(this._techniqueRepository,b,c.parameters);if(z!==k||3!==z.configuration.transparencyPassType)h.useProgram(z.program),h.setPipelineState(z.pipeline),k=z;this._passBoundTechniques.has(z)||(z.bindPass(b),this._passBoundTechniques.add(z));
h.bindVAO(c.vao);this._previouslyBoundMaterials.get(z)!==m.material&&(z.bindMaterial(m.material,b),this._previouslyBoundMaterials.set(z,m.material));this._previouslyBoundDraw.get(z)!==m.bindDrawParams&&(z.bindDraw(m.bindDrawParams,m.material,b),this._previouslyBoundDraw.set(z,m.bindDrawParams));z=m.geometryRanges;const d=z.length;if(0!==m.indexType){const g=w.get(m.indexType);for(let A=0;A<d;A+=2)h.drawElements(c.primitiveType,z[A+1],m.indexType,z[A]*g)}else for(m=0;m<d;m+=2)h.drawArrays(c.primitiveType,
z[m],z[m+1])}};n.prepareSubmit=function(){this._draws.clear()};n.finishSubmit=function(){const b=0===this._sorting?1:-1;this._draws.sort((h,k)=>{const l=b*(h.depthSquaredHint-k.depthSquaredHint);return 0!==l?l:h.geometry.vao.size-k.geometry.vao.size})};u._createClass(e,[{key:"count",get:function(){return this._draws.length}}]);return e}();const w=new Map;w.set(5121,1);w.set(5123,2);w.set(5125,4);a.RenderPass=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../chunks/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){return function(){function r(d,g){this._techniqueRep=d;this._rctx=g;this.viewportToRestore=t.create();this.defaultOptions={color:p.fromValues(1,0,1,1),haloColor:p.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:p.fromValues(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075};this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,
viewportHeight:0}}var c=r.prototype;c.assertResources=function(){if(!this.quadVAO){this.quadVAO=b.createQuadVAO(this._rctx);var d={colorTarget:0,depthStencilTarget:0,width:0,height:0},g={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new l(this._rctx,d,g);this.blur1Fbo=new l(this._rctx,d,g);d=new h.HighlightCompositionTechniqueConfiguration;d.highlightStage=0;d.gridOptimization=!1;this.blurTechnique=this._techniqueRep.acquire(h.HighlightCompositionTechnique,
d);d.highlightStage=0;d.gridOptimization=!0;this.blurGridTechnique=this._techniqueRep.acquire(h.HighlightCompositionTechnique,d);d.highlightStage=1;d.gridOptimization=!1;this.applyTechnique=this._techniqueRep.acquire(h.HighlightCompositionTechnique,d);d.highlightStage=1;d.gridOptimization=!0;this.applyGridTechnique=this._techniqueRep.acquire(h.HighlightCompositionTechnique,d);d.highlightStage=2;d.gridOptimization=!1;this.downsampleTechnique=this._techniqueRep.acquire(h.HighlightCompositionTechnique,
d)}};c.dispose=function(){if(this._grid.coverageMipmap)for(let d=1;d<this._grid.coverageMipmap.length;d++)this._grid.coverageMipmap[d].dispose();this._grid.vao&&this._grid.vao.dispose(!0);this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=u.disposeMaybe(this.blur0Fbo);this.blur1Fbo=u.disposeMaybe(this.blur1Fbo)};c.setDefaultOptions=function(d){this.defaultOptions=d};c.render=function(d,g,A){var q=d.pixelRatio;const y=w.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,x=this._rctx;this.assertResources();
f.copy(this.viewportToRestore,d.fullViewport);var D=Math.ceil(d.fullWidth/q);q=Math.ceil(d.fullHeight/q);this.blur0Fbo.resize(D,q);this.blur1Fbo.resize(D,q);x.bindVAO(this.quadVAO);d=null;const C=y?this.blurGridTechnique:this.blurTechnique;C.bindPipelineState(x);x.useProgram(C.program);y?(this._gridUpdateResources(g,32),this._gridComputeMipmap(),d=this._grid.vao,C.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):d=this.quadVAO;x.bindVAO(d);x.bindFramebuffer(this.blur0Fbo);
x.setViewport(0,0,D,q);x.setClearColor(0,0,0,0);x.clear(16384);C.program.bindTexture(g.colorTexture,"tex");C.program.setUniform2f("blurSize",1/D,0);x.drawArrays(C.primitiveType,0,m.vertexCount(d,"geometry"));x.bindFramebuffer(this.blur1Fbo);x.clear(16384);C.program.bindTexture(this.blur0Fbo.colorTexture,"tex");C.program.setUniform2f("blurSize",0,1/q);x.drawArrays(C.primitiveType,0,m.vertexCount(d,"geometry"));D=y?this.applyGridTechnique:this.applyTechnique;x.bindFramebuffer(A);D.bindPipelineState(x);
x.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);x.useProgram(D.program);D.program.bindTexture(this.blur1Fbo.colorTexture,"tex");D.program.bindTexture(g.colorTexture,"origin");y&&D.program.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex");D.bindApplyPass(this.defaultOptions);x.drawArrays(D.primitiveType,0,m.vertexCount(d,"geometry"));x.bindVAO(null)};c._gridUpdateResources=function(d,g){const A=
this._rctx,q=this._grid;var y=!1;null===q.coverageMipmap&&(q.coverageMipmap=[d],y=!0);if(q.viewportWidth!==d.width||q.viewportHeight!==d.height)y=!0,q.viewportWidth=d.width,q.viewportHeight=d.height;q.coverageMipmap[0]=d;q.cellPixelSize!==g&&(q.cellPixelSize=g,y=!0);if(y){for(g=1;g<q.coverageMipmap.length;g++)q.coverageMipmap[g].dispose();q.mipmapLevels=Math.ceil(Math.log(q.cellPixelSize)*Math.LOG2E);q.coverageMipmap.length=q.mipmapLevels+1;for(g=0;g<q.mipmapLevels;g++)y=q.coverageMipmap[g],q.coverageMipmap[g+
1]=new l(A,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(y.width/2),height:Math.ceil(y.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(y.width/2),height:Math.ceil(y.height/2)})}y=Math.ceil(d.height/q.cellPixelSize);var x=Math.ceil(d.width/q.cellPixelSize);if(!q.vao||q.verticalCellCount!==y||q.horizontalCellCount!==x){q.verticalCellCount=y;q.horizontalCellCount=x;d=y+1;g=x+1;y=1/y;x=1/x;const D=new Float32Array(24*d*g);let C=0;for(let B=
0;B<d;B++)for(let v=0;v<g;v++)D[C+0]=(v-.5)*x*2-1,D[C+1]=(B-.5)*y*2-1,D[C+2]=v*x,D[C+3]=B*y,D[C+4]=(v+.5)*x*2-1,D[C+5]=(B-.5)*y*2-1,D[C+6]=v*x,D[C+7]=B*y,D[C+8]=(v-.5)*x*2-1,D[C+9]=(B+.5)*y*2-1,D[C+10]=v*x,D[C+11]=B*y,D[C+12]=(v-.5)*x*2-1,D[C+13]=(B+.5)*y*2-1,D[C+14]=v*x,D[C+15]=B*y,D[C+16]=(v+.5)*x*2-1,D[C+17]=(B-.5)*y*2-1,D[C+18]=v*x,D[C+19]=B*y,D[C+20]=(v+.5)*x*2-1,D[C+21]=(B+.5)*y*2-1,D[C+22]=v*x,D[C+23]=B*y,C+=24;q.vao&&q.vao.dispose(!0);q.vao=new z(A,e.Default3D,{geometry:n.Pos2Tex},{geometry:k.createVertex(A,
35044,D)})}};c._gridComputeMipmap=function(){const d=this._rctx,g=this._grid,A=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(d);d.bindVAO(this.quadVAO);d.useProgram(A);for(let q=0;q<g.mipmapLevels;q++){d.bindFramebuffer(g.coverageMipmap[q+1]);A.bindTexture(g.coverageMipmap[q].colorTexture,"tex");const y=g.coverageMipmap[q+1].width,x=g.coverageMipmap[q+1].height;A.setUniform2f("invFramebufferDim",1/y,1/x);d.setViewport(0,0,y,x);d.drawArrays(5,0,m.vertexCount(this.quadVAO,
"geometry"))}};c.getGpuMemoryUsage=function(){let d=(u.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(u.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const g of this._grid.coverageMipmap)d+=g.gpuMemoryUsage;return d};a._createClass(r,[{key:"profilingCallback",get:function(){return w.HIGHLIGHTS_PROFILE_TO_CONSOLE?d=>console.log(d):null}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return r}()})},
"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightComposition.glsl ../../../webgl/renderState".split(" "),function(a,u,f,p,t,w,e,n,b,h,k){w=function(l){function m(){return l.apply(this,
arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build(this.configuration);return new b.Program(r.rctx,c,n.Default3D)};z.bindApplyPass=function(r){this.program.setUniform4fv("color",r.color);this.program.setUniform4fv("haloColor",r.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",r.haloOpacity,r.haloOpacityOccluded,r.fillOpacity,r.fillOpacityOccluded)};
z.initializePipeline=function(){return 1===this.configuration.highlightStage?k.makePipelineState({blending:k.separateBlendingParams(770,1,771,771),colorWrite:k.defaultColorWriteParams}):k.makePipelineState({colorWrite:k.defaultColorWriteParams})};f._createClass(m,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?4:5}}]);return m}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(h.HighlightCompositionShader,()=>new Promise(function(l,m){a(["./HighlightComposition.glsl"],
l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.highlightStage=0;z.gridOptimization=!1;return z}f._inheritsLoose(m,l);return m}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:3})],t.prototype,"highlightStage",void 0);p.__decorate([e.parameter()],t.prototype,"gridOptimization",void 0);u.HighlightCompositionTechnique=w;u.HighlightCompositionTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,u,f){function p(w){const e=new f.ShaderBuilder,n=e.vertex.code,b=e.fragment.code;e.attributes.add("position","vec2");2===w.highlightStage&&(n.add(u.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("invFramebufferDim","vec2"),b.add(u.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`));0===w.highlightStage&&(e.attributes.add("uv0","vec2"),w.gridOptimization?(e.vertex.uniforms.add("coverageTex","sampler2D"),e.fragment.uniforms.add("blurSize","vec2"),e.varyings.add("blurCoordinate","vec3")):(e.vertex.uniforms.add("blurSize","vec2"),e.varyings.add("blurCoordinates[5]","vec2")),n.add(u.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${w.gridOptimization?u.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:u.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),e.fragment.uniforms.add("tex","sampler2D"),b.add(u.glsl`
    void main() {
      ${w.gridOptimization?u.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:u.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));1===w.highlightStage&&(e.varyings.add("uv","vec2"),w.gridOptimization&&(e.attributes.add("uv0","vec2"),e.vertex.uniforms.add("coverageTex","sampler2D")),n.add(u.glsl`
      void main() {
        ${w.gridOptimization?u.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("origin","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.uniforms.add("haloColor","vec4"),e.fragment.uniforms.add("outlineSize","float"),e.fragment.uniforms.add("blurSize","float"),e.fragment.uniforms.add("opacities","vec4"),b.add(u.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = color.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = color.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
}`));return e}var t=Object.freeze({__proto__:null,build:p});a.HighlightCompositionShader=t;a.build=p})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./RenderTargetHelper"],function(a,u,f){let p=function(){function e(b,h){this._rctx=b;this._compositingHelper=h;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};b=this._rctx;
const k="webgl2"===b.webglVersion,l=this.renderTargetHelper=new f.RenderTargetHelper(b);this.mainColorTarget0=l.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=l.registerColorTarget({name:"mainColorTarget1"});this.frontFaceTarget=l.registerColorTarget({name:"frontFaceTarget"});b=m=>l.registerColorTarget({name:m,dataType:5126,internalFormat:k?34836:6408,samplingMode:9728});this.colorFloatTarget=b("colorFloatTarget");this.alphaFloatTarget=b("alphaFloatTarget");this.mainDepth=l.registerDepthTarget({name:"mainDepth"});
this.linearDepth=l.registerColorTarget({name:"linearDepth",samplingMode:9728});this.terrainLinearDepth=l.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=l.registerColorTarget({name:"geometryLinearDepth"});this.normal=l.registerColorTarget({name:"normal"});this.highlight=l.registerColorTarget({name:"highlight",internalFormat:k?32854:6408,dataType:32819});this.hudVisibility=l.registerColorTarget({name:"hudVisibility",internalFormat:k?32854:6408,dataType:32819});this.tmpColor=
l.registerColorTarget({name:"tmpColor"});this.tmpDepth=l.registerDepthTarget({name:"tmpDepth"});this.hudColor=l.registerColorTarget({name:"hudColor"})}var n=e.prototype;n.dispose=function(){this.renderTargetHelper.dispose()};n.getFramebuffer=function(b,h){return this.renderTargetHelper.getFramebuffer(this.dimensions,b,h)};n.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};n.initializeFrame=function(b){const h=this._rctx;
this.dimensions.width=b.fullWidth;this.dimensions.height=b.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);h.setClearStencil(0);b=this._background.color;h.setClearColor(b[0]*b[3],b[1]*b[3],b[2]*b[3],b[3]);h.clearSafe(17664)};n.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};n.renderTmpAndCompositeToMain=function(b,h,k=!1){this.renderToTargets(b,this.tmpColor,k?this.tmpDepth:this.mainDepth,t);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),
h)};n.renderHUDVisibility=function(b,h=!1){this.renderToTargets(b,this.hudVisibility,h?this.tmpDepth:this.mainDepth,w)};n.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),1)},this.hudVisibility,this.tmpDepth)};n.renderOITPass=function(b,h,k){let l,m;switch(h){case 0:l=this.colorFloatTarget;m=[0,0,0,0];break;case 1:l=this.alphaFloatTarget;m=[1,1,1,1];break;case 2:l=this.frontFaceTarget,m=[0,
0,0,0]}k?this.renderToTargets(b,l,this.tmpDepth,m,!0,!0):this.renderToTargets(b,l,this.mainDepth,m,!1)};n.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};n.compositeOccludedOntoMain=function(b){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,b)};n.compositeTransparentOntoOpaque=function(b){b?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,
0,0,1E-13),this._rctx.clearSafe(16384)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))};n.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};n.renderDepthDetached=function(b){this.bindTarget(this.currentColorTarget);b();this.bindTarget(this.currentColorTarget,this.mainDepth)};n.disposeTarget=function(b){this.renderTargetHelper.disposeTargetResource(b)};
n.renderToTargets=function(b,h,k,l,m=!1,z=!1){const r=this._rctx;h=this.bindTarget(h,k);k=0;l&&(r.setClearColor(l[0],l[1],l[2],Math.max(1E-13,l[3])),k|=16384);m&&(k|=256);!1===z?z=0:(!0===z&&(z=255),k|=1024);k&&r.clearSafe(k,z);b();r.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return h};n.bindTarget=function(b,h){b=this.renderTargetHelper.getFramebuffer(this.dimensions,b,h);this._rctx.bindFramebuffer(b);return b};n.getColorTexture=function(b){return this.renderTargetHelper.getColorTexture(b,
this.dimensions)};n.getGpuMemoryUsage=function(){let b=0;this.renderTargetHelper&&(b+=this.renderTargetHelper.getGpuMemoryUsage());return b};u._createClass(e,[{key:"width",get:function(){return this.dimensions.width}},{key:"height",get:function(){return this.dimensions.height}},{key:"background",get:function(){return this._background},set:function(b){this._background=b}},{key:"currentColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}},{key:"previousColorTarget",
get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}},{key:"currentRenderTarget",get:function(){return this._currentRenderTarget}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},
{key:"linearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},
{key:"normalTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this.getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this.getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this.getColorTexture(this.hudColor)}},{key:"mainColorTexture",
get:function(){return this.getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(b){!b&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=b}}]);return e}();const t=[0,0,0,0],w=[0,1,0,1];a.OffscreenRendering=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define(["exports",
"../../../webgl/FramebufferObject","../../../webgl/Renderbuffer","../../../webgl/Texture","../../../webgl/Util"],function(a,u,f,p,t){const w={dataType:5121,internalFormat:6408},e={};let n=function(){function b(k){this.rctx=k;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this._nextId=1;this.depthTextureSupported=k.capabilities.depthTexture}var h=b.prototype;h.dispose=function(){this._depthBuffers.forEach(k=>
k.dispose());this._depthBuffers.clear();this._depthTextures.forEach(k=>k.dispose());this._depthTextures.clear();this._colorTextures.forEach(k=>k.dispose());this._colorTextures.clear();this._framebuffers.forEach(k=>k.dispose());this._framebuffers.clear()};h.disposeTargetResource=function(k){k=k.id;this._activeTargets.has(k)&&(this._activeTargets.delete(k),this.disposeWithFramebuffers(this._depthTextures,k),this.disposeWithFramebuffers(this._depthBuffers,k),this.disposeWithFramebuffers(this._colorTextures,
k))};h.disposeWithFramebuffers=function(k,l){const m=k.get(l);m&&(this._framebuffers.forEach((z,r)=>{if(z.colorAttachment===m||z.depthStencilAttachment===m)z.detachAll(),z.dispose(),this._framebuffers.delete(r)}),m.dispose(),k.delete(l))};h.getDepthTexture=function(k,l){if(this.depthTextureSupported){var m=this._depthTextures.get(k.id);!m||m.descriptor.width===l.width&&m.descriptor.height===l.height||(m.dispose(),m=void 0);m||(m=new p(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,
wrapMode:33071,width:l.width,height:l.height}),this._depthTextures.set(k.id,m),this._activeTargets.add(k.id));return m}};h.getAllocatedDepthTexture=function(k){return this._depthTextures.get(k.id)};h.getDepthBuffer=function(k,l){if(!this.depthTextureSupported){var m=this._depthBuffers.get(k.id);m?m.descriptor.width===l.width&&m.descriptor.height===l.height||m.resize(l.width,l.height):(m=new f(this.rctx,{internalFormat:34041,...l}),this._depthBuffers.set(k.id,m),this._activeTargets.add(k.id));return m}};
h.getColorTexture=function(k,l){let m=this._colorTextures.get(k.id);!m||m.descriptor.width===l.width&&m.descriptor.height===l.height||(m.dispose(),m=void 0);m||(m=new p(this.rctx,{target:3553,pixelFormat:6408,internalFormat:k.internalFormat,dataType:k.dataType,samplingMode:null!=k.samplingMode?k.samplingMode:9729,wrapMode:33071,width:l.width,height:l.height}),this._colorTextures.set(k.id,m),this._activeTargets.add(k.id));return m};h.getAllocatedColorTexture=function(k){return this._colorTextures.get(k.id)};
h.registerDepthTarget=function(k={}){return{id:this._nextId++,...e,...k}};h.registerColorTarget=function(k={}){return{id:this._nextId++,...w,...k}};h.getFramebuffer=function(k,l,m){const z=this.getKey(l,m);let r=this._framebuffers.get(z);l=this.getColorTexture(l,k);if(this.depthTextureSupported){var c=m?this.getDepthTexture(m,k):void 0;if(!r)return r=m?new u(this.rctx,{colorTarget:0,depthStencilTarget:4},l,c):new u(this.rctx,{colorTarget:0,depthStencilTarget:0},l),this._framebuffers.set(z,r),r;if(r.width!==
k.width||r.height!==k.height||r.colorTexture!==l||r.depthStencilTexture!==c)r.detachAll(),r.resize(k.width,k.height),r.attachColorTexture(l),r.attachDepthStencilTexture(c);return r}c=m?this.getDepthBuffer(m,k):void 0;if(!r)return r=new u(this.rctx,{colorTarget:0,depthStencilTarget:m?3:0},l,c),this._framebuffers.set(z,r),r;if(r.width!==k.width||r.height!==k.height||r.colorTexture!==l)r.detachAll(),r.resize(k.width,k.height),r.attachColorTexture(l),r.attachDepthStencilBuffer(c);return r};h.getKey=function(k,
l){return`${k.id}_${l?l.id:"X"}_${k.name}${l?"_"+l.name:""}`};h.getGpuMemoryUsage=function(){let k=0;const l=new Set,m=z=>{l.has(z)||(l.add(z),k+=t.getGpuMemoryUsage(z))};this._depthTextures.forEach(m);this._colorTextures.forEach(m);this._depthBuffers.forEach(m);return k};return b}();a.RenderTargetHelper=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils",
"./depthRange","./Util"],function(a,u,f,p,t){let w=function(){function n(h){this.context=h;this.renderPlugins=[];this.slots=[];for(h=0;23>h;++h)this.slots[h]=[]}var b=n.prototype;b.add=function(h,k,l=null){l=k.initializeRenderContext(this.context,l);const m=()=>{this.renderPlugins.push(k);for(let z=0;z<h.length;++z)this.slots[h[z]].push(k);this.context.requestRender()};if(f.isPromise(l))return l.then(m);m()};b.remove=function(h){var k=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(l=>
l!==h);t.assert(this.renderPlugins.length<k,"Removing non-added render plugin");for(k=0;k<this.slots.length;++k)this.slots[k]=this.slots[k].filter(l=>l!==h);h.uninitializeRenderContext();this.context.requestRender()};b.prepareRender=function(h,k){for(const l of this.renderPlugins)l.prepareRender&&l.prepareRender(h,k)};b.render=function(){const h=this.slots[this.context.renderContext.slot];let k=!1;for(const l of h)l.canRender&&l.render(this.context.renderContext)&&(k=!0);return k};b.queryDepthRange=
function(h){const k=e;k.near=Infinity;k.far=-Infinity;for(const l of this.renderPlugins)if(l.queryDepthRange){const m=l.queryDepthRange(h);m&&p.union(k,m,k)}return k};u._createClass(n,[{key:"needsHighlight",get:function(){return this.renderPlugins.some(h=>h.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(h=>h.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const h=this.slots[17];return!!h&&0<h.length}},{key:"renderOccludedFlags",
get:function(){let h=0;this.renderPlugins.forEach(k=>{k.renderOccludedFlags&&(h|=k.renderOccludedFlags)});return h}}]);return n}();const e={near:0,far:0};a.RenderPluginManager=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/trackingUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./Camera ./depthRange ./glUtil3D ./ShadowAccumulationRenderer ./ShadowMap ./Util ../../../../chunks/ShadowAccumulation.glsl ../shaders/ShadowAccumulationTechnique ../../../support/Scheduler ../../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G){z=function(){function H(M,O,Q,S,V,Y){this._rctx=M;this._stage=Q;this._prepareForShadowMapPass=S;this._renderToShadowMap=V;this._requestRender=Y;this._sampleCount=this._progress=0;this._cachedCamera=new D;this._contentCamera=new D;this._enabled=!1;this._cachedLightDirections=[];this._depthRange=C.ZERO;this._previewing=!1;this._handles=new p;this._cameraForcedForScreenshot=!1;this._shadowMap=new E(M,Q.viewingMode);this._shadowMap.enabled=
!0;this._vao=B.createQuadVAO(M);S={rctx:M,viewingMode:Q.viewingMode};V=new N.ShadowAccumulationTechniqueConfiguration;V.pass=0;this._accumulationTechnique=new N.ShadowAccumulationTechnique(S,V);this._fbo=new r(M,{colorTarget:0,depthStencilTarget:0,width:0,height:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0});this._accumulationParams={camera:this._cachedCamera,linearDepthTexture:null,shadowMap:this._shadowMap,inverseView:b.create(),projInfo:m.create(),
zScale:h.create()};this._accumulationRenderer=new v.ShadowAccumulationRenderer(O,M,this,Y);this._handles.add(this._stage.resourceController.scheduler.registerTask(I.TaskPriority.SHADOW_ACCUMULATOR,this));this._handles.add(e.reactionInit(()=>Q.renderView,W=>{this._handles.remove(H.renderViewHandleKey);w.isNone(W)||this._handles.add(W.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),H.renderViewHandleKey)}))}var J=H.prototype;J.runTask=function(M){for(this._prepareForShadowMapPass(this._cachedCamera,
this._contentCamera);!M.done&&!this._isDoneAccumulating;)this._accumulateShadow(),M.madeProgress();this._requestRender()};J.accumulateFixedSamples=function(){if(this.isAccumulating&&this._canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();var M=this._cameraForcedForScreenshot?this._sampleCount:Math.min(H.previewSamples,this._sampleCount-this._progress);for(let O=0;O<M;++O)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};J.render=function(){this._accumulationRenderer.render()};
J.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=w.disposeMaybe(this._accumulationRenderer);this._shadowMap=w.disposeMaybe(this._shadowMap);this._fbo=w.disposeMaybe(this._fbo);this._vao=w.disposeMaybe(this._vao);this._accumulationTechnique=w.disposeMaybe(this._accumulationTechnique);this._sampleCount=this._cachedLightDirections.length=0};J.setOptions=function(M){void 0!==M.enabled&&this._setEnabled(M.enabled);void 0!==M.previewing&&this.setPreviewing(M.previewing);
void 0!==M.lightDirections&&this.setLightDirections(M.lightDirections);this._accumulationRenderer.setOptions(M)};J.setPreviewing=function(M){this._previewing!==M&&(this._previewing=M,this._requestRenderIfEnabled())};J.setLightDirections=function(M){this._lightDirections=M};J.setAccumulationDependencies=function(M,O,Q,S){this._accumulationParams.linearDepthTexture=M;this._depthRange=O;this._updateCamera(Q);this._contentCamera=S};J.readAccumulatedShadow=function(M,O){if(!this._isActive||1>this._progress||
0>M||M>this._fbo.width||0>O||O>this._fbo.height)return 0;const Q=K;this._fbo.readPixels(M,O,1,1,6408,5121,Q);return Q[0]/this._progress};J._start=function(){this._progress=0;this._enabled=!0};J._stop=function(){this._enabled=!1};J._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};J._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(16384);this._progress=0};J._accumulateShadow=function(){this._renderToShadowMap(this._shadowMap,
this._lightDirections[this._progress],this._cachedCamera,this._depthRange);this._rctx.bindFramebuffer(this._fbo);this._rctx.useProgram(this._accumulationTechnique.program);this._accumulationTechnique.bindPipelineState(this._rctx);this._accumulationTechnique.bindPass(this._accumulationParams);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(this._accumulationTechnique.primitiveType,0,G.vertexCount(this._vao,"geometry"));this._progress++};J._updateCamera=function(M){if(!M.equals(this._cachedCamera)){var {fullWidth:O,
fullHeight:Q,projectionMatrix:S,viewMatrix:V,center:Y}=M;this._cachedCamera.copyFrom(M);this._fbo.resize(O,Q);F.inverseProjectionInfo(S,O,Q,this._projInfo,this._zScale);n.translate(this._inverseView,V,Y);n.invert(this._inverseView,this._inverseView);this._opacityFromElevation=1-t.smoothstep(v.shadowAccumulationDisableElevationMin,v.shadowAccumulationDisableElevationMax,M.relativeElevation)}};J._setEnabled=function(M){M!==this._enabled&&(M?this._start():this._stop())};J._requestRenderIfEnabled=function(){this._enabled&&
this._requestRender()};u._createClass(H,[{key:"computedSamples",get:function(){return this._progress}},{key:"accumulationTexture",get:function(){return this._fbo.colorTexture}},{key:"running",get:function(){return this._isRefining&&this._canAccumulate}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},
{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"_canAccumulate",get:function(){return null!==this._accumulationParams.linearDepthTexture&&this._depthRange!==C.ZERO&&this._opacityFromElevation>v.shadowAccumulationDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(M){const O=this._cachedLightDirections;if(!f.equals(O,
M,k.equals)){var Q=M.length;O.length=Q;this._sampleCount=Math.min(L.shadowAccumulationMaxSamples,Q);for(let S=0;S<Q;++S){const V=M[S],Y=O[S]||l.create();k.copy(Y,V);O[S]=Y}this._invalidate()}}},{key:"_projInfo",get:function(){return this._accumulationParams.projInfo}},{key:"_zScale",get:function(){return this._accumulationParams.zScale}},{key:"_inverseView",get:function(){return this._accumulationParams.inverseView}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},
set:function(M){this._accumulationRenderer.opacityFromElevation=M}}]);return H}();z.previewSamples=6;z.renderViewHandleKey="renderView";const K=new Uint8Array(4);a.ShadowAccumulator=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulationRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../chunks/vec4f64 ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/ProgramCache ../../../webgl/Renderbuffer ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../../../webgl/Texture ../../../webgl/VertexArrayObject ./glUtil3D ../shaders/ShadowAccumulationTechnique ../../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){function g(y){const x=y.length,D=new Uint8Array(4*x);for(let C=0;C<x;++C){const B=y[C];D[4*C]=255*B[0];D[4*C+1]=255*B[1];D[4*C+2]=255*B[2];D[4*C+3]=255*B[3]}return D}const A=[t.fromValues(.01,0,.25,0),t.fromValues(.01,0,.25,1)],q=1/512;w=function(){function y(D,C,B,v){this._techniqueRep=D;this._rctx=C;this._shadowAccumulator=B;this._requestRender=v;this._enabled=!1;this._vao=r.createQuadVAO(C);this._visualizationConfig=new c.ShadowAccumulationTechniqueConfiguration;
this._visualizationConfig.pass=1;this._visualizationConfig.visualization=0;this._visualizeAccumulationTechnique=D.acquire(c.ShadowAccumulationTechnique,this._visualizationConfig);D={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:A.length,height:1};this._colorRampTexture=new m(this._rctx,D,g(A));this._visualizationParams={shadowAccumulationMap:this._accumulationTexture,sampleScale:0,colorRamp:this._colorRampTexture,rampSize:D.width,threshold:.5,bandSize:.1,colors:f.flatten([t.fromValues(0,
1,0,.5),t.fromValues(1,0,0,.5)]),opacityFromElevation:1}}var x=y.prototype;x.dispose=function(){this._stop();this._vao=p.disposeMaybe(this._vao);this._visualizeAccumulationTechnique=p.disposeMaybe(this._visualizeAccumulationTechnique);this._colorRampTexture=p.disposeMaybe(this._colorRampTexture);this._shadowAccumulator=null};x.render=function(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeAccumulationTechnique.program),
this._visualizeAccumulationTechnique.bindPipelineState(this._rctx),this._visualizeAccumulationTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeAccumulationTechnique.primitiveType,0,d.vertexCount(this._vao,"geometry")))};x.setOptions=function(D){void 0!==D.enabled&&this._setEnabled(D.enabled);void 0!==D.gradientColorRamp&&this._setColorRamp(D.gradientColorRamp);void 0!==D.threshold&&(this._threshold=D.threshold);void 0!==D.thresholdColors&&this._setThresholdColors(D.thresholdColors);
void 0!==D.visualization&&(this._visualization=D.visualization);void 0!==D.bandSize&&(this._bandSize=D.bandSize);void 0!==D.bandsEnabled&&(this._bandsEnabled=D.bandsEnabled)};x._setColorRamp=function(D){const C=D.length;D=g(D);this._colorRampTexture.resize(C,1);this._colorRampTexture.setData(D);this._visualizationParams.rampSize=C;this._requestRenderIfRunning()};x._setThresholdColors=function(D){const C=this._visualizationParams.colors;D=f.flatten(D);f.equals(C,D)||(this._visualizationParams.colors=
D,this._requestRenderIfRunning())};x._setEnabled=function(D){D!==this._enabled&&(D?this._start():this._stop())};x._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};x._start=function(){this._enabled=!0;this._requestRender()};x._stop=function(){this._enabled=!1;this._requestRender()};u._createClass(y,[{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(D){this._visualizationParams.opacityFromElevation=D}},{key:"_isRenderingVisualization",
get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>q}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_accumulationTexture",get:function(){return this._shadowAccumulator.accumulationTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(D){this._visualizationParams.sampleScale=D}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(D){this._threshold!==
D&&(this._visualizationParams.threshold=D,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._visualizationConfig.visualization},set:function(D){if(D!==this._visualization){var C=this._visualizationConfig;C.visualization=D;this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(c.ShadowAccumulationTechnique,C,this._visualizeAccumulationTechnique);this._requestRenderIfRunning()}}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},
set:function(D){D!==this._bandSize&&(this._visualizationParams.bandSize=D,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._visualizationConfig.bandsEnabled},set:function(D){if(D!==this._bandsEnabled){var C=this._visualizationConfig;C.bandsEnabled=D;this._visualizeAccumulationTechnique=this._techniqueRep.releaseAndAcquire(c.ShadowAccumulationTechnique,C,this._visualizeAccumulationTechnique);this._requestRenderIfRunning()}}}]);return y}();a.ShadowAccumulationRenderer=
w;a.shadowAccumulationDisableElevationMax=5E4;a.shadowAccumulationDisableElevationMin=4E4;a.shadowAccumulationDisabledElevationThreshold=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowAccumulationTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowAccumulation.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){w=function(m){function z(){return m.apply(this,arguments)||this}f._inheritsLoose(z,m);var r=z.prototype;r.initializeProgram=function(c){const d=z.shader.get().build(this.configuration);return new h.Program(c.rctx,d,n.Default3D)};r.initializePipeline=function(c){return 0===this.configuration.pass?l.makePipelineState({blending:l.separateBlendingParams(1,1,1,1),colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?
l.makePipelineState({blending:b.blendingDefault,colorWrite:l.defaultColorWriteParams,depthTest:null,depthWrite:null}):l.makePipelineState({})};r.bindPass=function(c){0===this.configuration.pass||2===this.configuration.pass?(this.program.bindTexture(c.linearDepthTexture,"depthMap"),c.shadowMap.bind(this.program),c.shadowMap.bindView(this.program,c.camera.center),this.program.setUniform2fv("nearFar",c.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",c.inverseView),this.program.setUniform4fv("projInfo",
c.projInfo),this.program.setUniform2fv("zScale",c.zScale)):1===this.configuration.pass&&(this.program.bindTexture(c.shadowAccumulationMap,"shadowAccumulationMap"),this.program.setUniform1f("sampleScale",c.sampleScale),this.program.setUniform1f("opacityFromElevation",c.opacityFromElevation),0===this.configuration.visualization?(this.program.bindTexture(c.colorRamp,"colorRamp"),this.program.setUniform1f("rampSize",c.rampSize),this.configuration.bandsEnabled&&this.program.setUniform1f("bandSize",c.bandSize)):
1===this.configuration.visualization&&(this.program.setUniform1f("threshold",c.threshold),this.program.setUniform4fv("colors",c.colors)))};f._createClass(z,[{key:"primitiveType",get:function(){return 5}}]);return z}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(k.ShadowAccumulationShader,()=>new Promise(function(m,z){a(["./ShadowAccumulation.glsl"],m,z)}));t=function(m){function z(){var r=m.apply(this,arguments)||this;r.pass=0;r.visualization=0;r.bandsEnabled=!1;return r}f._inheritsLoose(z,
m);return z}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:3})],t.prototype,"pass",void 0);p.__decorate([e.parameter()],t.prototype,"visualization",void 0);p.__decorate([e.parameter()],t.prototype,"bandsEnabled",void 0);u.ShadowAccumulationTechnique=w;u.ShadowAccumulationTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/ShadowAccumulation.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n){function b(l){const m=new n.ShaderBuilder;m.fragment.include(w.RgbaFloatEncoding);m.fragment.include(f.ReadLinearDepth);m.include(t.CameraSpace);m.include(u.ScreenSpacePass);const {pass:z}=l;if(1===z){const {visualization:r,bandsEnabled:c}=l;m.fragment.constants.add("inverseSampleValue","float",255);m.fragment.uniforms.add("shadowAccumulationMap","sampler2D");m.fragment.uniforms.add("sampleScale","float");m.fragment.uniforms.add("opacityFromElevation","float");0===r?(m.fragment.uniforms.add("colorRamp",
"sampler2D"),m.fragment.uniforms.add("rampSize","float"),m.fragment.code.add(e.glsl`vec4 sampleColorRamp(sampler2D ramp, float rampSize, float u) {
float rampU = (u * (rampSize - 1.0) + 0.5) / rampSize;
return texture2D(ramp, vec2(rampU, 0.5));
}`),c&&m.fragment.uniforms.add("bandSize","float")):1===r&&(m.fragment.uniforms.add("threshold","float"),m.fragment.uniforms.add("colors","vec4",2));m.fragment.code.add(e.glsl`
      void main(void) {
        vec4 record = texture2D(shadowAccumulationMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${0===r&&c?e.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = ${0===r?e.glsl`sampleColorRamp(colorRamp, rampSize, strength)`:e.glsl`strength <= threshold ? colors[0] : colors[1]`};

        gl_FragColor.a *= opacityFromElevation;
      }
    `)}else if(0===z||2===z)m.include(p.ReadShadowMap),m.fragment.uniforms.add("depthMap","sampler2D"),m.fragment.uniforms.add("inverseView","mat4"),m.fragment.uniforms.add("nearFar","vec2"),0===z?m.fragment.constants.add("sampleValue","float",h):m.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),m.fragment.code.add(e.glsl`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseView * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= uShadowMapNum) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, uShadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${0===z?e.glsl`vec4(sampleValue)`:e.glsl`shadowColor`};
      }
    `);return m}const h=1/255;var k=Object.freeze({__proto__:null,shadowAccumulationMaxSamples:255,build:b});a.ShadowAccumulationShader=k;a.build=b;a.shadowAccumulationMaxSamples=255})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.CameraSpace=function(f){f.fragment.uniforms.add("projInfo","vec4");f.fragment.uniforms.add("zScale","vec2");f.fragment.code.add(u.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./Camera ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){function g(T,P){e.set(R,T[P],T[P+3]);return R}let A=function(){this.camera=new m;this.lightMat=w.create()},q=function(){function T(X,aa,ja=0){this.rctx=X;this.viewingMode=aa;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(X=0;4>X;++X)this.cascades.push(new A);
this.snapshotCount=ja}var P=T.prototype;P.dispose=function(){this.discardDepthTexture();this.discardAllSnapshots()};P.getSnapshot=function(X){return this.enabled?this._snapshots[X]:null};P.getCascades=function(){for(let X=0;X<this.numCascades;++X)J[X]=this.cascades[X];J.length=this.numCascades;return J};P.start=function(X,aa,ja){z.assert(this.enabled);this.textureSize=this.computeTextureSize(X.fullWidth,X.fullHeight);this.ensureDepthTexture();const {near:ia,far:ka}=this.clampNearFar(ja);this.computeCascadeDistances(ka,
ia);this.setupMatrices(X,aa);ja=X.viewMatrix;X=X.projectionMatrix;for(let na=0;na<this.numCascades;++na)this.constructCascade(na,X,ja,aa);this.lastOrigin=null;this.clear()};P.finish=function(X){z.assert(this.enabled);this.rctx.bindFramebuffer(X)};P.bind=function(X){this.enabled?(this._depthTextureUnit=X.bindTexture(this._depthTexture,"uShadowMapTex"),X.setUniform1f("uDepthHalfPixelSz",.5/this.textureSize),X.setUniform1i("uShadowMapNum",this.numCascades),X.setUniform4f("uShadowMapDistance",this.cascadeDistances[0],
1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)):X.setUniform1f("uDepthHalfPixelSz",-1)};P.bindView=function(X,aa){if(this.enabled){var ja=this.lastOrigin;if(!ja||ja[0]!==aa[0]||ja[1]!==aa[1]||ja[2]!==aa[2])for(this.lastOrigin=this.lastOrigin||h.create(),b.copy(this.lastOrigin,aa),ja=0;ja<this.numCascades;++ja){t.translate(M,this.cascades[ja].lightMat,aa);for(let ia=0;16>ia;++ia)O[16*ja+
ia]=M[ia]}X.setUniformMatrix4fv("uShadowMapMatrix",O)}};P.takeCascadeSnapshotTo=function(X,aa){z.assert(this.enabled);this.ensureSnapshot(aa);this._bindFbo();const ja=this.rctx;aa=ja.bindTexture(this._snapshots[aa],c.TEXTURE_UNIT_FOR_UPDATES);ja.gl.copyTexSubImage2D(3553,0,X.camera.viewport[0],X.camera.viewport[1],X.camera.viewport[0],X.camera.viewport[1],X.camera.viewport[2],X.camera.viewport[3]);ja.bindTexture(aa,c.TEXTURE_UNIT_FOR_UPDATES)};P.clear=function(){const X=this.rctx;this._bindFbo();
X.setClearColor(1,1,1,1);X.clearSafe(16640)};P.computeTextureSize=function(X,aa){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(X*X+aa*aa)*Math.LOG2E+.35))};P.ensureDepthTexture=function(){if(null==this._depthTexture||this._depthTexture.descriptor.width!==this.textureSize)this.discardDepthTexture(),this._depthTexture=new c(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new r(this.rctx,
{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this._depthTexture)};P.ensureSnapshot=function(X){const aa=this._snapshots[X];f.isSome(aa)&&aa.descriptor.width===this.textureSize||(this.discardSnapshot(X),this._snapshots[X]=new c(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}))};P.discardDepthTexture=function(){this.fbo=f.disposeMaybe(this.fbo);this._depthTexture=
f.disposeMaybe(this._depthTexture)};P.discardSnapshot=function(X){this._snapshots[X]=f.disposeMaybe(this._snapshots[X])};P.discardAllSnapshots=function(){for(let X=0;X<this.snapshotCount;++X)this.discardSnapshot(X)};P._bindFbo=function(){const X=this.rctx;f.isSome(this._depthTextureUnit)&&(X.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null);X.bindFramebuffer(this.fbo)};P.constructCascade=function(X,aa,ja,ia){const ka=this.cascades[X];var na=-this.cascadeDistances[X],ta=-this.cascadeDistances[X+
1];na=(aa[10]*na+aa[14])/Math.abs(aa[11]*na+aa[15]);aa=(aa[10]*ta+aa[14])/Math.abs(aa[11]*ta+aa[15]);z.assert(na<aa);for(ta=0;8>ta;++ta){k.set(C,0===ta%4||3===ta%4?-1:1,0===ta%4||1===ta%4?-1:1,4>ta?na:aa,1);k.transformMat4(B[ta],C,D);for(let pa=0;3>pa;++pa)B[ta][pa]/=B[ta][3]}b.negate(H,B[0]);t.translate(y,K,H);ka.camera.viewMatrix=y;for(na=0;8>na;++na)b.transformMat4(B[na],B[na],ka.camera.viewMatrix);b.copy(v,B[0]);b.copy(E,B[0]);for(na=1;8>na;++na)for(aa=0;3>aa;++aa)v[aa]=Math.min(v[aa],B[na][aa]),
E[aa]=Math.max(E[aa],B[na][aa]);v[2]-=200;E[2]+=200;ka.camera.near=-E[2];ka.camera.far=-v[2];this.warp?this.constructTrapezoidalProjection(ja,ia,ka):this.constructOrthogonalProjection(ka);t.multiply(ka.lightMat,ka.camera.projectionMatrix,ka.camera.viewMatrix);ja=this.textureSize/2;ka.camera.viewport[0]=0===X%2?0:ja;ka.camera.viewport[1]=0===Math.floor(X/2)?0:ja;ka.camera.viewport[2]=ja;ka.camera.viewport[3]=ja};P.constructOrthogonalProjection=function(X){t.ortho(X.camera.projectionMatrix,v[0],E[0],
v[1],E[1],X.camera.near,X.camera.far)};P.constructTrapezoidalProjection=function(X,aa,ja){var ia=1/B[0][3],ka=1/B[4][3];z.assert(ia<ka);ia+=Math.sqrt(ia*ka);var na=Math.sin(u.acosClamped(X[2]*aa[0]+X[6]*aa[1]+X[10]*aa[2]));X=B;var ta=ia/na;aa=F;var pa=L,xa=N;ka=I;ia=G;e.set(Q,0,0);for(var Da=0;4>Da;++Da)e.add(Q,Q,X[Da]);e.scale(Q,Q,.25);e.set(S,0,0);for(Da=4;8>Da;++Da)e.add(S,S,X[Da]);e.scale(S,S,.25);e.lerp(V[0],X[4],X[5],.5);e.lerp(V[1],X[5],X[6],.5);e.lerp(V[2],X[6],X[7],.5);e.lerp(V[3],X[7],X[4],
.5);Da=0;var Ka=e.squaredDistance(V[0],Q);for(var Fa=1;4>Fa;++Fa){var Ha=e.squaredDistance(V[Fa],Q);Ha<Ka&&(Ka=Ha,Da=Fa)}e.subtract(Y,V[Da],X[Da+4]);Da=Y[0];Y[0]=-Y[1];Y[1]=Da;e.subtract(W,S,Q);0>e.dot(W,Y)&&e.negate(Y,Y);e.lerp(Y,Y,W,na);e.normalize(Y,Y);na=Da=e.dot(e.subtract(ba,X[0],Q),Y);for(Ka=1;8>Ka;++Ka)Fa=e.dot(e.subtract(ba,X[Ka],Q),Y),Fa<na?na=Fa:Fa>Da&&(Da=Fa);e.copy(aa,Q);e.scale(ba,Y,na-ta);e.add(aa,aa,ba);Fa=-1;Ha=1;ta=Ka=0;for(let ua=0;8>ua;++ua){e.subtract(ca,X[ua],aa);e.normalize(ca,
ca);const Ba=Y[0]*ca[1]-Y[1]*ca[0];0<Ba?Ba>Fa&&(Fa=Ba,Ka=ua):Ba<Ha&&(Ha=Ba,ta=ua)}z.verify(0<Fa,"leftArea");z.verify(0>Ha,"rightArea");e.scale(da,Y,na);e.add(da,da,Q);e.scale(ha,Y,Da);e.add(ha,ha,Q);fa[0]=-Y[1];fa[1]=Y[0];pa=z.rayRay2D(aa,X[ta],ha,e.add(ba,ha,fa),1,pa);xa=z.rayRay2D(aa,X[Ka],ha,ba,1,xa);ka=z.rayRay2D(aa,X[Ka],da,e.add(ba,da,fa),1,ka);X=z.rayRay2D(aa,X[ta],da,ba,1,ia);z.verify(pa,"rayRay");z.verify(xa,"rayRay");z.verify(ka,"rayRay");z.verify(X,"rayRay");xa=F;X=L;aa=I;ka=G;ia=ja.camera.projectionMatrix;
e.subtract(U,aa,ka);e.scale(U,U,.5);Z[0]=U[0];Z[1]=U[1];Z[2]=0;Z[3]=U[1];Z[4]=-U[0];Z[5]=0;Z[6]=U[0]*U[0]+U[1]*U[1];Z[7]=U[0]*U[1]-U[1]*U[0];Z[8]=1;Z[6]=-e.dot(g(Z,0),xa);Z[7]=-e.dot(g(Z,1),xa);xa=e.dot(g(Z,0),aa)+Z[6];pa=e.dot(g(Z,1),aa)+Z[7];ta=e.dot(g(Z,0),ka)+Z[6];ka=e.dot(g(Z,1),ka)+Z[7];xa=-(xa+ta)/(pa+ka);Z[0]+=Z[1]*xa;Z[3]+=Z[4]*xa;Z[6]+=Z[7]*xa;xa=1/(e.dot(g(Z,0),aa)+Z[6]);pa=1/(e.dot(g(Z,1),aa)+Z[7]);Z[0]*=xa;Z[3]*=xa;Z[6]*=xa;Z[1]*=pa;Z[4]*=pa;Z[7]*=pa;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=
1;xa=e.dot(g(Z,1),X)+Z[7];pa=e.dot(g(Z,2),X)+Z[8];ta=e.dot(g(Z,1),aa)+Z[7];ka=e.dot(g(Z,2),aa)+Z[8];xa=-.5*(xa/pa+ta/ka);Z[1]+=Z[2]*xa;Z[4]+=Z[5]*xa;Z[7]+=Z[8]*xa;xa=e.dot(g(Z,1),X)+Z[7];pa=e.dot(g(Z,2),X)+Z[8];ta=-pa/xa;Z[1]*=ta;Z[4]*=ta;Z[7]*=ta;ia[0]=Z[0];ia[1]=Z[1];ia[2]=0;ia[3]=Z[2];ia[4]=Z[3];ia[5]=Z[4];ia[6]=0;ia[7]=Z[5];ia[8]=0;ia[9]=0;ia[10]=1;ia[11]=0;ia[12]=Z[6];ia[13]=Z[7];ia[14]=0;ia[15]=Z[8];ja.camera.projectionMatrix[10]=2/(v[2]-E[2]);ja.camera.projectionMatrix[14]=-(v[2]+E[2])/(v[2]-
E[2])};P.setupMatrices=function(X,aa){t.multiply(x,X.projectionMatrix,X.viewMatrix);t.invert(D,x);X=1===this.viewingMode?X.eye:b.set(H,0,0,1);t.lookAt(K,[0,0,0],[-aa[0],-aa[1],-aa[2]],X)};P.clampNearFar=function(X){let {near:aa,far:ja}=X;2>aa&&(aa=2);2>ja&&(ja=2);aa>=ja&&(aa=2,ja=4);return{near:aa,far:ja}};P.computeCascadeDistances=function(X,aa){this.numCascades=Math.min(1+Math.floor(z.logWithBase(X/aa,4)),this.maxNumCascades);const ja=(X-aa)/this.numCascades;X=(X/aa)**(1/this.numCascades);let ia=
aa;for(let ka=0;ka<this.numCascades+1;++ka)this.cascadeDistances[ka]=u.lerp(ia,aa,this.splitSchemeLambda),ia*=X,aa+=ja};P.getGpuMemoryUsage=function(){var X,aa;return this._snapshots.reduce((ja,ia)=>ja+d.getGpuMemoryUsage(ia),null!=(X=null==(aa=this.fbo)?void 0:aa.gpuMemoryUsage)?X:0)};a._createClass(T,[{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(X){this.maxNumCascades=u.clamp(Math.floor(X),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(X){this._enabled=
X;X||(this.discardDepthTexture(),this.discardAllSnapshots())}},{key:"snapshotCount",get:function(){return this._snapshots.length},set:function(X){var aa=this._snapshots.length;if(X>aa){var ja=X-aa;this._snapshots.length=X;for(X=0;X<ja;++X)this._snapshots[aa+X]=null}else if(X<this.snapshotCount){aa-=X;for(ja=0;ja<aa;++ja)this.discardSnapshot(X+ja);this._snapshots.length=X}}},{key:"test",get:function(){const X=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,
depthTexture:this._depthTexture,set splitSchemeLambda(aa){X.splitSchemeLambda=aa},get splitSchemeLambda(){return X.splitSchemeLambda},set warp(aa){X.warp=aa},get warp(){return X.warp}}}}]);return T}();const y=w.create(),x=w.create(),D=w.create(),C=l.create(),B=[];for(let T=0;8>T;++T)B.push(l.create());const v=h.create(),E=h.create(),F=n.create(),L=n.create(),N=n.create(),I=n.create(),G=n.create(),K=w.create(),H=h.create(),J=[],M=w.create(),O=new Float32Array(64),Q=n.create(),S=n.create(),V=[n.create(),
n.create(),n.create(),n.create()],Y=n.create(),W=n.create(),ba=n.create(),ca=n.create(),da=n.create(),ha=n.create(),fa=n.create(),R=n.create(),U=n.create(),Z=p.create();return q})},"esri/views/3d/webgl-engine/lib/ShadowHighlightHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4f32 ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),function(a,u,f,p,t,w,e){let n=function(){function b(k,l){this._rctx=
k;this._maxOpacity=1;this._defaultOptions={shadowColor:p.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1};this._technique=new w.ShadowHighlightTechnique({rctx:k,viewingMode:l},null);this._vao=t.createQuadVAO(this._rctx)}var h=b.prototype;h.render=function(k,l){k.shadowMap.enabled&&k.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(l),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,
k),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,e.vertexCount(this._vao,"geometry")))};h.getGpuMemoryUsage=function(){return this._vao?this._vao.size:0};h.setDefaultOptions=function(k){this._defaultOptions=k;this._updateMaxOpacity()};h.dispose=function(){this._vao=f.disposeMaybe(this._vao);this._technique=f.disposeMaybe(this._technique)};h._updateMaxOpacity=function(){const k=this._defaultOptions;this._maxOpacity=Math.max(k.shadowOpacity,k.occludedShadowOpacity)*
k.shadowColor[3]};u._createClass(b,[{key:"highlightShadowMapSlot",get:function(){return this._technique.highlightShadowMapSlot}},{key:"defaultSnapshotSlot",get:function(){return this._technique.defaultSnapshotSlot}},{key:"isVisible",get:function(){return.001953125<=this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator}}]);return b}();a.ShadowHighlightHelper=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){m=function(C){function B(){var E=C.apply(this,arguments)||this;E.opacityElevation=1;E.dayNightTerminator=1;E.highlightShadowMapSlot=0;E.defaultSnapshotSlot=1;return E}f._inheritsLoose(B,C);var v=B.prototype;v.initializeProgram=function(E){var F=B.shader.get();this._viewingMode=E.viewingMode;F=F.build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new r.Program(E.rctx,F,z.Default3D)};v.initializePipeline=function(E){return g.makePipelineState({blending:g.separateBlendingParams(770,
1,771,771),colorWrite:g.defaultColorWriteParams,depthTest:null,depthWrite:null})};v.bindPass=function(E,F){this.opacityElevation=1-p.smoothstep(4E4,5E4,F.camera.relativeElevation);var L=1===this._viewingMode?b.normalize(A,F.camera.center):b.set(A,0,0,1);L=b.dot(L,F.lighting.lightingMainDirection);this.dayNightTerminator=p.smoothstep(0,1,p.clamp(30*L,0,1));this.program.bindTexture(F.linearDepthTexture,"depthMap");this.program.bindTexture(F.highlightColorTexture,"highlightMap");b.transformMat4(q,F.lighting.lightingMainDirection,
F.camera.viewInverseTransposeMatrix);b.normalize(q,q);c.inverseProjectionInfo(F.camera.projectionMatrix,F.camera.fullWidth,F.camera.fullHeight,x,y);w.translate(D,F.camera.viewMatrix,F.camera.center);w.invert(D,D);this.program.setUniform4fv("color",E.shadowColor);this.program.setUniform1f("opacity",E.shadowOpacity);this.program.setUniform1f("occludedOpacity",E.occludedShadowOpacity);this.program.setUniform1f("terminationFactor",this.opacityElevation*this.dayNightTerminator);this.program.setUniform2fv("nearFar",
F.camera.nearFar);this.program.setUniformMatrix4fv("inverseView",D);this.program.setUniform4fv("projInfo",x);this.program.setUniform2fv("zScale",y);this.program.setUniform3fv("lightingMainDirectionView",q);this.program.setUniform2f("texelSize",1/F.linearDepthTexture.descriptor.width,1/F.linearDepthTexture.descriptor.height);F.shadowMap.bind(this.program);F.shadowMap.bindView(this.program,F.camera.center);E=F.shadowMap.getSnapshot(this.highlightShadowMapSlot);t.isSome(E)&&this.program.bindTexture(E,
"highlightDepthTex");E=F.shadowMap.getSnapshot(this.defaultSnapshotSlot);t.isSome(E)&&this.program.bindTexture(E,"defaultDepthTex")};f._createClass(B,[{key:"primitiveType",get:function(){return 5}}]);return B}(m.ShaderTechnique);m.shader=new l.ReloadableShaderModule(d.ShadowHighlightShader,()=>new Promise(function(C,B){a(["./ShadowHighlight.glsl"],C,B)}));const A=h.create(),q=h.create(),y=n.create(),x=k.create(),D=e.create();u.ShadowHighlightTechnique=m;Object.defineProperty(u,"__esModule",{value:!0})})},
"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w,e,n,b){function h(l){const m=new b.ShaderBuilder;m.include(t.ReadShadowMap);m.fragment.include(e.RgbaFloatEncoding);m.fragment.include(p.ReadLinearDepth);m.include(w.CameraSpace);m.include(u.ScreenSpacePass);m.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("color","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor",
"float").add("inverseView","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2");m.fragment.constants.add("unoccludedHighlightFlag","vec4",f.unoccludedHighlightFlag).add("highlightedThreshold","float",l.highlightedThreshold).add("selfShadowThreshold","float",l.selfShadowThreshold);m.fragment.code.add(n.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);m.fragment.code.add(n.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseView * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= uShadowMapNum) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(color.rgb, color.a * fragOpacity * terminationFactor);
}`);return m}var k=Object.freeze({__proto__:null,build:h});a.ShadowHighlightShader=k;a.build=h})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,u){const f=u.create();return function(){function p(){this._worldPlane=f}a._createClass(p,[{key:"isEnabled",get:function(){return this.plane!==f}},{key:"plane",get:function(){return this._worldPlane},set:function(t){this._worldPlane=t?t:f}}]);return p}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),function(a,u,f,p,t,w,e,n){let b=function(){function h(l,m){this.rctx=l;this._techniqueRep=m;this.resourceLoadingPromise=null;this.isEnabled=!1}var k=h.prototype;k.loadResources=function(l){if(!this.data||!this.textureArea||!this.textureSearch){const m=
this.resourceLoadingPromise||this.loadDataModule().then(()=>this.loadTextures());l&&m.then(l);this.resourceLoadingPromise||(this.resourceLoadingPromise=m,m.then(()=>this.resourceLoadingPromise=null));return!1}return!0};k.loadDataModule=function(){return this.data?Promise.resolve():(new Promise(function(l,m){a(["./SmaaRenderPassData"],l,m)})).then(l=>{this.data=l})};k.loadTextures=function(){return Promise.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,
9728,6409)]).then(([l,m])=>{this.textureArea=l;this.textureSearch=m})};k.enable=function(){if(this.isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeights||!this._blur){const l=new w.SMAATechniqueConfiguration,m=(z,r)=>this._techniqueRep.releaseAndAcquire(w.SMAATechnique,z,r);l.output=0;this._edgeDetectTechnique=m(l,this._edgeDetectTechnique);l.output=1;this._blendWeights=m(l,this._blendWeights);l.output=2;this._blur=m(l,this._blur)}if(!this.loadResources())return!1;this.vao=t.createScreenSizeTriangleVAO(this.rctx);
this.edges=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.blend=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};k.disable=function(){this.isEnabled&&(this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=
null,this.blend.dispose(),this.blend=null,this.edges.dispose(),this.edges=null,this.isEnabled=!1)};k.render=function(l){this.enable();const m=this.rctx,z=m.getBoundFramebufferObject();var r=l.colorTexture.descriptor.width,c=l.colorTexture.descriptor.height;m.bindVAO(this.vao);m.setPipelineState(this._edgeDetectTechnique.pipeline);m.setViewport(0,0,r,c);this.edges.resize(r,c);m.bindFramebuffer(this.edges);m.setClearColor(0,0,0,1);m.clear(16384);m.useProgram(this._edgeDetectTechnique.program);this._edgeDetectTechnique.program.bindTexture(l.colorTexture,
"tColor");this._edgeDetectTechnique.program.setUniform4f("uResolution",1/r,1/c,r,c);m.drawArrays(4,0,3);this.blend.resize(r,c);m.bindFramebuffer(this.blend);m.setClearColor(0,0,1,1);m.clear(16384);m.useProgram(this._blendWeights.program);this._blendWeights.program.setUniform4f("uResolution",1/r,1/c,r,c);this._blendWeights.program.bindTexture(this.textureSearch,"tSearch");this._blendWeights.program.bindTexture(this.textureArea,"tArea");this._blendWeights.program.bindTexture(this.edges.colorTexture,
"tEdges");m.drawArrays(4,0,3);m.bindFramebuffer(z);m.setClearColor(0,1,0,1);m.clear(16384);m.useProgram(this._blur.program);this._blur.program.setUniform4f("uResolution",1/r,1/c,r,c);this._blur.program.bindTexture(l.colorTexture,"tColor");this._blur.program.bindTexture(this.blend.colorTexture,"tBlendWeights");m.drawArrays(4,0,3)};k.loadTextureFromBase64=function(l,m,z){const r=new n(this.rctx,{pixelFormat:z,dataType:5121,wrapMode:33071,samplingMode:m},null);return p.requestImage(l).then(c=>{r.resize(c.width,
c.height);r.setData(c);return r})};f._createClass(h,[{key:"isLoadingResources",get:function(){return null!=this.resourceLoadingPromise}}]);return h}();u.SmaaRenderPass=b;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){w=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){const c=m.shader.get().build({output:this.configuration.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new b.Program(r.rctx,c,n.Default3D)};z.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return m}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(h.SMAAShader,
()=>new Promise(function(l,m){a(["../shaders/SMAA.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.output=0;return z}f._inheritsLoose(m,l);return m}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:3})],t.prototype,"output",void 0);u.SMAATechnique=w;u.SMAATechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/SMAA.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],
function(a,u,f){function p(w){const e=new f.ShaderBuilder;0===w.output&&(e.attributes.add("position","vec2"),e.vertex.uniforms.add("uResolution","vec4"),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[3]","vec4"),e.vertex.code.add(u.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),e.fragment.uniforms.add("tColor","sampler2D"),e.fragment.code.add(u.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${u.glsl.float(w.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${u.glsl.float(w.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));1===w.output&&(e.attributes.add("position","vec2"),e.vertex.uniforms.add("uResolution","vec4"),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[3]","vec4"),e.varyings.add("fPixCoord","vec2"),e.vertex.code.add(u.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * uResolution.zw;
        fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( ${u.glsl.int(w.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),e.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("uResolution","vec4"),e.fragment.code.add(u.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * uResolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${u.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * uResolution.x;
        texcoord.x += uResolution.x;
        texcoord.x += 2.0 * uResolution.x;
        texcoord.x -= uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${u.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * uResolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * uResolution.x;
        texcoord.x -= uResolution.x;
        texcoord.x -= 2.0 * uResolution.x;
        texcoord.x += uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${u.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * uResolution.y;
        texcoord.y -= uResolution.y;
        texcoord.y -= 2.0 * uResolution.y;
        texcoord.y += uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${u.glsl.int(w.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * uResolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * uResolution.y;
        texcoord.y += uResolution.y;
        texcoord.y += 2.0 * uResolution.y;
        texcoord.y -= uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${u.glsl.int(w.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * uResolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * uResolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * uResolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));2===w.output&&(e.attributes.add("position","vec2"),e.vertex.uniforms.add("uResolution","vec4"),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[2]","vec4"),e.vertex.code.add(u.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),e.fragment.uniforms.add("tBlendWeights","sampler2D"),e.fragment.uniforms.add("tColor","sampler2D"),e.fragment.uniforms.add("uResolution","vec4"),e.fragment.code.add(u.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * uResolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return e}var t=Object.freeze({__proto__:null,build:p});a.SMAAShader=t;a.build=p})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../support/requestImageUtils ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,u,
f,p,t,w,e,n,b,h,k,l,m,z){let r=function(){function g(q,y,x){this._techniqueRep=q;this._rctx=y;this._requestRender=x;this._enabled=!1;this._ssaoTechniqueConfig=new h.SSAOTechniqueConfiguration;this.quadVAO=null;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=e.create()}var A=g.prototype;A.dispose=function(){this.quadVAO=f.disposeMaybe(this.quadVAO)};A.computeSSAO=function(q,y,x){if(!(!this.enabled||f.isNone(this._noiseTexture)||f.isNone(this._ssaoFBO)||f.isNone(this._blur0FBO)||
f.isNone(this._blur1FBO))){var D=this._rctx,C=q.fullViewport,B=C[2],v=C[3];C=B/this._BLUR_F;var E=v/this._BLUR_F;this._ssaoFBO.resize(B,v);this._blur0FBO.resize(C,E);this._blur1FBO.resize(C,E);C=1*B;E=1*v;w.copy(this._viewportToRestore,q.fullViewport);D.bindFramebuffer(this._ssaoFBO);D.setViewport(0,0,B,v);var F=this._ssaoTechnique.program;D.useProgram(F);D.setPipelineState(this._ssaoTechnique.pipeline);F.setUniform2f("rnmScale",B/this._noiseTexture.descriptor.width,v/this._noiseTexture.descriptor.height);
F.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);B=this._data.minDiscrepancy;F.setUniform1f("numSpiralTurns",this._samples<B.length?B[this._samples]:5779);B=d;v=c;k.inverseProjectionInfo(q.projectionMatrix,q.fullWidth,q.fullHeight,B,v);F.setUniform4fv("projInfo",B);F.setUniform2fv("zScale",v);F.setUniform2f("nearFar",q.near,q.far);B=1/q.computeRenderPixelSizeAtDist(1);F.setUniform1f("projScale",
1*B);F.setUniform2f("screenDimensions",C,E);v=t.distance(q.eye,q.center);var L=20*q.computeRenderPixelSizeAtDist(v);L=Math.max(.1,L);F.setUniform1f("radius",L);F.setUniform1f("intensity",4*this._attenuation/L**6);F.bindTexture(this._noiseTexture,"rnm");F.bindTexture(x,"normalMap");F.bindTexture(y,"depthMap");f.isNone(this.quadVAO)&&(this.quadVAO=b.createQuadVAO(this._rctx));F=this.quadVAO;D.bindVAO(F);D.drawArrays(5,0,z.vertexCount(F,"geometry"));L=(h.FILTER_RADIUS+1)/2;L=1/(2*L*L);var N=this._blurTechnique.program;
D.useProgram(N);N.bindTexture(this._ssaoFBO.colorTexture,"tex");N.bindTexture(x,"normalMap");N.bindTexture(y,"depthMap");D.setViewport(0,0,C/this._BLUR_F,E/this._BLUR_F);D.bindFramebuffer(this._blur0FBO);N.setUniform2f("screenDimensions",C,E);N.setUniform2f("blurSize",0,1*this._BLUR_F/E);N.setUniform1i("radius",h.FILTER_RADIUS);N.setUniform1f("g_BlurFalloff",L);N.setUniform2f("nearFar",q.near,q.far);5E4<v&&(B=Math.max(0,B-(v-5E4)));N.setUniform1f("projScale",B);N.setUniform2f("zScale",1,0);D.drawArrays(5,
0,z.vertexCount(F,"geometry"));N.setUniform2f("blurSize",1*this._BLUR_F/C,0);D.bindFramebuffer(this._blur1FBO);N.bindTexture(this._blur0FBO.colorTexture,"tex");D.drawArrays(5,0,z.vertexCount(F,"geometry"));D.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};A.bind=function(q){this.enabled&&f.isSome(this._blur1FBO)&&f.isSome(this._ssaoFBO)?(q.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),q.setUniform4f("viewportPixelSz",
this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):q.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};A._selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?0:16>=this._samples?1:32>=this._samples?2:3;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(h.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.releaseAndAcquire(h.SSAOTechnique,
this._ssaoTechniqueConfig,this._blurTechnique)};A._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};A._loadResources=function(q){this._data?q():(new Promise(function(y,x){a(["./SSAOHelperData"],y,x)})).then(y=>{this._data=y;q()})};A._initialize=function(){const q={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},y={colorTarget:0,depthStencilTarget:0};n.requestImage(this._data.noiseTexture).then(x=>
{this._enabled&&(this._ssaoFBO=new l(this._rctx,y,q),this._blur0FBO=new l(this._rctx,y,q),this._blur1FBO=new l(this._rctx,y,q),this._noiseTexture=new m(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:x.width,height:x.height},x),this._requestRender())});this._selectPrograms()};A._disable=function(){this._enabled=!1;this._noiseTexture=f.disposeMaybe(this._noiseTexture);this._blur1FBO=f.disposeMaybe(this._blur1FBO);this._blur0FBO=f.disposeMaybe(this._blur0FBO);this._ssaoFBO=
f.disposeMaybe(this._ssaoFBO)};u._createClass(g,[{key:"enabled",get:function(){return this._enabled},set:function(q){q?this._enable():this._disable()}},{key:"attenuation",get:function(){return this._attenuation},set:function(q){this._attenuation=q}},{key:"radius",get:function(){return this._radius},set:function(q){this._radius=q}},{key:"samples",get:function(){return this._samples},set:function(q){this._samples=q;this._enabled&&this._selectPrograms()}},{key:"ready",get:function(){return this.enabled&&
f.isSome(this._noiseTexture)&&f.isSome(this._ssaoFBO)&&f.isSome(this._blur0FBO)&&f.isSome(this._blur1FBO)}},{key:"gpuMemoryUsage",get:function(){return(f.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(f.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(f.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return g}();const c=p.create(),d=e.create();return r})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){w=function(l){function m(){return l.apply(this,arguments)||this}f._inheritsLoose(m,l);var z=m.prototype;z.initializeProgram=function(r){var c=m.shader.get();const d=this.configuration;c=c.build({output:d.output,samples:3===d.samples?64:2===d.samples?32:1===d.samples?16:8,radius:4});return new b.Program(r.rctx,c,n.Default3D)};z.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return m}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(h.SSAOShader,
()=>new Promise(function(l,m){a(["../shaders/SSAO.glsl"],l,m)}));t=function(l){function m(){var z=l.apply(this,arguments)||this;z.output=0;z.samples=3;return z}f._inheritsLoose(m,l);return m}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:2})],t.prototype,"output",void 0);p.__decorate([e.parameter()],t.prototype,"samples",void 0);u.FILTER_RADIUS=4;u.SSAOTechnique=w;u.SSAOTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w){function e(b){const h=new w.ShaderBuilder;h.include(u.ScreenSpacePass);1===b.output&&(h.fragment.include(f.ReadLinearDepth),h.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),h.fragment.code.add(t.glsl`
      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);

        w_total += w;

        return w*c;
      }

      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);
        for (int r = -${t.glsl.int(b.radius)}; r <= ${t.glsl.int(b.radius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf*blurSize;
          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);
        }

        gl_FragColor = vec4(b/w_total);
      }
    `));0===b.output&&(h.fragment.include(f.ReadLinearDepth),h.include(p.CameraSpace),h.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),h.fragment.code.add(t.glsl`
    uniform vec3 pSphere[${t.glsl.int(b.samples)}];

    float fallOffFunction(float vv, float vn, float bias) {
      float radius2 = radius * radius;
      float f = max(radius2 - vv, 0.0);
      return f * f * f * max(vn-bias, 0.0);
    }
    `),h.fragment.code.add(t.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),h.fragment.code.add(t.glsl`
      void main(void) {
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;

        vec4 occluderFragment;
        vec3 ray;

        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);

        for(int i = 0; i < ${t.glsl.int(b.samples)}; ++i) {
          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it
          //float ssR;
          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);
          // get the depth of the occluder fragment
          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);

          vec2 unitOffset = reflect(pSphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset*radius*ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result

        float A = max(1.0-sum*intensity/float(${t.glsl.int(b.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther
        // (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);
        //gl_FragColor = vec4(-currentPixelDepth/1000.0);
        //gl_FragColor = vec4(tapPixelPos.x/100.0);
        gl_FragColor = vec4(A);
      }
    `));return h}var n=Object.freeze({__proto__:null,build:e});a.SSAOShader=n;a.build=e})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/typedArrayUtil ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ./bufferLayouts ./edgeBufferWriters ./EdgeRenderer ./EdgeWorkerHandle ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../support/WatchUpdatingTracking ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S){function V(ba){let ca=null,da=null;for(let fa=0;fa<ba.geometries.length;fa++){var ha;const R=ba.geometryRecords[fa];if(R.material.supportsEdges){if(!ca)ca=R.transformation;else if(!t.equals(ca,R.transformation))return!1;if(!da&&n.isSome(R.origin))da=R;else if(n.isSome(null==(ha=da)?void 0:ha.origin)&&n.isSome(R.origin)&&da.origin.id!==R.origin.id)return!1}}return!0}const Y=w.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(ba){function ca(ha){var fa=ba.call(this,ha)||this;fa.updatingHandles=new O.WatchUpdatingTracking;fa.perObjectData=new Map;fa.renderers=new Map;fa.numberOfRenderedEdges=0;fa.gpuMemoryUsage=0;fa.workerAbort=b.createAbortController();fa.tmpModelPosition=y.create();fa.tmpCameraPosition=y.create();fa.localOrigins=new F.LocalOriginManager(new v.GridLocalOriginFactory(ha.renderSR));return fa}u._inheritsLoose(ca,ba);var da=ca.prototype;da.initialize=function(){this.worker=new K(this.schedule);
this.componentColorManager=new M.BufferManager(this.rctx,2);const ha=N.VertexLayout.createBuffer(4);for(let fa=0;4>fa;fa++)ha.sideness.set(fa,0,0===fa||3===fa?0:1),ha.sideness.set(fa,1,0===fa||1===fa?0:1);this.verticesBufferObject=Q.createVertex(this.rctx,35044,ha.buffer)};da.destroy=function(){this.destroyed||(this.perObjectData.forEach(ha=>this._discardObjectEntry(ha)),this.perObjectData.clear(),this.strokesTexture=n.disposeMaybe(this.strokesTexture),this.componentColorManager=n.destroyMaybe(this.componentColorManager),
this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=n.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};da.shouldRender=function(){return 0<this.renderers.size};da.addComponentObject=function(){var ha=u._asyncToGenerator(function*(fa,R,U,Z,T,P,X,aa){if(!this.hasObject(fa)){var ja;U=new W(new Promise(ia=>ja=ia),U);this.perObjectData.set(fa,U);yield this.updatingHandles.addPromise(this.addComponentGeometry(R,U,Z,T,P,X,aa));this.setNeedsRender();
ja()}});return function(fa,R,U,Z,T,P,X,aa){return ha.apply(this,arguments)}}();da.addOrUpdateObject3D=function(){var ha=u._asyncToGenerator(function*(fa,R,U,Z){if(this.destroyed)Y.warn("Attempt to add an object to a destroyed instance");else{var T=this.perObjectData.get(fa),P,X=new W(new Promise(ja=>P=ja));this.perObjectData.set(fa,X);var aa=[];if(U.mergeGeometries&&1<fa.geometries.length&&V(fa))aa.push(this.addObjectMergedGeometries(fa,X,R,U,Z));else for(let ja=0;ja<fa.geometries.length;ja++){const ia=
fa.geometryRecords[ja];ia.material.supportsEdges&&aa.push(this.addGeometry(fa,X,fa.geometries[ja],ia,R[0],U,Z))}yield this.updatingHandles.addPromise(Promise.all(aa));this._discardObjectEntry(T);this.setNeedsRender();P()}});return function(fa,R,U,Z){return ha.apply(this,arguments)}}();da._discardObjectEntry=function(ha){ha&&(ha.renderables.length&&(ha.renderables.forEach(fa=>this.removeRenderable(fa)),this.setNeedsRender()),ha.loaded=null)};da.hasObject=function(ha){return this.perObjectData.has(ha)};
da.updateAllComponentOpacities=function(){var ha=u._asyncToGenerator(function*(fa,R){const U=R instanceof Array?Z=>R[Z]:()=>R;(yield this.updatingHandles.addPromise(this.getObjectEntry(fa))).renderables.forEach(Z=>{const T=Z.components.meta.length;for(let P=0;P<T;P++){const X=U(P),aa=Z.components.meta[P],ja=aa.index;aa.material.opacity=X;Z.components.buffer.textureBuffer.setDataElement(ja,1,3,255*X)}this.updateTransparency(Z)});this.setNeedsRender()});return function(fa,R){return ha.apply(this,arguments)}}();
da.updateAllComponentMaterials=function(){var ha=u._asyncToGenerator(function*(fa,R,U,Z){const T=fa instanceof L.Object3D,P=!!U.slicePlaneEnabled,X=J.determineRendererType(R),aa=G.EdgeRenderer.getKey(X,P,T);(yield this.updatingHandles.addPromise(this.getObjectEntry(fa))).renderables.forEach(ja=>{if(aa!==ja.rendererKey){var ia=this.renderers.get(ja.rendererKey);const ka=this.acquireRenderer(X,P,T);ia.removeRenderable(ja);ia.refCount.decrement();ja.rendererKey=aa;ka.addRenderable(ja)}for(ia=0;ia<R.length;ia++)ja.components.meta[ia].material=
R[ia];Z&&this.updateComponentBuffer(ja.components);this.updateTransparency(ja)});this.setNeedsRender()});return function(fa,R,U,Z){return ha.apply(this,arguments)}}();da.updateObjectVisibility=function(){var ha=u._asyncToGenerator(function*(fa,R){(yield this.updatingHandles.addPromise(this.getObjectEntry(fa))).renderables.forEach(U=>U.visible=R);this.setNeedsRender()});return function(fa,R){return ha.apply(this,arguments)}}();da.removeObject=function(ha){const fa=this.perObjectData.get(ha);fa&&(this.perObjectData.delete(ha),
this._discardObjectEntry(fa))};da.getObjectEntry=function(){var ha=u._asyncToGenerator(function*(fa){fa=this.perObjectData.get(fa);if(!fa)throw"no object";yield fa.loaded;return fa});return function(fa){return ha.apply(this,arguments)}}();da.removeAll=function(){this.perObjectData.forEach((ha,fa)=>this.removeObject(fa))};da.render=function(ha,fa){if(!n.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(ha.camera.viewMatrix);var R=ha.camera.viewInverseTransposeMatrix,U=y.create(),
Z=new B.TwoVectorPosition,T=new C.VertexPosition.ViewProjectionTransform,P=d.create();q.set(U,R[3],R[7],R[11]);Z.set(U);q.copy(T.worldFromView_TH,Z.high);q.copy(T.worldFromView_TL,Z.low);c.fromMat4(T.viewFromCameraRelative_RS,ha.camera.viewMatrix);g.copy(T.projFromView,ha.camera.projectionMatrix);R=d.create();c.transpose(R,T.viewFromCameraRelative_RS);c.invert(P,R);var X=0,aa=0;this.renderers.forEach(ia=>{0===ia.refCount.value?(this.renderers.delete(ia.key),ia.dispose()):ia.forEachRenderable(ka=>
{X+=ka.statistics.averageEdgeLength;aa++},fa)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==aa){R=40*X/aa;U=J.estimateLengthAtDistance(ha.camera.fullViewport[3],ha.camera.fovY,1,3.5*ha.camera.pixelRatio);var ja={distanceFalloffFactor:R,minimumEdgeLength:U,transparency:fa,viewProjectionTransform:T,transformNormal_ViewFromGlobal:P};this.updateObjectCameraDistances(ha);this.numberOfRenderedEdges=0;this.renderers.forEach(ia=>{this.renderRegularEdges(ia,
ha,ja);this.renderSilhouetteEdges(ia,ha,ja)})}}};da.updateTransparency=function(ha){const fa=J.determineEdgeTransparency(ha.components.meta),R=J.determineObjectTransparency(ha.components.meta);if(fa!==ha.edgeTransparency||R!==ha.objectTransparency)ha.edgeTransparency=fa,ha.objectTransparency=R,this.renderers.get(ha.rendererKey).setRenderablesDirty()};da.computeModelTransformWithLocalOrigin=function(ha,fa,R){ha.getCombinedStaticTransformation(fa,R);n.isSome(fa.origin)?this.localOrigins.register(fa.origin):
(ha=q.set(this.tmpModelPosition,R[12],R[13],R[14]),fa.origin=this.localOrigins.acquire(ha));E.applyToModelMatrix(fa.origin.vec3,R);return fa.origin};da.updateComponentBuffer=function(ha){const {meta:fa,buffer:R}=ha;for(ha=0;ha<fa.length;ha++){var U=fa[ha].material;const Z=fa[ha].index,T=e.clamp(Math.round(U.size*G.LINE_WIDTH_FRACTION_FACTOR),0,255),P=e.clamp(U.extensionLength,-G.EXTENSION_LENGTH_OFFSET,255-G.EXTENSION_LENGTH_OFFSET)+G.EXTENSION_LENGTH_OFFSET,X="solid"===U.type?0:1,aa=255*U.opacity;
U=U.color;R.textureBuffer.setData(Z,0,255*U[0],255*U[1],255*U[2],255*U[3]);R.textureBuffer.setData(Z,1,T,P,X,aa)}};da.createComponentBuffers=function(ha){if(n.isNone(this.componentColorManager))return null;const fa=[],R=this.componentColorManager.getBuffer(ha.length);for(let U=0;U<ha.length;U++){const Z=ha[U],T=R.acquireIndex();fa.push({index:T,material:Z})}ha={meta:fa,buffer:R};this.updateComponentBuffer(ha);return ha};da.extractEdges=function(ha,fa,R,U,Z,T=Z.length){return this.worker.process({data:fa,
indices:Z,indicesLength:T,writerSettings:ha,skipDeduplicate:R},this.workerAbort.signal,U)};da.createEdgeResources=function(ha){const fa={};if(n.isNone(this.verticesBufferObject))return fa;if(0<ha.regular.lodInfo.lengths.length){var R=new S(this.rctx,N.EdgeShaderAttributeLocations,{vertices:N.glVertexLayout,instances:I.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:Q.createVertex(this.rctx,35044,ha.regular.instancesData.buffer)});fa.regular={vao:R,lod:ha.regular.lodInfo}}0<
ha.silhouette.lodInfo.lengths.length&&(R=new S(this.rctx,N.EdgeShaderAttributeLocations,{vertices:N.glVertexLayout,instances:I.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:Q.createVertex(this.rctx,35044,ha.silhouette.instancesData.buffer)}),fa.silhouette={vao:R,lod:ha.silhouette.lodInfo});return fa};da.addGeometry=function(){var ha=u._asyncToGenerator(function*(fa,R,U,Z,T,P,X){const aa=U.vertexAttributes.get("position"),ja=U.indices.get("position"),ia=A.create();
fa=this.computeModelTransformWithLocalOrigin(fa,Z,ia);return this.addPositionData(R,{position:aa,indices:ja,modelTransform:ia,origin:fa},U.edgeIndicesLength,T,P,X)});return function(fa,R,U,Z,T,P,X){return ha.apply(this,arguments)}}();da.addPositionData=function(){var ha=u._asyncToGenerator(function*(fa,R,U,Z,T,P=!1){if(null!=fa.loaded){var X=this.createComponentBuffers([Z]);if(!(n.isNone(X)||0>=U)){Z=this.acquireRenderer(Z.type,!!T.slicePlaneEnabled);var {modelTransform:aa,origin:ja}=R;T=R.indices;
R=R.position;var ia=R.data.length/R.size,ka=N.EdgeInputBufferLayout.createBuffer(ia);for(let pa=0;pa<ia;pa++)ka.position.set(pa,0,R.data[pa*R.size]),ka.position.set(pa,1,R.data[pa*R.size+1]),ka.position.set(pa,2,R.data[pa*R.size+2]);J.fillComponenBufferIndices(X.meta,[0,ka.componentIndex.count],ka.componentIndex);P=yield this.updatingHandles.addPromise(this.extractEdges(Z.writerSettings,ka,!1,P,T,U));if(null!=fa.loaded){var {regular:na,silhouette:ta}=this.createEdgeResources(P);U=(na?na.vao.size:
0)+(ta?ta.vao.size:0);X={regular:na,silhouette:ta,transform:{modelMatrix:aa,origin:ja},statistics:{gpuMemoryUsage:U,averageEdgeLength:P.averageEdgeLength},components:X,visible:!0,edgeTransparency:J.determineEdgeTransparency(X.meta),objectTransparency:J.determineObjectTransparency(X.meta),distanceToCamera:0,rendererKey:Z.key};fa.renderables.push(X);Z.addRenderable(X);this.gpuMemoryUsage+=U}}}});return function(fa,R,U,Z,T){return ha.apply(this,arguments)}}();da.addComponentGeometry=function(){var ha=
u._asyncToGenerator(function*(fa,R,U,Z,T,P,X){if(null!=R.loaded){var aa=this.createComponentBuffers(P);if(!n.isNone(aa)&&(P=J.determineRendererType(P),X=this.acquireRenderer(P,X.slicePlaneEnabled||!1,!1),P=N.EdgeInputBufferLayout.createBuffer(U.count),D.copy(P.position,U),J.fillComponenBufferIndices(aa.meta,T,P.componentIndex,Z),Z=yield this.updatingHandles.addPromise(this.extractEdges(X.writerSettings,P,!0,!1,Z)),null!=R.loaded)){var {regular:ja,silhouette:ia}=this.createEdgeResources(Z);U=(ja?ja.vao.size:
0)+(ia?ia.vao.size:0);fa={regular:ja,silhouette:ia,transform:fa,statistics:{gpuMemoryUsage:U,averageEdgeLength:Z.averageEdgeLength},components:aa,visible:!0,edgeTransparency:J.determineEdgeTransparency(aa.meta),objectTransparency:J.determineObjectTransparency(aa.meta),distanceToCamera:0,rendererKey:X.key};R.renderables.push(fa);X.addRenderable(fa);this.gpuMemoryUsage+=U}}});return function(fa,R,U,Z,T,P,X){return ha.apply(this,arguments)}}();da.addObjectMergedGeometries=function(){var ha=u._asyncToGenerator(function*(fa,
R,U,Z,T){var P=new Map,X=0,aa=null,ja=null;for(var ia=0;ia<fa.geometries.length;ia++){var ka=fa.geometries[ia],na=fa.geometryRecords[ia];na.material.supportsEdges&&(!ja&&na.origin&&(ja=na),na=ka.indices.get("position"),X+=ka.edgeIndicesLength,null==aa||aa===Uint16Array)&&(aa=h.isUint16Array(na)?Uint16Array:Uint32Array)}X=X?new aa(X):null;aa=[];ia=0;for(ka=0;ka<fa.geometries.length;ka++){na=fa.geometries[ka];if(!fa.geometryRecords[ka].material.supportsEdges)continue;var ta=na.vertexAttributes.get("position");
const pa=na.indices.get("position");let xa=P.get(ta.data);if(null==xa){xa=aa.length/3;for(let Da=0;Da<ta.data.length;Da+=ta.size)aa.push(ta.data[Da+0]),aa.push(ta.data[Da+1]),aa.push(ta.data[Da+2]);P.set(ta.data,xa)}if(pa)for(ta=0;ta<na.edgeIndicesLength;ta++)X[ia++]=xa+pa[ta]}ja=ja||fa.geometryRecords[0];P=A.create();ja=this.computeModelTransformWithLocalOrigin(fa,ja,P);for(ia=0;ia<fa.geometryRecords.length;ia++)fa.geometryRecords[ia].origin=ja;yield this.updatingHandles.addPromise(this.addPositionData(R,
{position:{data:aa,size:3},indices:X,modelTransform:P,origin:ja},X.length,U[0],Z,T))});return function(fa,R,U,Z,T){return ha.apply(this,arguments)}}();da.acquireRenderer=function(ha,fa,R=!0){const U=G.EdgeRenderer.getKey(ha,fa,R);let Z=this.renderers.get(U);n.isNone(this.strokesTexture)&&(this.strokesTexture=H.generateStrokesTexture(this.rctx));Z||(Z=new G.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ha,slicePlaneEnabled:fa,strokesTexture:this.strokesTexture,legacy:R}),this.renderers.set(U,
Z));Z.refCount.increment();return Z};da.removeRenderable=function(ha){ha.regular&&(ha.regular.vao.vertexBuffers.instances.dispose(),ha.regular.vao.dispose(!1),ha.regular.vao=null);ha.silhouette&&(ha.silhouette.vao.vertexBuffers.instances.dispose(),ha.silhouette.vao.dispose(!1),ha.silhouette.vao=null);const fa=this.renderers.get(ha.rendererKey);if(fa){fa.removeRenderable(ha);fa.refCount.decrement();"origin"in ha.transform&&this.localOrigins.release(ha.transform.origin);this.gpuMemoryUsage-=ha.statistics.gpuMemoryUsage;
for(const R of ha.components.meta)ha.components.buffer.releaseIndex(R.index)}};da.updateObjectCameraDistances=function(ha){ha=ha.camera.viewInverseTransposeMatrix;q.set(this.tmpCameraPosition,ha[3],ha[7],ha[11]);this.perObjectData.forEach((fa,R)=>{R=n.isSome(fa.center)?fa.center:x.getCenter(R.boundingVolumeWorldSpace.bounds);const U=q.distance(R,this.tmpCameraPosition);fa.renderables.forEach(Z=>Z.distanceToCamera=U)})};da.renderRegularEdges=function(ha,fa,R){ha.bindRegularEdges(fa,R);ha.forEachRenderable(U=>
{if(U.visible&&U.regular){var Z=J.computeEdgeCount(U.regular.lod.lengths,U.distanceToCamera,R);"origin"in U.transform&&(fa.localViewMatrixForEdges=this.localOrigins.getViewMatrix(U.transform.origin));ha.renderRegularEdges(U,fa,Z);this.numberOfRenderedEdges+=Z}},R.transparency)};da.renderSilhouetteEdges=function(ha,fa,R){ha.bindSilhouetteEdges(fa,R);ha.forEachRenderable(U=>{if(U.visible&&U.silhouette){var Z=J.computeEdgeCount(U.silhouette.lod.lengths,U.distanceToCamera,R);"origin"in U.transform&&(fa.localViewMatrixForEdges=
this.localOrigins.getViewMatrix(U.transform.origin));ha.renderSilhouetteEdges(U,fa,Z);this.numberOfRenderedEdges+=Z}},R.transparency)};u._createClass(ca,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges}}]);return ca}(p);f.__decorate([k.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);f.__decorate([k.property({constructOnly:!0})],
a.EdgeView.prototype,"renderSR",void 0);f.__decorate([k.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);f.__decorate([k.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);f.__decorate([k.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);f.__decorate([k.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);f.__decorate([k.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=f.__decorate([r.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let W=function(ba,ca=null){this.center=ca;this.renderables=[];this.loaded=ba;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(u,f){const p=-u[0],t=-u[1];u=-u[2];const w=f[3],e=f[7],n=f[11],b=f[15];f[0]+=w*p;f[1]+=w*t;f[2]+=w*u;f[4]+=e*p;f[5]+=e*t;f[6]+=e*u;f[8]+=n*p;f[9]+=n*t;f[10]+=n*u;f[12]+=b*p;f[13]+=
b*t;f[14]+=b*u};a.applyToViewMatrix=function(u,f){const p=u[0],t=u[1];u=u[2];f[12]+=p*f[0]+t*f[4]+u*f[8];f[13]+=p*f[1]+t*f[5]+u*f[9];f[14]+=p*f[2]+t*f[6]+u*f[10];f[14]+=p*f[3]+t*f[7]+u*f[11]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,u,f,p){let t=function(){function w(n){this.factory=n;this.originData=new Map}var e=w.prototype;
e.acquire=function(n){return this.register(this.factory.getOrigin(n))};e.register=function(n){const b=this.originData.get(n.id);if(b)return b.refCount++,b.origin;this.originData.set(n.id,{refCount:1,viewMatrix:f.create(),origin:n});return n};e.release=function(n){const b=this.originData.get(n.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(n.id))};e.updateViewMatrices=function(n){this.originData.forEach(b=>{u.copy(b.viewMatrix,n);p.applyToViewMatrix(b.origin.vec3,b.viewMatrix)})};e.getViewMatrix=
function(n){return this.originData.get(n.id).viewMatrix};return w}();a.LocalOriginManager=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(a,u,f){const p=f.newLayout().vec3f("position").u16("componentIndex").u16("u16padding"),t=f.newLayout().vec2u8("sideness");u=u.glLayout(t);f=f.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",
{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0});const w=f.clone().vec3f("normal"),e=f.clone().vec3f("normalA").vec3f("normalB"),n=new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]]);a.CommonInstancesLayout=f;a.EdgeInputBufferLayout=p;a.EdgeShaderAttributeLocations=n;a.RegularEdgeInstancesLayout=
w;a.SilhouetteEdgeInstancesLayout=e;a.VertexLayout=t;a.glVertexLayout=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,u,f,p,t,w){function e(g){const A=k;A[0]=g.position0[0];A[1]=g.position0[1];A[2]=g.position0[2];A[3]=g.position1[0];A[4]=g.position1[1];
A[5]=g.position1[2];m[0]=5381;for(g=0;g<l.length;g++)m[0]=31*m[0]+l[g];return m[0]}function n(g){const A=k;A[0]=b(g.position0[0]);A[1]=b(g.position0[1]);A[2]=b(g.position0[2]);A[3]=b(g.position1[0]);A[4]=b(g.position1[1]);A[5]=b(g.position1[2]);m[0]=5381;for(g=0;g<l.length;g++)m[0]=31*m[0]+l[g];return m[0]}function b(g){return Math.round(1E4*g)/1E4}let h=function(){function g(){}var A=g.prototype;A.updateSettings=function(q){this.settings=q;this.edgeHashFunction=q.reducedPrecision?n:e};A.write=function(q,
y,x){var D=this.edgeHashFunction(x);d.seed=D;D=d.getIntRange(0,255);const C=d.getIntRange(0,this.settings.variants-1);var B=d.getFloat();B=-(1-Math.min(B/.7,1))+Math.max(0,B-.7)/(1-.7);B=255*(Math.abs(B)**1.2*(0>B?-1:1)*.5+.5);q.position0.setVec(y,x.position0);q.position1.setVec(y,x.position1);q.componentIndex.set(y,x.componentIndex);q.variantOffset.set(y,D);q.variantStroke.set(y,C);q.variantExtension.set(y,B)};A.trim=function(q,y){return q.slice(0,y)};return g}();const k=new Float32Array(6),l=new Uint32Array(k.buffer),
m=new Uint32Array(1);let z=function(){function g(){this.commonWriter=new h}var A=g.prototype;A.updateSettings=function(q){this.commonWriter.updateSettings(q)};A.allocate=function(q){return w.RegularEdgeInstancesLayout.createBuffer(q)};A.write=function(q,y,x){this.commonWriter.write(q,y,x);f.add(c,x.faceNormal0,x.faceNormal1);f.normalize(c,c);q.normal.setVec(y,c)};A.trim=function(q,y){return this.commonWriter.trim(q,y)};return g}();z.Layout=w.RegularEdgeInstancesLayout;z.glLayout=t.glLayout(w.RegularEdgeInstancesLayout,
1);let r=function(){function g(){this.commonWriter=new h}var A=g.prototype;A.updateSettings=function(q){this.commonWriter.updateSettings(q)};A.allocate=function(q){return w.SilhouetteEdgeInstancesLayout.createBuffer(q)};A.write=function(q,y,x){this.commonWriter.write(q,y,x);q.normalA.setVec(y,x.faceNormal0);q.normalB.setVec(y,x.faceNormal1)};A.trim=function(q,y){return this.commonWriter.trim(q,y)};return g}();r.Layout=w.SilhouetteEdgeInstancesLayout;r.glLayout=t.glLayout(w.SilhouetteEdgeInstancesLayout,
1);const c=p.create(),d=new u;a.CommonBufferWriter=h;a.RegularEdgeBufferWriter=z;a.SilhouetteEdgeBufferWriter=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/debugFlags ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let A=function(){function C(){this._value=0}var B=C.prototype;B.increment=function(){this._value++};B.decrement=function(){this._value--};u._createClass(C,[{key:"value",get:function(){return this._value}}]);return C}();const q={solid:0,sketch:1,uber:2};let y=function(){function C(v,E,F){this.rctx=v;this.shaderTechniqueRepository=E;this.config=new d.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new A;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new t,[2]:new t},[2]:{[1]:new t,[2]:new t}};this.renderablesDirty=!1;this.settings={...g,...F};this.key=C.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES};this.config.legacy=this.settings.legacy;this.config.mode=q[this.settings.type];this.config.silhouette=
!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=r.doublePrecisionRequiresObfuscation(v)}var B=C.prototype;B.dispose=function(){this.technique=p.releaseMaybe(this.technique)};B.addRenderable=function(v){this.renderables.add(v);this.renderablesDirty=!0};B.removeRenderable=function(v){this.renderables.delete(v);this.renderablesDirty=!0};B.setRenderablesDirty=function(){this.renderablesDirty=
!0};B.forEachRenderable=function(v,E){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[E][1].forAll(v);this.sortedRenderables[E][2].forAll(v)};B.setMultipassParameters=function(v){this.config.multipassTerrainEnabled=v.multipassTerrainEnabled?v.multipassTerrainEnabled:!1;this.config.cullAboveGround=v.cullAboveGround?v.cullAboveGround:!1};B.bindRegularEdges=function(v,E){this.setMultipassParameters(v);this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(d.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass({bindParameters:v,edgeRenderParameters:E});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.useProgram(this.technique.program)};B.bindSilhouetteEdges=function(v,E){this.setMultipassParameters(v);this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(d.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass({bindParameters:v,edgeRenderParameters:E});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.useProgram(this.technique.program)};B.renderRegularEdges=function(v,E,F){this.render(v,v.regular.vao,E,F)};B.renderSilhouetteEdges=function(v,E,F){this.render(v,v.silhouette.vao,E,F)};B.render=function(v,E,F,L){this.setUniforms(v,F);this.rctx.bindVAO(E);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,L)};B.setUniforms=function(v,E){const F=this.technique.program;v.components.buffer.textureBuffer.bind(F,"uComponentDataTex","uComponentDataTexInvDim");E.multipassTerrainEnabled&&
(F.setUniform2fv("cameraNearFar",E.camera.nearFar),F.setUniform2fv("inverseViewport",E.inverseViewport),z.bindMultipassTerrainTexture(F,E));if("origin"in v.transform)F.setUniformMatrix4fv("uView",E.localViewMatrixForEdges),F.setUniformMatrix4fv("uModel",v.transform.modelMatrix),l.bindSliceUniforms(F,this.settings,E.slicePlane,v.transform.origin.vec3);else{const L=new c.TwoVectorPosition(v.transform.position),N=w.transpose(x,w.invert(x,v.transform.rotationScale)),I=new k.ComponentDrawParameters;n.copy(I.worldFromModel_TL,
L.low);n.copy(I.worldFromModel_TH,L.high);w.copy(I.worldFromModel_RS,v.transform.rotationScale);w.copy(I.transformNormal_GlobalFromModel,N);m.VertexPosition.bindModelTransform(F,I);F.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",I.transformNormal_GlobalFromModel);v=E.camera.viewInverseTransposeMatrix;v=n.set(D,v[3],v[7],v[11]);l.bindSliceUniforms(F,this.settings,E.slicePlane,v)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(F);F.setUniform1f("uWorldLineRadiusPerDistance",
Math.tan(E.camera.fovY/2)/(E.camera.fullViewport[3]/2))};B.setSketchUniforms=function(v){const E=this.settings.strokesTexture,F=E.texture;p.isNone(F)||(v.bindTexture(F,"uStrokesTexture"),v.setUniform2f("uStrokesTextureScale",1/F.descriptor.width,1/F.descriptor.height),v.setUniform1f("uStrokesLog2Resolution",f.log2(E.resolution)),v.setUniform1f("uStrokesNormalizationScale",E.normalizationScale),v.setUniform1f("uStrokesAmplitude",E.amplitude),v.setUniform1f("uStrokeVariants",E.variants))};B.sortRenderables=
function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(E=>{0!==E.objectTransparency&&0!==E.edgeTransparency&&this.sortedRenderables[E.objectTransparency][E.edgeTransparency].push(E)});const v=(E,F)=>"origin"in E.transform&&"origin"in F.transform?E.transform.origin.id<F.transform.origin.id?-1:E.transform.origin.id>F.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(v);
this.sortedRenderables[1][2].sort(v);this.sortedRenderables[2][1].sort(v);this.sortedRenderables[2][2].sort(v)};C.getKey=function(v,E,F){return`edges-t:${v}:${E}:${F}`};return C}();const x=e.create(),D=b.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=y;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="uComponentDataTexInvDim";a.componentDataTexName="uComponentDataTex";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../Program ./bufferLayouts ../../../../../chunks/EdgeShaderProgram.glsl ../../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){u.EdgeShaderTechnique=function(m){function z(){return m.apply(this,arguments)||this}f._inheritsLoose(z,m);var r=z.prototype;r.bindPass=function(c){const d=this.program,{edgeRenderParameters:g,bindParameters:A}=c;t.VertexPosition.bindViewProjTransform(d,g.viewProjectionTransform);d.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",g.transformNormal_ViewFromGlobal);d.setUniformMatrix4fv("uProj",A.camera.projectionMatrix);d.setUniform2f("uDepthBias",.5,-4E-4);d.setUniform2f("uPixelToNDC",
2/A.camera.fullViewport[2],2/A.camera.fullViewport[3]);d.setUniform2f("uNDCToPixel",A.camera.fullViewport[2]/2,A.camera.fullViewport[3]/2);d.setUniform1f("uDistanceFalloffFactor",g.distanceFalloffFactor);d.setUniform2f("uViewportDimInv",1/A.camera.fullViewport[2],1/A.camera.fullViewport[3]);d.setUniform1f("uPixelRatio",A.camera.pixelRatio||1)};r.initializeProgram=function(c){var d=z.shader.get();const g=this.configuration;d=d.build({slicePlaneEnabled:g.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!1,silhouette:g.silhouette,legacy:g.legacy,antialiasing:g.antialiasing,mode:g.mode,doublePrecisionRequiresObfuscation:g.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:g.multipassTerrainEnabled,cullAboveGround:g.cullAboveGround});return new b.Program(c.rctx,d,h.EdgeShaderAttributeLocations)};r.initializePipeline=function(c){return(c=c.rctx.capabilities.blendMinMax)?l.makePipelineState({blending:l.separateBlendingParams(1,1,0,1,32774,c.MAX),depthTest:{func:515},
colorWrite:l.defaultColorWriteParams}):l.makePipelineState({depthTest:{func:515},depthWrite:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams})};return z}(e.ShaderTechnique);u.EdgeShaderTechnique.shader=new w.ReloadableShaderModule(k.EdgeShaderProgram,()=>new Promise(function(m,z){a(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],m,z)}));(function(m){let z=function(r){function c(){var d=r.apply(this,arguments)||this;d.slicePlaneEnabled=!1;d.silhouette=!1;d.legacy=!1;d.antialiasing=
!1;d.mode=0;d.doublePrecisionRequiresObfuscation=!1;d.multipassTerrainEnabled=!1;d.cullAboveGround=!1;return d}f._inheritsLoose(c,r);return c}(n.ShaderTechniqueConfiguration);p.__decorate([n.parameter()],z.prototype,"slicePlaneEnabled",void 0);p.__decorate([n.parameter()],z.prototype,"silhouette",void 0);p.__decorate([n.parameter()],z.prototype,"legacy",void 0);p.__decorate([n.parameter()],z.prototype,"antialiasing",void 0);p.__decorate([n.parameter({count:3})],z.prototype,"mode",void 0);p.__decorate([n.parameter()],
z.prototype,"doublePrecisionRequiresObfuscation",void 0);p.__decorate([n.parameter()],z.prototype,"multipassTerrainEnabled",void 0);p.__decorate([n.parameter()],z.prototype,"cullAboveGround",void 0);m.Configuration=z})(u.EdgeShaderTechnique||(u.EdgeShaderTechnique={}));Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(d){const g=new w.ShaderBuilder,A=g.vertex,q=g.fragment;d.legacy&&A.uniforms.add("uModel","mat4");d.antialiasing&&(A.code.add(t.glsl`#define ANTIALIASING 1`),q.code.add(t.glsl`#define ANTIALIASING 1`));g.include(e.AdjustProjectedPosition,d);g.include(l.LineAmplitude,d);g.include(k.EdgeUtil,d);g.include(z.UnpackAttributes,d);g.include(m.LineOffset,d);g.include(u.Slice,d);g.include(b.DiscardNonSilhouetteEdges,d);g.include(n.DiscardByCoverage,d);g.include(h.DiscardShortEdges,
d);g.varyings.add("vColor","vec4");g.varyings.add("vRadius","float");g.varyings.add("vPosition","vec3");g.varyings.add("vWorldPosition","vec3");g.varyings.add("vViewPos","vec3");g.varyings.add("vLineLengthPixels","float");g.varyings.add("vSizeFalloffFactor","float");A.uniforms.add("uPixelToNDC","vec2");A.uniforms.add("uNDCToPixel","vec2");A.uniforms.add("uPixelRatio","float");g.attributes.add("position0","vec3");g.attributes.add("position1","vec3");g.attributes.add("variantOffset","float");g.attributes.add("variantStroke",
"float");g.attributes.add("variantExtension","float");A.code.add(t.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);d.multipassTerrainEnabled&&(g.fragment.include(f.ReadLinearDepth),g.include(p.multipassTerrainTest,d));g.fragment.code.add(t.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${d.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return g}var c=Object.freeze({__proto__:null,build:r});a.EdgeShaderProgram=c;a.build=r})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderLibrary/attributes/VertexPosition.glsl","../../../core/shaderLibrary/util/IsNaN.glsl","../../../core/shaderModules/interfaces"],function(a,u,f,p){a.AdjustProjectedPosition=function(t,w){t.vertex.include(f.IsNaN);t.include(u.VertexPosition,w);t=t.vertex;t.uniforms.add("uDepthBias",
"vec2");t.uniforms.add("uViewportDimInv","vec2");w.legacy?(t.uniforms.add("uView","mat4"),t.uniforms.add("uProj","mat4")):t.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");w.legacy?t.code.add(p.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`):t.code.add(p.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = uDepthBias.x;
float offsetZ  = uDepthBias.y;
vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
}`);t.code.add(p.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = uDepthBias.y;
return sqrt(projPos.z) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,u){a.IsNaN=function(f){const p=u.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;f.code.add(p)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,u){a.DiscardByCoverage=function(f,p){f=f.fragment;f.constants.add("coverageTestThreshold","float",.01);p.antialiasing?f.code.add(u.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):f.code.add(u.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,u){a.DiscardNonSilhouetteEdges=function(f,p){f=f.vertex;p.silhouette?(f.code.add(u.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),p.legacy?f.code.add(u.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):f.code.add(u.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):f.code.add(u.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,u){a.DiscardShortEdges=function(f,p){f=f.vertex;switch(p.mode){case 1:f.code.add(u.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case 2:f.code.add(u.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case 0:f.code.add(u.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(a,u,f){function p(t,w){const e=t.vertex;e.uniforms.add("uDistanceFalloffFactor","float");e.code.add(f.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
}`);e.uniforms.add("uComponentDataTex","sampler2D");e.uniforms.add("uComponentDataTexInvDim","vec2");t.attributes.add("componentIndex","float");e.constants.add("componentColorFieldOffset","float",0);e.constants.add("componentOtherFieldOffset","float",1);e.constants.add("componentFieldCount","float",2);e.constants.add("lineWidthFractionFactor","float",8);e.constants.add("extensionLengthOffset","float",128);e.constants.add("componentTexWidth","float",4096);e.code.add(f.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * uComponentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
vec4 otherValue = texture2D(uComponentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`);w.legacy?e.code.add(f.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (uModel * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (uView * uModel * vec4(normal, 0.0)).xyz;
}`):(e.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),e.code.add(f.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return uTransformNormal_GlobalFromModel * normal;
}`));w.silhouette?(t.attributes.add("normalA","vec3"),t.attributes.add("normalB","vec3"),e.code.add(f.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add("normal","vec3"),e.code.add(f.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));w.legacy?e.code.add(f.glsl`vec3 worldFromModelPosition(vec3 position) {
return (uModel * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return uProj * vec4(position, 1.0);
}`):(t.vertex.include(u.DoublePrecision,w),e.code.add(f.glsl`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return uTransform_ProjFromView * vec4(position, 1.0);
}`));e.code.add(f.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}(function(t){t.usesSketchLogic=function(w){return 1===w.mode||2===w.mode};t.usesSolidLogic=function(w){return 0===w.mode||2===w.mode}})(p||(p={}));a.EdgeUtil=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,u,f,p){a.LineAmplitude=function(t,w){const e=t.vertex;t.include(p.UnpackAttributes,
w);f.EdgeUtil.usesSketchLogic(w)&&e.uniforms.add("uStrokesAmplitude","float");switch(w.mode){case 0:e.code.add(u.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case 1:e.code.add(u.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return uStrokesAmplitude;
}`);break;case 2:e.code.add(u.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return uStrokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,u,f){a.UnpackAttributes=function(p,t){const w=p.vertex;p.include(f.EdgeUtil,t);p.attributes.add("sideness","vec2");2===t.mode?w.code.add(u.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):w.code.add(u.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(t.mode){case 2:w.code.add(u.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case 1:w.code.add(u.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case 0:w.code.add(u.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,u,f,p,t){a.LineOffset=function(w,e){const n=w.vertex;w.include(t.UnpackAttributes,e);const b=w.fragment;p.EdgeUtil.usesSketchLogic(e)&&(n.uniforms.add("uStrokesTextureScale","vec2"),n.uniforms.add("uStrokesLog2Resolution",
"float"),n.uniforms.add("uStrokeVariants","float"),w.varyings.add("vStrokeUV","vec2"),b.uniforms.add("uStrokesTexture","sampler2D"),b.uniforms.add("uStrokesNormalizationScale","float"),n.code.add(f.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
vStrokeUV.x += variantOffset;
}`),w.fragment.include(u.RgbaFloatEncoding),b.code.add(f.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * uStrokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(e.mode){case 0:n.code.add(f.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);b.code.add(f.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case 1:n.code.add(f.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);b.code.add(f.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case 2:w.varyings.add("vType","float"),n.code.add(f.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),b.code.add(f.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,u,f,p,t){return function(w){function e(b){return w.call(this,"EdgeProcessingWorker","wrappedWork",b)||this}a._inheritsLoose(e,w);var n=e.prototype;n.process=
function(){var b=a._asyncToGenerator(function*(h,k,l){if(l)return t.work(h);h=this._packInput(h);k=yield this.invoke(h,k);return this._unpackOutput(k)});return function(h,k,l){return b.apply(this,arguments)}}();n.getTransferList=function(b){return[b.dataBuffer]};n._packInput=function(b){return{dataBuffer:b.data.buffer,writerSettings:b.writerSettings,skipDeduplicate:b.skipDeduplicate,indicesBuffer:b.indices.buffer,indicesType:u.isUint32Array(b.indices)?"Uint32Array":"Uint16Array",indicesLength:b.indicesLength}};
n._unpackOutput=function(b){return{regular:{instancesData:p.unpackInterleavedBuffer(b.regular.instancesData),lodInfo:{lengths:new Float32Array(b.regular.lodInfo.lengths)}},silhouette:{instancesData:p.unpackInterleavedBuffer(b.silhouette.instancesData),lodInfo:{lengths:new Float32Array(b.silhouette.lodInfo.lengths)}},averageEdgeLength:b.averageEdgeLength}};return e}(f.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"./InterleavedLayout"],function(a,u,f){function p(e){const n=[];e.fields.forEach((b,h)=>{var k=b.constructor;n.push([h,{...b,constructor:`${k.ElementType}_${k.ElementCount}`}])});return{stride:e.stride,fields:n,fieldNames:e.fieldNames}}function t(e){const n=f.newLayout();n.stride=e.stride;n.fieldNames=e.fieldNames;e.fields.forEach(b=>n.fields.set(b[0],{...b[1],constructor:w.get(b[1].constructor)}));return n}u=[u.BufferViewFloat,u.BufferViewVec2f,u.BufferViewVec3f,u.BufferViewVec4f,u.BufferViewMat3f,
u.BufferViewMat4f,u.BufferViewFloat64,u.BufferViewVec2f64,u.BufferViewVec3f64,u.BufferViewVec4f64,u.BufferViewMat3f64,u.BufferViewMat4f64,u.BufferViewUint8,u.BufferViewVec2u8,u.BufferViewVec3u8,u.BufferViewVec4u8,u.BufferViewUint16,u.BufferViewVec2u16,u.BufferViewVec3u16,u.BufferViewVec4u16,u.BufferViewUint32,u.BufferViewVec2u32,u.BufferViewVec3u32,u.BufferViewVec4u32,u.BufferViewInt8,u.BufferViewVec2i8,u.BufferViewVec3i8,u.BufferViewVec4i8,u.BufferViewInt16,u.BufferViewVec2i16,u.BufferViewVec3i16,
u.BufferViewVec4i16,u.BufferViewInt32,u.BufferViewVec2i32,u.BufferViewVec3i32,u.BufferViewVec4i32];const w=new Map;u.forEach(e=>w.set(`${e.ElementType}_${e.ElementCount}`,e));a.packInterleavedBuffer=function(e,n){n.push(e.buffer);return{buffer:e.buffer,layout:p(e.layout)}};a.packLayout=p;a.unpackInterleavedBuffer=function(e){return t(e.layout).createView(e.buffer)};a.unpackLayout=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,u,f,p,t,w,e,n){function b(){b=u._asyncToGenerator(function*(m){var z={data:w.EdgeInputBufferLayout.createView(m.dataBuffer),indices:"Uint32Array"===m.indicesType?new Uint32Array(m.indicesBuffer):"Uint16Array"===m.indicesType?new Uint16Array(m.indicesBuffer):void 0,indicesLength:m.indicesLength,writerSettings:m.writerSettings,skipDeduplicate:m.skipDeduplicate};m=h(z);z=[z.data.buffer];z.push(m.regular.lodInfo.lengths.buffer);z.push(m.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:t.packInterleavedBuffer(m.regular.instancesData,
z),lodInfo:{lengths:m.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:t.packInterleavedBuffer(m.silhouette.instancesData,z),lodInfo:{lengths:m.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:m.averageEdgeLength},transferList:z}});return b.apply(this,arguments)}function h(m){var z=m.data,r=m.indices;var c=m.indicesLength;if(m.skipDeduplicate){const d=p.computeNeighbors(r,c,z.count);c={faces:r,facesLength:c,neighbors:d,vertices:z}}else z=f.deduplicate(z.buffer,z.stride/4,{originalIndices:r,
originalIndicesLength:c}),c=p.computeNeighbors(z.indices,c,z.uniqueCount),c={faces:z.indices,facesLength:z.indices.length,neighbors:c,vertices:w.EdgeInputBufferLayout.createView(z.buffer)};k.updateSettings(m.writerSettings);l.updateSettings(m.writerSettings);return n.extractEdges(c,k,l)}const k=new e.RegularEdgeBufferWriter,l=new e.SilhouetteEdgeBufferWriter;a.work=h;a.wrappedWork=function(m){return b.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],
function(a){a.computeNeighbors=function(u,f,p){f/=3;const t=new Uint32Array(p+1),w=new Uint32Array(p+1);var e=(c,d)=>{c<d?t[c+1]++:w[d+1]++};for(var n=0;n<f;n++){var b=u[3*n],h=u[3*n+1],k=u[3*n+2];e(b,h);e(h,k);e(k,b)}n=e=0;for(b=0;b<p;b++)h=t[b+1],k=w[b+1],t[b+1]=e,w[b+1]=n,e+=h,n+=k;const l=new Uint32Array(6*f),m=t[p];e=(c,d,g)=>{c<d?(c=t[c+1]++,l[2*c]=d,l[2*c+1]=g):(d=w[d+1]++,l[2*m+2*d]=c,l[2*m+2*d+1]=g)};for(n=0;n<f;n++)b=u[3*n],h=u[3*n+1],k=u[3*n+2],e(b,h,n),e(h,k,n),e(k,b,n);e=(c,d)=>{const g=
2*c;c=d-c;for(d=1;d<c;d++){const A=l[g+2*d],q=l[g+2*d+1];let y=d-1;for(y;0<=y&&l[g+2*y]>A;y--)l[g+2*y+2]=l[g+2*y],l[g+2*y+3]=l[g+2*y+1];l[g+2*y+2]=A;l[g+2*y+3]=q}};for(n=0;n<p;n++)e(t[n],t[n+1]),e(m+w[n],m+w[n+1]);const z=new Int32Array(3*f),r=(c,d)=>c===u[3*d]?0:c===u[3*d+1]?1:c===u[3*d+2]?2:-1;f=(c,d)=>{c=r(c,d);z[3*d+c]=-1};e=(c,d,g,A)=>{c=r(c,d);z[3*d+c]=A;g=r(g,A);z[3*A+g]=d};for(n=0;n<p;n++){b=t[n];h=t[n+1];k=w[n];const c=w[n+1];for(;b<h&&k<c;){const d=l[2*b],g=l[2*m+2*k];d===g?(e(n,l[2*b+1],
g,l[2*m+2*k+1]),b++,k++):d<g?(f(n,l[2*b+1]),b++):(f(g,l[2*m+2*k+1]),k++)}for(;b<h;)f(n,l[2*b+1]),b++;for(;k<c;)f(l[2*m+2*k],l[2*m+2*k+1]),k++}return z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,u,f,p,t,w){function e(m,z){const r=
f.acosClamped(m.cosAngle),c=h.fwd,d=h.ortho;t.direction(c,m.position1,m.position0);m=0<t.dot(t.cross(d,m.faceNormal0,m.faceNormal1),c)?-1:1;return r*m>z}function n(m){const z=m.faces.length/3,r=m.faces;m=m.neighbors;var c=0;for(var d=0;d<z;d++){var g=m[3*d+1],A=m[3*d+2],q=r[3*d],y=r[3*d+1],x=r[3*d+2];c+=-1===m[3*d]||q<y?1:0;c+=-1===g||y<x?1:0;c+=-1===A||x<q?1:0}c=new Int32Array(4*c);d=0;for(g=0;g<z;g++){A=m[3*g];q=m[3*g+1];y=m[3*g+2];x=r[3*g];const D=r[3*g+1],C=r[3*g+2];if(-1===A||x<D)c[d++]=x,c[d++]=
D,c[d++]=g,c[d++]=A;if(-1===q||D<C)c[d++]=D,c[d++]=C,c[d++]=g,c[d++]=q;if(-1===y||C<x)c[d++]=C,c[d++]=x,c[d++]=g,c[d++]=y}return c}function b(m){const z=m.faces.length/3,r=m.vertices.position;m=m.faces;const c=k.v0,d=k.v1,g=k.v2,A=new Float32Array(3*z);for(let q=0;q<z;q++){const y=m[3*q+1],x=m[3*q+2];r.getVec(m[3*q],c);r.getVec(y,d);r.getVec(x,g);t.subtract(d,d,c);t.subtract(g,g,c);t.cross(c,d,g);t.normalize(c,c);A[3*q]=c[0];A[3*q+1]=c[1];A[3*q+2]=c[2]}return A}const h={edge:{position0:w.create(),
position1:w.create(),faceNormal0:w.create(),faceNormal1:w.create(),componentIndex:0,cosAngle:0},ortho:w.create(),fwd:w.create()},k={v0:w.create(),v1:w.create(),v2:w.create()},l={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(m,z,r,c=l){const d=m.vertices.position;var g=m.vertices.componentIndex,A=f.deg2rad(c.anglePlanar);c=f.deg2rad(c.angleSignificantEdge);const q=Math.cos(c),y=Math.cos(A),x=h.edge,D=x.position0,C=x.position1,B=x.faceNormal0,v=x.faceNormal1,E=b(m),F=n(m),L=F.length/
4;m=z.allocate(L);c=0;const N=r.allocate(L);let I=0,G=0,K=0;const H=u.range(0,L),J=new Float32Array(L);p.forEach(J,(S,V,Y)=>{d.getVec(F[4*V],D);d.getVec(F[4*V+1],C);Y[V]=t.distance(D,C)});H.sort((S,V)=>J[V]-J[S]);const M=[],O=[];for(let S=0;S<L;S++){var Q=H[S];const V=J[Q],Y=F[4*Q],W=F[4*Q+1],ba=F[4*Q+2];Q=F[4*Q+3];const ca=-1===Q;d.getVec(Y,D);d.getVec(W,C);if(ca)t.set(B,E[3*ba],E[3*ba+1],E[3*ba+2]),t.copy(v,B),x.componentIndex=g.get(Y),x.cosAngle=t.dot(B,v);else{t.set(B,E[3*ba],E[3*ba+1],E[3*ba+
2]);t.set(v,E[3*Q],E[3*Q+1],E[3*Q+2]);x.componentIndex=g.get(Y);x.cosAngle=t.dot(B,v);if(x.cosAngle>y)continue;-.9999>x.cosAngle&&t.copy(v,B)}G+=V;K++;ca||x.cosAngle<q?(z.write(m,c++,x),M.push(V)):e(x,A)&&(r.write(N,I++,x),O.push(V))}g=new Float32Array(M.reverse());A=new Float32Array(O.reverse());return{regular:{instancesData:z.trim(m,c),lodInfo:{lengths:g}},silhouette:{instancesData:r.trim(N,I),lodInfo:{lengths:A}},averageEdgeLength:G/K}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports",
"../../../../../core/mathUtils","../../../../../core/maybe","../Util","../../../../webgl/Texture"],function(a,u,f,p,t){function w(b,h){if(!b)return null;var k=b.length/2;const l=.1*k;k=Array(k);let m=0;h=1===h;for(let z=0;z<b.length;z+=2){const r=(b[z]+b[z+1])/2;h?k[m++]=Math.min(l,1-.5*(1-r)):k[m++]=Math.min(l,.5*r)}return k}let e=function(){function b(h,k,l,m,z){this.resolution=h;this.normalizationScale=k;this.amplitude=l;this.variants=m;this.texture=z}b.prototype.dispose=function(){this.texture=
f.disposeMaybe(this.texture)};return b}();const n={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,
-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,
.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,
-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,
-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,
.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,
.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,
.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,
-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,
1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,
.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,
-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,
.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,
.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,
.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,
.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,
3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,
4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,
1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,
.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,
.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,
.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,
.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,
2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,
-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,
.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,
2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,
.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,
.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,
.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,
-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,
.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,
.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,
-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,
.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,
.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,
.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,
.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,
6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,
1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,
-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,
2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,
.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,
.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,
.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=e;a.generateStrokesTexture=
function(b){const h=n.resolution;var k=h/2;const l=new Uint8Array(4*h*h),m=4*h*k;k=n.amplitude;const z=2*k,r=4*h,c=u.log2(h)+1,d=n.strokes.length;let g=(c-1)*d*r;for(const {distance:A,pressure:q}of n.strokes){let y=A,x=q,D=g;for(let C=0;C<c;C++){0!==C&&(y=w(y,0),x=w(x,1));for(let B=0;B<n.resolution;B++){const v=x?x[B%x.length]:1;p.packFloatRGBA((y?y[B%y.length]/z:0)+.5,l,D);p.packFloatRGBA(v,l,D+m);D+=4}D-=r*(d+1)}g+=r}b=new t(b,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:h,
height:h,wrapMode:10497},l);return new e(h,z,k,d,b)};a.rasterizeStrokes=function(){var b=n.resolution;const h=u.log2(b)+1;var k=n.strokes.length;const l=n.amplitude,m=Math.ceil(2*l+.5);var z;for(z=0;1<=b;)z+=b,b/=2;z+=6*(h+1);k*=m;b=new Uint8ClampedArray(4*z*k);const r=4*z;b.fill(255);let c=24;for(const {distance:d,pressure:g}of n.strokes){let A=d,q=g,y=c;for(let x=0;x<h;x++){0!==x&&(A=w(A,0),q=w(q,1));for(let D=0;D<A.length;D++){const C=A?A[D]:0,B=q?u.clamp(q[D],0,1):1;let v=y;for(let E=-l;E<m-l;E++){const F=
255-255*u.clamp(1-(Math.abs(E-C+.5)-.5*B),0,1);b[v+0]=F;b[v+1]=F;b[v+2]=F;b[v+3]=255;v+=r}y+=4}y+=24}c+=m*r}return new ImageData(b,z,k)};a.strokesDefinition=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe"],function(a,u,f){function p(t){return 0<t.size*t.color[3]*t.opacity}a.computeEdgeCount=function(t,w,e){const n=t.length;w*=e.minimumEdgeLength;e=u.binaryIndexOf(t,
w,!0);t=-1===e?w<t[0]?0:t.length:e;return n-t};a.determineEdgeTransparency=function(t){let w=0;for(const {material:e}of t)if(p(e)){if(1>e.color[3]*e.opacity)return 1;w=2}return w};a.determineObjectTransparency=function(t){let w=0;for(const {material:e}of t)if(p(e)){switch(e.objectTransparency){case 1:case 0:return 1;case 2:if(1>e.opacity)return 1}w=2}return w};a.determineRendererType=function(t){let w=null;for(const e of t)if(t=e.type,p(e))if(f.isNone(w))w=t;else if(w!==t)return"uber";return f.isSome(w)?
w:"solid"};a.estimateLengthAtDistance=function(t,w,e,n){return n/t*e*2*Math.tan(.5*w)};a.fillComponenBufferIndices=function(t,w,e,n){for(let h=0;h<t.length;h++){const k=t[h].index;var b=w[h];const l=w[h+1];if(n)for(;b<l;b++)e.set(n[b],k);else for(;b<l;b++)e.set(b,k)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ./TextureTechnique ./Util ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(a,u,f,p,t,w,e,n,b,h){const k=p.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");p=function(){function m(r,c,d){this._stage=r;this._rctx=d;this._idToRefCountedTexture=new Map;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);this.events=new f;this._textureTechnique=c.acquire(e.TextureTechnique,new e.TextureTechniqueConfiguration);for(c=0;c<this._fallbackTextureData.length;++c)this._fallbackTextureData[c]=
255,this._fallbackTextureTransparentData[c]=0!==(c+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this._rctx.parameters.maxMaxAnisotropy};this._frameTask=r.resourceController.scheduler.registerTask(b.TaskPriority.TEXTURE_UNLOAD)}var z=m.prototype;z.dispose=function(){this._frameTask.remove();t.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);t.isSome(this._fallbackTextureTransparent)&&
(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._stage.forEachOfType(4,r=>r.unload())};z.acquire=function(r,c=!1,d){r=this._getOrCreateRef(r,c,d);r.ref();return r};z.update=function(){let r=!1;this._frameUpdates.forEach(c=>{const d=c.texture.frameUpdate(this._rctx,this._textureTechnique,c.previousToken);0<=d&&d!==c.previousToken&&(c.previousToken=d,r=!0)});r&&this.events.emit("changed",0)};z._getOrCreateRef=function(r,c,d){const g=this._idToRefCountedTexture.get(r);
return g?g:this._createNewRef(r,c,d)};z._createNewRef=function(r,c,d){const g=this._stage.getObject(r);n.assert(void 0!==g);const A=g.events.on("unloaded",()=>{A.remove();this._onTextureUnloaded(r)}),q=new l;this._idToRefCountedTexture.set(r,q);const y=g.load(this._rctx,this._textureTechnique);this._loadingCount++;const x=C=>{this._loadingCount--;this._updateGLTexture(q,C);d&&d(q);g.requiresFrameUpdates&&this._frameUpdates.set(r,{texture:g,previousToken:-1});return q},D=C=>{this._loadingCount--;w.isAbortError(C)||
k.error(C)};w.isPromiseLike(y)?(this._updateGLTexture(q,c?this.fallbackTextureTransparent:this.fallbackTexture),y.then(x,D)):x(y);return q};z._updateGLTexture=function(r,c){r.glTexture=c;this.events.emit("changed",1)};z.release=function(r){const c=this._idToRefCountedTexture.get(r);if(c&&(c.unref(),c.isUnreferenced)){const d=this._stage.getObject(r);this._frameTask.schedule(()=>{c.isUnreferenced&&d.unload()})}};z.getTexture=function(r){return this._stage.getObject(r)};z._onTextureUnloaded=function(r){this._idToRefCountedTexture.delete(r);
this._frameUpdates.delete(r)};u._createClass(m,[{key:"updating",get:function(){return 0<this.loadingCount||this._frameTask.updating}},{key:"loadingCount",get:function(){return this._loadingCount}},{key:"fallbackTexture",get:function(){t.isNone(this._fallbackTexture)&&(this._fallbackTexture=new h(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture}},{key:"fallbackTextureTransparent",get:function(){t.isNone(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent=
new h(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent}}]);return m}();let l=function(){function m(){this._refCount=0;this.glTexture=null}var z=m.prototype;z.ref=function(){++this._refCount};z.unref=function(){0===this._refCount?k.error("Cannot dereference texture that has no references!"):--this._refCount};u._createClass(m,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return m}();a.RefCountedTexture=l;a.TextureRepository=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../../webgl/Texture".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){const z=w.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(r){function c(){var g=r.apply(this,arguments)||this;g._data=[];g.loadingState=0;return g}u._inheritsLoose(c,r);var d=c.prototype;d.dispose=function(){this.loadingState=0;this._data.forEach(g=>g.dispose());this._data.length=0};d.loadTextures=function(g){const A=[p.getAssetUrl("esri/images/materials/water/normals.jpg"),p.getAssetUrl("esri/images/materials/water/perturbation.jpg")];
this.loadingState=1;Promise.all(A.map(q=>l.requestImage(q))).then(q=>{q.forEach(y=>this._data.push(new m(g,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:!0,maxAnisotropy:8,width:y.width,height:y.height},y)));this.loadingState=2}).catch(q=>{z.error("Failed to load textures for water material.",q);this.loadingState=0})};d.bind=function(g){2<=this._data.length&&(g.bindTexture(this._data[0],"texWaveNormal"),g.bindTexture(this._data[1],"texWavePerturbation"))};
u._createClass(c,[{key:"updating",get:function(){return 1===this.loadingState}},{key:"ready",get:function(){return 2===this.loadingState}}]);return c}(t);f.__decorate([e.property()],a.WaterTextureRepository.prototype,"loadingState",void 0);f.__decorate([e.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=f.__decorate([k.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),function(a,u,f,p,t,w,e,n){w=function(b){function h(l,m,z,r=null,c,d=!0){var g=b.call(this)||this;g._rctx=l;g._renderScene=m;g._requestRenderScene=z;g._renderOverlay=r;g.forceCameraHook=
c;g.supersample=d;g._screenshotQueue=[];return g}u._inheritsLoose(h,b);var k=h.prototype;k.dispose=function(){this._rctx=null};k.takeScreenshot=function(l){this._requestRenderScene();const m=p.createResolver();this._screenshotQueue.push({settings:l,resolver:m});return m.promise};k.update=function(l){if(0!==this._screenshotQueue.length){for(const z of this._screenshotQueue){if(this.isDisposed){z.resolver.reject();continue}var m={...z.settings,pixelRatio:z.settings.pixelRatio*l.viewCamera.pixelRatio};
const r=this._ensureScreenshotEncodeCanvas(),c=this._renderScreenshot(l,m);m=e.encodeResult(c,m,r,{flipY:!0,premultipliedAlpha:!0});z.resolver(m)}this._screenshotQueue=[]}};k._renderScreenshotOverlay=function(l,m,z){if(f.isNone(this._renderOverlay))return m;l.width=m.width;l.height=m.height;const r=l.getContext("2d"),c=z.pixelRatio;r.save();r.translate(0,m.height);r.scale(1,-1);z.region&&r.translate(-z.region.x,-z.region.y);r.scale(c,c);m=this._renderOverlay(l,m);r.restore();return m};k._readbackScreenshot=
function(l){return l.resample?this._readbackScreenshotResampled(l):this._readbackScreenshotImmediate(l)};k._readbackScreenshotResampled=function(l){const {framebufferWidth:m,framebufferHeight:z,region:r,resample:c}=l,d=this._ensureScreenshotEncodeCanvas();let g=e.createEmptyImageData(m,z,d);this._rctx.gl.readPixels(0,0,m,z,6408,5121,new Uint8Array(g.data.buffer));g=this._renderScreenshotOverlay(d,g,{...l,region:null});l=e.createEmptyImageData(r.width,r.height,d);return e.resampleHermite(g,l,!0,c.region.x,
z-(c.region.y+c.region.height),c.region.width,c.region.height)};k._readbackScreenshotImmediate=function(l){const {framebufferHeight:m,region:z}=l,r=this._ensureScreenshotEncodeCanvas(),c=e.createEmptyImageData(z.width,z.height,r);this._rctx.gl.readPixels(z.x,m-(z.y+z.height),z.width,z.height,6408,5121,new Uint8Array(c.data.buffer));return this._renderScreenshotOverlay(r,c,l)};k._renderScreenshot=function(l,m){var z=null;const r=l.viewCamera,{framebufferWidth:c,framebufferHeight:d}=m;var g=!1;l=m.disableDecorations&&
l.frameHasDecorations;var A=m.ignorePadding&&r.pixelRatio!==m.pixelRatio;if(l=c!==r.fullWidth||d!==r.fullHeight||l||A){A=r.clone();if(m.ignorePadding){z=t.clone(A.padding);for(g=0;4>g;g++)z[g]=Math.round(z[g]/A.pixelRatio*m.pixelRatio);A.padding=z}A.fullWidth=c;A.fullHeight=d;A.pixelRatio=m.pixelRatio;z=r.fovX-A.fovX;g=r.fovY-A.fovY;0>z&&z<g?A.fovX=r.fovX:0>g&&g<z&&(A.fovY=r.fovY);this.forceCameraHook(A);g=!0;z=new n(this._rctx,{width:A.fullWidth,height:A.fullHeight,colorTarget:0,depthStencilTarget:3});
this._renderScene(z,A,m.disableDecorations)}m=this._readbackScreenshot(m);if(l&&!this._rctx.contextAttributes.alpha)for(l=3;l<m.data.length;l+=4)m.data[l]=255;z&&z.dispose();this._rctx.bindFramebuffer(null);g&&this.forceCameraHook(r);return m};k._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return h}(w.AutoDisposable);a.ScreenshotManager=w;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/webgl/context-util":function(){define(["exports"],function(a){function u(p,t={},w){switch(w){case "webgl":w=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":w=["webgl2"];break;default:w=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}let e=null;for(const n of w){try{e=p.getContext(n,t)}catch(b){}if(e)break}return e}function f(p,t){(p=p.parentNode)&&(p.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
t+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.createContext=u;a.createContextOrErrorHTML=function(p,t={},w){if(!window.WebGLRenderingContext)return f(p,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),null;t=u(p,t,w);return t?t:(f(p,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),
null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define(["exports","../../../../core/maybe"],function(a,u){function f(w,e){if(u.isNone(w))return null;const n=t(w,e);return u.isNone(n)?null:n===e.graphics?u.isSome(e.graphicsView)?u.unwrap(e.graphicsView.getGraphicFromGraphicUid(w.graphicUid)):null:(e=e.allLayerViews.find(b=>b.layer===n))?p(e,w):null}function p(w,e){return!w||w.suspended?null:"getGraphicFromIntersectorMetadata"in
w&&e?w.getGraphicFromIntersectorMetadata(e):"getGraphicFromGraphicUid"in w&&null!=e.graphicUid?w.getGraphicFromGraphicUid(e.graphicUid):null}function t(w,e){return u.isNone(w)||null==w.layerUid?null:u.isSome(e.graphicsView)&&w.layerUid===e.graphicsView.graphics3d.layer.id?e.graphics:e.map.findLayerByUid(w.layerUid)}a.toGraphic=function(w,e){if(!w.target)return null;switch(w.target.type){case "stage":return f(w.target.obj.metadata,e);case "external":switch(w.intersector){case "PointRenderer":return w.target.metadata.createGraphic();
case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return f(w.target.metadata,e)}}return null};a.toOwner=function(w,e){if(!w.target)return null;switch(w.target.type){case "stage":return t(w.target.obj.metadata,e);case "external":switch(w.intersector){case "PointRenderer":return w=w.target.metadata.layerUid,e=null!=w?e.map.findLayerByUid(w):null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return t(w.target.metadata,e);case "TerrainRenderer":return e.map&&e.map.ground}}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,u){function f(){f=u._asyncToGenerator(function*(p,t){if("2d"===p.type)return p.hitTest(t);p=yield p.hitTest(t);const w=p.results[0];t=p.results.findIndex(e=>e.distance!==w.distance);-1!==t&&(p.results=p.results.slice(0,t));return p});return f.apply(this,arguments)}a.hitTestSelectSameDistance=function(p,t){return f.apply(this,
arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities"],function(a,u,f){const p={checkMajorWebPerformanceCaveat:!0};a.check=function(t){t={...p,...t};const w=f();return w.available?t.checkMajorWebPerformanceCaveat&&w.majorPerformanceCaveat?new u("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):
w.supportsHighPrecisionFragment?w.supportsVertexShaderSamplers?w.supportsElementIndexUint?w.supportsStandardDerivatives?w.supportsInstancedArrays?null:new u("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new u("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new u("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new u("webgl:vertex-shader-samplers-required",
"WebGL support for vertex shader samplers is required but not supported."):new u("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new u("webgl:required","WebGL is required but not supported.")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["./context-util"],function(a){function u(){const p={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,
supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,supportsTextureFloat:!1,supportsColorBufferFloat:!1};var t=document.createElement("canvas");if(!t)return p;var w=a.createContext(t,{failIfMajorPerformanceCaveat:!0},"webgl");!w&&(w=a.createContext(t,{},"webgl"))&&(p.majorPerformanceCaveat=!0);if(!w)return p;t=w.getParameter(w.VERSION);if(!t)return p;if(t=t.match(/^WebGL\s+([\d.]*)/)){t=parseFloat(t[1]);p.available=.94<=t;if(t=w.getShaderPrecisionFormat(w.FRAGMENT_SHADER,
w.HIGH_FLOAT))p.supportsHighPrecisionFragment=0<t.precision;p.supportsVertexShaderSamplers=0<w.getParameter(w.MAX_VERTEX_TEXTURE_IMAGE_UNITS);p.supportsElementIndexUint=null!==w.getExtension("OES_element_index_uint");p.supportsStandardDerivatives=null!==w.getExtension("OES_standard_derivatives");p.supportsInstancedArrays=null!==w.getExtension("ANGLE_instanced_arrays");p.supportsTextureFloat=null!==w.getExtension("OES_texture_float");p.supportsColorBufferFloat=null!==w.getExtension("WEBGL_color_buffer_float")&&
null!==w.getExtension("EXT_float_blend")}p.maxTextureSize=w.getParameter(w.MAX_TEXTURE_SIZE);w=(w=document.createElement("canvas"))&&a.createContext(w,{},"webgl2")?!0:!1;p.version=w?2:1;return p}let f;return function(){f||(f=u());return f}})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,u,f,p,t,w,e,n,b){p=function(h){function k(l){l=h.call(this,l)||this;l.components=["attribution","zoom","navigation-toggle","compass"];return l}a._inheritsLoose(k,h);return k}(b);u.__decorate([f.property()],p.prototype,"components",void 0);return p=u.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],p)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){p.getLogger("esri.views.ui.DefaultUI");f=function(c){function d(A){A=c.call(this,A)||this;A._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};A.components=[];return A}a._inheritsLoose(d,c);var g=d.prototype;g.initialize=function(){this._handles.add([t.init(this,"components",this._componentsWatcher.bind(this)),t.init(this,"view",this._updateViewAwareWidgets.bind(this))])};g._add=function(A,
q,y,x){if("string"===typeof A&&this._defaultPositionLookup[A]){if(this._find(A))return;A=this._createComponent(A)}c.prototype._add.call(this,A,q,y,x)};g._removeComponents=function(A){A.forEach(q=>{if(q=this._find(q))this.remove(q),q.destroy()})};g._updateViewAwareWidgets=function(A){this.components.forEach(q=>{(q=(q=this._find(q))&&q.widget)&&void 0!==q.view&&(q.view=A)})};g._componentsWatcher=function(A,q){this._removeComponents(q);this._addComponents(A);this._adjustPadding(A)};g._adjustPadding=
function(A){-1!==A.indexOf("attribution")||this._isOverridden("padding")||({top:A}=this.padding,this.padding=A)};g._addComponents=function(A){this.initialized&&A.forEach(q=>this.add(this._createComponent(q),this._defaultPositionLookup[q]))};g._createComponent=function(A){const q=this._createWidget(A);if(q)return new h({id:A,node:q})};g._createWidget=function(A){if("attribution"===A)return this._createAttribution();if("compass"===A)return this._createCompass();if("navigation-toggle"===A)return this._createNavigationToggle();
if("zoom"===A)return this._createZoom()};g._createAttribution=function(){return new l({view:this.view})};g._createCompass=function(){return new m({view:this.view})};g._createNavigationToggle=function(){return new z({view:this.view})};g._createZoom=function(){return new r({view:this.view})};return d}(k);u.__decorate([w.property()],f.prototype,"components",void 0);return f=u.__decorate([b.subclass("esri.views.ui.DefaultUI")],f)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h){f=function(k){function l(){var z=k.apply(this,arguments)||this;z.widget=null;return z}a._inheritsLoose(l,k);var m=l.prototype;m.destroy=function(){this.widget&&this.widget.destroy();this.node=null};m.castNode=function(z){if(!z)return this._set("widget",null),null;if("string"===typeof z||z&&"nodeType"in z)return this._set("widget",null),p.byId(z);z&&"function"===typeof z.render&&!z.domNode&&(z.domNode=document.createElement("div"));this._set("widget",z);return z.domNode};
a._createClass(l,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(z){const r=this._get("node");z!==r&&(z&&z.classList.add("esri-component"),r&&r.classList.remove("esri-component"),this._set("node",z))}}]);return l}(f);u.__decorate([t.property({dependsOn:[]})],f.prototype,"id",null);u.__decorate([t.property()],f.prototype,"node",null);u.__decorate([e.cast("node")],f.prototype,"castNode",null);u.__decorate([t.property({readOnly:!0})],f.prototype,
"widget",void 0);return f=u.__decorate([h.subclass("esri.views.ui.Component")],f)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./Component ../../widgets/support/widgetUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(A){return"object"!==typeof A||A instanceof m||"declaredClass"in A||!("component"in A||"index"in A||"position"in A)?null:A}function c(A,{top:q,bottom:y,left:x,right:D}){A.style.top=q;A.style.bottom=y;A.style.left=x;A.style.right=D}const d={left:0,top:0,bottom:0,right:0},g={bottom:30,top:15,right:15,left:15};p=function(A){function q(x){x=A.call(this,x)||this;x._cornerNameToContainerLookup={};x._positionNameToContainerLookup={};x._components=[];x._componentToKey=
new Map;x._handles=new t;x.view=null;x._initContainers();return x}a._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this._handles.add([w.init(this,"view.padding, container",this._applyViewPadding.bind(this)),w.init(this,"padding",this._applyUIPadding.bind(this))])};y.destroy=function(){this.container=null;for(const x of this._components)x.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};y.castPadding=function(x){return"number"===typeof x?{bottom:x,
top:x,right:x,left:x}:{...g,...x}};y.add=function(x,D){let C,B;if(Array.isArray(x))x.forEach(E=>this.add(E,D));else{var v=r(x);v&&({index:C,position:D,component:x,key:B}=v);D&&"object"===typeof D&&({index:C,key:B,position:D}=D);!x||D&&!this._isValidPosition(D)||this._add(x,D,C,B)}};y.remove=function(x,D){if(x){if(Array.isArray(x))return x.map(v=>this.remove(v,D));var C=this._find(x);if(C){var B=this._componentToKey;if(!B.has(x)||B.get(x)===D)return B=this._components.indexOf(C),C.node.parentNode&&
C.node.parentNode.removeChild(C.node),this._componentToKey.delete(x),this._components.splice(B,1)[0]}}};y.empty=function(x){if(Array.isArray(x))return x.map(D=>this.empty(D)).reduce((D,C)=>D.concat(C));x=x||"manual";return"manual"===x?Array.prototype.slice.call(this._manualContainer.children).filter(D=>!D.classList.contains("esri-ui-corner")).map(D=>this.remove(D)):this._isValidPosition(x)?Array.prototype.slice.call(this._cornerNameToContainerLookup[x].children).map(this.remove,this):null};y.move=
function(x,D){Array.isArray(x)&&x.forEach(v=>this.move(v,D));if(x){var C=r(x)||r(D);if(C){var B=C.index;D=C.position;x=C.component||x}(!D||this._isValidPosition(D))&&(x=this.remove(x))&&this.add(x,{position:D,index:B})}};y.find=function(x){return x?(x=this._findById(x))&&(x.widget||x.node):null};y.getPosition=function(x){for(const D in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[D].contains(x))return D;return null};y._add=function(x,D,C,B){x instanceof m||(x=new m({node:x}));
this._place({component:x,position:D,index:C});this._components.push(x);B&&this._componentToKey.set(x,B)};y._find=function(x){return x?x instanceof m?this._findByComponent(x):"string"===typeof x?this._findById(x):this._findByNode(x.domNode||x):null};y._getViewPadding=function(){return this.get("view.padding")||d};y._attachContainers=function(x){x.appendChild(this._innerContainer);x.appendChild(this._manualContainer)};y._initContainers=function(){var x=document.createElement("div");x.classList.add("esri-ui-inner-container");
x.classList.add("esri-ui-corner-container");const D=document.createElement("div");D.classList.add("esri-ui-inner-container");D.classList.add("esri-ui-manual-container");const C=document.createElement("div");C.classList.add("esri-ui-top-left");C.classList.add("esri-ui-corner");x.appendChild(C);const B=document.createElement("div");B.classList.add("esri-ui-top-right");B.classList.add("esri-ui-corner");x.appendChild(B);const v=document.createElement("div");v.classList.add("esri-ui-bottom-left");v.classList.add("esri-ui-corner");
x.appendChild(v);const E=document.createElement("div");E.classList.add("esri-ui-bottom-right");E.classList.add("esri-ui-corner");x.appendChild(E);this._innerContainer=x;this._manualContainer=D;x=z.isRTL();this._cornerNameToContainerLookup={"top-left":C,"top-right":B,"bottom-left":v,"bottom-right":E,"top-leading":x?B:C,"top-trailing":x?C:B,"bottom-leading":x?E:v,"bottom-trailing":x?v:E};this._positionNameToContainerLookup={manual:D,...this._cornerNameToContainerLookup}};y._isValidPosition=function(x){return!!this._positionNameToContainerLookup[x]};
y._place=function(x){const D=x.component,C=x.index;x=this._positionNameToContainerLookup[x.position||"manual"];var B=-1<C,v=D.widget;v&&!v._started&&"function"===typeof v.postMixInProperties&&"function"===typeof v.buildRendering&&"function"===typeof v.postCreate&&"function"===typeof v.startup&&D.widget.startup();B?(B=Array.prototype.slice.call(x.children),0===C?x.firstChild?f.insertBefore(D.node,x.firstChild):x.appendChild(D.node):C>=B.length?x.appendChild(D.node):f.insertBefore(D.node,B[C])):x.appendChild(D.node)};
y._applyViewPadding=function(){const x=this.container;x&&c(x,this._toPxPosition(this._getViewPadding()))};y._applyUIPadding=function(){const x=this._innerContainer;x&&c(x,this._toPxPosition(this.padding))};y._toPxPosition=function(x){return{top:this._toPxUnit(x.top),left:this._toPxUnit(x.left),right:this._toPxUnit(x.right),bottom:this._toPxUnit(x.bottom)}};y._toPxUnit=function(x){return 0===x?"0":x+"px"};y._findByComponent=function(x){let D=null,C;this._components.some(B=>{(C=B===x)&&(D=B);return C});
return D};y._findById=function(x){let D=null,C;this._components.some(B=>{(C=B.id===x)&&(D=B);return C});return D};y._findByNode=function(x){let D=null,C;this._components.some(B=>{(C=B.node===x)&&(D=B);return C});return D};a._createClass(q,[{key:"container",set:function(x){const D=this._get("container");x!==D&&(x&&(x.classList.add("esri-ui"),x.classList.add(z.getCalciteThemeClass()),this._attachContainers(x)),D&&(D.classList.remove("esri-ui"),c(D,{top:"",bottom:"",left:"",right:""}),f.empty(D)),this._set("container",
x))}},{key:"height",get:function(){const x=this.get("view.height")||0;if(0===x)return x;const D=this._getViewPadding();return Math.max(x-(D.top+D.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(x){x?this._override("padding",x):this._clearOverride("padding")}},{key:"width",get:function(){const x=this.get("view.width")||0;if(0===x)return x;const D=this._getViewPadding();return Math.max(x-(D.left+D.right),0)}}]);return q}(p.EventedAccessor);u.__decorate([e.property()],
p.prototype,"container",null);u.__decorate([e.property()],p.prototype,"height",null);u.__decorate([e.property({value:g})],p.prototype,"padding",null);u.__decorate([b.cast("padding")],p.prototype,"castPadding",null);u.__decorate([e.property()],p.prototype,"view",void 0);u.__decorate([e.property()],p.prototype,"width",null);return p=u.__decorate([l.subclass("esri.views.ui.UI")],p)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){t=function(d){function g(q,y){q=d.call(this,q,y)||this;q._isOpen=!1;q._attributionTextOverflowed=!1;q._prevSourceNodeHeight=0;q.iconClass="esri-icon-description";q.itemDelimiter=" | ";q.label=void 0;q.messages=null;q.view=null;q.viewModel=new l;return q}a._inheritsLoose(g,d);var A=g.prototype;A.initialize=function(){this.own(f.on(this,"viewModel.items","change",()=>this.scheduleRender()))};A.render=function(){return r.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};A.renderPoweredBy=function(){return r.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",r.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};A.renderSourcesNode=function(){const q=this._isOpen,y=this._isInteractive(),x=y?0:-1,{attributionText:D}=
this,C=y?"button":void 0;return r.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:q,["esri-interactive"]:y}),innerHTML:D,role:C,tabIndex:x})};A._afterSourcesNodeCreate=function(q){this._prevSourceNodeHeight=q.clientWidth};A._afterSourcesNodeUpdate=function(q){let y=!1;const {clientHeight:x,clientWidth:D,scrollWidth:C}=q;q=C>=D;const B=this._attributionTextOverflowed!==
q;this._attributionTextOverflowed=q;B&&(y=!0);this._isOpen&&(q=x<this._prevSourceNodeHeight,this._prevSourceNodeHeight=x,q&&(this._isOpen=!1,y=!0));y&&this.scheduleRender()};A._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};A._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a._createClass(g,[{key:"attributionText",get:function(){return this.viewModel.items.reduce((q,y)=>{-1===q.indexOf(y.text)&&q.push(y.text);return q},[]).join(this.itemDelimiter)}}]);
return g}(k);u.__decorate([b.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],t.prototype,"attributionText",null);u.__decorate([b.property()],t.prototype,"iconClass",void 0);u.__decorate([b.property()],t.prototype,"itemDelimiter",void 0);u.__decorate([b.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0);u.__decorate([b.property(),z.messageBundle("esri/widgets/Attribution/t9n/Attribution")],t.prototype,"messages",void 0);u.__decorate([p.aliasOf("viewModel.view")],
t.prototype,"view",void 0);u.__decorate([b.property({type:l})],t.prototype,"viewModel",void 0);u.__decorate([m.accessibleHandler()],t.prototype,"_toggleState",null);return t=u.__decorate([h.subclass("esri.widgets.Attribution")],t)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){function d(y,x){return y&&"copyright"in y&&(!x||"function"===typeof y.originOf&&"user"===y.originOf("copyright"))}function g(y,x){return y.length!==x.length||y.some((D,C)=>D.text!==x[C].text)}function A(y,x,D){D&&x&&(y.find(C=>C.layerView===x&&C.text===D)||y.push({text:D,layerView:x}))}const q=[];f=function(y){function x(C){var B=y.call(this,C)||this;B.clear=()=>{B._fetchedAttributionData.clear();B._pendingAttributions.clear();B.handles.remove("suspension");
B.notifyChange("state")};B._pendingAttributions=new Set;B._fetchedAttributionData=new Map;B.items=new t;B.view=null;B._allLayerViewsChange=v=>{B.handles.remove("suspension");const E=B.get("view.allLayerViews");E&&B.handles.add(E.map(F=>F.watch(["suspended","attributionVisible"],B._updateAttributionItems)),"suspension");v&&v.removed&&v.removed.forEach(F=>{B._pendingAttributions.delete(F);B._fetchedAttributionData.delete(F)});B._updateAttributionItems()};B._updateAttributionItems=()=>{const v=B.get("view.allLayerViews");
q.length=0;v?(v.forEach(E=>{if(!E.suspended&&E.get("layer.attributionVisible")){var F=E.layer;if(d(F,"user"))A(q,E,F.copyright);else if(F.hasAttributionData)if(B._fetchedAttributionData.has(E)){var L=B._fetchedAttributionData.get(E);L?A(q,E,B._getDynamicAttribution(L,B.view,F)):d(F)&&A(q,E,F.copyright)}else B._fetchAttributionData(E);else(L=F.get("portalItem.accessInformation"))?A(q,E,L):A(q,E,F.copyright)}}),g(B.items,q)&&(B.items.removeAll(),B.items.addMany(q)),q.length=0,B.notifyChange("state")):
B.clear()};B.handles.add([e.on(a._assertThisInitialized(B),"view.allLayerViews","change",B._allLayerViewsChange,B._allLayerViewsChange,B.clear),e.whenTrue(a._assertThisInitialized(B),"view.stationary",()=>B._updateAttributionItems())]);return B}a._inheritsLoose(x,y);var D=x.prototype;D.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};D._fetchAttributionData=function(){var C=a._asyncToGenerator(function*(B){if(!this._pendingAttributions.has(B)){this._pendingAttributions.add(B);
var v=yield p.result(B.layer.fetchAttributionData());this._pendingAttributions.has(B)&&(v=v.ok?this._createContributionIndex(v.value,"bing-maps"===B.layer.type):null,this._pendingAttributions.delete(B),this._fetchedAttributionData.set(B,v));this._updateAttributionItems()}});return function(B){return C.apply(this,arguments)}}();D._createContributionIndex=function(C,B){C=C.contributors;const v={};if(!C)return v;for(let N=0;N<C.length;N++){const I=C[N];var E=I.coverageAreas;if(!E)return;for(const G of E){var F=
G.bbox,L=G.zoomMin-(B&&G.zoomMin?1:0);E=G.zoomMax-(B&&G.zoomMax?1:0);for(F={extent:r.geographicToWebMercator({xmin:F[1],ymin:F[0],xmax:F[3],ymax:F[2],spatialReference:c.WGS84}),attribution:I.attribution||"",score:null!=G.score?G.score:100,id:N};L<=E;L++)v[L]=v[L]||[],v[L].push(F)}}v.maxKey=Math.max.apply(null,Object.keys(v));return v};D._getDynamicAttribution=function(C,B,v){const {extent:E,scale:F}=B;v=v.tileInfo.scaleToZoom(F);v=Math.min(C.maxKey,Math.round(v));if(!E||null==v||-1>=v)return"";C=
C[v];const L=r.project(E.center.clone().normalize(),B.spatialReference),N={};return C?C.filter(I=>{const G=!N[I.id]&&L&&z.extentContainsPoint(I.extent,L);G&&(N[I.id]=!0);return G}).sort((I,G)=>G.score-I.score||I.objectId-G.objectId).map(I=>I.attribution).join(", "):""};a._createClass(x,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return x}(w.HandleOwner);u.__decorate([n.property({readOnly:!0,type:t})],f.prototype,"items",
void 0);u.__decorate([n.property({readOnly:!0})],f.prototype,"state",null);u.__decorate([n.property()],f.prototype,"view",void 0);return f=u.__decorate([m.subclass("esri.widgets.Attribution.AttributionViewModel")],f)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){p=function(c){function d(A,q){A=c.call(this,A,q)||this;A.goToOverride=null;A.iconClass="esri-icon-locate-circled";A.label=void 0;A.messages=null;A.view=null;A.viewModel=new k;return A}a._inheritsLoose(d,c);var g=d.prototype;g.reset=function(){return this.viewModel.reset()};g.render=function(){const {orientation:A,state:q}=this.viewModel;var y="disabled"===q,x="compass"===("rotation"===q?"rotation":"compass");const D=y?-1:0;y={["esri-disabled"]:y,["esri-interactive"]:!y};
x={["esri-icon-compass"]:x,["esri-icon-dial"]:!x};const {messages:C}=this;return z.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",y),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:D,"aria-label":C.reset,title:C.reset},z.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",x),styles:this._toRotationTransform(A)}),z.tsx("span",{class:"esri-icon-font-fallback-text"},C.reset))};g._reset=function(){this.viewModel.reset()};g._toRotationTransform=
function(A){return{transform:`rotateZ(${A.z}deg)`}};return d}(h);u.__decorate([f.aliasOf("viewModel.goToOverride")],p.prototype,"goToOverride",void 0);u.__decorate([n.property()],p.prototype,"iconClass",void 0);u.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],p.prototype,"label",void 0);u.__decorate([n.property(),m.messageBundle("esri/widgets/Compass/t9n/Compass")],p.prototype,"messages",void 0);u.__decorate([f.aliasOf("viewModel.view")],p.prototype,"view",void 0);
u.__decorate([n.property({type:k})],p.prototype,"viewModel",void 0);u.__decorate([l.accessibleHandler()],p.prototype,"_reset",null);return p=u.__decorate([b.subclass("esri.widgets.Compass")],p)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){f=function(m){function z(c){c=m.call(this,c)||this;c._handles=new p;c.orientation={x:0,y:0,z:0};c.view=null;c._updateForCamera=c._updateForCamera.bind(a._assertThisInitialized(c));c._updateForRotation=c._updateForRotation.bind(a._assertThisInitialized(c));c._updateRotationWatcher=c._updateRotationWatcher.bind(a._assertThisInitialized(c));return c}a._inheritsLoose(z,m);var r=z.prototype;r.initialize=function(){this._handles.add(t.init(this,"view",this._updateRotationWatcher))};
r.destroy=function(){this._handles.destroy();this.view=this._handles=null};r.reset=function(){if(this.get("view.ready")){var c={};"2d"===this.view.type?c.rotation=0:c.heading=0;this.callGoTo({target:c})}};r._updateForRotation=function(c){void 0!==c&&null!==c&&(this.orientation={z:c})};r._updateForCamera=function(c){c&&(this.orientation={x:0,y:0,z:-c.heading})};r._updateRotationWatcher=function(c){this._handles.removeAll();c&&("2d"===c.type?this._handles.add(t.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(t.init(this,"view.camera",this._updateForCamera)))};a._createClass(z,[{key:"canShowNorth",get:function(){const c=this.get("view.spatialReference");return!(!c||!c.isWebMercator&&!c.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return z}(l.GoToMixin(f));u.__decorate([w.property({readOnly:!0})],f.prototype,"canShowNorth",null);u.__decorate([w.property()],f.prototype,"orientation",void 0);u.__decorate([w.property({readOnly:!0})],
f.prototype,"state",null);u.__decorate([w.property()],f.prototype,"view",void 0);return f=u.__decorate([k.subclass("esri.widgets.CompassViewModel")],f)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){p=function(c){function d(A,q){A=c.call(this,A,q)||this;A.iconClass="esri-icon-pan2";A.label=void 0;A.messages=null;A.view=null;A.viewModel=new k;return A}a._inheritsLoose(d,c);var g=d.prototype;g.toggle=function(){return this.viewModel.toggle()};g.render=function(){const A="disabled"===this.get("viewModel.state");var q="pan"===this.get("viewModel.navigationMode");const y={["esri-navigation-toggle__button--active"]:q};q={["esri-navigation-toggle__button--active"]:!q};
const x=A?-1:0,D=this.messages.toggle;return z.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:A,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:x,"aria-label":D,title:D},z.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",y)},z.tsx("span",{class:"esri-icon-pan"})),z.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",q)},z.tsx("span",{class:"esri-icon-rotate"})))};g._toggle=function(){this.toggle()};a._createClass(d,[{key:"layout",set:function(A){"horizontal"!==A&&(A="vertical");this._set("layout",A)}}]);return d}(h);u.__decorate([n.property()],p.prototype,"iconClass",void 0);u.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],p.prototype,"label",void 0);u.__decorate([n.property({value:"vertical"})],p.prototype,"layout",null);u.__decorate([n.property(),
m.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],p.prototype,"messages",void 0);u.__decorate([f.aliasOf("viewModel.view")],p.prototype,"view",void 0);u.__decorate([n.property({type:k})],p.prototype,"viewModel",void 0);u.__decorate([l.accessibleHandler()],p.prototype,"_toggle",null);return p=u.__decorate([b.subclass("esri.widgets.NavigationToggle")],p)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){f=function(l){function m(r){r=l.call(this,r)||this;r._handles=new p;r.navigationMode="pan";r.view=null;return r}a._inheritsLoose(m,l);var z=m.prototype;z.initialize=function(){this._handles.add(t.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};z.destroy=function(){this._handles.destroy();this.view=this._handles=null};z.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
z._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(m,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return m}(f);u.__decorate([w.property({readOnly:!0})],f.prototype,"state",null);u.__decorate([w.property()],f.prototype,"navigationMode",void 0);u.__decorate([w.property()],f.prototype,"view",void 0);return f=u.__decorate([k.subclass("esri.widgets.NavigationToggleViewModel")],
f)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){p=function(c){function d(A,
q){A=c.call(this,A,q)||this;A.iconClass="esri-icon-zoom-in-magnifying-glass";A.label=void 0;A.messages=null;A.view=null;A.viewModel=new r;return A}a._inheritsLoose(d,c);var g=d.prototype;g.initialize=function(){this._zoomInButton=new z({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new z({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};g.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};g.render=function(){const A=this.viewModel,q={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===A.state&&A.canZoomIn;this._zoomOutButton.enabled="ready"===A.state&&A.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return m.tsx("div",{class:this.classes("esri-zoom esri-widget",q)},this._zoomInButton.render(),this._zoomOutButton.render())};g.zoomIn=function(){return this.viewModel.zoomIn()};g.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(d,[{key:"layout",set:function(A){"horizontal"!==A&&(A="vertical");this._set("layout",A)}}]);return d}(h);u.__decorate([n.property()],p.prototype,"iconClass",void 0);u.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],p.prototype,"label",void 0);u.__decorate([n.property({value:"vertical"})],p.prototype,"layout",null);u.__decorate([n.property(),l.messageBundle("esri/widgets/Zoom/t9n/Zoom")],p.prototype,"messages",
void 0);u.__decorate([f.aliasOf("viewModel.view")],p.prototype,"view",void 0);u.__decorate([n.property({type:r})],p.prototype,"viewModel",void 0);return p=u.__decorate([b.subclass("esri.widgets.Zoom")],p)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){p=function(m){function z(){var c=m.apply(this,arguments)||this;c.enabled=!0;c.iconClass="";c.title="";return c}a._inheritsLoose(z,m);var r=z.prototype;r.render=function(){const c=this.enabled?0:-1,d={[this.iconClass]:!!this.iconClass};return k.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},k.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",d)}),k.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};r._triggerAction=function(){this.action.call(this)};return z}(b);u.__decorate([f.property()],p.prototype,"action",void 0);u.__decorate([f.property()],p.prototype,"enabled",void 0);u.__decorate([f.property()],p.prototype,"iconClass",void 0);u.__decorate([f.property()],p.prototype,"title",void 0);u.__decorate([h.accessibleHandler()],
p.prototype,"_triggerAction",null);return p=u.__decorate([n.subclass("esri.widgets.IconButton")],p)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k,l){f=function(m){function z(c){c=m.call(this,c)||this;c.canZoomIn=!1;c.canZoomOut=!1;return c}a._inheritsLoose(z,m);var r=z.prototype;r.destroy=function(){this.view=null};r.zoomIn=function(){if(this.canZoomIn){var c=this.view;"2d"===c.type?c.mapViewNavigation.zoomIn():p.ignoreAbortErrors(c.goTo({zoomFactor:2}))}};r.zoomOut=function(){if(this.canZoomOut){var c=this.view;"2d"===c.type?c.mapViewNavigation.zoomOut():p.ignoreAbortErrors(c.goTo({zoomFactor:.5}))}};a._createClass(z,[{key:"state",
get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(c){c?"2d"===c.type?this._zoomConditions=new k({view:c}):"3d"===c.type&&(this._zoomConditions=new l({view:c})):this._zoomConditions=null;this._set("view",c)}}]);return z}(f);u.__decorate([t.property()],f.prototype,"_zoomConditions",void 0);u.__decorate([t.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],f.prototype,"canZoomIn",void 0);u.__decorate([t.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],f.prototype,"canZoomOut",void 0);u.__decorate([t.property({readOnly:!0})],f.prototype,"state",null);u.__decorate([t.property()],f.prototype,"view",null);return f=u.__decorate([h.subclass("esri.widgets.Zoom.ZoomViewModel")],f)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b){f=function(h){function k(){return h.apply(this,arguments)||this}a._inheritsLoose(k,h);a._createClass(k,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const l=this.get("view.animation.target.scale")||this.get("view.scale"),m=this.get("view.constraints.effectiveMaxScale");return 0===m||l>m}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const l=this.get("view.animation.target.scale")||this.get("view.scale"),m=this.get("view.constraints.effectiveMinScale");
return 0===m||l<m}}]);return k}(f);u.__decorate([p.property({readOnly:!0})],f.prototype,"canZoomIn",null);u.__decorate([p.property({readOnly:!0})],f.prototype,"canZoomOut",null);u.__decorate([p.property()],f.prototype,"view",void 0);return f=u.__decorate([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],f)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b){f=function(h){function k(){return h.apply(this,arguments)||this}a._inheritsLoose(k,h);a._createClass(k,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return k}(f);u.__decorate([p.property({readOnly:!0})],f.prototype,"canZoomIn",null);u.__decorate([p.property({readOnly:!0})],f.prototype,"canZoomOut",null);u.__decorate([p.property()],f.prototype,"view",void 0);return f=u.__decorate([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],
f)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca,da,ha,fa,R,U,Z,T,P){const X=["3DObject","Point"],aa=c.getLogger("esri.layers.SceneLayer");t=Y.defineFieldProperties();g=function(ka){function na(...pa){pa=ka.call(this,...pa)||this;pa.featureReduction=null;pa.rangeInfos=null;pa.operationalLayerType="ArcGISSceneServiceLayer";pa.type="scene";pa.fields=null;pa.floorInfo=null;pa.outFields=null;pa.nodePages=null;pa.materialDefinitions=null;pa.textureSetDefinitions=
null;pa.geometryDefinitions=null;pa.serviceUpdateTimeStamp=null;pa.definitionExpression=null;pa.path=null;pa.labelsVisible=!0;pa.labelingInfo=null;pa.legendEnabled=!0;pa.cachedDrawingInfo={color:!1};pa.popupEnabled=!0;pa.popupTemplate=null;pa.objectIdField=null;pa.globalIdField=null;pa._fieldUsageInfo={};pa.screenSizePerspectiveEnabled=!0;return pa}u._inheritsLoose(na,ka);var ta=na.prototype;ta.normalizeCtorArgs=function(pa,xa){return"string"===typeof pa?{url:pa,...xa}:pa};ta.getField=function(pa){return this.fieldsIndex.get(pa)};
ta.getFieldDomain=function(pa,xa){var Da,Ka,Fa,Ha;return(xa=null==(Da=this.getFeatureType(null==xa?void 0:xa.feature))?void 0:null==(Ka=Da.domains)?void 0:Ka[pa])&&"inherited"!==xa.type?xa:null!=(Fa=null==(Ha=this.getField(pa))?void 0:Ha.domain)?Fa:null};ta.getFeatureType=function(pa){return pa&&d.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(pa):null};ta.readNodePages=function(pa,xa,Da){"Point"===xa.layerType&&(pa=xa.pointNodePages);return null==pa||"object"!==typeof pa?null:ca.I3SNodePageDefinition.fromJSON(pa,
Da)};ta.readCachedDrawingInfo=function(pa){if(null==pa||"object"!==typeof pa)pa={};null==pa.color&&(pa.color=!1);return pa};ta.readObjectIdField=function(pa,xa){!pa&&xa.fields&&xa.fields.some(Da=>{"esriFieldTypeOID"===Da.type&&(pa=Da.name);return!!pa});return pa||void 0};ta.readGlobalIdField=function(pa,xa){!pa&&xa.fields&&xa.fields.some(Da=>{"esriFieldTypeGlobalID"===Da.type&&(pa=Da.name);return!!pa});return pa||void 0};ta.readProfile=function(pa,xa){pa=xa.store.profile;if(null!=pa&&ja[pa])return ja[pa];
aa.error("Unknown or missing profile",{profile:pa,layer:this});return"mesh-pyramids"};ta.load=function(pa){const xa=d.isSome(pa)?pa.signal:null,Da=this.loadFromPortal({supportedTypes:["Scene Service"]},pa).catch(A.throwIfAbortError).then(()=>this._fetchService(xa)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,xa),this._setAssociatedFeatureLayer(xa)])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>
U.loadStyleRenderer(this,{origin:"service"},xa)).then(()=>ba.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(pa));this.addResolvingPromise(Da);return Promise.resolve(this)};ta.createQuery=function(){const pa=new Z;"mesh"!==this.geometryType&&(pa.returnGeometry=!0,pa.returnZ=!0);pa.where=this.definitionExpression||"1\x3d1";pa.sqlFormat="standard";return pa};ta.queryExtent=function(pa,xa){return this._getAssociatedLayerForQuery().then(Da=>Da.queryExtent(pa||
this.createQuery(),xa))};ta.queryFeatureCount=function(pa,xa){return this._getAssociatedLayerForQuery().then(Da=>Da.queryFeatureCount(pa||this.createQuery(),xa))};ta.queryFeatures=function(pa,xa){return this._getAssociatedLayerForQuery().then(Da=>Da.queryFeatures(pa||this.createQuery(),xa)).then(Da=>{if(null!=Da&&Da.features)for(const Ka of Da.features)Ka.layer=this,Ka.sourceLayer=this;return Da})};ta.queryObjectIds=function(pa,xa){return this._getAssociatedLayerForQuery().then(Da=>Da.queryObjectIds(pa||
this.createQuery(),xa))};ta.queryAttachments=function(pa,xa){return this._getAssociatedLayerForQuery().then(Da=>Da.queryAttachments(pa,xa))};ta.getFieldUsageInfo=function(pa){const xa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[pa]||xa:(aa.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),xa)};ta.createPopupTemplate=function(pa){return T.createPopupTemplate(this,pa)};ta._getAssociatedLayerForQuery=
function(){const pa=this.associatedLayer;return d.isSome(pa)&&pa.loaded?Promise.resolve(pa):this._loadAssociatedLayerForQuery()};ta._loadAssociatedLayerForQuery=function(){var pa=u._asyncToGenerator(function*(){yield this.load();if(d.isNone(this.associatedLayer))throw new r("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(xa){throw new r("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",
{layer:this,error:xa});}return this.associatedLayer});return function(){return pa.apply(this,arguments)}}();ta.hasCachedStatistics=function(pa){return null!=this.statisticsInfo&&this.statisticsInfo.some(xa=>xa.name===pa)};ta.queryCachedStatistics=function(){var pa=u._asyncToGenerator(function*(xa,Da){yield this.load(Da);if(!this.statisticsInfo)throw new r("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ka=this.fieldsIndex.get(xa);if(!Ka)throw new r("scenelayer:field-unexisting",
`Field '${xa}' does not exist on the layer`);for(const Fa of this.statisticsInfo)if(Fa.name===Ka.name)return xa=q.join(this.parsedUrl.path,Fa.href),z(xa,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Da?Da.signal:null}).then(Ha=>Ha.data);throw new r("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(xa,Da){return pa.apply(this,arguments)}}();ta.saveAs=function(){var pa=u._asyncToGenerator(function*(xa,Da){return this._debouncedSaveOperations(1,
{...Da,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},xa)});return function(xa,Da){return pa.apply(this,arguments)}}();ta.save=function(){var pa=u._asyncToGenerator(function*(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return pa.apply(this,arguments)}}();ta.applyEdits=function(){var pa=u._asyncToGenerator(function*(xa,Da){const Ka=yield new Promise(function(Fa,Ha){a(["./graphics/editingSupport"],
Fa,Ha)});yield this.load();if(d.isNone(this.associatedLayer))throw new r(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return Ka.applyEdits(this,this.associatedLayer.source,xa,Da)});return function(xa,Da){return pa.apply(this,arguments)}}();ta.on=function(pa,xa){return ka.prototype.on.call(this,pa,xa)};ta.validateLayer=function(pa){if(pa.layerType&&-1===X.indexOf(pa.layerType))throw new r("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",
{layerType:pa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new r("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new r("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});{pa=this.normalReferenceFrame;var xa=this.spatialReference;let Da=!1,Ka=!1;if(null==pa)Ka=Da=!0;else switch(xa=
xa&&xa.isGeographic,pa){case "east-north-up":case "earth-centered":Da=!0;Ka=xa;break;case "vertex-reference-frame":Da=!0;Ka=!xa;break;default:Da=!1}if(!Da)throw new r("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Ka)throw new r("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}};ta._getTypeKeywords=function(){const pa=[];if("points"===this.profile)pa.push("Point");else if("mesh-pyramids"===
this.profile)pa.push("3DObject");else throw new r("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return pa};ta._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const pa of this.fields){const xa=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Ka=>Ka.name===pa.name)),Da=!!(d.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Ka=>Ka&&pa.name===Ka.name));this._fieldUsageInfo[pa.name]=
{supportsLabelingInfo:xa,supportsRenderer:xa,supportsPopupTemplate:xa||Da,supportsLayerQuery:Da}}};ta._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};ta._applyAssociatedLayerFieldsOverrides=function(){if(!d.isNone(this.associatedLayer)&&this.associatedLayer.fields){var pa=null;for(const xa of this.associatedLayer.fields){const Da=this.getField(xa.name);Da?(!Da.domain&&xa.domain&&(Da.domain=xa.domain.clone()),Da.editable=
xa.editable,Da.nullable=xa.nullable,Da.length=xa.length):(pa||(pa=this.fields?this.fields.slice():[]),pa.push(xa.clone()))}pa&&this._set("fields",pa)}};ta._applyAssociatedLayerPopupOverrides=function(){if(!d.isNone(this.associatedLayer)){var pa=["popupTemplate","popupEnabled"],xa=C.getProperties(this);for(let Da=0;Da<pa.length;Da++){const Ka=pa[Da],Fa=this.originIdOf(Ka),Ha=this.associatedLayer.originIdOf(Ka);Fa<Ha&&(2===Ha||3===Ha)&&xa.setAtOrigin(Ka,this.associatedLayer[Ka],Ha)}}};ta._setAssociatedFeatureLayer=
function(){var pa=u._asyncToGenerator(function*(xa){if(-1!==["mesh-pyramids","points"].indexOf(this.profile)){xa=new V.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,xa);try{this.associatedLayer=yield xa.fetch()}catch(Da){A.isAbortError(Da)||this._logWarningOnPopupEnabled()}}});return function(xa){return pa.apply(this,arguments)}}();ta._logWarningOnPopupEnabled=function(){y.whenValidOnce(this,["popupTemplate","popupEnabled"],()=>this.popupEnabled&&null!=this.popupTemplate).then(()=>
()=>{const pa=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?aa.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${pa}`):aa.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${pa}`)})};ta._validateElevationInfo=function(){const pa=this.elevationInfo;pa&&("mesh-pyramids"===this.profile&&"absolute-height"!==pa.mode&&aa.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),
pa.featureExpressionInfo&&"0"!==pa.featureExpressionInfo.expression&&aa.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};u._createClass(na,[{key:"types",get:function(){return d.isSome(this.associatedLayer)?this.associatedLayer.types:[]}},{key:"typeIdField",get:function(){return d.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return d.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",
get:function(){return new W(this.fields)}},{key:"elevationInfo",set:function(pa){this._set("elevationInfo",pa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return ia[this.profile]||"mesh"}},{key:"renderer",set:function(pa){ba.fixRendererFields(pa,this.fieldsIndex);this._set("renderer",pa)}},{key:"capabilities",get:function(){var pa=d.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:M.zeroCapabilities;const {query:xa,
editing:{supportsGlobalId:Da,supportsRollbackOnFailure:Ka,supportsUploadWithItemId:Fa,supportsReturnServiceEditsInSourceSpatialReference:Ha},data:{supportsZ:ua,supportsM:Ba,isVersioned:Ea,supportsAttachment:Ga},operations:{supportsEditing:ma,supportsUpdate:ya,supportsQuery:Ma,supportsQueryAttachments:Ra}}=pa;pa=pa.operations.supportsChangeTracking;return{query:xa,editing:{supportsGlobalId:Da,supportsReturnServiceEditsInSourceSpatialReference:Ha,supportsRollbackOnFailure:Ka,supportsGeometryUpdate:!1,
supportsUploadWithItemId:Fa},data:{supportsAttachment:Ga,supportsZ:ua,supportsM:Ba,isVersioned:Ea},operations:{supportsQuery:Ma,supportsQueryAttachments:Ra,supportsEditing:ma&&pa,supportsAdd:!1,supportsDelete:!1,supportsUpdate:ya&&pa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(pa){null!=pa?this._override("editingEnabled",pa):this._clearOverride("editingEnabled")}},{key:"defaultPopupTemplate",
get:function(){return d.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return d.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return na}(J.SceneService(I.ArcGISService(G.OperationalLayer(K.PortalLayer(H.ScaleRangeLayer(g.MultiOriginJSONMixin(N.APIKeyMixin(L))))))));f.__decorate([x.property({types:{key:"type",base:Q["default"],typeMap:{selection:S}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",
write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],g.prototype,"featureReduction",void 0);f.__decorate([x.property({type:[R["default"]],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],g.prototype,"rangeInfos",void 0);f.__decorate([x.property({json:{read:!1}})],g.prototype,"associatedLayer",void 0);f.__decorate([x.property({type:["show","hide"]})],g.prototype,"listMode",void 0);
f.__decorate([x.property({type:["ArcGISSceneServiceLayer"]})],g.prototype,"operationalLayerType",void 0);f.__decorate([x.property({json:{read:!1},readOnly:!0})],g.prototype,"type",void 0);f.__decorate([x.property({...t.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],g.prototype,"fields",void 0);f.__decorate([x.property()],g.prototype,"types",null);f.__decorate([x.property()],g.prototype,"typeIdField",null);f.__decorate([x.property()],g.prototype,"formTemplate",null);f.__decorate([x.property({readOnly:!0})],
g.prototype,"fieldsIndex",null);f.__decorate([x.property({type:fa,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],g.prototype,"floorInfo",void 0);f.__decorate([x.property(t.outFields)],g.prototype,"outFields",void 0);f.__decorate([x.property({type:ca.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],g.prototype,"nodePages",void 0);f.__decorate([E.reader("service","nodePages",["nodePages","pointNodePages"])],g.prototype,"readNodePages",null);f.__decorate([x.property({type:[ca.I3SMaterialDefinition],
readOnly:!0})],g.prototype,"materialDefinitions",void 0);f.__decorate([x.property({type:[ca.I3STextureSetDefinition],readOnly:!0})],g.prototype,"textureSetDefinitions",void 0);f.__decorate([x.property({type:[ca.I3SGeometryDefinition],readOnly:!0})],g.prototype,"geometryDefinitions",void 0);f.__decorate([x.property({readOnly:!0})],g.prototype,"serviceUpdateTimeStamp",void 0);f.__decorate([x.property({readOnly:!0})],g.prototype,"attributeStorageInfo",void 0);f.__decorate([x.property({readOnly:!0})],
g.prototype,"statisticsInfo",void 0);f.__decorate([x.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],g.prototype,"definitionExpression",void 0);f.__decorate([x.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],g.prototype,"path",void 0);f.__decorate([x.property(O.elevationInfo)],g.prototype,"elevationInfo",null);f.__decorate([x.property({type:String})],g.prototype,"geometryType",
null);f.__decorate([x.property(O.labelsVisible)],g.prototype,"labelsVisible",void 0);f.__decorate([x.property({type:[da],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ha.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ha.reader},write:!0}})],g.prototype,"labelingInfo",void 0);f.__decorate([x.property(O.legendEnabled)],g.prototype,"legendEnabled",void 0);f.__decorate([x.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,
target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(ka,na){var ta,pa;if("number"===typeof ka&&0<=ka&&1>=ka)return ka;ka=null==(ta=na.layerDefinition)?void 0:null==(pa=ta.drawingInfo)?void 0:pa.transparency;return void 0!==ka?P.transparencyToOpacity(ka):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],g.prototype,"opacity",void 0);f.__decorate([x.property({types:m.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],g.prototype,"renderer",null);f.__decorate([x.property({json:{read:!1}})],g.prototype,"cachedDrawingInfo",void 0);f.__decorate([E.reader("service","cachedDrawingInfo")],g.prototype,"readCachedDrawingInfo",null);f.__decorate([x.property({readOnly:!0,json:{read:!1}})],g.prototype,"capabilities",null);f.__decorate([x.property({type:Boolean,json:{read:!1}})],g.prototype,"editingEnabled",
null);f.__decorate([x.property(O.popupEnabled)],g.prototype,"popupEnabled",void 0);f.__decorate([x.property({type:p,json:{name:"popupInfo",write:!0}})],g.prototype,"popupTemplate",void 0);f.__decorate([x.property({readOnly:!0,json:{read:!1}})],g.prototype,"defaultPopupTemplate",null);f.__decorate([x.property({type:String,json:{read:!1}})],g.prototype,"objectIdField",void 0);f.__decorate([E.reader("service","objectIdField",["objectIdField","fields"])],g.prototype,"readObjectIdField",null);f.__decorate([x.property({type:String,
json:{read:!1}})],g.prototype,"globalIdField",void 0);f.__decorate([E.reader("service","globalIdField",["globalIdField","fields"])],g.prototype,"readGlobalIdField",null);f.__decorate([x.property({readOnly:!0,type:String,json:{read:!1}})],g.prototype,"displayField",null);f.__decorate([x.property({type:String,json:{read:!1}})],g.prototype,"profile",void 0);f.__decorate([E.reader("service","profile",["store.profile"])],g.prototype,"readProfile",null);f.__decorate([x.property({readOnly:!0,type:String,
json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],g.prototype,"normalReferenceFrame",void 0);f.__decorate([x.property(O.screenSizePerspectiveEnabled)],g.prototype,"screenSizePerspectiveEnabled",void 0);g=f.__decorate([F.subclass("esri.layers.SceneLayer")],g);const ja={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
ia={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return g})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E){const F=n.getLogger("esri.layers.mixins.SceneService"),L={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};u.SCENE_SERVICE_ITEM_TYPE="Scene Service";u.SceneService=N=>{N=function(I){function G(){var H=I.apply(this,arguments)||this;H.spatialReference=null;H.fullExtent=null;H.heightModelInfo=null;H.minScale=0;H.maxScale=0;H.version={major:Number.NaN,minor:Number.NaN,
versionString:""};H.copyright=null;H.sublayerTitleMode="item-title";H.title=null;H.layerId=null;H.indexInfo=null;H._debouncedSaveOperations=h.debounce(function(){var J=f._asyncToGenerator(function*(M,O,Q){switch(M){case 0:return H._save(O);case 1:return H._saveAs(Q,O)}});return function(M,O,Q){return J.apply(this,arguments)}}());return H}f._inheritsLoose(G,I);var K=G.prototype;K.readSpatialReference=function(H,J){return this._readSpatialReference(J)};K._readSpatialReference=function(H){if(null!=H.spatialReference)return y.fromJSON(H.spatialReference);
H=H.store;H=(H=H.indexCRS||H.geographicCRS)&&parseInt(H.substring(H.lastIndexOf("/")+1,H.length),10);return null!=H?new y(H):null};K.readFullExtent=function(H,J,M){if(null!=H&&"object"===typeof H)return A.fromJSON(H,M);H=J.store;J=this._readSpatialReference(J);return null==J||null==H||null==H.extent||!Array.isArray(H.extent)||H.extent.some(O=>-1E38>O)?null:new A({xmin:H.extent[0],ymin:H.extent[1],xmax:H.extent[2],ymax:H.extent[3],spatialReference:J})};K.readVersion=function(H,J){H=J.store;J=null!=
H.version?H.version.toString():"";H={major:Number.NaN,minor:Number.NaN,versionString:J};J=J.split(".");2<=J.length&&(H.major=parseInt(J[0],10),H.minor=parseInt(J[1],10));return H};K.readTitlePortalItem=function(H){return"item-title"!==this.sublayerTitleMode?void 0:H};K.readTitleService=function(H,J){H=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return x.titleFromUrlAndName(this.url,J.name);J=J.name;if(!J&&this.url){const M=x.parse(this.url);b.isSome(M)&&(J=M.title)}"item-title-and-service-name"===
this.sublayerTitleMode&&H&&(J=H+" - "+J);return x.cleanTitle(J)};K.writeUrl=function(H,J,M,O){x.writeUrlWithLayerId(this,H,"layers",J,O)};K._fetchIndexAndUpdateExtent=function(){var H=f._asyncToGenerator(function*(J,M){this.indexInfo=C.fetchIndexInfo(this.parsedUrl.path,this.rootNode,J,this.apiKey,F,M);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(J,M){return H.apply(this,arguments)}}();K._updateExtent=function(H){if("page"===(null==H?void 0:
H.type)){var J,M,O=H.rootIndex%H.pageSize;H=null==(J=H.rootPage)?void 0:null==(M=J.nodes)?void 0:M[O];if(null==H||null==H.obb||null==H.obb.center||null==H.obb.halfSize)throw new w("sceneservice:invalid-node-page","Invalid node page.");-1E38>H.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(J=H.obb.halfSize,M=H.obb.center[2],J=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),this.fullExtent.zmin=M-J,this.fullExtent.zmax=M+J)}else"node"===(null==H?void 0:H.type)&&(M=null==(O=H.rootNode)?void 0:
O.mbs,!Array.isArray(M)||4!==M.length||-1E38>M[0]||(J=M[2],M=M[3],this.fullExtent.zmin=J-M,this.fullExtent.zmax=J+M))};K._fetchService=function(){var H=f._asyncToGenerator(function*(J){if(null==this.url)throw new w("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const M=yield this._fetchFirstLayerId(J);null!=M&&(this.layerId=M)}return this._fetchServiceLayer(J)});return function(J){return H.apply(this,
arguments)}}();K._fetchFirstLayerId=function(){var H=f._asyncToGenerator(function*(J){J=yield t(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:J});if(J.data&&Array.isArray(J.data.layers)&&0<J.data.layers.length)return J.data.layers[0].id});return function(J){return H.apply(this,arguments)}}();K._fetchServiceLayer=function(){var H=f._asyncToGenerator(function*(J){J=yield t(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:J});J.ssl&&(this.url=
this.url.replace(/^http:/i,"https:"));J=J.data;this.read(J,{origin:"service",url:this.parsedUrl});this.validateLayer(J)});return function(J){return H.apply(this,arguments)}}();K._ensureLoadBeforeSave=function(){var H=f._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return H.apply(this,arguments)}}();K.validateLayer=function(H){};K._updateTypeKeywords=function(H,J,M){H.typeKeywords||(H.typeKeywords=
[]);J=J.getTypeKeywords();for(const O of J)H.typeKeywords.push(O);H.typeKeywords&&(H.typeKeywords=H.typeKeywords.filter((O,Q,S)=>S.indexOf(O)===Q),1===M&&(H.typeKeywords=H.typeKeywords.filter(O=>"Hosted Service"!==O)))};K._saveAs=function(){var H=f._asyncToGenerator(function*(J,M){M={...L,...M};J=v.from(J);J||(F.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new w("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));J.id&&(J=J.clone(),J.id=
null);const O=J.portal||B.getDefault();yield this._ensureLoadBeforeSave();J.type="Scene Service";J.portal=O;const Q={origin:"portal-item",url:null,messages:[],portal:O,portalItem:J,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},S={layers:[this.write(null,Q)]};yield Promise.all(Q.resources.pendingOperations);yield this._validateAgainstJSONSchema(S,Q,M);J.url=this.url;J.title||(J.title=this.title);this._updateTypeKeywords(J,M,1);yield O._signIn();
yield O.user.addItem({item:J,folder:M&&M.folder,data:S});yield E.saveResources(this.resourceReferences,Q,null);this.portalItem=J;g.updateOrigins(Q);return Q.portalItem=J});return function(J,M){return H.apply(this,arguments)}}();K._save=function(){var H=f._asyncToGenerator(function*(J){J={...L,...J};this.portalItem||(F.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new w("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService")));
"Scene Service"!==this.portalItem.type&&(F.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),yield Promise.reject(new w("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));yield this._ensureLoadBeforeSave();const M={origin:"portal-item",url:this.portalItem.itemUrl&&k.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||B.getDefault(),portalItem:this.portalItem,writtenProperties:[],
blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},O={layers:[this.write(null,M)]};yield Promise.all(M.resources.pendingOperations);yield this._validateAgainstJSONSchema(O,M,J);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,J,0);yield this.portalItem.update({data:O});yield E.saveResources(this.resourceReferences,M,null);g.updateOrigins(M);return this.portalItem});return function(J){return H.apply(this,
arguments)}}();K._validateAgainstJSONSchema=function(){var H=f._asyncToGenerator(function*(J,M,O){M=M.messages.filter(Q=>"error"===Q.type).map(Q=>new w(Q.name,Q.message,Q.details));O&&O.validationOptions.ignoreUnsupported&&(M=M.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));if(O.validationOptions.enabled&&(J=(yield new Promise(function(Q,
S){a(["../support/schemaValidator"],Q,S)})).validate(J,O.portalItemLayerType),0<J.length)){const Q=`Layer item did not validate:\n${J.join("\n")}`;F.error(`_validateAgainstJSONSchema(): ${Q}`);if("throw"===O.validationOptions.failPolicy)throw O=J.map(S=>new w("sceneservice:schema-validation",S)).concat(M),new w("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:O});}if(0<M.length)throw new w("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:M});});return function(J,M,O){return H.apply(this,arguments)}}();f._createClass(G,[{key:"url",set:function(H){H=x.sanitizeUrlWithLayerId({layer:this,url:H,nonStandardUrlAllowed:!1,logger:F});this._set("url",H.url);null!=H.layerId&&this._set("layerId",H.layerId)}},{key:"parsedUrl",get:function(){var H=this._get("url");if(!H)return null;H=k.urlToObject(H);null!=this.layerId&&(H.path=`${H.path}/layers/${this.layerId}`);return H}}]);return G}(N);p.__decorate([l.property(D.id)],N.prototype,"id",
void 0);p.__decorate([l.property({type:y})],N.prototype,"spatialReference",void 0);p.__decorate([r.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],N.prototype,"readSpatialReference",null);p.__decorate([l.property({type:A})],N.prototype,"fullExtent",void 0);p.__decorate([r.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],N.prototype,"readFullExtent",null);p.__decorate([l.property({readOnly:!0,type:q})],
N.prototype,"heightModelInfo",void 0);p.__decorate([l.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],N.prototype,"minScale",void 0);p.__decorate([l.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],N.prototype,"maxScale",void 0);p.__decorate([l.property({readOnly:!0})],N.prototype,"version",void 0);p.__decorate([r.reader("version",["store.version"])],
N.prototype,"readVersion",null);p.__decorate([l.property({type:String,json:{read:{source:"copyrightText"}}})],N.prototype,"copyright",void 0);p.__decorate([l.property({type:String,json:{read:!1}})],N.prototype,"sublayerTitleMode",void 0);p.__decorate([l.property({type:String})],N.prototype,"title",void 0);p.__decorate([r.reader("portal-item","title")],N.prototype,"readTitlePortalItem",null);p.__decorate([r.reader("service","title",["name"])],N.prototype,"readTitleService",null);p.__decorate([l.property({type:Number,
json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],N.prototype,"layerId",void 0);p.__decorate([l.property(D.url)],N.prototype,"url",null);p.__decorate([d.writer("url")],N.prototype,"writeUrl",null);p.__decorate([l.property()],N.prototype,"parsedUrl",null);p.__decorate([l.property({readOnly:!0})],N.prototype,"store",void 0);p.__decorate([l.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],N.prototype,"rootNode",
void 0);return N=p.__decorate([c.subclass("esri.layers.mixins.SceneService")],N)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,u){a.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(p=>{const t=p.target;p.newOrigin&&p.oldOrigin!==p.newOrigin&&u.isMultiOriginJSONMixin(t)&&t.updateOrigin(p.propName,p.newOrigin)})};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(u){return u&&"getAtOrigin"in u&&"originOf"in u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe"],function(a,u,f,p,t){function w(){w=u._asyncToGenerator(function*(e,n,b,h,k,l){var m=null;if(t.isSome(b)){m=`${e}/nodepages/`;
const z=m+Math.floor(b.rootIndex/b.nodesPerPage);try{return{type:"page",rootPage:(yield f(z,{query:{f:"json",token:h},responseType:"json",signal:l})).data,rootIndex:b.rootIndex,pageSize:b.nodesPerPage,lodMetric:b.lodSelectionMetricType,urlPrefix:m}}catch(r){t.isSome(k)&&k.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",z,r),m=r}}if(!n)return null;n=n&&n.split("/").pop();e=`${e}/nodes/`;n=e+n;try{return{type:"node",rootNode:(yield f(n,{query:{f:"json",token:h},
responseType:"json",signal:l})).data,urlPrefix:e}}catch(z){throw new p("sceneservice:root-node-missing","Root node missing.",{pageError:m,nodeError:z,url:n});}});return w.apply(this,arguments)}a.fetchIndexInfo=function(e,n,b,h,k,l){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,u,f,p,t,w,e){function n(){n=u._asyncToGenerator(function*(m,z,r){if(z&&z.resources){var c=z.portalItem===m.portalItem?new Set(m.paths):new Set;m.paths.length=0;m.portalItem=z.portalItem;var d=new Set(z.resources.toKeep.map(q=>q.resource.path)),g=new Set,A=[];d.forEach(q=>{c.delete(q);m.paths.push(q)});for(const q of z.resources.toUpdate)if(c.delete(q.resource.path),d.has(q.resource.path)||g.has(q.resource.path)){const {resource:y,content:x,finish:D,error:C}=q,B=e.getSiblingOfSameTypeI(y,
w.generateUUID());m.paths.push(B.path);A.push(b({resource:B,content:x,finish:D,error:C},r))}else m.paths.push(q.resource.path),A.push(k(q,r)),g.add(q.resource.path);for(const q of z.resources.toAdd)A.push(b(q,r)),m.paths.push(q.resource.path);c.forEach(q=>{q=z.portalItem.resourceFromPath(q);A.push(q.portalItem.removeResource(q).catch(()=>{}))});if(0!==A.length&&(d=yield t.eachAlways(A),t.throwIfAborted(r),r=d.filter(q=>"error"in q).map(q=>q.error),0<r.length))throw new p("save:resources","Failed to save one or more resources",
{errors:r});}});return n.apply(this,arguments)}function b(m,z){return h.apply(this,arguments)}function h(){h=u._asyncToGenerator(function*(m,z){z=yield f.result(m.resource.portalItem.addResource(m.resource,m.content,z));if(!0===z.ok)m.finish&&m.finish(m.resource);else throw m.error&&m.error(z.error),z.error;});return h.apply(this,arguments)}function k(m,z){return l.apply(this,arguments)}function l(){l=u._asyncToGenerator(function*(m,z){z=yield f.result(m.resource.update(m.content,z));if(!0===z.ok)m.finish(m.resource);
else throw m.error(z.error),z.error;});return l.apply(this,arguments)}a.saveResources=function(m,z,r){return n.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,u,f,p,t,w){function e(){e=u._asyncToGenerator(function*(r,c={},d){yield r.load(d);var g=w.join(r.itemUrl,"resources");const {start:A=
1,num:q=10,sortOrder:y="asc",sortField:x="created"}=c;c={query:{start:A,num:q,sortOrder:y,sortField:x,token:r.apiKey},signal:t.get(d,"signal")};g=yield r.portal._request(g,c);return{total:g.total,nextStart:g.nextStart,resources:g.resources.map(({created:D,size:C,resource:B})=>({created:new Date(D),size:C,resource:r.resourceFromPath(B)}))}});return e.apply(this,arguments)}function n(){n=u._asyncToGenerator(function*(r,c,d,g){if(!r.hasPath())throw new p(`portal-item-resource-${c}:invalid-path`,"Resource does not have a valid path");
const A=r.portalItem;yield A.load(g);c=w.join(A.userItemUrl,"add"===c?"addResources":"updateResources");const [q,y]=k(r.path);d=yield m(d);const x=new FormData;q&&"."!==q&&x.append("resourcesPrefix",q);x.append("fileName",y);x.append("file",d,y);x.append("f","json");t.isSome(g)&&g.access&&x.append("access",g.access);yield A.portal._request(c,{method:"post",body:x,signal:t.get(g,"signal")});return r});return n.apply(this,arguments)}function b(){b=u._asyncToGenerator(function*(r,c,d){if(!c.hasPath())throw new p("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");yield r.load(d);const g=w.join(r.userItemUrl,"removeResources");yield r.portal._request(g,{method:"post",query:{resource:c.path},signal:t.get(d,"signal")});c.portalItem=null});return b.apply(this,arguments)}function h(){h=u._asyncToGenerator(function*(r,c){yield r.load(c);const d=w.join(r.userItemUrl,"removeResources");return r.portal._request(d,{method:"post",query:{deleteAll:!0},signal:t.get(c,"signal")})});return h.apply(this,arguments)}function k(r){const c=
r.lastIndexOf("/");return-1===c?[".",r]:[r.slice(0,c),r.slice(c+1)]}function l(r){{const q=w.getPathExtension(r);r=t.isNone(q)?[r,""]:[r.slice(0,r.length-q.length-1),`.${q}`]}const [c,d]=r,[g,A]=k(c);return[g,A,d]}function m(r){return z.apply(this,arguments)}function z(){z=u._asyncToGenerator(function*(r){return r instanceof Blob?r:(yield f(r.url,{responseType:"blob"})).data});return z.apply(this,arguments)}a.addOrUpdateResource=function(r,c,d,g){return n.apply(this,arguments)};a.contentToBlob=m;
a.fetchResources=function(r){return e.apply(this,arguments)};a.getSiblingOfSameType=function(r,c){if(!r.hasPath())return null;const [d,,g]=l(r.path);return r.portalItem.resourceFromPath(w.join(d,c+g))};a.getSiblingOfSameTypeI=function(r,c){if(!r.hasPath())return null;const [d,,g]=l(r.path);return r.portalItem.resourceFromPath(w.join(d,c+g))};a.removeAllResources=function(r,c){return h.apply(this,arguments)};a.removeResource=function(r,c,d){return b.apply(this,arguments)};a.splitPrefixFileNameAndExtension=
l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,
supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,
supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,
supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),function(a,u,
f,p,t,w,e,n,b){let h=function(){function k(m,z,r,c){this.parsedUrl=m;this.portalItem=z;this.apiKey=r;this.signal=c;this.rootDocument=null;if(m=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:m[1],layerId:parseInt(m[2],10)}}var l=k.prototype;l.fetch=function(){var m=u._asyncToGenerator(function*(){var z;if(!this.urlParts)return null;const r=null!=(z=this.portalItem)?z:yield this.portalItemFromServiceItemId();if(t.isNone(r))return this.loadFromUrl();z=yield this.findAndLoadRelatedPortalItem(r);
return t.isNone(z)?null:this.loadFeatureLayerFromPortalItem(z)});return function(){return m.apply(this,arguments)}}();l.fetchPortalItem=function(){var m=u._asyncToGenerator(function*(){var z;if(!this.urlParts)return null;const r=null!=(z=this.portalItem)?z:yield this.portalItemFromServiceItemId();return t.isNone(r)?null:this.findAndLoadRelatedPortalItem(r)});return function(){return m.apply(this,arguments)}}();l.fetchRootDocument=function(){var m=u._asyncToGenerator(function*(){if(t.isSome(this.rootDocument))return this.rootDocument;
if(t.isNone(this.urlParts))return this.rootDocument={},{};const z={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},r=`${this.urlParts.root}/SceneServer`;try{this.rootDocument=(yield p(r,z)).data}catch{this.rootDocument={}}return this.rootDocument});return function(){return m.apply(this,arguments)}}();l.fetchServiceOwningPortalUrl=function(){var m=u._asyncToGenerator(function*(){var z;const r=null==(z=f.id)?void 0:z.findServerInfo(this.parsedUrl.path);if(null!=r&&r.owningSystemUrl)return r.owningSystemUrl;
z=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const c=(yield p(z,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(c)return c}catch(c){w.throwIfAbortError(c)}return null});return function(){return m.apply(this,arguments)}}();l.findAndLoadRelatedPortalItem=function(){var m=u._asyncToGenerator(function*(z){try{return(yield z.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>"Feature Service"===
r.type)||null}catch(r){return w.throwIfAbortError(r),null}});return function(z){return m.apply(this,arguments)}}();l.loadFeatureLayerFromPortalItem=function(){var m=u._asyncToGenerator(function*(z){yield z.load({signal:this.signal});const r=yield this.findMatchingAssociatedSublayerUrl(z.url);return(new e({url:r,portalItem:z})).load({signal:this.signal})});return function(z){return m.apply(this,arguments)}}();l.loadFromUrl=function(){var m=u._asyncToGenerator(function*(){const z=yield this.findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);
return(new e({url:z})).load({signal:this.signal})});return function(){return m.apply(this,arguments)}}();l.findMatchingAssociatedSublayerUrl=function(){var m=u._asyncToGenerator(function*(z){z=z.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var r={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const c=this.urlParts.layerId;var d=this.fetchRootDocument();r=p(z,r);const [g,A]=yield Promise.all([r,d]);d=A&&A.layers;r=g.data&&g.data.layers;if(!Array.isArray(r))throw Error("expected layers array");
if(!Array.isArray(d)){if(c<r.length)return`${z}/${r[c].id}`}else for(let q=0;q<Math.min(d.length,r.length);q++)if(d[q].id===c)return`${z}/${r[q].id}`;throw Error("could not find matching associated sublayer");});return function(z){return m.apply(this,arguments)}}();l.portalItemFromServiceItemId=function(){var m=u._asyncToGenerator(function*(){var z=(yield this.fetchRootDocument()).serviceItemId;if(!z)return null;z=new b({id:z,apiKey:this.apiKey});const r=yield this.fetchServiceOwningPortalUrl();t.isSome(r)&&
(z.portal=new n({url:r}));try{return z.load({signal:this.signal})}catch(c){return w.throwIfAbortError(c),null}});return function(){return m.apply(this,arguments)}}();return k}();a.FetchAssociatedFeatureLayer=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h){a.I3SNodePageDefinition=function(k){function l(){var m=k.apply(this,arguments)||this;m.nodesPerPage=null;m.rootIndex=0;m.lodSelectionMetricType=null;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);f.__decorate([t.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);f.__decorate([t.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=f.__decorate([h.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(k){function l(){var m=k.apply(this,arguments)||this;m.factor=1;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);f.__decorate([t.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=f.__decorate([h.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(k){function l(){var m=k.apply(this,arguments)||this;m.baseColorFactor=[1,1,1,1];m.baseColorTexture=null;m.metallicRoughnessTexture=null;m.metallicFactor=1;m.roughnessFactor=1;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);f.__decorate([t.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);f.__decorate([t.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);f.__decorate([t.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);f.__decorate([t.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
f.__decorate([h.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(k){function l(){var m=k.apply(this,arguments)||this;m.alphaMode="opaque";m.alphaCutoff=.25;m.doubleSided=!1;m.cullFace="none";m.normalTexture=null;m.occlusionTexture=null;m.emissiveTexture=null;m.emissiveFactor=null;m.pbrMetallicRoughness=null;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([b.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);f.__decorate([t.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);f.__decorate([t.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);f.__decorate([b.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);f.__decorate([t.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
f.__decorate([t.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);f.__decorate([t.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);f.__decorate([t.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);f.__decorate([t.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=f.__decorate([h.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:String,json:{read:{source:["name","index"],reader:(k,l)=>null!=k?k:`${l.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);f.__decorate([b.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=f.__decorate([h.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(k){function l(){var m=k.apply(this,arguments)||this;m.atlas=!1;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);f.__decorate([t.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=f.__decorate([h.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([b.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);f.__decorate([t.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=f.__decorate([h.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([b.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);f.__decorate([t.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=f.__decorate([h.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(k){function l(){var m=k.apply(this,arguments)||this;m.offset=0;return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);f.__decorate([t.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);f.__decorate([t.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=f.__decorate([h.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([b.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);f.__decorate([t.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
f.__decorate([h.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,
p,t,w,e,n,b,h){a.RangeInfo=function(k){function l(){var m=k.apply(this,arguments)||this;m.name=null;m.field=null;m.currentRangeExtent=null;m.fullRangeExtent=null;m.type="rangeInfo";return m}u._inheritsLoose(l,k);return l}(p.JSONSupport);f.__decorate([t.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);f.__decorate([t.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);f.__decorate([t.property({type:[Number],json:{read:!0,write:!0}})],
a.RangeInfo.prototype,"currentRangeExtent",void 0);f.__decorate([t.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);f.__decorate([t.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=f.__decorate([h.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);a.default=a.RangeInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){t=function(m){function z(){var r=m.apply(this,arguments)||this;r.type="feature-3d";r.direct3DObjectFeatureLayerDisplayEnabled=k.enableDirect3DObjectFeatureLayerDisplay();return r}a._inheritsLoose(z,m);z.prototype.initialize=function(){this.layer.infoFor3D&&!this.direct3DObjectFeatureLayerDisplayEnabled&&this.addResolvingPromise(Promise.reject(new f("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${this.layer.geometryType}`)));"mesh"!==this.layer.geometryType||
h.canProjectWithoutEngine(this.layer.spatialReference,this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new f("layerview:spatial-reference-incompatible","The spatial references of the feature layer layer is incompatible with the spatial reference of the view")))};return z}(l);u.__decorate([p.property({constructOnly:!0})],t.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);u.__decorate([p.property()],t.prototype,"layer",void 0);return t=u.__decorate([b.subclass("esri.views.3d.layers.FeatureLayerView3D")],
t)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){e=function(D){function C(v){v=D.call(this,v)||this;v._controllerTotal=0;v._graphicsCoreTotal=0;v.suspendResumeExtentMode="data";return v}a._inheritsLoose(C,D);var B=C.prototype;B.initialize=function(){this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged())};B.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};B.fetchPopupFeatures=function(){var v=a._asyncToGenerator(function*(E,
F){return(E=this.validateFetchPopupFeatures(F))?Promise.reject(E):this.fetchClientPopupFeatures(F)});return function(E,F){return v.apply(this,arguments)}}();B.setVisibility=function(v,E){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(v,E)};B.createQuery=function(){return D.prototype.createQuery.call(this)};B.queryFeatures=function(v,E){const F=()=>D.prototype.queryFeatures.call(this,v,E);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(v),F):F()};
B.beforeSetController=function(v){v.maximumNumberOfFeatures=this.maximumNumberOfFeatures};B.createController=function(){this.fetcherContext=new c.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const v=new m.FeatureTileController3D({layerView:this,context:this.fetcherContext,graphics:new d.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(v,"serviceDataExtent",E=>{this.graphics3d&&(this.graphics3d.dataExtent=E)},2);this.handles.add(t.init(this,
"suspended",E=>{E?v.suspend():v.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",()=>this.updateDisplayFeatureLimit(v),2);this.handles.add([this.view.resourceController.memoryController.events.on("quality-changed",()=>this.updateDisplayFeatureLimit()),t.whenFalse(this,"updating",()=>{this._graphicsCoreTotal=this._controllerTotal=0;this.notifyChange("updatingProgressValue")})]);return v};B.doRefresh=function(){var v=a._asyncToGenerator(function*(){!this.suspended&&
this.controller&&this.controller.refetch()});return function(){return v.apply(this,arguments)}}();B.getUsedMemory=function(){const v=this.graphics3d&&this.graphics3d.graphicsCore;return(v?v.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};B.getUnloadedMemory=function(){const v=this.graphics3d&&this.graphics3d.graphicsCore;return(v?v.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*v.usedMemoryPerGraphic:0)};B.ignoresMemoryFactor=function(){return this.controller&&
this.controller.hasMaximumNumberOfFeaturesOverride};B.updateDisplayFeatureLimit=function(v=this.controller){if(v&&this.graphics3d&&this.graphics3d.graphicsCore){var E=this.graphics3d.graphicsCore.displayFeatureLimit,F=this.view.resourceController.memoryController.memoryFactor;v.displayFeatureLimit=1===F?E:{...E,maximumNumberOfFeatures:Math.ceil(E.maximumNumberOfFeatures*F),maximumTotalNumberOfFeatures:Math.ceil(E.maximumTotalNumberOfFeatures*F),minimumTotalNumberOfFeatures:Math.ceil(E.minimumTotalNumberOfFeatures*
F)}}};B._queryFeaturesMesh=function(){var v=a._asyncToGenerator(function*(E,F){yield this._validateQueryFeaturesMesh(E);F=yield F();if(E&&E.outStatistics)return F;E=this.layer.objectIdField;const L=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,N=[];for(const I of F.features)if(I.geometry){const G=L.get(I.attributes[E]);G&&(I.geometry=l.hydrateGeometry(G.graphic.geometry),N.push(I))}else N.push(I);F.features=N;return F});return function(E,F){return v.apply(this,arguments)}}();B._validateQueryFeaturesMesh=
function(){var v=a._asyncToGenerator(function*(E){if(E){var F=N=>{throw new f("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${N}'`);},L=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const N of L)null!=E[N]&&F(N);"returnM"in E&&E.returnM&&F("returnM");"returnCentroid"in E&&E.returnCentroid&&F("returnCentroid");p.isSome(E.outSpatialReference)&&!E.outSpatialReference.equals(this.view.spatialReference)&&F("outSpatialReference")}});
return function(E){return v.apply(this,arguments)}}();a._createClass(C,[{key:"maximumNumberOfFeatures",get:function(){var v,E;return null!=(v=null==(E=this.controller)?void 0:E.maximumNumberOfFeatures)?v:this._get("maximumNumberOfFeatures")},set:function(v){this._set("maximumNumberOfFeatures",v);this.controller&&(this.controller.maximumNumberOfFeatures=v)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1}},{key:"updatingProgressValue",get:function(){var v,E,F;let L=0;if(null!=(v=this.controller)&&v.updating){v=this.controller.updatingRemaining;const N=Math.max(this.controller.updatingTotal,this._controllerTotal);0<N&&(L=(N-v)/N,this._controllerTotal=N)}v=0;null!=(E=this.graphics3d)&&null!=(F=E.graphicsCore)&&F.updating&&(E=this.graphics3d.graphicsCore.updatingRemaining,F=Math.max(E,this._graphicsCoreTotal),0<F&&(v=(F-E)/F,this._graphicsCoreTotal=F));return.5*(L+v)}},{key:"updatePolicy",get:function(){if(!this.controller)return 0;
switch(this.controller.mode){case "snapshot":{const v=x[this.layer.geometryType];return null==v||this.controller.serviceDataCount>v?0:1}case "tiles":return 0}}},{key:"hasZ",get:function(){const v=this.layer,E=v.capabilities&&v.capabilities.data;return E&&E.supportsZ?"returnZ"in v&&null!=v.returnZ?v.returnZ:E.supportsZ:!1}},{key:"hasM",get:function(){const v=this.layer,E=v.capabilities&&v.capabilities.data;return E&&E.supportsM?"returnM"in v&&null!=v.returnM?v.returnM:!1:!1}},{key:"performanceInfo",
get:function(){var v=this.controller&&this.controller.displayFeatureLimit;v=p.isSome(v)&&v.averageSymbolComplexity;v=p.isSome(v)?`f:${v.primitivesPerFeature},v:${v.primitivesPerCoordinate}`:"n/a";v={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:v,nodes:this.controller?this.controller.tileDescriptors.length:0};if(this.controller&&v.displayedNumberOfFeatures){const E=this.controller.debug;
v.storedFeatures=E.storedFeatures;v.totalVertices=E.totalVertices}return v}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller}}}]);return C}(y.RefreshableLayerView(z.FeatureLikeLayerView3D(A.FeatureLayerView(r.LayerView3D(q)))));u.__decorate([w.property()],e.prototype,"layer",void 0);u.__decorate([w.property()],e.prototype,"controller",void 0);u.__decorate([w.property()],e.prototype,"maximumNumberOfFeatures",null);u.__decorate([w.property()],e.prototype,
"maximumNumberOfFeaturesExceeded",null);u.__decorate([w.property(g.updatingProgress)],e.prototype,"updatingProgress",void 0);u.__decorate([w.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining"]})],e.prototype,"updatingProgressValue",null);u.__decorate([w.property({readOnly:!0})],e.prototype,"updatePolicy",null);u.__decorate([w.property({readOnly:!0})],e.prototype,"hasZ",null);u.__decorate([w.property({readOnly:!0})],
e.prototype,"hasM",null);u.__decorate([w.property()],e.prototype,"suspendResumeExtentMode",void 0);e=u.__decorate([k.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],e);const x={point:5E3,polygon:500,polyline:1E3};return e})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v){function E(L,N){if(!N)return!1;for(const I of N)if(!L.has(I))return!0;return!1}const F=k.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");a.FeatureTileController3D=function(L){function N(G){G=L.call(this,G)||this;G.type="feature-tile-3d";G.watchUpdatingTracking=new v.WatchUpdatingTracking;G.serviceDataExtent=null;G.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;G.vertexLimitExceeded=!1;G.displayFeatureLimit=
null;G.suspended=!1;G.tileFetcher=null;G.handles=new b;G.fetchDataInfoPromise=null;G.fetchDataInfoAbortController=null;G.lifeCycleAbortController=z.createAbortController();return G}u._inheritsLoose(N,L);var I=N.prototype;I.approximateExtentSizeAtScale=function(G,K){const H=this.layerView.view,J=K.levels[0];return(J.tileSize[0]/(J.scale/G)+J.tileSize[1]/(J.scale/G))/2*Math.ceil((H.width/K.pixelSize+H.height/K.pixelSize)/2)};I.initialize=function(){this.watchUpdatingTracking.add(this,"vertexLimitInfo",
()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(this,"mode",()=>this.modeChanged(),2);this.addResolvingPromise(Promise.resolve().then(()=>this.verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo())).then(()=>this.initializeTileFetcher()))};I.verifyCapabilities=function(){const G=this.layerView.layer;if(!G.get("capabilities.operations.supportsQuery"))throw new n("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:G});};I.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher=l.destroyMaybe(this.tileFetcher);this.handles=l.destroyMaybe(this.handles);this.tilesHandle=l.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};I.suspend=function(){this.suspended||(this.suspended=
!0,l.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};I.resume=function(){this.suspended&&(this.suspended=!1,l.isSome(this.tileFetcher)&&this.tileFetcher.resume())};I.restart=function(){const G=()=>{l.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(G,G))};I.refetch=function(){const G=()=>{l.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(G,
G))};I.initializeTileFetcher=function(){const G=this.layerView.view;if(G){var K=r.whenOnce(G.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(K);K.then(()=>{const {layerView:H,tileDescriptors:J}=this,M=H.layer,O=new D.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:J,features:this.graphics});this.tileFetcher=O;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();var Q=this.layerView.view.resourceController;
Q&&(this.handles.add(Q.memoryController.events.on("quality-changed",S=>{O.memoryFactor=S})),this.tileFetcher.memoryFactor=Q.memoryController.memoryFactor);(Q="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null)&&this.handles.add(r.init(this.layerView.view,"qualitySettings.graphics3D."+Q,S=>{O.lodFactor=S||1}));this.watchUpdatingTracking.add(M,"createQueryVersion",()=>this.dataFilterChanged());this.watchUpdatingTracking.add(H,"availableFields",
(S,V)=>this.availableFieldsChanged(V,S));this.watchUpdatingTracking.add(H,"requiredFields",(S,V)=>this.requiredFieldsChanged(V,S));this.handles.add([M.on("apply-edits",S=>this.applyEdits(S)),this.watch("extent",S=>O.filterExtent=S,!0),this.watch("tileDescriptors",S=>O.tileDescriptors=S,!0),r.init(this,"maximumNumberOfFeatures",S=>{O.maximumNumberOfFeatures=S;O.useTileCount=this.serviceDataCount>S},!0),r.init(this,"serviceDataCount",S=>O.useTileCount=S>this.maximumNumberOfFeatures,!0),r.init(B,"FEATURE_TILE_FETCH_SHOW_TILES",
S=>{S&&O&&!O.debugger?(O.debugger=new C.FeatureTileFetcher3DDebugger(O,G.featureTiles.tilingScheme.toTileInfo(),G),O.debugger.update()):!S&&this.tileFetcher&&O.debugger&&(O.debugger.destroy(),O.debugger=null)})]);this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(this,"maxTotalSnapshotVertices",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};I.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||
(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:F.warn("Unhandled feature layer mode "+this.mode);case "snapshot":l.isSome(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}};I.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};I.applyEdits=function(G){l.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(G).then(K=>{K&&(K.deletedFeatures.length||K.updatedFeatures.length||
K.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this.updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(K=>{if(!z.isAbortError(K))throw K;})};I.availableFieldsChanged=function(G,K){l.isSome(this.tileFetcher)&&E(this.tileFetcher.availableFields,K)&&this.refetch()};I.requiredFieldsChanged=function(G,K){l.isSome(this.tileFetcher)&&E(this.tileFetcher.availableFields,K)&&this.restart()};I.createVertexLimitExceededQuery=function(G){const K=this.layerView.layer,H=K.createQuery();
H.outStatistics=[new x({statisticType:"exceedslimit",maxVertexCount:G,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];K.capabilities.query.supportsCacheHint&&(H.cacheHint=!0);return H};I.createDataInfoQuery=function(){const G=this.layerView.layer,K=G.createQuery();K.outSpatialReference=this.layerView.view.spatialReference;G.capabilities.query.supportsCacheHint&&(K.cacheHint=!0);return K};I.fullExtentIsAccurate=function(){const G=this.layerView.layer;if(G.definitionExpression)return!1;
switch(G.type){case "feature":return q.isHostedAgolService(G.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};I.updateServiceDataExtent=function(){var G=u._asyncToGenerator(function*(K){try{yield this.tryUpdateServiceDataExtent(K)}catch(H){z.isAbortError(H)||this._set("serviceDataExtent",h.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});return function(K){return G.apply(this,arguments)}}();I.tryUpdateServiceDataExtent=function(){var G=u._asyncToGenerator(function*(K){var H=
this.layerView;const J=H.layer,M=J.capabilities.query.supportsExtent,O=h.clone(H.fullExtentInLocalViewSpatialReference),Q=J.fullExtent,S=this.fullExtentIsAccurate(),V=this.serviceDataCount;M&&V<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!O||!S)&&"queryExtent"in J?(H=this.createDataInfoQuery(),K=yield J.queryExtent(H,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:K}),this._set("serviceDataExtent",K.extent)):O?this._set("serviceDataExtent",O):Q?(K=yield y.projectGeometry(Q,
H.view.spatialReference,"portalItem"in J?J.portalItem:null,K),this._set("serviceDataExtent",K)):this._set("serviceDataExtent",null)});return function(K){return G.apply(this,arguments)}}();I.updateServiceDataCount=function(){var G=u._asyncToGenerator(function*(K){const H=this.layerView.layer;if("queryFeatureCount"in H)if(K=yield t.result(H.queryFeatureCount(this.createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:K})),!0===K.ok)this._set("serviceDataCount",
K.value);else{if(z.isAbortError(K.error))throw K.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});return function(K){return G.apply(this,arguments)}}();I.updateVertexLimitExceeded=function(){var G=u._asyncToGenerator(function*(K,H){var J=this.vertexLimitInfo;if(l.isNone(J))this._set("vertexLimitExceeded",!1);else{var M=1<this.minimumNumberOfVerticesForGeometry;
if(0>=J.primitivesPerFeature||M){var {primitivesPerFeature:O,primitivesPerCoordinate:Q,maximumTotalNumberOfPrimitives:S}=J;0!==O&&l.isSome(K)&&(yield K);J=this.serviceDataCount;var V=J!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;K=V?Math.ceil((S-J*O)/(Q||1)):Math.ceil(S/(Q||1));M&&(K=Math.min(K,5E6));if(V&&this.minimumNumberOfVerticesForGeometry*J>K)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(H=yield t.result(this.layerView.layer.queryFeatures(this.createVertexLimitExceededQuery(K),
{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:H})),!1===H.ok){if(z.isAbortError(H.error))throw H.error;this._set("vertexLimitExceeded",!1)}else(H=H.value.features[0])&&H.attributes?this._set("vertexLimitExceeded",!!H.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>K)}else this._set("vertexLimitExceeded",!1)}});return function(K,H){return G.apply(this,arguments)}}();I.fetchServiceDataInfo=
function(){var G=u._asyncToGenerator(function*(){this.cancelFetchServiceDataInfo();let K=z.createAbortController();const H=K.signal;var J=this.updateServiceDataCount(H);J=z.eachAlways([J,this.updateVertexLimitExceeded(J,H)]);const M=J.then(()=>this.updateServiceDataExtent(H)).catch(O=>{z.isAbortError(O)||F.error("#fetchServiceDataInfo()",O)}).then(()=>{M===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);K=null});K&&(this.fetchDataInfoPromise=M);this.fetchDataInfoAbortController=
K;return J.then(()=>{},()=>{})});return function(){return G.apply(this,arguments)}}();I.cancelFetchServiceDataInfo=function(){const G=this.fetchDataInfoAbortController;G&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,G.abort())};u._createClass(N,[{key:"extent",set:function(G){if(G&&!G.spatialReference.equals(this.layerView.view.spatialReference))F.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var K=this._get("extent");K===G||K&&G&&K.equals(G)||
(G=G?G.clone():null,this._set("extent",G))}}},{key:"updating",get:function(){return!!(l.isSome(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&l.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&
l.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&l.isSome(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return l.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!l.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return l.isSome(this.displayFeatureLimit)?
this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(G){G!==this.maximumNumberOfFeatures&&(null==G?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",G))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var G=this.layerView.layer;if("feature"===G.type&&l.isSome(G.infoFor3D))return"snapshot";if(this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||
this.vertexLimitExceeded)return"tiles";var K=this.layerView.view;K=(K=K&&K.featureTiles)&&K.tilingScheme;return G&&G.minScale&&this.serviceDataExtent&&K&&(G=this.approximateExtentSizeAtScale(G.minScale,K),(this.serviceDataExtent.width/G+this.serviceDataExtent.height/G)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const G=
this._get("maxTotalSnapshotVertices")||0,K="snapshot"===this.mode&&l.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(G,K)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new w([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new w}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(l.isNone(this.displayFeatureLimit)||
l.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:G,maximumTotalNumberOfPrimitives:K}=this.displayFeatureLimit,{primitivesPerCoordinate:H,primitivesPerFeature:J}=G,M=this._get("vertexLimitInfo");return l.isNone(M)||M.maximumTotalNumberOfPrimitives!==K||M.primitivesPerCoordinate!==H||M.primitivesPerFeature!==J?{primitivesPerCoordinate:H,primitivesPerFeature:J,maximumTotalNumberOfPrimitives:K}:M}},{key:"supportsExceedsLimitQuery",get:function(){const G=
this.layerView.layer;return G.capabilities&&G.capabilities.operations&&G.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:l.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:l.isSome(this.tileFetcher)?
this.tileFetcher.totalFeatures:0,totalVertices:l.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return N}(m.EsriPromiseMixin(p));f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);f.__decorate([c.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);f.__decorate([c.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);f.__decorate([c.property({constructOnly:!0})],a.FeatureTileController3D.prototype,
"context",void 0);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"extent",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"updating",null);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"watchUpdatingTracking",void 0);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,
"expectedFeatureDiff",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,
"vertexLimitExceeded",void 0);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);f.__decorate([c.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);f.__decorate([c.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,
"tileDescriptors",null);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"tileFetcher",void 0);f.__decorate([c.property()],a.FeatureTileController3D.prototype,"fetchDataInfoPromise",void 0);f.__decorate([c.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=f.__decorate([A.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(L){L.NO_SERVICE_DATA_COUNT=
Infinity;L.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;L.reset=function(){L.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;L.QUERY_STATISTICS_TIMEOUT=12E3;L.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C){function B(K){return"dummy-tile-full-extent"===K.id}function v(K){let H=0;for(const J of K)J.features&&0<J.features.length&&J.alive&&(H=Math.max(H,J.descriptor.lij[0]));return H}function E(K){K.setFeatures([],0,null);K.featuresMissing=!1;return 4}function F(K){return n.isNone(K)?new Set:new Set(K.map(H=>H.name))}function L(K,H){if(n.isNone(K)||n.isNone(H))return F(H);const J=new Set;for(const {name:M}of H)K.has(M)&&J.add(M);return J}const N=
w.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(K){function H(M){M=K.call(this,M)||this;M._useTileCount=!1;M.updating=!1;M.updatingTotal=0;M.updatingRemaining=0;M.expectedFeatureDiff=0;M.maximumNumberOfFeaturesExceeded=!1;M.maximumNumberOfFeaturesExceededThrottle=1E3;M._fullRatio=1;M._farRatio=1;M.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};M.handles=new t;M._frameTask=C.ImmediateTask;M._dirty=!1;M.featureTiles=new Map;M.displayingFeatureReferences=
new Map;M.numDisplayingFeatureReferences=0;M.suspended=!0;M.pendingEdits=null;return M}u._inheritsLoose(H,K);var J=H.prototype;J.initialize=function(){this.handles.add(k.on(this,"tileDescriptors","change",()=>this.setDirty(),()=>this.setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?y.MultiFeatureReference:y.SingleFeatureReference;const M=this.context.scheduler;n.isSome(M)&&(this._frameTask=M.registerTask(C.TaskPriority.FEATURE_TILE_FETCHER,
this));this.setDirty()};J.destroy=function(){this._frameTask.remove();this.handles=n.destroyMaybe(this.handles);this.featureTiles.forEach(M=>{this.cancelFetchTile(M);this.removeTile(M)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};J.restart=function(){this.featureTiles.forEach(M=>{this.cancelFetchTile(M);this.clearTile(M);this.resetFetchTile(M)});n.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();
this.setDirty()};J.refetch=function(){this.featureTiles.forEach(M=>{this.cancelFetchTile(M);this.resetFetchTile(M)});n.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};J.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};J.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};J.pause=function(){this.paused&&(this.featureTiles.forEach(M=>this.cancelFetchTile(M)),this.updated())};J.unpause=function(){this.paused||(this.setDirty(),
this.updated())};J.applyEdits=function(M){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:b.createAbortController()},this.pause());const O=this.pendingEdits;O.count++;const Q=O.edits.then(()=>M.result.catch(S=>{if(b.isAbortError(S))throw S;return null}).then(S=>{if(!S)return S;this.applyEditsDeleteFeatures(S.deletedFeatures);return this.applyEditsAddUpdateFeatures(S.addedFeatures,S.updatedFeatures,O.controller.signal).then(()=>S)}).then(S=>{0===--O.count&&(this.pendingEdits===
O&&(this.pendingEdits=null),n.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.unpause(),this.updated());return S}));O.edits=Q;this.updated();return Q};J.applyEditsDeleteFeatures=function(M){if(0!==M.length){var O=this.context.globalIdField,Q=O&&this.availableFields.has(O),S=new Set,V=this.objectIdField;M.forEach(({objectId:Y,globalId:W})=>{(!Y||0>Y)&&O?(Q||N.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${O} to be included the layer's outFields for updates to be reflected in the view`),
(Y=this.features.find(ba=>ba.attributes&&ba.attributes[O]===W))&&S.add(g.getObjectId(Y,V))):S.add(Y)});this.featureTiles.forEach(Y=>{if(Y.features){var W=Y.features.filter(ba=>!S.has(g.getObjectId(ba,this.objectIdField)));W.length!==Y.features.length&&(Y.setFeatures(W,0,Y.availableFields),this.invalidateCounts())}})}};J.applyEditsAddUpdateFeatures=function(){var M=u._asyncToGenerator(function*(O,Q,S){const V=[],Y=new Set;O.forEach(ba=>V.push(ba.objectId));Q.forEach(ba=>{V.push(ba.objectId);Y.add(ba.objectId)});
if(0!==V.length){var W=[];this.featureTiles.forEach(ba=>{(ba=this.applyEditsAddUpdateTile(ba,V,Y,S))&&W.push(ba)});yield b.eachAlways(W)}});return function(O,Q,S){return M.apply(this,arguments)}}();J.applyEditsAddUpdateTile=function(){var M=u._asyncToGenerator(function*(O,Q,S,V){if(O.features){var Y=this.createQuery(O);Y.resultType=void 0;Y.cacheHint=!1;Y.objectIds=Q;Q=yield this.queryFeatures(Y,V);V=null;0<S.size&&(Y=O.features.filter(W=>!S.has(g.getObjectId(W,this.objectIdField))),Y.length!==O.features.length&&
(V=Y));if(0<Q.features.length){V||(V=O.features.slice());for(const W of Q.features)V.push(W)}V&&(O.hasPreciseFeatureCount&&(O.numFeatures=Math.max(O.numFeatures,V.length)),O.setFeatures(V,0,L(O.availableFields,Q.fields)),this.invalidateCounts())}});return function(O,Q,S,V){return M.apply(this,arguments)}}();J.queryFeatures=function(M,O){return this.context.query.queryFeaturesDehydrated(M,{signal:O,timeout:6E5})};J.setDirty=function(){this._dirty=!0;this.updated()};J.runTask=function(M){this._frameTask.processQueue(M);
if(this._dirty&&this.constructed){this._dirty=!1;var O=this.getListOfTiles();this.markTilesNotAlive(O);if(M.run(()=>this.addTiles(O,M))&&M.run(()=>this.filterExtentTiles(O,M))&&M.run(()=>this.removeTiles(O,M))&&!M.done){var Q=this.sortTiles(O);M.run(()=>this.displayTiles(Q,M))&&M.run(()=>this.fetchTiles(Q,M))&&M.run(()=>this.updateMemoryEstimates(Q,M))||this.setDirty();this.updated();this.updating||this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}};J.markTilesNotAlive=function(M){for(const O of M)O.alive=
!1};J.addTiles=function(M,O){if(this.suspended)return!1;this.tileDescriptors.forEach(Q=>{const S=this.featureTiles.get(Q.id);S?S.alive=!0:O.done||(M.push(this.addTile(Q)),O.madeProgress())});return O.hasProgressed};J.filterExtentTiles=function(M,O){for(const Q of M){if(O.done)break;Q.alive&&(Q.filtered=!Q.intersects(this.filterExtent),Q.filtered&&(this.clearTile(Q),O.madeProgress()))}return O.hasProgressed};J.removeTiles=function(M,O){for(let Q=M.length-1;0<=Q&&!O.done;Q--){const S=M[Q];S.alive||
(this.removeTile(S),Q!==M.length-1&&(M[Q]=M[M.length-1]),M.pop(),O.madeProgress())}return O.hasProgressed};J.sortTiles=function(M){M.sort((O,Q)=>O.descriptor.loadPriority-Q.descriptor.loadPriority);return M};J.displayTiles=function(M,O){const Q=this.updateRatio(M),S=V=>{const Y=1>this._fullRatio?Q(V)*this._farRatio:1;V.reduceFeatures(Y,this.memoryFactor,this.objectIdField)&&this.setDirty();return this.showTile(V)};for(const V of M)if(!O.run(()=>S(V))){this.setDirty();break}return O.hasProgressed};
J.fetchTiles=function(M,O){if(this.paused)return!1;var Q=!1;for(const V of M)if(V.needsFetching){var S=n.isSome(this.context.memoryCache)?this.context.memoryCache.pop(V.id):null;if(n.isSome(S))V.cache=S,this.setDirty(),this.scheduleUpdated(),O.madeProgress();else if(this.needsNumFeatures(V)&&(Q=b.createAbortController(),S=this.fetchTileCount(V,Q.signal),this._handleRequest(V,S,Q,()=>V.numFeatures=x.FAILED_FEATURE_COUNT),Q=!0,O.madeProgress()),O.done)return!0}if(Q)return O.hasProgressed;for(const V of M)if(V.needsFetching&&
(M=b.createAbortController(),Q=this.fetchTile(V,M.signal),this._handleRequest(V,Q,M,Y=>{V.setFeatures([],0,null);this.invalidateCounts();V.featuresMissing=!1;this.context.logFetchError(N,Y)}),O.madeProgress(),O.done))return!0;return O.hasProgressed};J.updateMemoryEstimates=function(M,O){M.some(Q=>O.run(()=>Q.updateMemoryEstimates())?!1:(this.setDirty(),!0));return O.hasProgressed};J.reclip=function(M,O){if(this.constructed){var Q=[];this.featureTiles.forEach(S=>{n.isNone(S.displayingFeatures)||0===
S.displayingFeatures.length||(S.intersectionIncludingBorrowed(O,I),S.intersectionIncludingBorrowed(M,G),d.equals(I,G)||Q.push(S))});this.refreshDisplayingFeatures(Q);this.updated()}};J.refreshDisplayingFeatures=function(M){const O=new Set,Q=this.changes.updates;for(const S of M)if(!n.isNone(S.displayingFeatures))for(const V of S.displayingFeatures)M=g.getObjectId(V,this.objectIdField),O.has(M)||(O.add(M),{feature:M}=this.displayingFeatureReferences.get(M),Q.removes.push(M),Q.adds.push(M));this.applyChanges()};
J.updated=function(){let M=0;this.paused||this.featureTiles.forEach(Q=>Q.isFetching?++M:0);var O=this._dirty||0<M||!!this.pendingEdits;this._set("updating",O);if(O){let Q=0,S=0,V=0,Y=0,W=0;const ba=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(da=>{++S;if(da.isFetching&&da.hasPreciseFeatureCount){const ha=this.maximumFeaturesForTile(da)*(1-da.emptyFeatureRatio),fa=n.isSome(da.displayingFeatures)?da.displayingFeatures.length*ba:0;W+=ha-fa}da.needsFetching?
++Y:0<da.numFeatures&&(++V,Q+=da.numFeatures)});Y+=M;let ca=O=0;Q?(ca=Q,O=Math.min(Y*Q/V,Q)):(ca=S,O=Y);W=Math.min(this.maximumNumberOfFeatures-this.features.length,W);this._set("updatingTotal",ca);this._set("updatingRemaining",O);this._set("expectedFeatureDiff",W)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};J.updateMaximumNumberOfFeaturesExceeded=function(){const M=e.someMap(this.featureTiles,O=>O.perTileMaximumNumberOfFeaturesExceeded);
this._set("maximumNumberOfFeaturesExceeded",M)};J.updateRatio=function(M){const O=v(M),Q=Y=>1/(1<<Math.max(0,O-Y.descriptor.lij[0]));let S=0,V=0;for(const Y of M)M=Y.numFeatures,S+=M,V+=M*Q(Y);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/S);this._farRatio=this.maximumNumberOfFeatures/V;this.scheduleUpdated();return Q};J.maximumFeaturesUpdated=function(M,O){M!==O&&(O>M&&this.featureTiles.forEach(Q=>{if(Q.featuresMissing){var S=this.maximumFeaturesForTile(Q);Q.features&&(Q.features.length>=
S||5===Q.fetchStatus)||(this.cancelFetchTile(Q),this.resetFetchTile(Q))}}),this.setDirty())};J.addTile=function(M){M=new x.FeatureTile(M);this.featureTiles.set(M.id,M);this.resetFetchTile(M);this.referenceDisplayingFeaturesFromRelatedTiles(M);return M};J.referenceDisplayingFeaturesFromRelatedTiles=function(M){const O=M.descriptor.resolution;this.featureTiles.forEach(Q=>{if(!(n.isNone(Q.displayingFeatures)||M===Q||M.descriptor.lij&&Q.descriptor.lij&&!D.tilesAreRelated(M.descriptor.lij,Q.descriptor.lij))){n.isNone(M.displayingFeatures)&&
(M.displayingFeatures=[]);M.descriptor.extent&&Q.descriptor.extent&&(n.isNone(M.extentIncludingBorrowedFeatures)&&(M.extentIncludingBorrowedFeatures=d.clone(M.descriptor.extent)),d.expand(M.extentIncludingBorrowedFeatures,Q.descriptor.extent,M.extentIncludingBorrowedFeatures));for(const S of Q.displayingFeatures)M.displayingFeatures.push(S),Q=this.displayingFeatureReferences.get(g.getObjectId(S,this.objectIdField)),Q.ref(Q.feature,O),this.numDisplayingFeatureReferences++}});M.featureLimit=n.isSome(M.displayingFeatures)?
M.displayingFeatures.length:0};J.removeTile=function(M){this.clearTile(M);this.featureTiles.delete(M.id)};J.resetFetchTile=function(M){M.filtered=!M.intersects(this.filterExtent);M.filtered?M.needsFetching&&(M.fetchStatus=4):M.fetchStatus=0};J.cancelFetchTile=function(M){const O=M.requestController;n.isSome(O)&&(M.requestController=null,M.resetFetching(),O.abort())};J.fetchTileCount=function(){var M=u._asyncToGenerator(function*(O,Q){O.numFeatures=yield this.fetchCount(O,Q);this.updateRatio(this.getListOfTiles());
return 3===O.fetchStatus?1:0});return function(O,Q){return M.apply(this,arguments)}}();J.fetchTile=function(){var M=u._asyncToGenerator(function*(O,Q){var S=this.maximumFeaturesForTile(O);if(0>=S)return E(O);const V=this.getMaxRecordCount(O);var Y=Math.ceil(S/V);if(B(O)||!this.context.capabilities.supportsMaxRecordCountFactor||O.numFeatures<=S&&Y>q.MAX_MAX_RECORD_COUNT_FACTOR)return this.fetchPagedTile(O,Q);Y=this.createQuery(O);Y.maxRecordCountFactor=Math.ceil(S/V);O.isRefetching&&O.features&&0<
O.features.length&&(Y.maxRecordCountFactor=Math.max(Math.ceil(O.features.length/(1-O.emptyFeatureRatio)/V)+1,Y.maxRecordCountFactor));const {features:W,exceededTransferLimit:ba,fields:ca}=yield this.queryFeatures(Y,Q);S=ba?Y.maxRecordCountFactor>=q.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5;yield this._frameTask.schedule(()=>{O.featuresMissing=W.length<O.numFeatures||ba;const da=this._removeEmptyFeatures(W);O.setFeatures(W,da,F(ca))},Q);this.invalidateCounts();return S});return function(O,Q){return M.apply(this,
arguments)}}();J.fetchCount=function(){var M=u._asyncToGenerator(function*(O,Q){return this.context.query.queryFeatureCount(this.createFeatureCountQuery(O),{signal:Q})});return function(O,Q){return M.apply(this,arguments)}}();J.fetchPagedTile=function(){var M=u._asyncToGenerator(function*(O,Q){let S=0,V=0,Y,W=0,ba=this.maximumFeaturesForTile(O)-W;const ca=this.getMaxRecordCount(O);let da=null;for(;;){const ha=this.createQuery(O),fa=this.setPagingParameters(ha,S,ba,ca),{features:R,exceededTransferLimit:U,
fields:Z}=yield this.queryFeatures(ha,Q);yield this._frameTask.schedule(()=>{fa&&(S+=n.unwrap(ha.num));W+=R.length;V+=this._removeEmptyFeatures(R);O.featuresMissing=S<O.numFeatures||U;Y=Y?Y.concat(R):R;da=L(da,Z);O.setFeatures(Y,V,da)},Q);this.invalidateCounts();this.setDirty();ba=this.maximumFeaturesForTile(O)-W;if(!fa||!U||0>=ba)return U?4:5}});return function(O,Q){return M.apply(this,arguments)}}();J.createFeatureCountQuery=function(M){M=this.createQuery(M);this.context.capabilities.supportsCacheHint&&
(M.resultType=void 0,M.cacheHint=!0);return M};J.createQuery=function(M){const O=this.context.createQuery(),Q=M.descriptor.extent;Q&&(O.geometry=d.toExtent(Q,this.context.tilingScheme.spatialReference));this.setResolutionParams(O,M);this.useTileQuery(M)?O.resultType="tile":this.context.capabilities.supportsCacheHint&&(O.cacheHint=!0);return O};J.setPagingParameters=function(M,O,Q,S){if(!this.context.capabilities.supportsPagination)return!1;M.start=O;0<Q&&this.context.capabilities.supportsMaxRecordCountFactor?
(M.maxRecordCountFactor=Math.ceil(Q/S),M.num=Math.min(M.maxRecordCountFactor*S,Q)):M.num=Math.min(S);return!0};J.getEffectiveTileResolution=function(M){if(null==M.descriptor.resolution)return null;const O=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(M.descriptor.resolution,O)/this.lodFactor};J.setResolutionParams=function(M,O){this.supportsResolution&&(O=this.getEffectiveTileResolution(O),null!=O&&(this.context.capabilities.supportsQuantization?
M.quantizationParameters=new A({mode:"view",originPosition:"upper-left",tolerance:O,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(M.maxAllowableOffset=O)))};J._removeEmptyFeatures=function(M){const O=M.length;for(let Q=0;Q<M.length;)g.hasVertices(M[Q].geometry)?++Q:(M[Q]=M[M.length-1],--M.length);return O-M.length};J.needsNumFeatures=function(M){return this.useTileCount&&M.needsFeatureCount&&!B(M)};J.getMaxRecordCount=function(M){const {tileMaxRecordCount:O,maxRecordCount:Q}=
this.context;return this.useTileQuery(M)&&n.isSome(O)&&0<O&&this.context.capabilities.supportsResultType?O:n.isSome(Q)&&0<Q?Q:2E3};J.useTileQuery=function(M){return B(M)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};J._handleRequest=function(M,O,Q,S){M.fetchStatus=M.needsRefetching?3:2;M.requestController=Q;let V=!1;O.then(Y=>{M.requestController=null;M.fetchStatus=Y}).catch(Y=>{M.requestController===Q&&(M.requestController=null,M.fetchStatus=4);b.isAbortError(Y)?
V=!0:S(Y)}).then(()=>{V||this.setDirty();this.scheduleUpdated()})};J.scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(h.schedule(()=>{this.handles.remove("scheduleUpdated");this.updated()}),"scheduleUpdated")};J.showTile=function(M){if(n.isSome(M.displayingFeatures)&&!M.needsDisplayUpdate)return!1;var O=M.features;if(0===M.featureLimit||!O)return O=n.isSome(M.displayingFeatures)&&0<M.displayingFeatures.length,this.hideTileFeatures(M),M.displayingFeatures=
[],O;const Q=M.descriptor.resolution,S=this.changes.updates,V=this.changes.adds,Y=Math.min(M.featureLimit,O.length);M.featureLimit=Y;for(let ba=0;ba<Y;++ba){var W=O[ba];const ca=g.getObjectId(W,this.objectIdField),da=this.displayingFeatureReferences.get(ca);da?(W=da.ref(W,Q),W.oldVersion!==W.newVersion&&(S.removes.push(W.oldVersion),S.adds.push(W.newVersion))):(this.displayingFeatureReferences.set(ca,new this.FeatureReferenceClass(W,Q)),V.push(W));this.numDisplayingFeatureReferences++}this.hideTileFeatures(M);
this.applyChanges();M.displayingFeatures=O.slice(0,Y);return!0};J.hideTile=function(M){this.cancelFetchTile(M);this.hideTileFeatures(M)};J.hideTileFeatures=function(M){if(!n.isNone(M.displayingFeatures)){var O=this.changes.updates,Q=this.changes.removes;for(const V of M.displayingFeatures){const Y=g.getObjectId(V,this.objectIdField);var S=this.displayingFeatureReferences.get(Y);S&&((S=S.unref(M.descriptor.resolution),this.numDisplayingFeatureReferences--,S)?S.oldVersion!==S.newVersion&&(null==S.newVersion?
(this.displayingFeatureReferences.delete(Y),Q.push(S.oldVersion)):(O.adds.push(S.newVersion),O.removes.push(S.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();M.displayingFeatures=null}};J.applyChanges=function(){var M=this.changes.updates;0<M.removes.length&&(this.features.removeMany(M.removes),M.removes.length=0);0<M.adds.length&&(this.features.addMany(M.adds),M.adds.length=0);M=this.changes.adds;const O=this.changes.removes,Q=Math.min(M.length,O.length);let S=0;for(;S<
Q;){const V=Math.min(S+200,Q);this.features.addMany(M.slice(S,V));this.features.removeMany(O.slice(S,V));S=V}M.length>Q&&this.features.addMany(0===S?M:M.slice(S));O.length>Q&&this.features.removeMany(0===S?O:O.slice(S));M.length=0;O.length=0};J.clearTile=function(M){this.hideTile(M);M.features&&n.isSome(this.context.memoryCache)&&this.context.memoryCache.put(M.id,M.cache,16+M.estimatedSize);M.setFeatures(null,0,null);this.invalidateCounts()};J.invalidateCounts=function(){this.notifyChange("totalVertices");
this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};J.getListOfTiles=function(){return Array.from(this.featureTiles.values())};J.maximumFeaturesForTile=function(M){const O=M.hasPreciseFeatureCount?M.numFeatures:Infinity;return Math.min(Math.ceil((M.hasPreciseFeatureCount?O:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-M.emptyFeatureRatio)),O)};u._createClass(H,[{key:"maximumNumberOfFeatures",set:function(M){M=M||Infinity;const O=this._get("maximumNumberOfFeatures");
M===O||1>M||(this._set("maximumNumberOfFeatures",M),this.maximumFeaturesUpdated(O,M))}},{key:"memoryFactor",set:function(M){this.memoryFactor!==M&&(this._set("memoryFactor",M),this.setDirty())}},{key:"lodFactor",set:function(M){this.lodFactor!==M&&(this._set("lodFactor",M),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&n.isSome(this.context.query.queryFeatureCount)},set:function(M){this._useTileCount=M;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",
get:function(){let M=0;this.featureTiles.forEach(O=>M+=O.estimatedUnusedSize);return M}},{key:"totalVertices",get:function(){let M=0;this.featureTiles.forEach(O=>M+=O.numVertices);return M}},{key:"totalFeatures",get:function(){let M=0;this.featureTiles.forEach(O=>M+=O.numFeatures);return M}},{key:"filterExtent",set:function(M){if(M&&this.context.tilingScheme&&!M.spatialReference.equals(this.context.tilingScheme.spatialReference))N.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");
else{var O=this._get("filterExtent");O===M||O&&M&&O.equals(M)||(M=M?M.clone():null,this._set("filterExtent",M),this.reclip(M,O))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let M=null;this.featureTiles.forEach(O=>{n.isNone(O.displayingFeatures)||0===O.displayingFeatures.length||(n.isNone(M)?M=new Set(O.availableFields):M.forEach(Q=>{O.availableFields.has(Q)||n.unwrap(M).delete(Q)}))});return n.isSome(M)?M:new Set}},{key:"running",
get:function(){return this.updating}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this.getListOfTiles().reduce((M,O)=>M+(O.features?O.features.length:0),0)}},{key:"test",get:function(){return{process:M=>this.runTask(M),getFeatureTileById:M=>this.featureTiles.get(M),forEachFeatureTile:M=>this.featureTiles.forEach(M)}}}]);return H}(p);f.__decorate([l.property({constructOnly:!0})],
a.FeatureTileFetcher3D.prototype,"features",void 0);f.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);f.__decorate([l.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);f.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);f.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);f.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",
null);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",
null);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);f.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);f.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);f.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,
"filterExtent",null);f.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=f.__decorate([c.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const I=d.create(),G=d.create();f=a.FeatureTileFetcher3D;a.contextCapabilitiesFromLayer=function(K){const H=K.capabilities.query;a:switch(K.geometryType){case "polyline":K=!0;break a;case "polygon":K=K.capabilities&&K.capabilities.query&&K.capabilities.query.supportsQuantization;
break a;default:K=!1}return{supportsMultipleResolutions:K,supportsPagination:!(!H||!H.supportsPagination),supportsResultType:!(!H||!H.supportsResultType),supportsCacheHint:!(!H||!H.supportsCacheHint),supportsQuantization:!(!H||!H.supportsQuantization),supportsQuantizationEditMode:!(!H||!H.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!H||!H.supportsMaxRecordCountFactor),supportsFormatPBF:!(!H||!H.supportsFormatPBF)}};a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/dehydratedFeatureComparison"],function(a,u,f,p){f=function(){function e(b,h){this.highestResolutionVersion=null;this.versions=[];this.ref(b,h)}var n=e.prototype;n.ref=function(b,h){const k=this.feature;w.oldVersion=k;this.feature&&Object.defineProperty(b,"uid",{value:this.feature.uid,configurable:!0});for(var l of this.versions)if(l.resolution===h){l.refCount++;if((h=this.highestResolutionVersion===
l&&!p.equals(b,l.feature))||this.highestResolutionVersion!==l)l.feature=b;w.newVersion=h?b:k;return w}l={feature:b,resolution:h,refCount:1};this.versions.push(l);!this.highestResolutionVersion||h<this.highestResolutionVersion.resolution?(w.newVersion=b,this.highestResolutionVersion=l):w.newVersion=k;return w};n.unref=function(b){for(let h=0;h<this.versions.length;h++){const k=this.versions[h];if(k.resolution===b)return k.refCount--,w.oldVersion=this.feature,0===k.refCount&&(this.versions[h]=this.versions[this.versions.length-
1],this.versions.length--,this.highestResolutionVersion===k&&(this.recalculateHighestResolutionVersion(),w.oldVersion=k.feature)),w.newVersion=this.feature,w}return null};n.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var b=this.versions[0];for(let h=1;h<this.versions.length;h++){const k=this.versions[h];k.resolution<b.resolution&&(b=k)}this.highestResolutionVersion=b}};u._createClass(e,[{key:"isReferenced",get:function(){return 0!==
this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return e}();let t=function(){function e(b){this._feature=b;this.refCount=1}var n=e.prototype;n.ref=function(b){++this.refCount;w.oldVersion=this._feature;this.feature&&Object.defineProperty(b,"uid",{value:this.feature.uid,configurable:!0});p.equals(this._feature,b)||(this._feature=
b);w.newVersion=this._feature;return w};n.unref=function(){w.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return w.newVersion=null,w;w.newVersion=this._feature;return w};u._createClass(e,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);return e}();const w={oldVersion:null,newVersion:null};a.MultiFeatureReference=f;a.SingleFeatureReference=
t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),function(a,u,f,p,t,w){const e=new Set;let n=function(){function h(l){this.descriptor=l;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=
!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=e;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var k=h.prototype;k.setFeatures=function(l,m,z){this._availableFields=p.unwrapOr(z,e);this._features=l;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;l&&0<l.length?(this._emptyFeatureRatio=m/(l.length+m),this._numVertices=l.reduce((r,c)=>
r+w.numVertices(c.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};k.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var l=0;l<this._features.length;++l){const m=w.estimateSize(this._features[l]);this._estimatedSize+=m;l>=this.featureLimit&&(this._estimatedUnusedSize+=m)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(l=this.featureLimit;l<
this._features.length;++l)this._estimatedUnusedSize+=w.estimateSize(this._features[l]);return!0}return!1};k.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};k.intersects=function(l){if(!l||!this.descriptor.extent)return!0;t.fromExtent(l,b);return t.intersects(this.descriptor.extent,b)};k.intersectionIncludingBorrowed=function(l,m){const z=p.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!l&&!z)return t.set(m,t.POSITIVE_INFINITY),
m;l?(t.fromExtent(l,m),t.intersection(m,z,m)):t.set(m,z);return m};k._shuffle=function(l){this._features.sort((m,z)=>w.getObjectId(m,l)-w.getObjectId(z,l));f.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};k.reduceFeatures=function(l,m,z){if(0>=l)return!1;if(!this._features)return this.featureLimit=0,!1;let r=!1;this.featureLimit=Math.ceil(this.numFeatures*l);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&
(this.fetchStatus=1,r=!0));!this._shuffled&&1>l&&this._shuffle(z);l=Math.max(this.featureLimit,Math.ceil(m*this.numFeatures));this._features.length>l&&(this._features.length=l,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4));return r};u._createClass(h,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(l){this._displayingFeatures=l;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&
(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(l){this._featureLimit!==l&&(this._featureLimit=l,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?
this._numFeatures:this._features?this._features.length:0},set:function(l){this._numFeatures=l}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},
{key:"isFetching",get:function(){return 2===this.fetchStatus||3===this.fetchStatus}},{key:"isRefetching",get:function(){return 3===this.fetchStatus}},{key:"needsFetching",get:function(){return 0===this.fetchStatus||1===this.fetchStatus}},{key:"needsRefetching",get:function(){return 1===this.fetchStatus}},{key:"isFetched",get:function(){return 4===this.fetchStatus||5===this.fetchStatus}},{key:"needsDisplayUpdate",get:function(){var l;if(l=!!this._features){a:{l=this._features;var m=this.displayingFeatures,
z=this.featureLimit;if(p.isNone(m)||p.isNone(l)||z!==m.length||z>l.length)l=!1;else{for(let r=0;r<z;++r)if(l[r]!==m[r]){l=!1;break a}l=!0}}l=!l}return l}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(l){this.requestController=null;this._availableFields=l.availableFields;this._features=l.features;
this._numFeatures=l.numFeatures;this._emptyFeatureRatio=l.emptyFeatureRatio;this.fetchStatus=l.fetchStatus;this.featuresMissing=l.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return h}();const b=t.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(a,u,f,p,t,w,e,n,b){const h=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let k=function(){function l(z,r,c){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=z;this.view=c;this.tilingScheme=new b(r);this.loadedSymbols=h.map(d=>new e(new t({material:{color:[d[0],
d[1],d[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new e(new t({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new e(new t({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new e(new t({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var m=l.prototype;m.destroy=function(){this.enabled=!1};m.update=function(){this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:z=>
z.isFetching,symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:z=>!z.isFetching,symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:z=>!z.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(z=>{this.view.graphics.removeMany(z)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(z=>{this.view.graphics.removeMany(z)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(z=>
{this.view.graphics.removeMany(z)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};m.showDataExtent=function(z){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);z&&(z=p.fromExtent(z),this.dataExtentGraphic=new f({geometry:z,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};m.synchronizeMaps=function(z,r){const c=[];z.forEach((d,
g)=>{const A=this.tileFetcher.test.getFeatureTileById(g);A&&r.filter(A)||(this.view.graphics.removeMany(d),c.push(g))});c.forEach(d=>z.delete(d));this.tileFetcher.test.forEachFeatureTile(d=>{if(r.filter(d)&&!z.has(d.id)){const [q,y,x]=d.descriptor.lij;this.tilingScheme.ensureMaxLod(q);var g=this.tilingScheme.getExtentGeometry(q,y,x),A=new f({geometry:g,symbol:r.symbols[q%r.symbols.length]});g=new f({geometry:g.center,symbol:new w({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",
border:{color:"black"}},symbolLayers:[new n({text:`${q}/${y}/${x}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});A=[A,g];z.set(d.id,A);this.view.graphics.addMany(A)}})};u._createClass(l,[{key:"enabled",get:function(){return this._enabled},set:function(z){this._enabled=z;this.update()}}]);return l}();a.FeatureTileFetcher3DDebugger=k;a.default=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../renderers/support/renderingInfoUtils ../../../rest/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){a.FeatureLikeLayerView3D=y=>{y=function(x){function D(){var B=x.apply(this,arguments)||this;B.controller=null;B.updatePolicy=1;B.suspendResumeExtentMode="computed";B.slicePlaneEnabled=!1;B.drapeSourceType=1;B.fullExtentInLocalViewSpatialReference=null;B.suspendResumeExtent=null;B._controllerCreated=!1;B.clippingExtent=null;B.supportsHeightUnitConversion=!0;B.pendingController=null;B.queryEngine=null;return B}u._inheritsLoose(D,x);var C=D.prototype;
C.initialize=function(){const B=this.layer;"isTable"in B&&B.isTable?this.addResolvingPromise(Promise.reject(new p("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:B}))):(this._set("graphics3d",new d({owner:this,layer:B,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,suspendResumeExtentMode:this.suspendResumeExtentMode,
updateClippingExtent:v=>this.updateClippingExtent(v)})),this.updatingHandles.add(this,"updatePolicy",v=>this.graphics3d.graphicsCore.preferredUpdatePolicy=v),this.updatingHandles.add(this,"suspendResumeExtentMode",v=>{this.graphics3d.suspendResumeExtentMode=v}),this.addResolvingPromise(this.graphics3d.setup().then(()=>this.validateGeometryType()).then(()=>this.queryEngine=new g["default"]({layerView:this,priority:q.TaskPriority.FEATURE_QUERY_ENGINE})).then(()=>A.toViewIfLocal(this)).then(v=>this.fullExtentInLocalViewSpatialReference=
v).then(()=>this.initializeController())),this.notifyChange("updating"))};C.destroy=function(){this.destroyPendingController();this.controller=t.destroyMaybe(this.controller);this._set("graphics3d",t.destroyMaybe(this.graphics3d));this.queryEngine=t.destroyMaybe(this.queryEngine);this.loadedGraphics=null};C.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};C.notifyGraphicGeometryChanged=function(B){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(B)};
C.notifyGraphicVisibilityChanged=function(B){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(B)};C.getRenderingInfo=function(B,v,E){B=r.getRenderingInfo(B,{renderer:v,arcade:E});t.isSome(B)&&B.color&&(v=B.color,v[0]/=255,v[1]/=255,v[2]/=255);return B};C.getRenderingInfoAsync=function(){var B=u._asyncToGenerator(function*(v,E,F,L){return r.getRenderingInfoAsync(v,{renderer:E,arcade:F,...L})});return function(v,E,F,L){return B.apply(this,arguments)}}();C.getGraphicFromGraphicUid=function(B){var v;
let E=null;null==(v=this.loadedGraphics)?void 0:v.forEach(F=>{F.uid===B&&(E=m.hydrateGraphic(F,this.layer))});return E};C.whenGraphicBounds=function(B,v){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(B,v):null};C.computeAttachmentOrigin=function(B,v){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(B,v):null};C.getSymbolLayerSize=function(B,v){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(B,v):null};C.queryFeatures=function(B,
v){return this.queryEngine.executeQuery(this._ensureQuery(B),t.get(v,"signal"))};C.queryObjectIds=function(B,v){return this.queryEngine.executeQueryForIds(this._ensureQuery(B),t.get(v,"signal"))};C.queryFeatureCount=function(B,v){return this.queryEngine.executeQueryForCount(this._ensureQuery(B),t.get(v,"signal"))};C.queryExtent=function(B,v){return this.queryEngine.executeQueryForExtent(this._ensureQuery(B),t.get(v,"signal"))};C._ensureQuery=function(B){return t.isNone(B)?this.createQuery():c.from(B)};
C.highlight=function(B){return this.graphics3d.highlight(B,this.layer.objectIdField)};C.maskOccludee=function(B){return this.graphics3d.maskOccludee(B)};C.canResume=function(){return x.prototype.canResume.call(this)&&(!this.graphics3d||!this.graphics3d.suspended)};C.getSuspendInfo=function(){const B=x.prototype.getSuspendInfo.call(this);return this.graphics3d?{...B,...this.graphics3d.suspendInfo}:B};C.isUpdating=function(){var B,v;return!this.graphics3d||this.graphics3d.destroyed?!1:!(this._controllerCreated&&
(null==(B=this.controller)||!B.updating)&&null!=(v=this.view.basemapTerrain)&&v.ready&&!this.graphics3d.updating)};C.initializeController=function(){var B=u._asyncToGenerator(function*(){const v=this.createController();this.pendingController=v;yield v.when();this.setControllerWhenInitialized(v)});return function(){return B.apply(this,arguments)}}();C.setControllerWhenInitialized=function(){var B=u._asyncToGenerator(function*(v){try{yield this.when()}catch(E){}this._controllerCreated=!0;this.notifyChange("updating");
!this.isResolved()||this.destroyed?this.destroyPendingController():(yield w.whenTrueOnce(this.view,"basemapTerrain.ready"),this.beforeSetController(v),this.pendingController=null,this.controller=v,this.loadedGraphics=v.graphics,this.notifyChange("updating"))});return function(v){return B.apply(this,arguments)}}();C.updateClippingExtent=function(B){this.clippingExtent=B;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
B,!0}};C.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return Promise.reject(new p("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};C._getResourceInfo=function(){const B=this.controller&&this.controller instanceof z.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:B?B.maximumNumberOfFeatures:
-1,totalNumberOfFeatures:B?B.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};u._createClass(D,[{key:"legendEnabled",get:function(){var B,v;return this.canResume()&&!(null!=(B=this.graphics3d)&&null!=(v=B.frustumVisibility)&&v.suspended)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?
this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return D}(y);f.__decorate([e.property()],y.prototype,"loadedGraphics",void 0);f.__decorate([e.property()],y.prototype,"suspended",
void 0);f.__decorate([e.property({readOnly:!0})],y.prototype,"legendEnabled",null);f.__decorate([e.property()],y.prototype,"updating",void 0);f.__decorate([e.property()],y.prototype,"controller",void 0);f.__decorate([e.property()],y.prototype,"graphics3d",void 0);f.__decorate([e.property({readOnly:!0})],y.prototype,"updatePolicy",void 0);f.__decorate([e.property({readOnly:!0})],y.prototype,"suspendResumeExtentMode",void 0);f.__decorate([e.property({type:Boolean})],y.prototype,"slicePlaneEnabled",
void 0);f.__decorate([e.property({readOnly:!0})],y.prototype,"suspendInfo",void 0);return y=f.__decorate([l.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../rest/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E){p=function(L){function N(G){G=L.call(this,G)||this;G._handles=new w;G.watchUpdatingTracking=new E.WatchUpdatingTracking;G.suspendResumeExtentMode="computed";G.dataExtent=null;G.suspendResumeExtent=null;return G}a._inheritsLoose(N,L);var I=N.prototype;I.normalizeCtorArgs=function(G){const K=G.frustumVisibilityEnabled?new x:null,H=G.scaleVisibilityEnabled?new C:null,J=(G.filterVisibilityEnabled||G.timeExtentVisibilityEnabled)&&"multipatch"!==
G.layer.geometryType?new y.Graphics3DFilterVisibility:null,M=G.elevationAlignmentEnabled?new q:null,O=new A.Graphics3DCore({owner:G.owner,layer:G.layer,preferredUpdatePolicy:G.preferredUpdatePolicy,elevationFeatureExpressionEnabled:G.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:G.owner.hasZ,hasM:G.owner.hasM}),{updateClippingExtent:Q,suspendResumeExtentMode:S,dataExtent:V}=G;return{graphicsCore:O,frustumVisibility:K,scaleVisibility:H,filterVisibility:J,elevationAlignment:M,updateClippingExtent:Q,
suspendResumeExtentMode:S,dataExtent:V}};I.initialize=function(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",()=>this.filterVisibility.filterChanged()),this.watchUpdatingTracking.add(this.owner,"timeExtent",()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",
(G,K)=>{r.diff(G,K)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",()=>this.graphicsCore.updateVisibilityInfo());this.watchUpdatingTracking.add(this.layer,"labelingInfo",(G,K)=>{r.diff(G,K)&&this.graphicsCore.updateLabelingInfo()})};I.setup=function(){var G=a._asyncToGenerator(function*(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const K=this.owner,H=this.owner.view.basemapTerrain,J=
(M,O,Q)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(M,O,Q);this.scaleVisibility&&this.scaleVisibility.setup(K,this.layer,J,this.graphicsCore,H);this.filterVisibility&&("filter"in K||"timeExtent"in K)&&this.filterVisibility.setup(K,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(K,J,this.graphicsCore,K.view.elevationProvider);this._set("objectStates",new D.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,
this.scaleVisibility));this._set("deconfliction",K.view.deconflictor.addGraphicsOwner(this.graphicsCore));yield e.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.watchUpdatingTracking.add(this.layer,"renderer",M=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(M)));this.watchUpdatingTracking.add(K,
"fullOpacity",()=>this.graphicsCore.opacityChange());this.setupSuspendResumeExtent();this.updateClippingExtent&&(this.watchUpdatingTracking.add(K.view,"clippingArea",()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield e.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return G.apply(this,arguments)}}();I.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);var G=
"watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");for(const K of G)if(G=this[K])G.destroy(),this._set(K,null);this._set("layer",null);this._set("owner",null)};I.maskOccludee=function(G){const {set:K,handle:H}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(K,G.uid);return H};I.highlight=function(G,K){if(G instanceof d){const {set:H,handle:J}=this.objectStates.acquireSet(0,K);this.owner.queryObjectIds(G).then(M=>
this.objectStates.setObjectIds(H,M));return J}if("number"===typeof G||"string"===typeof G||G instanceof f)return this.highlight([G],K);"toArray"in G&&(G=G.toArray());if(Array.isArray(G)&&0<G.length){if(G[0]instanceof f)if(null!=v.attributeLookup(this.layer.fieldsIndex,G[0].attributes,K))G=G.map(H=>v.attributeLookup(this.layer.fieldsIndex,H.attributes,K));else{G=G.map(M=>M.uid);const {set:H,handle:J}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(H,G);return J}if("number"===typeof G[0]||
"string"===typeof G[0]){const {set:H,handle:J}=this.objectStates.acquireSet(0,K);this.objectStates.setObjectIds(H,G);return J}}return F};I._updateClippingExtent=function(){const G=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(G,this.owner.view.spatialReference)&&(this.updateClippingExtent(G)||this.graphicsCore.recreateAllGraphics())};I.setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(n.init(this,"suspendResumeExtentMode",()=>
{this._handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this._handles.add([n.init(this.graphicsCore,"computedExtent",G=>this.updateSuspendResumeExtent(G)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this._handles.add([n.init(this,"dataExtent",G=>this.updateSuspendResumeExtent(G)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.dataExtent))],
"suspendResumeExtentMode");break;default:t.neverReached(this.suspendResumeExtentMode)}}))};I.updateSuspendResumeExtent=function(G){G?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(G,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};I.extentToSuspendResumeRect=function(G,K){const H=this.owner.view.spatialReference;if(!G.spatialReference.equals(H)){if(!c.canProject(G,H))return;G=c.project(G,H)}return B.enlargeExtent(G,K,g.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};
I.suspendResumeExtentChanged=function(G){this.frustumVisibility&&this.frustumVisibility.setExtent(G);this.scaleVisibility&&this.scaleVisibility.setExtent(G)};a._createClass(N,[{key:"suspended",get:function(){var G;return null==(G=this.scaleVisibility)?void 0:G.suspended}},{key:"suspendInfo",get:function(){var G,K;const H={};null!=(G=this.scaleVisibility)&&G.suspended&&(H.outsideScaleRange=!0);null!=(K=this.frustumVisibility)&&K.suspended&&(H.outsideOfView=!0);return H}},{key:"updating",get:function(){var G,
K,H;return!!(null!=(G=this.graphicsCore)&&G.updating||null!=(K=this.frustumVisibility)&&K.updating||null!=(H=this.watchUpdatingTracking)&&H.updating)}}]);return N}(p);u.__decorate([b.property({aliasOf:"graphicsCore.layer"})],p.prototype,"layer",void 0);u.__decorate([b.property({aliasOf:"graphicsCore.owner"})],p.prototype,"owner",void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"updateClippingExtent",void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"graphicsCore",
void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"scaleVisibility",void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"filterVisibility",void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"elevationAlignment",void 0);u.__decorate([b.property({constructOnly:!0})],p.prototype,"frustumVisibility",void 0);u.__decorate([b.property({readOnly:!0})],p.prototype,"deconfliction",void 0);u.__decorate([b.property({readOnly:!0})],p.prototype,"labeling",void 0);u.__decorate([b.property({readOnly:!0})],
p.prototype,"objectStates",void 0);u.__decorate([b.property({readOnly:!0})],p.prototype,"watchUpdatingTracking",void 0);u.__decorate([b.property()],p.prototype,"suspendResumeExtentMode",void 0);u.__decorate([b.property()],p.prototype,"dataExtent",void 0);u.__decorate([b.property({readOnly:!0})],p.prototype,"suspended",null);u.__decorate([b.property({readOnly:!0})],p.prototype,"suspendInfo",null);u.__decorate([b.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating",
"watchUpdatingTracking.updating"]})],p.prototype,"updating",null);p=u.__decorate([z.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],p);const F={remove(){},pause(){},resume(){}};return p})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol ../../../../geometry/Extent".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca,da,ha,fa,R,U,Z,T,P,X,aa,ja,ia,ka,na,ta,pa,xa,Da,Ka,Fa,Ha){var ua;const Ba=G.create(),Ea=H.create(),Ga=g.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=ua=function(ea){function Ua(ra){var va=ea.call(this,ra)||this;va.propertiesPool=new ka.PropertiesPool({computedExtent:Ha},u._assertThisInitialized(va));va.computedExtent=null;va.currentRenderer=null;va.rendererHasGeometryOperations=
!1;va.graphicStateTracking=null;va.symbolCreationContext=new R.Graphics3DSymbolCreationContext((La,Ta)=>va._frameTask.schedule(La,Ta));va.graphics3DGraphics=new Map;va.stageLayer=null;va.stage=null;va.graphicsDrapedUids=new Set;va.graphicsBySymbol=new Map;va.symbolConversionCache=new Map;va.symbols=new Map;va.graphicsWithoutSymbol=new Map;va.graphicsWaitingForSymbol=new Set;va._handles=new d;va._frameTask=pa.ImmediateTask;va.suspendSymbolCleanup=!1;va._spatialReference=null;va.arcadeOnDemand=null;
va.rendererChangeAbortController=null;va.elevationInfoChangeAbortController=null;va.setupAbortController=null;va.elevationAlignment=null;va.scaleVisibility=null;va.filterVisibility=null;va._spatialIndex=null;va.extentPadding=0;va._updatingPendingLoadedGraphicsChange=null;va.featureStore=null;va.deconflictor=null;va.labeler=null;va.objectStates=null;va.viewElevationProvider=null;va.stageLayerElevationProvider=null;va.sharedSymbolResourcesOwnerHandle=null;va.whenGraphics3DGraphicRequests={};va.pendingUpdates=
new Map;va.numberOfGraphics=0;va.numberOfGraphicsProvidingElevation=0;va.pendingAdds=0;va.pendingRemoves=0;va.pendingUpdatesPool=new x({allocator:La=>La||new ma,deallocator:La=>{La.clear();return La}});va.symbolWarningLogged=!1;va.geometryWarningLogged=!1;va.objectIdInvisibleSet=new Set;va._whenSymbolRemoved=new x;va.preferredUpdatePolicy=1;va.forcedUpdatePolicy=null;va.elevationFeatureExpressionEnabled=!0;va.owner=null;va.layer=null;va.graphicSymbolSupported=!0;va.getRenderingInfoWithoutRenderer=
!1;va.hasZ=null;va.hasM=null;va._usedMemory=0;va._visible=void 0;va._startCreateGraphics=!1;return va}u._inheritsLoose(Ua,ea);var Qa=Ua.prototype;Qa.getConvertedSymbol=function(ra){if("web-style"===ra.type)return ra.clone();var va=this.symbolConversionCache.get(ra.id);if(void 0!==va)return va;va=W.to3D(ra,!0,!1,this.hasLabelingContext(ra));const La=va.symbol||null;La||va.error&&Ga.error(va.error.message);this.symbolConversionCache.set(ra.id,La);return La};Qa.getSymbolComplexitiesUsedOrRenderer=function(ra){if(y.isNone(ra))return[];
var va=ra.getSymbols(),La="backgroundFillSymbol"in ra&&ra.backgroundFillSymbol;if(!(La||va&&va.length))return[];ra=[];La=this.getSymbolComplexityUsedOrRenderer(La);y.isSome(La)&&ra.push(La);for(const Ta of va)va=this.getSymbolComplexityUsedOrRenderer(Ta),y.isSome(va)&&ra.push(va);return ra};Qa.getSymbolComplexityUsedOrRenderer=function(ra){if(y.isNone(ra))return null;const va=this.symbols.get(ra.id);return y.isSome(va)?va.complexity:(ra=this.getConvertedSymbol(ra))?aa.defaultSymbolComplexity(ra):
null};Qa.getSymbolComplexitiesUsed=function(){const ra=[];this.symbols.forEach(va=>{y.isSome(va)&&ra.push(va.complexity)});return ra};Qa.initialize=function(){this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new da["default"]({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:()=>this.spatialIndex,forAllGraphics:ra=>this.graphics3DGraphics.forEach(ra)}))};Qa.setup=function(){var ra=
u._asyncToGenerator(function*(va){this.setupAbortController=D.createAbortController();const La=this.setupAbortController.signal;this._set("elevationAlignment",va.elevationAlignment);this._set("scaleVisibility",va.scaleVisibility);this._set("filterVisibility",va.filterVisibility);this._set("deconflictor",va.deconflictor);this._set("labeler",va.labeler);this._set("objectStates",va.objectStates);const Ta=this.owner.view;this.viewElevationProvider=new ba.ViewElevationProvider(this._spatialReference,Ta);
this.initializeStage(Ta,this.layer.uid);this.symbolCreationContext.sharedResources=Ta.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=Ta.sharedSymbolResources.addGraphicsOwner(this.owner);y.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Ta.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Ta.renderCoordsHelper;this.symbolCreationContext.layer=
this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.localOriginFactory=new na.GridLocalOriginFactory(Ta.renderSpatialReference);this.symbolCreationContext.elevationProvider=Ta.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Pa=>this.notifyGraphicGeometryChanged(Pa);this.symbolCreationContext.notifyGraphicVisibilityChanged=Pa=>this.notifyGraphicVisibilityChanged(Pa);va=ca.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);
this.symbolCreationContext.featureExpressionInfoContext=yield ca.createContext(va,this._spatialReference,Ga);D.throwIfAborted(La);this.symbolCreationContext.screenSizePerspectiveEnabled=Ta.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;va="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:
"view.screenSizePerspectiveEnabled";this._handles.add([this.watch("suspendedOrOutsideOfView",()=>this._frameTask.reschedule(()=>this.updateLayerVisibility())),this.owner.watch(va,()=>{const Pa=Ta.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;Pa!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Pa,this.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",Pa=>this.slicePlaneEnabledChange(!!Pa)),this.owner.view.watch("pixelRatio",
()=>this.pixelRatioChange()),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",Pa=>this.physicalBasedRenderingChange(Pa)),B.when(Ta.basemapTerrain,"tilingScheme",Pa=>{Pa.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=Ta.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([B.on(this.owner,"loadedGraphics","change",sa=>this.graphicsCollectionChanged(sa),()=>this.recreateAllGraphics()),
B.on(this.owner,"loadedGraphics","after-changes",()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange(),()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange())],"loaded-graphics")}),B.whenFalse(this,"asyncUpdates",()=>this.runTask(pa.noBudget),!0),B.init(this,"effectiveUpdatePolicy",Pa=>{y.isSome(this.stageLayer)&&(this.stageLayer.updatePolicy=Pa);this.symbolCreationContext.isAsync=0===this.effectiveUpdatePolicy;1===Pa&&this.runTask(pa.noBudget)},!0)]);this._frameTask=Ta.resourceController.scheduler.registerTask(pa.TaskPriority.GRAPHICS_CORE,
this);this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");try{yield this.rendererChange(this.layer.renderer)}catch{}D.throwIfAborted(La);this.setupAbortController=null});return function(va){return ra.apply(this,arguments)}}();Qa.abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};
Qa.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();y.isSome(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null);this.stage&&(this.stage.remove(this.stageLayer),
this.stage=this.stageLayer=null);this._handles=y.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=pa.ImmediateTask;this._spatialReference=null;this._set("owner",null);for(const ra in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[ra].reject(new c("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle=y.removeMaybe(this.sharedSymbolResourcesOwnerHandle);this.propertiesPool=y.destroyMaybe(this.propertiesPool);
this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex=y.destroyMaybe(this._spatialIndex);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};Qa.clear=function(){var ra;this.objectStates&&this.objectStates.allGraphicsDeleted();y.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(va=>va.destroy());null==(ra=this._spatialIndex)?void 0:ra.clear();this.graphics3DGraphics.clear();
this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(va=>{y.isSome(va)&&va.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=0;this.notifyChange("updating");this.notifyChange("running");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};Qa.initializeStage=
function(ra,va){this.stage=ra._stage;this.stageLayer=new ta.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},va);this.stage.add(this.stageLayer);ra=this.stageLayer.events;ra.on("objectTransformation",La=>this.notifyGraphicGeometryChanged(La.metadata.graphicUid));ra.on("visibilityChanged",La=>this.notifyGraphicVisibilityChanged(La.metadata.graphicUid));ra.on("objectGeometryAdded",La=>this.notifyGraphicGeometryChanged(La.object.metadata.graphicUid));ra.on("objectGeometryRemoved",
La=>this.notifyGraphicGeometryChanged(La.object.metadata.graphicUid));ra.on("vertexAttrsUpdated",La=>this.notifyGraphicGeometryChanged(La.object.metadata.graphicUid))};Qa.notifyGraphicGeometryChanged=function(ra){y.isNone(this.graphicStateTracking)||(ra=this.graphics3DGraphics.get(ra))&&this.graphicStateTracking.updateGraphicGeometry(ra)};Qa.notifyGraphicVisibilityChanged=function(ra){y.isNone(this.graphicStateTracking)||(ra=this.graphics3DGraphics.get(ra))&&this.graphicStateTracking.updateGraphicVisibility(ra)};
Qa.updateLayerVisibility=function(){var ra=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;ra=!this.suspendedOrOutsideOfView&&!ra;ra!==this._visible&&((this._visible=ra)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};Qa.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Qa.getGraphics3DGraphicById=
function(ra){return this.graphics3DGraphics.get(ra)};Qa.getGraphics3DGraphicByObjectId=function(ra){var va;return null!=(va=this.owner.layer)&&va.objectIdField?this._findGraphics3DGraphicByObjectId(ra):null};Qa._getGraphicObjectID=function(ra,va=this.owner.layer&&this.owner.layer.objectIdField){return O.getObjectId(ra,va)};Qa.updateLabelingInfo=function(){var ra=u._asyncToGenerator(function*(va){const La=this.deconflictor&&this.deconflictor.labelingInfoChange(va);va=this.labeler&&this.labeler.labelingInfoChange(va);
yield D.eachAlways([La,va])});return function(va){return ra.apply(this,arguments)}}();Qa.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Qa.runTask=function(ra){this._frameTask.processQueue(ra);this._applyPendingUpdates(ra);this.notifyChange("running");this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining")};Qa.setObjectIdVisibility=function(ra,va){va?this.objectIdInvisibleSet.delete(ra):
this.objectIdInvisibleSet.add(ra);ra=this._findGraphics3DGraphicByObjectId(ra);y.isSome(ra)&&this._updateUserVisibility(ra)};Qa._findGraphics3DGraphicByObjectId=function(ra){return A.findInMap(this.graphics3DGraphics,va=>this._getGraphicObjectID(va.graphic)===ra)};Qa._updateUserVisibility=function(ra){if(y.isNone(ra))return!1;var va=ra.graphic;const La=this._getGraphicObjectID(va);va=va.visible&&!this.owner.suspended&&(y.isNone(La)||!this.objectIdInvisibleSet.has(La));return ra.setVisibilityFlag(0,
va,0)};Qa.whenGraphics3DGraphic=function(ra){var va=this.graphics3DGraphics.get(ra.uid);if(va)return Promise.resolve(va);if(va=this.whenGraphics3DGraphicRequests[ra.uid])return va.promise;va=D.createDeferred();this.whenGraphics3DGraphicRequests[ra.uid]=va;return va.promise};Qa.boundsForGraphics3DGraphic=function(){var ra=u._asyncToGenerator(function*(va,La){const Ta=this._spatialReference,Pa=this.owner.view.renderSpatialReference,sa=this.owner.view.basemapTerrain.spatialReference;var oa=this.viewElevationProvider?
{service:this.viewElevationProvider,useViewElevation:y.isSome(La)&&La.useViewElevation,minDemResolution:y.isSome(La)&&La.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;va=yield va.getProjectedBoundingBox((wa,za,Ia)=>K.projectBuffer(wa,Pa,za,wa,Ta,za,Ia),(wa,za,Ia)=>K.projectBuffer(wa,sa,za,wa,Ta,za,Ia),oa,y.get(La,"signal"));if(!va)return null;La=va.boundingBox;va.requiresDrapedElevation&&(oa=this.symbolCreationContext.elevationProvider)&&(H.center(La,Ba),oa=y.unwrapOr(oa.getElevation(Ba[0],
Ba[1],0,Ta,"ground"),0),La[2]=Math.min(La[2],oa),La[5]=Math.max(La[5],oa));return{boundingBox:La,screenSpaceObjects:va.screenSpaceObjects}});return function(va,La){return ra.apply(this,arguments)}}();Qa.whenGraphicBounds=function(ra,va){return B.whenOnce(this.owner,"loadedGraphics").then(()=>{const La=this.owner.layer&&this.owner.layer.objectIdField,Ta=this.owner.loadedGraphics.find(Pa=>Pa===ra?!0:La&&Pa.attributes&&ra.attributes&&Pa.attributes[La]===ra.attributes[La]);if(Ta)return this.whenGraphics3DGraphic(Ta);
throw new c("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(La=>this.boundsForGraphics3DGraphic(La,va))};Qa.computeAttachmentOrigin=function(ra,va){ra=this.graphics3DGraphics.get(ra.uid);if(!ra)return null;var La=ra.computeAttachmentOrigin();if(0===La.render.num&&0===La.draped.num)return null;I.set(ya,0,0,0);ra=0;if(0<La.render.num){if(!K.projectVectorToVector(La.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,Ma,va))return null;I.add(ya,
ya,Ma);ra++}if(0<La.draped.num){const [Ta,Pa]=La.draped.origin;La=y.unwrapOr(this.viewElevationProvider.getElevation(Ta,Pa,"ground"),0);I.set(Ma,Ta,Pa,La);if(!K.projectVectorToVector(Ma,this.viewElevationProvider.spatialReference,Ma,va))return null;I.add(ya,ya,Ma);ra++}1<ra&&I.scale(ya,ya,1/ra);return new xa({x:ya[0],y:ya[1],z:ya[2],spatialReference:va})};Qa.getSymbolLayerSize=function(ra,va){var La=this.symbols.get(ra.id);if(y.isNone(La))throw new c("internal:symbol-not-part-of-view","Symbol is not part of this view");
ra=ra.symbolLayers.indexOf(va);if(-1===ra)throw new c("internal:missing-symbol-layer","Symbol layer is not in symbol");La=La.getSymbolLayerSize(ra);if(null==La)throw new c("internal:missing-size","Symbol layer has no valid size");return La};Qa.graphicsCollectionChanged=function(ra){this._startCreateGraphics&&(this.add(ra.added),this.remove(ra.removed))};Qa.graphicUpdateHandler=function(ra){var va=ra.graphic.uid;const La=this.graphics3DGraphics.get(va);va=this.graphicsWithoutSymbol.get(va);if(La||
va)switch(ra.property){case "visible":this.graphicUpdateVisibleHandler(La);break;case "geometry":this.graphicUpdateGeometryHandler(La,ra);break;case "symbol":this.graphicUpdateSymbolHandler(La,ra)}};Qa.graphicUpdateGeometryHandler=function(ra,va){const La=va.graphic.geometry;if(y.isNone(La))this.recreateGraphic(va.graphic);else if(y.isNone(ra)){if(ra=va.graphic.symbol&&va.graphic.symbol.id)if(ra=this.symbols.get(ra),y.isSome(ra)&&0===ra.loadStatus)return;this.recreateGraphic(va.graphic)}else{var Ta=
ra.graphics3DSymbol;!y.isNone(va.newValue)&&Ta.updateGeometry(ra,va.newValue)||this.recreateGraphic(ra.graphic);this.expandComputedExtent(La)}};Qa.graphicUpdateSymbolHandler=function(ra,va){var La=va.graphic;const Ta=y.isSome(ra)?ra.graphics3DSymbol:y.isSome(va.oldValue)?this.symbols.get(va.oldValue.id):null;if(y.isNone(Ta)||y.isNone(va.newValue))this.recreateGraphic(La);else{var Pa=Ta.symbol;va=this.getConvertedSymbol(va.newValue);if(va.type!==Pa.type||"web-style"===va.type||"web-style"===Pa.type)this.recreateGraphic(La);
else{var sa=this.graphicsBySymbol.get(Pa.id);if(sa&&1!==sa.size)this.recreateGraphic(La);else if(sa=N.diff(Pa,va),y.isNone(sa))this.updateSymbolMapping(Pa.id,va);else if(sa={diff:sa,graphics3DGraphicPatches:[],symbolStatePatches:[]},Ta.prepareSymbolPatch(sa),N.isEmpty(sa.diff)){var oa=this._getRenderingInfo(La);if(y.isNone(oa))this.recreateGraphic(La);else{La=Ta.extentPadding;for(const wa of sa.symbolStatePatches)wa();La!==Ta.extentPadding&&this.recomputeExtentPadding();if(y.isSome(ra))for(const wa of sa.graphics3DGraphicPatches)wa(ra,
oa);this.updateSymbolMapping(Pa.id,va)}}else this.recreateGraphic(La)}}};Qa.graphicUpdateVisibleHandler=function(ra){this._updateUserVisibility(ra)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Qa.recreateGraphics=function(ra){this.suspendSymbolCleanup=!0;this.remove(ra);this.add(ra);this.suspendSymbolCleanup=!1;1===this.effectiveUpdatePolicy&&this._cleanupSymbols()};Qa.recreateGraphic=function(ra){this.recreateGraphics([ra])};Qa._beginGraphicUpdate=
function(ra){this.graphicsWaitingForSymbol.add(ra.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")};Qa._endGraphicUpdate=function(ra){ra&&(this.graphicsWaitingForSymbol.delete(ra.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Qa.recomputeExtentPadding=function(){let ra=0;this.symbols.forEach(va=>{y.isSome(va)&&(ra=Math.max(ra,va.extentPadding))});this._set("extentPadding",ra)};Qa.expandComputedExtent=function(ra){var va=
ra.spatialReference;O.computeAABB(ra,Ea);ra=this._spatialReference;var La=ua.tmpVec;!va.equals(ra)&&K.projectXYZToVector(Ea[0],Ea[1],0,va,La,ra)&&(Ea[0]=La[0],Ea[1]=La[1],K.projectXYZToVector(Ea[3],Ea[4],0,va,La,ra),Ea[3]=La[0],Ea[4]=La[1]);if(q.isFinite(Ea[0])&&q.isFinite(Ea[3])&&q.isFinite(Ea[1])&&q.isFinite(Ea[4])){va=this.computedExtent;La=null;var Ta=q.isFinite(Ea[2])&&q.isFinite(Ea[5]),Pa=Ta&&(!va||null==va.zmin||Ea[2]<va.zmin);Ta=Ta&&(!va||null==va.zmax||Ea[5]>va.zmax);if(va){if(Ea[0]<va.xmin||
Ea[1]<va.ymin||Ea[3]>va.xmax||Ea[4]>va.ymax||Pa||Ta)La=this.propertiesPool.get("computedExtent"),La.xmin=Math.min(Ea[0],va.xmin),La.ymin=Math.min(Ea[1],va.ymin),La.xmax=Math.max(Ea[3],va.xmax),La.ymax=Math.max(Ea[4],va.ymax),La.spatialReference=ra}else La=this.propertiesPool.get("computedExtent"),La.xmin=Ea[0],La.ymin=Ea[1],La.xmax=Ea[3],La.ymax=Ea[4],La.spatialReference=ra;La&&(Pa&&(La.zmin=Ea[2]),Ta&&(La.zmax=Ea[5]),this._set("computedExtent",La))}};Qa.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&
(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};Qa.elevationInfoChange=function(){var ra=u._asyncToGenerator(function*(){this.abortElevationInfoChange();const va=D.createAbortController();this.elevationInfoChangeAbortController=va;const La=ca.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield ca.createContext(La,this._spatialReference,Ga);D.throwIfAborted(va);
this.elevationInfoChangeAbortController=null;this.labeler&&this.labeler.elevationInfoChange();this.forEachGraphics3DSymbol((Ta,Pa,sa)=>{Ta.globalPropertyChanged("elevationInfo",Pa)?Pa.forEach(oa=>{const wa=oa.graphic;oa=oa.labelGraphics;for(const za of oa)za.graphics3DSymbolLayer.updateGraphicElevationContext(wa,za)}):this._recreateSymbol(sa)});this.updateStageLayerElevationProvider();this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()});return function(){return ra.apply(this,arguments)}}();
Qa.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&
(this.stageLayerElevationProvider=new ja.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};Qa.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();
this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};Qa.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Qa.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&
this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};Qa._recreateSymbol=function(ra){var va=this.graphicsBySymbol.get(ra);const La=[];va&&(va.forEach((Ta,Pa)=>{var sa;const oa=Ta.usedMemory;this._conditionalRemove(Ta,Pa);null==(sa=this._spatialIndex)?void 0:sa.remove(Ta);La.push(Ta.graphic);
Ta.destroy();this.removeGraphics3DGraphic(Pa,oa);this.updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(ra,new Map));va=this.symbols.get(ra);y.isSome(va)&&va.destroy();this.symbols.delete(ra);this.add(La)};Qa._conditionalRemove=function(ra,va){ra.isDraped&&this.graphicsDrapedUids.delete(va);this.objectStates&&this.objectStates.removeGraphic(ra);this.labeler&&this.labeler.removeGraphic(ra);this.deconflictor&&this.deconflictor.removeGraphic(ra);y.isSome(this.graphicStateTracking)&&
this.graphicStateTracking.removeGraphic(ra)};Qa.add=function(ra){ra&&0!==ra.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(0===this._updatePolicyForGraphics(ra)?this._addDelayed(ra):this._addImmediate(ra),this.notifyChange("updating")):Ga.error("#add()","Cannot add graphics before terrain surface has been initialized"))};Qa._updatePolicyForGraphics=function(ra){if(1===this.effectiveUpdatePolicy&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const va of ra)if(y.isSome(va.geometry)&&
"mesh"===va.geometry.type&&!va.geometry.loaded)return 0;return this.effectiveUpdatePolicy};Qa._addImmediate=function(ra){this.symbolWarningLogged=this.geometryWarningLogged=!1;for(const va of ra)this._addGraphic(va,this._getRenderingInfo(va,Ga),1);this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};Qa._addDelayed=function(ra){for(const va of ra){ra=va.uid;let La=this.pendingUpdates.get(ra);La?La.add?0!==La.state&&
La.abortController.abort():this.pendingAdds++:(La=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(ra,La));La.add=va}this.notifyChange("running");this.notifyChange("updatingRemaining")};Qa.remove=function(ra){0===this.effectiveUpdatePolicy?this._removeDelayed(ra):this._removeImmediate(ra);this.notifyChange("updating")};Qa._removeImmediate=function(ra){for(const va of ra)this._removeGraphic(va);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};
Qa._removeDelayed=function(ra){for(const La of ra){ra=La.uid;var va=this.pendingUpdates.get(ra);va?va.add&&(va.remove?va.add=null:this.pendingUpdates.delete(ra),1===va.state&&va.abortController.abort(),this.pendingAdds--):(va=this.pendingUpdatesPool.pushNew(),va.remove=La,this.pendingUpdates.set(ra,va),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};Qa._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();
this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&Ga.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};Qa._applyPendingUpdates=function(ra){var va;this.symbolWarningLogged=this.geometryWarningLogged=!1;if(0===this.pendingUpdates.size&&null!=(va=this._spatialIndex)&&va.updating)this._spatialIndex.update();else{for(const [La,Ta]of this.pendingUpdates){if(ra.done)break;Ta.add&&0===Ta.state&&this._processPendingUpdateNew(Ta);va=this.effectiveUpdatePolicy;
!Ta.remove||Ta.add&&2!==Ta.state||(this.pendingRemoves--,ra.madeProgress(),this._removeGraphic(Ta.remove),Ta.remove=null,va=1);if(Ta.add)switch(Ta.state){case 2:this._addGraphic(Ta.add,Ta.renderingInfo,va);Ta.add=null;this.pendingAdds--;ra.madeProgress();break;case 3:Ta.add=null,this.pendingAdds--}null==Ta.remove&&null==Ta.add&&this.pendingUpdates.delete(La)}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};Qa._processPendingUpdateNew=function(ra){if(ra.add){var va=
ra.add.geometry;y.isSome(va)&&"mesh"===va.type&&!va.loaded?this._processPendingUpdateNewMesh(ra,va):this._processPendingUpdateNewRenderingInfo(ra)}else ra.state=2};Qa._processPendingUpdateNewMesh=function(ra,va){ra.state=1;ra.abortController=D.createAbortController();va.load({signal:ra.abortController.signal}).then(()=>{ra.abortController=null;this._processPendingUpdateNewRenderingInfo(ra)},La=>this._processPendingUpdateNewError(ra,La))};Qa._processPendingUpdateNewError=function(ra,va){ra.abortController=
null;D.isAbortError(va)?ra.state=0:ra.state=3};Qa._processPendingUpdateNewRenderingInfo=function(ra){y.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type?(ra.renderingInfo=this._getRenderingInfo(ra.add,Ga),ra.state=2):(ra.state=1,ra.abortController=D.createAbortController(),this._getRenderingInfoAsync(ra.add,{signal:ra.abortController.signal}).then(va=>{y.isNone(va)||y.isNone(va.symbol)?(Ga&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ga.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),
ra.renderingInfo=null):ra.renderingInfo=va;ra.state=2},va=>{ra.abortController=null;D.isAbortError(va)?ra.state=0:ra.state=3}))};Qa._addGraphic=function(ra,va,La){this.graphicsWithoutSymbol.set(ra.uid,ra);if(!y.isNone(va)&&!y.isNone(va.symbol)&&O.hasGeometry(ra)){var Ta=this.getOrCreateGraphics3DSymbol(va.symbol,va.renderer);if(!y.isNone(Ta)){this.expandComputedExtent(ra.geometry);this._beginGraphicUpdate(ra);var Pa=new fa(ra,va,this.layer),sa=!1,oa=Ia=>{Ia===Ta.symbol.id&&(sa=!0)};this._whenSymbolRemoved.push(oa);
var wa=()=>{if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(oa);if(!(sa||Ta.destroyed||this.graphicSymbolSupported&&ra.symbol&&ra.symbol.id!==Ta.symbol.id)){if(this.graphicsWaitingForSymbol.has(ra.uid)){const Ia=this.createGraphics3DGraphic(Ta,Pa);this._spatialIndex&&y.isSome(Ia)&&this._spatialIndex.add(Ia)}this._endGraphicUpdate(ra)}--Ta.referenced;this.featureStore.events.emit("changed");this.labeler&&this.owner.view.labeler.setDirty()}},za=Ia=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(oa),
sa||(D.isAbortError(Ia)?this.add([ra]):Ta.destroyed||this._endGraphicUpdate(ra)))};0===La?Ta.load(()=>this._frameTask.schedule(wa),Ia=>this._frameTask.schedule(()=>za(Ia))):Ta.load(wa,za)}}};Qa._removeGraphic=function(ra){ra=ra.uid;const va=this.graphics3DGraphics.get(ra);if(va){var La;va.graphics3DSymbol.onRemoveGraphic(va);const Ta=va.usedMemory,Pa=va.isElevationSource;this._conditionalRemove(va,ra);null==(La=this._spatialIndex)?void 0:La.remove(va);this.graphicsBySymbol.get(va.graphics3DSymbol.symbol.id).delete(ra);
this.graphicsWithoutSymbol.delete(ra);this.removeGraphics3DGraphic(ra,Ta,Pa);va.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(ra),this.graphicsWaitingForSymbol.delete(ra),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Qa.hasLabelingContext=function(ra){if(ra instanceof Da||ra instanceof Ka){const va=this.symbolCreationContext.layer;return va.labelingInfo?va.labelingInfo.some(La=>La.symbol===ra):!1}return!1};
Qa.hasValidSymbolCreationContext=function(ra){return ra instanceof Da&&!this.hasLabelingContext(ra)?(Ga.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Qa._getRenderingInfo=function(ra,va){const La=ra.geometry;if(y.isNone(La))return va&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,va.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!K.canProjectWithoutEngine(La.spatialReference,
this._spatialReference))return va&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,va.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&y.isSome(ra.symbol))return va&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,va.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ra=this.rendererHasGeometryOperations?Q.hydrateGraphic(ra,this.layer):ra;
ra=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||y.isSome(this.currentRenderer))?this.owner.getRenderingInfo(ra,this.currentRenderer,y.unwrap(this.arcadeOnDemand)):{symbol:ra.symbol||Y.getDefaultSymbol3D(ra.geometry)};return y.isNone(ra)||y.isNone(ra.symbol)?(va&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,va.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):ra};Qa._getRenderingInfoAsync=function(ra,va){if(y.isNone(ra.geometry))return Ga&&
!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ga.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&y.isSome(ra.symbol))return Ga&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ga.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ra=this.rendererHasGeometryOperations?Q.hydrateGraphic(ra,this.layer):ra;return this.owner.getRenderingInfoAsync(ra,y.unwrap(this.currentRenderer),
y.unwrap(this.arcadeOnDemand),va)};Qa.createGraphics3DSymbol=function(ra,va){if(!this.hasValidSymbolCreationContext(ra))return null;ra=this.getConvertedSymbol(ra);if(!ra)return null;let La;y.isSome(va)&&"backgroundFillSymbol"in va&&va.backgroundFillSymbol&&(va=W.to3D(va.backgroundFillSymbol,!1,!0),va.symbol&&"web-style"!==va.symbol.type&&(La=va.symbol.symbolLayers));const Ta=U.make(ra,this.symbolCreationContext,La);Ta.load(()=>{const Pa=Ta.extentPadding;Pa>this.extentPadding&&this._set("extentPadding",
Pa);this.notifyChange("averageSymbolComplexity")},()=>{});return Ta};Qa.getOrCreateGraphics3DSymbol=function(ra,va){let La=this.symbols.get(ra.id);void 0===La&&(La=ra instanceof Fa?new Z(ra,Ta=>this._frameTask.schedule(Ta),Ta=>this.createGraphics3DSymbol(Ta,va)):this.createGraphics3DSymbol(ra,va),this.symbols.set(ra.id,La));y.isSome(La)&&++La.referenced;return La};Qa.trackGraphicState=function(ra){y.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new T.GraphicStateTracking(this));return this.graphicStateTracking.add(ra)};
Qa.addGraphics3DGraphic=function(ra){this._usedMemory+=ra.usedMemory;this.graphics3DGraphics.set(ra.graphic.uid,ra);this.numberOfGraphics++;ra.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};Qa.removeGraphics3DGraphic=function(ra,va,La=!1){this._usedMemory-=va;this.graphics3DGraphics.delete(ra);this.numberOfGraphics--;La&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};
Qa.createGraphics3DGraphic=function(ra,va){const La=va.graphic;this.graphicsWithoutSymbol.delete(La.uid);if(!this.symbols.has(ra.symbol.id))return this.add([La]),null;if(this.graphics3DGraphics.has(La.uid))return null;va=ra.createGraphics3DGraphic(va);if(y.isNone(va))return null;this.addGraphics3DGraphic(va);ra=ra.symbol.id;this.graphicsBySymbol.has(ra)||this.graphicsBySymbol.set(ra,new Map);this.graphicsBySymbol.get(ra).set(La.uid,va);va.isDraped&&this.graphicsDrapedUids.add(La.uid);va.centroid=
null;y.isSome(La.geometry)&&"point"!==La.geometry.type&&va instanceof ha&&(va.centroid=P.computeCentroid(La.geometry,this._spatialReference));this._updateUserVisibility(va);y.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(va);this.filterVisibility&&this.filterVisibility.updateVisibility(va);this.deconflictor&&this.deconflictor.addGraphic(va);this.labeler&&this.labeler.addGraphic(va);this.objectStates&&this.objectStates.addGraphic(va);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,
va);va.initialize(this.stage,this.stageLayer,this.owner);y.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(va);if(ra=this.whenGraphics3DGraphicRequests[La.uid])delete this.whenGraphics3DGraphicRequests[La.uid],ra.resolve(va);return va};Qa.abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};Qa.rendererChange=function(){var ra=u._asyncToGenerator(function*(va){this.abortRendererChange();
if(va!==this.currentRenderer)if(this.validateRenderer(va),y.isNone(va)&&this.currentRendererChange(null,!1),S.isSupportedRenderer3D(va))if(y.isSome(va)&&va.arcadeRequired){var La=D.createAbortController();this.rendererChangeAbortController=La;const {arcadeUtils:Ta}=yield this.ensureArcade();D.throwIfAborted(La);Ta.hasGeometryOperations(va)&&(yield Ta.enableGeometryOperations(),D.throwIfAborted(La));0===this.effectiveUpdatePolicy?yield this._frameTask.schedule(()=>this.currentRendererChange(va,!0),
La.signal):this.currentRendererChange(va,!0);this.rendererChangeAbortController=null}else 0===this.effectiveUpdatePolicy?(this.rendererChangeAbortController=La=D.createAbortController(),yield this._frameTask.schedule(()=>this.currentRendererChange(va,!1),La.signal),this.rendererChangeAbortController=null):this.currentRendererChange(va,!1);else this.currentRendererChange(va,!1)});return function(va){return ra.apply(this,arguments)}}();Qa.ensureArcade=function(){var ra=u._asyncToGenerator(function*(){y.isNone(this.arcadeOnDemand)&&
(this.arcadeOnDemand=yield V.loadArcade());return this.arcadeOnDemand});return function(){return ra.apply(this,arguments)}}();Qa.currentRendererChange=function(ra,va){this.currentRenderer=ra;this.rendererHasGeometryOperations=va;this.symbolCreationContext.arcade=y.unwrap(this.arcadeOnDemand);va=this.symbolCreationContext.renderer;if(ra!==va)if(this.symbolConversionCache.clear(),y.isNone(ra))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var La=N.diff(va,ra);this.updateUnchangedSymbolMappings(La,
ra,va);this.symbolCreationContext.renderer=ra;y.isNone(La)||("complete"===La.type?this.recreateAllGraphics():"partial"===La.type&&(this.applyRendererDiff(La,ra,va)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("averageSymbolComplexity"))}};Qa.diffHasSymbolChange=function(ra){for(const va in ra.diff)switch(va){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete ra.diff[va];break;default:return!0}return!1};
Qa.applySymbolSetDiff=function(ra,va,La){ra=ra||[];va=va||[];const Ta=[];for(const Pa of va){const sa=this.graphicsBySymbol.get(Pa.id);sa&&sa.forEach((oa,wa)=>{var za=oa.graphic,Ia=this.layer instanceof M?this.layer:null;const Sa=y.unwrap(this.arcadeOnDemand);if(Pa!==La.defaultSymbol||La.getSymbol(Q.hydrateGraphic(za,Ia),{arcade:Sa})!==La.defaultSymbol)Ia=oa.usedMemory,ra.length||La.defaultSymbol?Ta.push(za):this.graphicsWithoutSymbol.set(wa,za),za=this.graphics3DGraphics.get(wa),this._conditionalRemove(za,
wa),oa.destroy(),sa.delete(wa),this.removeGraphics3DGraphic(wa,Ia),this.updateLayerVisibility()});this._whenSymbolRemoved.forAll(oa=>oa(Pa.id))}if(ra.length||Ta.length)this.graphicsWithoutSymbol.forEach(Pa=>Ta.push(Pa)),this.graphicsWithoutSymbol.clear(),this.add(Ta);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Qa.applyUniqueValueRendererDiff=function(ra,va,La){const Ta=ra.diff.defaultSymbol,Pa=ra.diff.uniqueValueInfos;if(Ta||Pa){const sa=
Pa?Pa.added.map(wa=>wa.symbol):[],oa=Pa?Pa.removed.map(wa=>wa.symbol):[];if(Pa)for(let wa=0;wa<Pa.changed.length;wa++)sa.push(Pa.changed[wa].newValue.symbol),oa.push(Pa.changed[wa].oldValue.symbol);Ta?(La.defaultSymbol&&oa.push(La.defaultSymbol),va.defaultSymbol&&sa.push(va.defaultSymbol)):La.defaultSymbol&&sa.length&&oa.push(va.defaultSymbol);this.applySymbolSetDiff(sa,oa,va);delete ra.diff.defaultSymbol;delete ra.diff.uniqueValueInfos;return!0}return!1};Qa.calculateUnchangedSymbolMapping=function(ra,
va,La){const Ta=sa=>y.isSome(sa)?sa.id:null;if(va instanceof k&&La instanceof k&&(y.isNone(ra)||"partial"===ra.type)){var Pa=ra&&ra.diff;ra=Pa&&Pa.defaultSymbol;Pa=(Pa=Pa&&Pa.uniqueValueInfos)?Pa.unchanged.map(sa=>({oldId:Ta(sa.oldValue.symbol),newId:Ta(sa.newValue.symbol)})):La.uniqueValueInfos.map((sa,oa)=>({oldId:Ta(sa.symbol),newId:Ta(va.uniqueValueInfos[oa].symbol)}));!ra&&La.defaultSymbol&&Pa.push({oldId:Ta(La.defaultSymbol),newId:Ta(va.defaultSymbol)});return Pa}return[]};Qa.updateSymbolMapping=
function(ra,va){const La=va?"string"===typeof va?va:va.id:null;va="string"===typeof va?null:va;if(ra&&ra!==La){var Ta=this.graphicsBySymbol.get(ra);this.graphicsBySymbol.delete(ra);void 0!==Ta&&this.graphicsBySymbol.set(La,Ta);Ta=this.symbols.get(ra);void 0!==Ta&&(this.symbols.delete(ra),this.symbols.set(La,Ta),y.isSome(Ta)&&(y.isSome(va)?Ta.symbol=va:Ta.symbol.id=La))}};Qa.updateUnchangedSymbolMappings=function(ra,va,La){ra=this.calculateUnchangedSymbolMapping(ra,va,La);for(const {oldId:Ta,newId:Pa}of ra)this.updateSymbolMapping(Ta,
Pa)};Qa.applyRendererDiff=function(ra,va,La){if(this.diffHasSymbolChange(ra))return!1;if(va instanceof k&&La instanceof k&&this.applyUniqueValueRendererDiff(ra,va,La)&&0===Object.keys(ra.diff).length)return!0;for(const [Ta]of this.graphicsBySymbol)if(La=this.symbols.get(Ta),y.isSome(La)&&!La.applyRendererDiff(ra,va))return!1;return!0};Qa.opacityChange=function(){this.forEachGraphics3DSymbol((ra,va)=>ra.globalPropertyChanged("opacity",va));this.updateStageLayerVisibility()};Qa.slicePlaneEnabledChange=
function(ra){ra!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=ra,this.stageLayer.isSliceable=ra,this.forEachGraphics3DSymbol((va,La)=>va.globalPropertyChanged("slicePlaneEnabled",La)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};Qa.physicalBasedRenderingChange=function(ra){ra!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=
ra,this.forEachGraphics3DSymbol((va,La,Ta)=>{va.globalPropertyChanged("physicalBasedRenderingEnabled",La)||this._recreateSymbol(Ta)}))};Qa.pixelRatioChange=function(){this.forEachGraphics3DSymbol((ra,va,La)=>{ra.globalPropertyChanged("pixelRatio",va)||this._recreateSymbol(La)})};Qa._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=C.schedule(()=>{this._updatingPendingLoadedGraphicsChange=
null})};Qa.setClippingExtent=function(ra,va){const La=this.symbolCreationContext.clippingExtent,Ta=J.create();ia.toBoundingRect(ra,Ta,va)?this.symbolCreationContext.clippingExtent=H.fromRect(H.create(),Ta):this.symbolCreationContext.clippingExtent=null;return!H.equals(this.symbolCreationContext.clippingExtent,La)};Qa.modifyGraphics3DGraphicVisibilities=function(ra){let va=!1;this.graphics3DGraphics.forEach(La=>{ra(La)&&(va=!0)});va&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};
Qa.forEachGraphics3DSymbol=function(ra){for(const [va,La]of this.symbols){if(y.isNone(La))break;const Ta=this.graphicsBySymbol.get(va);ra(La,Ta||Ra,va)}};Qa.updateAllGraphicsVisibility=function(){this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(ra=>{const va=this._updateUserVisibility(ra);ra=y.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(ra);return va||ra})};Qa.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(ra=>
ra.setVisibilityFlag(0,!1,0))};Qa.validateRenderer=function(ra){(ra=S.validateTo3D(ra))&&Ga.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,ra.message)};Qa.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Qa._cleanupSymbols=function(){if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var ra=!1;this.symbols.forEach((va,
La)=>{if(!(y.isNone(va)||0<va.referenced)){var Ta=this.graphicsBySymbol.get(La);Ta&&0!==Ta.size||(this.graphicsBySymbol.delete(La),this.symbols.delete(La),va&&va.destroy(),ra=!0)}});ra&&(this.recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};Qa.snapshotInternals=function(){return{graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(ra=>({symbolId:ra,graphics:[...this.graphicsBySymbol.get(ra).keys()].sort()})),
graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}};u._createClass(Ua,[{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new X.SpatialIndex2D({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();
return this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return y.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?0:y.unwrapOr(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var ra,va;return!!(0<this.graphicsWaitingForSymbol.size||this.running||null!=(ra=this.elevationAlignment)&&ra.updating||y.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(va=this.filterVisibility)&&va.updating||this.rendererChangeAbortController||
this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},{key:"running",get:function(){var ra;return 0<this.pendingUpdates.size||!(null==(ra=this._spatialIndex)||!ra.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var ra;return this.owner.suspended||(null==(ra=this.owner.suspendInfo)?void 0:ra.outsideOfView)}},{key:"updatingRemaining",get:function(){var ra,va;return this.updating?this.pendingUpdates.size+.1*((null==(ra=this._spatialIndex)?
void 0:ra.updatingRemaining)||0)+.1*((null==(va=this.elevationAlignment)?void 0:va.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var ra=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const va=ra?ra.graphics3D.minTotalNumberOfFeatures:0,La=ra?ra.graphics3D.maxTotalNumberOfFeatures:0;ra=ra?ra.graphics3D.maxTotalNumberOfPrimitives:0;const Ta=this.averageSymbolComplexity;var Pa=Math.max(1,y.isSome(Ta)?Ta.primitivesPerFeature:1),sa=y.isSome(Ta)&&0<Ta.drawCallsPerFeature?
La/Ta.drawCallsPerFeature*.3:La;Pa=Math.max(va,Math.min(La,Math.ceil(ra/Pa),sa));return(sa=this._get("displayFeatureLimit"))&&sa.minimumTotalNumberOfFeatures===va&&sa.maximumTotalNumberOfFeatures===La&&sa.maximumTotalNumberOfPrimitives===ra&&sa.averageSymbolComplexity===Ta&&sa.maximumNumberOfFeatures===Pa?sa:{minimumTotalNumberOfFeatures:va,maximumTotalNumberOfFeatures:La,maximumTotalNumberOfPrimitives:ra,averageSymbolComplexity:Ta,maximumNumberOfFeatures:Pa}}},{key:"averageSymbolComplexity",get:function(){const ra=
aa.averageSymbolComplexities(this.symbolComplexities),va=this._get("averageSymbolComplexity");return 0===ra.numComplexities||y.isSome(va)&&(ra.estimated&&(va.primitivesPerFeature>=ra.primitivesPerFeature||va.primitivesPerCoordinate>=ra.primitivesPerCoordinate||va.drawCallsPerFeature>=ra.drawCallsPerFeature)||va.primitivesPerFeature===ra.primitivesPerFeature&&va.primitivesPerCoordinate===ra.primitivesPerCoordinate&&va.drawCallsPerFeature===ra.drawCallsPerFeature)?va:ra}},{key:"spatialReference",get:function(){return this._spatialReference}},
{key:"usedMemory",get:function(){const ra=y.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+ra}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?30<Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics?0:this._usedMemory/this.numberOfGraphics:y.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+
(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const ra=this.owner.layer&&this.owner.layer.objectIdField;if(!ra)return null;
const va=new Map;this.graphics3DGraphics.forEach(La=>{if(La){var Ta=this._getGraphicObjectID(La.graphic,ra);y.isSome(Ta)&&va.set(Ta,La)}});return va}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let ra=0,va=0;return A.someMap(this.symbols,(La,Ta)=>{if(y.isSome(La)){La=La.getFastUpdateStatus();if(0<La.loading)return!0;this.graphicsBySymbol.has(Ta)&&(va+=La.fast,
ra+=La.slow)}return!1})?"unknown":0<=va&&0===ra?"fast":0<=ra&&0===va?"slow":"mixed"}},{key:"test",get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:ra=>{this.forcedUpdatePolicy=ra}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return Ua}(z);a.Graphics3DCore.tmpVec=G.create();f.__decorate([v.property({readOnly:!0})],
a.Graphics3DCore.prototype,"computedExtent",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"elevationInfoChangeAbortController",void 0);f.__decorate([v.property()],
a.Graphics3DCore.prototype,"setupAbortController",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"elevationAlignment",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"scaleVisibility",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"filterVisibility",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",
void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"featureStore",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"deconflictor",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"labeler",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"objectStates",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,
"preferredUpdatePolicy",void 0);f.__decorate([v.property()],a.Graphics3DCore.prototype,"forcedUpdatePolicy",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",
void 0);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);f.__decorate([v.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);f.__decorate([v.property({readOnly:!0,
dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);f.__decorate([v.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);f.__decorate([v.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"hasZ",void 0);f.__decorate([v.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);a.Graphics3DCore=ua=f.__decorate([L.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);let ma=function(){function ea(){this.renderingInfo=this.add=null;this.state=0;this.remove=null}ea.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=0;this.remove=this.abortController=null};return ea}();const ya=G.create(),Ma=G.create(),Ra=new Map;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,u,f,p,t){function w(h){return p.isNone(h)||"simple"===h.type||"unique-value"===h.type||"class-breaks"===h.type||"dictionary"===h.type}function e(h,k){if(!k)return null;k=Array.isArray(k)?k:[k];if(0<k.length){const l=k.map(z=>z.details.symbol.type||z.details.symbol.declaredClass).filter(z=>!!z);
l.sort();const m=[];l.forEach((z,r)=>{0!==r&&z===l[r-1]||m.push(z)});return new f("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${m.join(", ")}) which are not supported in 3D`,{renderer:h,symbolErrors:k})}return null}function n(h){const k=h.uniqueValueInfos.map(m=>t.to3D(m.symbol).error).filter(m=>!!m),l=t.to3D(h.defaultSymbol);l.error&&k.unshift(l.error);return e(h,k)}function b(h){const k=h.classBreakInfos.map(m=>t.to3D(m.symbol).error).filter(m=>!!m),l=t.to3D(h.defaultSymbol);
l.error&&k.unshift(l.error);return e(h,k)}a.isSupportedRenderer3D=w;a.validateTo3D=function(h){if(p.isNone(h))return null;if(!w(h))return new f("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${h.type||h.declaredClass}'`,{renderer:h});switch(h.type){case "simple":return e(h,t.to3D(h.symbol).error);case "unique-value":return n(h);case "class-breaks":return b(h)}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaults ./defaultsJSON".split(" "),
function(a,u,f,p,t,w,e,n,b,h){const k=e.fromSimpleMarkerSymbol(b.defaultPointSymbol2D),l=t.fromSimpleLineSymbol(b.defaultPolylineSymbol2D),m=n.fromSimpleFillSymbol(b.defaultPolygonSymbol2D),z=new w({symbolLayers:[new p({material:{color:h.defaultColor},edges:{type:"solid",size:"1px",color:h.defaultOutlineColor}})]});a.getDefaultSymbol3D=function(r){if(f.isNone(r))return null;switch(r.type){case "mesh":return z;case "point":case "multipoint":return k;case "polyline":return l;case "polygon":case "extent":return m}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){a.Graphics3DFeatureStore=function(A){function q(x){var D=A.call(this,x)||this;D.events=new t;D.hasZ=null;D.hasM=null;D.objectIdField=null;D.spatialReference=null;D.featureAdapter={getAttribute(C,B){return"graphic"in C?C.graphic.attributes[B]:d.optimizedFeatureQueryEngineAdapter.getAttribute(C,B)},getAttributes(C){return"graphic"in C?C.graphic.attributes:d.optimizedFeatureQueryEngineAdapter.getAttributes(C)},getObjectId:C=>"graphic"in C?z.getObjectId(C.graphic,
D.objectIdField):d.optimizedFeatureQueryEngineAdapter.getObjectId(C),getGeometry:C=>"graphic"in C?C.getAsOptimizedGeometry(D.hasZ,D.hasM):d.optimizedFeatureQueryEngineAdapter.getGeometry(C),getCentroid:(C,B)=>{if("graphic"in C){let v=null;w.isSome(C.centroid)?v=C.centroid:"point"===C.graphic.geometry.type&&m.projectPoint(C.graphic.geometry,g,D.spatialReference)&&(v=g);C=Array(2+(B.hasZ?1:0)+(B.hasM?1:0));w.isNone(v)?(C[0]=0,C[1]=0,C[2]=0,C[3]=0):(C[0]=v.x,C[1]=v.y,B.hasZ&&(C[2]=v.hasZ?v.z:0),B.hasM&&
(C[B.hasZ?3:2]=v.hasM?v.m:0));return new c([],C)}return d.optimizedFeatureQueryEngineAdapter.getCentroid(C,B)},cloneWithGeometry:(C,B)=>"graphic"in C?new r(B,D.featureAdapter.getAttributes(C),null,D.featureAdapter.getObjectId(C)):d.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(C,B)};return D}u._inheritsLoose(q,A);var y=q.prototype;y.forEach=function(x){this.forAllGraphics(D=>{x(D)})};y.forEachInBounds=function(x,D){this.getSpatialIndex().forEachInBounds(x,D)};y.forEachBounds=function(x,D,C){const B=
this.getSpatialIndex();for(const v of x)x=this.featureAdapter.getObjectId(v),w.isSome(B.getBounds(x,C))&&D(C)};return q}(p);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forAllGraphics",void 0);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,
"hasM",void 0);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);f.__decorate([e.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"spatialReference",void 0);a.Graphics3DFeatureStore=f.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const g={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};a.default=a.Graphics3DFeatureStore;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,u,f,p){const t={getObjectId(w){return w.objectId},getAttributes(w){return w.attributes},getAttribute(w,e){return w.attributes[e]},cloneWithGeometry(w,e){return new f(e,w.attributes,null,w.objectId)},getGeometry(w){return w.geometry},getCentroid(w,e){w.centroid||(w.centroid=u.getCentroidOptimizedGeometry(new p,w.geometry,e.hasZ,
e.hasM));return w.centroid}};a.default=t;a.optimizedFeatureQueryEngineAdapter=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function u(p,t,w,e,n,b,h=1){b=n?b?4:3:b?3:2;let k=w,l=w+b,m=0,z=0,r=w=0,c=0;for(let d=0,g=e-1;d<g;d++,k+=b,l+=b){e=t[k];const A=t[k+1],q=t[k+2],y=t[l],x=t[l+1],D=t[l+2];let C=e*x-y*A;r+=C;m+=(e+y)*C;z+=(A+x)*C;n&&(C=e*D-y*q,w+=(q+D)*C,c+=C);e<p[0]&&(p[0]=e);e>p[1]&&(p[1]=e);A<p[2]&&(p[2]=A);A>p[3]&&
(p[3]=A);n&&(q<p[4]&&(p[4]=q),q>p[5]&&(p[5]=q))}0<r*h&&(r*=-1);0<c*h&&(c*=-1);if(!r)return null;p=[m,z,.5*r];n&&(p[3]=w,p[4]=.5*c);return p}function f(p,t,w,e,n){n=e?n?4:3:n?3:2;let b=t,h=t+n,k=0,l=0,m=0,z=0;for(let g=0,A=w-1;g<A;g++,b+=n,h+=n){var r=p[b];const q=p[b+1],y=p[b+2],x=p[h],D=p[h+1],C=p[h+2];if(e){{var c=x-r;var d=D-q;const B=C-y;c=Math.sqrt(c*c+d*d+B*B)}}else c=x-r,d=D-q,c=Math.sqrt(c*c+d*d);c&&(k+=c,e?(r=[r+.5*(x-r),q+.5*(D-q),y+.5*(C-y)],l+=c*r[0],m+=c*r[1],z+=c*r[2]):(r=[r+.5*(x-r),
q+.5*(D-q)],l+=c*r[0],m+=c*r[1]))}return 0<k?e?[l/k,m/k,z/k]:[l/k,m/k]:0<w?e?[p[t],p[t+1],p[t+2]]:[p[t],p[t+1]]:null}a.getCentroidOptimizedGeometry=function(p,t,w,e,n){if(!t||!t.lengths.length)return null;const b="upperLeft"===(null==n?void 0:n.originPosition)?-1:1;p.lengths.length&&(p.lengths.length=0);p.coords.length&&(p.coords.length=0);n=p.coords;const h=[],k=w?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:
[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:m}=t,z=w?e?4:3:e?3:2;let r=0;for(var c of l){const d=u(k,m,r,c,w,e,b);d&&h.push(d);r+=c*z}h.sort((d,g)=>{let A=b*d[2]-b*g[2];0===A&&w&&(A=d[4]-g[4]);return A});h.length&&(c=6*h[0][2],n[0]=h[0][0]/c,n[1]=h[0][1]/c,w&&(c=6*h[0][4],n[2]=0!==c?h[0][3]/c:0),n[0]<k[0]||n[0]>k[1]||n[1]<k[2]||n[1]>k[3]||w&&(n[2]<k[4]||n[2]>k[5]))&&(n.length=0);if(!n.length)if(t=t.lengths[0]?f(m,0,l[0],w,
e):null)n[0]=t[0],n[1]=t[1],w&&2<t.length&&(n[2]=t[2]);else return null;return p};a.lineCentroid=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){a.Graphics3DSymbolCreationContext=function(u){this.schedule=u;this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=
this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,u,f){a.make=function(p,t,w){let e;switch(p.type){case "point-3d":e=u;break;default:e=f}return new e(p,
t,w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/asyncUtils","../../../../core/promiseUtils","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(a,u,f,p,t){return function(w){function e(b,h,k){b=w.call(this,b,h,k)||this;b.calloutSymbolLayer=null;b.symbol.hasVisibleCallout()&&(b.calloutSymbolLayer=p.make(b.symbol,h));return b}a._inheritsLoose(e,
w);var n=e.prototype;n.doLoad=function(){var b=a._asyncToGenerator(function*(h){const k=this.calloutSymbolLayer?u.result(this.calloutSymbolLayer.load()):null;try{yield w.prototype.doLoad.call(this,h)}catch(z){var l;null==(l=this.calloutSymbolLayer)?void 0:l.abortLoad();throw z;}if(f.isAborted(h)){var m;null==(m=this.calloutSymbolLayer)?void 0:m.abortLoad();throw f.createAbortError();}k&&(yield k)});return function(h){return b.apply(this,arguments)}}();n.destroy=function(){w.prototype.destroy.call(this);
this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};n.createGraphics3DGraphic=function(b,h){h=w.prototype.createGraphics3DGraphic.call(this,b,h);this.calloutSymbolLayer&&(b=this.createCalloutGraphic(b))&&h.addAuxiliaryGraphic(b);return h};n.globalPropertyChanged=function(b,h){return w.prototype.globalPropertyChanged.call(this,b,h)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(b,h,k=>this._getCalloutGraphicLayer(k)):!0:!1};n.updateGeometry=function(b,h){const k=w.prototype.updateGeometry.call(this,
b,h);return k&&this.calloutSymbolLayer&&(b=this._getCalloutGraphicLayer(b))?this.calloutSymbolLayer.updateGeometry(b,h):k};n.createCalloutGraphic=function(b){const h=b.renderingInfo;b.renderingInfo={renderer:h.renderer,symbol:h.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(b)};n._getCalloutGraphicLayer=function(b){for(const h of b._auxiliaryGraphics)if(h.graphics3DSymbolLayer===
this.calloutSymbolLayer)return h};return e}(t)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,u,f,p){let t=function(){function w(n){this.graphicsCore=n;this.idToState=new Map;this.states=new Set;const b=n.owner.layer&&n.owner.layer.objectIdField;b?(this.getGraphicId=h=>p.getObjectId(h,b),this.getGraphics3DGraphicById=h=>this.graphicsCore.getGraphics3DGraphicByObjectId(h)):
(this.getGraphicId=h=>h.uid,this.getGraphics3DGraphicById=h=>this.graphicsCore.getGraphics3DGraphicById(h))}var e=w.prototype;e.destroy=function(){this.idToState.clear();this.states.forEach((n,b)=>this.remove(b))};e.add=function(n){const b={remove:()=>this.remove(n)};if(this.states.has(n))return b;const h=this.getGraphicId(n.graphic),k=this.getGraphics3DGraphicById(h);this.states.has(n)||this.states.add(n);this.ensureStateList(h).push(n);n.displaying=f.isSome(k)?k.isVisible():!1;n.isDraped=f.isSome(k)?
k.isDraped:!1;n.tracking=!0;f.isSome(k)&&n.emit("changed",{});return b};e.remove=function(n){if(this.states.has(n)){if(this.idToState.size){const b=this.getGraphicId(n.graphic),h=this.idToState.get(b);h&&(u.remove(h,n),0===h.length&&this.idToState.delete(b))}this.states.delete(n);n.tracking=!1;n.displaying=!1}};e.addGraphic=function(n){this.forEachState(n,b=>{b.displaying=n.isVisible();b.isDraped=n.isDraped;b.emit("changed",{})})};e.removeGraphic=function(n){this.forEachState(n,b=>{b.displaying=!1;
b.isDraped=!1})};e.updateGraphicGeometry=function(n){this.forEachState(n,b=>{b.emit("changed",{})})};e.updateGraphicVisibility=function(n){this.forEachState(n,b=>{b.displaying=n.isVisible()})};e.allGraphicsDeleted=function(){this.states.forEach(n=>{n.displaying=!1})};e.ensureStateList=function(n){var b=this.idToState.get(n);if(b)return b;b=[];this.idToState.set(n,b);return b};e.forEachState=function(n,b){0!==this.states.size&&0!==this.idToState.size&&(n=this.getGraphicId(n.graphic),n=this.idToState.get(n),
null!=n&&n.forEach(b))};return w}();a.GraphicStateTracking=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.SpatialIndex2D=function(r){function c(g){g=r.call(this,g)||this;g._index=new k.PooledRBush(9,t("csp-restrictions")?A=>({minX:A.extent[0],minY:A.extent[1],maxX:A.extent[2],maxY:A.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);g._missing=new Set;g._boundsByFeature=new Map;g.spatialReference=null;g.hasZ=null;g.hasM=null;g.objectIdField=null;g.updating=!1;return g}u._inheritsLoose(c,r);var d=c.prototype;d.setup=function(g){this._addMany(g)};d.destroy=
function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};d.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};d.queryGraphicUIDsInExtent=function(g,A,q){A.equals(this.spatialReference)&&(z.minX=g[0],z.minY=g[1],z.maxX=g[2],z.maxY=g[3],this.update(),this._index.search(z,y=>q(y.graphic.uid)))};d.add=function(g){this._missing.add(g);this.updating=!0};
d.remove=function(g){this._missing.delete(g)?this.updating=0<this._missing.size:(this._index.remove(g),g=m.getObjectId(g.graphic,this._get("objectIdField")),null!=g&&this._boundsByFeature.delete(g))};d._addMany=function(g){if(0!==g.length){var A=this._get("objectIdField");for(const q of g){q.computeExtent(this.spatialReference);const y=m.getObjectId(q.graphic,A);null!=y&&this._boundsByFeature.set(y,q.extent)}this._index.load(g)}};d.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};d.forEachInBounds=function(g,A){z.minX=g[0];z.minY=g[1];z.maxX=g[2];z.maxY=g[3];this.update();this._index.search(z,q=>{A(q)})};d.getBounds=function(g,A){this.update();return(g=this._boundsByFeature.get(g))?l.fromRect(A,g):null};u._createClass(c,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return c}(p);f.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);f.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);f.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);f.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);f.__decorate([w.property()],a.SpatialIndex2D.prototype,"updating",void 0);f.__decorate([w.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=f.__decorate([h.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const z={minX:0,minY:0,maxX:0,
maxY:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,u,f,p,t,w){function e(B,v){n(B,0,B.children.length,v,B)}function n(B,v,E,F,L){L||(L=new D([]));L.minX=Infinity;L.minY=Infinity;L.maxX=-Infinity;L.maxY=-Infinity;for(let N=v,I;N<E;N++)I=B.children[N],b(L,B.leaf?F(I):I);return L}function b(B,
v){B.minX=Math.min(B.minX,v.minX);B.minY=Math.min(B.minY,v.minY);B.maxX=Math.max(B.maxX,v.maxX);B.maxY=Math.max(B.maxY,v.maxY)}function h(B,v){return B.minX-v.minX}function k(B,v){return B.minY-v.minY}function l(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function m(B){return B.maxX-B.minX+(B.maxY-B.minY)}function z(B,v){return B.minX<=v.minX&&B.minY<=v.minY&&v.maxX<=B.maxX&&v.maxY<=B.maxY}function r(B,v){return v.minX<=B.maxX&&v.minY<=B.maxY&&v.maxX>=B.minX&&v.maxY>=B.minY}function c(B,v,E,F,L){for(v=
[v,E];v.length;){E=p.assumeNonNull(v.pop());const N=p.assumeNonNull(v.pop());if(E-N<=F)continue;const I=N+Math.ceil((E-N)/F/2)*F;w.quickselect(B,I,N,E,L);v.push(N,I,I,E)}}let d=function(){function B(E=9,F){this.compareMinX=h;this.compareMinY=k;this.toBBox=function(L){return L};this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this.toBBox=F:this._initFormat(F));this.clear()}var v=B.prototype;v.destroy=function(){this.clear();g.prune();
A.prune();q.prune();y.prune()};v.all=function(E){this._all(this.data,E)};v.search=function(E,F){let L=this.data;const N=this.toBBox;if(r(E,L))for(g.clear();L;){for(let I=0,G=L.children.length;I<G;I++){const K=L.children[I],H=L.leaf?N(K):K;r(E,H)&&(L.leaf?F(K):z(E,H)?this._all(K,F):g.push(K))}L=g.pop()}};v.collides=function(E){let F=this.data;const L=this.toBBox;if(!r(E,F))return!1;for(g.clear();F;){for(let N=0,I=F.children.length;N<I;N++){const G=F.children[N],K=F.leaf?L(G):G;if(r(E,K)){if(F.leaf||
z(E,K))return!0;g.push(G)}}F=g.pop()}return!1};v.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let F=0,L=E.length;F<L;F++)this.insert(E[F]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this.data.children.length)if(this.data.height===E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){const F=this.data;this.data=E;E=F}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this};v.insert=function(E){E&&this._insert(E,
this.data.height-1);return this};v.clear=function(){this.data=new D([]);return this};v.remove=function(E){if(!E)return this;let F=this.data,L=null,N=0,I=!1,G;const K=this.toBBox(E);q.clear();for(y.clear();F||0<q.length;){if(!F){var H;F=p.assumeNonNull(q.pop());L=q.data[q.length-1];N=null!=(H=y.pop())?H:0;I=!0}if(F.leaf&&(G=f.indexOf(F.children,E,F.children.length,F.indexHint),-1!==G)){F.children.splice(G,1);q.push(F);this._condense(q);break}I||F.leaf||!z(F,K)?L?(N++,F=L.children[N],I=!1):F=null:(q.push(F),
y.push(N),N=0,L=F,F=F.children[0])}return this};v.toJSON=function(){return this.data};v.fromJSON=function(E){this.data=E;return this};v._all=function(E,F){for(A.clear();E;){var L;if(!0===E.leaf)for(const N of E.children)F(N);else A.pushArray(E.children);E=null!=(L=A.pop())?L:null}};v._build=function(E,F,L,N){var I=L-F+1,G=this._maxEntries;if(I<=G)return E=new D(E.slice(F,L+1)),e(E,this.toBBox),E;N||(N=Math.ceil(Math.log(I)/Math.log(G)),G=Math.ceil(I/G**(N-1)));const K=new C([]);K.height=N;I=Math.ceil(I/
G);G=I*Math.ceil(Math.sqrt(G));for(c(E,F,L,G,this.compareMinX);F<=L;F+=G){const H=Math.min(F+G-1,L);c(E,F,H,I,this.compareMinY);for(let J=F;J<=H;J+=I)K.children.push(this._build(E,J,Math.min(J+I-1,H),N-1))}e(K,this.toBBox);return K};v._chooseSubtree=function(E,F,L,N){for(;;){N.push(F);if(!0===F.leaf||N.length-1===L)break;let I=Infinity,G=Infinity,K=void 0;for(let H=0,J=F.children.length;H<J;H++){const M=F.children[H],O=l(M),Q=(Math.max(M.maxX,E.maxX)-Math.min(M.minX,E.minX))*(Math.max(M.maxY,E.maxY)-
Math.min(M.minY,E.minY))-O;Q<G?(G=Q,I=O<I?O:I,K=M):Q===G&&O<I&&(I=O,K=M)}F=K||F.children[0]}return F};v._insert=function(E,F,L){var N=this.toBBox;L=L?E:N(E);q.clear();N=this._chooseSubtree(L,this.data,F,q);N.children.push(E);for(b(N,L);0<=F;)if(q.data[F].children.length>this._maxEntries)this._split(q,F),F--;else break;this._adjustParentBBoxes(L,q,F)};v._split=function(E,F){const L=E.data[F];var N=L.children.length;const I=this._minEntries;this._chooseSplitAxis(L,I,N);(N=this._chooseSplitIndex(L,I,
N))?(N=L.children.splice(N,L.children.length-N),N=L.leaf?new D(N):new C(N),N.height=L.height,e(L,this.toBBox),e(N,this.toBBox),F?E.data[F-1].children.push(N):this._splitRoot(L,N)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};v._splitRoot=function(E,F){this.data=new C([E,F]);this.data.height=E.height+1;e(this.data,this.toBBox)};v._chooseSplitIndex=function(E,F,L){let N,I,G=void 0;N=I=Infinity;for(let H=F;H<=L-F;H++){var K=n(E,0,H,this.toBBox);const J=n(E,H,
L,this.toBBox),M=Math.max(0,Math.min(K.maxX,J.maxX)-Math.max(K.minX,J.minX))*Math.max(0,Math.min(K.maxY,J.maxY)-Math.max(K.minY,J.minY));K=l(K)+l(J);M<N?(N=M,G=H,I=K<I?K:I):M===N&&K<I&&(I=K,G=H)}return G};v._chooseSplitAxis=function(E,F,L){const N=E.leaf?this.compareMinX:h,I=E.leaf?this.compareMinY:k,G=this._allDistMargin(E,F,L,N);F=this._allDistMargin(E,F,L,I);G<F&&E.children.sort(N)};v._allDistMargin=function(E,F,L,N){E.children.sort(N);N=this.toBBox;var I=n(E,0,F,N);const G=n(E,L-F,L,N);let K=
m(I)+m(G);for(let H=F;H<L-F;H++){const J=E.children[H];b(I,E.leaf?N(J):J);K+=m(I)}for(L=L-F-1;L>=F;L--)I=E.children[L],b(G,E.leaf?N(I):I),K+=m(G);return K};v._adjustParentBBoxes=function(E,F,L){for(;0<=L;L--)b(F.data[L],E)};v._condense=function(E){for(let F=E.length-1;0<=F;F--){const L=E.data[F];if(0===L.children.length)if(0<F){const N=E.data[F-1],I=N.children;I.splice(f.indexOf(I,L,I.length,N.indexHint),1)}else this.clear();else e(L,this.toBBox)}};v._initFormat=function(E){const F=["return a"," - b",
";"];this.compareMinX=new Function("a","b",F.join(E[0]));this.compareMinY=new Function("a","b",F.join(E[1]));this.toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return B}();const g=new t,A=new t,q=new t,y=new t({deallocator:void 0});t=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let x=function(B){function v(){var E=B.apply(this,arguments)||this;E.height=1;E.indexHint=new f.PositionHint;return E}u._inheritsLoose(v,
B);return v}(t),D=function(B){function v(E){var F=B.call(this)||this;F.children=E;F.leaf=!0;return F}u._inheritsLoose(v,B);return v}(x),C=function(B){function v(E){var F=B.call(this)||this;F.children=E;F.leaf=!1;return F}u._inheritsLoose(v,B);return v}(x);a.BBox=t;a.PooledRBush=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var u={exports:{}};(function(f){(function(p){p=p();void 0!==p&&(f.exports=p)})(function(){function p(e,
n,b,h,k){for(;h>b;){if(600<h-b){var l=h-b+1,m=n-b+1,z=Math.log(l),r=.5*Math.exp(2*z/3);z=.5*Math.sqrt(z*r*(l-r)/l)*(0>m-l/2?-1:1);p(e,n,Math.max(b,Math.floor(n-m*r/l+z)),Math.min(h,Math.floor(n+(l-m)*r/l+z)),k)}l=e[n];m=b;r=h;t(e,b,n);for(0<k(e[h],l)&&t(e,b,h);m<r;){t(e,m,r);m++;for(r--;0>k(e[m],l);)m++;for(;0<k(e[r],l);)r--}0===k(e[b],l)?t(e,b,r):(r++,t(e,r,h));r<=n&&(b=r+1);n<=r&&(h=r-1)}}function t(e,n,b){var h=e[n];e[n]=e[b];e[b]=h}function w(e,n){return e<n?-1:e>n?1:0}return function(e,n,b,h,
k){p(e,n,b||0,h||e.length-1,k||w)}})})(u);a.quickselect=u.exports})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){const y=e.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");a.StageLayerElevationProvider=function(F){function L(I){I=F.call(this,I)||this;I.elevationOffset=0;I._layerHandes=new w;return I}u._inheritsLoose(L,F);var N=L.prototype;N.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new q.Intersector(this.view.state.viewingMode);this.intersector.options.store=
0;var I=this.computeLayerExtent(this.stageLayer);this.zmin=I[2];this.zmax=I[5];I=this.stageLayer.events;this._layerHandes.add([I.on("layerObjectAdded",G=>this.objectChanged(G.object)),I.on("layerObjectRemoved",G=>this.objectChanged(G.object)),I.on("objectGeometryAdded",G=>this.objectChanged(G.object)),I.on("objectGeometryRemoved",G=>this.objectChanged(G.object)),I.on("vertexAttrsUpdated",G=>this.objectChanged(G.object)),I.on("objectTransformation",G=>this.objectChanged(G))])};N.dispose=function(){this._layerHandes.destroy()};
N.elevationInfoChanged=function(){const I=null!=this.layer?this.layer.elevationInfo:null;if(null!=I&&"on-the-ground"!==I.mode){const G=b.getMetersPerVerticalUnitForSR(this.layer.spatialReference),K=A.getMetersPerUnit(I.unit);this.elevationOffset=n.unwrapOr(I.offset,0)*K/G}else this.elevationOffset=0};N.getElevation=function(I,G,K,H){B[0]=I;B[1]=G;B[2]=K;if(!this.renderCoordsHelper.toRenderCoords(B,H,B))return y.error("could not project point for elevation alignment"),null;I=this.elevationOffset;G=
this.zmin+I;this.renderCoordsHelper.setAltitude(v,this.zmax+I,B);this.renderCoordsHelper.setAltitude(E,G,B);this.intersector.reset(v,E);this.intersector.intersect(this.intersectLayers,null,null,1,null,J=>J.metadata&&J.metadata.isElevationSource);return this.intersector.results.min.getIntersectionPoint(B)?this.renderCoordsHelper.getAltitude(B):null};N.objectChanged=function(I){var G;if(null!=(G=I.metadata)&&G.isElevationSource&&this.spatialReference){d.empty(x);I.metadata.lastValidElevationBB.isEmpty()||
this.expandExtent(I.metadata.lastValidElevationBB.min,I.metadata.lastValidElevationBB.max,x);G=I.boundingVolumeWorldSpace.min;var K=I.boundingVolumeWorldSpace.max;this.expandExtent(G,K,x);d.toRect(x,D);this.zmin=Math.min(this.zmin,x[2]);this.zmax=Math.max(this.zmax,x[5]);C.extent=D;C.spatialReference=this.spatialReference;this.emit("elevation-change",C);r.copy(I.metadata.lastValidElevationBB.min,G);r.copy(I.metadata.lastValidElevationBB.max,K)}};N.computeLayerExtent=function(I){d.empty(x);I.objects.forAll(G=>
this.expandExtent(G.boundingVolumeWorldSpace.min,G.boundingVolumeWorldSpace.max,x));return x};N.expandExtent=function(I,G,K){for(let H=0;8>H;++H)B[0]=H&1?I[0]:G[0],B[1]=H&2?I[1]:G[1],B[2]=H&4?I[2]:G[2],this.renderCoordsHelper.fromRenderCoords(B,B,this.spatialReference),d.expandWithVec3(K,B);return K};return L}(t.EventedMixin(p));f.__decorate([h.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);f.__decorate([h.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);f.__decorate([h.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);f.__decorate([h.property({readOnly:!0,aliasOf:"view.spatialReference"})],a.StageLayerElevationProvider.prototype,"spatialReference",void 0);a.StageLayerElevationProvider=f.__decorate([z.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const x=d.empty(),D=g.empty(),C={spatialReference:null,extent:D,context:"scene"},B=c.create(),
v=c.create(),E=c.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){f=function(r){function c(){var g=r.apply(this,arguments)||this;g.dirtyExtents=new m.ExtentSet;g.globalDirty=!1;g.averageExtentUpdateSize=0;g.dirtyGraphicsSet=new Set;g.handles=new t;g.updateElevation=!1;g.layerView=null;g.graphicsCore=null;g.events=new p;return g}a._inheritsLoose(c,r);var d=c.prototype;d.setup=function(g,A,q,y){this.layerView=g;this.queryGraphicUIDsInExtent=A;this.graphicsCore=q;this.elevationProvider=y;g=this.layerView.view.resourceController.scheduler;
this.handles.add([y.on("elevation-change",x=>this._elevationChanged(x)),this.layerView.watch("suspended",()=>this.suspendedChange()),g.registerTask(z.TaskPriority.ELEVATION_ALIGNMENT,this)])};d.destroy=function(){this.dirtyGraphicsSet.clear();this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};d.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};d.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=
!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};d.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};d.runTask=function(g){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,g.madeProgress());for(g.run(()=>this.dirtyExtents.merge(g));this.running&&!g.done;)this._updateDirtyGraphics(g),this._updateDirtyExtents(g);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};
d._updateDirtyGraphics=function(g){const A=this.layerView.view.renderCoordsHelper,q=0===this.graphicsCore.effectiveUpdatePolicy;for(const y of this.dirtyGraphicsSet.keys()){const x=this.graphicsCore.getGraphics3DGraphicById(y);this.dirtyGraphicsSet.delete(y);w.isSome(x)&&(x.alignWithElevation(this.elevationProvider,A,q),g.madeProgress());if(g.done)break}};d._updateDirtyExtents=function(g){for(;!this.dirtyExtents.empty&&!g.done;){const A=this.dirtyExtents.pop(),q=this.elevationProvider.spatialReference;
this.events.emit("invalidate-elevation",{extent:A,spatialReference:q});const y=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(A,q,x=>{const D=this.graphicsCore.getGraphics3DGraphicById(x);w.isSome(D)&&D.needsElevationUpdates()&&this.dirtyGraphicsSet.add(x)});this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-y)+.9*this.averageExtentUpdateSize;g.madeProgress()}};d.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((g,
A)=>this.dirtyGraphicsSet.add(A))};d._elevationChanged=function(g){if("scene"!==g.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:A,spatialReference:q}=g;this.layerView.suspended?(this.updateElevation||(g=this.graphicsCore.computedExtent)&&A[2]>g.xmin&&A[0]<g.xmax&&A[3]>g.ymin&&A[1]<g.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:A,spatialReference:q})):(-Infinity===A[0]?this.globalDirty=
!0:this.dirtyExtents.add(A),this.notifyChange("updating"))}};a._createClass(c,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}}]);return c}(f);u.__decorate([e.property({readOnly:!0})],f.prototype,"updating",null);u.__decorate([e.property({readOnly:!0})],
f.prototype,"updatingRemaining",null);return f=u.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],f)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,u,f,p,t){let w=function(){function e(){this._extents=new f({allocator:b=>b||p.create()});this._tmpExtent=p.create();this._dirty=
!1}var n=e.prototype;n.clear=function(){this._extents.clear()};n.add=function(b){this.contains(b)||(this.removeContained(b),p.set(this._extents.pushNew(),b),this._dirty=!0)};n.pop=function(){this._dirty&&this.mergeTight();return this._extents.pop()};n.merge=function(b){this.mergeTight(b);return b.hasProgressed};n.mergeTight=function(b=t.noBudget){const h=this._extents,k=new Set;let l=0;for(;l!==h.length;){h.sort((m,z)=>m[0]-z[0]);l=h.length;k.clear();for(let m=0;m<h.length;++m){if(b.done)return;const z=
h.getItemAt(m);for(let r=m+1;r<h.length;++r){const c=h.getItemAt(r);if(c[0]>=z[2])break;k.add(c)}k.forEach(r=>{if(z!==r)if(r[2]<=z[0])k.delete(r);else{var c=p.area(z),d=p.area(r),g=this._tmpExtent;p.expand(z,r,g);c+=d;.05>(p.area(g)-c)/c&&(p.set(z,g),k.delete(r),h.remove(r),b.madeProgress())}});k.add(z)}}this._dirty=!1};n.contains=function(b){return this._extents.some(h=>p.contains(h,b))};n.removeContained=function(b){this._extents.filterInPlace(h=>!p.contains(b,h))};u._createClass(e,[{key:"empty",
get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const b=this;return{containsPoint:h=>b._extents.some(k=>p.containsPoint(k,h))}}}]);return e}();a.ExtentSet=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ./QueryEngine ../support/floorFilterUtils ../../../layers/support/FeatureFilter ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g){const A=w.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");a.Graphics3DFilterVisibility=function(q){function y(...D){D=q.call(this,...D)||this;D.filter=null;D._dirty=!1;D._querying=!1;D._handles=new t;return D}u._inheritsLoose(y,q);var x=y.prototype;x.setup=function(D,C){this._layerView=D;this._core=C;this._objectIdField=D.layer.objectIdField;this._queryEngine=new r["default"]({layerView:this._layerView,priority:g.TaskPriority.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(g.TaskPriority.FILTER_VISIBILITY,this));this._handles.add(b.on(C.owner,"loadedGraphics","after-changes",B=>this._graphicsChanged(B),()=>this.dirty=!0));this.filterChanged()};x.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};x.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(D=>D.clearVisibilityFlag(2)),this._queryResult=
null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};x._graphicsChanged=function(D){this._queryEngine&&0===(D.type&1)||(this.dirty=!0)};x.updateVisibility=function(D){this.active&&(D.hasVisibilityFlag(2,0)||D.setVisibilityFlag(2,!1,0),this.dirty=!0)};x.filterChanged=function(){const D=this.recomputeFilter();D!==this.filter&&(this.filter=D,this.dirty=!0)};x.recomputeFilter=function(){var D="filter"in this._layerView?this._layerView.filter:null;const C="timeExtent"in this._layerView?
this._layerView.timeExtent:null,B=c.getFloorFilterClause(this._layerView);if(e.isNone(C)&&e.isNone(B))return D;D=e.isSome(D)?D.clone():new d;e.isSome(C)&&(D.timeExtent=e.isSome(D.timeExtent)?D.timeExtent.intersection(C):C);e.isSome(B)&&(D.where=null==D.where||""===D.where?B:`(${D.where}) AND (${B})`);return D};x.runTask=function(D){this.active?(!this._dirty||this._querying||D.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(C=>{this._queryResult=C;this._querying=
!1}).catch(C=>{n.isAbortError(C)||(A.warn("FeatureFilter query failed: "+C,{error:C}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach(B=>this._queryResult.add(this._getFeatureId(B.graphic))),this._querying=!1)}),D.madeProgress()),this._queryResult&&!D.done&&(this._core.modifyGraphics3DGraphicVisibilities(C=>{if(D.done)return!1;const B=this._queryResult.has(this._getFeatureId(C.graphic));return C.setVisibilityFlag(2,B,0)?(D.madeProgress(),!0):!1}),D.done||(this._queryResult=null)),
this.notifyChange("updating")):this.clear()};x._getFeatureId=function(D){return null==D.objectId?D.attributes[this._objectIdField]:D.objectId};u._createClass(y,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"active",get:function(){return this.filter&&0<this._core.graphics3DGraphics.size}},{key:"running",get:function(){return this._dirty&&!this._querying||null!=this._queryResult}},{key:"dirty",set:function(D){this._dirty!==D&&(this._dirty=D,this.notifyChange("updating"))}}]);
return y}(p);f.__decorate([h.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"updating",null);a.Graphics3DFilterVisibility=f.__decorate([z.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],a.Graphics3DFilterVisibility);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=z["default"];a.QueryEngine=function(A){function q(x){x=A.call(this,x)||this;x._dataQueryEngineInstance=null;return x}u._inheritsLoose(q,A);var y=q.prototype;y.destroy=function(){this.clear()};y.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};y.executeQueryForIdSet=function(){var x=u._asyncToGenerator(function*(D,C){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(D),
C)});return function(D,C){return x.apply(this,arguments)}}();y.executeQueryForCount=function(){var x=u._asyncToGenerator(function*(D,C){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(D),C)});return function(D,C){return x.apply(this,arguments)}}();y.executeQueryForExtent=function(){var x=u._asyncToGenerator(function*(D,C){const {count:B,extent:v}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(D),C);D=m.fromJSON(v);return{count:B,extent:D}});return function(D,
C){return x.apply(this,arguments)}}();y.executeQueryForIds=function(){var x=u._asyncToGenerator(function*(D,C){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(D),C)});return function(D,C){return x.apply(this,arguments)}}();y.executeQueryForLatestObservations=function(){var x=u._asyncToGenerator(function*(D,C){D=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(D),C);D=r.fromJSON(D);D.features.forEach(B=>{B.layer=this.layer;B.sourceLayer=this.layer});
return D});return function(D,C){return x.apply(this,arguments)}}();y.executeQuery=function(){var x=u._asyncToGenerator(function*(D,C){D=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(D),C);D=r.fromJSON(D);D.features.forEach(B=>{B.layer=this.layer;B.sourceLayer=this.layer});return D});return function(D,C){return x.apply(this,arguments)}}();y._ensureQueryJSON=function(x){if(w.isNone(x))return this.defaultQueryJSON;"outSpatialReference"in x&&!x.outSpatialReference&&(x.outSpatialReference=
this.spatialReference);return x.toJSON()};y.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const x="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,D=this.layer.objectIdField,C=d.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),B=this.layer.fields.map(G=>G.toJSON()),v=this.layerView.view.resourceController.scheduler,E=this.priority,F=this.spatialReference.toJSON(),L=this.layerView.graphics3d.graphicsCore.featureStore,
{hasZ:N,hasM:I}=this.layerView;return this._dataQueryEngineInstance=new g({hasZ:N,hasM:I,geometryType:C,fields:B,timeInfo:x,spatialReference:F,objectIdField:D,featureStore:L,scheduler:v,priority:E})};u._createClass(q,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new c({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return q}(t);f.__decorate([e.property({constructOnly:!0})],a.QueryEngine.prototype,"layerView",void 0);f.__decorate([e.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);f.__decorate([e.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.QueryEngine.prototype,"spatialReference",void 0);f.__decorate([e.property({readOnly:!0,aliasOf:"layerView.layer"})],a.QueryEngine.prototype,"layer",
void 0);f.__decorate([e.property({readOnly:!0})],a.QueryEngine.prototype,"queryGeometryType",null);f.__decorate([e.property({readOnly:!0})],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=f.__decorate([l.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);a.default=a.QueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue ../../../smartMapping/support/utils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){function C(I){return I.every(G=>"exceedslimit"!==G.statisticType)}const B=new Set,v=new w.MemCacheStorage(2E6);let E=0,F=function(){function I(K){this.capabilities={query:c.queryCapabilities};this.geometryType=K.geometryType;this.hasM=K.hasM;this.hasZ=K.hasZ;this.objectIdField=K.objectIdField;this.spatialReference=K.spatialReference;this.definitionExpression=K.definitionExpression;this.featureStore=K.featureStore;this.aggregateAdapter=K.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=K.timeInfo;K.cacheSpatialQueries&&(this._geometryQueryCache=new w.MemCache(E++ +"$$",v));this.fieldsIndex=new y(K.fields);K.scheduler&&K.priority&&(this._frameQueue=new x,this._frameTask=K.scheduler.registerTask(K.priority,this))}var G=I.prototype;G.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&
this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};G.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};G.executeQuery=function(){var K=u._asyncToGenerator(function*(H={},J){let M=p.clone(H),O;try{M=yield this._schedule(()=>q.normalizeQuery(M,this.definitionExpression,this.spatialReference),J),M=yield this._reschedule(()=>this._checkQuerySupport(M),
J),O=yield this._reschedule(()=>this._executeGeometryQuery(M,J),J),O=yield this._reschedule(()=>O.executeAggregateIdsQuery(M),J),O=yield this._reschedule(()=>O.executeObjectIdsQuery(M),J),O=yield this._reschedule(()=>O.executeTimeQuery(M),J),O=yield this._reschedule(()=>O.executeAttributesQuery(M),J)}catch(Q){if(Q!==q.QUERY_ENGINE_EMPTY_RESULT)throw Q;O=new d([],null,this)}return O.createQueryResponse(M)});return function(){return K.apply(this,arguments)}}();G.executeQueryForCount=function(){var K=
u._asyncToGenerator(function*(H={},J){let M=p.clone(H),O;M.returnGeometry=!1;M.returnCentroid=!1;M.outSR=null;try{M=yield this._schedule(()=>q.normalizeQuery(M,this.definitionExpression,this.spatialReference),J),M=yield this._reschedule(()=>this._checkQuerySupport(M),J),O=yield this._reschedule(()=>this._executeGeometryQuery(M,J),J),O=yield this._reschedule(()=>O.executeAggregateIdsQuery(M),J),O=yield this._reschedule(()=>O.executeObjectIdsQuery(M),J),O=yield this._reschedule(()=>O.executeTimeQuery(M),
J),O=yield this._reschedule(()=>O.executeAttributesQuery(M),J)}catch(Q){if(Q!==q.QUERY_ENGINE_EMPTY_RESULT)throw Q;return 0}return O.createQueryResponseForCount(M)});return function(){return K.apply(this,arguments)}}();G.executeQueryForExtent=function(){var K=u._asyncToGenerator(function*(H={},J){let M=p.clone(H),O;H=M.outSR;try{M=yield this._schedule(()=>q.normalizeQuery(M,this.definitionExpression,this.spatialReference),J);M=yield this._reschedule(()=>this._checkQuerySupport(M),J);M.returnGeometry=
!0;M.returnCentroid=!1;M.outSR=null;O=yield this._reschedule(()=>this._executeGeometryQuery(M,J),J);O=yield this._reschedule(()=>O.executeAggregateIdsQuery(M),J);O=yield this._reschedule(()=>O.executeObjectIdsQuery(M),J);O=yield this._reschedule(()=>O.executeTimeQuery(M),J);O=yield this._reschedule(()=>O.executeAttributesQuery(M),J);const Q=O.size;if(!Q)return{count:Q,extent:null};n.set(N,n.NEGATIVE_INFINITY);this.featureStore.forEachBounds(O.items,Y=>n.expandWithAABB(N,Y),L);const S={xmin:N[0],ymin:N[1],
xmax:N[3],ymax:N[4],spatialReference:q.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(N[2])&&isFinite(N[5])&&(S.zmin=N[2],S.zmax=N[5]);const V=r.project(S,O.spatialReference,H);V.spatialReference=q.cleanFromGeometryEngine(H||this.spatialReference);if(0===V.xmax-V.xmin){const Y=e.getMetersPerUnitForSR(V.spatialReference);V.xmin-=Y;V.xmax+=Y}if(0===V.ymax-V.ymin){const Y=e.getMetersPerUnitForSR(V.spatialReference);V.ymin-=Y;V.ymax+=Y}if(this.hasZ&&null!=V.zmin&&null!=V.zmax&&0===
V.zmax-V.zmin){const Y=e.getMetersPerUnitForSR(V.spatialReference);V.zmin-=Y;V.zmax+=Y}return{count:Q,extent:V}}catch(Q){if(Q===q.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw Q;}});return function(){return K.apply(this,arguments)}}();G.executeQueryForIds=function(){var K=u._asyncToGenerator(function*(H={},J){return this.executeQueryForIdSet(H,J).then(M=>Array.from(M))});return function(){return K.apply(this,arguments)}}();G.executeQueryForIdSet=function(){var K=u._asyncToGenerator(function*(H=
{},J){let M=p.clone(H),O;M.returnGeometry=!1;M.returnCentroid=!1;M.outSR=null;try{M=yield this._schedule(()=>q.normalizeQuery(M,this.definitionExpression,this.spatialReference),J);M=yield this._reschedule(()=>this._checkQuerySupport(M),J);O=yield this._reschedule(()=>this._executeGeometryQuery(M,J),J);O=yield this._reschedule(()=>O.executeAggregateIdsQuery(M),J);O=yield this._reschedule(()=>O.executeObjectIdsQuery(M),J);O=yield this._reschedule(()=>O.executeTimeQuery(M),J);O=yield this._reschedule(()=>
O.executeAttributesQuery(M),J);const Q=O.items,S=new Set;yield this._reschedule(()=>{for(const V of Q)S.add(O.featureAdapter.getObjectId(V))},J);return S}catch(Q){if(Q===q.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw Q;}});return function(){return K.apply(this,arguments)}}();G.executeQueryForSnapping=function(){var K=u._asyncToGenerator(function*(H,J){const {point:M,distance:O,types:Q}=H;if(0===Q)return{candidates:[]};const S=yield this._reschedule(()=>this._checkQuerySupport(H.query),J),V=!m.equals(M.spatialReference,
this.spatialReference);V&&(yield r.checkProjectionSupport(M.spatialReference,this.spatialReference));var Y="number"===typeof O?O:O.x,W="number"===typeof O?O:O.y;Y={xmin:M.x-Y,xmax:M.x+Y,ymin:M.y-W,ymax:M.y+W,spatialReference:M.spatialReference};Y=V?r.project(Y,this.spatialReference):Y;if(!Y)return{candidates:[]};W=(yield l.normalizeCentralMeridian(k.fromJSON(M),null,{signal:J}))[0];const ba=(yield l.normalizeCentralMeridian(k.fromJSON(Y),null,{signal:J}))[0];if(t.isNone(W)||t.isNone(ba))return{candidates:[]};
let ca=new d(this._searchFeatures(this._getQueryBBoxes(ba.toJSON())),null,this);ca=yield this._reschedule(()=>ca.executeObjectIdsQuery(S),J);ca=yield this._reschedule(()=>ca.executeTimeQuery(S),J);ca=yield this._reschedule(()=>ca.executeAttributesQuery(S),J);J=W.toJSON();J=V?r.project(J,this.spatialReference):J;return ca.createSnappingResponse({...H,point:J,distance:V?Math.max(Y.xmax-Y.xmin,Y.ymax-Y.ymin)/2:O},M.spatialReference)});return function(H,J){return K.apply(this,arguments)}}();G.executeQueryForLatestObservations=
function(){var K=u._asyncToGenerator(function*(H={},J){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new f("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:H,timeInfo:this.timeInfo});let M=p.clone(H),O;try{M=yield this._schedule(()=>q.normalizeQuery(M,this.definitionExpression,this.spatialReference),J),M=yield this._reschedule(()=>this._checkQuerySupport(M),J),O=yield this._reschedule(()=>this._executeGeometryQuery(M,J),J),O=yield this._reschedule(()=>O.executeAggregateIdsQuery(M),
J),O=yield this._reschedule(()=>O.executeObjectIdsQuery(M),J),O=yield this._reschedule(()=>O.executeTimeQuery(M),J),O=yield this._reschedule(()=>O.executeAttributesQuery(M),J),O=yield this._reschedule(()=>O.filterLatest(),J)}catch(Q){if(Q!==q.QUERY_ENGINE_EMPTY_RESULT)throw Q;O=new d([],null,this)}return O.createQueryResponse(M)});return function(){return K.apply(this,arguments)}}();G.executeQueryForSummaryStatistics=function(){var K=u._asyncToGenerator(function*(H={},J,M){H=p.clone(H);let O;try{H=
yield this._schedule(()=>q.normalizeQuery(H,this.definitionExpression,this.spatialReference),M),H=yield this._reschedule(()=>this._checkSummaryStatisticsSupport(H,J),M),O=yield this._reschedule(()=>this._executeGeometryQuery(H,M),M),O=yield this._reschedule(()=>O.executeAggregateIdsQuery(H),M),O=yield this._reschedule(()=>O.executeObjectIdsQuery(H),M),O=yield this._reschedule(()=>O.executeTimeQuery(H),M),O=yield this._reschedule(()=>O.executeAttributesQuery(H),M)}catch(Q){if(Q!==q.QUERY_ENGINE_EMPTY_RESULT)throw Q;
O=new d([],null,this)}return O.createSummaryStatisticsResponse(H,J)});return function(){return K.apply(this,arguments)}}();G._schedule=function(){var K=u._asyncToGenerator(function*(H,J){return this._frameQueue?this._frameQueue.push(H,J):H()});return function(H,J){return K.apply(this,arguments)}}();G._reschedule=function(){var K=u._asyncToGenerator(function*(H,J){return this._frameQueue?this._frameQueue.unshift(H,J):H()});return function(H,J){return K.apply(this,arguments)}}();G.runTask=function(K){for(this._budget=
K;!K.done&&this._frameQueue&&this._frameQueue.process();)K.madeProgress();this._budget=null};G._getAll=function(){if(!this._allItems){const K=[];this.featureStore.forEach(H=>K.push(H));this._allItems=new d(K,null,this)}return this._allItems};G._executeGeometryQuery=function(){var K=u._asyncToGenerator(function*(H,J){var M=this;const {geometry:O,outSR:Q,spatialRel:S,returnGeometry:V,returnCentroid:Y}=H,W=V||Y,ba=m.isValid(Q)&&!m.equals(this.spatialReference,Q),ca=this._geometryQueryCache?ba&&W?JSON.stringify({geometry:O,
spatialRelationship:S,outSpatialReference:Q}):JSON.stringify({geometry:O,spatialRelationship:S}):null;if(ca){var da=this._geometryQueryCache.get(ca);if(!t.isUndefined(da))return da}da=function(){var U=u._asyncToGenerator(function*(Z){if(ba&&W)return Z=yield Z.project(Q),ca&&M._geometryQueryCache.put(ca,Z,Z.size||1),Z;ca&&M._geometryQueryCache.put(ca,Z,Z.size||1);return Z});return function(Z){return U.apply(this,arguments)}}();if(!O)return da(this._getAll());const ha=this.featureAdapter;if("esriSpatialRelDisjoint"===
S){H=this._searchFeatures(this._getQueryBBoxes(O));if(!H.length)return da(this._getAll());let U,Z;const T=new Set;for(var fa of H)T.add(ha.getObjectId(fa));yield this._reschedule(()=>{let P=0;U=Array(T.size);this.featureStore.forEach(X=>U[P++]=X);Z=T},J);H=yield this._reschedule(u._asyncToGenerator(function*(){const P=yield g.getSpatialQueryOperator(S,O,M.geometryType,M.hasZ,M.hasM);return new d(yield M._runSpatialFilter(U,X=>!Z.has(ha.getObjectId(X))||P(ha.getGeometry(X)),J),O,M)}),J);return da(H)}fa=
this._searchFeatures(this._getQueryBBoxes(O));if(!fa.length)return da=new d([],O,this),ca&&this._geometryQueryCache.put(ca,da,da.size||1),da;if(this._canExecuteSoloPass(O,H))return da(new d(fa,O,this));const R=yield g.getSpatialQueryOperator(S,O,this.geometryType,this.hasZ,this.hasM);H=yield this._runSpatialFilter(fa,U=>R(ha.getGeometry(U)),J);return da(new d(H,O,this))});return function(H,J){return K.apply(this,arguments)}}();G._runSpatialFilter=function(){var K=u._asyncToGenerator(function*(H,J,
M){var O=this;if(!J)return H;if(!this._budget)return H.filter(Y=>J(Y));let Q=0;const S=[],V=function(){var Y=u._asyncToGenerator(function*(){for(;Q<H.length;){const W=H[Q];J(W)&&S.push(W);O._budget.done&&(yield O._reschedule(()=>V(),M));++Q}});return function(){return Y.apply(this,arguments)}}();return this._reschedule(()=>V(),M).then(()=>S)});return function(H,J,M){return K.apply(this,arguments)}}();G._canExecuteSoloPass=function(K,H){const {geometryType:J}=this;({spatialRel:H}=H);return g.canQueryWithRBush(K)&&
("esriSpatialRelEnvelopeIntersects"===H||"esriGeometryPoint"===J&&("esriSpatialRelIntersects"===H||"esriSpatialRelContains"===H||"esriSpatialRelWithin"===H))};G._getQueryBBoxes=function(K){if(g.canQueryWithRBush(K)){if(k.isExtent(K))return[b.fromValues(K.xmin,K.ymin,K.xmax,K.ymax)];if(k.isPolygon(K))return K.rings.map(H=>b.fromValues(Math.min(H[0][0],H[2][0]),Math.min(H[0][1],H[2][1]),Math.max(H[0][0],H[2][0]),Math.max(H[0][1],H[2][1])))}return[h.getBoundsXY(b.create(),K)]};G._searchFeatures=function(K){for(const M of K)this.featureStore.forEachInBounds(M,
O=>{B.add(O)});const H=Array(B.size);let J=0;B.forEach(M=>H[J++]=M);B.clear();return H};G._checkSummaryStatisticsSupport=function(){var K=u._asyncToGenerator(function*(H,J){if(0>H.distance||null!=H.geometryPrecision||H.multipatchOption||H.pixelSize||H.relationParam||H.text||H.outStatistics||H.groupByFieldsForStatistics||H.having||H.orderByFields)throw new f("feature-store:unsupported-query","Unsupported query options",{query:H});return Promise.all([this._checkAttributesQuerySupport(H),this._checkSummaryStatisticsParamsSupport(J),
g.checkSpatialQuerySupport(H,this.geometryType,this.spatialReference),r.checkProjectionSupport(this.spatialReference,H.outSR)]).then(()=>H)});return function(H,J){return K.apply(this,arguments)}}();G._checkSummaryStatisticsParamsSupport=function(){var K=u._asyncToGenerator(function*(H){const J=yield D.getFieldsList({field:H.field,normalizationField:H.normalizationField,valueExpression:H.valueExpression});if(!J.length)throw new f("feature-store:unsupported-query","params should have atleast a field or valueExpression",
{params:H});z.validateFields(this.fieldsIndex,J,"params contains missing fields")});return function(H){return K.apply(this,arguments)}}();G._checkQuerySupport=function(){var K=u._asyncToGenerator(function*(H){if(0>H.distance||null!=H.geometryPrecision||H.multipatchOption||H.pixelSize||H.relationParam||H.text)throw new f("feature-store:unsupported-query","Unsupported query options",{query:H});return Promise.all([this._checkAttributesQuerySupport(H),this._checkStatisticsQuerySupport(H),g.checkSpatialQuerySupport(H,
this.geometryType,this.spatialReference),r.checkProjectionSupport(this.spatialReference,H.outSR)]).then(()=>H)});return function(H){return K.apply(this,arguments)}}();G._checkAttributesQuerySupport=function(K){const {outFields:H,orderByFields:J,returnDistinctValues:M,outStatistics:O}=K,Q=O?O.map(S=>S.outStatisticFieldName&&S.outStatisticFieldName.toLowerCase()):[];if(J&&0<J.length){const S=J.map(V=>{const Y=V.toLowerCase();return-1<Y.indexOf(" asc")?Y.split(" asc")[0]:-1<Y.indexOf(" desc")?Y.split(" desc")[0]:
V}).filter(V=>-1===Q.indexOf(V));z.validateFields(this.fieldsIndex,S,"orderByFields contains missing fields")}if(H&&0<H.length)z.validateFields(this.fieldsIndex,H,"outFields contains missing fields");else if(M)throw new f("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:K});z.validateWhere(this.fieldsIndex,K.where)};G._checkStatisticsQuerySupport=function(){var K=u._asyncToGenerator(function*(H){const {outStatistics:J,groupByFieldsForStatistics:M,having:O}=
H;var Q=M&&M.length,S=J&&J.length;if(O){if(!Q||!S)throw new f("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:H});z.validateHaving(this.fieldsIndex,O,J)}if(S&&C(J)){S=J.map(V=>V.onStatisticField);z.validateFields(this.fieldsIndex,S,"onStatisticFields contains missing fields");Q&&z.validateFields(this.fieldsIndex,M,"groupByFieldsForStatistics contains missing fields");for(const V of J){const {onStatisticField:Y,statisticType:W}=
V;if(("percentile_disc"===W||"percentile_cont"===W)&&"statisticParameters"in V){if({statisticParameters:Q}=V,!Q)throw new f("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:V,query:H});}else if("count"!==W&&Y&&z.hasInvalidFieldType(Y,this.fieldsIndex))throw new f("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:V,query:H});}}});return function(H){return K.apply(this,arguments)}}();u._createClass(I,[{key:"featureAdapter",
get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const K=this.featureStore.fullBounds;return K?{xmin:K[0],ymin:K[1],xmax:K[2],ymax:K[3],spatialReference:q.cleanFromGeometryEngine(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=A.getTimeExtent(this.timeInfo,this.featureStore):null}},{key:"running",get:function(){return 0<this._frameQueue.length}}]);return I}();const L=n.create(),
N=n.create();a.Feature=function(I,G=null,K,H,J){this.attributes=I;this.geometry=K;this.centroid=H;this.filterFlags=J;this.groupId=-1;this.displayId=G};a.default=F;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,u,f){function p(b,h){return b?e.get(b,h):null}function t(b,h,k,l=!0){const m=[];for(const z of h)if("*"!==z&&!b.has(z))if(l){h=w(z);try{const r=
p(h,b);if(!r)throw new u("feature-store:unsupported-query","invalid SQL expression",{where:h});if(!r.isStandardized)throw new u("feature-store:unsupported-query","expression is not standard",{clause:r});t(b,r.fieldNames,"expression contains missing fields")}catch(r){if((h=r&&r.details)&&(h.clause||h.where))throw r;h&&h.missingFields?m.push(...h.missingFields):m.push(z)}}else m.push(z);if(m.length)throw new u("feature-store:unsupported-query",k,{missingFields:m});}function w(b){return b.split(" as ")[0]}
const e=new f.WhereClauseCache(50,500),n=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(b){return b.split(" as ")[1]};a.getExpressionFromFieldName=w;a.getWhereClause=p;a.hasInvalidFieldType=function(b,h){return(b=h.get(b))?!n.has(b.type):!1};a.validateFields=t;a.validateHaving=function(b,h,k){if(!h)return!0;const l=e.get(h,b);if(!l)throw new u("feature-store:unsupported-query",
"invalid SQL expression",{having:h});if(!l.isAggregate)throw new u("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:h});t(b,l.fieldNames,"having contains missing fields");if(!l.getExpressions().every(m=>{const {aggregateType:z,field:r}=m,c=b.has(r)&&b.get(r).name;return k.some(d=>{const {onStatisticField:g,statisticType:A}=d;return(b.has(g)&&b.get(g).name)===c&&A.toLowerCase().trim()===z})}))throw new u("feature-store:unsupported-query","expressions in having should also exist in outStatistics",
{having:h});return!0};a.validateWhere=function(b,h){if(!h)return!0;const k=e.get(h,b);if(!k)throw new u("feature-store:unsupported-query","invalid SQL expression",{where:h});if(!k.isStandardized)throw new u("feature-store:unsupported-query","where clause is not standard",{where:h});t(b,k.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,
u,f){let p=function(){function t(w,e){this._cache=new u(w);this._invalidCache=new u(e)}t.prototype.get=function(w,e){const n=`${e.uid}:${w}`,b=this._cache.get(n);if(b)return b;if(void 0!==this._invalidCache.get(n))return null;try{const h=f.WhereClause.create(w,e);this._cache.put(n,h);return h}catch{return this._invalidCache.put(n,null),null}};return t}();a.WhereClauseCache=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),
function(a,u,f,p,t,w){function e(N,I){N+="";return N.length>=I?N:Array(I-N.length+1).join("0")+N}function n(N,I,G="0",K="0",H="0",J="0",M="",O="0",Q="0"){return"+"===M||"-"===M?(N=`${e(parseInt(N,10),4)}-${e(parseInt(I,10),2)}-${e(parseInt(G,10),2)}`,I="",10>parseFloat(J)&&(I="0"),K=`${e(parseInt(K,10),2)}:${e(parseInt(H,10),2)}:${I+parseFloat(J).toString()}`,M=`${M}${e(parseInt(O,10),2)}:${e(parseInt(Q,10),2)}`,new Date(N+"T"+K+M)):new Date(parseInt(N,10),parseInt(I,10)-1,parseInt(G,10),parseInt(K,
10),parseInt(H,10),parseFloat(J))}function b(N){let I=D.exec(N);if(null!==I){const [,G,K,H,J,M,O]=I;return n(G,K,H,J,M,O)}I=C.exec(N);if(null!==I){const [,G,K,H,J,M,O,Q,S,V]=I;return n(G,K,H,J,M,O,Q,S,V)}I=B.exec(N);if(null!==I){const [,G,K,H,J,M,O,Q,S]=I;return n(G,K,H,J,M,"0",O,Q,S)}I=v.exec(N);if(null!==I){const [,G,K,H,J,M]=I;return n(G,K,H,J,M)}I=x.exec(N);if(null!==I){const [,G,K,H]=I;return n(G,K,H)}throw Error("SQL Invalid Timestamp");}function h(N){N=x.exec(N);if(null===N)throw Error("SQL Invalid Date");
const [,I,G,K]=N;return new Date(parseInt(I,10),parseInt(G,10)-1,parseInt(K,10))}function k(N){return Array.isArray(N)?N:[N]}function l(N){return null!==N?!0!==N:null}function m(N,I){return null!=N&&null!=I?!0===N&&!0===I:!1===N||!1===I?!1:null}function z(N,I){return null!=N&&null!=I?!0===N||!0===I:!0===N||!0===I?!0:null}function r(N,I){if(null==N)return null;let G=!1;for(const K of I)if(null==K)G=null;else if(N===K){G=!0;break}return G}function c(N,I,G){if(null==N)return null;let K="",H=0;for(let J=
0;J<I.length;J++){const M=I.charAt(J);switch(H){case 0:M===G?H=1:K=0<="-[]/{}()*+?.\\^$|".indexOf(M)?K+("\\"+M):"%"===M?K+".*":"_"===M?K+".":K+M;break;case 1:K=0<="-[]/{}()*+?.\\^$|".indexOf(M)?K+("\\"+M):K+M,H=0}}return(new RegExp("^"+K+"$")).test(N)}function d(N){return N instanceof Date?N.valueOf():N}function g(N,I,G){if(null==I||null==G)return null;I=d(I);G=d(G);switch(N){case "\x3c\x3e":return I!==G;case "\x3d":return I===G;case "\x3e":return I>G;case "\x3c":return I<G;case "\x3e\x3d":return I>=
G;case "\x3c\x3d":return I<=G}}function A(N){const I=[],G={};for(const K of N)N=K.toLowerCase(),void 0===G[N]&&(I.push(K),G[N]=1);return I}function q(N,I,G){if(I instanceof t.SqlInterval)if(G instanceof Date)switch(N){case "+":return new Date(I.valueInMilliseconds()+G.getTime());case "-":return I.valueInMilliseconds()-G.getTime();case "*":return I.valueInMilliseconds()*G.getTime();case "/":return I.valueInMilliseconds()/G.getTime()}else if(G instanceof t.SqlInterval)switch(N){case "+":return t.SqlInterval.createFromMilliseconds(I.valueInMilliseconds()+
G.valueInMilliseconds());case "-":return t.SqlInterval.createFromMilliseconds(I.valueInMilliseconds()-G.valueInMilliseconds());case "*":return I.valueInMilliseconds()*G.valueInMilliseconds();case "/":return I.valueInMilliseconds()/G.valueInMilliseconds()}else I=I.valueInMilliseconds();else if(G instanceof t.SqlInterval)if(I instanceof Date)switch(N){case "+":return new Date(G.valueInMilliseconds()+I.getTime());case "-":return new Date(I.getTime()-G.valueInMilliseconds());case "*":return I.getTime()*
G.valueInMilliseconds();case "/":return I.getTime()/G.valueInMilliseconds()}else G=G.valueInMilliseconds();else if(I instanceof Date&&"number"===typeof G)switch(G*=864E5,I=I.getTime(),N){case "+":return new Date(I+G);case "-":return new Date(I-G);case "*":return new Date(I*G);case "/":return new Date(I/G)}else if(G instanceof Date&&"number"===typeof I)switch(I*=864E5,G=G.getTime(),N){case "+":return new Date(I+G);case "-":return new Date(I-G);case "*":return new Date(I*G);case "/":return new Date(I/
G)}switch(N){case "+":return I+G;case "-":return I-G;case "*":return I*G;case "/":return I/G}}function y(N,I,G,K){N=K.getAttribute(N,I);return null!=N&&1===G[I]?new Date(N):N}const x=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,D=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,B=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;
let E=function(){function N(){}N.makeBool=function(I){return!0===I};N.featureValue=function(I,G,K,H){return y(I,G,K,H)};N.equalsNull=function(I){return null===I};N.applyLike=function(I,G,K){return c(I,G,K)};N.ensureArray=function(I){return k(I)};N.applyIn=function(I,G){return r(I,G)};N.currentDate=function(){const I=new Date;I.setHours(0,0,0,0);return I};N.makeSqlInterval=function(I,G,K){return t.SqlInterval.createFromValueAndQualifer(I,G,K)};N.convertInterval=function(I){return I instanceof t.SqlInterval?
I.valueInMilliseconds():I};N.currentTimestamp=function(){return new Date};N.compare=function(I,G,K){return g(I,G,K)};N.calculate=function(I,G,K){return q(I,G,K)};N.makeComparable=function(I){return d(I)};N.evaluateFunction=function(I,G){return t.evaluateFunction(I,G)};N.lookup=function(I,G){I=G[I];return void 0===I?null:I};N.between=function(I,G){return null==I||null==G[0]||null==G[1]?null:I>=G[0]&&I<=G[1]};N.notbetween=function(I,G){return null==I||null==G[0]||null==G[1]?null:I<G[0]||I>G[1]};N.ternaryNot=
function(I){return l(I)};N.ternaryAnd=function(I,G){return m(I,G)};N.ternaryOr=function(I,G){return z(I,G)};return N}(),F=function(){function N(G,K){this.fieldsIndex=K;this.datefields={};this.parameters={};this.parseTree=w.WhereGrammar.parse(G);const {isStandardized:H,isAggregate:J,referencedFieldNames:M}=this.extractExpressionInfo(K);this.referencedFieldNames=M;this.isStandardized=H;this.isAggregate=J}N.create=function(G,K){return new N(G,K)};var I=N.prototype;I.testSet=function(G,K=L){const H={};
for(const J of this.fieldNames)H[J]=G.map(M=>K.getAttribute(M,J));return!!this.evaluateNode(this.parseTree,{attributes:H},L)};I.calculateValue=function(G,K=L){G=this.evaluateNode(this.parseTree,G,K);return G instanceof t.SqlInterval?G.valueInMilliseconds()/864E5:G};I.calculateValueCompiled=function(G,K=L){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(G,this.parameters,K,this.datefields);if(f("csp-restrictions"))return this.calculateValue(G,K);this.compileMe();return this.parseTree._compiledVersion(G,
this.parameters,K,this.datefields)};I.testFeature=function(G,K=L){return!!this.evaluateNode(this.parseTree,G,K)};I.testFeatureCompiled=function(G,K=L){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(G,this.parameters,K,this.datefields);if(f("csp-restrictions"))return this.testFeature(G,K);this.compileMe();return!!this.parseTree._compiledVersion(G,this.parameters,K,this.datefields)};I.getFunctions=function(){const G=[];this.visitAll(this.parseTree,K=>{"function"===
K.type&&G.push(K.name.toLowerCase())});return A(G)};I.getExpressions=function(){const G=new Map;this.visitAll(this.parseTree,K=>{if("function"===K.type){const H=K.name.toLowerCase();K=K.args.value[0];if("column_ref"===K.type){K=K.column;const J=`${H}-${K}`;G.has(J)||G.set(J,{aggregateType:H,field:K})}}});return[...G.values()]};I.getVariables=function(){const G=[];this.visitAll(this.parseTree,K=>{"param"===K.type&&G.push(K.value.toLowerCase())});return A(G)};I.compileMe=function(){const G="return this.convertInterval("+
this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",G)).bind(E)};I.extractExpressionInfo=function(G){const K=[];let H=!0,J=!0;this.visitAll(this.parseTree,M=>{switch(M.type){case "column_ref":{const O=G.get(M.column),Q=O&&O.name;!O||"date"!==O.type&&"esriFieldTypeDate"!==O.type||(this.datefields[O.name]=1);void 0!==Q?(K.push(Q),M.column=Q):K.push(M.column);break}case "function":{const {name:O,args:Q}=M;
M=Q.value.length;H&&(H=t.isStandardized(O,M));J&&(J=p.isAggregate(O,M))}}});return{referencedFieldNames:A(K),isStandardized:H,isAggregate:J}};I.visitAll=function(G,K){if(null!=G)switch(K(G),G.type){case "when_clause":this.visitAll(G.operand,K);this.visitAll(G.value,K);break;case "case_expression":for(const H of G.clauses)this.visitAll(H,K);"simple"===G.format&&this.visitAll(G.operand,K);null!==G.else&&this.visitAll(G.else,K);break;case "expr_list":for(const H of G.value)this.visitAll(H,K);break;case "unary_expr":this.visitAll(G.expr,
K);break;case "binary_expr":this.visitAll(G.left,K);this.visitAll(G.right,K);break;case "function":this.visitAll(G.args,K)}};I.evaluateNodeToJavaScript=function(G){switch(G.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(G.value)+", "+JSON.stringify(G.qualifier)+","+JSON.stringify(G.op)+")";case "case_expression":var K="";if("simple"===G.format){var H="this.makeComparable("+this.evaluateNodeToJavaScript(G.operand)+")";K="( ";for(let J=0;J<G.clauses.length;J++)K+=
" ("+H+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(G.clauses[J].operand)+")) ? ("+this.evaluateNodeToJavaScript(G.clauses[J].value)+") : "}else for(K="( ",H=0;H<G.clauses.length;H++)K+=" this.makeBool("+this.evaluateNodeToJavaScript(G.clauses[H].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(G.clauses[H].value)+") : ";K=null!==G.else?K+this.evaluateNodeToJavaScript(G.else):K+"null";return K+=" )";case "param":return"this.lookup("+JSON.stringify(G.value.toLowerCase())+
",lookups)";case "expr_list":K="[";for(H of G.value)"["!==K&&(K+=","),K+=this.evaluateNodeToJavaScript(H);return K+="]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(G.expr)+")";case "binary_expr":switch(G.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+" )";case "IS":if("null"!==
G.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(G.left)+")";case "ISNOT":if("null"!==G.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(G.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(G.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(G.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(G.left)+",this.ensureArray("+
this.evaluateNodeToJavaScript(G.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+","+JSON.stringify(G.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+
this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+","+JSON.stringify(G.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(G.operator)+","+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(G.operator)+","+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+
")"}throw Error("Not Supported Operator "+G.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(G.value);case "date":return"(new Date("+h(G.value).getTime().toString()+"))";case "timestamp":return"(new Date("+b(G.value).getTime().toString()+"))";case "current_time":return"date"===G.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(G.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+
JSON.stringify(G.name)+","+this.evaluateNodeToJavaScript(G.args)+")"}throw Error("Unsupported sql syntax "+G.type);};I.evaluateNode=function(G,K,H){switch(G.type){case "interval":return K=this.evaluateNode(G.value,K,H),t.SqlInterval.createFromValueAndQualifer(K,G.qualifier,G.op);case "case_expression":if("simple"===G.format){var J=d(this.evaluateNode(G.operand,K,H));for(var M=0;M<G.clauses.length;M++)if(J===d(this.evaluateNode(G.clauses[M].operand,K,H)))return this.evaluateNode(G.clauses[M].value,
K,H)}else for(J=0;J<G.clauses.length;J++)if(!0===this.evaluateNode(G.clauses[J].operand,K,H))return this.evaluateNode(G.clauses[J].value,K,H);return null!==G.else?this.evaluateNode(G.else,K,H):null;case "param":return this.parameters[G.value.toLowerCase()];case "expr_list":J=[];for(M of G.value)J.push(this.evaluateNode(M,K,H));return J;case "unary_expr":return l(this.evaluateNode(G.expr,K,H));case "binary_expr":switch(G.operator){case "AND":return m(this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,
K,H));case "OR":return z(this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,K,H));case "IS":if("null"!==G.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(G.left,K,H);case "ISNOT":if("null"!==G.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(G.left,K,H);case "IN":return J=k(this.evaluateNode(G.right,K,H)),r(this.evaluateNode(G.left,K,H),J);case "NOT IN":return J=k(this.evaluateNode(G.right,K,H)),l(r(this.evaluateNode(G.left,K,H),
J));case "BETWEEN":return J=this.evaluateNode(G.left,K,H),G=this.evaluateNode(G.right,K,H),null==J||null==G[0]||null==G[1]?null:J>=d(G[0])&&J<=d(G[1]);case "NOTBETWEEN":return J=this.evaluateNode(G.left,K,H),G=this.evaluateNode(G.right,K,H),null==J||null==G[0]||null==G[1]?null:J<d(G[0])||J>d(G[1]);case "LIKE":return c(this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,K,H),G.escape);case "NOT LIKE":return l(c(this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,K,H),G.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return g(G.operator,
this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,K,H));case "-":case "+":case "*":case "/":return q(G.operator,this.evaluateNode(G.left,K,H),this.evaluateNode(G.right,K,H))}case "null":case "bool":case "string":case "number":return G.value;case "date":return h(G.value);case "timestamp":return b(G.value);case "current_time":return K=new Date,"date"===G.mode&&K.setHours(0,0,0,0),K;case "column_ref":return y(K,G.column,this.datefields,H);case "function":return K=this.evaluateNode(G.args,K,H),
this.isAggregate?p.aggregateFunction(G.name,K):t.evaluateFunction(G.name,K)}throw Error("Unsupported sql syntax "+G.type);};u._createClass(N,[{key:"fieldNames",get:function(){return this.referencedFieldNames}}]);return N}();const L={getAttribute(N,I){return(N&&"object"===typeof N.attributes?N.attributes:N)[I]}};a.WhereClause=F;a.defaultAttributeAdapter=L;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function u(t){let w=
0;for(let e=0;e<t.length;e++)w+=t[e];return w/t.length}function f(t){const w=u(t),e=t.length;let n=0;for(const b of t)n+=(b-w)**2;return 1<e?n/(e-1):0}const p={min:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.min.apply(Math,t[0])},max:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.max.apply(Math,t[0])},avg:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:u(t[0])},sum:{minParams:1,maxParams:1,evaluate:t=>{if(null==t[0])t=null;else{{t=t[0];let w=0;for(let e=0;e<t.length;e++)w+=
t[e];t=w}}return t}},stddev:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.sqrt(f(t[0]))},count:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:t[0].length},var:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:f(t[0])}};a.aggregateFunction=function(t,w){const e=p[t.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(w.length<e.minParams||w.length>e.maxParams)throw Error(`Invalid Parameter count for call to ${t.toUpperCase()}`);return e.evaluate(w)};a.isAggregate=
function(t,w){t=p[t.toLowerCase()];return null!=t&&w>=t.minParams&&w<=t.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(a,u){let f=function(){function t(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}t.fixDefaults=function(w){if(null!==w.precision||null!==w.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};t.createFromMilliseconds=
function(w){const e=new t;e.second=w/1E3;return e};t.createFromValueAndQualifer=function(w,e,n){let b=null;const h=new t;h.op="-"===n?"-":"+";if("interval-period"===e.type){t.fixDefaults(e);if("year"===e.period||"month"===e.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(w))h[e.period]=parseFloat(w);else throw Error("Illegal Interval");}else{t.fixDefaults(e.start);t.fixDefaults(e.end);if("year"===e.start.period||"month"===e.start.period)throw Error("Year-Month Intervals not supported");
if("year"===e.end.period||"month"===e.end.period)throw Error("Year-Month Intervals not supported");switch(e.start.period){case "day":switch(e.end.period){case "hour":b=/^[0-9]{1,} [0-9]{1,}$/;if(b.test(w))h[e.start.period]=parseFloat(w.split(" ")[0]),h[e.end.period]=parseFloat(w.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":b=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(b.test(w))h[e.start.period]=parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),h.hour=parseFloat(w[0]),
h.minute=parseFloat(w[1]);else throw Error("Illegal Interval");break;case "second":b=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(b.test(w))h[e.start.period]=parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),h.hour=parseFloat(w[0]),h.minute=parseFloat(w[1]),h.second=parseFloat(w[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(e.end.period){case "minute":b=/^[0-9]{1,}:[0-9]{1,}$/;if(b.test(w))h.hour=parseFloat(w.split(":")[0]),
h.minute=parseFloat(w.split(":")[1]);else throw Error("Illegal Interval");break;case "second":b=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(b.test(w))w=w.split(":"),h.hour=parseFloat(w[0]),h.minute=parseFloat(w[1]),h.second=parseFloat(w[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(e.end.period){case "second":b=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(b.test(w))w=w.split(":"),h.minute=parseFloat(w[0]),h.second=parseFloat(w[1]);
else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return h};t.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return t}();const p={extract:{minParams:2,maxParams:2,evaluate:([t,w])=>{if(null==w)return null;if(w instanceof Date)switch(t.toUpperCase()){case "SECOND":return w.getSeconds();case "MINUTE":return w.getMinutes();
case "HOUR":return w.getHours();case "DAY":return w.getDate();case "MONTH":return w.getMonth()+1;case "YEAR":return w.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:t=>{if(2===t.length){const [w,e]=t;return null==w||null==e?null:w.toString().substring(e-1)}if(3===t.length){const [w,e,n]=t;return null==w||null==e||null==n?null:0>=n?"":w.toString().substring(e-1,e+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([t,w])=>null==t||
null==w?null:w.indexOf(t)+1},trim:{minParams:2,maxParams:3,evaluate:t=>{var w=3===t.length,e=w?t[1]:" ";w=w?t[2]:t[1];if(null==e||null==w)return null;e=`(${u.escapeRegExpString(e)})`;switch(t[0]){case "BOTH":return w.replace(new RegExp(`^${e}*|${e}*$`,"g"),"");case "LEADING":return w.replace(new RegExp(`^${e}*`,"g"),"");case "TRAILING":return w.replace(new RegExp(`${e}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.abs(t[0])},
ceiling:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.ceil(t[0])},floor:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.floor(t[0])},log:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.log(t[0])},log10:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.log(t[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.sin(t[0])},cos:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.cos(t[0])},tan:{minParams:1,maxParams:1,evaluate:t=>
null==t[0]?null:Math.tan(t[0])},asin:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.asin(t[0])},acos:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.acos(t[0])},atan:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:Math.atan(t[0])},sign:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:0<t[0]?1:0>t[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:t=>null==t[0]||null==t[1]?null:t[0]**t[1]},mod:{minParams:2,maxParams:2,evaluate:t=>null==t[0]||null==t[1]?null:t[0]%t[1]},round:{minParams:1,
maxParams:2,evaluate:t=>{const w=t[0];t=2===t.length?10**t[1]:1;return null==w?null:Math.round(w*t)/t}},truncate:{minParams:1,maxParams:2,evaluate:t=>null==t[0]?null:1===t.length?parseInt(t[0].toFixed(0),10):parseFloat(t[0].toFixed(t[1]))},char_length:{minParams:1,maxParams:1,evaluate:t=>"string"===typeof t[0]||t[0]instanceof String?t[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:t=>{let w="";for(let e=0;e<t.length;e++){if(null==t[e])return null;w+=t[e].toString()}return w}},lower:{minParams:1,
maxParams:1,evaluate:t=>null==t[0]?null:t[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:t=>null==t[0]?null:t[0].toString().toUpperCase()}};a.SqlInterval=f;a.evaluateFunction=function(t,w){const e=p[t.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(w.length<e.minParams||w.length>e.maxParams)throw Error(`Invalid Parameter count for call to ${t.toUpperCase()}`);return e.evaluate(w)};a.isStandardized=function(t,w){t=p[t.toLowerCase()];return null!=t&&w>=t.minParams&&
w<=t.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,u){var f={exports:{}};(function(t){(function(w,e){t.exports&&(t.exports=e())})(u.commonjsGlobal,function(){function w(e,n,b,h){this.message=e;this.expected=n;this.found=b;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,w)}(function(e,n){function b(){this.constructor=
e}b.prototype=n.prototype;e.prototype=new b})(w,Error);w.buildMessage=function(e,n){function b(m){return m.charCodeAt(0).toString(16).toUpperCase()}function h(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(z){return"\\x0"+b(z)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(z){return"\\x"+b(z)})}function k(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,
"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(z){return"\\x0"+b(z)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(z){return"\\x"+b(z)})}var l={literal:function(m){return'"'+h(m.text)+'"'},"class":function(m){var z="",r;for(r=0;r<m.parts.length;r++)z+=m.parts[r]instanceof Array?k(m.parts[r][0])+"-"+k(m.parts[r][1]):k(m.parts[r]);return"["+(m.inverted?"^":"")+z+"]"},any:function(m){return"any character"},end:function(m){return"end of input"},
other:function(m){return m.description}};return"Expected "+function(m){var z=Array(m.length),r;for(r=0;r<m.length;r++){var c=r;var d=m[r];d=l[d.type](d);z[c]=d}z.sort();if(0<z.length){for(m=r=1;r<z.length;r++)z[r-1]!==z[r]&&(z[m]=z[r],m++);z.length=m}switch(z.length){case 1:return z[0];case 2:return z[0]+" or "+z[1];default:return z.slice(0,-1).join(", ")+", or "+z[z.length-1]}}(e)+" but "+(n?'"'+h(n)+'"':"end of input")+" found."};return{SyntaxError:w,parse:function(e,n){function b(qa,Ca){return{type:"literal",
text:qa,ignoreCase:Ca}}function h(qa,Ca,Aa){return{type:"class",parts:qa,inverted:Ca,ignoreCase:Aa}}function k(qa){var Ca=nc[qa],Aa;if(!Ca){for(Aa=qa-1;!nc[Aa];)Aa--;Ca=nc[Aa];for(Ca={line:Ca.line,column:Ca.column};Aa<qa;)10===e.charCodeAt(Aa)?(Ca.line++,Ca.column=1):Ca.column++,Aa++;nc[qa]=Ca}return Ca}function l(qa,Ca){var Aa=k(qa),Na=k(Ca);return{start:{offset:qa,line:Aa.line,column:Aa.column},end:{offset:Ca,line:Na.line,column:Na.column}}}function m(qa){la<Cb||(la>Cb&&(Cb=la,Hc=[]),Hc.push(qa))}
function z(){var qa=la;var Ca=ma();if(Ca!==ea)if(Ca=c(),Ca!==ea){var Aa=ma();Aa!==ea?qa=Ca:(la=qa,qa=ea)}else la=qa,qa=ea;else la=qa,qa=ea;return qa}function r(){var qa=la;var Ca=c();if(Ca!==ea){var Aa=[];var Na=la;var Ya=ma();if(Ya!==ea){var db=Ba();if(db!==ea){var fb=ma();if(fb!==ea){var jb=c();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=Ba(),db!==ea?(fb=ma(),fb!==ea?(jb=c(),jb!==ea?Na=Ya=[Ya,db,
fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea);if(Aa!==ea){qa={type:"expr_list"};Ca=[Ca];for(Na=0;Na<Aa.length;Na++)Ca.push(Aa[Na][3]);qa.value=Ca}else la=qa,qa=ea}else la=qa,qa=ea;return qa}function c(){var qa=la;var Ca=d();if(Ca!==ea){var Aa=[];var Na=la;var Ya=ma();if(Ya!==ea){var db=P();if(db!==ea){var fb=ma();if(fb!==ea){var jb=d();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=
P(),db!==ea?(fb=ma(),fb!==ea?(jb=d(),jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea);Aa!==ea?qa=Ca=Ra(Ca,Aa):(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function d(){var qa=la;var Ca=g();if(Ca!==ea){var Aa=[];var Na=la;var Ya=ma();if(Ya!==ea){var db=T();if(db!==ea){var fb=ma();if(fb!==ea){var jb=g();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=T(),db!==ea?(fb=ma(),
fb!==ea?(jb=g(),jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea);Aa!==ea?qa=Ca=Ra(Ca,Aa):(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function g(){var qa=la;var Ca=Z();if(Ca===ea){Ca=la;if(33===e.charCodeAt(la)){var Aa=ra;la++}else Aa=ea,0===Va&&m(va);if(Aa!==ea){var Na=la;Va++;if(61===e.charCodeAt(la)){var Ya=La;la++}else Ya=ea,0===Va&&m(Ta);Va--;Ya===ea?Na=void 0:(la=Na,Na=ea);Na!==ea?Ca=Aa=[Aa,Na]:(la=Ca,Ca=ea)}else la=Ca,Ca=ea}Ca!==ea?(Aa=ma(),Aa!==ea?(Na=g(),
Na!==ea?qa=Ca={type:"unary_expr",operator:"NOT",expr:Na}:(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea);if(qa===ea)if(qa=la,Ca=x(),Ca!==ea)if(Aa=ma(),Aa!==ea){Aa=[];Na=la;Ya=ma();if(Ya!==ea){var db=A();if(db!==ea){var fb=ma();if(fb!==ea){var jb=x();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;if(Na!==ea)for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=A(),db!==ea?(fb=ma(),fb!==ea?(jb=x(),jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=
Na,Na=ea)):(la=Na,Na=ea);else Aa=ea;Aa!==ea&&(Aa={type:"arithmetic",tail:Aa});Aa===ea&&(Aa=la,Na=y(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=Ea(),Ya!==ea?(Ya=ma(),Ya!==ea?(Ya=r(),Ya!==ea?(db=ma(),db!==ea?(db=Ga(),db!==ea?Aa=Na={op:Na,right:Ya}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=y(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=Ea(),Ya!==ea?(Ya=ma(),Ya!==ea?(Ya=Ga(),Ya!==ea?Aa=Na={op:Na,right:{type:"expr_list",value:[]}}:(la=Aa,Aa=ea)):(la=
Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=y(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=I(),Ya!==ea?Aa=Na={op:Na,right:Ya}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea))),Aa===ea&&(Aa=la,Ya=Z(),Ya!==ea?(Na=ma(),Na!==ea?(Na=X(),Na!==ea?(db=ma(),db!==ea?(db=x(),db!==ea?(fb=ma(),fb!==ea?(fb=T(),fb!==ea?(Ya=ma(),Ya!==ea?(Ya=x(),Ya!==ea?Aa=Ya={op:"NOT"+Na,right:{type:"expr_list",value:[db,Ya]}}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=
Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Ya=X(),Ya!==ea?(Na=ma(),Na!==ea?(Na=x(),Na!==ea?(db=ma(),db!==ea?(db=T(),db!==ea?(fb=ma(),fb!==ea?(fb=x(),fb!==ea?Aa=Ya={op:Ya,right:{type:"expr_list",value:[Na,fb]}}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)),Aa===ea&&(Aa=la,Na=R(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=Z(),Ya!==ea?(Ya=ma(),Ya!==ea?(Ya=x(),Ya!==ea?Aa=Na={op:Na+"NOT",right:Ya}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=
Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=R(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=x(),Ya!==ea?Aa=Na={op:Na,right:Ya}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)),Aa===ea&&(Aa=la,Na=q(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=O(),Ya!==ea?(db=ma(),db!==ea?(db=la,e.substr(la,6).toLowerCase()===Hd?(fb=e.substr(la,6),la+=6):(fb=ea,0===Va&&m(Id)),fb!==ea?(fb=la,Va++,jb=L(),Va--,jb===ea?fb=void 0:(la=fb,fb=ea),fb!==ea?db="ESCAPE":(la=db,db=ea)):(la=db,db=ea),db!==ea?(db=ma(),db!==ea?(db=Q(),db!==ea?Aa=Na={op:Na,right:Ya,
escape:db.value}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=q(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=O(),Ya!==ea?Aa=Na={op:Na,right:Ya,escape:""}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea))))));Aa===ea&&(Aa=null);Aa!==ea?(qa=Ca,Ca=Aa,""==Ca||void 0==Ca||null==Ca?Ca=qa:(Aa=null,Ca=Aa="arithmetic"==Ca.type?Ra(qa,Ca.tail):Ma(Ca.op,qa,Ca.right,Ca.escape)),qa=Ca):(la=qa,qa=ea)}else la=qa,qa=ea;else la=qa,qa=ea;return qa}function A(){if(e.substr(la,
2)===Pa){var qa=Pa;la+=2}else qa=ea,0===Va&&m(sa);qa===ea&&(62===e.charCodeAt(la)?(qa=oa,la++):(qa=ea,0===Va&&m(wa)),qa===ea&&(e.substr(la,2)===za?(qa=za,la+=2):(qa=ea,0===Va&&m(Ia)),qa===ea&&(e.substr(la,2)===Sa?(qa=Sa,la+=2):(qa=ea,0===Va&&m(Xa)),qa===ea&&(60===e.charCodeAt(la)?(qa=bb,la++):(qa=ea,0===Va&&m(ab)),qa===ea&&(61===e.charCodeAt(la)?(qa=La,la++):(qa=ea,0===Va&&m(Ta)),qa===ea&&(e.substr(la,2)===gb?(qa=gb,la+=2):(qa=ea,0===Va&&m($a))))))));return qa}function q(){var qa=qa=la;var Ca=Z();
if(Ca!==ea){var Aa=ma();if(Aa!==ea){var Na=U();Na!==ea?qa=Ca=[Ca,Aa,Na]:(la=qa,qa=ea)}else la=qa,qa=ea}else la=qa,qa=ea;qa!==ea&&(qa=qa[0]+" "+qa[2]);qa===ea&&(qa=U());return qa}function y(){var qa=qa=la;var Ca=Z();if(Ca!==ea){var Aa=ma();if(Aa!==ea){var Na=fa();Na!==ea?qa=Ca=[Ca,Aa,Na]:(la=qa,qa=ea)}else la=qa,qa=ea}else la=qa,qa=ea;qa!==ea&&(qa=qa[0]+" "+qa[2]);qa===ea&&(qa=fa());return qa}function x(){var qa=la;var Ca=C();if(Ca!==ea){var Aa=[];var Na=la;var Ya=ma();if(Ya!==ea){var db=D();if(db!==
ea){var fb=ma();if(fb!==ea){var jb=C();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=D(),db!==ea?(fb=ma(),fb!==ea?(jb=C(),jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea);Aa!==ea?qa=Ca=Ra(Ca,Aa):(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function D(){if(43===e.charCodeAt(la)){var qa=Ja;la++}else qa=ea,0===Va&&m(Oa);qa===ea&&(45===e.charCodeAt(la)?(qa=Wa,la++):(qa=
ea,0===Va&&m(Za)));return qa}function C(){var qa=la;var Ca=v();if(Ca!==ea){var Aa=[];var Na=la;var Ya=ma();if(Ya!==ea){var db=B();if(db!==ea){var fb=ma();if(fb!==ea){var jb=v();jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)}else la=Na,Na=ea}else la=Na,Na=ea}else la=Na,Na=ea;for(;Na!==ea;)Aa.push(Na),Na=la,Ya=ma(),Ya!==ea?(db=B(),db!==ea?(fb=ma(),fb!==ea?(jb=v(),jb!==ea?Na=Ya=[Ya,db,fb,jb]:(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea)):(la=Na,Na=ea);Aa!==ea?qa=Ca=Ra(Ca,Aa):(la=qa,qa=ea)}else la=qa,qa=ea;
return qa}function B(){if(42===e.charCodeAt(la)){var qa=cb;la++}else qa=ea,0===Va&&m(eb);qa===ea&&(47===e.charCodeAt(la)?(qa=ib,la++):(qa=ea,0===Va&&m(sb)));return qa}function v(){var qa=Q();if(qa===ea){var Ca=la;var Aa=la;var Na=W();if(Na!==ea){var Ya=ba();if(Ya!==ea){var db=ca();db!==ea?Aa=Na=parseFloat(Na+Ya+db):(la=Aa,Aa=ea)}else la=Aa,Aa=ea}else la=Aa,Aa=ea;Aa===ea&&(Aa=la,Na=W(),Na!==ea?(Ya=ba(),Ya!==ea?Aa=Na=parseFloat(Na+Ya):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=W(),Na!==ea?(Ya=
ca(),Ya!==ea?Aa=Na=parseFloat(Na+Ya):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=W(),Na!==ea&&(Na=parseFloat(Na)),Aa=Na)));var fb=Aa;if(fb!==ea){var jb=la;Va++;var Jd=F();Va--;Jd===ea?jb=void 0:(la=jb,jb=ea);jb!==ea?Ca=fb={type:"number",value:fb}:(la=Ca,Ca=ea)}else la=Ca,Ca=ea;qa=Ca;if(qa===ea){var Yb=la;var Nb=la;if(e.substr(la,4).toLowerCase()===Kd){var oc=e.substr(la,4);la+=4}else oc=ea,0===Va&&m(Ld);if(oc!==ea){var Zb=la;Va++;var Md=L();Va--;Md===ea?Zb=void 0:(la=Zb,Zb=ea);Zb!==ea?Nb=oc=[oc,
Zb]:(la=Nb,Nb=ea)}else la=Nb,Nb=ea;var Jb=Nb;Jb!==ea&&(Jb={type:"bool",value:!0});Yb=Jb;if(Yb===ea){Yb=la;var Ob=la;if(e.substr(la,5).toLowerCase()===Nd){var pc=e.substr(la,5);la+=5}else pc=ea,0===Va&&m(Od);if(pc!==ea){var $b=la;Va++;var Pd=L();Va--;Pd===ea?$b=void 0:(la=$b,$b=ea);$b!==ea?Ob=pc=[pc,$b]:(la=Ob,Ob=ea)}else la=Ob,Ob=ea;Jb=Ob;Jb!==ea&&(Jb={type:"bool",value:!1});Yb=Jb}qa=Yb;if(qa===ea){var Pb=la;if(e.substr(la,4).toLowerCase()===Qd){var qc=e.substr(la,4);la+=4}else qc=ea,0===Va&&m(Rd);
if(qc!==ea){var ac=la;Va++;var Sd=L();Va--;Sd===ea?ac=void 0:(la=ac,ac=ea);ac!==ea?Pb=qc=[qc,ac]:(la=Pb,Pb=ea)}else la=Pb,Pb=ea;var Ic=Pb;Ic!==ea&&(Ic={type:"null",value:null});qa=Ic;if(qa===ea){var Gb=la;var Qb=la;if(e.substr(la,4).toLowerCase()===Td){var Jc=e.substr(la,4);la+=4}else Jc=ea,0===Va&&m(Ud);if(Jc!==ea){var rc=la;Va++;var Vd=L();Va--;Vd===ea?rc=void 0:(la=rc,rc=ea);rc!==ea?Qb=Jc="DATE":(la=Qb,Qb=ea)}else la=Qb,Qb=ea;var id=Qb;if(id!==ea){var Wd=ma();if(Wd!==ea){var jd=O();jd!==ea?Gb=
id={type:"date",value:jd.value}:(la=Gb,Gb=ea)}else la=Gb,Gb=ea}else la=Gb,Gb=ea;qa=Gb;if(qa===ea){var Hb=la;var Rb=la;if(e.substr(la,9).toLowerCase()===Xd){var Kc=e.substr(la,9);la+=9}else Kc=ea,0===Va&&m(Yd);if(Kc!==ea){var sc=la;Va++;var Zd=L();Va--;Zd===ea?sc=void 0:(la=sc,sc=ea);sc!==ea?Rb=Kc="TIMESTAMP":(la=Rb,Rb=ea)}else la=Rb,Rb=ea;var kd=Rb;if(kd!==ea){var $d=ma();if($d!==ea){var ld=O();ld!==ea?Hb=kd={type:"timestamp",value:ld.value}:(la=Hb,Hb=ea)}else la=Hb,Hb=ea}else la=Hb,Hb=ea;qa=Hb;if(qa===
ea){var mb=la;var bc=ia();if(bc!==ea){var Lc=ma();if(Lc!==ea){if(45===e.charCodeAt(la)){var Eb=Wa;la++}else Eb=ea,0===Va&&m(Za);Eb===ea&&(43===e.charCodeAt(la)?(Eb=Ja,la++):(Eb=ea,0===Va&&m(Oa)));if(Eb!==ea){var Mc=ma();if(Mc!==ea){var cc=O();if(cc!==ea){var ae=ma();if(ae!==ea){var md=K();md!==ea?mb=bc={type:"interval",value:cc,qualifier:md,op:Eb}:(la=mb,mb=ea)}else la=mb,mb=ea}else la=mb,mb=ea}else la=mb,mb=ea}else la=mb,mb=ea}else la=mb,mb=ea}else la=mb,mb=ea;mb===ea&&(mb=la,bc=ia(),bc!==ea?(Lc=
ma(),Lc!==ea?(Eb=O(),Eb!==ea?(Mc=ma(),Mc!==ea?(cc=K(),cc!==ea?mb=bc={type:"interval",value:Eb,qualifier:cc,op:""}:(la=mb,mb=ea)):(la=mb,mb=ea)):(la=mb,mb=ea)):(la=mb,mb=ea)):(la=mb,mb=ea));qa=mb}}}}}}var lb=qa;if(lb===ea){var pb=la;var Sb=la;if(e.substr(la,7).toLowerCase()===be){var Nc=e.substr(la,7);la+=7}else Nc=ea,0===Va&&m(ce);if(Nc!==ea){var tc=la;Va++;var de=L();Va--;de===ea?tc=void 0:(la=tc,tc=ea);tc!==ea?Sb=Nc="EXTRACT":(la=Sb,Sb=ea)}else la=Sb,Sb=ea;var nd=Sb;if(nd!==ea){var ee=ma();if(ee!==
ea){var fe=Ea();if(fe!==ea){var ge=ma();if(ge!==ea){var yb=ka();yb===ea&&(yb=na(),yb===ea&&(yb=ta(),yb===ea&&(yb=pa(),yb===ea&&(yb=xa(),yb===ea&&(yb=Da())))));var od=yb;if(od!==ea){var he=ma();if(he!==ea){var ie=aa();if(ie!==ea){var je=ma();if(je!==ea){var pd=c();if(pd!==ea){var ke=ma();if(ke!==ea){var le=Ga();le!==ea?pb=nd={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:od},pd]}}:(la=pb,pb=ea)}else la=pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea}else la=
pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea}else la=pb,pb=ea;lb=pb;if(lb===ea){var ob=la;var Tb=la;if(e.substr(la,9).toLowerCase()===me){var Oc=e.substr(la,9);la+=9}else Oc=ea,0===Va&&m(ne);if(Oc!==ea){var uc=la;Va++;var oe=L();Va--;oe===ea?uc=void 0:(la=uc,uc=ea);uc!==ea?Tb=Oc="SUBSTRING":(la=Tb,Tb=ea)}else la=Tb,Tb=ea;var qd=Tb;if(qd!==ea){var pe=ma();if(pe!==ea){var qe=Ea();if(qe!==ea){var re=ma();if(re!==ea){var Pc=c();if(Pc!==ea){var se=ma();if(se!==ea){var te=
aa();if(te!==ea){var ue=ma();if(ue!==ea){var Qc=c();if(Qc!==ea){var ve=ma();if(ve!==ea){var vb=la;var Ub=la;if(e.substr(la,3).toLowerCase()===we){var Rc=e.substr(la,3);la+=3}else Rc=ea,0===Va&&m(xe);if(Rc!==ea){var vc=la;Va++;var ye=L();Va--;ye===ea?vc=void 0:(la=vc,vc=ea);vc!==ea?Ub=Rc="FOR":(la=Ub,Ub=ea)}else la=Ub,Ub=ea;var dc=Ub;if(dc!==ea){var rd=ma();if(rd!==ea){var sd=c();if(sd!==ea){var td=ma();td!==ea?vb=dc=[dc,rd,sd,td]:(la=vb,vb=ea)}else la=vb,vb=ea}else la=vb,vb=ea}else la=vb,vb=ea;vb===
ea&&(vb=null);vb!==ea?(dc=Ga(),dc!==ea?ob=qd={type:"function",name:"substring",args:{type:"expr_list",value:vb?[Pc,Qc,vb[2]]:[Pc,Qc]}}:(la=ob,ob=ea)):(la=ob,ob=ea)}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea}else la=ob,ob=ea;lb=ob;if(lb===ea){var hb=la;var ec=ja();if(ec!==ea){var Sc=ma();if(Sc!==ea){var Tc=Ea();if(Tc!==ea){var Uc=ma();if(Uc!==ea){var zb=G();zb===ea&&(zb=null);if(zb!==ea){var Vc=
ma();if(Vc!==ea){var fc=c();if(fc!==ea){var Wc=ma();if(Wc!==ea){var Xc=aa();if(Xc!==ea){var ze=ma();if(ze!==ea){var ud=c();if(ud!==ea){var Ae=ma();if(Ae!==ea){var Be=Ga();Be!==ea?hb=ec={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==zb?"BOTH":zb},fc,ud]}}:(la=hb,hb=ea)}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=hb,hb=ea}else la=
hb,hb=ea;hb===ea&&(hb=la,ec=ja(),ec!==ea?(Sc=ma(),Sc!==ea?(Tc=Ea(),Tc!==ea?(Uc=ma(),Uc!==ea?(zb=G(),zb===ea&&(zb=null),zb!==ea?(Vc=ma(),Vc!==ea?(fc=c(),fc!==ea?(Wc=ma(),Wc!==ea?(Xc=Ga(),Xc!==ea?hb=ec={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==zb?"BOTH":zb},fc]}}:(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea)):(la=hb,hb=ea));lb=hb;if(lb===ea){var qb=la;var Vb=la;if(e.substr(la,8).toLowerCase()===
Ce){var Yc=e.substr(la,8);la+=8}else Yc=ea,0===Va&&m(De);if(Yc!==ea){var wc=la;Va++;var Ee=L();Va--;Ee===ea?wc=void 0:(la=wc,wc=ea);wc!==ea?Vb=Yc="POSITION":(la=Vb,Vb=ea)}else la=Vb,Vb=ea;var vd=Vb;if(vd!==ea){var Fe=ma();if(Fe!==ea){var Ge=Ea();if(Ge!==ea){var He=ma();if(He!==ea){var wd=c();if(wd!==ea){var Ie=ma();if(Ie!==ea){var Je=fa();if(Je!==ea){var Ke=ma();if(Ke!==ea){var xd=c();if(xd!==ea){var Le=ma();if(Le!==ea){var Me=Ga();Me!==ea?qb=vd={type:"function",name:"position",args:{type:"expr_list",
value:[wd,xd]}}:(la=qb,qb=ea)}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea}else la=qb,qb=ea;lb=qb;if(lb===ea){var ub=la;var gc;var Ab=la;Ab=gc=E();if(Ab===ea)if(Ab=la,96===e.charCodeAt(la)?(gc=yd,la++):(gc=ea,0===Va&&m(zd)),gc!==ea){var xc=[];if(Ad.test(e.charAt(la))){var Fb=e.charAt(la);la++}else Fb=ea,0===Va&&m(Bd);if(Fb!==ea)for(;Fb!==ea;)xc.push(Fb),Ad.test(e.charAt(la))?(Fb=e.charAt(la),
la++):(Fb=ea,0===Va&&m(Bd));else xc=ea;xc!==ea?(96===e.charCodeAt(la)?(Fb=yd,la++):(Fb=ea,0===Va&&m(zd)),Fb!==ea?Ab=gc=xc.join(""):(la=Ab,Ab=ea)):(la=Ab,Ab=ea)}else la=Ab,Ab=ea;var Zc=Ab;if(Zc!==ea){var Ne=ma();if(Ne!==ea){var Oe=Ea();if(Oe!==ea){var Pe=ma();if(Pe!==ea){var hc=r();hc===ea&&(hc=null);if(hc!==ea){var Qe=ma();if(Qe!==ea){var Re=Ga();Re!==ea?ub=Zc={type:"function",name:Zc,args:hc?hc:{type:"expr_list",value:[]}}:(la=ub,ub=ea)}else la=ub,ub=ea}else la=ub,ub=ea}else la=ub,ub=ea}else la=
ub,ub=ea}else la=ub,ub=ea}else la=ub,ub=ea;lb=ub;if(lb===ea){var wb;var kb=la;var ic=Ka();if(ic!==ea){var $c=ma();if($c!==ea){var jc=c();if(jc!==ea){var ad=ma();if(ad!==ea){var Kb=[];for(wb=V();wb!==ea;)Kb.push(wb),wb=V();if(Kb!==ea)if(wb=ma(),wb!==ea){var yc=Fa();yc!==ea?kb=ic={type:"case_expression",format:"simple",operand:jc,clauses:Kb,else:null}:(la=kb,kb=ea)}else la=kb,kb=ea;else la=kb,kb=ea}else la=kb,kb=ea}else la=kb,kb=ea}else la=kb,kb=ea}else la=kb,kb=ea;if(kb===ea)if(kb=la,ic=Ka(),ic!==
ea)if($c=ma(),$c!==ea)if(jc=c(),jc!==ea)if(ad=ma(),ad!==ea){Kb=[];for(wb=V();wb!==ea;)Kb.push(wb),wb=V();if(Kb!==ea)if(wb=ma(),wb!==ea)if(yc=Y(),yc!==ea){var Se=ma();if(Se!==ea){var Te=Fa();Te!==ea?kb=ic={type:"case_expression",format:"simple",operand:jc,clauses:Kb,else:yc.value}:(la=kb,kb=ea)}else la=kb,kb=ea}else la=kb,kb=ea;else la=kb,kb=ea;else la=kb,kb=ea}else la=kb,kb=ea;else la=kb,kb=ea;else la=kb,kb=ea;else la=kb,kb=ea;var bd=kb;if(bd===ea){var xb;var nb=la;var kc=Ka();if(kc!==ea){var cd=
ma();if(cd!==ea){var Lb=[];for(xb=S();xb!==ea;)Lb.push(xb),xb=S();if(Lb!==ea)if(xb=ma(),xb!==ea){var zc=Fa();zc!==ea?nb=kc={type:"case_expression",format:"searched",clauses:Lb,else:null}:(la=nb,nb=ea)}else la=nb,nb=ea;else la=nb,nb=ea}else la=nb,nb=ea}else la=nb,nb=ea;if(nb===ea)if(nb=la,kc=Ka(),kc!==ea)if(cd=ma(),cd!==ea){Lb=[];for(xb=S();xb!==ea;)Lb.push(xb),xb=S();if(Lb!==ea)if(xb=ma(),xb!==ea)if(zc=Y(),zc!==ea){var Ue=ma();if(Ue!==ea){var Ve=Fa();Ve!==ea?nb=kc={type:"case_expression",format:"searched",
clauses:Lb,else:zc.value}:(la=nb,nb=ea)}else la=nb,nb=ea}else la=nb,nb=ea;else la=nb,nb=ea;else la=nb,nb=ea}else la=nb,nb=ea;else la=nb,nb=ea;bd=nb}lb=bd;if(lb===ea){var Ac;var Wb=la;var Cd=F();if(Cd!==ea){var dd=[];for(Ac=N();Ac!==ea;)dd.push(Ac),Ac=N();dd!==ea?Wb=Cd+=dd.join(""):(la=Wb,Wb=ea)}else la=Wb,Wb=ea;var Bc=Wb;if(Bc!==ea){var ed=Bc;Bc=/^CURRENT_DATE$/i.test(ed)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(ed)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",
column:ed}}lb=Bc;if(lb===ea&&(lb=I(),lb===ea)){lb=la;var Dd=Ea();if(Dd!==ea){var We=ma();if(We!==ea){var fd=c();if(fd!==ea){var Xe=ma();if(Xe!==ea){var Ye=Ga();Ye!==ea?(fd.paren=!0,lb=Dd=fd):(la=lb,lb=ea)}else la=lb,lb=ea}else la=lb,lb=ea}else la=lb,lb=ea}else la=lb,lb=ea}}}}}}}}return lb}function E(){var qa;var Ca=la;var Aa=F();if(Aa!==ea){var Na=[];for(qa=L();qa!==ea;)Na.push(qa),qa=L();Na!==ea?Ca=Aa+=Na.join(""):(la=Ca,Ca=ea)}else la=Ca,Ca=ea;return Ca}function F(){if(Db.test(e.charAt(la))){var qa=
e.charAt(la);la++}else qa=ea,0===Va&&m(Mb);return qa}function L(){if(Ib.test(e.charAt(la))){var qa=e.charAt(la);la++}else qa=ea,0===Va&&m(Cc);return qa}function N(){if(Dc.test(e.charAt(la))){var qa=e.charAt(la);la++}else qa=ea,0===Va&&m(lc);return qa}function I(){var qa=la;if(64===e.charCodeAt(la)){var Ca=mc;la++}else Ca=ea,0===Va&&m(Xb);if(Ca!==ea){var Aa=E();Aa!==ea?qa=Ca=[Ca,Aa]:(la=qa,qa=ea)}else la=qa,qa=ea;qa!==ea&&(qa={type:"param",value:qa[1]});return qa}function G(){var qa=la;if(e.substr(la,
7).toLowerCase()===Ze){var Ca=e.substr(la,7);la+=7}else Ca=ea,0===Va&&m($e);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="LEADING":(la=qa,qa=ea)}else la=qa,qa=ea;qa===ea&&(qa=la,e.substr(la,8).toLowerCase()===af?(Ca=e.substr(la,8),la+=8):(Ca=ea,0===Va&&m(bf)),Ca!==ea?(Ca=la,Va++,Aa=L(),Va--,Aa===ea?Ca=void 0:(la=Ca,Ca=ea),Ca!==ea?qa="TRAILING":(la=qa,qa=ea)):(la=qa,qa=ea),qa===ea&&(qa=la,e.substr(la,4).toLowerCase()===cf?(Ca=e.substr(la,4),la+=4):(Ca=ea,0===Va&&
m(df)),Ca!==ea?(Ca=la,Va++,Aa=L(),Va--,Aa===ea?Ca=void 0:(la=Ca,Ca=ea),Ca!==ea?qa="BOTH":(la=qa,qa=ea)):(la=qa,qa=ea)));return qa}function K(){var qa=la;var Ca=la;var Aa=H();if(Aa!==ea){var Na=ma();if(Na!==ea)if(Na=Ea(),Na!==ea)if(Na=ma(),Na!==ea)if(Na=M(),Na!==ea){var Ya=ma();Ya!==ea?(Ya=Ga(),Ya!==ea?Ca=Aa={type:"interval-period",period:Aa.value,precision:Na,secondary:null}:(la=Ca,Ca=ea)):(la=Ca,Ca=ea)}else la=Ca,Ca=ea;else la=Ca,Ca=ea;else la=Ca,Ca=ea;else la=Ca,Ca=ea}else la=Ca,Ca=ea;Ca===ea&&
(Ca=la,Aa=H(),Aa!==ea&&(Aa=tb(Aa)),Ca=Aa);if(Ca!==ea)if(Aa=ma(),Aa!==ea)if(Aa=la,e.substr(la,2).toLowerCase()===ef?(Na=e.substr(la,2),la+=2):(Na=ea,0===Va&&m(ff)),Na!==ea?(Na=la,Va++,Ya=L(),Va--,Ya===ea?Na=void 0:(la=Na,Na=ea),Na!==ea?Aa="TO":(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa!==ea)if(Aa=ma(),Aa!==ea){Aa=la;Na=H();Na!==ea&&(Na={type:"interval-period",period:Na.value,precision:null,secondary:null});Aa=Na;if(Aa===ea){Aa=la;Na=Da();if(Na!==ea)if(Na=ma(),Na!==ea)if(Na=Ea(),Na!==ea)if(Na=ma(),Na!==ea)if(Na=
M(),Na!==ea)if(Ya=ma(),Ya!==ea)if(Ya=Ba(),Ya!==ea)if(Ya=ma(),Ya!==ea)if(Ya=J(),Ya!==ea){var db=ma();db!==ea?(db=Ga(),db!==ea?Aa=Na=Ec(Na,Ya):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)}else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;else la=Aa,Aa=ea;Aa===ea&&(Aa=la,Na=Da(),Na!==ea?(Na=ma(),Na!==ea?(Na=Ea(),Na!==ea?(Na=ma(),Na!==ea?(Na=M(),Na!==ea?(Ya=ma(),Ya!==ea?(Ya=Ga(),Ya!==ea?Aa=Na={type:"interval-period",period:"second",
precision:Na,secondary:null}:(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea)):(la=Aa,Aa=ea),Aa===ea&&(Aa=la,Na=Da(),Na!==ea&&(Na={type:"interval-period",period:"second",precision:null,secondary:null}),Aa=Na))}Aa!==ea?qa=Ca={type:"interval-qualifier",start:Ca,end:Aa}:(la=qa,qa=ea)}else la=qa,qa=ea;else la=qa,qa=ea;else la=qa,qa=ea;else la=qa,qa=ea;qa===ea&&(qa=la,Aa=H(),Aa!==ea?(Ca=ma(),Ca!==ea?(Ca=Ea(),Ca!==ea?(Ca=ma(),Ca!==ea?(Ca=J(),Ca!==ea?(Na=ma(),Na!==
ea?(Na=Ga(),Na!==ea?qa=Aa={type:"interval-period",period:Aa.value,precision:Ca,secondary:null}:(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea),qa===ea&&(qa=la,Aa=H(),Aa!==ea&&(Aa=tb(Aa)),qa=Aa,qa===ea&&(qa=la,Aa=Da(),Aa!==ea?(Ca=ma(),Ca!==ea?(Ca=Ea(),Ca!==ea?(Ca=ma(),Ca!==ea?(Ca=M(),Ca!==ea?(Na=ma(),Na!==ea?(Na=Ba(),Na!==ea?(Aa=ma(),Aa!==ea?(Aa=J(),Aa!==ea?(Na=ma(),Na!==ea?(Na=Ga(),Na!==ea?qa=Aa=Ec(Ca,Aa):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,
qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea),qa===ea&&(qa=la,Aa=Da(),Aa!==ea?(Ca=ma(),Ca!==ea?(Ca=Ea(),Ca!==ea?(Ca=ma(),Ca!==ea?(Ca=J(),Ca!==ea?(Na=ma(),Na!==ea?(Na=Ga(),Na!==ea?qa=Aa={type:"interval-period",period:"second",precision:Ca,secondary:null}:(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea),qa===ea&&(qa=la,Aa=Da(),Aa!==ea&&(Aa={type:"interval-period",period:"second",
precision:null,secondary:null}),qa=Aa)))));return qa}function H(){var qa=la;qa=ta();qa!==ea&&(qa={type:"string",value:"day"});qa===ea&&(qa=la,qa=pa(),qa!==ea&&(qa={type:"string",value:"hour"}),qa===ea&&(qa=la,qa=xa(),qa!==ea&&(qa={type:"string",value:"minute"}),qa===ea&&(qa=la,qa=na(),qa!==ea&&(qa={type:"string",value:"month"}),qa===ea&&(qa=la,qa=ka(),qa!==ea&&(qa={type:"string",value:"year"})))));return qa}function J(){var qa=da();qa!==ea&&(qa=parseFloat(qa));return qa}function M(){var qa=da();qa!==
ea&&(qa=parseFloat(qa));return qa}function O(){var qa=Q();qa===ea&&(qa=I());return qa}function Q(){var qa=la;if(39===e.charCodeAt(la)){var Ca=rb;la++}else Ca=ea,0===Va&&m(Bb);Ca===ea&&(e.substr(la,2)===Fc?(Ca=Fc,la+=2):(Ca=ea,0===Va&&m(gd)));if(Ca!==ea){Ca=[];var Aa=la;e.substr(la,2)===Gc?(Aa=Gc,la+=2):(Aa=ea,0===Va&&m(Ed));Aa!==ea&&(Aa="'");Aa===ea&&(Fd.test(e.charAt(la))?(Aa=e.charAt(la),la++):(Aa=ea,0===Va&&m(Gd)));for(;Aa!==ea;)Ca.push(Aa),Aa=la,e.substr(la,2)===Gc?(Aa=Gc,la+=2):(Aa=ea,0===Va&&
m(Ed)),Aa!==ea&&(Aa="'"),Aa===ea&&(Fd.test(e.charAt(la))?(Aa=e.charAt(la),la++):(Aa=ea,0===Va&&m(Gd)));Ca!==ea?(39===e.charCodeAt(la)?(Aa=rb,la++):(Aa=ea,0===Va&&m(Bb)),Aa!==ea?qa=Ca={type:"string",value:Ca.join("")}:(la=qa,qa=ea)):(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function S(){var qa=la;var Ca=Ha();if(Ca!==ea)if(Ca=ma(),Ca!==ea)if(Ca=c(),Ca!==ea){var Aa=ma();Aa!==ea?(Aa=ua(),Aa!==ea?(Aa=ma(),Aa!==ea?(Aa=c(),Aa!==ea?qa=Ca={type:"when_clause",operand:Ca,value:Aa}:(la=qa,qa=ea)):(la=qa,qa=ea)):
(la=qa,qa=ea)):(la=qa,qa=ea)}else la=qa,qa=ea;else la=qa,qa=ea;else la=qa,qa=ea;return qa}function V(){var qa=la;var Ca=Ha();if(Ca!==ea)if(Ca=ma(),Ca!==ea)if(Ca=c(),Ca!==ea){var Aa=ma();Aa!==ea?(Aa=ua(),Aa!==ea?(Aa=ma(),Aa!==ea?(Aa=c(),Aa!==ea?qa=Ca={type:"when_clause",operand:Ca,value:Aa}:(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea)}else la=qa,qa=ea;else la=qa,qa=ea;else la=qa,qa=ea;return qa}function Y(){var qa=la;var Ca=la;if(e.substr(la,4).toLowerCase()===gf){var Aa=e.substr(la,
4);la+=4}else Aa=ea,0===Va&&m(hf);if(Aa!==ea){Aa=la;Va++;var Na=L();Va--;Na===ea?Aa=void 0:(la=Aa,Aa=ea);Aa!==ea?Ca="ELSE":(la=Ca,Ca=ea)}else la=Ca,Ca=ea;Ca!==ea?(Ca=ma(),Ca!==ea?(Ca=c(),Ca!==ea?qa={type:"else_clause",value:Ca}:(la=qa,qa=ea)):(la=qa,qa=ea)):(la=qa,qa=ea);return qa}function W(){var qa=da();if(qa===ea){qa=la;if(45===e.charCodeAt(la)){var Ca=Wa;la++}else Ca=ea,0===Va&&m(Za);Ca===ea&&(43===e.charCodeAt(la)?(Ca=Ja,la++):(Ca=ea,0===Va&&m(Oa)));if(Ca!==ea){var Aa=da();Aa!==ea?qa=Ca=Ca[0]+
Aa:(la=qa,qa=ea)}else la=qa,qa=ea}return qa}function ba(){var qa=la;if(46===e.charCodeAt(la)){var Ca=jf;la++}else Ca=ea,0===Va&&m(kf);Ca!==ea?(Ca=da(),Ca===ea&&(Ca=null),Ca!==ea?qa="."+(null!=Ca?Ca:""):(la=qa,qa=ea)):(la=qa,qa=ea);return qa}function ca(){var qa;var Ca=qa=la;if(lf.test(e.charAt(la))){var Aa=e.charAt(la);la++}else Aa=ea,0===Va&&m(mf);Aa!==ea?(nf.test(e.charAt(la))?(Aa=e.charAt(la),la++):(Aa=ea,0===Va&&m(of)),Aa===ea&&(Aa=null),Aa!==ea?Ca="e"+(null===Aa?"":Aa):(la=Ca,Ca=ea)):(la=Ca,
Ca=ea);Ca!==ea?(Aa=da(),Aa!==ea?qa=Ca+Aa:(la=qa,qa=ea)):(la=qa,qa=ea);return qa}function da(){var qa=[];var Ca=ha();if(Ca!==ea)for(;Ca!==ea;)qa.push(Ca),Ca=ha();else qa=ea;qa!==ea&&(qa=qa.join(""));return qa}function ha(){if(pf.test(e.charAt(la))){var qa=e.charAt(la);la++}else qa=ea,0===Va&&m(qf);return qa}function fa(){var qa=la;if(e.substr(la,2).toLowerCase()===rf){var Ca=e.substr(la,2);la+=2}else Ca=ea,0===Va&&m(sf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?
qa="IN":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function R(){var qa=la;if(e.substr(la,2).toLowerCase()===tf){var Ca=e.substr(la,2);la+=2}else Ca=ea,0===Va&&m(uf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="IS":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function U(){var qa=la;if(e.substr(la,4).toLowerCase()===vf){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(wf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="LIKE":(la=qa,
qa=ea)}else la=qa,qa=ea;return qa}function Z(){var qa=la;if(e.substr(la,3).toLowerCase()===xf){var Ca=e.substr(la,3);la+=3}else Ca=ea,0===Va&&m(yf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="NOT":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function T(){var qa=la;if(e.substr(la,3).toLowerCase()===zf){var Ca=e.substr(la,3);la+=3}else Ca=ea,0===Va&&m(Af);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="AND":(la=qa,qa=ea)}else la=
qa,qa=ea;return qa}function P(){var qa=la;if(e.substr(la,2).toLowerCase()===Bf){var Ca=e.substr(la,2);la+=2}else Ca=ea,0===Va&&m(Cf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="OR":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function X(){var qa=la;if(e.substr(la,7).toLowerCase()===Df){var Ca=e.substr(la,7);la+=7}else Ca=ea,0===Va&&m(Ef);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="BETWEEN":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}
function aa(){var qa=la;if(e.substr(la,4).toLowerCase()===Ff){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(Gf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="FROM":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function ja(){var qa=la;if(e.substr(la,4).toLowerCase()===Hf){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(If);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="TRIM":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function ia(){var qa=
la;if(e.substr(la,8).toLowerCase()===Jf){var Ca=e.substr(la,8);la+=8}else Ca=ea,0===Va&&m(Kf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="INTERVAL":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function ka(){var qa=la;if(e.substr(la,4).toLowerCase()===Lf){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(Mf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="YEAR":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function na(){var qa=la;if(e.substr(la,
5).toLowerCase()===Nf){var Ca=e.substr(la,5);la+=5}else Ca=ea,0===Va&&m(Of);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="MONTH":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function ta(){var qa=la;if(e.substr(la,3).toLowerCase()===Pf){var Ca=e.substr(la,3);la+=3}else Ca=ea,0===Va&&m(Qf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="DAY":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function pa(){var qa=la;if(e.substr(la,4).toLowerCase()===
Rf){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(Sf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="HOUR":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function xa(){var qa=la;if(e.substr(la,6).toLowerCase()===Tf){var Ca=e.substr(la,6);la+=6}else Ca=ea,0===Va&&m(Uf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="MINUTE":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function Da(){var qa=la;if(e.substr(la,6).toLowerCase()===Vf){var Ca=
e.substr(la,6);la+=6}else Ca=ea,0===Va&&m(Wf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="SECOND":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function Ka(){var qa=la;if(e.substr(la,4).toLowerCase()===Xf){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(Yf);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="CASE":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function Fa(){var qa=la;if(e.substr(la,3).toLowerCase()===Zf){var Ca=e.substr(la,
3);la+=3}else Ca=ea,0===Va&&m($f);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="END":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function Ha(){var qa=la;if(e.substr(la,4).toLowerCase()===ag){var Ca=e.substr(la,4);la+=4}else Ca=ea,0===Va&&m(bg);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="WHEN":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function ua(){var qa=la;if(e.substr(la,4).toLowerCase()===cg){var Ca=e.substr(la,4);la+=4}else Ca=
ea,0===Va&&m(dg);if(Ca!==ea){Ca=la;Va++;var Aa=L();Va--;Aa===ea?Ca=void 0:(la=Ca,Ca=ea);Ca!==ea?qa="THEN":(la=qa,qa=ea)}else la=qa,qa=ea;return qa}function Ba(){if(44===e.charCodeAt(la)){var qa=eg;la++}else qa=ea,0===Va&&m(fg);return qa}function Ea(){if(40===e.charCodeAt(la)){var qa=gg;la++}else qa=ea,0===Va&&m(hg);return qa}function Ga(){if(41===e.charCodeAt(la)){var qa=ig;la++}else qa=ea,0===Va&&m(jg);return qa}function ma(){var qa;var Ca=[];for(qa=ya();qa!==ea;)Ca.push(qa),qa=ya();return Ca}function ya(){if(kg.test(e.charAt(la))){var qa=
e.charAt(la);la++}else qa=ea,0===Va&&m(lg);return qa}function Ma(qa,Ca,Aa,Na){qa={type:"binary_expr",operator:qa,left:Ca,right:Aa};void 0!==Na&&(qa.escape=Na);return qa}function Ra(qa,Ca){for(var Aa=0;Aa<Ca.length;Aa++)qa=Ma(Ca[Aa][1],qa,Ca[Aa][3]);return qa}n=void 0!==n?n:{};var ea={},Ua={start:z},Qa=z,ra="!",va=b("!",!1),La="\x3d",Ta=b("\x3d",!1),Pa="\x3e\x3d",sa=b("\x3e\x3d",!1),oa="\x3e",wa=b("\x3e",!1),za="\x3c\x3d",Ia=b("\x3c\x3d",!1),Sa="\x3c\x3e",Xa=b("\x3c\x3e",!1),bb="\x3c",ab=b("\x3c",
!1),gb="!\x3d",$a=b("!\x3d",!1),Ja="+",Oa=b("+",!1),Wa="-",Za=b("-",!1),cb="*",eb=b("*",!1),ib="/",sb=b("/",!1),Db=/^[A-Za-z_\x80-\uFFFF]/,Mb=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Ib=/^[A-Za-z0-9_]/,Cc=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Dc=/^[A-Za-z0-9_.\x80-\uFFFF]/,lc=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),mc="@",Xb=b("@",!1),tb=function(qa){return{type:"interval-period",period:qa.value,precision:null,secondary:null}},Ec=function(qa,Ca){return{type:"interval-period",
period:"second",precision:qa,secondary:Ca}},rb="'",Bb=b("'",!1),Fc="N'",gd=b("N'",!1),Gc="''",Ed=b("''",!1),Fd=/^[^']/,Gd=h(["'"],!0,!1),jf=".",kf=b(".",!1),pf=/^[0-9]/,qf=h([["0","9"]],!1,!1),lf=/^[eE]/,mf=h(["e","E"],!1,!1),nf=/^[+\-]/,of=h(["+","-"],!1,!1),Qd="null",Rd=b("NULL",!0),Kd="true",Ld=b("TRUE",!0),Nd="false",Od=b("FALSE",!0),rf="in",sf=b("IN",!0),tf="is",uf=b("IS",!0),vf="like",wf=b("LIKE",!0),Hd="escape",Id=b("ESCAPE",!0),xf="not",yf=b("NOT",!0),zf="and",Af=b("AND",!0),Bf="or",Cf=b("OR",
!0),Df="between",Ef=b("BETWEEN",!0),Ff="from",Gf=b("FROM",!0),we="for",xe=b("FOR",!0),me="substring",ne=b("SUBSTRING",!0),be="extract",ce=b("EXTRACT",!0),Hf="trim",If=b("TRIM",!0),Ce="position",De=b("POSITION",!0),Xd="timestamp",Yd=b("TIMESTAMP",!0),Td="date",Ud=b("DATE",!0),Ze="leading",$e=b("LEADING",!0),af="trailing",bf=b("TRAILING",!0),cf="both",df=b("BOTH",!0),ef="to",ff=b("TO",!0),Jf="interval",Kf=b("INTERVAL",!0),Lf="year",Mf=b("YEAR",!0),Nf="month",Of=b("MONTH",!0),Pf="day",Qf=b("DAY",!0),
Rf="hour",Sf=b("HOUR",!0),Tf="minute",Uf=b("MINUTE",!0),Vf="second",Wf=b("SECOND",!0),Xf="case",Yf=b("CASE",!0),Zf="end",$f=b("END",!0),ag="when",bg=b("WHEN",!0),cg="then",dg=b("THEN",!0),gf="else",hf=b("ELSE",!0),eg=",",fg=b(",",!1),gg="(",hg=b("(",!1),ig=")",jg=b(")",!1),kg=/^[ \t\n\r]/,lg=h([" ","\t","\n","\r"],!1,!1),yd="`",zd=b("`",!1),Ad=/^[^`]/,Bd=h(["`"],!0,!1),la=0,nc=[{line:1,column:1}],Cb=0,Hc=[],Va=0;if("startRule"in n){if(!(n.startRule in Ua))throw Error("Can't start parsing from rule \""+
n.startRule+'".');Qa=Ua[n.startRule]}var hd=Qa();if(hd!==ea&&la===e.length)return hd;hd!==ea&&la<e.length&&m({type:"end"});throw function(qa,Ca,Aa){return new w(w.buildMessage(qa,Ca),qa,Ca,Aa)}(Hc,Cb<e.length?e.charAt(Cb):null,Cb<e.length?l(Cb,Cb+1):l(Cb,Cb));}}})})(f);let p=function(){function t(){}t.parse=function(w){return f.exports.parse(w)};return t}();a.WhereGrammar=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/_commonjsHelpers":function(){define(["exports"],function(a){a.commonjsGlobal=
"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};a.commonjsRequire=function(u){throw Error('Could not dynamically require "'+u+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.');};a.getDefaultExportFromCjs=function(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u["default"]:
u}})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,u,f,p,t,w){function e(r,c){if(!c)return null;if("x"in c){var d={x:0,y:0};[d.x,d.y]=r(c.x,c.y,k);null!=c.z&&(d.z=c.z);null!=c.m&&(d.m=c.m);return d}if("xmin"in c)return d={xmin:0,ymin:0,xmax:0,ymax:0},
[d.xmin,d.ymin]=r(c.xmin,c.ymin,k),[d.xmax,d.ymax]=r(c.xmax,c.ymax,k),c.hasZ&&(d.zmin=c.zmin,d.zmax=c.zmax,d.hasZ=!0),c.hasM&&(d.mmin=c.mmin,d.mmax=c.mmax,d.hasM=!0),d;if("rings"in c)return{rings:n(c.rings,r),hasM:c.hasM,hasZ:c.hasZ};if("paths"in c)return{paths:n(c.paths,r),hasM:c.hasM,hasZ:c.hasZ};if("points"in c)return{points:b(c.points,r),hasM:c.hasM,hasZ:c.hasZ}}function n(r,c){const d=[];for(const g of r)d.push(b(g,c));return d}function b(r,c){const d=[];for(const g of r)r=c(g[0],g[1],[0,0]),
d.push(r),2<g.length&&r.push(g[2]),3<g.length&&r.push(g[3]);return d}function h(){h=u._asyncToGenerator(function*(r,c){c&&(r=Array.isArray(r)?r.map(d=>{var g;return null==(g=d.geometry)?void 0:g.spatialReference}):[r],yield f.initializeProjection(r.map(d=>({source:d,dest:c}))))});return h.apply(this,arguments)}const k=[0,0],l=e.bind(null,w.lngLatToXY),m=e.bind(null,w.xyToLngLat),z=new (function(){function r(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var c=r.prototype;
c.push=function(){var d=u._asyncToGenerator(function*(g,A,q){if(!(g&&g.length&&A&&q)||t.equals(A,q))return g;const y={geometries:g,inSpatialReference:A,outSpatialReference:q,resolve:null};this._jobs.push(y);return new Promise(x=>{y.resolve=x;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(g,A,q){return d.apply(this,arguments)}}();c._process=function(){this._timer=null;const d=this._jobs.shift();if(d){var {geometries:g,inSpatialReference:A,outSpatialReference:q,resolve:y}=
d;w.canProject(A,q)?t.isWebMercator(q)?y(g.map(l)):y(g.map(m)):y(f.projectMany(p.jsonAdapter,g,A,q,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return r}());a.checkProjectionSupport=function(r,c){return h.apply(this,arguments)};a.project=function(r,c,d){if(!r)return r;d||(d=c,c=r.spatialReference);return t.isValid(c)&&t.isValid(d)&&!t.equals(c,d)?w.canProject(c,d)?t.isWebMercator(d)?l(r):m(r):f.projectMany(p.jsonAdapter,[r],c,d,null)[0]:r};a.projectMany=function(r,c,d){return z.push(r,
c,d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let u=function(e,n,b){this.x=e;this.y=n;this.spatialReference=b;this.m=this.z=void 0},f=function(e,n,b,h){this.rings=e;this.spatialReference=n;this.hasM=this.hasZ=void 0;b&&(this.hasZ=b);h&&(this.hasM=h)},p=function(e,n,b,h){this.paths=e;this.spatialReference=n;this.hasM=this.hasZ=void 0;b&&(this.hasZ=b);h&&(this.hasM=h)},t=function(e,n,b,h){this.points=e;this.spatialReference=
n;this.hasM=this.hasZ=void 0;b&&(this.hasZ=b);h&&(this.hasM=h)},w=function(e,n,b,h,k){this.xmin=e;this.ymin=n;this.xmax=b;this.ymax=h;this.spatialReference=k;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(e,n){return null==n?null:e.convertJSONToGeometry(n)},exportPoint:function(e,n,b){b=new u(e.getPointX(n),e.getPointY(n),b);const h=e.hasZ(n),k=e.hasM(n);h&&(b.z=e.getPointZ(n));k&&(b.m=e.getPointM(n));return b},exportPolygon:function(e,n,b){return new f(e.exportPaths(n),
b,e.hasZ(n),e.hasM(n))},exportPolyline:function(e,n,b){return new p(e.exportPaths(n),b,e.hasZ(n),e.hasM(n))},exportMultipoint:function(e,n,b){return new t(e.exportPoints(n),b,e.hasZ(n),e.hasM(n))},exportExtent:function(e,n,b){var h=e.hasZ(n);const k=e.hasM(n);b=new w(e.getXMin(n),e.getYMin(n),e.getXMax(n),e.getYMax(n),b);h&&(h=e.getZExtent(n),b.zmin=h.vmin,b.zmax=h.vmax);k&&(e=e.getMExtent(n),b.mmin=e.vmin,b.mmax=e.vmax);return b}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../support/arcadeOnDemand".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(g){return g.substr(24,12)+g.substr(19,4)+g.substr(16,2)+g.substr(14,2)+g.substr(11,2)+g.substr(9,2)+g.substr(6,2)+g.substr(4,2)+g.substr(2,2)+g.substr(0,2)}function r(g,A,q,y){if(q&&"esriFieldTypeDate"===q.type){const x=(new Date(g)).getTime(),D=(new Date(A)).getTime();if(!isNaN(x)&&!isNaN(D))return y?D-x:x-D}return"number"===typeof g&&"number"===typeof A?y?A-g:g-A:"string"===typeof g&&"string"===typeof A?(g=g.toUpperCase(),A=A.toUpperCase(),!q||"esriFieldTypeGUID"!==
q.type&&"esriFieldTypeGlobalID"!==q.type?y=(y?g>A:g<A)?-1:(y?g<A:g>A)?1:0:(q=z(g),A=z(A),y=(y?q>A:q<A)?-1:(y?q<A:q>A)?1:0),y):y?1:-1}function c(g,A,q,y,x,D){x-=q;D-=y;g=Math.min(1,Math.max(0,((g-q)*x+(A-y)*D)/(x*x+D*D)));return{x:q+x*g,y:y+D*g}}function d(g,A){return g?A?4:3:A?3:2}return function(){function g(q,y,x){this.items=q;this.queryGeometry=y;this.definitionExpression=x.definitionExpression;this.geometryType=x.geometryType;this.hasM=x.hasM;this.hasZ=x.hasZ;this.objectIdField=x.objectIdField;
this.spatialReference=x.spatialReference;this.fieldsIndex=x.fieldsIndex;this.timeInfo=x.timeInfo;this.featureAdapter=x.featureAdapter;this.aggregateAdapter=x.aggregateAdapter}var A=g.prototype;A.createQueryResponseForCount=function(q){const y=new w(q,this.featureAdapter,this.fieldsIndex);if(!q.outStatistics)return y.countDistinctValues(this.items);const {groupByFieldsForStatistics:x,having:D}=q;if(null==x||!x.length)return 1;const C=new Map,B=new Map,v=new Set;q=q.outStatistics;for(const F of q){({statisticType:q}=
F);q="exceedslimit"!==q?F.onStatisticField:void 0;if(!B.has(q)){var E=[];for(const L of x){const N=this._getAttributeValues(y,L,C);E.push(N)}B.set(q,this._calculateUniqueValues(E))}q=B.get(q);for(const L in q){const {data:N,items:I}=q[L];E=N.join(",");D&&!y.validateItems(I,D)||v.add(E)}}return v.size};A.createQueryResponse=function(q){let y;y=q.outStatistics?q.outStatistics.some(x=>"exceedslimit"===x.statisticType)?this._createExceedsLimitQueryResponse(q):this._createStatisticsQueryResponse(q):this._createFeatureQueryResponse(q);
q.returnQueryGeometry&&(p.isValid(q.outSR)&&!p.equals(this.queryGeometry.spatialReference,q.outSR)?y.queryGeometry=h.cleanFromGeometryEngine({spatialReference:q.outSR,...n.project(this.queryGeometry,this.queryGeometry.spatialReference,q.outSR)}):y.queryGeometry=h.cleanFromGeometryEngine({spatialReference:q.outSR,...this.queryGeometry}));return y};A.createSnappingResponse=function(q,y){const x=this.featureAdapter,D=d(this.hasZ,this.hasM),{x:C,y:B}=q.point,v="number"===typeof q.distance?q.distance:
q.distance.x,E="number"===typeof q.distance?q.distance:q.distance.y,F={candidates:[]},L="esriGeometryPolygon"===this.geometryType;y=this.getPointCreator(q.point,this.spatialReference,y);for(const O of this.items){var N=x.getGeometry(O);if(!N)continue;const {coords:Q,lengths:S}=N;if(q.types&1){N=0;for(var I=0;I<S.length;I++){var G=S[I];for(var K=0;K<G;K++,N+=D){var H=Q[N],J=Q[N+1];if(K!==G-1){const V=Q[N+D],Y=Q[N+D+1],{x:W,y:ba}=c(C,B,H,J,V,Y);var M=(C-W)/v;const ca=(B-ba)/E;M=M*M+ca*ca;1>=M&&F.candidates.push({type:"edge",
objectId:x.getObjectId(O),distance:Math.sqrt(M),target:y(W,ba),start:y(H,J),end:y(V,Y)})}}}}if(q.types&2)for(N=L?Q.length-D:Q.length,I=0;I<N;I+=D)G=Q[I],K=Q[I+1],H=(C-G)/v,J=(B-K)/E,H=H*H+J*J,1>=H&&F.candidates.push({type:"vertex",objectId:x.getObjectId(O),distance:Math.sqrt(H),target:y(G,K)})}F.candidates.sort((O,Q)=>O.distance-Q.distance);return F};A.getPointCreator=function(q,y,x){const D=u.isSome(x)&&!p.equals(y,x)?C=>n.project(C,y,x):C=>C;return null!=q.z&&null!=q.m?(C,B)=>D({x:C,y:B,z:q.z,m:q.m}):
null!=q.z?(C,B)=>D({x:C,y:B,z:q.z}):null!=q.m?(C,B)=>D({x:C,y:B,m:q.m}):(C,B)=>D({x:C,y:B})};A.executeAttributesQuery=function(q){var y=e.getWhereClause(q.where,this.fieldsIndex);if(!y)return Promise.resolve(this);if(y.isStandardized){let x=0;const D=[];for(const C of this.items)y.testFeature(C,this.featureAdapter)&&(D[x++]=C);y=new g(D,this.queryGeometry,this);y.definitionExpression=q.where;return Promise.resolve(y)}return Promise.reject(new TypeError("Where clause is not standardized"))};A.executeAggregateIdsQuery=
function(q){if(!q.aggregateIds||!q.aggregateIds.length||u.isNone(this.aggregateAdapter))return Promise.resolve(this);const y=new Set;for(const D of q.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(D).forEach(C=>y.add(C));const x=this.featureAdapter.getObjectId;return Promise.resolve(new g(this.items.filter(D=>y.has(x(D))),this.queryGeometry,this))};A.executeObjectIdsQuery=function(q){if(!q.objectIds||!q.objectIds.length)return Promise.resolve(this);const y=new Set(q.objectIds),x=this.featureAdapter.getObjectId;
return Promise.resolve(new g(this.items.filter(D=>y.has(x(D))),this.queryGeometry,this))};A.executeTimeQuery=function(q){q=b.getTimeOperator(this.timeInfo,q.timeExtent,this.featureAdapter);if(!u.isSome(q))return Promise.resolve(this);q=this.items.filter(q);return Promise.resolve(new g(q,this.queryGeometry,this))};A.filterLatest=function(){const {trackIdField:q,startTimeField:y,endTimeField:x}=this.timeInfo;var D=x||y;const C=new Map,B=this.featureAdapter.getAttribute;for(const v of this.items){const E=
B(v,q),F=B(v,D),L=C.get(E);(!L||F>B(L,D))&&C.set(E,v)}D=Array.from(C.values());return Promise.resolve(new g(D,this.queryGeometry,this))};A.project=function(){var q=a._asyncToGenerator(function*(y){if(!y||p.equals(this.spatialReference,y))return this;const x=this.featureAdapter,D=(yield n.projectMany(this.items.map(C=>h.getGeometry(this.geometryType,this.hasZ,this.hasM,x.getGeometry(C))),this.spatialReference,y)).map((C,B)=>x.cloneWithGeometry(this.items[B],t.convertFromGeometry(C,this.hasZ,this.hasM)));
return new g(D,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:y,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})});return function(y){return q.apply(this,arguments)}}();A.createSummaryStatisticsResponse=function(){var q=a._asyncToGenerator(function*(y,x){const {field:D,normalizationField:C,normalizationType:B,normalizationTotal:v,
minValue:E,maxValue:F}=x;var L=new w(y,this.featureAdapter,this.fieldsIndex);y=this.fieldsIndex.isDateField(D);x=x.valueExpression?yield this._getAttributeExpressionValues(L,x.valueExpression,x.viewInfoParams):this._getAttributeNormalizedValues(L,{field:D,normalizationField:C,normalizationType:B,normalizationTotal:v});L=l.isNullCountSupported({normalizationType:B,normalizationField:C,minValue:E,maxValue:F});x=k.isStringField(this.fieldsIndex.get(D))?l.calculateStringStatistics({values:x,supportsNullCount:L}):
l.calculateStatistics({values:x,minValue:E,maxValue:F,useSampleStdDev:!B,supportsNullCount:L});return l.processStatsResult(x,y)});return function(y,x){return q.apply(this,arguments)}}();A._sortFeatures=function(q,y,x){if(1<q.length&&y&&y.length)for(const D of y.reverse()){y=D.split(" ");const C=y[0],B=this.fieldsIndex.get(C),v=y[1]&&"desc"===y[1].toLowerCase();q.sort((E,F)=>{E=x(E,C,B);F=x(F,C,B);return r(E,F,B,v)})}};A._createFeatureQueryResponse=function(q){const y=this.items,{geometryType:x,hasM:D,
hasZ:C,objectIdField:B,spatialReference:v}=this,{outFields:E,outSR:F,quantizationParameters:L,resultRecordCount:N,resultOffset:I,returnZ:G,returnM:K}=q,H=null!=N?y.length>(I||0)+N:!1,J=E&&(-1<E.indexOf("*")?[...this.fieldsIndex.fields]:E.map(M=>this.fieldsIndex.get(M)));return{exceededTransferLimit:H,features:this._createFeatures(q,y),fields:J,geometryType:x,hasM:D&&K,hasZ:C&&G,objectIdFieldName:B,spatialReference:h.cleanFromGeometryEngine(F?F:v),transform:L&&f.toQuantizationTransform(L)||null}};
A._createFeatures=function(q,y){const x=new w(q,this.featureAdapter,this.fieldsIndex),{hasM:D,hasZ:C}=this,{orderByFields:B,quantizationParameters:v,returnGeometry:E,returnCentroid:F,maxAllowableOffset:L,resultOffset:N,resultRecordCount:I,returnZ:G=!1,returnM:K=!1}=q,H=C&&G,J=D&&K;q=[];var M=0;y=[...y];this._sortFeatures(y,B,(S,V,Y)=>x.getFieldValue(S,V,Y));if(E||F){var O=f.toQuantizationTransform(v);if(E&&!F)for(var Q of y)q[M++]={attributes:x.getAttributes(Q),geometry:h.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),L,O,H,J)};else if(!E&&F)for(const S of y)q[M++]={attributes:x.getAttributes(S),centroid:h.transformCentroid(this,this.featureAdapter.getCentroid(S,this),O)};else for(const S of y)q[M++]={attributes:x.getAttributes(S),centroid:h.transformCentroid(this,this.featureAdapter.getCentroid(S,this),O),geometry:h.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),L,O,H,J)}}else for(O of y)(Q=x.getAttributes(O))&&(q[M++]=
{attributes:Q});M=N||0;null!=I&&(q=q.slice(M,Math.min(q.length,M+I)));return q};A._createExceedsLimitQueryResponse=function(q){var y=!1;let x=Number.POSITIVE_INFINITY,D=Number.POSITIVE_INFINITY;y=Number.POSITIVE_INFINITY;for(const C of q.outStatistics)if("exceedslimit"===C.statisticType){x=null!=C.maxPointCount?C.maxPointCount:Number.POSITIVE_INFINITY;D=null!=C.maxRecordCount?C.maxRecordCount:Number.POSITIVE_INFINITY;y=null!=C.maxVertexCount?C.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===
this.geometryType)y=this.items.length>x;else if(this.items.length>D)y=!0;else{q=this.hasZ?this.hasM?4:3:this.hasM?3:2;const C=this.featureAdapter;y=this.items.reduce((B,v)=>{v=C.getGeometry(v);return B+(v&&v.coords.length||0)},0)/q>y}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(y)}}]}};A._createStatisticsQueryResponse=function(q){var y={attributes:{}};const x=
[],D=new Map,C=new Map,B=new Map,v=new Map,E=new w(q,this.featureAdapter,this.fieldsIndex);var F=q.outStatistics;const {groupByFieldsForStatistics:L,having:N,orderByFields:I}=q;q=L&&L.length;const G=!!q,K=G&&L[0],H=G&&!this.fieldsIndex.get(K);for(const S of F){const {outStatisticFieldName:V,statisticType:Y}=S;F=S;var J="exceedslimit"!==Y?S.onStatisticField:void 0;const W="percentile_disc"===Y||"percentile_cont"===Y,ba=G&&1===q&&(J===K||H)&&"count"===Y;if(G){if(!B.has(J)){var M=[];for(const ca of L){var O=
this._getAttributeValues(E,ca,D);M.push(O)}B.set(J,this._calculateUniqueValues(M,E.returnDistinctValues))}M=B.get(J);for(const ca in M){const {count:da,data:ha,items:fa,itemPositions:R}=M[ca];O=ha.join(",");if(!N||E.validateItems(fa,N)){const U=v.get(O)||{attributes:{}};var Q=null;if(ba)Q=da;else{const Z=this._getAttributeValues(E,J,D);Q=R.map(T=>Z[T]);Q=W&&"statisticParameters"in F?this._getPercentileValue(F,Q):this._getStatisticValue(F,Q)}U.attributes[V]=Q;L.forEach((Z,T)=>U.attributes[this.fieldsIndex.get(Z)?
Z:`EXPR_${T+1}`]=ha[T]);v.set(O,U)}}}else J=this._getAttributeValues(E,J,D),y.attributes[V]=W&&"statisticParameters"in F?this._getPercentileValue(F,J):this._getStatisticValue(F,J,C);x.push({name:V,alias:V,type:"esriFieldTypeDouble"})}y=G?Array.from(v.values()):[y];this._sortFeatures(y,I,(S,V)=>S.attributes[V]);return{fields:x,features:y}};A._getStatisticValue=function(q,y,x){const {onStatisticField:D,statisticType:C}=q;q=null;q=null!=x&&x.has(D)?x.get(D):k.isStringField(this.fieldsIndex.get(D))?l.calculateStringStatistics({values:y}):
l.calculateStatistics({values:y,minValue:null,maxValue:null,useSampleStdDev:!0});x&&x.set(D,q);return q["var"===C?"variance":C]};A._getPercentileValue=function(q,y){const {onStatisticField:x,statisticParameters:D,statisticType:C}=q,{value:B,orderBy:v}=D,E="desc"===v,F=this.fieldsIndex.get(x);q=[...y].filter(L=>null!=L).sort((L,N)=>r(L,N,F,E));return this._calculatePercentile(q,B,"percentile_disc"===C)};A._getAttributeValues=function(q,y,x){if(x.has(y))return x.get(y);const D=this.fieldsIndex.get(y),
C=this.items.map(B=>q.getFieldValue(B,y,D));x.set(y,C);return C};A._getAttributeNormalizedValues=function(q,y){return this.items.map(x=>q.getNormalizedValue(x,{field:y.field,fieldInfo:this.fieldsIndex.get(y.field),normalizationField:y.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(y.normalizationField),normalizationType:y.normalizationType,normalizationTotal:y.normalizationTotal}))};A._getAttributeExpressionValues=function(){var q=a._asyncToGenerator(function*(y,x,D){const {arcadeUtils:C}=
yield m.loadArcade(),B=C.createFunction(x),v=D&&C.getViewInfo(D);return this.items.map(E=>y.getExpressionValue(E,{compiledFunc:B,viewInfo:v},C))});return function(y,x,D){return q.apply(this,arguments)}}();A._calculateUniqueValues=function(q,y){const x={},D=this.items,C=D.length;for(let B=0;B<C;B++){const v=D[B],E=[];for(const L of q)E.push(L[B]);const F=E.join(",");y?null==x[F]&&(x[F]={count:1,data:E,items:[v],itemPositions:[B]}):null==x[F]?x[F]={count:1,data:E,items:[v],itemPositions:[B]}:(x[F].count++,
x[F].items.push(v),x[F].itemPositions.push(B))}return x};A._calculatePercentile=function(q,y,x){if(0===q.length)return null;if(0>=y)return q[0];if(1<=y)return q[q.length-1];var D=(q.length-1)*y,C=Math.floor(D);y=C+1;D%=1;C=q[C];const B=q[y];return y>=q.length||x||"string"===typeof C||"string"===typeof B?C:C*(1-D)+B*D};a._createClass(g,[{key:"size",get:function(){return this.items.length}}]);return g}()})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport",
"../../../smartMapping/statistics/support/utils"],function(a,u,f){return function(){function p(w,e,n){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=w.returnDistinctValues;this.fieldsIndex=n;this.featureAdapter=e;if((e=w.outFields)&&-1===e.indexOf("*")){this.outFields=e;w=0;for(const h of e){var b=u.getExpressionFromFieldName(h);b=(e=this.fieldsIndex.get(b))?null:u.getWhereClause(b,n);e=e?e.name:u.getAliasFromFieldName(h)||`FIELD_EXP_${w++}`;this._fieldDataCache.set(h,
{alias:e,clause:b})}}}var t=p.prototype;t.countDistinctValues=function(w){if(!this.returnDistinctValues)return w.length;w.forEach(e=>this.getAttributes(e));return this._returnDistinctMap.size};t.getAttributes=function(w){w=this._processAttributesForOutFields(w);return this._processAttributesForDistinctValues(w)};t.getFieldValue=function(w,e,n){const b=n?n.name:e;let h=null;this._fieldDataCache.has(b)?h=this._fieldDataCache.get(b).clause:n||(h=u.getWhereClause(e,this.fieldsIndex),this._fieldDataCache.set(b,
{alias:b,clause:h}));return n?this.featureAdapter.getAttribute(w,b):h.calculateValue(w,this.featureAdapter)};t.getNormalizedValue=function(w,e){const n=e.normalizationType,b=e.normalizationTotal;let h=this.getFieldValue(w,e.field,e.fieldInfo);n&&Number.isFinite(h)&&(w=this.getFieldValue(w,e.normalizationField,e.normalizationFieldInfo),h=f.getNormalizedValue(h,n,w,b));return h};t.getExpressionValue=function(w,e,n){w={attributes:this.featureAdapter.getAttributes(w)};w=n.createExecContext(w,e.viewInfo);
return n.executeFunction(e.compiledFunc,w)};t.validateItem=function(w,e){this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:u.getWhereClause(e,this.fieldsIndex)});return this._fieldDataCache.get(e).clause.testFeature(w,this.featureAdapter)};t.validateItems=function(w,e){this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:u.getWhereClause(e,this.fieldsIndex)});return this._fieldDataCache.get(e).clause.testSet(w,this.featureAdapter)};t._processAttributesForOutFields=
function(w){const e=this.outFields;if(!e||!e.length)return this.featureAdapter.getAttributes(w);const n={};for(const b of e){const {alias:h,clause:k}=this._fieldDataCache.get(b);n[h]=k?k.calculateValue(w,this.featureAdapter):this.featureAdapter.getAttribute(w,h)}return n};t._processAttributesForDistinctValues=function(w){if(a.isNone(w)||!this.returnDistinctValues)return w;var e=this.outFields,n=[];if(e)for(const h of e){var {alias:b}=this._fieldDataCache.get(h);n.push(w[b])}else for(b in w)n.push(w[b]);
e=`${(e||["*"]).join(",")}=${n.join(",")}`;n=this._returnDistinctMap.get(e)||0;this._returnDistinctMap.set(e,++n);return 1<n?null:w};return p}()})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/maybe","../../../layers/support/fieldUtils"],function(a,u,f,p){function t(b,h){return new u(b,h)}function w(b,h){b=f.isSome(b)?b:"";f.isSome(h)&&h&&(b=b?"("+b+") AND ("+h+")":h);return b}function e(b){const h=b.layer;return b.fields.filter(k=>
!h.getField(k))}function n(b){const h=b.layer;return b.fields.filter(k=>{k=h.getFieldUsageInfo(k);return!k||!k.supportsStatistics})}a.calculateStatistics=function(b){const {values:h,useSampleStdDev:k,supportsNullCount:l}=b;var m=Number.POSITIVE_INFINITY;let z=Number.NEGATIVE_INFINITY,r=null,c=null;var d=null;let g=null,A=0;const q=null==b.minValue?-Infinity:b.minValue;b=null==b.maxValue?Infinity:b.maxValue;for(const y of h)Number.isFinite(y)?y>=q&&y<=b&&(r+=y,m=Math.min(m,y),z=Math.max(z,y),A++):
"string"===typeof y&&A++;if(A&&null!=r){c=r/A;d=0;for(const y of h)Number.isFinite(y)&&y>=q&&y<=b&&(d+=(y-c)**2);g=k?1<A?d/(A-1):0:0<A?d/A:0;d=Math.sqrt(g)}else z=m=null;m={avg:c,count:A,max:z,min:m,stddev:d,sum:r,variance:g};l&&(m.nullcount=h.length-A);return m};a.calculateStringStatistics=function(b){const {values:h,supportsNullCount:k}=b;b=h.filter(m=>null!=m).length;const l={count:b};k&&(l.nullcount=h.length-b);return l};a.createError=t;a.getNormalizedValue=function(b,h,k,l){let m=null;switch(h){case "log":0!==
b&&(m=Math.log(b)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(l)&&0!==l&&(m=b/l*100);break;case "field":Number.isFinite(k)&&0!==k&&(m=b/k);break;case "natural-log":0<b&&(m=Math.log(b));break;case "square-root":0<b&&(m=b**.5)}return m};a.getRangeExpr=function(b,h,k){h=null!=h?b+" \x3e\x3d "+h:"";b=null!=k?b+" \x3c\x3d "+k:"";k="";return(k=h&&b?w(h,b):h||b)?"("+k+")":""};a.getSQLFilterForNormalization=function(b){const h=b.field,k=b.normalizationType;b=b.normalizationField;let l;if("log"===
k)l="(NOT "+h+" \x3d 0)";else if("field"===k)l="(NOT "+b+" \x3d 0)";else if("natural-log"===k||"square-root"===k)l=`(${h} > 0)`;return l};a.isNullCountSupported=function(b){const h=null!=b.minValue||null!=b.maxValue,k=!!b.sqlExpression&&b.supportsSQLExpression;return!(null!=b.normalizationField||null!=b.normalizationType)&&!h&&!k};a.mergeWhereClauses=w;a.processStatsResult=function(b,h){if(!h)return b;["avg","stddev","variance"].forEach(k=>{null!=b[k]&&(b[k]=Math.ceil(b[k]))});return b};a.verifyBasicFieldValidity=
function(b,h,k){const l=e({layer:b,fields:h});if(l.length)return t(k,"Unknown fields: "+l.join(", ")+". You can only use fields defined in the layer schema");b=n({layer:b,fields:h});if(b.length)return t(k,"Unsupported fields: "+b.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(b,h,k,l){let m=null;if(!h)m=t(k,"'field' is not defined in the layer schema");else if(h.name===b.objectIdField||-1===l.indexOf(h.type))m=
t(k,"'field' should be one of these types: "+l.join(","));return m};a.verifyNumericField=function(b,h,k){let l;h?h.name!==b.objectIdField&&p.isNumericField(h)||(l=t(k,"'field' should be one of these numeric types: "+p.numericTypes.join(","))):l=t(k,"'field' is not defined in the layer schema");return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function u(t,w,e,n,b){if(null!=n&&null!=b)return h=>{const k=t.getAttribute(h,
w);h=t.getAttribute(h,e);return(null==k||k<=b)&&(null==h||h>=n)};if(null!=n)return h=>{h=t.getAttribute(h,e);return null==h||h>=n};if(null!=b)return h=>{h=t.getAttribute(h,w);return null==h||h<=b}}function f(t,w,e,n){if(null!=e&&null!=n&&e===n)return b=>t.getAttribute(b,w)===e;if(null!=e&&null!=n)return b=>{b=t.getAttribute(b,w);return b>=e&&b<=n};if(null!=e)return b=>t.getAttribute(b,w)>=e;if(null!=n)return b=>t.getAttribute(b,w)<=n}function p(){return()=>!1}a.getTimeExtent=function(t,w){if(!t)return null;
const e=w.featureAdapter,{startTimeField:n,endTimeField:b}=t;let h=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY;if(n&&b)w.forEach(l=>{const m=e.getAttribute(l,n);l=e.getAttribute(l,b);null==m||isNaN(m)||(h=Math.min(h,m));null==l||isNaN(l)||(k=Math.max(k,l))});else{const l=n||b;w.forEach(m=>{m=e.getAttribute(m,l);null==m||isNaN(m)||(h=Math.min(h,m),k=Math.max(k,m))})}return{start:h,end:k}};a.getTimeOperator=function(t,w,e){if(!w||!t)return null;const {startTimeField:n,endTimeField:b}=t;if(!n&&
!b)return null;const {start:h,end:k}=w;return null===h&&null===k?null:void 0===h&&void 0===k?p():n&&b?u(e,n,b,h,k):f(e,n||b,h,k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){function r(I,G,K,H=I.hasZ,J=I.hasM){const M=I.hasZ&&H,O=I.hasM&&J;return K?(I=l.quantizeOptimizedGeometry(F,G,I.hasZ,I.hasM,"esriGeometryPoint",K,H,J),l.convertToPoint(I,M,O)):l.convertToPoint(G,M,O)}function c(){c=f._asyncToGenerator(function*(I,G,K){const {outFields:H,orderByFields:J,groupByFieldsForStatistics:M,outStatistics:O}=I;if(H)for(var Q=0;Q<H.length;Q++)H[Q]=H[Q].trim();if(J)for(Q=0;Q<J.length;Q++)J[Q]=J[Q].trim();if(M)for(Q=0;Q<M.length;Q++)M[Q]=M[Q].trim();
if(O)for(Q=0;Q<O.length;Q++)O[Q].onStatisticField&&(O[Q].onStatisticField=O[Q].onStatisticField.trim());I.geometry&&!I.outSR&&(I.outSR=I.geometry.spatialReference);return g(I,G,K)});return c.apply(this,arguments)}function d(){d=f._asyncToGenerator(function*(I,G,K){return g(I,G,K)});return d.apply(this,arguments)}function g(I,G,K){return A.apply(this,arguments)}function A(){A=f._asyncToGenerator(function*(I,G,K){if(!I)return null;var {where:H}=I;I.where=H=H&&H.trim();if(!H||/^1 *= *1$/.test(H)||G&&
G===H)I.where=null;if(!I.geometry)return I;G=yield q(I);I.distance=0;I.units=null;"esriSpatialRelEnvelopeIntersects"===I.spatialRel&&({spatialReference:H}=I.geometry,G=e.getGeometryExtent(G),G.spatialReference=H);I.geometry=G;yield z.checkProjectionSupport(G.spatialReference,K);G=(yield b.normalizeCentralMeridian(n.fromJSON(G)))[0];if(t.isNone(G))throw B;G=G.toJSON();G=yield z.project(G,G.spatialReference,K);if(!G)throw B;G.spatialReference=K;I.geometry=G;return I});return A.apply(this,arguments)}
function q(I){return y.apply(this,arguments)}function y(){y=f._asyncToGenerator(function*(I){const {geometry:G,distance:K,units:H}=I;if(null==K||"vertexAttributes"in G)return G;var J=G.spatialReference;I=H?C.fromJSON(H):w.getUnitString(J);J=J&&(h.isGeographic(J)||h.isWebMercator(J))?G:yield z.checkProjectionSupport(J,h.WGS84).then(()=>z.project(G,h.WGS84));return(yield x())(J.spatialReference,J,K,I)});return y.apply(this,arguments)}function x(){return D.apply(this,arguments)}function D(){D=f._asyncToGenerator(function*(){return(yield new Promise(function(I,
G){a(["../../../geometry/geometryEngineJSON"],I,G)})).geodesicBuffer});return D.apply(this,arguments)}const C=new p.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),B=Object.freeze({}),v=new m,E=new m,F=new m,L={esriGeometryPoint:l.convertToPoint,esriGeometryPolyline:l.convertToPolyline,esriGeometryPolygon:l.convertToPolygon,esriGeometryMultipoint:l.convertToMultipoint},
N=(I,G)=>"_geVersion"!==I?G:void 0;u.QUERY_ENGINE_EMPTY_RESULT=B;u.cleanFromGeometryEngine=function(I){return I&&"_geVersion"in I?JSON.parse(JSON.stringify(I,N)):I};u.getCentroid=function(I,G,K){if("esriGeometryPolygon"!==I.geometryType||!G||!G.centroid&&!G.geometry)return null;G.centroid||(G.centroid=k.getCentroidOptimizedGeometry(new m,G.geometry,I.hasZ,I.hasM));return r(I,G.centroid,K)};u.getGeometry=function(I,G,K,H,J,M,O=G,Q=K){const S=G&&O,V=K&&Q;H=H?"coords"in H?H:H.geometry:null;if(!H)return null;
if(J)return G=l.generalizeOptimizedGeometry(E,H,G,K,I,J,O,Q),M&&(G=l.quantizeOptimizedGeometry(F,G,S,V,I,M)),L[I](G,S,V);if(M)return M=l.quantizeOptimizedGeometry(F,H,G,K,I,M,O,Q),L[I](M,S,V);l.removeZMValues(v,H,G,K,O,Q);return L[I](v,S,V)};u.normalizeFilter=function(I,G,K){return d.apply(this,arguments)};u.normalizeQuery=function(I,G,K){return c.apply(this,arguments)};u.normalizeQueryLike=g;u.transformCentroid=r;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(){return new Promise(function(g,A){a(["../../../geometry/geometryEngineJSON"],g,A)})}function r(){r=f._asyncToGenerator(function*(g,A,q){const {spatialRel:y,geometry:x}=g;if(x){if(!0!==d.spatialRelationship[y])throw new p("feature-store:unsupported-query","Unsupported query spatial relationship",{query:g});if(n.isValid(x.spatialReference)&&n.isValid(q)){if(!0!==d.queryGeometry[e.getJsonType(x)])throw new p("feature-store:unsupported-query","Unsupported query geometry type",
{query:g});if(!0!==d.layerGeometry[A])throw new p("feature-store:unsupported-query","Unsupported layer geometry type",{query:g});if(g.outSR)return l.checkProjectionSupport(g.geometry&&g.geometry.spatialReference,g.outSR)}}});return r.apply(this,arguments)}const c={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",
esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},d={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},
layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};u.canQueryWithRBush=function(g){if(e.isExtent(g))return!0;if(e.isPolygon(g)){for(const A of g.rings)if(5!==A.length||A[0][0]!==A[1][0]||A[0][0]!==A[4][0]||A[2][0]!==A[3][0]||A[0][1]!==A[3][1]||A[0][1]!==A[4][1]||A[1][1]!==A[2][1])return!1;return!0}return!1};u.checkSpatialQuerySupport=function(g,A,q){return r.apply(this,arguments)};u.getSpatialQueryOperator=function(g,
A,q,y,x){if(e.isPolygon(A)&&"esriGeometryPoint"===q&&("esriSpatialRelIntersects"===g||"esriSpatialRelContains"===g)){const D=h.convertFromPolygon(new k,A,!1,!1);return Promise.resolve(C=>b.polygonContainsPoint(D,!1,!1,C))}if(e.isPolygon(A)&&"esriGeometryMultipoint"===q){const D=h.convertFromPolygon(new k,A,!1,!1);if("esriSpatialRelContains"===g)return Promise.resolve(C=>b.polygonContainsMultipoint(D,!1,!1,C,y,x))}if(e.isExtent(A)&&"esriGeometryPoint"===q&&("esriSpatialRelIntersects"===g||"esriSpatialRelContains"===
g))return Promise.resolve(D=>t.extentContainsPoint(A,m.getGeometry(q,y,x,D)));if(e.isExtent(A)&&"esriGeometryMultipoint"===q&&"esriSpatialRelContains"===g)return Promise.resolve(D=>t.extentContainsMultipoint(A,m.getGeometry(q,y,x,D)));if(e.isExtent(A)&&"esriSpatialRelIntersects"===g){const D=w.getExtentIntersector(q);return Promise.resolve(C=>D(A,m.getGeometry(q,y,x,C)))}return z().then(D=>{const C=D[c[g]].bind(null,A.spatialReference,A);return B=>C(m.getGeometry(q,y,x,B))})};Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,u){a.extentIntersectsExtent=u.extentIntersectsExtent;a.extentIntersectsMultipoint=u.extentIntersectsMultipoint;a.extentIntersectsPoint=u.extentIntersectsPoint;a.extentIntersectsPolygon=u.extentIntersectsPolygon;a.extentIntersectsPolyline=u.extentIntersectsPolyline;a.getFeatureExtentIntersector=u.getFeatureExtentIntersector;a.isSelfIntersecting=u.isSelfIntersecting;a.segmentIntersects=
u.segmentIntersects;a.getExtentIntersector=function(f){return"mesh"===f?u.extentIntersectsExtent:u.getFeatureExtentIntersector(f)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function u(f,p,t,w,e){if(!f)return!1;p=p?t?4:3:t?3:2;const {coords:n,lengths:b}=f;t=!1;f=0;for(const k of b){var h=f;for(let l=f,m=f+k*p;l<m;l+=p){h=l+p;h===m&&(h=f);const z=n[l],r=n[l+1],c=n[h];h=n[h+1];(r<e&&h>=e||h<e&&r>=e)&&z+(e-r)/(h-r)*(c-
z)<w&&(t=!t)}f+=k*p}return t}a.polygonContainsCoords=u;a.polygonContainsMultipoint=function(f,p,t,w,e,n){e=e?n?4:3:n?3:2;const {coords:b,lengths:h}=w;if(!h)return!1;for(let k=0,l=0;k<h.length;k++,l+=e)if(!u(f,p,t,b[l],b[l+1]))return!1;return!0};a.polygonContainsPoint=function(f,p,t,w){return u(f,p,t,w.coords[0],w.coords[1])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/smartMapping/support/utils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../support/arcadeOnDemand",
"../../support/basemapUtils"],function(a,u,f,p){function t(){t=u._asyncToGenerator(function*(m){const z=m.field,r=m.normalizationField;m=m.valueExpression;var c=[];m&&(l||({arcadeUtils:c}=yield f.loadArcade(),l=c),c=l.extractFieldNames(m));z&&c.push(z);r&&c.push(r);return c});return t.apply(this,arguments)}function w(m){return String(m).padStart(2,"0")}function e(m,z,r){if("date"===z||"number"===z){"number"===z&&(m=new Date(m));z=r?m.getFullYear():m.getUTCFullYear();const c=w((r?m.getMonth():m.getUTCMonth())+
1),d=w(r?m.getDate():m.getUTCDate()),g=w(r?m.getHours():m.getUTCHours()),A=w(r?m.getMinutes():m.getUTCMinutes());m=w(r?m.getSeconds():m.getUTCSeconds());m=`TIMESTAMP'${z}-${c}-${d} ${g}:${A}:${m}'`}return m}function n(m,z){if(z instanceof Date)return"date";if("number"===typeof z)return"number";if("string"===typeof z&&(m=m.getField(z),"\x3cnow\x3e"!==z.toLowerCase()&&m&&"date"===m.type))return"field"}const b={light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},h={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},k=["integer","small-integer"];let l=null;a.castIntegerFieldToFloat=function(m){return`cast(${m} as float)`};a.defaultBasemapGroups=b;a.getBasemapGroup=function(m,z=b){for(const r in z)if(-1<z[r].indexOf(m))return r};a.getBasemapId=function(m,z,r=!0){let c=null;m&&("string"===typeof m?z.includes(m)&&(c=m):c=p.getWellKnownBasemapId(m));
return r?c||"gray":c};a.getDateDiffSQL=function(m,z,r,c){var {hasQueryEngine:d}=m;r=e(r,n(m,r),d);m=e(z,n(m,z),d);m=`(${r} - ${m})`;d&&(m=`(${m} * ${h.milliseconds})`);c=h[c];d="/";1>c&&(c=1/c,d="*");return{sqlExpression:1===c?m:`(${m} ${d} ${c})`,sqlWhere:null}};a.getDateType=n;a.getFieldsList=function(m){return t.apply(this,arguments)};a.getNormalizationType=function(m){let z=m.normalizationType;z||(m.normalizationField?z="field":null!=m.normalizationTotal&&(z="percent-of-total"));return z};a.isIntegerField=
function(m,z){return(m=z&&m.getField(z))&&-1<k.indexOf(m.type)};a.unitValueInDays=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/floorFilterUtils":function(){define(["exports"],function(a){a.getFloorFilterClause=function(u){var f=u.layer;if("floorInfo"in f&&f.floorInfo){u=u.view.floors;if(!u||!u.length)return null;u=u.filter(p=>""!==p).map(p=>`'${p}'`);u.push("''");f=f.floorInfo.floorField;return`${f} IN (${u.join(", ")}) OR ${f} IS NULL`}return null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../TimeExtent ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../geometry/support/jsonUtils ../../../rest/support/Query".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){var c;b=new t.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});t=new t.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});w=c=function(d){function g(q){q=d.call(this,q)||this;q.where=null;q.geometry=null;q.spatialRelationship="intersects";q.hiddenIds=new Set;q.distance=void 0;q.objectIds=null;q.units=null;q.timeExtent=null;q.enabled=!1;return q}a._inheritsLoose(g,d);var A=g.prototype;A.writeWhere=function(q,y){y.where=q||"1\x3d1"};A.enable=function(){this._set("enabled",!0)};
A.createQuery=function(q={}){const {where:y,geometry:x,spatialRelationship:D,timeExtent:C,objectIds:B,units:v,distance:E}=this;return new r({geometry:e.clone(x),objectIds:e.clone(B),spatialRelationship:D,timeExtent:e.clone(C),where:y,units:v,distance:E,...q})};A.clone=function(){const {where:q,geometry:y,spatialRelationship:x,hiddenIds:D,timeExtent:C,objectIds:B,units:v,distance:E}=this,F=new Set;D.forEach(L=>F.add(L));return new c({geometry:e.clone(y),hiddenIds:F,objectIds:e.clone(B),spatialRelationship:x,
timeExtent:e.clone(C),where:q,units:v,distance:E})};return g}(w.JSONSupport);u.__decorate([n.property({type:String})],w.prototype,"where",void 0);u.__decorate([m.writer("where")],w.prototype,"writeWhere",null);u.__decorate([n.property({types:f.geometryTypes,json:{read:z.fromJSON,write:!0}})],w.prototype,"geometry",void 0);u.__decorate([n.property({type:String,json:{read:{source:"spatialRel",reader:b.read},write:{target:"spatialRel",writer:b.write}}})],w.prototype,"spatialRelationship",void 0);u.__decorate([n.property({json:{write:(d,
g,A)=>g[A]=Array.from(d),read:d=>new Set(d)}})],w.prototype,"hiddenIds",void 0);u.__decorate([n.property({type:Number,json:{write:{overridePolicy(d){return{enabled:0<d}}}}})],w.prototype,"distance",void 0);u.__decorate([n.property({type:[Number],json:{write:!0}})],w.prototype,"objectIds",void 0);u.__decorate([n.property({type:String,json:{read:t.read,write:{writer:t.write,overridePolicy(d){return{enabled:d&&0<this.distance}}}}})],w.prototype,"units",void 0);u.__decorate([n.property({type:p,json:{write:!0}})],
w.prototype,"timeExtent",void 0);u.__decorate([n.property({readOnly:!0})],w.prototype,"enabled",void 0);return w=c=u.__decorate([l.subclass("esri.views.layers.support.FeatureFilter")],w)})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){f=function(r){function c(){var g=r.apply(this,arguments)||this;g.suspended=!1;g.extent=null;g.extentIntersectionDirty=!0;g._isVisibleBelowSurface=!1;g.handles=new p;g.layerView=null;g.updating=!0;return g}a._inheritsLoose(c,r);var d=c.prototype;d.setup=function(g){this.layerView=g;this.extentIntersection=new m.FrustumExtentIntersection({renderCoordsHelper:g.view.renderCoordsHelper});g=g.view;const A=g.basemapTerrain,q=g.resourceController.scheduler;this.handles.add([g.on("resize",
()=>this.viewChange()),g.state.watch("camera",()=>this.viewChange(),!0),q.registerTask(z.TaskPriority.FRUSTUM_VISIBILITY,this),A.on("elevation-bounds-change",()=>this.elevationBoundsChange())]);"local"===g.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([t.init(A,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),t.init(g,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])};d.destroy=function(){this.extentIntersection=this.extent=this.layerView=
null;this.handles&&(this.handles.destroy(),this.handles=null)};d._setDirty=function(){this.updating||this._set("updating",!0)};d.setExtent=function(g){this.extent=g;this.extentIntersectionDirty=!0;this._setDirty()};d.viewChange=function(){this._setDirty()};d.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};d.updateIsVisibleBelowSurface=function(){const g=this.layerView.view,A=g.basemapTerrain,q=g.map.ground&&g.map.ground.navigationConstraint&&"none"===g.map.ground.navigationConstraint.type;
this.isVisibleBelowSurface="local"===g.viewingMode||!A.opaque||q};d.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var g=this.layerView.view;if(this._isVisibleBelowSurface)var A=-.3*l.getReferenceEllipsoid(g.spatialReference).radius;else{const {min:q,max:y}=g.basemapTerrain.elevationBounds;A=q-Math.max(1,(y-q)*(1.2-1))}this.extentIntersection.update(this.extent,g.spatialReference,A)}};d.runTask=function(){this._set("updating",!1);if(this.extent){this.updateExtentIntersection();
var g=this.layerView.view.frustum,A=l.getReferenceEllipsoid(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(g,A))}else this._set("suspended",!1)};a._createClass(c,[{key:"isVisibleBelowSurface",set:function(g){this._isVisibleBelowSurface=g;this._setDirty();this.extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);return c}(f);u.__decorate([w.property({readOnly:!0})],f.prototype,"suspended",void 0);u.__decorate([w.property({readOnly:!0})],
f.prototype,"updating",void 0);return f=u.__decorate([k.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],f)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,u,f,p){let t=function(){function w(n){this._graphicsCore=n;this._stateSets=[]}var e=w.prototype;e.destroy=function(){this._stateSets&&this._stateSets.forEach(n=>n.objectStateSet.removeAll());
this._stateSets=null};e.acquireSet=function(n,b){const h=new p.Graphics3DObjectStateSet(n,b);this._stateSets.push(h);n=f.makeHandle(()=>this.releaseSet(h));return{set:h,handle:n}};e.releaseSet=function(n){n.objectStateSet.removeAll();n=this._stateSets?this._stateSets.indexOf(n):-1;-1!==n&&this._stateSets.splice(n,1)};e._addObjectStateSet=function(n,b){n.addObjectStateSet(b.stateType,b.objectStateSet)};e._removeObjectStateSet=function(n,b){n.removeObjectState(b.objectStateSet)};e.setUid=function(n,
b){n.ids.add(b);(b=this._graphicsCore.graphics3DGraphics.get(b))&&this._addObjectStateSet(b,n)};e.setUids=function(n,b){b.forEach(h=>this.setUid(n,h))};e.setObjectIds=function(n,b){b.forEach(h=>n.ids.add(h));this.initializeSet(n)};e.addGraphic=function(n){this._stateSets.forEach(b=>{!b.paused&&b.hasGraphic(n)&&this._addObjectStateSet(n,b)})};e.removeGraphic=function(n){this._stateSets.forEach(b=>{b.hasGraphic(n)&&this._removeObjectStateSet(n,b)})};e.allGraphicsDeleted=function(){this._stateSets&&
this._stateSets.forEach(n=>n.objectStateSet.removeAll())};e.initializeSet=function(n){const b=this._graphicsCore.graphics3DGraphics;n.objectIdField?b.forEach(h=>{h&&n.hasGraphic(h)&&this._addObjectStateSet(h,n)}):n.ids.forEach(h=>{(h=b.get(h))&&this._addObjectStateSet(h,n)})};u._createClass(w,[{key:"test",get:function(){return{states:this._stateSets}}}]);return w}();a.Graphics3DObjectStates=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports",
"../../webgl-engine/lib/Object3DStateSet"],function(a,u){let f=function(){function p(t,w){this.stateType=t;this.objectIdField=w;this.objectStateSet=new u.Object3DStateSet;this.ids=new Set;this.paused=!1}p.prototype.hasGraphic=function(t){return this.objectIdField?this.ids.has(t.graphic.attributes[this.objectIdField]):this.ids.has(t.graphic.uid)};return p}();a.Graphics3DObjectStateSet=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports"],
function(a){let u=function(){function f(){this.items=[]}var p=f.prototype;p.addObject=function(t,w){this.items.push({type:0,objectStateId:w,object:t})};p.addRenderGeometry=function(t,w,e){this.items.push({type:1,objectStateId:w,renderGeometry:t,owner:e})};p.addExternal=function(t,w){this.items.push({type:2,objectStateId:w,remove:t})};p.remove=function(t){for(let w=this.items.length-1;0<=w;--w){const e=this.items[w];e.objectStateId===t&&(this._removeObjectStateItem(e),this.items.splice(w,1))}};p.removeObject=
function(t){for(let w=this.items.length-1;0<=w;--w){const e=this.items[w];0===e.type&&e.object===t&&(this._removeObjectStateItem(e),this.items.splice(w,1))}};p.removeRenderGeometry=function(t){for(let w=this.items.length-1;0<=w;--w){const e=this.items[w];1===e.type&&e.renderGeometry===t&&(this._removeObjectStateItem(e),this.items.splice(w,1))}};p.removeAll=function(){this.items.forEach(t=>{this._removeObjectStateItem(t)});this.items=[]};p._removeObjectStateItem=function(t){switch(t.type){case 0:0===
t.objectStateId.channel?t.object.removeHighlight(t.objectStateId):1===t.objectStateId.channel&&t.object.removeOcclude(t.objectStateId);break;case 1:t.owner.removeRenderGeometryObjectState(t.renderGeometry,t.objectStateId);break;case 2:t.remove(t.objectStateId)}};return f}();a.Object3DStateSet=u;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){f=function(z){function r(){var d=z.apply(this,arguments)||this;d._scaleRangeActive=!1;d.layerScaleRangeVisibilityQuery=!1;d.handles=new p;d.layerView=null;d.layer=null;d.queryGraphicUIDsInExtent=null;d.extent=null;d.graphicsCore=null;d.basemapTerrain=null;d.layerScaleEnabled=!0;d.suspended=!1;d.updating=!0;return d}a._inheritsLoose(r,z);var c=r.prototype;c.setup=function(d,g,A,q,y){this.layerView=d;this.layer=g;this.queryGraphicUIDsInExtent=A;this.graphicsCore=
q;this.basemapTerrain=y;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(m.TaskPriority.SCALE_VISIBILITY,this))};c.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};c._setDirty=function(){this.updating||this._set("updating",!0)};c.setExtent=function(d){this.extent=d;this._setDirty()};c.scaleRangeActive=function(){return this._scaleRangeActive};c.updateScaleRangeActive=
function(){var d=this.layer;let g=this.layerScaleEnabled&&(0<d.minScale||0<d.maxScale);d.labelingInfo&&!g&&(g=d.labelingInfo.some(A=>A&&(0<A.minScale||0<A.maxScale)));d=this._scaleRangeActive!==g;(this._scaleRangeActive=g)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",A=>this.scaleUpdateHandler(A)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):
!g&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return d};c.runTask=function(){const d=this.layerView.view.basemapTerrain;this.extent&&d&&d.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,d.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,g=>this.finishUpdate(g))):this.finishUpdate(!0)};c.finishUpdate=function(d){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",
!d);this._set("updating",!1)};c.visibleAtLayerScale=function(d){return!this.layerScaleEnabled||l.scaleBoundsPredicate(d,this.layer.minScale||0,this.layer.maxScale||0)};c.visibleAtLabelScale=function(d,g){return l.scaleBoundsPredicate(d,g.minScale||0,g.maxScale||0)};c.graphicScale=function(d){let g;t.isSome(d.centroid)?g=d.centroid:t.isSome(d.graphic.geometry)&&"point"===d.graphic.geometry.type&&(g=d.graphic.geometry);return g?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(g):
1:null};c.graphicVisible=function(d){if(!this.layerScaleEnabled)return!0;d=this.graphicScale(d);return this.visibleAtLayerScale(d)};c.updateVisibility=function(d){if(this._scaleRangeActive){const g=this.graphicVisible(d);return d.setVisibilityFlag(1,g,0)}return!1};c.updateGraphicLabelScaleVisibility=function(d){if(!this._scaleRangeActive||!d.labelGraphics||0===d.labelGraphics.length)return!1;const g=this.graphicScale(d);if(d=this.updateLabelScaleVisibility(d,g))this.layerView.view.deconflictor.setDirty(),
this.layerView.view.labeler.setDirty();return d};c.updateLabelScaleVisibility=function(d,g){if(!d.labelGraphics||0===d.labelGraphics.length)return!1;const A=d.labelGraphics[0]._labelClass;return A&&null!=A.minScale&&null!=A.maxScale&&(g=this.visibleAtLabelScale(g,A),d.setVisibilityFlag(1,g,1))?!0:!1};c.scaleUpdateHandler=function(d){this._setDirty();if(!this.layerView.suspended){var g=d.extent,A=d.scale,q=this.visibleAtLayerScale(A),y=!1;this.queryGraphicUIDsInExtent(g,d.spatialReference,x=>{x=this.graphicsCore.getGraphics3DGraphicById(x);
if(!t.isNone(x)){var D=x.centroid;t.isSome(D)&&(g[0]>D.x||g[1]>D.y||g[2]<D.x||g[3]<D.y)||(x.setVisibilityFlag(1,q,0)&&(y=!0),this.updateLabelScaleVisibility(x,A)&&(y=!0))}});y&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};c.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(d=>d.clearVisibilityFlag(1)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();
this._setDirty()};a._createClass(r,[{key:"running",get:function(){return!(!this.layerView.view.basemapTerrain||!this.updating)}}]);return r}(f);u.__decorate([w.property({constructOnly:!0})],f.prototype,"layerScaleEnabled",void 0);u.__decorate([w.property({readOnly:!0})],f.prototype,"suspended",void 0);u.__decorate([w.property({readOnly:!0})],f.prototype,"updating",void 0);return f=u.__decorate([k.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],f)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],
function(a){a.attributeLookup=function(u,f,p){if(!p||null==f)return null;if(!u){a:{u=p.toLowerCase();for(var t in f)if(t.toLowerCase()===u){f=f[t];break a}f=null}return f}return(t=u.get(p))?f[t.name]:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,u,f){a.toViewIfLocal=function(p){const t=p.view.spatialReference,
w=p.layer.fullExtent,e=w&&w.spatialReference;return e?e.equals(t)?Promise.resolve(w.clone()):u.canProject(e,t)?Promise.resolve(u.project(w,t)):p.view.state.isLocal?f.projectGeometry(w,t,p.layer.portalItem).then(n=>!p.destroyed&&n?n:void 0).catch(()=>null):Promise.resolve(null):Promise.resolve(null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,u,f,p,t){let w=function(){function e(b){this._capabilities=this._memoryCache=null;const h=b.layerView.layer;this.layerView=b.layerView;this.objectIdField=h.objectIdField;this.globalIdField="globalIdField"in h?h.globalIdField:null;this.returnZ=b.returnZ;this.returnM=b.returnM;const k=this.layerView.view.resourceController;this.query=t.createFeatureTileQuery3D(h,l=>k.schedule(l));k&&this.memoryCacheEnabled&&(this._memoryCache=k.memoryController.getMemCache(h.uid))}
var n=e.prototype;n.destroy=function(){this._memoryCache=f.destroyMaybe(this._memoryCache);this.query.destroy()};n.createQuery=function(){const b=this.layerView.layer.createQuery();b.outFields=this.layerView.availableFields;b.returnZ=this.returnZ;b.returnM=this.returnM;b.outSpatialReference=this.tilingScheme.spatialReference;return b};n.logFetchError=function(b,h){b.error("#fetchTile()",this.layerView.layer,h&&h.message?h.message:h)};u._createClass(e,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;
case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const b=this.layerView.view.resourceController;return b?b.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},
{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return f.isSome(this._capabilities)?this._capabilities:this._capabilities=p.contextCapabilitiesFromLayer(this.layerView.layer)}}]);return e}();a.FeatureTileFetcher3DLayerViewContext=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){let c=function(q){function y(D){return q.call(this,D)||this}u._inheritsLoose(y,q);var x=y.prototype;x.queryFeatureCount=function(D,C){return this.layer.queryFeatureCount(D,C)};x.destroy=function(){this._decoder=t.destroyMaybe(this._decoder)};x._createRequestOptions=function(D){return{...D,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==D?void 0:D.query}}};u._createClass(y,[{key:"queryFeaturesDehydrated",get:function(){var D=this.layer.capabilities;
if((D=D&&D.query)&&D.supportsFormatPBF){var C,B;t.isNone(this._decoder)&&(this._decoder=new r.PBFDecoder(this.schedule));const v={sourceSpatialReference:null!=(C=null==(B=this.layer.spatialReference)?void 0:B.toJSON())?C:null,applyTransform:!0,maxStringAttributeLength:1024};return(E,F)=>z.runQuery(this.layer.parsedUrl,E,"pbf",this._createRequestOptions(F)).then(L=>{w.throwIfAborted(F);return t.isSome(this._decoder)?this._decoder.invoke({buffer:L.data,options:v},F.signal):Promise.reject(w.createAbortError())})}return(v,
E)=>z.executeQuery(this.layer.parsedUrl,v,this.layer.spatialReference,this._createRequestOptions(E)).then(F=>m.fromFeatureSetJSON(F.data))}}]);return y}(p);f.__decorate([e.property({constructOnly:!0})],c.prototype,"layer",void 0);f.__decorate([e.property({constructOnly:!0})],c.prototype,"schedule",void 0);f.__decorate([e.property({readOnly:!0})],c.prototype,"queryFeaturesDehydrated",null);c=f.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],c);let d=
function(q){function y(D){return q.call(this,D)||this}u._inheritsLoose(y,q);var x=y.prototype;x.queryFeaturesDehydrated=function(D,C){return this.layer.queryFeatures(D,C)};x.queryFeatureCount=function(D,C){return this.layer.queryFeatureCount(D,C)};return y}(p);f.__decorate([e.property({constructOnly:!0})],d.prototype,"layer",void 0);f.__decorate([e.property({readOnly:!0})],d.prototype,"queryFeaturesDehydrated",null);d=f.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],
d);let g=function(q){function y(x){return q.call(this,x)||this}u._inheritsLoose(y,q);y.prototype.queryFeaturesDehydrated=function(x,D){return this.layer.queryFeatures(x,D)};return y}(p);f.__decorate([e.property({constructOnly:!0})],g.prototype,"layer",void 0);g=f.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],g);let A=function(q){function y(D){return q.call(this,D)||this}u._inheritsLoose(y,q);var x=y.prototype;x.queryFeaturesDehydrated=function(D,
C){return this.source.queryFeaturesJSON(D,C).then(m.fromFeatureSetJSON,B=>{if(B&&"query-features-json:unsupported"===B.name)return this.layer.queryFeatures(D,C);throw B;})};x.queryFeatureCount=function(D,C){return this.layer.queryFeatureCount(D,C)};return y}(p);f.__decorate([e.property({constructOnly:!0})],A.prototype,"layer",void 0);f.__decorate([e.property({constructOnly:!0})],A.prototype,"source",void 0);A=f.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
A);a.createFeatureTileQuery3D=function(q,y){return"feature"===q.type&&"feature-layer"===q.source.type?t.isSome(q.infoFor3D)?new d({layer:q}):new c({layer:q,schedule:y}):"feature"===q.type&&"memory"===q.source.type||"csv"===q.type||"geojson"===q.type||"wfs"===q.type?new A({layer:q,source:q.source}):"ogc-feature"===q.type?new g({layer:q}):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,u,f,p,t,w,e){let n=function(){function h(l){this._schedule=l;this._handle=new b(l)}var k=h.prototype;k.destroy=function(){this._handle.destroy()};k.invoke=function(l,m){if(!l.buffer||0===l.buffer.byteLength)return Promise.resolve(null);l.options.sourceSpatialReference&&l.options.sourceSpatialReference instanceof w&&(l.options={...l.options,sourceSpatialReference:l.options.sourceSpatialReference.toJSON()});return this._handle.invoke(l,m).then(z=>this._schedule(()=>{z.spatialReference=w.fromJSON(z.spatialReference);
if(z.fields)for(var r=0;r<z.fields.length;r++)z.fields[r]=e.fromJSON(z.fields[r]);r=z.spatialReference;for(const c of z.features)c.uid=f.generateUID(),p.isSome(c.geometry)&&(c.geometry.spatialReference=r);return z}))};return h}(),b=function(h){function k(l){return h.call(this,"PBFDecoderWorker","_parseFeatureQuery",l)||this}u._inheritsLoose(k,h);k.prototype.getTransferList=function(l){return[l.buffer]};return k}(t.WorkerHandle);a.PBFDecoder=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/SetUtils"],function(a,u,f,p){f=function(t){function w(){var n=t.apply(this,arguments)||this;n._set=new Set;return n}u._inheritsLoose(w,t);var e=w.prototype;e.clear=function(){if(0<this._set.size){const n=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:n})}};e.addMany=function(n){if(0!==n.length){for(const b of n)this._set.add(b);this.emit("after-changes",{type:1});
this.emit("change",{added:n,removed:[]})}};e.remove=function(n){this._set.delete(n)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[n]}))};e.removeMany=function(n){const b=[];for(const h of n)this._set.delete(h)&&b.push(h);0<b.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:b}))};e.toArray=function(){return[...this._set]};e.find=function(n){let b;p.someSet(this._set,h=>n(h)?(b=h,!0):!1);return b};e.forEach=function(n){this._set.forEach(b=>
n(b))};u._createClass(w,[{key:"length",get:function(){return this._set.size}}]);return w}(f);a.EventedSet=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q){const y=t.getLogger("esri.views.layers.FeatureLayerView");t=x=>{x=function(D){function C(...v){v=D.call(this,...v)||this;v._updatingRequiredFieldsPromise=null;v.effect=null;v.filter=null;v.timeExtent=null;v.layer=null;v.requiredFields=[];v.view=null;return v}u._inheritsLoose(C,D);var B=C.prototype;B.initialize=function(){n.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);n.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());n.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};B.highlight=function(v){throw Error("missing implementation");};B.createQuery=function(){var v={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};v=w.isSome(this.filter)?this.filter.createQuery(v):new c(v);w.isSome(this.timeExtent)&&(v.timeExtent=w.isSome(v.timeExtent)?v.timeExtent.intersection(this.timeExtent):
this.timeExtent.clone());return v};B.queryFeatures=function(v,E){throw Error("missing implementation");};B.queryObjectIds=function(v,E){throw Error("missing implementation");};B.queryFeatureCount=function(v,E){throw Error("missing implementation");};B.queryExtent=function(v,E){throw Error("missing implementation");};B._loadArcadeModules=function(v){if(v.get("expressionInfos.length"))return d.loadArcade()};B._handleRequiredFieldsChange=function(){const v=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",
v);v.then(()=>{this._updatingRequiredFieldsPromise===v&&this._set("_updatingRequiredFieldsPromise",null)})};B._updateRequiredFields=function(){var v=u._asyncToGenerator(function*(){if(this.layer&&this.view){var E="3d"===this.view.type,{layer:F,layer:{fieldsIndex:L,objectIdField:N}}=this,I="renderer"in F&&F.renderer,G=F.featureReduction,K=new Set;I=yield e.eachAlways([I?I.collectRequiredFields(K,L):null,r.collectLabelingFields(K,F),E?r.collectElevationFields(K,F):null,w.isSome(this.filter)?r.collectFilterFields(K,
F,this.filter):null,this.effect?r.collectFilterFields(K,F,this.effect.filter):null,G?r.collectFeatureReductionFields(K,F,G):null]);F.timeInfo&&this.timeExtent&&r.collectFields(K,F.fieldsIndex,[F.timeInfo.startField,F.timeInfo.endField]);"feature"===F.type&&F.floorInfo&&r.collectFields(K,F.fieldsIndex,[F.floorInfo.floorField]);"subtype-group"===F.type&&(r.collectField(K,L,F.subtypeField),G=F.sublayers.map(H=>{var J;return Promise.all([null==(J=H.renderer)?void 0:J.collectRequiredFields(K,L),r.collectLabelingFields(K,
H)])}),yield e.eachAlways(G));for(const H of I)H.error&&y.error(H.error);r.collectField(K,L,N);E&&"displayField"in F&&F.displayField&&r.collectField(K,L,F.displayField);E=Array.from(K).sort();this._set("requiredFields",E)}});return function(){return v.apply(this,arguments)}}();B.validateFetchPopupFeatures=function(v){if(w.isNone(v))return null;for(const E of v.clientGraphics){const F=E.layer;if("popupEnabled"in F&&!F.popupEnabled)return new p("featurelayerview:fetchPopupFeatures","Popups are disabled",
{layer:F});if("popupTemplate"in F&&!q.getFetchPopupTemplate(F,v))return new p("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:F})}};B.fetchClientPopupFeatures=function(){var v=u._asyncToGenerator(function*(E){var F=w.isSome(E)?E.clientGraphics:null;if(!F||0===F.length)return Promise.resolve([]);const L=[],N=[],I=yield this.createPopupQuery(E);for(const K of F){var {layer:G}=K;if(!("popupEnabled"in G))continue;F=r.unpackFieldNames(this.layer.fieldsIndex,I.outFields);
G=q.getFetchPopupTemplate(G,E);if(!w.isSome(G))continue;const H=yield this._loadArcadeModules(G);H&&H.arcadeUtils.hasGeometryOperations(G)||!r.featureHasFields(F,K)?N.push(K):L.push(K)}if("stream"===this.layer.type||0===N.length)return Promise.resolve(L);I.objectIds=N.map(K=>K.attributes[this.layer.objectIdField]);return this.layer.queryFeatures(I).then(K=>L.concat(K.features)).catch(()=>N)});return function(E){return v.apply(this,arguments)}}();B.createPopupQuery=function(){var v=u._asyncToGenerator(function*(E){const F=
this.layer.createQuery(),L=new Set;var N=!1,I=w.isSome(E)&&E.clientGraphics?E.clientGraphics.map(G=>G.layer):[this.layer];for(const G of I)if("popupEnabled"in G&&(I=q.getFetchPopupTemplate(G,E),w.isSome(I))){N=(N=yield this._loadArcadeModules(I))&&N.arcadeUtils.hasGeometryOperations(I);N=!("point"!==this.layer.geometryType&&!N);I=yield q.getRequiredFields(this.layer,I);for(const K of I)L.add(K)}F.returnGeometry=N;F.returnZ=N;F.returnM=N;F.outFields=Array.from(L);F.outSpatialReference=this.view.spatialReference;
return F});return function(E){return v.apply(this,arguments)}}();B.canResume=function(){return!D.prototype.canResume.call(this)||w.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};u._createClass(C,[{key:"availableFields",get:function(){const {layer:v,layer:{fieldsIndex:E},requiredFields:F}=this;return"outFields"in v&&v.outFields?r.fixFields(E,[...r.unpackFieldNames(E,v.outFields),...F]):r.fixFields(E,F)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(v){y.error("#maximumNumberOfFeatures\x3d",
"Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return C}(x);f.__decorate([b.property()],x.prototype,"_updatingRequiredFieldsPromise",void 0);f.__decorate([b.property({readOnly:!0})],x.prototype,"availableFields",null);f.__decorate([b.property({type:g})],x.prototype,"effect",void 0);f.__decorate([b.property({type:A})],x.prototype,"filter",void 0);f.__decorate([b.property(z.combinedViewLayerTimeExtentProperty)],x.prototype,
"timeExtent",void 0);f.__decorate([b.property()],x.prototype,"layer",void 0);f.__decorate([b.property({type:Number})],x.prototype,"maximumNumberOfFeatures",null);f.__decorate([b.property({readOnly:!0,type:Boolean})],x.prototype,"maximumNumberOfFeaturesExceeded",null);f.__decorate([b.property({readOnly:!0})],x.prototype,"requiredFields",void 0);f.__decorate([b.property()],x.prototype,"suspended",void 0);f.__decorate([b.property()],x.prototype,"view",void 0);return x=f.__decorate([m.subclass("esri.views.layers.FeatureLayerView")],
x)};a.FeatureLayerView=t;a.default=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./FeatureFilter".split(" "),function(a,u,f,p,t,w,e,n,b,
h){var k;f=k=function(l){function m(){var z=l.apply(this,arguments)||this;z.filter=null;z.includedEffect=null;z.excludedEffect=null;z.excludedLabelsVisible=!1;return z}a._inheritsLoose(m,l);m.prototype.clone=function(){return new k({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return m}(f.JSONSupport);u.__decorate([p.property({type:h,json:{write:!0}})],f.prototype,"filter",void 0);
u.__decorate([p.property({json:{write:!0}})],f.prototype,"includedEffect",void 0);u.__decorate([p.property({json:{write:!0}})],f.prototype,"excludedEffect",void 0);u.__decorate([p.property({type:Boolean,json:{write:!0}})],f.prototype,"excludedLabelsVisible",void 0);return f=k=u.__decorate([b.subclass("esri.views.layers.support.FeatureEffect")],f)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],
function(a,u,f,p){function t(){t=u._asyncToGenerator(function*(w,e=w.popupTemplate){if(!f.isSome(e))return[];const n=yield e.getRequiredFields(w.fieldsIndex);({lastEditInfoEnabled:e}=e);const {objectIdField:b,typeIdField:h,globalIdField:k,relationships:l}=w;if(n.includes("*"))return["*"];e=e?yield p.getFeatureEditFields(w):[];const m=p.fixFields(w.fieldsIndex,[...n,...e]);h&&m.push(h);m&&b&&w.fieldsIndex.has(b)&&-1===m.indexOf(b)&&m.push(b);m&&k&&w.fieldsIndex.has(k)&&-1===m.indexOf(k)&&m.push(k);
l&&l.forEach(z=>{({keyField:z}=z);m&&z&&w.fieldsIndex.has(z)&&-1===m.indexOf(z)&&m.push(z)});return m});return t.apply(this,arguments)}a.getFetchPopupTemplate=function(w,e){return w.popupTemplate?w.popupTemplate:f.isSome(e)&&e.defaultPopupTemplateEnabled&&f.isSome(w.defaultPopupTemplate)?w.defaultPopupTemplate:null};a.getRequiredFields=function(w){return t.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler ../../../layers/support/CodedValueDomain".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca){const da=t.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ha=y.create();t=function(R){function U(){var T=R.apply(this,arguments)||this;T.type="point-cloud-3d";T.maximumPointCount=4E6;T.slicePlaneEnabled=!1;T._renderer=null;T._rendererAdded=!1;T._renderedNodes=new Set;T._nodeScales=new Map;T._updateViewNeeded=!0;T._lodFactor=1;T._maxLoggedBoxWarnings=5;T._pageMultiplier=1;T._nodeLoadEpoch=0;
T._indexQueue=[];T._workQueue=[];T._idleQueue=new v;T._indexPagesLoading=new Map;T._loadingNodes=new Map;T._recalcWork=!0;T._layerIsVisible=!1;T._codedDomainPopulationPromise=null;T._codedDomainPopulationAbortController=null;T._totalWork=0;T._index=null;T._loadingInitNodePage=!1;T._nodeIdArray=[];return T}a._inheritsLoose(U,R);var Z=U.prototype;Z.initialize=function(){const T=this.view.resourceController;this._worker=new L.PointCloudWorkerHandle(aa=>T.schedule(aa));this.addResolvingPromise(this._worker.promise);
this._tmpPoint=x.makeDehydratedPoint(0,0,0,this.layer.spatialReference);N.checkPointCloudLayerValid(this.layer);N.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=T.createStreamDataRequester(2);this._dataRequester=T.createStreamDataRequester(3);this._initRenderer();const P=this._initNodePages(),X=this.view.resourceController.memoryController;this._memCache=X.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),2);
this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2);this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2);this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2);this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2);this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded());this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view.state,
"contentCamera",()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",aa=>this._scaleUpdateHandler(aa)),X.events.on("quality-changed",()=>this._setUpdateViewNeeded())]);this.addResolvingPromise(P);this.when(()=>{this.handles.add([T.scheduler.registerTask(ba.TaskPriority.POINT_CLOUD_LAYER,this),T.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",aa=>{aa?this._clearNodeState():this._setUpdateViewNeeded()},
2)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};Z._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};Z.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=
null};Z._initRenderer=function(){this._renderer=new M.PointRenderer({createGraphic:(T,P,X)=>this._createGraphic(T,P,X)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",T=>this._renderer.clippingBox=T,2);this.updatingHandles.add(this,"suspended",T=>this._setPointsVisible(!T),2);this.updatingHandles.add(this,"pointScale",T=>this._renderer.scaleFactor=T,2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",T=>this._renderer.useRealWorldSymbolSizes=
T,2);this.updatingHandles.add(this,"pointSize",T=>{const P=n.pt2px(T);this._renderer.size=T;this._renderer.sizePx=P},2);this.updatingHandles.add(this,"slicePlaneEnabled",T=>this._renderer.slicePlane=T,2);this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",T=>{this._lodFactor=T;this._setUpdateViewNeeded()},
2)};Z._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};Z._createGraphic=function(T,P,X){const aa=w.isSome(T.pointIdFilterMap)?T.pointIdFilterMap[P]:P;X=this.view.computeMapPointFromVec3d(X);const ja=this._createGraphicAttributes(T,aa);return new J.PointGraphic({pointCloudMetadata:{nodeId:T.id,pointIndexInNode:P,attributePointIndexInNode:aa,epoch:this._nodeLoadEpoch},geometry:X,attributes:ja,layer:this.layer,sourceLayer:this.layer})};Z._createGraphicAttributes=function(T,
P){const X={};for(const aa of T.attributes)this._encodeGraphicAttribute(aa.attributeInfo,aa.values,P,X);return X};Z._encodeGraphicAttribute=function(T,P,X,aa){var ja=T.storageInfo&&T.storageInfo.attributeValues;const ia=ja?ja.valuesPerElement:1;if(1===ia)aa[T.name]=P[X];else if("UInt8"===ja.valueType&&4>=ia){ja=0;X*=ia;for(let ka=X;ka<X+ia;ka++)ja=(ja<<8)+P[ka];aa[T.name]=ja}else aa[T.name]=void 0};Z._setPointsVisible=function(T){T&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),
this._rendererAdded=!0):!T&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};Z._rendererChanged=function(){this._renderer.useFixedSizes=K.rendererUsesFixedSizes(this.layer.renderer);this._reload()};Z._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};Z._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};Z._scaleUpdateHandler=function(T){this.layer.minScale||
this.layer.maxScale?g.projectBoundingRect(T.extent,T.spatialReference,fa,this.layer.spatialReference)&&(this._nodeScales.forEach((P,X)=>{this._renderedNodes.has(X)?(P=this._index.getNode(X),q.containsPoint(fa,P.obb.center)&&this._nodeScales.set(X,T.scale)):this._nodeScales.delete(X)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};Z.displayNodes=function(T){this._workQueue=I.nodeDiff([...this._renderedNodes],T,this._index);I.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,
this._index);I.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<T.length||this._loadingInitNodePage;this.notifyChange("suspended")};Z.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};Z._cancelNodeLoading=function(){const T=[];this._loadingNodes.forEach(({abortController:P})=>T.push(P));this._loadingNodes.clear();for(const P of T)P.abort();this._workQueue=[];this._idleQueue.cancelAll();
this._totalWork=this._computeWork();this._updateLoading()};Z._updateQueues=function(){const T=new Set;this._workQueue.forEach(aa=>aa.load.forEach(ja=>T.add(ja)));const P=[],X=new Map;this._loadingNodes.forEach((aa,ja)=>{T.has(ja)?X.set(ja,aa):P.push(aa)});this._loadingNodes=X;for(const {abortController:aa}of P)aa.abort();this._workQueue=this._workQueue.filter(aa=>{for(const ja of aa.load)if(this._loadingNodes.has(ja))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};
Z._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:T})=>T.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};Z._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(T=>this._removeFromRenderer(T));this._cancelNodeLoading()};Z._idleBegin=function(){this._setUpdateViewNeeded()};Z._idleEnd=function(){this._setUpdateViewNeeded()};Z.runTask=function(T){if(this.suspended)this._updateViewNeeded&&
(this._updateViewNeeded=!1,T=this._isRootNodeVisible(),T!==this._layerIsVisible&&(this._layerIsVisible=T,this.notifyChange("suspended")),this._updateLoading());else{for(T.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&T.run(()=>this._processIndexQueue()););for(this._processWorkQueue(T);0<this._idleQueue.length&&T.run(()=>this._idleQueue.process()););}};Z._processIndexQueue=function(){const T=this._indexQueue.shift(),P=this._loadNodePage(T);this._indexPagesLoading.set(T,P);P.promise.then(X=>
{this._index.addPage(T,X,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(T)},()=>{this._indexPagesLoading.delete(T)});return!0};Z._processWorkQueue=function(T){for(;!T.done;){const P=this._scheduleWorkEntry();if(w.isNone(P))break;this._processWorkEntry(P);T.madeProgress()}};Z._scheduleWorkEntry=function(){let T=this._workQueue.length;for(;T--;){const P=this._workQueue.shift();if(P.remove.find(X=>!this._renderedNodes.has(X)))this._workQueue.push(P);else return P}return null};
Z._processWorkEntry=function(T){if(0===T.load.length)for(const P of T.remove)this._removeFromRenderer(P);else Promise.all(T.load.map(P=>{const X=e.createAbortController(),aa=this._memCache.pop(P.toString());w.isSome(aa)?this._loadingNodes.set(P,{abortController:X,promise:Promise.resolve(aa)}):this._loadingNodes.has(P)||this._loadingNodes.set(P,{abortController:X,promise:this.loadNode(P,X.signal)});return this._loadingNodes.get(P).promise})).then(P=>{for(let X=0;X<T.load.length;X++)if(P[X]){const aa=
this._setupRendererData(T.load[X],P[X]);this._addToRenderer(aa)}for(const X of T.remove)this._removeFromRenderer(X)}).catch(()=>{}).then(()=>{for(const P of T.load)this._loadingNodes.delete(P);this._updateLoading();this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};Z.populateClassCodeCodedDomain=function(){var T=a._asyncToGenerator(function*(P,X){const aa=this.layer.fieldsIndex.get("CLASS_CODE");
aa&&!aa.domain&&-1!==P.indexOf(aa.name)&&(P=yield f.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:X})),!1!==P.ok&&(P=(P=P.value)&&P.labels&&P.labels.labels)&&Array.isArray(P)&&(aa.domain=new ca({name:"CLASS_CODE",codedValues:P.map(ja=>new D["default"]({code:ja.value,name:ja.label}))})))});return function(P,X){return T.apply(this,arguments)}}();Z.prepareFetchPopupFeatures=function(){var T=a._asyncToGenerator(function*(P){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=
e.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(P,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise});return function(P){return T.apply(this,arguments)}}();Z.whenGraphicAttributes=function(){var T=a._asyncToGenerator(function*(P,X){var aa=this;const ja=this._splitGraphicsPerNode(P),ia=this.layer.attributeStorageInfo,ka=X.map(pa=>K.getAttributeInfo(ia,
pa)),na=function(){var pa=a._asyncToGenerator(function*(xa,Da){const Ka=aa._index.getNode(Da);yield f.forEach(ka,function(){var Fa=a._asyncToGenerator(function*(Ha){const ua=Ha.useElevation?yield aa._loadElevationAttributeFromGeometry(Ka.resourceId):yield aa._loadAndParseAttribute(Ka,Ha);if(ua)for(const Ba of xa)aa._isValidPointGraphic(Ba)&&aa._encodeGraphicAttribute(Ha,ua,Ba.pointCloudMetadata.attributePointIndexInNode,Ba.attributes)});return function(Ha){return Fa.apply(this,arguments)}}())});return function(xa,
Da){return pa.apply(this,arguments)}}(),ta=[];ja.forEach((pa,xa)=>{ta.push(na(pa,xa))});yield e.eachAlways(ta);return P});return function(P,X){return T.apply(this,arguments)}}();Z._isValidPointGraphic=function(T){return T instanceof J.PointGraphic&&T.pointCloudMetadata&&T.pointCloudMetadata.epoch===this._nodeLoadEpoch};Z._splitGraphicsPerNode=function(T){const P=new Map;for(const X of T){if(!this._isValidPointGraphic(X))continue;T=X.pointCloudMetadata;const aa=P.get(T.nodeId);aa?aa.push(X):P.set(T.nodeId,
[X])}return P};Z._loadAndParseAttribute=function(){var T=a._asyncToGenerator(function*(P,X){const aa=yield this._loadAttribute(P.resourceId,X,null);return w.isSome(aa)?H.getAttributeValues({attributeInfo:X,buffer:aa},null,P.vertexCount):null});return function(P,X){return T.apply(this,arguments)}}();Z._loadElevationAttributeFromGeometry=function(){var T=a._asyncToGenerator(function*(P){P=H.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(P,null));return H.elevationFromPositions(P,
P.length/3)});return function(P){return T.apply(this,arguments)}}();Z.highlight=function(T){if(!T)return{remove(){}};T=p.isCollection(T)?T.toArray():Array.isArray(T)?T:[T];return this._renderer.highlight(T.map(P=>this._graphicToPointDefinition(P)))};Z._graphicToPointDefinition=function(T){if(!this._isValidPointGraphic(T))return null;const {nodeId:P,pointIndexInNode:X}=T.pointCloudMetadata;return null!=P&&null!=X?{nodeId:P,pointId:X}:null};Z._computeWork=function(){let T=0;for(const P of this._workQueue)T+=
P.load.length+P.remove.length;T+=this._loadingNodes.size;T+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;T+=this._loadingInitNodePage?100:0;return T+=this._updateViewNeeded?100:0};Z._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};Z.canResume=function(){return R.prototype.canResume.call(this)&&this._layerIsVisible};Z.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};Z._initNodePages=
function(){const T=this.layer.store.index;this._index=new G(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,T.nodesPerPage||T.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=T.nodesPerPage?1:T.nodePerIndexBlock;return this._loadNodePage(0).promise.then(P=>{this._index.addPage(0,P,this._elevationOffset);
this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};Z._loadNodePage=function(T){const P=e.createAbortController();return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${T*this._pageMultiplier}`,P.signal).then(X=>X.nodes.map((aa,ja)=>({resourceId:null!=aa.resourceId?aa.resourceId:T*this._index.pageSize+ja,obb:aa.obb,firstChild:aa.firstChild,childCount:aa.childCount,vertexCount:null!=aa.vertexCount?aa.vertexCount:aa.pointCount,lodThreshold:null!=aa.lodThreshold?aa.lodThreshold:aa.effectiveArea}))),
abortController:P}};Z._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let T=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const P=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let X=this._computeNodesForMinimumDensity(T),aa=this._computePointCount(X),ja=Math.sqrt(aa/(.75*P));for(;aa>P;)T*=ja,X=this._computeNodesForMinimumDensity(T),aa=this._computePointCount(X),ja=Math.sqrt(2);this.displayNodes(X);this._updateViewNeeded=!1;this._updateLoading();
return!0};Z._computePointCount=function(T){let P=0;for(let X=0;X<T.length;X++){const aa=this._index.getNode(T[X]);aa&&(P+=aa.vertexCount)}return P};Z._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};Z._isRootNodeVisible=function(){let T=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(P,X,aa)=>{T=aa;return!1},pageMiss:()=>{}});return T};Z._computeNodesForMinimumDensity=function(T){const P=
this.view.state.contentCamera,X=P.frustum,aa=this._clippingBox,ja=P.viewForward,ia=c.dot(ja,P.eye),ka=y.fromNormalAndOffset(ja,-ia,ha),na=P.perScreenPixelRatio/2,ta=T*T,pa=this._nodeIdArray;pa.length=0;const {minScale:xa,maxScale:Da}=W.extractSafeScaleBounds(this.layer),Ka=0===xa&&0===Da?Fa=>pa.push(Fa):Fa=>{const Ha=this._getScale(Fa);W.scaleBoundsPredicate(Ha,xa,Da)&&pa.push(Fa)};this._traverseVisible({frustum:X,clippingBox:aa},{predicate:(Fa,Ha,ua)=>{if(!ua)return!1;if(0===Ha.childCount)return Ka(Fa),
!1;ua=this._index.getRenderObb(Fa);return this._computeAveragePixelArea(ua,Ha.lodThreshold,Ha.vertexCount,ka,na)<=ta?(Ka(Fa),!1):!0},pageMiss:(Fa,Ha)=>{Ka(Fa);0>this._indexQueue.indexOf(Ha)&&this._indexQueue.push(Ha)}});return pa};Z._getScale=function(T){var P=this._nodeScales.get(T);null==P&&(P=this._index.getNode(T).obb.center,this._tmpPoint.x=P[0],this._tmpPoint.y=P[1],this._tmpPoint.z=P[2],P=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(T,P));return P};Z._computeAveragePixelArea=
function(T,P,X,aa,ja){T=Math.max(1E-7,S.minimumDistancePlane(T,aa));return P/(T*T)/(4*ja*ja)/X};Z.loadNode=function(T,P){try{return this.loadNodeAsync(T,P)}catch(X){throw e.isAbortError(X)||da.error(X),X;}};Z.loadAdditionalUserAttributes=function(){var T=a._asyncToGenerator(function*(P,X,aa){var ja=this.layer.outFields;if(!ja)return[];ja=B.unpackFieldNames(this.layer.fieldsIndex,ja);P=new Set(P.map(na=>w.isSome(na)?na.name:null));const ia=this.layer.attributeStorageInfo,ka=[];for(const na of ja)P.has(na)||
(ja=K.getAttributeInfo(ia,na))&&ka.push(X(ja));X=yield e.eachAlwaysValues(ka);e.throwIfAborted(aa);return w.mapSome(X,na=>na)});return function(P,X,aa){return T.apply(this,arguments)}}();Z.loadNodeAsync=function(){var T=a._asyncToGenerator(function*(P,X){var aa=this;const ja=this._index.getNode(P),ia=K.getRendererInfo(this.layer),ka=K.getFilterInfo(this.layer),na=ja.resourceId,ta=function(){var pa=a._asyncToGenerator(function*(xa){if(w.isNone(xa))return null;if(xa.useElevation)return{attributeInfo:xa,
buffer:null};const Da=yield aa._loadAttribute(na,xa,X);return w.isSome(Da)?{attributeInfo:xa,buffer:Da}:null});return function(xa){return pa.apply(this,arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var pa=aa._loadGeometry(na,X);const {primaryAttribute:xa,modulationAttribute:Da}=ia,Ka=ta(xa),Fa=ta(Da);var Ha=ka.map(Ma=>Ma.attributeInfo);const ua=Ha.map(Ma=>ta(Ma));Ha=aa.loadAdditionalUserAttributes([xa,Da,...Ha],ta,X);const [Ba,Ea,Ga,ma,ya]=yield Promise.all([pa,Ka,Fa,
Promise.all(ua),Ha]);e.throwIfAborted(X);pa={geometryBuffer:Ba,primaryAttributeData:Ea,modulationAttributeData:Ga,filterAttributesData:ma,userAttributesData:ya,schema:aa.layer.store.defaultGeometrySchema,rendererInfo:ia,filterInfo:ka,obb:aa._index.getRenderObb(P),elevationOffset:aa._elevationOffset,inSR:aa.layer.spatialReference.toJSON(),outSR:aa.view.renderCoordsHelper.spatialReference.toJSON()};return aa._worker.invoke(pa,X)}),X)});return function(P,X){return T.apply(this,arguments)}}();Z._loadGeometry=
function(){var T=a._asyncToGenerator(function*(P,X){return this._requestData(`${this.baseUrl}/nodes/${P}/geometries/0`,X)});return function(P,X){return T.apply(this,arguments)}}();Z._loadAttribute=function(){var T=a._asyncToGenerator(function*(P,X,aa){return w.isNone(X)||!X.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${P}/attributes/${X.storageInfo.key}`,aa)});return function(P,X,aa){return T.apply(this,arguments)}}();Z._requestNodePage=function(T,P){return this._indexRequester.request(T,
"json",{query:{f:"json",token:this.layer.apiKey},signal:P})};Z._requestData=function(T,P){return this._dataRequester.request(T,"binary",{query:{token:this.layer.apiKey},signal:P})};Z._removeFromRenderer=function(T){if(this._renderedNodes.has(T)){const P=this._renderer.removeNode(T);this._renderedNodes.delete(T);this._nodeScales.delete(T);this._memCache.put(P.id.toString(),P,5*P.coordinates.length+128)}};Z._addToRenderer=function(T){this._renderedNodes.has(T.id)||(this._renderedNodes.add(T.id),this._renderer.addNode(T))};
Z._setupRendererData=function(T,P){const X=this._index.getNode(T),aa=Math.sqrt(X.lodThreshold/X.vertexCount),ja=this._index.getRenderObb(T);if(M.PointRenderer.isInstanceOfNode(P))return P.splatSize=aa,P.obb=ja,P.origin=d.clone(P.obb.center),P;var ia=.01*Math.max(ja.halfSize[0],ja.halfSize[1],ja.halfSize[2]);if(P.obb.halfSize[0]>ja.halfSize[0]+ia||P.obb.halfSize[1]>ja.halfSize[1]+ia||P.obb.halfSize[2]>ja.halfSize[2]+ia)0<this._maxLoggedBoxWarnings&&(ia=ka=>`[${ka.halfSize[0]}, ${ka.halfSize[1]}, ${ka.halfSize[2]}]`,
da.warn(`Node ${T} reported bounding box too small. got ${ia(ja)} but points cover ${ia(P.obb)}`),0===--this._maxLoggedBoxWarnings&&da.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(T,P.obb);return{id:T,coordinates:P.points,origin:d.clone(ja.center),rgb:P.rgb,attributes:P.attributes,pointIdFilterMap:P.pointIdFilterMap,highlights:null,splatSize:aa,obb:ja,isLeaf:0===X.childCount}};Z.getUsedMemory=function(){let T=0;this._renderer.forEachNode(P=>
{T+=160;T+=b.estimateSize(P.coordinates);for(const X of P.attributes)P=X.values,b.isArrayBuffer(P.buffer)&&(T+=b.estimateSize(P))});return T};Z.getUnloadedMemory=function(){var T=this._renderedNodes.size;if(4>T)return 0;const P=[...this._renderedNodes].reduce((ja,ia)=>ja+this._index.getNode(ia).vertexCount);let X=this._loadingNodes.size;for(var aa=0;aa<this._workQueue.length;aa++)X+=this._workQueue[aa].load.length,X-=this._workQueue[aa].remove.length;if(0>X)return 0;aa=X*P/T;T=(this.getUsedMemory()-
160*T)/P;return aa*T+160*X};Z.ignoresMemoryFactor=function(){return!1};a._createClass(U,[{key:"pointScale",get:function(){const T=K.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return T&&null!=T.scaleFactor?T.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const T=K.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return T&&null!=T.useRealWorldSymbolSizes?T.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const T=K.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);
return T&&null!=T.size?T.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var T=K.getRendererInfo(this.layer);const P=new Set;T.primaryAttribute&&P.add(T.primaryAttribute.name);T.modulationAttribute&&P.add(T.primaryAttribute.name);if(T=K.getFilterInfo(this.layer))for(const X of T)P.add(X.attributeInfo.name);if(this.layer.outFields)for(const X of B.unpackFieldNames(this.layer.fieldsIndex,
this.layer.outFields))P.add(X);return Array.from(P)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const T=A.create();return Q.projectToBoundingBox(this.view.clippingArea,T,this.view.renderSpatialReference)?T:null}},{key:"_elevationOffset",get:function(){const T=this.layer&&this.layer.elevationInfo;if(T&&"absolute-height"===T.mode){const P=h.getMetersPerVerticalUnitForSR(this.layer.spatialReference),X=E.getMetersPerUnit(T.unit);return w.unwrapOr(T.offset,0)*
X/P}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const T=this._computeWork();return 1-Math.min(this._totalWork,T)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((T,
P)=>T+this._index.getNode(P).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return U}(O.PopupSceneLayerView(F.LayerView3D(Y)));u.__decorate([k.property()],t.prototype,"layer",void 0);u.__decorate([k.property({readOnly:!0,
aliasOf:"layer.parsedUrl.path"})],t.prototype,"baseUrl",void 0);u.__decorate([k.property({readOnly:!0})],t.prototype,"pointScale",null);u.__decorate([k.property({readOnly:!0})],t.prototype,"useRealWorldSymbolSizes",null);u.__decorate([k.property({readOnly:!0})],t.prototype,"pointSize",null);u.__decorate([k.property({readOnly:!0})],t.prototype,"inverseDensity",null);u.__decorate([k.property()],t.prototype,"maximumPointCount",void 0);u.__decorate([k.property({readOnly:!0})],t.prototype,"availableFields",
null);u.__decorate([k.property({readOnly:!0})],t.prototype,"_clippingBox",null);u.__decorate([k.property({readOnly:!0})],t.prototype,"_elevationOffset",null);u.__decorate([k.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0);u.__decorate([k.property()],t.prototype,"updating",void 0);u.__decorate([k.property(V.updatingProgress)],t.prototype,"updatingProgress",void 0);u.__decorate([k.property({readOnly:!0})],t.prototype,"updatingProgressValue",null);t=u.__decorate([r.subclass("esri.views.3d.layers.PointCloudLayerView3D")],
t);const fa=q.create();return t})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,u,f,p){p=function(t){function w(e){return t.call(this,"PointCloudWorker","transform",e)||this}u._inheritsLoose(w,t);w.prototype.getTransferList=function(e){const n=[e.geometryBuffer];f.isSome(e.primaryAttributeData)&&e.primaryAttributeData.buffer&&n.push(e.primaryAttributeData.buffer);
f.isSome(e.modulationAttributeData)&&e.modulationAttributeData.buffer&&n.push(e.modulationAttributeData.buffer);if(f.isSome(e.filterAttributesData))for(const b of e.filterAttributesData)f.isSome(b)&&b.buffer&&n.push(b.buffer);for(const b of e.userAttributesData)b.buffer&&n.push(b.buffer);return n};return w}(p.WorkerHandle);a.PointCloudWorkerHandle=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/webMercatorUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E){function F(ia){return ia&&parseInt(ia.substring(ia.lastIndexOf("/")+1,ia.length),10)}function L(ia,ka){var na=ka[0],ta=ka[1];ka=ka[3];const pa=ia[0]-na;na-=ia[2];const xa=ia[1]-ta;ia=ta-ia[3];ta=Math.max(pa,na,0);const Da=Math.max(xa,ia,0);ta=ta*ta+Da*Da;return ta>ka*ka?0:0<ta?1:-Math.max(pa,na,xa,ia)>ka?3:2}function N(ia,ka,na){const ta=[],pa=na&&na.missingFields;na=na&&na.originalFields;for(const xa of ia){ia=xa.toLowerCase();let Da=
!1;for(const Ka of ka)if(ia===Ka.name.toLowerCase()){ta.push(Ka.name);Da=!0;na&&na.push(xa);break}!Da&&pa&&pa.push(xa)}return ta}function I(){I=u._asyncToGenerator(function*(ia,ka,na,ta,pa){if(0===ka.length)return[];const xa=ia.attributeStorageInfo;if(e.isSome(ia.associatedLayer))try{return yield K(ia.associatedLayer,ka,na,ta)}catch(Da){if(ia.associatedLayer.loaded)throw Da;}if(xa){ka=G(ka,na,pa);if(e.isNone(ka))throw new t("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");
const Da=ia.parsedUrl.path;ia=yield Promise.all(ka.map(Ka=>M(Da,xa,Ka.node,Ka.indices,ta).then(Fa=>{for(let Ha=0;Ha<Ka.graphics.length;Ha++){const ua=Ka.graphics[Ha],Ba=Fa[Ha];if(ua.attributes)for(const Ea in ua.attributes)Ea in Ba||(Ba[Ea]=ua.attributes[Ea]);ua.attributes=Ba}return Ka.graphics})));return p.flatten(ia)}throw new t("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");});return I.apply(this,arguments)}function G(ia,ka,na){const ta=new Map,
pa=[];na=na();for(const Ka of ia){var xa=Ka.attributes[ka];for(var Da=0;Da<na.length;Da++){ia=na[Da];const Fa=ia.featureIds.indexOf(xa);if(0<=Fa){xa=ta.get(ia.node);xa||(xa={node:ia.node,indices:[],graphics:[]},pa.push(xa),ta.set(ia.node,xa));xa.indices.push(Fa);for(xa.graphics.push(Ka);0<Da;Da--)na[Da]=na[Da-1];na[0]=ia;break}}}return pa}function K(ia,ka,na,ta){return H.apply(this,arguments)}function H(){H=u._asyncToGenerator(function*(ia,ka,na,ta){ka.sort((Da,Ka)=>Da.attributes[na]-Ka.attributes[na]);
var pa=ka.map(Da=>Da.attributes[na]);const xa=[];ta=N(ta,ia.fields,{originalFields:xa});ia=yield J(ia,pa,ta);for(pa=0;pa<ka.length;pa++){const Da=ka[pa],Ka=ia[pa],Fa={};if(Da.attributes)for(const Ha in Da.attributes)Fa[Ha]=Da.attributes[Ha];for(let Ha=0;Ha<xa.length;Ha++)Fa[xa[Ha]]=Ka[ta[Ha]];Da.attributes=Fa}return ka});return H.apply(this,arguments)}function J(ia,ka,na){var ta=ia.capabilities.query.maxRecordCount;if(null!=ta&&ka.length>ta)return ta=p.splitIntoChunks(ka,ta),Promise.all(ta.map(pa=>
J(ia,pa,na))).then(p.flatten);ta=new x({objectIds:ka,outFields:na,orderByFields:[ia.objectIdField]});return ia.queryFeatures(ta).then(pa=>{if(pa&&pa.features&&pa.features.length===ka.length)return pa.features.map(xa=>xa.attributes);throw new t("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function M(ia,ka,na,ta,pa){const xa=[];for(const Da of ka)Da&&-1!==pa.indexOf(Da.name)&&xa.push({url:`${ia}/nodes/${na.resources.attributes}/attributes/${Da.key}/0`,
storageInfo:Da});return n.eachAlways(xa.map(Da=>f(Da.url,{responseType:"array-buffer"}).then(Ka=>D.readBinaryAttribute(Da.storageInfo,Ka.data)))).then(Da=>{const Ka=[];for(const Fa of ta){const Ha={};for(let ua=0;ua<Da.length;ua++)null!=Da[ua].value&&(Ha[xa[ua].storageInfo.name]=O(Da[ua].value,Fa));Ka.push(Ha)}return Ka})}function O(ia,ka){if(!ia)return null;ka=ia[ka];return b.isInt16Array(ia)?-32768===ka?null:ka:b.isInt32Array(ia)?ka===da?null:ka:ka!==ka?null:ka}function Q(ia){var ka=ia.store.indexCRS||
ia.store.geographicCRS;const na=void 0===ka?ia.store.indexWKT:void 0;if(na)if(ia.spatialReference){if(na!==ia.spatialReference.wkt)throw new t("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new t("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});ka=ka?new g(F(ka)):ia.spatialReference;
return ka.equals(ia.spatialReference)?ia.spatialReference:ka}function S(ia){var ka=ia.store.vertexCRS||ia.store.projectedCRS;const na=void 0===ka?ia.store.vertexWKT:void 0;if(na)if(ia.spatialReference){if(na!==ia.spatialReference.wkt)throw new t("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new t("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});ka=ka?new g(F(ka)):ia.spatialReference;return ka.equals(ia.spatialReference)?ia.spatialReference:ka}function V(ia,ka,na){if(!y.canProject(ia,ka))throw new t("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===na&&ia.isGeographic)throw new t("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",
{});}function Y(ia,ka,na){const ta=Q(ia);ia=S(ia);V(ta,ka,na);V(ia,ka,na)}function W(ia,ka,na,ta,pa=0){if(ta===d.getSphericalPCPF(ta))if(ka.isGeographic){var xa=d.getReferenceEllipsoid(ka);ta=1+Math.max(0,pa)/(xa.radius+ia.center[2]);z.set(na.center,ia.center[0],ia.center[1],ia.center[2]+pa);c.projectBuffer(na.center,ka,0,na.center,d.getSphericalPCPF(ka),0,1);l.copy(na.quaternion,ia.quaternion);l.conjugate(R,ia.quaternion);z.set(X,0,0,1);z.transformQuat(X,X,R);z.set(X,ia.halfSize[0]*Math.abs(X[0]),
ia.halfSize[1]*Math.abs(X[1]),ia.halfSize[2]*Math.abs(X[2]));z.scale(X,X,xa.inverseFlattening);z.add(na.halfSize,ia.halfSize,X);z.scale(na.halfSize,na.halfSize,ta)}else{{E.corners(ia,U);z.set(na.center,ia.center[0],ia.center[1],ia.center[2]+pa);c.computeLinearTransformation(ka,na.center,fa,d.getSphericalPCPF(ka));z.set(na.center,fa[12],fa[13],fa[14]);ta=2*Math.sqrt(1+fa[0]+fa[5]+fa[10]);R[0]=(fa[6]-fa[9])/ta;R[1]=(fa[8]-fa[2])/ta;R[2]=(fa[1]-fa[4])/ta;R[3]=.25*ta;l.multiply(na.quaternion,R,ia.quaternion);
l.conjugate(R,na.quaternion);let Da=ta=ia=0;for(xa of U)xa[2]+=pa,c.projectBuffer(xa,ka,0,xa,d.getSphericalPCPF(ka),0,1),z.sub(X,xa,na.center),z.transformQuat(X,X,R),ia=Math.max(ia,Math.abs(X[0])),ta=Math.max(ta,Math.abs(X[1])),Da=Math.max(Da,Math.abs(X[2]));z.set(na.halfSize,ia,ta,Da)}}else ia===na?(na.center[2]+=pa,c.projectBuffer(na.center,ka,0,na.center,ta,0,1)):(z.set(na.center,ia.center[0],ia.center[1],ia.center[2]+pa),c.projectBuffer(na.center,ka,0,na.center,ta,0,1),l.copy(na.quaternion,ia.quaternion),
z.copy(na.halfSize,ia.halfSize))}const ba=A.create(),ca=r.create(),da=-(2**31);r=B.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let ha=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const fa=k.create(),R=m.create(),U=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Z=q.create(),T=q.create(),P=E.create(),X=[0,0,0],aa={data:Array(72),size:3},ja=k.create();a.SymbolInfo=ha;a.addWraparound=function(ia,ka){return(ia|0)+(ka|0)|0};a.checkPointCloudLayerCompatibleWithView=
function(ia,ka){V(ia.spatialReference,ka.spatialReference,ka.viewingMode)};a.checkPointCloudLayerValid=function(ia){var ka;(ka=null==ia.store||null==ia.store.defaultGeometrySchema)||(ia=ia.store.defaultGeometrySchema,ka=!!(null==ia.geometryType||"points"!==ia.geometryType||null!=ia.topology&&"PerAttributeArray"!==ia.topology||null!=ia.encoding&&""!==ia.encoding&&"lepcc-xyz"!==ia.encoding||null==ia.vertexAttributes||null==ia.vertexAttributes.position));if(ka)throw new t("pointcloud:unsupported-geometry-schema",
"The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(ia,ka){Y(ia,ka.spatialReference,ka.viewingMode)};a.checkSceneLayerValid=function(ia){var ka;(ka=null==ia.store||null==ia.store.defaultGeometrySchema)||(ka=ia.store.defaultGeometrySchema,ka=!!(null!=ka.geometryType&&"triangles"!==ka.geometryType||null!=ka.topology&&"PerAttributeArray"!==ka.topology||null==ka.vertexAttributes||null==ka.vertexAttributes.position));if(ka)throw new t("scenelayer:unsupported-geometry-schema",
"The geometry schema of this scene layer is not supported.",{url:ia.parsedUrl.path});};a.checkSpatialReference=V;a.checkSpatialReferences=Y;a.computeVisibilityObb=function(ia,ka,na,ta,pa,xa){if(!xa||0===xa.length||e.isNone(ka))return null;const Da=C.computeGlobalTransformation(ia.mbs,pa,na,ka);h.invert(ja,Da);let Ka;const Fa=()=>{if(!Ka)if(Ka=U,q.empty(T),e.isSome(ia.serviceObb)){W(ia.serviceObb,na,P,ka,pa);E.corners(P,Ka);for(var Ea of Ka)z.transformMat4(Ea,Ea,ja),q.expandPointInPlace(T,Ea)}else{var Ga=
ia.mbs;Ea=Ga[3];c.projectVectorToVector(Ga,na,X,ka);z.transformMat4(X,X,ja);X[2]+=pa;for(Ga=0;8>Ga;++Ga){const ma=Ka[Ga];z.copy(ma,[X[0]+(Ga&1?Ea:-Ea),X[1]+(Ga&2?Ea:-Ea),X[2]+(Ga&4?Ea:-Ea)]);q.expandPointInPlace(T,ma)}}};let Ha=Infinity,ua=-Infinity;const Ba=Ea=>{if("replace"===Ea.type&&(Ea=Ea.geometry,Ea.hasZ)){q.empty(Z);var Ga=Ea.spatialReference||ta;Ea=Ea.rings.reduce((ma,ya)=>ya.reduce((Ma,Ra)=>{c.projectVectorToVector(Ra,Ga,X,ka);z.transformMat4(X,X,ja);q.expandPointInPlace(Z,X);return Math.min(X[2],
Ma)},ma),Infinity);Fa();q.intersects(T,Z)&&(Ha=Math.min(Ha,Ea),ua=Math.max(ua,Ea))}};xa.forEach(Ea=>Ba(Ea));if(Infinity===Ha)return null;xa=(Ea,Ga,ma)=>{z.transformMat4(X,ma,Da);Ea[Ga+0]=X[0];Ea[Ga+1]=X[1];Ea[Ga+2]=X[2];Ga+=24;ma[2]=Ha;z.transformMat4(X,ma,Da);Ea[Ga+0]=X[0];Ea[Ga+1]=X[1];Ea[Ga+2]=X[2];Ga+=24;ma[2]=ua;z.transformMat4(X,ma,Da);Ea[Ga+0]=X[0];Ea[Ga+1]=X[1];Ea[Ga+2]=X[2]};for(let Ea=0;8>Ea;++Ea)xa(aa.data,3*Ea,Ka[Ea]);return E.compute(aa)};a.containsDraco=function(ia){if(w("disable-feature:i3s-draco")||
!ia)return!1;for(const ka of ia)for(const na of ka.geometryBuffers)if("draco"===na.compressedAttributes.encoding)return!0;return!1};a.extractWkid=F;a.filterInPlace=function(ia,ka,na){let ta=0,pa=0;for(let xa=0;xa<ka.length&&ta<ia.length;xa++)ia[ta]===ka[xa]&&(na(xa)&&(ia[pa]=ia[ta],pa++),ta++);ia.length=pa};a.findFieldsCaseInsensitive=N;a.findIntersectingNodes=function(ia,ka,na,ta,pa,xa){pa.traverse(na,Da=>{var Ka=Da.mbs;ka!==ta&&(Ka=ca,c.projectBoundingSphere(Da.mbs,ta,Ka,ka));Ka=L(ia,Ka);if(0===
Ka)return!1;xa(Da,Ka);return!0})};a.getCacheKeySuffix=function(ia,ka){return e.isNone(ka)?"@null":ka===d.getSphericalPCPF(ka)?"@ECEF":ia.equals(ka)?"":null!=ka.wkid?"@"+ka.wkid:null};a.getCachedAttributeValue=O;a.getClipAABB=function(ia,ka){if(0===ka.rotationScale[1]&&0===ka.rotationScale[2]&&0===ka.rotationScale[3]&&0===ka.rotationScale[5]&&0===ka.rotationScale[6]&&0===ka.rotationScale[7])return ba[0]=(ia[0]-ka.position[0])/ka.rotationScale[0],ba[1]=(ia[1]-ka.position[1])/ka.rotationScale[4],ba[2]=
(ia[2]-ka.position[2])/ka.rotationScale[8],ba[3]=(ia[3]-ka.position[0])/ka.rotationScale[0],ba[4]=(ia[4]-ka.position[1])/ka.rotationScale[4],ba[5]=(ia[5]-ka.position[2])/ka.rotationScale[8],ba};a.getIndexCrs=Q;a.getSymbolInfo=function(ia){const ka=new ha;var na=!1;let ta=!1;for(const xa of ia.symbolLayers.items)if("fill"===xa.type&&xa.enabled){var pa=xa.material;ia=xa.edges;e.isSome(pa)&&!na&&(na=pa.color,pa=v.parseColorMixMode(pa.colorMixMode),e.isSome(na)?ka.material={color:[na.r/255,na.g/255,na.b/
255],alpha:na.a,colorMixMode:pa}:ka.material={color:[1,1,1],alpha:1,colorMixMode:1},ka.castShadows=xa.castShadows,na=!0);e.isSome(ia)&&!ta&&(ka.edgeMaterial=B.createMaterialFromEdges(ia,{}),ta=!0)}ka.material||(ka.material={color:[1,1,1],alpha:1,colorMixMode:1});return ka};a.getVertexCrs=S;a.intersectBoundingBoxWithMbs=function(ia,ka){var na=ka[0],ta=ka[1],pa=ka[2];ka=ka[3];const xa=ia[0]-na;na-=ia[3];const Da=ia[1]-ta;ta-=ia[4];const Ka=ia[2]-pa;ia=pa-ia[5];pa=Math.max(xa,na,0);const Fa=Math.max(Da,
ta,0),Ha=Math.max(Ka,ia,0);pa=pa*pa+Fa*Fa+Ha*Ha;return pa>ka*ka?0:0<pa?1:-Math.max(xa,na,Da,ta,Ka,ia)>ka?3:2};a.intersectBoundingRectWithMbs=L;a.objectIdFilter=function(ia,ka,na){let ta=0,pa=0;for(;ta<na.length;)0<=p.binaryIndexOf(ia,na[ta])===ka&&(na[pa]=na[ta],pa++),ta++;na.length=pa};a.rendererNeedsTextures=function(ia){if(null==ia||"simple"!==ia.type&&"class-breaks"!==ia.type&&"unique-value"!==ia.type||("unique-value"===ia.type||"class-breaks"===ia.type)&&null==ia.defaultSymbol)return!0;ia=ia.getSymbols();
if(0===ia.length)return!0;for(const ka of ia){if("mesh-3d"!==ka.type||0===ka.symbolLayers.length)return!0;for(const na of ka.symbolLayers.items)if("fill"!==na.type||e.isNone(na.material)||e.isNone(na.material.color)||"replace"!==na.material.colorMixMode)return!0}return!1};a.transformObb=W;a.transparentEdgeMaterial=r;a.whenGraphicAttributes=function(ia,ka,na,ta,pa){return I.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define(["exports",
"../../../../core/Error","../../../../core/lang","../../../../core/Logger","./LEPCC"],function(a,u,f,p,t){function w(x,D,C){let B="",v=0;for(;v<C;){var E=x[D+v];if(128>E)B+=String.fromCharCode(E),v++;else if(192<=E&&224>E){if(v+1>=C)throw new u("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");B+=String.fromCharCode((E&31)<<6|x[D+v+1]&63);v+=2}else if(224<=E&&240>E){if(v+2>=C)throw new u("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");B+=
String.fromCharCode((E&15)<<12|(x[D+v+1]&63)<<6|x[D+v+2]&63);v+=3}else if(240<=E&&248>E){if(v+3>=C)throw new u("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");E=(E&7)<<18|(x[D+v+1]&63)<<12|(x[D+v+2]&63)<<6|x[D+v+3]&63;B=65536<=E?B+String.fromCharCode((E-65536>>10)+55296,(E&1023)+56320):B+String.fromCharCode(E);v+=4}else throw new u("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return B}function e(x,D){const C={byteOffset:0,byteCount:0,fields:Object.create(null)};
let B=0;for(let v=0;v<D.length;v++){const E=D[v],F=E.valueType||E.type;C.fields[E.property]=(0,y[F])(x,B);B+=q[F].BYTES_PER_ELEMENT}C.byteCount=B;return C}function n(x,D,C){const B=[];let v,E=0,F;for(F=0;F<x;F+=1){v=D[F];if(0<v){if(B.push(w(C,E,v-1)),0!==C[E+v-1])throw new u("string-array-error","Invalid string array: missing null termination.");}else B.push(null);E+=v}return B}function b(x,D){return new q[D.valueType](x,D.byteOffset,D.count*D.valuesPerElement)}function h(x,D){return new Uint8Array(x,
D.byteOffset,D.byteCount)}function k(x,D,C){x=null!=D.header?e(x,D.header):{byteOffset:0,byteCount:0,fields:{count:C}};C={header:x,byteOffset:x.byteCount,byteCount:0,entries:Object.create(null)};let B=x.byteCount;for(let v=0;v<D.ordering.length;v++){const E=D.ordering[v],F=f.clone(D[E]);F.count=x.fields.count;if("String"===F.valueType){if(F.byteOffset=B,F.byteCount=x.fields[E+"ByteCount"],"UTF-8"!==F.encoding)throw new u("unsupported-encoding","Unsupported String encoding.",{encoding:F.encoding});
}else if(c(F.valueType)){const L=d(F.valueType);B+=0!==B%L?L-B%L:0;F.byteOffset=B;F.byteCount=L*F.valuesPerElement*F.count}else throw new u("unsupported-value-type","Unsupported binary valueType",{valueType:F.valueType});B+=F.byteCount;C.entries[E]=F}C.byteCount=B-C.byteOffset;return C}function l(x,D,C){D!==x&&g.error(`Invalid ${C} buffer size\n expected: ${x}, actual: ${D})`);if(D<x)throw new u("buffer-too-small","Binary buffer is too small",{expectedSize:x,actualSize:D});}function m(x){return{isDraco:!1,
isLegacy:!1,color:null!=x.color,normal:null!=x.normal,uv0:null!=x.uv0,uvRegion:null!=x.uvRegion,featureIndex:null!=x.faceRange&&null!=x.featureId}}function z(x){const D={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of x.ordering)if(x.vertexAttributes[C])switch(C){case "normal":D.normal=!0;break;case "color":D.color=!0;break;case "uv0":D.uv0=!0;break;case "region":D.uvRegion=!0}x.featureAttributes&&x.featureAttributeOrder&&(D.featureIndex=!0);return D}function r(x){const D=
{isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of x)switch(C){case "normal":D.normal=!0;break;case "uv0":D.uv0=!0;break;case "color":D.color=!0;break;case "uv-region":D.uvRegion=!0;break;case "feature-index":D.featureIndex=!0}return D}function c(x){return q.hasOwnProperty(x)}function d(x){return c(x)?q[x].BYTES_PER_ELEMENT:0}const g=p.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),A={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"},
q={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},y={Float32:(x,D)=>(new DataView(x,0)).getFloat32(D,!0),Float64:(x,D)=>(new DataView(x,0)).getFloat64(D,!0),UInt8:(x,D)=>(new DataView(x,0)).getUint8(D),Int8:(x,D)=>(new DataView(x,0)).getInt8(D),UInt16:(x,D)=>(new DataView(x,0)).getUint16(D,!0),Int16:(x,D)=>(new DataView(x,0)).getInt16(D,!0),UInt32:(x,D)=>(new DataView(x,0)).getUint32(D,!0),Int32:(x,
D)=>(new DataView(x,0)).getInt32(D,!0)};a.createAttributeDataIndex=k;a.createGeometryDescriptor=function(x,D){return x&&x.compressedAttributes&&"draco"===x.compressedAttributes.encoding?r(x.compressedAttributes.attributes):x?m(x):z(D)};a.createGeometryDescriptorForDraco=r;a.createGeometryDescriptorFromDefinition=m;a.createGeometryDescriptorFromSchema=z;a.createGeometryIndexFromSchema=function(x,D){var C=e(x,D&&D.header);let B=C.byteCount;const v={isDraco:!1,header:C,byteOffset:C.byteCount,byteCount:0,
vertexAttributes:{}};C=C.fields;var E=null!=C.vertexCount?C.vertexCount:C.count;for(var F of D.ordering){if(!D.vertexAttributes[F])continue;const N={...D.vertexAttributes[F],byteOffset:B,count:E};v.vertexAttributes[A[F]?A[F]:"_"+F]=N;B+=d(N.valueType)*N.valuesPerElement*E}F=C.faceCount;if(D.faces&&F){v.faces={};for(var L of D.ordering)D.faces[L]&&(E={...D.faces[L],byteOffset:B,count:F},v.faces[L]=E,B+=d(E.valueType)*E.valuesPerElement*F)}L=C.featureCount;if(D.featureAttributes&&D.featureAttributeOrder&&
L){v.featureAttributes={};for(const N of D.featureAttributeOrder)D.featureAttributes[N]&&(C={...D.featureAttributes[N],byteOffset:B,count:L},v.featureAttributes[N]=C,F="UInt64"===C.valueType?8:d(C.valueType),B+=F*C.valuesPerElement*L)}l(B,x.byteLength,"geometry");v.byteCount=B-v.byteOffset;return v};a.createRawView=h;a.createTypedView=b;a.getBytesPerValue=d;a.isValueType=c;a.readBinaryAttribute=function(x,D,C){if("lepcc-rgb"===x.encoding)return t.decodeRGB(D);if("lepcc-intensity"===x.encoding)return t.decodeIntensity(D);
if(null!=x.encoding&&""!==x.encoding)throw new u("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");x["attributeByteCounts "]&&!x.attributeByteCounts&&(g.warn("Warning: Trailing space in 'attributeByteCounts '."),x.attributeByteCounts=x["attributeByteCounts "]);"ObjectIds"===x.ordering[0]&&x.hasOwnProperty("objectIds")&&(g.warn("Warning: Case error in objectIds"),x.ordering[0]="objectIds");C=k(D,x,C);l(C.byteOffset+C.byteCount,D.byteLength,"attribute");if(x=C.entries.attributeValues||
C.entries.objectIds){if("String"===x.valueType){C=C.entries.attributeByteCounts;const B=b(D,C);D=h(D,x);return n(C.count,B,D)}return b(D,x)}throw new u("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readHeader=e;a.readStringArray=n;a.valueType2ArrayBufferReader=y;a.valueType2TypedArrayClassMap=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,u){function f(e,n,b){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(e,b+w.identifierOffset,w.identifierLength)),version:n.getUint16(b+w.versionOffset,!0),checksum:n.getUint32(b+w.checksumOffset,!0)}}function p(e,n,b){const h=[];n=t(e,n,h);const k=[];for(let l=0;l<h.length;l++){k.length=0;n=t(e,n,k);for(let m=0;m<k.length;m++)b.push(k[m]+h[l])}return n}function t(e,n,b){var h=new DataView(e,n),k=h.getUint8(0);const l=k&31;var m=!!(k&32),z=(k&192)>>6;k=0;if(0===z)k=h.getUint32(1,!0),n+=5;else if(1===z)k=h.getUint16(1,!0),n+=3;else if(2===z)k=h.getUint8(1),
n+=2;else throw new u("lepcc-decode-error","Bad count type");if(m)throw new u("lepcc-decode-error","LUT not implemented");e=new Uint8Array(e,n,Math.ceil(k*l/8));z=m=h=0;const r=-1>>>32-l;for(let c=0;c<k;c++){for(;m<l;)h|=e[z]<<m,m+=8,z+=1;b[c]=h&r;h>>>=l;m-=l;32<m+l&&(h|=e[z-1]>>8-m)}return n+z}const w={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(e){const n=new DataView(e,0);var b=0;const {identifier:h,version:k}=f(e,n,b);b+=w.byteCount;
if("Intensity "!==h)throw new u("lepcc-decode-error","Bad identifier");if(1<k)throw new u("lepcc-decode-error","Unknown version");var l=b;var m=n.getUint32(l+0,!0);var z=n.getUint32(l+4,!0);var r=n.getUint32(l+8,!0);var c=n.getUint16(l+12,!0);var d=n.getUint8(l+14);n.getUint8(l+15);b+=16;if(z*2**32+m!==e.byteLength)throw new u("lepcc-decode-error","Bad size");m=new Uint16Array(r);if(8===d){if(r+b!==e.byteLength)throw new u("lepcc-decode-error","Bad size");e=new Uint8Array(e,b,r);for(b=0;b<r;b++)m[b]=
e[b]*c}else if(16===d){if(2*r+b!==e.byteLength)throw new u("lepcc-decode-error","Bad size");e=new Uint16Array(e,b,r);for(b=0;b<r;b++)m[b]=e[b]*c}else{d=[];if(t(e,b,d)!==e.byteLength)throw new u("lepcc-decode-error","Bad size");for(e=0;e<r;e++)m[e]=d[e]*c}return m};a.decodeRGB=function(e){var n=new DataView(e,0),b=0;const {identifier:h,version:k}=f(e,n,b);b+=w.byteCount;if("ClusterRGB"!==h)throw new u("lepcc-decode-error","Bad identifier");if(1<k)throw new u("lepcc-decode-error","Unknown version");
var l=b;var m=n.getUint32(l+0,!0);var z=n.getUint32(l+4,!0);var r=n.getUint32(l+8,!0);var c=n.getUint16(l+12,!0);var d=n.getUint8(l+14);l=n.getUint8(l+15);b+=16;if(z*2**32+m!==e.byteLength)throw new u("lepcc-decode-error","Bad size");if((2===d||1===d)&&0===l){if(3*c+r+b!==e.byteLength||256<c)throw new u("lepcc-decode-error","Bad count");n=new Uint8Array(e,b,3*c);b=new Uint8Array(e,b+3*c,r);e=new Uint8Array(3*r);for(c=0;c<r;c++)m=b[c],e[3*c]=n[3*m],e[3*c+1]=n[3*m+1],e[3*c+2]=n[3*m+2];return e}if(0===
d&&0===l){if(3*r+b!==e.byteLength||0!==c)throw new u("lepcc-decode-error","Bad count");return(new Uint8Array(e,b)).slice()}if(2>=d&&1===l){if(b+3!==e.byteLength||1!==c)throw new u("lepcc-decode-error","Bad count");e=n.getUint8(b);c=n.getUint8(b+1);b=n.getUint8(b+2);n=new Uint8Array(3*r);for(m=0;m<r;m++)n[3*m]=e,n[3*m+1]=c,n[3*m+2]=b;return n}throw new u("lepcc-decode-error","Bad method "+d+","+l);};a.decodeXYZ=function(e){var n=new DataView(e,0),b=0;const {identifier:h,version:k}=f(e,n,b);b+=w.byteCount;
if("LEPCC     "!==h)throw new u("lepcc-decode-error","Bad identifier");if(1<k)throw new u("lepcc-decode-error","Unknown version");var l=b;var m=n.getUint32(l+0,!0);var z=n.getUint32(l+4,!0);var r=n.getFloat64(l+8,!0);var c=n.getFloat64(l+16,!0);var d=n.getFloat64(l+24,!0);var g=n.getFloat64(l+32,!0);var A=n.getFloat64(l+40,!0);var q=n.getFloat64(l+48,!0);var y=n.getFloat64(l+56,!0);var x=n.getFloat64(l+64,!0);var D=n.getFloat64(l+72,!0);var C=n.getUint32(l+80,!0);n.getUint32(l+84,!0);b+=88;if(z*2**
32+m!==e.byteLength)throw new u("lepcc-decode-error","Bad size");m=new Float64Array(3*C);z=[];C=[];n=[];l=[];b=p(e,b,z);b=p(e,b,C);b=p(e,b,n);b=p(e,b,l);if(b!==e.byteLength)throw new u("lepcc-decode-error","Bad length");b=e=0;for(let B=0;B<z.length;B++){b+=z[B];let v=0;for(let E=0;E<C[B];E++){v+=n[e];const F=l[e];m[3*e]=Math.min(g,r+2*y*v);m[3*e+1]=Math.min(A,c+2*x*b);m[3*e+2]=Math.min(q,d+2*D*F);e++}}return{errorX:y,errorY:x,errorZ:D,result:m}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,u,f,p,t){function w(e,n,b){const h=f.create(),k=2**(4*Math.ceil(Math.log(e[3])*Math.LOG2E/4)+1);if(b.isGeographic){var l=k/t.getReferenceEllipsoid(b).radius*180/Math.PI;b=Math.max(-90,Math.min(90,Math.round(e[1]/l)*l));l/=Math.cos((Math.abs(b)-l/2)/180*Math.PI);h[0]=Math.round(e[0]/
l)*l;h[1]=b}else b=Math.round(e[1]/k),h[0]=Math.round(e[0]/k)*k,h[1]=b*k;h[2]=Math.round((e[2]+n)/k)*k;return h}a.computeGlobalTransformation=function(e,n,b,h){e=w(e,n,b);n=u.create();p.computeLinearTransformation(b,e,n,h);return n};a.getLocalOrigin=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,u){function f(b,h,k){for(;0<b;){const l=h.indexOf(b);if(0<=l)return l;b=k.getParentId(b)}return h.indexOf(b)}
function p(b,h,k){const l=[h.remove[0]],m=[];for(;1===l.length;){const r=l.pop();m.length=0;for(let c=0;c<h.load.length;c++){let d=h.load[c];for(var z=k.getParentId(d);z!==r;)d=z,z=k.getParentId(d);z=l.indexOf(d);0>z&&(z=l.length,l.push(d),m.push([]));m[z].push(h.load[c])}}h.load=l;for(h=0;h<l.length;h++)1<m[h].length?b.push({remove:[l[h]],load:m[h]}):l[h]=m[h][0]}const t=[!1],w=[null],e=[!1],n=[null];a.nodeDiff=function(b,h,k){for(var l=0;l<h.length;l++)e[l]=!1,n[l]=null;for(l=0;l<b.length;l++)t[l]=
!1,w[l]=null;for(l=0;l<h.length;l++){var m=f(h[l],b,k);0<=m&&(e[l]=!0,null!=w[m]?w[m].push(h[l]):w[m]=[h[l]])}for(l=0;l<b.length;l++)m=f(b[l],h,k),0<=m&&(t[l]=!0,null!=n[m]?n[m].push(b[l]):n[m]=[b[l]]);k=[];for(l=0;l<b.length;l++)null!=w[l]||t[l]||k.push({load:[],remove:[b[l]]});for(l=0;l<h.length;l++)null!=n[l]||e[l]||k.push({load:[h[l]],remove:[]});for(l=0;l<h.length;l++)null!=n[l]&&(1<n[l].length||n[l][0]!==h[l])&&k.push({load:[h[l]],remove:n[l]});for(h=0;h<b.length;h++)null!=w[h]&&(1<w[h].length||
w[h][0]!==b[h])&&k.push({load:w[h],remove:[b[h]]});return k};a.sortFrontToBack=function(b,h,k){return b.sort((l,m)=>{if(0===l.load.length&&0===m.load.length)return 0;if(0===l.load.length)return-1;if(0===m.load.length)return 1;if(0===l.remove.length&&0===m.remove.length)return l=k.getRenderCenter(l.load[0]),m=k.getRenderCenter(m.load[0]),u.dot(l,h)-u.dot(m,h);if(0===l.remove.length)return-1;if(0===m.remove.length)return 1;if(1===l.load.length&&1===m.load.length)return l=k.getRenderCenter(l.load[0]),
m=k.getRenderCenter(m.load[0]),u.dot(l,h)-u.dot(m,h);if(1===l.load.length)return-1;if(1===m.load.length)return 1;l=k.getRenderCenter(l.remove[0]);m=k.getRenderCenter(m.remove[0]);return u.dot(l,h)-u.dot(m,h)})};a.splitWorkEntries=function(b,h,k){for(let l=0;l<b.length;++l){const m=b[l];m.load.length>h&&1===m.remove.length&&p(b,m,k)}};a.splitWorkEntry=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox",
"./I3SUtil","../../support/orientedBoundingBox"],function(a,u,f){return function(){function p(w,e,n){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=w;this._renderSR=e;this.pageSize=n}var t=p.prototype;t.addPage=function(w,e,n=0){for(;this._pages.length<w;)this._pages.push(null);var b=this._nodeSR,h=this._renderSR,k=new f.ObbArray(e.length);for(var l=0;l<e.length;l++)u.transformObb(e[l].obb,b,k.obbs[l],h,n);n=k.obbs;this._pages[w]={nodes:e,renderObbs:n,parents:new Uint32Array(this.pageSize)};
w=this._pages;e=this.pageSize;for(n=[0];n.length;)for(b=n.pop(),h=w[b/e|0].nodes[b%e],k=0;k<h.childCount;k++)l=h.firstChild+k,null!=w[l/e|0]&&(w[l/e|0].parents[l%e]=b,n.push(l))};t.hasPage=function(w){return!!this._pages[w]};t.getNode=function(w){const e=this.pageSize;return this._pages[w/e|0].nodes[w%e]};t.getRenderObb=function(w){const e=this.pageSize;return this._pages[w/e|0].renderObbs[w%e]};t.getRenderCenter=function(w){return this.getRenderObb(w).center};t.setRenderObb=function(w,e){const n=
this.pageSize;f.set(e,this._pages[w/n|0].renderObbs[w%n])};t.getParentId=function(w){const e=this.pageSize;return this._pages[w/e|0].parents[w%e]};t.hasNodes=function(w,e){var n=w/this.pageSize|0;for(w=(w+e-1)/this.pageSize|0;n<=w;n++)if(null==this._pages[n])return!1;return!0};t.forEachNodeId=function(w){for(let e=0;e<this._pages.length;e++){const n=this._pages[e];if(n)for(let b=0;b<n.nodes.length;b++)w(e*this.pageSize+b)}};t.createVisibilityTraverse=function(){var w=this,e=[],n=[],b=a.create();return(h,
k)=>{if(w.hasNodes(0,1))for(e.length=0,e.push(0),n.length=0,n.push(0);0<e.length;){var l=e.pop();let g=n.pop();var m=w.getNode(l),z=w.getRenderObb(l),r=!0;if(null!=h.clippingBox){var c=1<<h.frustum.length;if(0===(g&c)){var d=f.toAaBoundingBox(z,b);a.contains(h.clippingBox,d)?g|=c:a.intersects(h.clippingBox,d)||(r=!1)}}for(c=0;c<h.frustum.length&&r;c++)if(d=1<<c,0===(g&d)){const A=f.intersectPlane(z,h.frustum[c]);0<A?r=!1:0>A&&(g|=d)}if(k.predicate(l,m,r)){z=m.firstChild;m=m.childCount;r=!1;d=z/w.pageSize|
0;for(c=(z+m-1)/w.pageSize|0;d<=c;d++)if(!w.hasPage(d)){k.pageMiss(l,d);r=!0;break}if(!r)for(l=0;l<m;l++)e.push(z+l),n.push(g)}}}};return p}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function u(p,t){for(const w of p)if(w.name===t&&null!=w.attributeValues&&"UInt8"===w.attributeValues.valueType&&3===w.attributeValues.valuesPerElement)return{name:t,storageInfo:w,useElevation:!1};return null}function f(p,t){for(const w of p)if(w.name===t)return p=
"embedded-elevation"===w.encoding,{name:t,storageInfo:p?null:w,useElevation:p};return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=f;a.getFilterInfo=function(p){const t=p.filters;return t?t.map(w=>({filterJSON:w.toJSON(),attributeInfo:f(p.attributeStorageInfo,w.field)})):[]};a.getFixedSizeAlgorithm=function(p){return(p=p&&p.pointSizeAlgorithm)&&"fixed-size"===p.type?p:null};a.getRendererInfo=function(p){const t=p.renderer;var w=t&&t.type;const e=t&&
p.renderer.toJSON()||null;let n=null,b=!1;"point-cloud-unique-value"===w?n=f(p.attributeStorageInfo,t.field):"point-cloud-stretch"===w?n=f(p.attributeStorageInfo,t.field):"point-cloud-class-breaks"===w?n=f(p.attributeStorageInfo,t.field):(n="point-cloud-rgb"===w?u(p.attributeStorageInfo,t.field):u(p.attributeStorageInfo,"RGB"),b=null!=n);w=null;t&&t.colorModulation&&(w=f(p.attributeStorageInfo,t.colorModulation.field));return{rendererJSON:e,isRGBRenderer:b,primaryAttribute:n,modulationAttribute:w}};
a.getSplatSizeAlgorithm=function(p){return(p=p&&p.pointSizeAlgorithm)&&"splat"===p.type?p:null};a.rendererUsesFixedSizes=function(p){return(p=p&&p.pointSizeAlgorithm)&&p.type?"fixed-size"===p.type:!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,u,f,p,t,w,e){function n(k,l){const m=new Float64Array(l);for(let z=0;z<l;z++)m[z]=k[3*z+2];return m}function b(k){return null==k||"none"===k?null:"low-four-bit"===k?l=>l&15:"high-four-bit"===k?l=>(l&240)>>4:"absolute-value"===k?l=>Math.abs(l):"modulo-ten"===k?l=>l%10:null}function h(k){let l=0;for(const m of k?k:[])l|=1<<m;return l}a.elevationFromPositions=n;a.evaluateRenderer=function(k,l,m,z){const {rendererJSON:r,isRGBRenderer:c}=k;var d=k=null;if(l&&c)k=l;else if(l&&"pointCloudUniqueValueRenderer"===
r.type){d=t.fromJSON(r);var g=d.colorUniqueValueInfos;k=new Uint8Array(3*z);var A=b(d.fieldTransformType);for(var q=0;q<z;q++){var y=(A?A(l[q]):l[q])+"";for(var x=0;x<g.length;x++)if(0<=g[x].values.indexOf(y)){k[3*q]=g[x].color.r;k[3*q+1]=g[x].color.g;k[3*q+2]=g[x].color.b;break}}}else if(l&&"pointCloudStretchRenderer"===r.type)for(d=p.fromJSON(r),g=d.stops,k=new Uint8Array(3*z),A=b(d.fieldTransformType),q=0;q<z;q++)if(y=A?A(l[q]):l[q],x=g.length-1,y<g[0].value)k[3*q]=g[0].color.r,k[3*q+1]=g[0].color.g,
k[3*q+2]=g[0].color.b;else if(y>=g[x].value)k[3*q]=g[x].color.r,k[3*q+1]=g[x].color.g,k[3*q+2]=g[x].color.b;else for(x=1;x<g.length;x++){if(y<g[x].value){y=(y-g[x-1].value)/(g[x].value-g[x-1].value);k[3*q]=g[x].color.r*y+g[x-1].color.r*(1-y);k[3*q+1]=g[x].color.g*y+g[x-1].color.g*(1-y);k[3*q+2]=g[x].color.b*y+g[x-1].color.b*(1-y);break}}else if(l&&"pointCloudClassBreaksRenderer"===r.type)for(d=f.fromJSON(r),g=d.colorClassBreakInfos,k=new Uint8Array(3*z),A=b(d.fieldTransformType),q=0;q<z;q++)for(y=
A?A(l[q]):l[q],x=0;x<g.length;x++){if(y>=g[x].minValue&&y<=g[x].maxValue){k[3*q]=g[x].color.r;k[3*q+1]=g[x].color.g;k[3*q+2]=g[x].color.b;break}}else for(k=new Uint8Array(3*z),l=0;l<k.length;l++)k[l]=255;if(m&&d&&d.colorModulation)for(l=d.colorModulation.minValue,d=d.colorModulation.maxValue,g=0;g<z;g++)A=m[g],A=A>=d?1:A<=l?.3:.3+.7*(A-l)/(d-l),k[3*g]*=A,k[3*g+1]*=A,k[3*g+2]*=A;return k};a.filterInPlace=function(k,l,m,z,r){const c=k.length/3;let d=0;for(let D=0;D<c;D++){let C=!0;for(let B=0;B<z.length&&
C;B++){var {filterJSON:g}=z[B],A=r[B].values[D];switch(g.type){case "pointCloudValueFilter":var q="exclude"===g.mode;-1!==g.values.indexOf(A)===q&&(C=!1);break;case "pointCloudBitfieldFilter":q=h(g.requiredSetBits);g=h(g.requiredClearBits);if((A&q)!==q||0!==(A&g))C=!1;break;case "pointCloudReturnFilter":var y=A&15,x=A>>>4&15;A=1<x;q=1===y;y=y===x;x=!1;for(const v of g.includedReturns)if("last"===v&&y||"firstOfMany"===v&&q&&A||"lastOfMany"===v&&y&&A||"single"===v&&!A){x=!0;break}x||(C=!1)}}C&&(m[d]=
D,k[3*d]=k[3*D],k[3*d+1]=k[3*D+1],k[3*d+2]=k[3*D+2],l[3*d]=l[3*D],l[3*d+1]=l[3*D+1],l[3*d+2]=l[3*D+2],d++)}return d};a.getAttributeValues=function(k,l,m){return u.isSome(k)&&k.attributeInfo.useElevation?n(l,m):u.isSome(k)?w.readBinaryAttribute(k.attributeInfo.storageInfo,k.buffer,m):null};a.readGeometry=function(k,l){if(null==k.encoding||""===k.encoding){k=w.createGeometryIndexFromSchema(l,k);if(u.isNone(k.vertexAttributes.position))return;l=w.createTypedView(l,k.vertexAttributes.position);var m=
k.header.fields;k=[m.offsetX,m.offsetY,m.offsetZ];m=[m.scaleX,m.scaleY,m.scaleZ];const z=l.length/3,r=new Float64Array(3*z);for(let c=0;c<z;c++)r[3*c]=l[3*c]*m[0]+k[0],r[3*c+1]=l[3*c+1]*m[1]+k[1],r[3*c+2]=l[3*c+2]*m[2]+k[2];return r}if("lepcc-xyz"===k.encoding)return e.decodeXYZ(l).result};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;t=m=function(z){function r(c){c=z.call(this,c)||this;c.type="point-cloud-class-breaks";c.field=null;c.legendOptions=null;c.fieldTransformType=null;c.colorClassBreakInfos=null;return c}a._inheritsLoose(r,z);r.prototype.clone=function(){return new m({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:f.clone(this.colorClassBreakInfos),legendOptions:f.clone(this.legendOptions)})};return r}(h);u.__decorate([n.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
t.prototype,"type",void 0);u.__decorate([p.property({json:{write:!0},type:String})],t.prototype,"field",void 0);u.__decorate([p.property({type:k["default"],json:{write:!0}})],t.prototype,"legendOptions",void 0);u.__decorate([p.property({type:h.fieldTransformTypeKebabDict.apiValues,json:{type:h.fieldTransformTypeKebabDict.jsonValues,read:h.fieldTransformTypeKebabDict.read,write:h.fieldTransformTypeKebabDict.write}})],t.prototype,"fieldTransformType",void 0);u.__decorate([p.property({type:[l["default"]],
json:{write:!0}})],t.prototype,"colorClassBreakInfos",void 0);return t=m=u.__decorate([b.subclass("esri.renderers.PointCloudClassBreaksRenderer")],t)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){e=f.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});p=function(m){function z(c){c=m.call(this,c)||this;c.type=void 0;c.pointSizeAlgorithm=null;c.colorModulation=null;c.pointsPerInch=10;return c}a._inheritsLoose(z,m);var r=z.prototype;r.clone=function(){console.warn(".clone() is not implemented for "+
this.declaredClass);return null};r.cloneProperties=function(){return{pointSizeAlgorithm:t.clone(this.pointSizeAlgorithm),colorModulation:t.clone(this.colorModulation),pointsPerInch:t.clone(this.pointsPerInch)}};return z}(p.JSONSupport);u.__decorate([w.property({type:e.apiValues,readOnly:!0,nonNullable:!0,json:{type:e.jsonValues,read:!1,write:e.write}})],p.prototype,"type",void 0);u.__decorate([w.property({types:l.pointSizeAlgorithmTypes,json:{write:!0}})],p.prototype,"pointSizeAlgorithm",void 0);
u.__decorate([w.property({type:k["default"],json:{write:!0}})],p.prototype,"colorModulation",void 0);u.__decorate([w.property({json:{write:!0},nonNullable:!0,type:Number})],p.prototype,"pointsPerInch",void 0);p=u.__decorate([h.subclass("esri.renderers.PointCloudRenderer")],p);(p||(p={})).fieldTransformTypeKebabDict=new f.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return p})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h){var k;a.ColorModulation=k=function(l){function m(){var z=l.apply(this,arguments)||this;z.field=null;z.minValue=0;z.maxValue=255;return z}u._inheritsLoose(m,l);m.prototype.clone=function(){return new k({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return m}(p.JSONSupport);f.__decorate([t.property({type:String,json:{write:!0}})],a.ColorModulation.prototype,"field",void 0);f.__decorate([t.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,
"minValue",void 0);f.__decorate([t.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,"maxValue",void 0);a.ColorModulation=k=f.__decorate([h.subclass("esri.renderers.support.pointCloud.ColorModulation")],a.ColorModulation);a.default=a.ColorModulation;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],
function(a,u,f,p){a.pointSizeAlgorithmTypes={key:"type",base:u["default"],typeMap:{"fixed-size":f["default"],splat:p["default"]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h){p=new p.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});a.PointSizeAlgorithm=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(t.JSONSupport);f.__decorate([w.property({type:p.apiValues,readOnly:!0,nonNullable:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],a.PointSizeAlgorithm.prototype,"type",void 0);a.PointSizeAlgorithm=f.__decorate([h.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
a.PointSizeAlgorithm);a.default=a.PointSizeAlgorithm;a.typeKebabDictionary=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,u,f,p,t,w,e,n,b,h){var k;a.PointSizeFixedSizeAlgorithm=k=function(l){function m(){var z=l.apply(this,arguments)||this;z.type="fixed-size";z.size=0;z.useRealWorldSymbolSizes=null;return z}u._inheritsLoose(m,l);m.prototype.clone=function(){return new k({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return m}(h["default"]);f.__decorate([n.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],a.PointSizeFixedSizeAlgorithm.prototype,"type",void 0);f.__decorate([p.property({type:Number,
nonNullable:!0,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"size",void 0);f.__decorate([p.property({type:Boolean,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"useRealWorldSymbolSizes",void 0);a.PointSizeFixedSizeAlgorithm=k=f.__decorate([b.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],a.PointSizeFixedSizeAlgorithm);a.default=a.PointSizeFixedSizeAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,u,f,p,t,w,e,n,b,h){var k;a.PointSizeSplatAlgorithm=k=function(l){function m(){var z=l.apply(this,arguments)||this;z.type="splat";z.scaleFactor=1;return z}u._inheritsLoose(m,l);m.prototype.clone=function(){return new k({scaleFactor:this.scaleFactor})};return m}(h["default"]);f.__decorate([n.enumeration({pointCloudSplatAlgorithm:"splat"})],a.PointSizeSplatAlgorithm.prototype,"type",void 0);f.__decorate([p.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],a.PointSizeSplatAlgorithm.prototype,
"scaleFactor",void 0);a.PointSizeSplatAlgorithm=k=f.__decorate([b.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],a.PointSizeSplatAlgorithm);a.default=a.PointSizeSplatAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;a.ColorClassBreakInfo=m=function(z){function r(){var c=z.apply(this,arguments)||this;c.description=null;c.label=null;c.minValue=0;c.maxValue=0;c.color=null;return c}u._inheritsLoose(r,z);r.prototype.clone=function(){return new m({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:w.clone(this.color)})};return r}(t.JSONSupport);f.__decorate([e.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,
"description",void 0);f.__decorate([e.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,"label",void 0);f.__decorate([e.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.ColorClassBreakInfo.prototype,"minValue",void 0);f.__decorate([e.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.ColorClassBreakInfo.prototype,"maxValue",void 0);f.__decorate([e.property({type:p,json:{type:[n.Integer],
write:!0}})],a.ColorClassBreakInfo.prototype,"color",void 0);a.ColorClassBreakInfo=m=f.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],a.ColorClassBreakInfo);a.default=a.ColorClassBreakInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;t=m=function(z){function r(c){c=z.call(this,c)||this;c.type="point-cloud-stretch";c.field=null;c.legendOptions=null;c.fieldTransformType=null;c.stops=null;return c}a._inheritsLoose(r,z);r.prototype.clone=function(){return new m({...this.cloneProperties(),field:f.clone(this.field),fieldTransformType:f.clone(this.fieldTransformType),stops:f.clone(this.stops),legendOptions:f.clone(this.legendOptions)})};return r}(h);u.__decorate([n.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
t.prototype,"type",void 0);u.__decorate([p.property({json:{write:!0},type:String})],t.prototype,"field",void 0);u.__decorate([p.property({type:k["default"],json:{write:!0}})],t.prototype,"legendOptions",void 0);u.__decorate([p.property({type:h.fieldTransformTypeKebabDict.apiValues,json:{type:h.fieldTransformTypeKebabDict.jsonValues,read:h.fieldTransformTypeKebabDict.read,write:h.fieldTransformTypeKebabDict.write}})],t.prototype,"fieldTransformType",void 0);u.__decorate([p.property({type:[l],json:{write:!0}})],
t.prototype,"stops",void 0);return t=m=u.__decorate([b.subclass("esri.renderers.PointCloudStretchRenderer")],t)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;t=m=function(z){function r(c){c=z.call(this,c)||this;c.type="point-cloud-unique-value";c.field=null;c.fieldTransformType=null;c.colorUniqueValueInfos=null;c.legendOptions=null;return c}a._inheritsLoose(r,z);r.prototype.clone=function(){return new m({...this.cloneProperties(),field:f.clone(this.field),fieldTransformType:f.clone(this.fieldTransformType),colorUniqueValueInfos:f.clone(this.colorUniqueValueInfos),legendOptions:f.clone(this.legendOptions)})};return r}(h);
u.__decorate([n.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],t.prototype,"type",void 0);u.__decorate([p.property({json:{write:!0},type:String})],t.prototype,"field",void 0);u.__decorate([p.property({type:h.fieldTransformTypeKebabDict.apiValues,json:{type:h.fieldTransformTypeKebabDict.jsonValues,read:h.fieldTransformTypeKebabDict.read,write:h.fieldTransformTypeKebabDict.write}})],t.prototype,"fieldTransformType",void 0);u.__decorate([p.property({type:[l["default"]],json:{write:!0}})],
t.prototype,"colorUniqueValueInfos",void 0);u.__decorate([p.property({type:k["default"],json:{write:!0}})],t.prototype,"legendOptions",void 0);return t=m=u.__decorate([b.subclass("esri.renderers.PointCloudUniqueValueRenderer")],t)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){var m;a.ColorUniqueValueInfo=m=function(z){function r(){var c=z.apply(this,arguments)||this;c.description=null;c.label=null;c.values=null;c.color=null;return c}u._inheritsLoose(r,z);r.prototype.clone=function(){return new m({description:this.description,label:this.label,values:w.clone(this.values),color:w.clone(this.color)})};return r}(t.JSONSupport);f.__decorate([e.property({type:String,json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"description",void 0);f.__decorate([e.property({type:String,
json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"label",void 0);f.__decorate([e.property({type:[String],json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"values",void 0);f.__decorate([e.property({type:p,json:{type:[n.Integer],write:!0}})],a.ColorUniqueValueInfo.prototype,"color",void 0);a.ColorUniqueValueInfo=m=f.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],a.ColorUniqueValueInfo);a.default=a.ColorUniqueValueInfo;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,u,f,p,t,w,e,n,b,h){var k;a.PointGraphic=k=function(l){function m(r){return l.call(this,r)||this}u._inheritsLoose(m,
l);var z=m.prototype;z.clone=function(){return new k(this.cloneProperties())};z.cloneProperties=function(){const {pointCloudMetadata:r}=this;return{...l.prototype.cloneProperties.call(this),pointCloudMetadata:r}};return m}(p);f.__decorate([t.property({constructOnly:!0})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=k=f.__decorate([h.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f32 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D){function C(F,L,N,I,G){if(N.drawScreenSpace)return N.fixedSize*L*I;G=(G?256:64)*L*I;return N.drawFixedSize?Math.min(N.fixedSize/2,G):0<N.screenMinSize?Math.min(Math.max(N.screenMinSize*L*I,F/2),G):Math.min(F/2,G)}function B(F){return f.isSome(F.component)?F.component:-1}function v(F,L){if(f.isNone(F))return F;F=F.filter(N=>N.id!==L);return 0===F.length?null:F}const E={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],
colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};a.PointRenderer=function(){function F(N){this._params=N;this.type="Point";this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new r.PointHighlights({forEachNode:I=>this.forEachNode(I),addHighlight:(I,G,K)=>this.addHighlight(I,G,K),removeHighlight:(I,G)=>this.removeHighlight(I,G)});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=
0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=l.create(l.POSITIVE_INFINITY);this._techniqueConfig=new y.PointRendererTechniqueConfiguration;this.tempMatrix4=w.create();this.tempVec3=b.create();this.nodes=new p}var L=F.prototype;L.initializeRenderContext=function(N){this._context=N;this._techniqueRep=this._context.shaderTechniqueRep;N.requestRender()};L.uninitializeRenderContext=function(){};L.intersect=function(N,I,G,K){const H=h.create(),J=
h.create(),M=h.create(),O=h.create(),Q=m.create(),S=N.camera.perScreenPixelRatio/2,V=N.camera.near,Y=this._getSizeParams();n.subtract(J,K,G);const W=1/n.length(J);n.scale(J,J,W);n.negate(M,J);k.set(Q,J[0],J[1],J[2],-n.dot(J,G));let ba=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};const ca=new ba,da=new ba,ha=[],fa=l.create(),R=l.create(this._clipBox);l.offset(R,-G[0],-G[1],-G[2],R);this.nodes.forAll(P=>{const X=P.splatSize*this._scaleFactor;var aa=c.minimumDistancePlane(P.obb,
Q),ja=c.maximumDistancePlane(P.obb,Q);aa-=Y.drawScreenSpace?0:C(X,aa+V,Y,S,P.isLeaf);ja-=Y.drawScreenSpace?0:C(X,ja+V,Y,S,P.isLeaf);aa=null!=ca.dist&&null!=da.dist&&ca.dist<aa*W&&da.dist>ja*W;if(!(0>ja||aa)&&(ja=C(X,ja+V,Y,S,P.isLeaf),c.intersectLine(P.obb,G,J,ja))){ja*=ja;c.toAaBoundingBox(P.obb,fa);l.offset(fa,-G[0],-G[1],-G[2],fa);aa=!l.contains(R,fa);n.subtract(O,P.origin,G);var ia=P.coordinates.length/3;for(let pa=0;pa<ia;pa++){H[0]=O[0]+P.coordinates[3*pa];H[1]=O[1]+P.coordinates[3*pa+1];H[2]=
O[2]+P.coordinates[3*pa+2];if(aa&&!l.containsPoint(R,H))continue;var ka=n.dot(H,J),na=n.squaredLength(H)-ka*ka;if(na>ja)continue;var ta=ka+V;const xa=Y.drawScreenSpace?0:C(X,ta,Y,S,P.isLeaf);if(0>ka-xa)continue;ta-=xa;ta=C(X,ta,Y,S,P.isLeaf);if(na>ta*ta)continue;const Da=(ka-xa)*W;ka=Ka=>{var Fa=pa,Ha=Ka.point;null==Ha&&(Ha=h.create());Ha[0]=P.origin[0]+P.coordinates[3*Fa];Ha[1]=P.origin[1]+P.coordinates[3*Fa+1];Ha[2]=P.origin[2]+P.coordinates[3*Fa+2];Ka.point=Ha;Ka.dist=Da;Ka.normal=M;Ka.node=P;
Ka.pointId=pa;Ka.layerUid=this.layerUid};(null==ca.dist||Da<ca.dist)&&(null==I||I(G,K,Da))&&ka(ca);0!==N.options.store&&(null==da.dist||Da>da.dist)&&(null==I||I(G,K,Da))&&ka(da);2!==N.options.store||null!=I&&!I(G,K,Da)||(na=new ba,ka(na),ha.push(na))}}});const U=P=>{const {layerUid:X,node:aa,pointId:ja}=P;return{type:"external",point:P.point,metadata:{layerUid:X,createGraphic:()=>this._params.createGraphic(aa,ja,P.point)}}},Z=(P,X)=>{const aa=U(X);P.set(aa,`${X.layerUid}/${X.node.id}/${X.pointId}`,
X.dist,X.normal,e.IDENTITY,void 0);P.intersector="PointRenderer"};if(null!=ca.dist){var T=N.results.min;(null==T.dist||ca.dist<T.dist)&&Z(T,ca)}null!=da.dist&&0!==N.options.store&&(T=N.results.max,(null==T.dist||da.dist>T.dist)&&Z(T,da));if(2===N.options.store){T=z.fromPoints(G,K);for(const P of ha){const X=new q.IntersectorResult(T);Z(X,P);N.results.all.push(X)}}};L.render=function(N){if(0!==N.pass&&2!==N.pass&&5!==N.pass)return!1;const I=2===N.pass,G=N.rctx;this.nodes.forAll(V=>{null==V.vao&&this._initNode(N,
V)});const K=this._getSizeParams(),H=this.selectTechnique(N,K),J=H.program;if(null==J||0===this.nodes.length)return!0;const M=this._clipBox,O=!l.equals(M,l.POSITIVE_INFINITY,(V,Y)=>V===Y);O||(n.set(this.tempVec3,-Infinity,-Infinity,-Infinity),J.setUniform3fv("uClipMin",this.tempVec3),n.set(this.tempVec3,Infinity,Infinity,Infinity),J.setUniform3fv("uClipMax",this.tempVec3));G.useProgram(J);H.bindPipelineState(G);J.setUniformMatrix4fv("uProjectionMatrix",N.camera.projectionMatrix);I&&J.setUniform2f("nearFar",
N.camera.near,N.camera.far);N.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/N.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/N.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=N.highlightDepthTexture,g.bindOutputHighlight(J,this._bindParameters));const Q=N.camera.pixelRatio;K.drawFixedSize&&J.setUniform2f("uPointScale",K.fixedSize*Q,N.camera.fullHeight);const S=this._slicePlaneEnabled?N.sliceHelper&&N.sliceHelper.plane:null;this.nodes.forAll(V=>{if(0!==
V.coordinates.length&&(!N.isHighlightPass||V.highlights)){J.setUniform2f("uScreenMinMaxSize",K.screenMinSize*Q,(V.isLeaf?256:64)*Q);K.drawFixedSize||J.setUniform2f("uPointScale",V.splatSize*this._scaleFactor*Q,N.camera.fullHeight/Q);var Y=V.origin;O&&(n.set(this.tempVec3,M[0]-Y[0],M[1]-Y[1],M[2]-Y[2]),J.setUniform3fv("uClipMin",this.tempVec3),n.set(this.tempVec3,M[3]-Y[0],M[4]-Y[1],M[5]-Y[2]),J.setUniform3fv("uClipMax",this.tempVec3));t.identity(this.tempMatrix4);t.translate(this.tempMatrix4,this.tempMatrix4,
Y);t.multiply(this.tempMatrix4,N.camera.viewMatrix,this.tempMatrix4);J.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);d.bindSliceUniforms(J,H.configuration,S,Y);G.bindVAO(V.vao);N.isHighlightPass?this._renderHighlightFragments(G,V):G.drawArrays(0,0,V.coordinates.length/3)}});return!0};L._renderHighlightFragments=function(N,I){var G=I.highlights;if(!f.isNone(G)){I=f.unwrap(G[0].component);var K=I+1;for(let H=1;H<G.length;H++){const J=f.unwrap(G[H].component);J!==K&&(K-=I,0<K&&N.drawArrays(0,
I,K),I=J);K=J+1}G=K-I;0<G&&N.drawArrays(0,I,G)}};L.addNode=function(N){this.nodes.push(N);this._highlights.nodeAdded(N);this._requestRender()};L.removeNode=function(N){let I=null;this.nodes.filterInPlace(G=>G.id===N?(I=G,G.vao=f.disposeMaybe(G.vao),this._highlights.nodeRemoved(G),!1):!0);this._requestRender();return I};L.forEachNode=function(N){this.nodes.forAll(N)};L.removeAll=function(){this.nodes.forAll(N=>N.vao=f.disposeMaybe(N.vao));this._highlights.removeAll();this.nodes.clear();this._requestRender()};
L.highlight=function(N){return this._highlights.add(N)};L.addHighlight=function(N,I,G){var K=N.highlights;f.isNone(K)&&(K=[]);I={component:I,id:G};K.push(I);I=B(I);for(G=K.length-1;0<G&&I<B(K[G-1]);)[K[G-1],K[G]]=[K[G],K[G-1]],--G;N.highlights=K;this._requestRender()};L.removeHighlight=function(N,I){N.highlights=v(N.highlights,I);this._requestRender()};L._initNode=function(N,I){N=N.rctx;I.vao=new D(N,A.Default3D,E,{positions:x.createVertex(N,35044,I.coordinates),colors:x.createVertex(N,35044,I.rgb)})};
L._requestRender=function(){this._context&&this._context.requestRender()};L._getSizeParams=function(){const N=this._useFixedSizes,I=N&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:I,drawFixedSize:N,fixedSize:I?this._sizePx:this._size,screenMinSize:N?0:this._minSizePx}};L.selectTechnique=function(N,I){this._techniqueConfig.drawScreenSize=I.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=N.hasOccludees;this._techniqueConfig.output=
2===N.pass?1:5===N.pass?4:0;return this._techniqueRep.releaseAndAcquire(y.PointRendererTechnique,this._techniqueConfig,this._technique)};u._createClass(F,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._useFixedSizes},set:function(N){this._useFixedSizes!==N&&(this._useFixedSizes=N,this._requestRender())}},{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(N){this._scaleFactor!==N&&(this._scaleFactor=
N,this._requestRender())}},{key:"minSizePx",get:function(){return this._minSizePx},set:function(N){this._minSizePx!==N&&(this._minSizePx=N,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._useRealWorldSymbolSizes},set:function(N){this._useRealWorldSymbolSizes!==N&&(this._useRealWorldSymbolSizes=N,this._requestRender())}},{key:"size",get:function(){return this._size},set:function(N){this._size!==N&&(this._size=N,this._requestRender())}},{key:"sizePx",get:function(){return this._sizePx},
set:function(N){this._sizePx!==N&&(this._sizePx=N,this._requestRender())}},{key:"clippingBox",set:function(N){l.set(this._clipBox,N||l.POSITIVE_INFINITY)}},{key:"slicePlane",get:function(){return this._slicePlaneEnabled},set:function(N){this._slicePlaneEnabled!==N&&(this._slicePlaneEnabled=N,this._requestRender())}},{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return F}();(function(F){F.isInstanceOfNode=function(L){return L.hasOwnProperty("splatSize")}})(a.PointRenderer||(a.PointRenderer=
{}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","../../../../core/maybe","../../webgl-engine/lib/Object3DStateID"],function(a,u,f,p,t){let w=function(){function n(h){this.context=h;this.highlights=new Set}var b=n.prototype;b.destroy=function(){this.highlights=null};b.add=function(h){const k=new e(h);this.highlights.add(k);this.enableSet(k);
return f.makeHandle(()=>this.removeSet(k))};b.removeSet=function(h){this.disableSet(h);this.highlights.delete(h)};b.enableSet=function(h){h.enabled||(h.enabled=!0,this.context.forEachNode(k=>this.enableSetForNode(h,k)))};b.enableSetForNode=function(h,k){if(h.enabled){var l=h.ids.get(k.id);l&&l.forEach(m=>this.context.addHighlight(k,m,h.id))}};b.disableSet=function(h){h.enabled&&(h.enabled=!1,this.context.forEachNode(k=>this.disableSetForNode(h,k)))};b.disableSetForNode=function(h,k){h.enabled||this.context.removeHighlight(k,
h.id)};b.nodeAdded=function(h){this.highlights.forEach(k=>this.enableSetForNode(k,h))};b.nodeRemoved=function(h){this.highlights.forEach(k=>this.disableSetForNode(k,h))};b.removeAll=function(){this.highlights.forEach(h=>this.disableSet(h))};u._createClass(n,[{key:"hasHighlights",get:function(){return 0<this.highlights.size}}]);return n}(),e=function(){function n(b){this.id=new t.Object3DStateID(0);this.ids=new Map;this.enabled=!1;for(const h of b)p.isSome(h)&&this.add(h.nodeId,h.pointId)}n.prototype.add=
function(b,h){const k=this.ids.get(b);k?k.add(h):this.ids.set(b,new Set([h]))};return n}();a.PointHighlights=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/renderState".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l){w=function(m){function z(c,d,g){return m.call(this,c,d,g)||this}f._inheritsLoose(z,m);var r=z.prototype;r.initializeProgram=function(c){var d=z.shader.get();const g=this.configuration;d=d.build({output:g.output,slicePlaneEnabled:g.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:g.drawScreenSize});return new b.Program(c.rctx,d,n.Default3D)};r.initializePipeline=function(){return l.makePipelineState({depthTest:{func:513},
depthWrite:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?h.stencilBaseAllZerosParams:null})};return z}(w.ShaderTechnique);w.shader=new t.ReloadableShaderModule(k.PointRendererShader,()=>new Promise(function(m,z){a(["./PointRenderer.glsl"],m,z)}));t=function(m){function z(){var r=m.apply(this,arguments)||this;r.output=0;r.slicePlaneEnabled=!1;r.drawScreenSize=
!1;r.sceneHasOcludees=!1;return r}f._inheritsLoose(z,m);return z}(e.ShaderTechniqueConfiguration);p.__decorate([e.parameter({count:8})],t.prototype,"output",void 0);p.__decorate([e.parameter()],t.prototype,"slicePlaneEnabled",void 0);p.__decorate([e.parameter()],t.prototype,"drawScreenSize",void 0);p.__decorate([e.parameter()],t.prototype,"sceneHasOcludees",void 0);u.PointRendererTechnique=w;u.PointRendererTechniqueConfiguration=t;Object.defineProperty(u,"__esModule",{value:!0})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,u,f,p,t,w){function e(b){const h=new w.ShaderBuilder,k=0===b.output,l=1===b.output,m=4===b.output;h.extensions.add("GL_OES_standard_derivatives");h.include(u.Slice,b);h.attributes.add("position","vec3");h.attributes.add("color","vec3");h.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");l?(h.vertex.uniforms.add("nearFar","vec2"),h.varyings.add("depth","float")):
4!==b.output&&h.varyings.add("vColor","vec3");h.vertex.code.add(t.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${b.drawScreenSize?t.glsl`
      float clampedScreenSize = pointSize;`:t.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${l?t.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${k?t.glsl`vColor = color;`:""}
    }
  `);h.fragment.include(p.RgbaFloatEncoding,b);m&&h.include(f.OutputHighlight);h.fragment.code.add(t.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${l?t.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${m?t.glsl`outputHighlight();`:""}
      ${k?t.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return h}var n=Object.freeze({__proto__:null,build:e});a.PointRendererShader=n;a.build=e})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){a.PopupSceneLayerView=z=>{z=function(r){function c(){return r.apply(this,arguments)||this}u._inheritsLoose(c,r);var d=c.prototype;d._validateFetchPopupFeatures=function(g){const {layer:A}=this,{popupEnabled:q}=A;if(!q)return new p("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:A});if(!m.getFetchPopupTemplate(A,g))return new p("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:A})};d.prepareFetchPopupFeatures=
function(){var g=u._asyncToGenerator(function*(A){});return function(A){return g.apply(this,arguments)}}();d.fetchPopupFeatures=function(){var g=u._asyncToGenerator(function*(A,q){if(A=this._validateFetchPopupFeatures(q))return Promise.reject(A);A=t.isSome(q)?q.clientGraphics:null;if(!A||0===A.length)return Promise.resolve([]);const y=[],x=[];var D="scene"===this.layer.type&&t.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;q=l.unpackFieldNames(this.layer.fieldsIndex,yield m.getRequiredFields(D,
m.getFetchPopupTemplate(this.layer,q)));yield this.prepareFetchPopupFeatures(q);D=new Set;for(const C of A)l.populateMissingFields(q,C,D)?x.push(C):y.push(C);return 0===x.length?Promise.resolve(y):this.whenGraphicAttributes(x,[...D]).catch(()=>x).then(C=>y.concat(C))});return function(A,q){return g.apply(this,arguments)}}();return c}(z);return z=f.__decorate([k.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../rest/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/floorFilterUtils ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N){const I=p.getLogger("esri.views.3d.layers.SceneLayerView3D");p=D.defineFieldProperties();m=function(G){function K(){var J=G.apply(this,arguments)||this;J.type="scene-layer-3d";J.lodFactor=1;J.progressiveLoadFactor=1;J._elevationContext="scene";J._isIntegratedMesh=!1;J._supportsLabeling=!0;J._interactiveEditingSessions=new Map;J._queryEngine=null;return J}a._inheritsLoose(K,G);var H=K.prototype;H.initialize=function(){this.fieldsHelper=
new v.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(this.layer,"rangeInfos",J=>this._rangeInfosChanged(J),2);this.updatingHandles.add(this.layer,"renderer",J=>this.updatingHandles.addPromise(this._rendererChange(J)),2);for(const J of"parsedDefinitionExpression filter viewFilter.parsedWhereClause viewFilter.parsedGeometry viewFilter.sortedObjectIds floorFilterClause".split(" "))this.updatingHandles.add(this,J,()=>this._filterChange());for(const J of["filter","viewFilter.parsedGeometry"])this.updatingHandles.add(this,
J,()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",J=>this.updatingHandles.addPromise(J.result)));this.handles.add(this.layer.on("edits",J=>this._handleEdits(J)))};H.destroy=function(){this.fieldsHelper=t.destroyMaybe(this.fieldsHelper)};H._rangeInfosChanged=function(J){null!=J&&0<J.length&&I.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};H.createQuery=function(){const J={outFields:["*"],returnGeometry:!1,
outSpatialReference:this.view.spatialReference};return t.isSome(this.filter)?this.filter.createQuery(J):new l(J)};H.queryExtent=function(J,M){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(J),null==M?void 0:M.signal)};H.queryFeatureCount=function(J,M){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(J),null==M?void 0:M.signal)};H.queryFeatures=function(J,M){return this._ensureQueryEngine().executeQuery(this._ensureQuery(J),null==M?void 0:M.signal).then(O=>
{if(null==O||!O.features)return O;const Q=this.layer;for(const S of O.features)S.layer=Q,S.sourceLayer=Q;return O})};H.queryObjectIds=function(J,M){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(J),null==M?void 0:M.signal)};H._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};H._createQueryEngine=function(){const J=c.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);
return new g["default"]({layerView:this,priority:N.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new q["default"]({featureAdapter:new A.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:J}),forAllFeatures:(M,O)=>this._forAllFeatures((Q,S,V)=>M({id:Q,index:S,meta:V}),O,2),getFeatureExtent:J,sourceSpatialReference:y.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};H.highlight=function(J){const M=
this._highlights;if(J instanceof l){const {set:O,handle:Q}=M.acquireSet();this.queryObjectIds(J).then(S=>M.setFeatureIds(O,S));return Q}return G.prototype.highlight.call(this,J)};H.createInteractiveEditSession=function(J){return r.createInteractiveEditSession(this.attributeEditingContext,J)};H._createLayerGraphic=function(J){J=new f(null,null,J);J.layer=this.layer;J.sourceLayer=this.layer;return J};H.canResume=function(){return G.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};
H.getFilters=function(){const J=G.prototype.getFilters.call(this);this.floorFilterClause&&this.addSqlFilter(J,this.floorFilterClause,this.logError);this.addSqlFilter(J,this.parsedDefinitionExpression,this.logError);t.isSome(this.viewFilter)&&this.viewFilter.addFilters(J,this.view,this._controller.crsIndex,this._collection);return J};H._ensureQuery=function(J){return this._addDefinitionExpressionToQuery(t.isNone(J)?this.createQuery():l.from(J))};H._handleEdits=function(J){r.processAttributeEdits(this.attributeEditingContext,
J)};H.computeNodeFiltering=function(J){const M=this.viewFilter;return t.isNone(M)||M.isMBSGeoemtryVisible(J,this.view.spatialReference,this._controller.crsIndex)?0:1};a._createClass(K,[{key:"filter",get:function(){return t.isSome(this.viewFilter)?this.viewFilter.filter:null},set:function(J){t.isNone(J)||!d.I3SMeshViewFilter.checkSupport(J)?this.viewFilter=null:t.isSome(this.viewFilter)?this.viewFilter.filter=J:this.viewFilter=new d.I3SMeshViewFilter({filter:J,layerFieldsIndex:this.layer.fieldsIndex,
loadAsyncModule:M=>this._loadAsyncModule(M),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(M,O)=>this.addSqlFilter(M,O,this.logError)})}},{key:"requiredFields",get:function(){var J,M;return null!=(J=null==(M=this.fieldsHelper)?void 0:M.requiredFields)?J:[]}},{key:"floorFilterClause",get:function(){const J=C.getFloorFilterClause(this);return t.isSome(J)?k.WhereClause.create(J,this.layer.fieldsIndex):null}},{key:"lodCrossfadeinDuration",get:function(){var J,M;return null!=(J=null==(M=this.view)?
void 0:M.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?J:0}},{key:"lodCrossfadeoutDuration",get:function(){var J,M;return null!=(J=null==(M=this.view)?void 0:M.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?J:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var J,M;return null!=(J=null==(M=this.view)?void 0:M.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?J:0}},{key:"attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:J=>this._forAllNodes(M=>t.isSome(M)?J(M.node,M.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:J=>this.getAttributeData(J),setAttributeData:(J,M)=>this.setAttributeData(J,M),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const J=this.viewFilter;return t.isSome(J)&&t.isSome(J.parsedGeometry)}}]);
return K}(m.I3SMeshView3D(x.DefinitionExpressionSceneLayerView(B.PopupSceneLayerView(z.LayerView3D(F)))));u.__decorate([w.property({aliasOf:"layer"})],m.prototype,"i3slayer",void 0);u.__decorate([w.property()],m.prototype,"suspended",void 0);u.__decorate([w.property(E.updatingProgress)],m.prototype,"updatingProgress",void 0);u.__decorate([w.property({type:L})],m.prototype,"filter",null);u.__decorate([w.property()],m.prototype,"viewFilter",void 0);u.__decorate([w.property(p.requiredFields)],m.prototype,
"requiredFields",null);u.__decorate([w.property(p.availableFields)],m.prototype,"availableFields",void 0);u.__decorate([w.property()],m.prototype,"fieldsHelper",void 0);u.__decorate([w.property()],m.prototype,"floorFilterClause",null);u.__decorate([w.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],m.prototype,"lodFactor",void 0);u.__decorate([w.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],m.prototype,"updatingProgressValue",void 0);return m=
u.__decorate([h.subclass("esri.views.3d.layers.SceneLayerView3D")],m)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/lib/BasisUtil".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca,da,ha,fa,R,U,Z,T,P,X,aa,ja,ia,ka,na,ta,pa){function xa(ra){const va=ra.metallicRoughness;return va&&0<=va.baseColorTextureId||va&&0<=va.metallicRoughnessTextureId||0<=ra.normalTextureId||0<=ra.emissiveTextureId||0<=ra.occlusionTextureId}function Da(ra){return k.isSome(ra)&&r.isArrayBuffer(ra.data)}function Ka(ra,va){ra=1024+ra.interleavedVertexData.byteLength+(ra.indices?ra.indices.byteLength:0)+ra.positionData.data.byteLength+
ra.positionData.indices.byteLength;if(k.isSome(va))for(const La of va)k.isSome(La)&&r.isArrayBuffer(La.data)&&(ra+=La.data.byteLength);return ra}function Fa(ra,va){return 104857600<va.byteSize?(Ba.warn(`Node is too big to store in IndexedDB cache: ${ra.id} (${va.byteSize} bytes)`),!1):0<va.byteSize}function Ha(ra){if(0===ra.length)return null;const va=new Float64Array(10*ra.length);ra.forAll((La,Ta)=>{let Pa=La.serviceObb;k.isNone(Pa)&&(Pa=Ma,v.copy(Pa.center,La.mbs),Pa.halfSize[0]=Pa.halfSize[1]=
Pa.halfSize[2]=La.mbs[3]);La=10*Ta;va[La+0]=Pa.center[0];va[La+1]=Pa.center[1];va[La+2]=Pa.center[2];va[La+3]=Pa.halfSize[0];va[La+4]=Pa.halfSize[1];va[La+5]=Pa.halfSize[2];va[La+6]=Pa.quaternion[0];va[La+7]=Pa.quaternion[1];va[La+8]=Pa.quaternion[2];va[La+9]=Pa.quaternion[3]});return va}function ua(ra,va){ra.forEach(La=>La.opacity=va)}const Ba=b.getLogger("esri.views.3d.layers.SceneLayerView3D"),Ea=[1,1,1,1];let Ga=function(ra){function va(La,Ta,Pa,sa,oa,wa,za){var Ia=ra.call(this)||this;Ia.node=
La;Ia.featureIds=Ta;Ia.objectHandle=Pa;Ia.cachedRendererVersion=sa;Ia.attributeInfo=oa;Ia.material=wa;Ia.textures=za;Ia.cachedEdgeMaterials=[];Ia.cachedSymbology=null;return Ia}f._inheritsLoose(va,ra);return va}(da.NodeCrossfadeMetaData);const ma=N.create(),ya=N.create(),Ma=ia.create(),Ra=[0,0,0,0],ea=new t([0,0,0,0]),Ua=[0,0,0,0],Qa={remove(){},pause(){},resume(){}};u.I3SMeshView3D=ra=>{var va;ra=va=function(La){function Ta(...sa){sa=La.call(this,sa)||this;sa._elevationProvider=null;sa._intersectionHandler=
null;sa._nodeId2Meta=new Map;sa._nodeId2MetaReloading=new Map;sa._i3sWasmLoaded=!1;sa._hasLoadedPBRTextures=!1;sa._asyncModuleLoading=0;sa._addTasks=new Map;sa._rendererVersion=0;sa._colorVariable=null;sa._opacityVariable=null;sa._rendererFields=null;sa._symbologyFields=null;sa._symbologyOverride=null;sa._symbologyOverrideFields=null;sa._symbolInfos=new Map;sa._idbCache=new P.IDBCache("esri-scenelayer-cache","geometries");sa.holeFilling="auto";sa._hasColors=!1;sa._hasTextures=!1;sa._hasData=!1;sa.slicePlaneEnabled=
!1;sa._modifications=[];sa._layerUrl="";sa._cacheKeySuffix=null;sa._arcade=null;sa._tmpAttributeOnlyGraphic=new w(null,null,{});sa._crossfadeHelper=new da.I3SCrossfadeHelper(f._assertThisInitialized(sa));sa.index=va.lastIndex++;return sa}f._inheritsLoose(Ta,La);var Pa=Ta.prototype;Pa.initialize=function(){this.preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);const sa=this.view.resourceController;this.attributeOverrides=new ca.I3SAttributeOverrides(this.i3slayer,sa.memoryController);
this._worker=new V.I3SMeshWorkerHandle(wa=>sa.schedule(wa));this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);T.checkSceneLayerValid(this.i3slayer);T.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new I({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;
this._highlights=new ba({collection:this._collection,forAllFeatures:wa=>this._forAllFeatures(wa,null,1),forAllFeaturesOfNode:(wa,za)=>this._forAllFeaturesOfNode(wa,za)});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var oa=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(oa&&oa.faceRange&&oa.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||
!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.i3slayer.uid,wa=>this._deleteComponentObject(wa));this._intersectionHandler=new R.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,forEach:wa=>{this._nodeId2Meta.forEach(za=>
k.isSome(za)&&wa(za.node,za.objectHandle));this._nodeId2MetaReloading.forEach(za=>k.isSome(za)&&wa(za.node,za.objectHandle))}});this._elevationProvider=new ha({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(this,"view.clippingArea",()=>this._clippingAreaChanged(),2);this.updatingHandles.add(this,"fullOpacity",wa=>this._opacityChange(wa));this.updatingHandles.add(this,"slicePlaneEnabled",wa=>this._slicePlaneEnabledChange(wa));
this.updatingHandles.add(this,"elevationOffset",(wa,za)=>{this._reloadAll(za);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(this,"filter",()=>this._filterChange(),2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",()=>this._updatePBR());oa=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(this,"rendererTextureUsage",oa);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",oa);this.updatingHandles.add(this,
"suspended",wa=>this._suspendedChange(wa),2);this.updatingHandles.add(this.i3slayer,"labelsVisible",()=>this._labelingChanged(),2);this.updatingHandles.add(this.i3slayer,"labelingInfo",()=>this._labelingChanged(),2);this.updatingHandles.add(this,"_modifications",()=>this._modificationsChanged(),2);this.handles.add([d.init(aa,"I3S_TREE_SHOW_TILES",wa=>{if(wa&&!this._treeDebugger){const za=this._controller.crsIndex;(new Promise(function(Ia,Sa){a(["./support/I3STreeDebugger"],Ia,Sa)})).then(({I3STreeDebugger:Ia})=>
{!this._treeDebugger&&aa.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Ia({lv:this,view:this.view,nodeSR:za}))})}else wa||aa.I3S_TREE_SHOW_TILES||(this._treeDebugger=k.destroyMaybe(this._treeDebugger))}),d.init(aa,"I3S_SHOW_MODIFICATIONS",()=>this._showModifications())]);this._cacheKeySuffix=T.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(wa=>Ba.warn(`Failed to initialize IndexedDB cache: ${wa}`))};Pa.destroy=function(){this._clearAddTasks();
this.attributeOverrides=k.destroyMaybe(this.attributeOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const sa=this._worker;sa&&(sa.destroyContext(this.i3slayer.uid).then(()=>sa.destroy()),this._worker=null);this._removeAllNodeDataFromStage();
this._memCache=k.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=k.destroyMaybe(this._labeler);this._treeDebugger=k.destroyMaybe(this._treeDebugger);this._controller=k.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=
null)};Pa.memEstimateTextureAdded=function(sa){sa=sa.estimatedTexMemRequired;this.gpuMemoryEstimate+=sa;this.texMemoryEstimate+=sa;return sa};Pa.memEstimateTextureRemoved=function(sa){sa=sa.estimatedTexMemRequired;this.gpuMemoryEstimate-=sa;this.texMemoryEstimate-=sa};Pa.memEstimateGeometryAdded=function(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);this.gpuMemoryEstimate+=sa;this.geoMemoryEstimate+=sa;return sa};Pa.memEstimateGeometryRemoved=function(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);
this.gpuMemoryEstimate-=sa;this.geoMemoryEstimate-=sa};Pa.isNodeLoaded=function(sa){return this._nodeId2Meta.has(sa)};Pa.isNodeReloading=function(sa){return this._nodeId2MetaReloading.has(sa)};Pa.getUsedMemory=function(){let sa=k.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(oa=>sa+=k.isSome(oa)?oa.node.memory:0);this._nodeId2MetaReloading.forEach(oa=>sa+=k.isSome(oa)?oa.node.memory:0);return sa};Pa.getUnloadedMemory=function(){return(k.isSome(this._controller)?this._controller.unloadedMemoryEstimate:
0)+(k.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};Pa.ignoresMemoryFactor=function(){return!1};Pa._labelingChanged=function(){if(!K.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)k.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!k.isSome(this._labeler)){var sa=new S({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(oa=>k.isSome(oa)&&this._addMetaToLabeler(sa,oa));this._labeler=sa}};Pa._loadAsyncModule=
function(sa){++this._asyncModuleLoading;return sa.then(oa=>{--this._asyncModuleLoading;return oa},oa=>{--this._asyncModuleLoading;throw oa;})};Pa._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this._hasModifications)this._i3sWasmLoaded=Y.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var sa=this.i3slayer.uid,oa=this.i3slayer.spatialReference;this._worker.setModifications(sa,this._modifications,
oa);var wa=V.toWasmModification(this._modifications,oa);Y.setModificationsSync({context:sa,modifications:wa,isGeodetic:oa.isGeographic});this._controller.modificationsChanged();var za=this._hasModifications?new l:null;this._nodeId2Meta.forEach((Ia,Sa)=>{k.isNone(Ia)?this._nodeId2Meta.delete(Sa):Ia.node.hasModifications?(this._nodeId2Meta.delete(Sa),this._nodeId2MetaReloading.set(Sa,Ia)):k.isSome(za)&&za.push(Ia.node)});k.isSome(za)&&this._nodeId2MetaReloading.forEach(Ia=>za.push(Ia.node));k.isSome(za)&&
0<za.length&&(this.updateNodeModificationStatus(za),za.forAll(Ia=>{if(2!==Ia.imModificationImpact){const Sa=this._nodeId2Meta.get(Ia.index);this._controller.invalidateGeometryVisibility(Ia.index);this._nodeId2Meta.delete(Ia.index);k.isSome(Sa)&&this._nodeId2MetaReloading.set(Ia.index,Sa)}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};Pa._showModifications=function(){k.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),
this._modificationGraphics=null);if(aa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var sa={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},oa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const wa of this._modifications)wa.geometry.spatialReference=this.i3slayer.spatialReference,this._modificationGraphics.push(new w({geometry:wa.geometry,symbol:{...oa,color:sa[wa.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};
Pa._addMetaToLabeler=function(sa,oa){sa.addNodeMeta(oa,(wa,za)=>this._createAttributes(wa,za))};Pa._suspendedChange=function(sa){sa?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
Pa.getLoadedAttributes=function(sa){sa=this._nodeId2Meta.get(sa);if(k.isSome(sa)&&k.isSome(sa.attributeInfo))return sa.attributeInfo.loadedAttributes};Pa.getAttributeData=function(sa){sa=this._nodeId2Meta.get(sa);if(k.isSome(sa)&&k.isSome(sa.attributeInfo))return sa.attributeInfo.attributeData};Pa.setAttributeData=function(sa,oa){sa=this._nodeId2Meta.get(sa);k.isSome(sa)&&k.isSome(sa.attributeInfo)&&(sa.attributeInfo.attributeData=oa,this._attributeValuesChanged(sa))};Pa.updateAttributes=function(){var sa=
f._asyncToGenerator(function*(oa,wa,za){oa=this._nodeId2Meta.get(oa);k.isSome(oa)&&(yield this.attributeOverrides.apply(oa.featureIds,wa,za),oa.attributeInfo=wa,this._attributeValuesChanged(oa))});return function(oa,wa,za){return sa.apply(this,arguments)}}();Pa._attributeValuesChanged=function(sa){sa.cachedRendererVersion=this._getInvalidRendererVersion();sa.filteredIds=null;k.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(sa,(oa,wa)=>this._createAttributes(oa,wa));this._updateEngineObject(sa)};
Pa.clearMemCache=function(){k.isSome(this._memCache)&&this._memCache.clear()};Pa.getVisibleNodes=function(){const sa=[];this._nodeId2Meta.forEach(oa=>k.isSome(oa)&&sa.push(oa.node));return sa};Pa.getLoadedNodeIndices=function(sa){this._nodeId2Meta.forEach((oa,wa)=>sa.push(wa));this._nodeId2MetaReloading.forEach((oa,wa)=>sa.push(wa))};Pa.preLoadBasis=function(){!n("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&2)&&k.applySome(this.i3slayer.textureSetDefinitions,sa=>sa.some(oa=>oa.formats.some(wa=>
"basis"===wa.format||"ktx2"===wa.format)))&&pa.loadBasis()};Pa._getVertexBufferLayout=function(sa,oa){sa={hasTexture:xa(sa.params.material),hasNormals:oa.normal,hasRegions:oa.uvRegion};return na.glLayout(ta.createVertexBufferLayout(this._getGeometryParameters(sa)))};Pa._getObjectIdField=function(){return this.i3slayer.objectIdField||"OBJECTID"};Pa._findGraphicNodeAndIndex=function(sa){const oa=X.attributeLookup(this.i3slayer.fieldsIndex,sa.attributes,this._getObjectIdField());let wa=null;h.someMap(this._nodeId2Meta,
za=>{if(k.isNone(za))return!1;const Ia=za.featureIds.indexOf(oa);if(-1===Ia)return!1;wa={node:za.node,index:Ia};return!0});return wa};Pa._getGraphicIndices=function(sa,oa){sa=this._nodeId2Meta.get(sa.index);if(k.isNone(sa))return[];const wa=[],za=this._getObjectIdField(),Ia=this.i3slayer.fieldsIndex;for(const Sa of oa)oa=X.attributeLookup(Ia,Sa.attributes,za),oa=sa.featureIds.indexOf(oa),-1!==oa&&wa.push(oa);return wa};Pa.whenGraphicBounds=function(sa){sa=this._findGraphicNodeAndIndex(sa);if(!sa)return Promise.reject();
var oa=this._nodeId2Meta.get(sa.node.index);if(k.isNone(oa))return Promise.reject();sa=fa.boundingBoxCornerPoints(sa.index,this._collection,oa.objectHandle,new Float64Array(24));if(L.projectBuffer(sa,this.view.renderSpatialReference,0,sa,this.view.spatialReference,0,8))return oa=N.empty(),N.expandWithBuffer(oa,sa,0,8),Promise.resolve({boundingBox:oa,screenSpaceObjects:[]})};Pa.whenGraphicAttributes=function(sa,oa){return T.whenGraphicAttributes(this.i3slayer,sa,this._getObjectIdField(),oa,()=>[...this._nodeId2Meta.values()].filter(k.isSome))};
Pa.getGraphicFromIntersectorMetadata=function(sa){if(null==sa.nodeIndex||null==sa.componentIndex)return null;const oa=this._nodeId2Meta.get(sa.nodeIndex);return k.isNone(oa)||null==oa.featureIds||sa.componentIndex>=oa.featureIds.length?null:this._createGraphic(sa.componentIndex,oa)};Pa._getCacheKey=function(sa){return`${this._layerUrl}/v${18}/${sa.id}${this._cacheKeySuffix}`};Pa._getMemCacheKey=function(sa,oa=this.elevationOffset){return sa+"#"+oa};Pa.loadCachedGPUData=function(sa){return k.isSome(this._memCache)?
this._memCache.pop(this._getMemCacheKey(sa.index)):null};Pa.deleteCachedGPUData=function(sa){k.isSome(sa)&&this._deleteComponentObject(sa)};Pa._cacheGPUData=function(sa,oa=this.elevationOffset){if(k.isNone(this._memCache))this._deleteComponentObject(sa);else{var wa=this._controller.indexDepth-sa.node.level;this._memCache.put(this._getMemCacheKey(sa.node.index,oa),sa,sa.node.memory,wa)}};Pa.loadMissingTextures=function(sa,oa,wa,za){const Ia=sa.filter((Sa,Xa)=>{if(0===(Sa.usage&this.rendererTextureUsage))return!1;
if(k.isNone(oa))return!0;Sa=U.selectEncoding(Sa.encodings,this.supportedTextureEncodings);Xa=oa[Xa];return k.isNone(Xa)||null==Xa.data||Sa&&Xa.encoding!==Sa.encoding?!0:!1});return 0===Ia.length?Promise.resolve(!1):wa(Ia,za).then(Sa=>{let Xa=0;for(let bb=0;bb<sa.length;bb++)Xa<Sa.length&&Sa[Xa].id===sa[bb].id&&(oa[bb]=Sa[Xa],Xa++);return!0})};Pa.loadCachedNodeData=function(sa,oa,wa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(sa),oa).then(za=>{if(null==za)return null;if(za.nodeVersion!==
sa.version)return this._idbCache.remove(this._getCacheKey(sa)),null;sa.geometryObb=za.geometryObb;return this.loadMissingTextures(za.requiredTextures,za.textureData,wa,oa).then(Ia=>{Ia&&this._idbCache.initialized&&k.isSome(za.textureData)&&(za.byteSize=Ka(za.transformedGeometry,za.textureData),za.textureData.every(Da)&&Fa(sa,za)&&this._idbCache.put(this._getCacheKey(sa),za).catch(Sa=>Ba.warn(`Failed to update node with textures in IndexedDB cache: ${sa.id}: ${Sa}`)));m.throwIfAborted(oa);return za})}):
Promise.resolve(null)};Pa.addNode=function(sa,oa,wa){return"geometryData"in oa?this._addData(sa,oa.attributeDataInfo,()=>this._transformNode(sa,oa,wa).then(za=>this._safeReschedule(()=>{if(k.isNone(za))return sa.hasModifications=!1,this._addCachedNodeData(sa,null,wa);sa.hasModifications=za.transformedGeometry.hasModifications;const {obb:Ia,componentOffsets:Sa,featureIds:Xa,transformedGeometry:bb}=za;var ab=Z.computeGlobalTransformation(sa.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference);
sa.geometryObb=ia.create([Ia.center.x,Ia.center.y,Ia.center.z],[Ia.extents.x,Ia.extents.y,Ia.extents.z],[Ia.orientation.x,Ia.orientation.y,Ia.orientation.z,Ia.orientation.w]);v.transformMat4(sa.geometryObb.center,sa.geometryObb.center,ab);oa.geometryData.componentOffsets=Sa;Xa&&(oa.geometryData.featureIds=Array.prototype.slice.call(Xa));ab={nodeVersion:sa.version,geometryData:oa.geometryData,requiredTextures:oa.requiredTextures,textureData:oa.textureData,transformedGeometry:bb,globalTrafo:ab,geometryObb:sa.geometryObb,
byteSize:Ka(bb,oa.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&Fa(sa,ab)){const gb=k.isSome(ab.textureData)?ab.textureData.map($a=>Da($a)?$a:null):null;this._idbCache.put(this._getCacheKey(sa),{...ab,textureData:gb}).catch($a=>Ba.warn(`Failed to store node in IndexedDB cache: ${sa.id}: ${$a}`))}return this._addCachedNodeData(sa,ab,wa)},wa))):Promise.reject()};Pa.computeVisibilityObb=function(sa){return T.computeVisibilityObb(sa,this.view.renderSpatialReference,this._controller.crsIndex,
this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Pa._transformNode=function(sa,oa,wa){var za=oa.geometryData.geometries;const Ia=Array(za.length);for(var Sa=0;Sa<za.length;++Sa)Ia[Sa]=this._getVertexBufferLayout(za[Sa],oa.geometryDescriptor);za=sa.mbs;Sa=this.elevationOffset;var Xa=this._controller.crsIndex,bb=this._controller.crsVertex;const ab=this.view.renderSpatialReference,gb=Z.getLocalOrigin(za,Sa,Xa),$a=Z.computeGlobalTransformation(za,Sa,Xa,ab);Xa=L.getProjectorName(Xa,
bb);bb=L.getProjectorName(bb,ab);return k.isNone(Xa)||k.isNone(bb)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:oa.geometryBuffer,geometryData:oa.geometryData,geometryDescriptor:oa.geometryDescriptor,layouts:Ia,localOrigin:gb,globalTrafo:$a,mbs:za,obb:sa.serviceObb,elevationOffset:Sa,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:Xa,vertexToRenderProjector:bb},
wa)};Pa._setNewNodeOpacity=function(sa){this._setNodeOpacity(sa,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Pa.addCachedGPUData=function(sa,oa,wa){sa.geometryObb=ia.clone(this._collection.getComponentObb(oa.objectHandle));this._controller.isGeometryVisible(sa)?(k.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,oa),sa=sa.index,this._addNodeMeta(sa,oa),this.updateNodeState(sa,wa),this._collection.setObjectVisibility(oa.objectHandle,!0),this._updateMaterial(oa),this._setNewNodeOpacity(oa),
this._updateEngineObject(oa),this._highlights.objectCreated(oa),k.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(oa)};Pa.addCachedNodeData=function(sa,oa,wa,za){return this._addData(sa,wa,()=>this._addCachedNodeData(sa,oa,za))};Pa._addCachedNodeData=function(){var sa=f._asyncToGenerator(function*(oa,wa,za){if(this.suspended||!this._controller.isGeometryVisible(oa))this._removeNodeStageData(oa.index,this.elevationOffset,this._nodeId2MetaReloading);else if(k.isNone(wa))this._addNodeMeta(oa.index,
null);else{var Ia=this._addTasks.get(oa.index),{geometryData:Sa,transformedGeometry:Xa,globalTrafo:bb}=wa;yield this.attributeOverrides.apply(Sa.featureIds,Ia.attributeInfo,za);var ab=k.isSome(wa.textureData)?wa.textureData.filter(rb=>k.isSome(rb)&&0!==(rb.usage&this.rendererTextureUsage)):[];!n("disable-feature:i3s-basis")&&ab.some(rb=>k.isSome(rb)&&(2===rb.encoding||1===rb.encoding))&&(yield pa.loadBasis());oa.memory=0;var {componentOffsets:gb,geometries:$a,featureIds:Ja}=Sa,Oa=this._collection,
Wa=$a[0],{layout:Za,indices:cb,interleavedVertexData:eb,positionData:ib,hasColors:sb}=Xa,Db=this._materialParameters(Wa,Za),Mb=gb||new Uint32Array([0,cb?cb.length:eb.byteLength/Za[0].stride]);Mb={vertices:{data:eb,count:eb.byteLength/Za[0].stride,layoutParameters:Db.geometryParams},positionData:{positions:ib.data,indices:ib.indices},indices:cb,componentOffsets:Mb};var Ib=Wa.transformation?B.clone(Wa.transformation):B.create();C.multiply(Ib,bb,Ib);Wa=C.getTranslation(E.create(),Ib);Ib=x.fromMat4(D.create(),
Ib);var Cc=this.view.renderSpatialReference,Dc=this.view.basemapTerrain.spatialReference,lc=E.create(),mc=[1,1,1];L.localLinearScaleFactors(Wa,Cc,mc,Dc);L.projectVectorToVector(Wa,Cc,lc,Dc);var Xb=Oa.createObject({toMapSpace:[lc[0],lc[1],mc[0],mc[1]],geometry:Mb,obb:k.unwrap(oa.geometryObb),transform:{position:Wa,rotationScale:Ib},visible:!1});ab=this._initMaterialAndTextures(Xb,Db.material,ab,2===Db.geometryParams.textureCoordinates);oa.memory+=this.memEstimateGeometryAdded(Xb);oa.memory+=ab.reduce((rb,
Bb)=>rb+(k.isSome(Bb)?this.memEstimateTextureAdded(Bb):0),0);Mb=!!Db.material.hasParametersFromSource;Db="blend"!==Db.material.alphaMode&&1<=Db.material.metallicRoughness.baseColorFactor[3];var tb=new Ga(oa,Ja,Xb,this._getInvalidRendererVersion(),Ia.attributeInfo,{hasParametersFromSource:Mb,isOpaque:Db},ab);Ia.meta=tb;!this._hasTextures&&wa.requiredTextures.some(({usage:rb})=>0!==(rb&19))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||sb;this._hasTextures=this._hasTextures||
!!oa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Ec=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(tb).then(rb=>{k.isSome(rb)&&rb.updateObjectVisibility(tb.objectHandle,!1);return this._safeReschedule(()=>{var Bb=this._addTasks.get(oa.index);if(Bb)if(k.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,tb),this._addNodeMeta(oa.index,tb),Bb.meta=null,this.suspended)this._removeNodeStageData(oa.index,this.elevationOffset);else{Oa.setObjectVisibility(Xb,
!0);k.isSome(rb)&&rb.updateObjectVisibility(tb.objectHandle,!0);tb.attributeInfo=Bb.attributeInfo;Bb=tb.cachedRendererVersion!==this._rendererVersion;var Fc=Ec!==this.slicePlaneEnabled;this._setObjectSymbolColors(tb);var gd=this._applyFiltersToNode(tb);(Bb||k.isSome(rb)&&(Fc||gd))&&this._addOrUpdateEdgeRendering(tb);this._visibleGeometryChanged(tb);this._highlights.objectCreated(tb);this._updateMaterial(tb);this._setNewNodeOpacity(tb);k.isSome(this._treeDebugger)&&this._treeDebugger.update()}},za)}).catch(rb=>
{k.isSome(Ia.meta)&&(this._deleteComponentObject(Ia.meta),Ia.meta=null);throw rb;})}});return function(oa,wa,za){return sa.apply(this,arguments)}}();Pa._addNodeMeta=function(sa,oa){this._removeNodeStageData(sa,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(sa)){Ba.error("Removing duplicated node");const wa=this._nodeId2Meta.get(sa);k.isSome(wa)&&this._deleteComponentObject(wa)}k.isSome(oa)&&(oa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&ua(oa.cachedEdgeMaterials,
0));this._nodeId2Meta.set(sa,oa)};Pa._safeReschedule=function(sa,oa){m.throwIfAborted(oa);return this._controller.reschedule(sa,oa)};Pa._materialParameters=function(sa,oa){sa=sa.params.material;const wa=oa.some(Ia=>"uvRegion"===Ia.name);oa=oa.some(Ia=>"normalCompressed"===Ia.name);const za=xa(sa);return{geometryParams:this._getGeometryParameters({hasTexture:za,hasNormals:oa,hasRegions:wa}),material:sa}};Pa._initMaterialAndTextures=function(sa,oa,wa,za){const Ia=this._stage.renderView,Sa=wa.map(Xa=>
U.createTexture(Xa,oa,za,Ia));for(const Xa of Sa)k.isSome(Xa)&&this._stage.add(Xa);this._collection.updateMaterial(sa,Xa=>{U.configureMaterial(Xa,oa,Sa,wa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(Xa)});return Sa};Pa._getGeometryParameters=function(sa){return{textureCoordinates:sa.hasTexture?
sa.hasRegions?2:1:0,colors:this._hasVertexColors,normals:sa.hasNormals&&!this._isIntegratedMesh}};Pa._addData=function(sa,oa,wa){let za=this._addTasks.get(sa.index);za?za.attributeInfo=oa:(za={...m.createResolver(),attributeInfo:oa,meta:null},this._addTasks.set(sa.index,za),wa().then(za.resolve,za.reject).then(()=>this._addTasks.delete(sa.index)).catch(Ia=>{this._addTasks.delete(sa.index);throw Ia;}));return za.promise};Pa._clearAddTasks=function(){this._addTasks.forEach(sa=>{k.isSome(sa.meta)&&(this._deleteComponentObject(sa.meta),
sa.meta=null)});this._addTasks.clear()};Pa._clippingAreaChanged=function(){const sa=N.create();ja.projectToBoundingBox(this.view.clippingArea,sa,this.view.renderSpatialReference)?this._clippingArea=sa:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};Pa._geometryFilterChange=function(){this._controller.geometryFilterChanged(this.hasGeometryFilter)};Pa._filterChange=function(){this._applyFilters(!1)};Pa._applyFilters=function(sa){this._filters=
this.getFilters();sa?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(oa=>{k.isSome(oa)&&this._applyFiltersToNode(oa)&&(this._addOrUpdateEdgeRendering(oa),this._visibleGeometryChanged(oa))})};Pa.getFilters=function(){const sa=[];this._clippingArea&&sa.push((oa,wa)=>this._boundingboxFilter(oa,wa,this._clippingArea));return sa};Pa.addSqlFilter=function(sa,oa,wa){if(k.isSome(oa)){const za=oa.fieldNames;sa.push((Ia,Sa)=>this._sqlFilter(Ia,Sa,oa,za,wa))}};Pa._sqlFilter=function(sa,
oa,wa,za,Ia){const Sa={},Xa=this._createLayerGraphic(Sa),bb=this.i3slayer.objectIdField,ab=oa.featureIds,gb=k.isSome(oa.attributeInfo)&&oa.attributeInfo.attributeData;za.every($a=>null!=gb[$a]||$a===bb)&&T.filterInPlace(sa,ab,$a=>{Sa[bb]=ab[$a];for(const Ja of za)Ja!==bb&&(Sa[Ja]=T.getCachedAttributeValue(gb[Ja],$a));try{return wa.testFeature(Xa)}catch(Ja){return Ia(Ja),!1}})};Pa._boundingboxNodeTest=function(sa,oa){L.projectBoundingSphere(sa.node.mbs,this._controller.crsIndex,Ua,this.view.renderSpatialReference);
return T.intersectBoundingBoxWithMbs(oa,Ua)};Pa._boundingboxFeatureTest=function(sa,oa,wa){return N.intersects(wa,this._collection.getComponentAabb(sa.objectHandle,oa,ma))};Pa._boundingboxFilter=function(sa,oa,wa){var za=this._collection;const Ia=this._boundingboxNodeTest(oa,wa);if(3!==Ia)if(0===Ia)sa.length=0;else if(za=za.getComponentCount(oa.objectHandle),za.invisible+za.visible===oa.featureIds.length){var Sa=this._transformAABB(ya,wa,oa.objectHandle);T.filterInPlace(sa,oa.featureIds,Xa=>this._boundingboxFeatureTest(oa,
Xa,Sa))}};Pa._transformAABB=function(sa,oa,wa){var za=this._collection.getObjectTransform(wa);wa=za.position;za=za.rotationScale;sa[0]=(oa[0]-wa[0])/za[0];sa[1]=(oa[1]-wa[1])/za[4];sa[2]=(oa[2]-wa[2])/za[8];sa[3]=(oa[3]-wa[0])/za[0];sa[4]=(oa[4]-wa[1])/za[4];sa[5]=(oa[5]-wa[2])/za[8];return sa};Pa._addOrUpdateEdgeRendering=function(sa,oa=!0){if(k.isNone(this._edgeView))return Promise.resolve(null);const wa=sa.objectHandle,za=this._edgeView.hasObject(wa),{hasEdges:Ia,perFeatureEdgeMaterials:Sa}=this._getFilteredEdgeMaterials(sa),
Xa={slicePlaneEnabled:this.slicePlaneEnabled};if(Ia)return za?(this.nodeCrossfadingEnabled&&(sa=this.getNodeOpacity(sa),ua(Sa,sa)),this._edgeView.updateAllComponentMaterials(wa,Sa,Xa,oa),this._edgeView.updateObjectVisibility(wa,!0),Promise.resolve(this._edgeView)):this._collection.addEdges(wa,this._edgeView,Sa,Xa).then(()=>this._edgeView);za&&this._edgeView.removeObject(wa);return Promise.resolve(null)};Pa._removeEdgeRendering=function(sa){k.isSome(this._edgeView)&&this._edgeView.hasObject(sa.objectHandle)&&
this._edgeView.removeObject(sa.objectHandle)};Pa._applyFiltersToNode=function(sa){return this._applyFiltersToNodeComponents(sa)?(k.isSome(this._labeler)&&this._labeler.applyFilterChange(sa),!0):!1};Pa._applyFiltersToNodeComponents=function(sa){const oa=this._collection;var wa=0===oa.getComponentCount(sa.objectHandle).invisible;oa.setAllComponentVisibilities(sa.objectHandle,"all");if(0===this._filters.length)return sa.filteredIds=null,!wa;this._updateCachedFilteredIds(sa);if(sa.filteredIds===sa.featureIds)return!wa;
wa=this._computeFilteredComponentIndices(sa);oa.setAllComponentVisibilities(sa.objectHandle,wa);return!0};Pa._updateCachedFilteredIds=function(sa){if(null==sa.filteredIds||sa.appliedFilters!==this._filters)sa.filteredIds=this._computeFilteredIds(sa),sa.appliedFilters=this._filters};Pa._computeFilteredIds=function(sa){const oa=sa.featureIds.slice();for(const wa of this._filters)if(wa(oa,sa),0===oa.length)break;return oa.length===sa.featureIds.length?sa.featureIds:oa};Pa._computeFilteredComponentIndices=
function(sa){const oa=[];sa.featureIds.forEach((wa,za)=>{sa.filteredIds[oa.length]===wa&&oa.push(za)});return oa};Pa._removeAllNodeDataFromStage=function(sa=this.elevationOffset){this._nodeId2Meta.forEach((oa,wa)=>this._removeNodeStageData(wa,sa));this._nodeId2MetaReloading.forEach((oa,wa)=>this._removeNodeStageData(wa,sa,this._nodeId2MetaReloading))};Pa.removeNode=function(sa){const oa=this.elevationOffset;this._removeNodeStageData(sa,oa);this._removeNodeStageData(sa,oa,this._nodeId2MetaReloading)};
Pa._removeNodeStageData=function(sa,oa,wa=this._nodeId2Meta){const za=wa.get(sa);k.isNone(za)?wa.delete(sa):(this._collection.setObjectVisibility(za.objectHandle,!1),this._visibleGeometryChanged(za),this._removeEdgeRendering(za),k.isSome(this._labeler)&&this._labeler.removeNodeMeta(za),wa.delete(sa),this._highlights.objectDeleted(za),wa===this._nodeId2Meta?(this._cacheGPUData(za,oa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(za)):this._deleteComponentObject(za),k.isSome(this._treeDebugger)&&
this._treeDebugger.update())};Pa._deleteComponentObject=function(sa){k.isSome(this._edgeView)&&this._edgeView.removeObject(sa.objectHandle);this.memEstimateGeometryRemoved(sa.objectHandle);this._collection.destroyObject(sa.objectHandle);if(sa.textures)for(const oa of sa.textures)this.memEstimateTextureRemoved(oa),this._stage.remove(oa)};Pa.updateNodeState=function(sa,oa){sa=this._nodeId2Meta.get(sa);k.isSome(sa)&&this._collection.updateMaterial(sa.objectHandle,wa=>wa.polygonOffsetEnabled=0===oa)};
Pa._invalidateAllSymbols=function(){this._rendererVersion=T.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Pa._getInvalidRendererVersion=function(){return T.addWraparound(this._rendererVersion,-1)};Pa._rendererChange=function(){var sa=f._asyncToGenerator(function*(oa){this._currentRenderer=oa;this.notifyChange("rendererTextureUsage");this._rendererVersion=T.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=
null;this._invalidateAllSymbols();oa&&(this._rendererFields=yield oa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&oa&&"arcadeRequired"in oa&&oa.arcadeRequired&&(this._arcade=yield M.loadArcade());if(oa&&"visualVariables"in oa&&oa.visualVariables)for(const wa of oa.visualVariables)"color"===wa.type?this._colorVariable=wa:"opacity"===wa.type?this._opacityVariable=wa:Ba.warn(`Unsupported visual variable type for 3D Object Scene Services: ${wa.type}`);if(oa)for(const wa of oa.getSymbols())"mesh-3d"!==
wa.type&&Ba.error(`Symbols of type '${wa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(oa){return sa.apply(this,arguments)}}();Pa._getCachedEdgeMaterials=function(sa){this._hasSymbolColors&&sa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(sa);return sa.cachedEdgeMaterials};Pa._getSymbolColors=function(sa){this._hasSymbolColors&&sa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(sa);
const oa=sa.cachedSymbology;return(wa,za)=>{wa*=5;F.set(za.externalColor,oa[wa+0]/255,oa[wa+1]/255,oa[wa+2]/255,oa[wa+3]/255);za.externalColorMixMode=oa[wa+4]&15;za.castShadows=0!==(oa[wa+4]&16);za.pickable=0!==(oa[wa+4]&32)}};Pa._getSymbolInfo=function(sa,oa){oa=sa&&sa.getSymbol(oa,{arcade:this._arcade});if(!(oa instanceof O))return null;sa=oa.id;if(this._symbolInfos.has(sa))return this._symbolInfos.get(sa);oa=T.getSymbolInfo(oa);this._symbolInfos.set(sa,oa);return oa};Pa._setSymbologyOverride=function(sa,
oa){this._symbologyOverride!==sa&&(this._symbologyOverride=sa,this._symbologyOverrideFields=oa,this._invalidateAllSymbols(),this._updateSymbologyFields())};Pa._updateSymbologyFields=function(){this._symbologyFields=k.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?k.isSome(this._rendererFields)&&0<this._rendererFields.length?G.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};
Pa._updateCachedRendererData=function(sa){sa.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var oa=this._tmpAttributeOnlyGraphic,wa={};oa.attributes=wa;var za=this._currentRenderer,Ia=k.isSome(sa.attributeInfo)&&sa.attributeInfo.attributeData,Sa=null!=sa.featureIds?this.i3slayer.objectIdField:null,Xa=null!=Ia&&k.isSome(this._symbologyFields)&&0<this._symbologyFields.length,bb=Xa?[]:null,ab=Xa?[]:null;if(Xa&&k.isSome(this._symbologyFields))for(var gb of this._symbologyFields){var $a=
Ia[gb];$a&&(bb.push(gb),ab.push($a))}sa.cachedSymbology||(sa.cachedSymbology=new Uint8Array(5*sa.featureIds.length));Ia={color:Ra,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null};gb=this.fullOpacity;gb=this.nodeCrossfadingEnabled?this.getNodeOpacity(sa):gb;$a=null;var Ja=2,Oa=T.transparentEdgeMaterial,Wa=0;for(let ib=0;ib<sa.featureIds.length;ib++){null!=Sa&&(wa[Sa]=sa.featureIds[ib]);if(Xa)for(var Za=0;Za<bb.length;Za++)wa[bb[Za]]=T.getCachedAttributeValue(ab[Za],ib);var cb=this._getSymbolInfo(za,
oa);let sb=Za=null;if(za&&"visualVariables"in za){if(this._colorVariable){var eb=J.getColor(this._colorVariable,oa,{color:ea,arcade:this._arcade});eb&&(Za=Ra,Za[0]=eb.r/255,Za[1]=eb.g/255,Za[2]=eb.b/255,this._opacityVariable||null===eb.a||(sb=eb.a))}this._opacityVariable&&(sb=J.getOpacity(this._opacityVariable,oa,{arcade:this._arcade}))}cb&&cb.material&&(eb=cb.material,Za=k.isNone(Za)||k.isNone(sb)?W.overrideColor(Za,sb,eb.color,eb.alpha,Ea,Ra):W.overrideColor(Za,sb,null,null,Ea,Ra));k.isNone(Za)&&
(Za=Ra,Za[0]=1,Za[1]=1,Za[2]=1,Za[3]=1);Ia.pickable=!0;Ia.castShadows=cb?cb.castShadows:!0;Ia.colorMixMode=cb&&cb.material?cb.material.colorMixMode:1;Ia.edgeMaterial=cb?cb.edgeMaterial:null;k.isSome(this._symbologyOverride)&&(Ia.color=Za,this._symbologyOverride(oa,Ia),Za=Ia.color);if(k.isSome(Ia.edgeMaterial)){cb=0>=Za[3]?0:1<=Za[3]&&(sa.material.isOpaque||3===Ia.colorMixMode)?2:1;if(Ia.edgeMaterial!==$a||cb!==Ja)Oa={...Ia.edgeMaterial,opacity:gb,objectTransparency:cb},$a=Ia.edgeMaterial,Ja=cb;sa.cachedEdgeMaterials[ib]=
Oa}else sa.cachedEdgeMaterials[ib]=T.transparentEdgeMaterial;sa.cachedSymbology[Wa+0]=Math.round(255*Za[0]);sa.cachedSymbology[Wa+1]=Math.round(255*Za[1]);sa.cachedSymbology[Wa+2]=Math.round(255*Za[2]);sa.cachedSymbology[Wa+3]=Math.round(255*Za[3]);sa.cachedSymbology[Wa+4]=Ia.colorMixMode|+Ia.castShadows<<4|+Ia.pickable<<5;Wa+=5}}};Pa._getFilteredEdgeMaterials=function(sa){var oa=this._getCachedEdgeMaterials(sa);this.nodeCrossfadingEnabled||ua(oa,this.fullOpacity);if(k.isNone(sa.filteredIds))return{hasEdges:oa.some(Ia=>
Ia!==T.transparentEdgeMaterial),perFeatureEdgeMaterials:oa};let wa=0,za=!1;oa=oa.map((Ia,Sa)=>{if(sa.featureIds[Sa]!==sa.filteredIds[wa])return T.transparentEdgeMaterial;za=za||Ia!==T.transparentEdgeMaterial;wa++;return Ia});return{hasEdges:za,perFeatureEdgeMaterials:oa}};Pa._setObjectSymbolColors=function(sa){if(this._hasSymbolColors){var oa=sa.objectHandle;sa=this._getSymbolColors(sa);this._collection.setComponentData(oa,sa);this._stage.renderView.setNeedsRender()}};Pa._reloadAll=function(sa=this.elevationOffset){this._removeAllNodeDataFromStage(sa);
null!=this._controller&&this._controller.restartNodeLoading()};Pa._opacityChange=function(sa){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(oa=>{k.isNone(oa)||(this._collection.updateMaterial(oa.objectHandle,wa=>wa.objectOpacity=sa),ua(oa.cachedEdgeMaterials,sa),this._updateEdgeRendering(oa))})};Pa._updateMaterial=function(sa){this._collection.updateMaterial(sa.objectHandle,oa=>{oa.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;
oa.usePBR=this._usePBR();this._updateMaterialOverlay(oa)})};Pa._updateMaterialOverlay=function(sa){};Pa._updateEngineObject=function(sa){this._setObjectSymbolColors(sa);this._applyFiltersToNode(sa);this._addOrUpdateEdgeRendering(sa);this._visibleGeometryChanged(sa)};Pa._slicePlaneEnabledChange=function(sa){this._intersectionHandler&&(this._intersectionHandler.slicePlane=sa);k.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=sa);this._nodeId2Meta.forEach(oa=>{k.isNone(oa)||(this._collection.updateMaterial(oa.objectHandle,
wa=>{wa.commonMaterialParameters.slicePlaneEnabled=sa}),this._updateEdgeRendering(oa,!1))})};Pa._updatePBR=function(){this._nodeId2Meta.forEach(sa=>{k.isNone(sa)||this._collection.updateMaterial(sa.objectHandle,oa=>{oa.usePBR=this._usePBR()})});this._hasLoadedPBRTextures=!0};Pa._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};Pa._updateEdgeRendering=function(sa,oa=!0){k.isSome(this._edgeView)&&this._edgeView.hasObject(sa.objectHandle)&&this._addOrUpdateEdgeRendering(sa,
oa)};Pa._forAllNodes=function(sa){this._nodeId2Meta.forEach(sa)};Pa._forAllFeatures=function(sa,oa,wa=0){h.someMap(this._nodeId2Meta,za=>{if(k.isNone(za))return!1;if(k.isSome(oa))switch(oa(za)){case 0:return!0;case 2:return!1}let Ia=1;switch(wa){case 1:Ia=this._forAllFeaturesOfNode(za,sa);break;case 0:Ia=this._forVisibleFeaturesOfNode(za,sa);break;case 2:Ia=this._forAllFeaturesOfNodeInClippingArea(za,sa)}return 0===Ia})};Pa._forAllFeaturesOfNode=function(sa,oa){let wa=1;const za=sa.featureIds;for(let Ia=
0;Ia<za.length&&(wa=oa(za[Ia],Ia,sa),0!==wa);Ia++);return wa};Pa._forVisibleFeaturesOfNode=function(sa,oa){let wa=1;const za=sa.featureIds;this._collection.forEachVisibleComponent(sa.objectHandle,Ia=>{wa=oa(za[Ia],Ia,sa);return 1===wa});return wa};Pa._forAllFeaturesOfNodeInClippingArea=function(sa,oa){if(null==this._clippingArea)return this._forAllFeaturesOfNode(sa,oa);var wa=this._boundingboxNodeTest(sa,this._clippingArea);if(0===wa)return 1;if(3===wa)return this._forAllFeaturesOfNode(sa,oa);wa=
sa.featureIds;const za=T.getClipAABB(this._clippingArea,this._collection.getObjectTransform(sa.objectHandle));for(let Ia=0;Ia<wa.length;Ia++){if(!this._boundingboxFeatureTest(sa,Ia,za))continue;const Sa=oa(wa[Ia],Ia,sa);if(0===Sa)return Sa}return 1};Pa._createAttributes=function(sa,oa){const wa={};null!=oa.featureIds&&(wa[this._getObjectIdField()]=oa.featureIds[sa]);oa=k.isSome(oa.attributeInfo)&&oa.attributeInfo.attributeData;if(k.isSome(oa))for(const za of Object.keys(oa))wa[za]=T.getCachedAttributeValue(oa[za],
sa);return wa};Pa._createGraphic=function(sa,oa){return this._createLayerGraphic(this._createAttributes(sa,oa))};Pa.highlight=function(sa){const oa=this._highlights;"number"===typeof sa?sa=[sa]:sa instanceof w?sa=[sa]:sa instanceof e&&(sa=sa.toArray());if(Array.isArray(sa)&&0<sa.length){if(sa[0]instanceof w){const wa=this.i3slayer.fieldsIndex,za=this._getObjectIdField();sa=sa.map(Xa=>X.attributeLookup(wa,Xa.attributes,za));const {set:Ia,handle:Sa}=oa.acquireSet();oa.setFeatureIds(Ia,sa);return Sa}if("number"===
typeof sa[0]){const {set:wa,handle:za}=oa.acquireSet();oa.setFeatureIds(wa,sa);return za}}return Qa};Pa._visibleGeometryChanged=function(sa){this._elevationProvider&&(this._elevationProvider.objectChanged(sa.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=z.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})))};Pa.getNodeOpacityByIndex=function(sa){sa=this._nodeId2Meta.get(sa);return this.getNodeOpacity(sa)};
Pa.getNodeOpacity=function(sa){return k.isSome(sa)?this._collection.getMaterial(sa.objectHandle).objectOpacity:0};Pa.isNodeFullyFadedIn=function(sa){return this._crossfadeHelper.isNodeFullyFadedIn(sa)};Pa.getNodeCrossfadeMetaData=function(sa){return this._nodeId2Meta.get(sa)};Pa.markNodeToRemove=function(sa){this._controller&&this._controller.markNodeToRemove(sa)};Pa.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Pa.foreachCrossfadeNode=function(sa){this._nodeId2Meta.forEach((oa,
wa)=>sa(wa,oa))};Pa.fadeNode=function(sa,oa,wa){if(this.nodeCrossfadingEnabled){var za=this._nodeId2Meta.get(sa);k.isSome(za)&&this._crossfadeHelper.fadeNode(sa,za,oa,wa)}};Pa.setNodeOpacityByIndex=function(sa,oa){sa=this._nodeId2Meta.get(sa);k.isSome(sa)&&this._setNodeOpacity(sa,oa)};Pa._setNodeOpacity=function(sa,oa){this._collection.updateMaterial(sa.objectHandle,wa=>wa.objectOpacity=oa);this._setNodeEdgeOpacity(sa,oa)};Pa._setNodeEdgeOpacity=function(sa,oa){k.isSome(this._edgeView)&&sa.cachedEdgeMaterials&&
(ua(sa.cachedEdgeMaterials,oa),sa=sa.objectHandle,this._edgeView.hasObject(sa)&&this._edgeView.updateAllComponentOpacities(sa,oa))};Pa.updateNodeModificationStatus=function(sa){var oa=sa.length;if(this._hasModifications&&!(0>=oa)&&!0===this._i3sWasmLoaded){oa=this.i3slayer.uid;var wa=Ha(sa);if(k.isSome(wa)){Y.filterObbsForModificationsSync({context:oa,buffer:wa.buffer});const za=new Float64Array(wa.buffer);sa.forAll((Ia,Sa)=>{Sa=Y.interpretObbModificationResults(za[Sa]);Ia.imModificationImpact=Sa;
0!==Sa&&this._controller.invalidateGeometryVisibility(Ia.index)})}}};Pa.notifyUpdate=function(){this.notifyChange("updating")};Pa.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};Pa.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||k.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading};f._createClass(Ta,[{key:"lodCrossfadeoutDuration",
get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return T.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||
this._hasLoadedPBRTextures?63:37:this._usePBR()||this._hasLoadedPBRTextures?44:36}},{key:"elevationOffset",get:function(){const sa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=sa&&"absolute-height"===sa.mode){const oa=c.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),wa=Q.getMetersPerUnit(sa.unit);return k.unwrapOr(sa.offset,0)*wa/oa}return 0}},{key:"supportedTextureEncodings",get:function(){return U.getSupportedEncodings(this.view._stage.renderView)}},{key:"uncompressedTextureDownsamplingEnabled",
get:function(){var sa;const oa=null==(sa=this.view)?void 0:sa.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled;sa=0===(this.supportedTextureEncodings&4);return oa&&sa}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",get:function(){var sa,oa;return!(null!=(sa=this.view)&&null!=(oa=sa._stage)&&oa.renderView.has(3))}},{key:"nodeCrossfadingEnabled",
get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const sa={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB",...this._collection?this._collection.performanceInfo:{shown:0,hidden:0}};k.isSome(this._memCache)&&(sa.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(sa.IDBCache=Math.round(100*this._idbCache.getHitRate())+
"% hit"),this._controller.updateStats(sa));return sa}},{key:"test",get:function(){const sa=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const oa=[];sa._forAllFeatures(wa=>{oa.push(wa);return 1},null,0);oa.sort((wa,za)=>wa-za);return oa},get numNodes(){return sa._nodeId2Meta.size}}}},{key:"_hasModifications",get:function(){return this._modifications&&0<this._modifications.length}}]);return Ta}(ra);ra.lastIndex=0;p.__decorate([g.property()],ra.prototype,"_hasLoadedPBRTextures",
void 0);p.__decorate([g.property()],ra.prototype,"_asyncModuleLoading",void 0);p.__decorate([g.property()],ra.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);p.__decorate([g.property()],ra.prototype,"view",void 0);p.__decorate([g.property()],ra.prototype,"i3slayer",void 0);p.__decorate([g.property()],ra.prototype,"_controller",void 0);p.__decorate([g.property()],ra.prototype,"_labeler",void 0);p.__decorate([g.property()],ra.prototype,"updating",void 0);p.__decorate([g.property()],ra.prototype,
"suspended",void 0);p.__decorate([g.property()],ra.prototype,"holeFilling",void 0);p.__decorate([g.property(ka.updatingProgress)],ra.prototype,"updatingProgress",void 0);p.__decorate([g.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],ra.prototype,"updatingProgressValue",void 0);p.__decorate([g.property({readOnly:!0})],ra.prototype,"hasTexturesOrVertexColors",null);p.__decorate([g.property({readOnly:!0})],ra.prototype,"rendererTextureUsage",null);p.__decorate([g.property({readOnly:!0})],
ra.prototype,"elevationOffset",null);p.__decorate([g.property({type:Boolean})],ra.prototype,"slicePlaneEnabled",void 0);p.__decorate([g.property()],ra.prototype,"supportedTextureEncodings",null);p.__decorate([g.property()],ra.prototype,"uncompressedTextureDownsamplingEnabled",null);p.__decorate([g.property({type:[H]})],ra.prototype,"_modifications",void 0);return ra=va=p.__decorate([y.subclass("esri.views.3d.layers.I3SMeshView3D")],ra)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I){function G(S,V){return e.isSome(S)&&S.length===V.length&&S.every(Y=>0<=K(V,Y.name))}function K(S,V){V=V.toLowerCase();for(let Y=0;Y<S.length;Y++)if(S[Y].name.toLowerCase()===V)return Y;return-1}const H=w.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");f=function(S){function V(W){W=S.call(this,W)||this;W.screenSizeFactor=0;W.featureTarget=5E4;W.fixedFeatureTarget=!1;W.updating=!0;W.updatingProgress=1;W.leavesReached=
!1;W.scaleVisibilityEnabled=!0;W._featureLOD=1;W._stableFeatureLOD=!1;W._isIdle=!1;W._cameraDirty=!0;W._invisibleDirty=!1;W._newLoadingNodes=new n({deallocator:null});W._loadedNodeScales=new Map;W._modificationsNodeFilteringArray=new n;W._downloadingCount=0;W._loadingNodes=new Map;W._updatingNodes=new Map;W._progressMaxNumNodes=1;W._requiredAttributes=[];W._requiredAttributesDirty=!0;W._updatesDisabled=!1;W.disableIDBCache=!1;W._disableMemCache=!1;W._restartNodeLoading=!1;W._fields=null;W._attributeStorageInfo=
null;W._handles=new p;W._idleQueue=new q;W._elevationUpdateNodes=new n({deallocator:null});W._errorCount=0;return W}a._inheritsLoose(V,S);var Y=V.prototype;Y.initialize=function(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new D(this.layerView);const W=this.layerView.i3slayer;this.layer=W;this._defaultGeometrySchema=W.store.defaultGeometrySchema;this.disableIDBCache=t("disable-feature:idb-cache");"fields"in W&&(this._fields=W.fields,
this._attributeStorageInfo=W.attributeStorageInfo);this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then(([ba])=>{var ca;if(!this.destroyed&&this.layerView&&!this.layerView.destroyed){var da=this.layerView.view;this._setClippingArea(da.clippingArea);var ha=this.layerView.view.resourceController;this._handles.add([k.init(da,"pointsOfInterest.focus.renderLocation",fa=>this._pointOfInterestChanged(fa)),ha.memoryController.events.on("quality-changed",
()=>this._setCameraDirty()),k.init(this.layerView,"suspended",fa=>{const R=fa?()=>this._updateViewData():()=>this._updateIdleState(!0),U=fa?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(fa&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=R,this._idleStateCallbacks.idleEnd=U):this._idleStateCallbacks=ha.scheduler.registerIdleStateCallbacks(R,U)}),y.addTask(this.layerView.view.resourceController.scheduler,{update:(fa,R)=>this._frame(fa,R),needsUpdate:()=>
this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",()=>this.restartNodeLoading()),this.watch(["featureTarget","fixedFeatureTarget"],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),da.state.watch("contentCamera",()=>this._setCameraDirty()),this.layer.watch("elevationInfo",()=>this._elevationInfoChanged()),this.layer.watch(["minScale","maxScale"],()=>this._scaleBoundsChanged()),this.layerView.watch("lodFactor",()=>this._setCameraDirty()),this.layerView.watch("availableFields?",
()=>this._requiredFieldsChange()),this.layerView.watch("holeFilling",fa=>e.isSome(this._index)&&(this._index.holeFilling=fa))]);this._updateScaleHandles();this._viewportQueries=new E(this.crsIndex,da.renderCoordsHelper,da.state.contentCamera,!da.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,da.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:.5>this.lod});this._index=new x.I3SIndex(W,
ba,this.indexStreamController,this._viewportQueries,H,this.layerView.holeFilling,fa=>this.layerView.isNodeLoaded(fa),fa=>this.layerView.isNodeReloading(fa),fa=>this._shouldLoadNode(fa),fa=>this._enableFromGPUCache(fa,1),fa=>this._needsUpdate(fa),()=>!this.indexStreamController.busy,fa=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(fa):null,null!=(ca=this.layerView)&&ca.computeNodeFiltering?fa=>this.layerView.computeNodeFiltering(fa):void 0);ba=e.isSome(this.layer.modifications)&&
this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(ba);this._startNodeLoading()}}));this._tmpPoint=A.makeDehydratedPoint(0,0,0,this.crsIndex)};Y.updateNodeModificationStatus=function(W){const ba=this._index,ca=this.layerView;e.isSome(ba)&&ca&&ca.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),W.forAll(da=>{da=ba.getNode(da);e.isSome(da)&&this._modificationsNodeFilteringArray.push(da)}),ca.updateNodeModificationStatus(this._modificationsNodeFilteringArray),
this._invisibleDirty=!0)};Y.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;J.prune();e.isSome(M)&&(M.remove(),M=null)};Y._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const W=this._attributeStorageInfo,ba=this._fields,ca=this.layer.objectIdField;return this.layerView.availableFields.map(da=>
{const ha=K(W,da);da=K(ba,da);return 0<=ha&&0<=da?{index:ha,name:ba[da].name,field:ba[da],attributeStorageInfo:W[ha]}:null}).filter(da=>null!=da&&da.name!==ca)};Y._requiredFieldsChange=function(){const W=this._getRequiredAttributes();G(this._requiredAttributes,W)||(this._requiredAttributes=W,this._requiredAttributesDirty=!1,this.restartNodeLoading())};Y.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};Y._setClippingArea=function(W){const ba=d.create();F.projectToBoundingBox(W,
ba,this.layerView.view.renderSpatialReference)?this._clippingArea=ba:this._clippingArea=null};Y._pointOfInterestChanged=function(W){e.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(W),e.isSome(this._index)&&(this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};Y.updateClippingArea=function(W){this._setClippingArea(W);e.isSome(this._viewportQueries)&&e.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()};Y._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};Y.updateElevationChanged=function(W,ba){const ca=this._index;if(!e.isNone(ca)){var da=ca.rootNode;if(!e.isNone(da)){var ha=this._elevationUpdateNodes;ha.clear();v.findIntersectingNodes(W,ba,da,this.crsIndex,ca,fa=>ha.push(fa.index));ha.forAll(fa=>{ca.invalidateBoundingVolumeCache(fa);
fa===da.index&&this.notifyChange("rootNodeVisible")});ha.length&&this.restartNodeLoading()}}};Y.getParentIndex=function(W){return e.isSome(this._index)&&this._index.getParentIndex(W)};Y._elevationInfoChanged=function(){e.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};Y._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",W=>this._scaleUpdateHandler(W)),
"scale-bounds")};Y._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};Y._scaleUpdateHandler=function(W){this._updateScaleInBoundingRect(W.scale,W.extent,W.spatialReference);this._setCameraDirty()};Y._updateScaleInBoundingRect=function(W,ba,ca){const da=this._index;e.isNone(da)||!e.isNone(da.rootNode)&&c.projectBoundingRect(ba,ca,Q,this.crsIndex)&&this._loadedNodeScales.forEach((ha,fa)=>{ha=da.getNode(fa);e.isSome(ha)&&
g.containsPoint(Q,ha.mbs)&&this._loadedNodeScales.set(fa,W)})};Y.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};Y.schedule=function(W,ba){return this._idleQueue.push(W,ba)};Y.reschedule=function(W,ba){return this._idleQueue.unshift(W,ba)};Y._frame=function(W,ba){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||e.isNone(this._index))return-Infinity;this._processLogError(W,
ba);return this._index.getPriority()};Y._processLogError=function(W,ba){try{this._process(W,ba)}catch(ca){50>this._errorCount?H.error("Error during processing: "+ca):50===this._errorCount&&H.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};Y._process=function(W,ba){this._restartNodeLoading&&this._startNodeLoading();if(null!=this._nodeLoader&&!e.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(W)&&(this._invisibleDirty=
!1);this.isIntegratedMesh&&(W.enabled=!1);W.run(()=>this._processIndex(W));this._updateFeatureLOD();W.run(()=>this._processCache(W));this.isIntegratedMesh&&(W.enabled=!0);for(W.run(()=>this._processNodes(W,ba));!W.done&&this._idleQueue.process();)W.madeProgress();W.run(()=>this._prefetchIndex());ba.numIndexLoading+=this._index.getIndexLoading();ba.numNodesLoading+=this._downloadingCount;W.run(()=>this._lodHandling.lodGlobalHandling(W));this._evaluateUpdating()}};Y._processIndex=function(W){if(e.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],W,ba=>this.updateNodeModificationStatus(ba)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),W=this._index.featureEstimate.leavesReached,this._index.isLoading()||W===this._get("leavesReached")||this._set("leavesReached",W));return this._index.load()};
Y._prefetchIndex=function(){return e.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};Y._updateFeatureLOD=function(){if(this.isGraphics3D&&!e.isNone(this._index)&&!e.isNone(this._viewportQueries)){var W=!this._index.isLoading(),ba=this.featureTarget*this.baseLOD,ca=this._index.featureEstimate;ca.estimate=ca.estimate||ba/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(W&&
ca.estimate<ba){if(ca.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(ba/ca.estimate,1.001));W=this.lod;ba=this._index.checkFeatureTarget(ba,W);ba!==W&&(this._featureLOD=ba/this.baseLOD,this._stableFeatureLOD=!0)}else if(ca.estimate>1.2*ba||W&&ca.estimate>ba){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(ca.estimate/ba-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.requestUpdate()}};Y._processCache=function(W){const ba=this._index;if(e.isNone(ba))return!1;for(;0<this._newLoadingNodes.length&&!W.done;){var ca=this._newLoadingNodes.pop();for(ca=ba.getParent(ca);e.isSome(ca)&&!this.layerView.isNodeLoaded(ca.index)&&this._isNodeInScaleBounds(ca);ca=ba.getParent(ca.index))if(this._enableFromGPUCache(ca,0)){W.madeProgress();break}}return W.hasProgressed};Y._processNodes=function(W,ba){if(e.isNone(this._index))return!1;let ca=(this._isIdle?100:2)-this._loadingNodes.size;
const da=this._index.updates;da.cancel.forEach(this._cancelNode,this);for(da.cancel=[];0<da.remove.length&&!W.done;)this.layerView.removeNode(da.remove.pop()),W.madeProgress();for(;0<da.update.length&&!W.done;){var ha=this._index.getNode(da.update.pop());e.isSome(ha)&&(this._updateLoadedNode(ha),W.madeProgress())}for(;0<da.add.length&&!W.done&&0<ca;){--ca;ha=this._index.getNode(da.add.back());if(e.isNone(ha)||2!==ha.cacheState&&!this._hasNodeLoadToken(ba))break;da.add.pop();this._loadNode(ha);W.madeProgress()}return W.hasProgressed};
Y._cancelAllNodes=function(){this._loadingNodes.forEach(W=>W.abort());this._loadingNodes.clear();this._updatingNodes.forEach(W=>W.abort());this._updatingNodes.clear()};Y._cancelNode=function(W){const ba=this._loadingNodes.get(W);ba&&(ba.abort(),this._loadingNodes.delete(W))};Y._hasNodeLoadToken=function(W){return!this._isIdle&&2<=W.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<L.maxDownloadSlots&&!this.dataStreamController.busy};Y._evaluateUpdating=function(){var W=!1,ba=0;this.layerView.suspended?
ba=(W=this._cameraDirty)?0:1:(W=e.isSome(this._index)?this._index.getIndexMissing():0,ba=e.isSome(this._index)?this._index.updates.add.length:0,ba=W+3*ba+2*this._loadingNodes.size,W=!!(0<ba||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===ba&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(ba,this._progressMaxNumNodes),ba=1-ba/this._progressMaxNumNodes);this.updating=
W;this.updatingProgress=ba};Y._updateViewData=function(){if(this._cameraDirty&&!e.isNone(this._index)&&!e.isNone(this._viewportQueries)){var W=this.layerView.view,{contentCamera:ba,fixedContentCamera:ca}=W.state;this.screenSizeFactor=1/(ba.perScreenPixelRatio/2);this._viewportQueries.updateCamera(ba,!ca||this.isGraphics3D);this._viewportQueries.setPointOfInterest(W.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();
this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};Y._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Y.isGeometryVisible=function(W){return e.isSome(this._index)&&this._index.isGeometryVisible(W.index)};Y.updateVisibility=
function(W){e.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(W)};Y.updateBoundingVolume=function(W){e.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(W)};Y.invalidateGeometryVisibility=function(W){e.isSome(this._index)&&this._index.invalidateGeometryVisibility(W)};Y.invalidateVisibilityObbs=function(){e.isSome(this._index)&&this._index.invalidateVisibilityObbs()};Y.modificationsChanged=function(){if(e.isSome(this._index)){const W=e.isSome(this.layer.modifications)&&
this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(W)}this._invisibleDirty=!0};Y._shouldLoadNode=function(W){return this._lodHandling.shouldLoadNode(W)&&!this._shouldDropNode(W)&&this._isNodeInScaleBounds(W)?e.isSome(this._index)?this._index.isGeometryVisible(W.index):!1:!1};Y._shouldDropNode=function(W){if(e.isNone(this._viewportQueries))return!1;const ba=this.lodDropFactor;return 1<=ba||!this._lodHandling.hasNoVisibleChildren(W)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(W))-
this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*ba};Y._startNodeLoading=function(){this._restartNodeLoading=!1;const W=this._index;this._updatesDisabled||e.isNone(W)||e.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new C(this.layer,this.dataStreamController,H,this._defaultGeometrySchema,this._requiredAttributes,
{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid}),W.requestUpdate(),this._lodHandling.startNodeLoading(ba=>this._isNodeInScaleBounds(ba),(ba,ca)=>this._removeNodes(ba,ca,1),W,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};Y.isNodeLoading=function(){return null!=this._nodeLoader&&
null!=this._index};Y.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};Y._removeInvisibleNodes=function(W){const ba=this._index;if(e.isNone(ba)||e.isNone(this._viewportQueries))return!1;J.clear();this.layerView.getLoadedNodeIndices(J);const ca=0===this._viewportQueries.maxDistance,da=ca?()=>!1:ha=>this._shouldDropNode(ha);
J.filterInPlace(ha=>{const fa=ba.getNode(ha);return e.isNone(fa)||!ba.isGeometryVisible(ha)||da(fa)||!this._isNodeInScaleBounds(fa)});0<J.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(J,W,0);if(ca&&1>this.lodDropFactor)return!1;if(0===J.length)return!0;J.clear();return!1};Y.markNodeToRemove=function(W){J.push(W)};Y.removeMarkedNodes=function(){this._removeNodes(J,I.noBudget,0)};Y._removeNodes=function(W,ba,ca){const da=W.length;if(0!==da&&!ba.done){for(e.isSome(this._index)&&this._index.requestUpdate();0<
W.length&&!ba.done;){const ha=W.pop(),fa=this._index;1===ca&&this.layerView.nodeFadeoutEnabled&&e.isSome(fa)&&fa.isGeometryVisible(ha)?this.layerView.fadeNode(ha,1,!0):this.layerView.removeNode(ha);ba.madeProgress()}if(0<this._loadedNodeScales.size)for(ba=W.length;ba<da;ba++)this._loadedNodeScales.delete(W.data[ba])}};Y._needsUpdate=function(W){if(!W.resources.hasFeatureData||this._updatingNodes.has(W.index))return!1;W=this.layerView.getLoadedAttributes(W.index);return null!=W&&W!==this._requiredAttributes};
Y._updateLoadedNode=function(W){const ba=h.createAbortController();this._updatingNodes.set(W.index,ba);const ca=this.layerView.getLoadedAttributes(W.index);(G(ca,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(W.index)):this._nodeLoader.loadAttributes(W,this._requiredAttributes,ba.signal)).then(da=>this.schedule(()=>this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:da},ba.signal),ba.signal)).catch(da=>{if(!h.isAbortError(da))return this.layerView.updateAttributes(W.index,
{loadedAttributes:this._requiredAttributes,attributeData:{}},ba.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(W.index);this._evaluateUpdating()});this._evaluateUpdating()};Y._loadNode=function(W){if(this._loadingNodes.has(W.index))H.error("already loading node "+W.index);else{var ba=h.createAbortController();this._loadingNodes.set(W.index,ba);var ca=()=>{this._loadingNodes.get(W.index)===ba&&this._loadingNodes.delete(W.index);this._evaluateUpdating()};this._evaluateUpdating();this._loadAndAddNode(W,
ba.signal).then(ca).catch(da=>{ca();if(!h.isAbortError(da))throw da;})}};Y._loadAndAddNode=function(W,ba){return 1===W.cacheState?this._loadUncached(W,ba):this._loadCached(W,ba).then(ca=>{ca||(W.cacheState=1,e.isSome(this._index)&&this._index.updates.add.push(W.index))}).catch(ca=>{if(!h.isAbortError(ca))throw W.cacheState=1,ca;})};Y._enableFromGPUCache=function(W,ba){if(this._disableMemCache||e.isNone(this._index))return!1;if(0===ba&&!this._index.useNodeAsHole(W.index))return!0;const ca=this._loadCachedGPUData(W);
if(!ca)return!1;this.layerView.addCachedGPUData(W,ca,ba);this._nodeAdded();return!0};Y._loadCachedGPUData=function(W){W=this.layerView.loadCachedGPUData(W);if(e.isSome(W)&&e.isSome(W.attributeInfo)&&G(W.attributeInfo.loadedAttributes,this._requiredAttributes))return W;this.layerView.deleteCachedGPUData(W);return null};Y._nodeAdded=function(){e.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};Y._loadCached=function(W,ba){if(this._enableFromGPUCache(W,
1))return Promise.resolve(!0);const ca=this.layerView;return!this.disableIDBCache&&ca.loadCachedNodeData&&ca.addCachedNodeData?this.schedule(()=>ca.loadCachedNodeData(W,ba,(da,ha)=>this._nodeLoader.loadTextures(W,da,ha)),ba).then(da=>{if(e.isNone(da))return!1;const ha=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(W,ha,ba),ba).then(fa=>this.reschedule(()=>ca.addCachedNodeData(W,da,{loadedAttributes:ha,attributeData:fa},ba),ba)).then(()=>{this._nodeAdded();return!0})}):
Promise.resolve(!1)};Y._loadUncached=function(W,ba){this._downloadingCount++;return this._nodeLoader.loadNodeData(W,ba).catch(ca=>{this._downloadingCount--;throw ca;}).then(ca=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(W,ca,ba),ba)}).then(()=>{this._nodeAdded();W.cacheState=2}).catch(ca=>{if(!h.isAbortError(ca))throw H.error("#loadNodeData()",this.layer,`Failed to load node '${W.id}'`,ca),W.failed=!0,e.isSome(this._index)&&this._index.requestUpdate(),ca;})};Y._updateIdleState=
function(W){W!==this._isIdle&&(this._isIdle=W,this._evaluateUpdating(),W&&this._index&&e.isSome(this._index)&&this._index.resetFailedNodes())};Y._getScale=function(W){if(this._loadedNodeScales.has(W.index))return this._loadedNodeScales.get(W.index);this._tmpPoint.x=W.mbs[0];this._tmpPoint.y=W.mbs[1];this._tmpPoint.z=W.mbs[2];const ba=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(W.index)&&this._loadedNodeScales.set(W.index,ba);return ba};Y._isNodeInScaleBounds=
function(W){if(!this.areScaleBoundsActive)return!0;W=this._getScale(W);const {minScale:ba,maxScale:ca}=N.extractSafeScaleBounds(this.layer);return N.scaleBoundsPredicate(W,ba,ca)};Y.updateStats=function(W){W.index=e.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(W.detail=this._featureLOD,W.target=this.featureTarget*this.baseLOD);e.isSome(this._index)&&this._index.updateStats(W)};Y.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();e.isSome(this._index)&&
this._index.requestUpdate()};Y.geometryFilterChanged=function(W){const ba=this._index;e.isSome(ba)&&ba.layerFilterChanged(W);this.requestUpdate()};a._createClass(V,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",get:function(){return"points"===this.layer.profile}},{key:"indexStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(2);return new B.I3SStreamDataController(W,
this.layer.apiKey)}},{key:"dataStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(3);return new B.I3SStreamDataController(W,this.layer.apiKey)}},{key:"crsVertex",get:function(){return v.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return v.getIndexCrs(this.layer)}},{key:"rootNodeVisible",get:function(){if(e.isSome(this._index)){const W=this._index.rootNode;if(e.isSome(W))return this._updateViewData(),this._index.isNodeVisible(W.index)}return!0}},
{key:"isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},{key:"areScaleBoundsActive",get:function(){const {minScale:W,maxScale:ba}=N.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<W||0<ba)}},{key:"unloadedMemoryEstimate",get:function(){return e.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",get:function(){return e.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",
set:function(W){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=W}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const W=this.layerView.lodFactor,ba=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<W?W:1)*ba}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const W=this.layerView.view.resourceController.memoryController;
return(Math.min(W.memoryFactor,.5)-W.minQuality)/(.5-W.minQuality)}},{key:"test",get:function(){const W=this;return{index:this._index,set disableUpdates(ba){(W._updatesDisabled=ba)?W.cancelNodeLoading():W.requestUpdate()},set disableIDBCache(ba){W.disableIDBCache=ba},set ignoreServiceObb(ba){e.isSome(W._index)&&(W._index.ignoreServiceObb=ba)},shouldLoadNode:ba=>W._shouldLoadNode(ba)}}}]);return V}(b.EsriPromiseMixin(f));u.__decorate([l.property({readOnly:!0})],f.prototype,"isMeshPyramid",null);u.__decorate([l.property({readOnly:!0})],
f.prototype,"isGraphics3D",null);u.__decorate([l.property({readOnly:!0})],f.prototype,"indexStreamController",null);u.__decorate([l.property({readOnly:!0})],f.prototype,"dataStreamController",null);u.__decorate([l.property({readOnly:!0})],f.prototype,"crsVertex",null);u.__decorate([l.property({readOnly:!0})],f.prototype,"crsIndex",null);u.__decorate([l.property()],f.prototype,"screenSizeFactor",void 0);u.__decorate([l.property()],f.prototype,"featureTarget",void 0);u.__decorate([l.property()],f.prototype,
"fixedFeatureTarget",void 0);u.__decorate([l.property()],f.prototype,"layerView",void 0);u.__decorate([l.property()],f.prototype,"layer",void 0);u.__decorate([l.property({})],f.prototype,"updating",void 0);u.__decorate([l.property({})],f.prototype,"updatingProgress",void 0);u.__decorate([l.property({readOnly:!0})],f.prototype,"leavesReached",void 0);u.__decorate([l.property({constructOnly:!0})],f.prototype,"scaleVisibilityEnabled",void 0);u.__decorate([l.property({readOnly:!0,dependsOn:[]})],f.prototype,
"rootNodeVisible",null);f=u.__decorate([r.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],f);const J=new n({deallocator:null});let M;const O={factorIM:.2,factor3dObject:.05,distancePenalty:10},Q=g.create();return f})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../support/Scheduler"],function(a,u,f,p){let t=function(){function e(b){this.referenceCount=0;this.callbacks=[];
this.runIndex=0;this.handle=b.registerTask(p.TaskPriority.I3S_CONTROLLER,this)}var n=e.prototype;n.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};n.runTask=function(b){this.sort();const h=this.callbacks,k={numIndexLoading:0,numNodesLoading:0};for(let l=0;l<h.length&&!b.done;++l)h[l].priority=h[l].update(b,k),this.runIndex=l};n.sort=function(){const b=this.callbacks;let h=b.length;for(let k=this.runIndex;0<k;k--){const l=b[k-1];let m=k;for(;m<b.length&&l.priority<=b[m].priority&&
(m!==h||l.priority<b[m].priority);)b[m-1]=b[m],m++;b[m-1]=l;h=m-1}this.runIndex=0};n.add=function(b){this.sort();b.priority=Infinity;this.callbacks.unshift(b)};n.remove=function(b){f.removeUnordered(this.callbacks,b);this.runIndex=this.callbacks.length;this.sort()};u._createClass(e,[{key:"running",get:function(){for(const b of this.callbacks)if(b.needsUpdate())return!0;return!1}}]);return e}();const w=new Map;a.addTask=function(e,n){let b=w.get(e);null==b&&(b=new t(e),w.set(e,b));b.add(n);return{remove:()=>
{null!=b&&(b.remove(n),0<b.callbacks.length||(w.delete(e),b.destroy()),b=null)}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),function(a,u,f,p,t,w,e,n,b,h){function k(x){f.isSome(x.node)&&
(x.node.renderMbs[3]=-1,f.isSome(x.node.serviceObbInRenderSR)&&(x.node.serviceObbInRenderSR.halfSize[0]=-1));f.isSome(x.ref)&&(x.ref.renderMbs[3]=-1,f.isSome(x.ref.serviceObbInRenderSR)&&(x.ref.serviceObbInRenderSR.halfSize[0]=-1))}function l(x,D){return 0===D?0:x/D|0}function m(x,D){return 0===D?x:x%D}function z(x){if(x)for(let D=0;D<x.length;D++)for(const C of q)if(C[0]===x[D].metricType)return{lodMetric:C[1],maxError:x[D].maxError};return{lodMetric:0,maxError:0}}function r(x){return Math.sqrt(4/
Math.PI*x)}let c=function(x,D,C,B,v){this.childOffset=x;this.childCount=D;this.visibilityCache=C;this.ref=B;this.node=v;this.useAsHole=0;this.filterImpact=2},d=function(){function x(C,B,v,E,F,L,N,I,G,K,H,J,M,O){this.streamDataController=v;this.viewportQueries=E;this.logger=F;this.holeFilling=L;this._isLoaded=N;this._isReloading=I;this._isSelected=G;this._enable=K;this._needsUpdate=H;this._canRequest=J;this._computeVisibilityObb=M;this._computeNodeFiltering=O;this._dirty=!0;this._nodePages=[];this.lodMetric=
this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=Q=>Q;this.urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=b.addWraparound(0,2);this._visibilityCacheVersion=b.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;
this._missing=new p({deallocator:null});this._prefetch=new p({deallocator:null});this._updates=new A;this._imModificationUncategorized=new p({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._layerHasFilter=this.layerHasModifications=!1;this.logLayer=C;C.serviceUpdateTimeStamp&&C.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${C.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this.init(B)}var D=x.prototype;
D.init=function(C){if("page"===C.type){this.urlPrefix=C.urlPrefix;this.nodesPerPage=C.pageSize;this.rootIndex=C.rootIndex;switch(C.lodMetric){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=r}this.addPage(l(this.rootIndex,this.nodesPerPage),C.rootPage)}else"node"===C.type&&(this.urlPrefix=C.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode(new n.NodeBase(C.rootNode.id,null),-1),(C=this._validateNode(C.rootNode.id,
C.rootNode))&&this.addNode(C,0))};D.loadPage=function(C){this._loading.add(C);this.streamDataController.request(this.urlPrefix+C,"json").then(B=>{this._loading.delete(C);this.addPage(C,B)}).catch(B=>{this._loading.delete(C);t.isAbortError(B)||(this._failedPages.add(C),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${C}`,B))})};D.addPage=function(C,B){for(let F=this._nodePages.length;F<C;F++)this._nodePages[F]=null;const v=[],E=[];B=B.nodes.map((F,L)=>{const N=v.length,I=F.children?
F.children.length:0;E.push(-1);for(var G=0;G<I;G++)v.push(F.children[G]);const K=`${F.index}`;G=h.clone(F.obb);const H=e.fromArray([G.center[0],G.center[1],G.center[2],w.length(G.halfSize)]),J=F.mesh&&F.mesh.attribute,M=F.mesh&&F.mesh.geometry,O=F.mesh&&F.mesh.material;F=new n.Node(K,C*this.nodesPerPage+L,H,I,0,{hasSharedResource:!1,hasFeatureData:!!M,attributes:J&&null!=J.resource?`${J.resource}`:null,geometry:M&&null!=M.resource?`${M.resource}`:null,texture:O&&null!=O.resource?`${O.resource}`:null,
geometryDefinition:M?M.definition:-1,materialDefinition:O?O.definition:-1},this.lastUpdate,this.lodMetric,this.lodConversion(F.lodThreshold),M?M.featureCount:null);F.serviceObb=G;F.visibilityObb=this._computeVisibilityObb(F);F.vertexCount=M?M.vertexCount:0;return new c(N,I,b.addWraparound(this._visibilityCacheVersion,-2),null,F)});this._nodePages[C]={nodes:B,children:v,parents:E};this.nodeCount+=B.length;this.updateParentsAndLevel()};D.updateParentsAndLevel=function(){const C=[],B=(v,E,F)=>{const L=
this.getPage(v);if(f.isSome(L)){const N=m(v,this.nodesPerPage);L.parents[N]=E;E=L.nodes[N].node;f.isSome(E)&&(E.level=F,C.push(v))}};for(B(this.rootIndex,-1,0);C.length;){const v=C.pop(),E=this.getNode(v);if(f.isSome(E))for(let F=0;F<E.childCount;F++){const L=this.getChildIndex(E,F);B(L,v,E.level+1);this._maxLevel=Math.max(this._maxLevel,E.level+1)}}};D.getPage=function(C){return this._nodePages[l(C,this.nodesPerPage)]};D.getNodeInternal=function(C){const B=this.getPage(C);return f.isNone(B)?null:
B.nodes[m(C,this.nodesPerPage)]};D.addNode=function(C,B){null!=C.children&&this.populateChildren(B,C.children);var v=this.getParent(B);v=f.isSome(v)?v.level+1:0;this._maxLevel=Math.max(this._maxLevel,C.children?v+1:v);const {lodMetric:E,maxError:F}=z(C.lodSelection),L=f.unwrap(this.getNodeInternal(B));L.node=new n.Node(C.id,B,e.fromArray(C.mbs),L.childCount,v,C.resources,C.version,E,F,C.numFeatures);C.obb&&(L.node.serviceObb=h.clone(C.obb));L.node.visibilityObb=this._computeVisibilityObb(L.node);
f.isSome(L.ref)&&(null==L.ref.mbs&&(L.ref.mbs=C.mbs),L.node.renderMbs=L.ref.renderMbs,L.node.serviceObbInRenderSR=L.ref.serviceObbInRenderSR,L.ref.visibilityObb=L.node.visibilityObb);return L.node};D.makeRefNode=function(C,B){const v=this._nodePages[0],E=v.nodes.length;v.nodes.push(new c(0,0,b.addWraparound(this._visibilityCacheVersion,-2),C,null));this.nodeCount++;v.parents.push(B);C.renderMbs[3]=-1;f.isSome(C.serviceObbInRenderSR)&&(C.serviceObbInRenderSR.halfSize[0]=-1);return E};D.populateChildren=
function(C,B){var v=f.unwrap(this.getNodeInternal(C));const E=f.unwrap(this.getPage(C));v.childOffset=E.children.length;v.childCount=B.length;for(v=0;v<B.length;v++){const F=this.makeRefNode(B[v],C);E.children.push(F)}};D.getNode=function(C){C=this.getNodeInternal(C);return f.isSome(C)?C.node:null};D.getIndexById=function(C){let B;this.forAllNodes((v,E)=>{f.isSome(v.node)&&v.node.id===C?B=E:f.isSome(v.ref)&&v.ref.id===C&&(B=E)});return B};D.getNodeById=function(C){C=this.getIndexById(C);return 0<=
C?this.getNode(C):null};D.getChildIndex=function(C,B){const v=this.getPage(C.index);if(f.isNone(v))return-1;C=v.nodes[m(C.index,this.nodesPerPage)];return v.children[C.childOffset+B]};D.getParentIndex=function(C){const B=this.getPage(C);return f.isSome(B)?B.parents[m(C,this.nodesPerPage)]:-1};D.getParent=function(C){C=this.getParentIndex(C);return 0<=C?this.getNode(C):null};D.isLeaf=function(C){C=this.getNodeInternal(C);return f.isSome(C)&&0===C.childCount};D.invalidateVisibilityCache=function(){this._visibilityCacheVersion=
b.addWraparound(this._visibilityCacheVersion,2)};D.invalidateNodeVisibilityCache=function(C){C=this.getNodeInternal(C);f.isSome(C)&&this.invalidateNodeVisibilityCacheInternal(C)};D.invalidateNodeVisibilityCacheInternal=function(C){C.visibilityCache=b.addWraparound(this._visibilityCacheVersion,-2)};D.invalidateBoundingVolumeCache=function(C){C=this.getNodeInternal(C);f.isSome(C)&&(k(C),this.invalidateNodeVisibilityCacheInternal(C))};D.invalidateGeometryVisibility=function(C){C=this.getNodeInternal(C);
f.isSome(C)&&f.isSome(C.node)&&(C.node.geometryObb=null,C.node.renderMbs[3]=-1,f.isSome(C.node.serviceObbInRenderSR)&&(C.node.serviceObbInRenderSR.halfSize[0]=-1))};D.invalidateVisibilityObbs=function(){f.isNone(this.rootNode)||this.traverse(this.rootNode,C=>{C.visibilityObb=this._computeVisibilityObb(C);C.geometryObb=null;return!0})};D.isNodeVisible=function(C){C=this.getNodeInternal(C);if(f.isNone(C)||f.isSome(C.ref)&&!C.ref.mbs)return!0;if((C.visibilityCache&-2)!==this._visibilityCacheVersion){var B=
C.node;const E=f.isSome(B)&&(f.isNone(C.ref)||f.isSome(B.visibilityObb))?B:f.isSome(C.ref)?C.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(f.isSome(B)||f.isSome(C.ref))&&2===C.filterImpact){var v=f.isSome(B)?B.mbs:f.isSome(C.ref)?C.ref.mbs:null;C.filterImpact=null!=v?this._computeNodeFiltering(v):0}v=f.isSome(B)&&1===C.filterImpact;B=!(f.isSome(B)&&2===B.imModificationImpact)&&(!E||this.viewportQueries.isNodeVisible(E))&&!v;C.visibilityCache=this._visibilityCacheVersion+(B?1:0);return B}return 1===
(C.visibilityCache&1)};D.isGeometryVisible=function(C){if(!this.isNodeVisible(C))return!1;C=this.getNodeInternal(C);return f.isSome(C)&&f.isSome(C.node)&&f.isSome(C.node.geometryObb)&&(!this.layerHasModifications||4!==C.node.imModificationImpact)?this.viewportQueries.isGeometryVisible(C.node):!0};D._traverseCoverage=function(C,B,v,E,F){C=this.getPage(C);if(!f.isNone(C)&&0!==B.childCount){var L=B.childOffset+B.childCount,N=[];for(B=B.childOffset;B<L;++B){const I=C.children[B],G=this.getNodeInternal(I);
f.isSome(G)&&f.isSome(G.node)&&this.isGeometryVisible(I)&&N.push(G)}E/=N.length;for(const I of N)C=f.unwrap(I.node).index,this._isLoaded(C)||this._isReloading(C)?(F.delta=Math.max(F.delta,v),F.coverage+=E):this._traverseCoverage(C,I,v+1,E,F)}};D.useNodeAsHole=function(C){if("off"===this.holeFilling)return!1;const B=this.getNodeInternal(C);if(f.isNone(B))return!1;if("always"===this.holeFilling)return!0;if((B.useAsHole&-2)===this._version)return 1===(B.useAsHole&1);const v={delta:0,coverage:0};this._traverseCoverage(C,
B,0,1,v);C=.5>=v.delta*v.coverage;B.useAsHole=this._version+(C?1:0);return C};D.destroy=function(){this._updates.add.prune();this._updates.update.prune()};D.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=b.addWraparound(this._version,2)};D.imModificationsChanged=function(C){this.layerHasModifications=C;this.forAllNodes(({node:B})=>{f.isSome(B)&&(B.imModificationImpact=4,B.visibilityObb=this._computeVisibilityObb(B),B.hasModifications&&this.invalidateGeometryVisibility(B.index))});
this.invalidateVisibilityCache()};D.layerFilterChanged=function(C){this._layerHasFilter=C;this.forAllNodes(B=>{f.isSome(B)&&(B.filterImpact=2,B=B.node,f.isSome(B)&&this.invalidateNodeVisibilityCache(B.index))});this.invalidateVisibilityCache()};D.update=function(C,B,v){if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(C,this._missing);g.clear();var E=!0,F=new y,L=new y,N=this._imModificationUncategorized;
N.clear();var I=new Set;this.traverseVisible((K,H,J)=>{if(f.isNone(H))H=this.entryPriority(K),Infinity===H&&(H=this.entryPriority(J)),K=l(K,this.nodesPerPage),g.set(K,Math.max(H,g.get(K)||0)),this._loading.has(K)||this._failedPages.has(K)||this._missing.push(K),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,H);else{var M=H.node;this._updateNodeFeatureEstimate(M,L);if(f.isNone(M))H=this.entryPriority(K),this._loading.has(K)||this._failedNodes.has(K)||(this._missing.push(K),g.set(K,H)),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,H);else{J=f.unwrap(this.getPage(K));if(0===this._missing.length&&0===this.nodesPerPage)for(let O=0;O<H.childCount;O++){const Q=J.children[H.childOffset+O],S=this.getNodeInternal(Q);!f.isSome(S)||S.node||this._loading.has(Q)||this._failedNodes.has(Q)||(g.set(Q,this.entryPriority(Q)),this._prefetch.push(Q))}!M.failed&&M.resources.hasFeatureData&&(I.add(M.id),this._isLoaded(K)?(F.known+=M.memory,++F.knownNodes,this._isSelected(M)?0<H.childCount&&(E=!1):(F.unremoved+=
M.memory,E=!1),this._needsUpdate(M)&&(H=this.entryPriority(K),g.set(K,H),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,H),this._updates.update.push(K))):(M.memory&&(F.known+=M.memory,++F.knownNodes),this._isSelected(M)?(0<H.childCount&&(E=!1),M.memory?(F.missing+=M.memory,F.known+=M.memory,++F.knownNodes):++F.missingNodes,0<=C.indexOf(M.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this.entryPriority(K)),this._updates.cancel=this._updates.cancel.filter(O=>O!==M.index)):
!B.done&&this._enable(M)?B.madeProgress():(H=this.entryPriority(K),g.set(K,H),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,H),this._updates.add.push(K),this.layerHasModifications&&v&&f.isSome(M)&&4===M.imModificationImpact&&N.push(K))):this._isReloading(K)&&this._updates.remove.push(K)))}}});var G=this._updates.add;0<G.length&&this.layerHasModifications&&(0<N.length&&v(N),G.filterInPlace(K=>{var H=this.getNodeInternal(K);(H=f.isNone(H)||f.isNone(H.node)||2!==H.node.imModificationImpact)||
this.invalidateNodeVisibilityCache(K);return H}));this._unloadedMemoryEstimate=F.missing-F.unremoved;3<F.knownNodes&&0<F.missingNodes&&(this._unloadedMemoryEstimate+=F.known/F.knownNodes*F.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(L);this._featureEstimate.leavesReached=E;this._missing.sort((K,H)=>K-H);this._missing.filterInPlace((K,H)=>1>H||this._missing.data[H-1]!==K);this._missing.sort((K,H)=>
g.get(K)-g.get(H));0<this._missing.length&&(this._maxUnloadedPrio=g.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(K=>g.get(K)>=this._maxUnloadedPrio).sort((K,H)=>g.get(K)-g.get(H));this._updates.update.sort((K,H)=>g.get(K)-g.get(H));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;g.clear()}};D.checkFeatureTarget=function(C,B){const v=this.viewportQueries.updateScreenSpaceErrorBias(B);let E=B,F=B,L=v,N=10;for(;N--;){const I=
new y;this._updateFeatureEstimate(E,I);if(this._computeFeatureEstimate(I)<=C){if(E>=B||0<I.missingNodes||0===N)break;L=E;E=.5*(E+F)}else F=E,E=.5*(E+L)}this._version=b.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(v);return Math.min(B,E)};D._updateFeatureEstimate=function(C,B){this._version=b.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(C);this.traverseVisible((v,E)=>this._updateNodeFeatureEstimate(f.isSome(E)&&E.node,B))};D._updateNodeFeatureEstimate=
function(C,B){f.isNone(C)||C.failed||f.isNone(C.numFeatures)||(this._isLoaded(C.index)?(B.known+=C.numFeatures,++B.knownNodes,this._isSelected(C)||(B.unremoved+=C.numFeatures)):this._isSelected(C)&&(f.isSome(C.numFeatures)?(B.missing+=C.numFeatures,B.known+=C.numFeatures,++B.knownNodes):++B.missingNodes))};D._computeFeatureEstimate=function(C){let B=C.known-C.unremoved;3<C.knownNodes&&0<C.missingNodes&&(B+=C.known/C.knownNodes*C.missingNodes);return Math.max(0,B)};D.load=function(){return this._load(this._missing)};
D.prefetch=function(){this._prefetch.sort((C,B)=>g.get(C)-g.get(B));return this._load(this._prefetch)};D._load=function(C){if(0===C.length||!this._canRequest())return!1;for(;0<C.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(C.pop()):this.loadPage(C.pop());return!0};D.isLoading=function(){return 0<this._indexMissing};D.getIndexLoading=function(){return this._loading.size};D.getIndexMissing=function(){return this._indexMissing};D.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};
D.nodeTraversalState=function(C){if(f.isNone(C))return null;let B=this._nodeTraversalState.get(C.index);if(B&&(B.version&-2)===this._version)return B;const v=this.viewportQueries.getLodLevel(C),E=this.viewportQueries.hasLOD(C);var F=!0;E?(F=this.getParentIndex(C.index),F=0<=F?(F=this._nodeTraversalState.get(F))&&v>F.lodLevel:0<v):F=0===C.childCount;if(B)return B.lodLevel=v,B.isChosen=F,B.version=this._version+1,B;B=new n.NodeTraversalState(E,F,v,this._version+1);this._nodeTraversalState.set(C.index,
B);return B};D._loadNode=function(C){this._loading.add(C);const B=f.unwrap(this.getNodeInternal(C)).ref;if(f.isNone(B))this._failedNodes.add(C);else{var v=B.id,E=this.urlPrefix+v,F=()=>{this._loading.delete(C);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(E,"json").then(L=>{F();L=this._validateNode(v,L);null!=L&&(L.obb&&this.invalidateNodeVisibilityCache(C),L=this.addNode(L,C),this.nodeTraversalState(L))},L=>{F();t.isAbortError(L)||(this.logger.error("#loadNode()",
this.logLayer,"Error loading node: "+E),this._failedNodes.add(C))})}};D._validateNode=function(C,B){if(null==B||"object"!==typeof B||B.id!==C)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${C}"`),null;if(!Array.isArray(B.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${C}.`),null;B.sharedResource&&"./shared"!==B.sharedResource.href&&"./shared/"!==B.sharedResource.href&&this.logger.warn("#validateNode()",
this.logLayer,`Invalid shared resource href on node "${C}"`);null==B.geometryData||Array.isArray(B.geometryData)&&1===B.geometryData.length&&"./geometries/0"===B.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${C}"`);null==B.attributeData||Array.isArray(B.attributeData)&&!B.attributeData.some((L,N)=>L.href!==`./attributes/f_${N}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${C}"`);B.featureData&&1<B.featureData.length&&
this.logger.warn("#validateNode()",this.logLayer,`Node ${C} has ${B.featureData.length} bundles. Only the first bundle will be loaded.`);const v=B.hasOwnProperty("obb")&&!this.ignoreServiceObb?B.obb:null,E=B.featureData&&1===B.featureData.length&&B.featureData[0].featureRange?B.featureData[0].featureRange[1]-B.featureData[0].featureRange[0]+1:null;var F=L=>{if(null==L)return null;var N=I=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${C}: ${I}`);if("number"===
typeof L.id)N(`id ${L.id} is a number instead of a string.`);else if("string"!==typeof L.id||!Array.isArray(L.mbs))return N("Missing or invalid id."),null;if(!Array.isArray(L.mbs))return N(`Invalid bounding volume on reference ${L.id}.`),null;L.href&&L.href!=="../"+L.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${C}"`);N=L.hasOwnProperty("obb")&&!this.ignoreServiceObb?L.obb:null;L=new n.NodeBase(`${L.id}`,L.mbs);L.serviceObb=N;L.visibilityObb=this._computeVisibilityObb(L);
return L};F=Array.isArray(B.children)?B.children.map(F).filter(L=>null!=L):null;return{id:C,mbs:B.mbs,obb:v,children:F,resources:{hasFeatureData:B.featureData&&0<B.featureData.length,hasSharedResource:null!=B.sharedResource,attributes:B.attributeData?C:null,texture:B.textureData&&0<B.textureData.length?C:null,geometry:null!=B.geometryData?C:null},version:"string"===typeof B.version?B.version:null,lodSelection:Array.isArray(B.lodSelection)?B.lodSelection:null,numFeatures:E}};D.resetFailedNodes=function(){this._failedNodes.clear();
this._failedPages.clear();this.forAllNodes(C=>{f.isSome(C.node)&&(C.node.failed=!1)})};D.entryPriority=function(C){var B=this.getNodeInternal(C),v=this.getParentIndex(C);if(f.isNone(B)||0>v&&null==B.node)return 0>v?Infinity:this.entryPriority(v);let E=0;B.node&&0<=v&&(v=this._nodeTraversalState.get(v),null!=v&&(E=v.lodLevel));for(v=this.progressiveLoadPenalty;0<=C;C=this.getParentIndex(C))if(this._isLoaded(C)){v=0;break}B=f.isSome(B.ref)?this.viewportQueries.distToPOI(B.ref):f.isSome(B.node)?this.viewportQueries.distToPOI(B.node):
0;return-B-E*(B+this.progressiveLoadPenalty)+v};D.traverseVisible=function(C){const B=this.getNodeInternal(this.rootIndex);f.isNone(B)?C(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,B,C)};D._traverseVisible=function(C,B,v,E){if(v.node&&0===v.childCount)this.isGeometryVisible(C)&&E(C,v,B);else if(this.isNodeVisible(C)&&(E(C,v,B),null!=v.node&&(B=this.nodeTraversalState(v.node),!B.nodeHasLOD||B.lodLevel!==this._maxLodLevel))){B=f.unwrap(this.getPage(C));for(let F=0;F<v.childCount;F++){const L=
B.children[v.childOffset+F],N=this.getNodeInternal(L);f.isSome(N)?this._traverseVisible(L,C,N,E):E(L,null,C)}}};D.traverse=function(C,B){B(C)&&this.traverseChildren(C,B)};D.traverseChildren=function(C,B){C=C.index;const v=this.getNodeInternal(C);f.isSome(v)&&this._traverseChildren(C,v,B)};D._traverseChildren=function(C,B,v){C=this.getPage(C);if(!f.isNone(C)){var E=B.childOffset+B.childCount;for(B=B.childOffset;B<E;++B){const F=C.children[B],L=this.getNodeInternal(F);f.isSome(L)&&f.isSome(L.node)&&
v(L.node)&&this._traverseChildren(F,L,v)}}};D.updateStats=function(C){0<this._updates.add.length&&(C.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)C.index+=" + "+this._indexMissing||this._prefetch.length;C.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const B=this._featureEstimate.estimate-C.features;0<B?C.features+=" + "+B:0>B&&(C.features+=" - "+-B)}};D.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};
D.updateElevationInfo=function(C){this.forAllNodes(k);this.viewportQueries.updateElevationInfo(C)};D.forAllNodes=function(C){for(let B=0;B<this._nodePages.length;B++){const v=this._nodePages[B];if(v){const E=B*this.nodesPerPage;for(let F=0;F<v.nodes.length;F++)C(v.nodes[F],E+F)}}};u._createClass(x,[{key:"rootNode",get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},
{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"test",get:function(){return{addNode:(C,B)=>this.addNode(C,B)}}}]);return x}();const g=new Map;let A=function(){function x(){this.update=new p({deallocator:null});this.add=new p({deallocator:null});this.remove=new p({deallocator:null});this.cancel=[]}x.prototype.reset=function(D,C){this.add.clear();this.update.clear();this.cancel=D;this.missing=C};return x}();const q=[["maxScreenThreshold",
1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];let y=function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=d;a.selectErrorMetric=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64"],function(a,u,f){let p=function(w,e){this.id=w;this.mbs=e;this.renderMbs=f.fromArray([0,
0,0,-1]);this.imModificationImpact=4},t=function(w){function e(n,b,h,k,l,m,z,r,c,d){n=w.call(this,n,h)||this;n.index=b;n.childCount=k;n.level=l;n.resources=m;n.version=z;n.lodMetric=r;n.maxError=c;n.numFeatures=d;n.failed=!1;n.hasModifications=!1;n.cacheState=0;n.vertexCount=0;n.memory=0;return n}u._inheritsLoose(e,w);return e}(p);a.Node=t;a.NodeBase=p;a.NodeTraversalState=function(w,e,n,b){this.nodeHasLOD=w;this.isChosen=e;this.lodLevel=n;this.version=b};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray"],function(a,u,f){let p=function(){function w(n){this.layerView=n;this._lodGlobalDirty=!1}var e=w.prototype;e.startNodeLoading=function(n,b,h,k){this._maxLodLevel=k.maxLodLevel;this._index=h;this._isNodeInScaleBounds=n;this._removeNodes=b};e.shouldLoadNode=function(n){if(u.isNone(n))return!1;const b=this._index.nodeTraversalState(n);return this.isChosenMaxLOD(b)?
!0:b.isChosen?this._childrenRequireLoading(n):!1};e.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};e.lodGlobalHandling=function(n){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var b=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));t.clear();this._lodGlobalHandling(this._index.rootNode,b,!1);b=t.length;this._removeNodes(t,n);n=t.length<b;0!==t.length&&(this._lodGlobalDirty=!0);t.clear();return n};e._lodGlobalHandling=function(n,
b,h){if(u.isNone(n))return!1;const k=n.index,l=this._index,m=this.layerView;var z=l.nodeTraversalState(n);const r=this.isChosenMaxLOD(z);z=m.isNodeLoaded(k);const c=m.nodeCrossfadingEnabled;if(c&&z&&r){var d=!h&&this.hasNoVisibleChildren(n);m.fadeNode(k,0,!d)}d=z&&(!m.isNodeFullyFadedIn||m.isNodeFullyFadedIn(k));if(z&&(m.updateNodeState(k,r?1:0),r))return d&&this._removeChildrenRecursive(n),d;var g=0<n.childCount;let A=g;if(g)for(g=0;g<n.childCount;g++){const q=l.getChildIndex(n,g),y=l.getNode(q);
u.isSome(y)?l.isGeometryVisible(q)&&!this._lodGlobalHandling(y,b,h||d)&&this._isNodeInScaleBounds(y)&&(A=!1):l.isNodeVisible(q)&&(A=!1)}(b=z&&!r&&(A||t.length<b))&&t.push(k);!c||b||!z||h||A||m.fadeNode(k,0,!1);n=!n.resources.hasFeatureData;return A||d&&!b||n};e._removeChildrenRecursive=function(n){this._index.traverseChildren(n,b=>{(this.layerView.isNodeLoaded(b.index)||this.layerView.isNodeReloading(b.index))&&t.push(b.index);return!0})};e.hasNoVisibleChildren=function(n){let b=!0;this._index.traverseChildren(n,
h=>b&&this._index.isNodeVisible(h.index)?this.layerView.isNodeLoaded(h.index)?b=!1:!0:!1);return b};e._childrenRequireLoading=function(n){let b=!1,h=!0;this._index.traverseChildren(n,k=>{if(!h||!this._index.isNodeVisible(k.index))return!1;const l=this._index.nodeTraversalState(k);this.isChosenMaxLOD(l)&&this._index.isGeometryVisible(k.index)&&(b=!0);return this.layerView.isNodeLoaded(k.index)?h=!1:!0});return h&&b};e.isChosenMaxLOD=function(n){return n.isChosen&&(!n.nodeHasLOD||n.lodLevel===this._maxLodLevel)};
a._createClass(w,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return w}();const t=new f({deallocator:null});return p})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,u,f,p,t,
w,e,n,b){return function(){function h(l,m,z,r,c,d){this.streamDataController=m;this.logger=z;this.defaultGeometrySchema=r;this.requiredAttributes=c;this.options=d;this.logLayer=l;this.layerUrl=l.parsedUrl.path;this.geometryDefinitions=l.geometryDefinitions;if(l.materialDefinitions){const g=l.textureSetDefinitions;this.materialAndTextures=l.materialDefinitions.map(A=>b.getMaterialAndTextures(g,A))}}var k=h.prototype;k.load=function(l,m,z){return this.streamDataController.request(l,m,z)};k.loadAttribute=
function(l,m,z){return this.load(`${this.layerUrl}/nodes/${l.resources.attributes}/attributes/${m.key}/0`,"binary",z).then(r=>n.readBinaryAttribute(m,r))};k.loadAttributes=function(l,m,z){return w.eachAlways(m.map(r=>this.loadAttribute(l,r.attributeStorageInfo,z))).then(r=>{const c={};for(let d=0;d<m.length;++d)if(r[d].value)c[m[d].name]=r[d].value;else{if(w.isAbortError(r[d].error))throw r[d].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${m[d].name}' on node '${l.id}'`,
r[d].error)}return c})};k.loadNodeData=function(){var l=a._asyncToGenerator(function*(m,z){var r=null!=this.requiredAttributes&&m.resources.attributes?u.result(this.loadAttributes(m,this.requiredAttributes,z)):null;var c=this.geometryDefinitions;var d={bufferDefinition:null,bufferIndex:0};if(!(null==c||0>m.resources.geometryDefinition)&&(c=0<=m.resources.geometryDefinition?c[m.resources.geometryDefinition].geometryBuffers:null,null!=c))for(var g=0;g<c.length;g++){var A=c[g];if(null!=A.compressedAttributes){if("draco"===
A.compressedAttributes.encoding&&!f("disable-feature:i3s-draco")){d.bufferIndex=g;d.bufferDefinition=A;break}}else d.bufferIndex=g,d.bufferDefinition=c[g]}const {bufferDefinition:q,bufferIndex:y}=d;g=(A=!!m.resources.geometry)?u.result(this.loadGeometry(m.resources.geometry,y,z)):null;c=m.resources.hasSharedResource?yield this.loadShared(m,z):null;var x=(d=this.materialAndTextures&&0<=m.resources.materialDefinition?this.materialAndTextures[m.resources.materialDefinition]:null!=c?b.getMaterialAndTexturesFromShared(c):
null)&&d.material;d=d&&d.textures;const D=`${m.id}`,C=!A&&this.options.loadFeatureData;A=C?yield this.loadFeatureData(D,z):null;if(C)a:{for(v of A.featureData)if(x=v.geometries,null!=x)for(var B of x){var v={featureIds:[v.id],featureDataPosition:v.position,geometries:[B]};break a}v=null}else v={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:x}}],featureDataPosition:[0,0,0]};if(B=t.isNone(v)){B=[];for(var E of A.featureData)null!=E.position&&B.push({featureIds:[E.id],featureDataPosition:E.position,
geometries:null})}E=B;B=null!=d&&0<d.length?u.result(this.loadTextures(m,d,z)):null;z=m=null;g&&(m=u.assertResult(yield g),(z=this.defaultGeometrySchema)&&c&&c.materialDefinitions&&(g=Object.keys(c.materialDefinitions)[0],!c.materialDefinitions[g].params.vertexRegions&&z.vertexAttributes.region&&(z=p.clone(z),delete z.vertexAttributes.region)),z=n.createGeometryDescriptor(q,z));c=B?u.assertResult(yield B):null;r=(r=r?u.assertResult(yield r):{})?{attributeData:r,loadedAttributes:this.requiredAttributes}:
null;return t.isSome(v)?{geometryData:v,attributeDataInfo:r,geometryBuffer:m,geometryDescriptor:z,requiredTextures:d,textureData:c}:t.isSome(E)?{pointData:E,attributeDataInfo:r,geometryBuffer:m,geometryDescriptor:z,requiredTextures:d,textureData:c}:Promise.reject()});return function(m,z){return l.apply(this,arguments)}}();h.addAbsoluteHrefTexture=function(l,m){l=l.textureDefinitions;if(null!=l)for(const z of Object.keys(l))for(const r of l[z].images)Array.isArray(r.href)?r.hrefConcat=r.href.map(c=>
e.makeAbsolute(c,m)):r.hrefConcat=e.makeAbsolute(r.href,m)};h.fixTextureEncodings=function(l){l=l.textureDefinitions;if(null!=l)for(const z in l){const r=l[z];if(Array.isArray(r.encoding))for(var m=0;m<r.encoding.length;m++){const c=r.encoding[m];"data:"===c.substring(0,5)&&(r.encoding[m]=c.substring(5))}else m=r.encoding,"data:"===m.substring(0,5)&&(r.encoding=m.substring(5))}};k.loadShared=function(l,m){const z=`${this.layerUrl}/nodes/${l.resources.geometry}/shared`;return this.load(z,"json",m).then(r=>
{h.fixTextureEncodings(r);h.addAbsoluteHrefTexture(r,z);return r})};k.loadTexture=function(l,m,z,r,c,d){let g=!1;return 4===c||1===c||2===c?this.load(l,"binary",d).then(A=>({id:m,usage:z,data:A,encoding:c,downsampled:g})):this.load(l,"image",d).then(A=>{var q=A;if(r&&4096<=A.width*A.height){q=Math.ceil(A.width/2);const y=Math.ceil(A.height/2),x=document.createElement("canvas");x.width=q;x.height=y;x.getContext("2d").drawImage(A,0,0,q,y);q=x;g=!0}return{id:m,usage:z,data:q,encoding:c,downsampled:g}})};
k.loadTextures=function(l,m,z){const r=this.options.uncompressedTextureDownsamplingEnabled,c=this.options.textureUsageMask;return Promise.all(m.map(d=>{if(0===(d.usage&c))return null;const g=b.selectEncoding(d.encodings,this.options.textureEncodings);return null==g?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${l.id}`),Promise.reject()):this.loadTexture(`${this.layerUrl}/nodes/${l.resources.texture||l.id}/textures/${g.name}`,d.id,d.usage,r,g.encoding,
z)}))};k.loadFeatureData=function(l,m){return this.load(`${this.layerUrl}/nodes/${l}/features/0`,"json",m)};k.loadGeometry=function(l,m,z){return this.load(`${this.layerUrl}/nodes/${l}/geometries/${m}`,"binary",z)};return h}()})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/Texture".split(" "),
function(a,u,f,p,t,w,e,n,b){function h(d){return d.sort((g,A)=>g.encoding-A.encoding)}function k(d,g,A){if(p.isNone(d)||0===A)return null;for(let q=0;q<d.length;q++){const y=d[q];if(p.isSome(y)&&0!==(y.usage&A))return g[q].id}return null}function l(d){switch(d){case 1:return b.Texture.KTX2_ENCODING;case 2:return b.Texture.BASIS_ENCODING;case 4:return b.Texture.DDS_ENCODING;case 8:return"image/png";case 16:return"image/jpeg";case 32:return"image/ktx";default:return""}}const m={ktx2:1,basis:2,dds:4,
png:8,jpg:16,"ktx-etc2":32},z={[b.Texture.KTX2_ENCODING]:2,[b.Texture.BASIS_ENCODING]:2,[b.Texture.DDS_ENCODING]:4,"image/png":8,"image/jpg":16,"image/jpeg":16,"image/ktx":32},r={s:33071,t:33071},c={s:10497,t:10497};a.configureMaterial=function(d,g,A,q,y,x){const D=x.rendererTextureUsage;var C=g.metallicRoughness.baseColorFactor;const B=f.clamp(g.metallicRoughness.baseColorFactor[3],0,1);d.baseColor=[C[0],C[1],C[2],B];d.hasParametersFromSource=!!g.hasParametersFromSource;d.usePBR=x.usePBR;d.mrrFactors=
[g.metallicRoughness.metallicFactor,g.metallicRoughness.roughnessFactor,g.hasParametersFromSource?.2:.5];d.emissiveFactor=g.emissiveFactor;d.isIntegratedMesh=x.isIntegratedMesh;d.alphaCutoff="mask"===g.alphaMode?g.alphaCutoff:e.defaultMaskAlphaCutoff;d.alphaDiscardMode="opaque"===g.alphaMode?1:"mask"===g.alphaMode?2:3;if(C=k(q,A,33&D))d.baseColorTexture=new t.RenderTexture(y,C);if(C=k(q,A,2&D))d.metallicRoughnessTexture=new t.RenderTexture(y,C);if(C=k(q,A,16&D))d.emissionTexture=new t.RenderTexture(y,
C);if(C=k(q,A,8&D))d.occlusionTexture=new t.RenderTexture(y,C);if(A=k(q,A,4&D))d.normalTexture=new t.RenderTexture(y,A);d.commonMaterialParameters.slicePlaneEnabled=x.slicePlaneEnabled;d.commonMaterialParameters.doubleSided=g.doubleSided;d.commonMaterialParameters.cullFace=g.cullFace;d.ellipsoidMode=n.getEllipsoidMode(x.viewSpatialReference)};a.createTexture=function(d,g,A,q){if(p.isNone(d)||null==d.data)return null;const y=d.data;var x=!(y instanceof HTMLImageElement)||f.isPowerOfTwo(y.width)&&f.isPowerOfTwo(y.height),
D=q.renderingContext.parameters.maxMaxAnisotropy;q=A&&!q.has(2)?1:D;x=x&&!d.downsampled&&1<q;A=A||!g.wrapTextures?r:c;D=l(d.encoding);return new b.Texture(y,{mipmap:x,maxAnisotropy:q,encoding:D,wrap:A,components:d.usage&1?"opaque"===g.alphaMode?3:4:3,noUnpackFlip:!0})};a.getMaterialAndTextures=function(d,g){const A=new Map,q=(F,L)=>{if(p.isNone(F))return-1;if(A.has(F.id))return F=A.get(F.id),F.usage|=L,F.id;const N=A.size;A.set(F.id,{id:N,usage:L});return N};var y=g.pbrMetallicRoughness;const x=y&&
y.baseColorFactor,D=g.emissiveFactor,C=null==g.normalTexture&&null==g.emissiveTexture&&null==g.occlusionTexture&&(y?null==y.metallicRoughnessTexture&&1===y.roughnessFactor&&(1===y.metallicFactor||0===y.metallicFactor):!0),B=C?w.PBRSchematicMRRValues[0]:y?y.metallicFactor:1,v=C?w.PBRSchematicMRRValues[1]:y?y.roughnessFactor:1;y={baseColorFactor:x?[x[0],x[1],x[2],x[3]]:[1,1,1,1],baseColorTextureId:q(y&&y.baseColorTexture,"mask"===g.alphaMode?33:1),metallicRoughnessTextureId:q(y&&y.metallicRoughnessTexture,
2),metallicFactor:B,roughnessFactor:v};g={alphaMode:g.alphaMode,alphaCutoff:g.alphaCutoff,doubleSided:g.doubleSided,cullFace:"none"===g.cullFace?0:"back"===g.cullFace?2:"front"===g.cullFace?1:void 0,normalTextureId:q(g.normalTexture,4),emissiveTextureId:q(g.emissiveTexture,16),occlusionTextureId:q(g.occlusionTexture,8),emissiveFactor:D?[D[0],D[1],D[2]]:[0,0,0],metallicRoughness:y,wrapTextures:!1,hasParametersFromSource:C};const E=[];A.forEach(({usage:F},L)=>{var N=p.isSome(d)&&d[L]&&d[L].formats;
N=N?h(N.map(({name:I,format:G})=>({name:I,encoding:m[G]}))):[];E.push({id:L,usage:F,encodings:N})});return{material:g,textures:E}};a.getMaterialAndTexturesFromShared=function(d){var g=d&&d.materialDefinitions?Object.keys(d.materialDefinitions)[0]:null,A=d&&d.textureDefinitions?Object.keys(d.textureDefinitions)[0]:null;g=g&&d.materialDefinitions[g];A=A&&d.textureDefinitions[A];d={alphaMode:"opaque",alphaCutoff:e.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,
occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0};if(null!=g){g=g.params;g.diffuse&&(d.metallicRoughness.baseColorFactor=[g.diffuse[0],g.diffuse[1],g.diffuse[2],1]);null!=g.doubleSided&&(d.doubleSided=g.doubleSided,d.cullFace=g.doubleSided?0:2);if("none"===g.cullFace||"front"===g.cullFace||"back"===g.cullFace)d.cullFace="none"===
g.cullFace?0:"back"===g.cullFace?2:1;g.transparency&&(d.metallicRoughness.baseColorFactor[3]=f.clamp(1-g.transparency,0,1));if(g.useVertexColorAlpha||1>d.metallicRoughness.baseColorFactor[3])d.alphaMode="blend"}g=[];if(null!=A){!A.wrap||"repeat"!==A.wrap[0]&&"repeat"!==A.wrap[1]||(d.wrapTextures=!0);let q=1;"rgba"===A.channels&&(d.alphaMode="blend",q|=32);const y=A.images[A.images.length-1],x=D=>D&&D.split("/").pop();A=Array.isArray(A.encoding)?h(A.encoding.map((D,C)=>({name:x(y.href[C]),encoding:z[D]||
0}))):[{name:x(y.href),encoding:z[A.encoding]||0}];g.push({id:0,usage:q,encodings:A});d.metallicRoughness.baseColorTextureId=0}return{material:d,textures:g}};a.getSupportedEncodings=function(d){const g=d.has(1);d=d.has(0);const A=u("disable-feature:i3s-basis")?0:3;return 24|(g?A|4:0)|(d?A:0)};a.selectEncoding=function(d,g){return d.find(A=>0!==(A.encoding&g))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports",
"../../../../../core/maybe"],function(a,u){let f=function(){function p(w,e){this._textureRep=w;this._textureId=e;this._textureRef=u.applySome(this._textureId,n=>this._textureRep.acquire(n))}var t=p.prototype;t.dispose=function(){this._textureRef=u.applySome(this._textureId,w=>{this._textureRep.release(w)})};t.bind=function(w,e,n){if(u.isSome(this._textureRef)){const b=this._textureRef.glTexture;w.bindTexture(b,e);w.setUniform2f(n,b.descriptor.width,b.descriptor.height)}};return p}();a.RenderTexture=
f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,u){a.getEllipsoidMode=function(f){return f&&u.isMars(f)?2:f&&u.isMoon(f)?3:1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],
function(a,u,f){let p=function(){function t(e,n){this.requester=e;this.apiKey=n;this.activeRequests=new Set}var w=t.prototype;w.request=function(e,n,b){const h=f.createAbortController();b=f.onAbortOrThrow(b,()=>h.abort());e=this.requester.request(e,n,{signal:h.signal,query:{token:this.apiKey}});const k={response:e,abortController:h,abortHandle:b};this.activeRequests.add(k);f.always(e,()=>{var l;k.abortController=null;null==(l=k.abortHandle)?void 0:l.remove();k.abortHandle=null;this.activeRequests.delete(k)});
return e};w.cancelAll=function(){this.activeRequests.forEach(e=>{var n,b;null==(n=e.abortController)?void 0:n.abort();e.abortController=null;null==(b=e.abortHandle)?void 0:b.remove()});this.activeRequests.clear()};u._createClass(t,[{key:"busy",get:function(){return this.requester.busy}}]);return t}();a.I3SStreamDataController=p;a.default=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z){return function(){function r(d,g,A,q,y,x,D,C={}){this.indexSR=d;this._renderCoordsHelper=g;this.extent=y;this.elevationProvider=x;this.options=C;this._frustum=e.create();this._useFrustumCulling=!1;this._poi=f.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=f.create();this._tmp2=f.create();this._tmp3=f.create();this._tmp0=f.create();this.screenspaceErrorBias=C.screenspaceErrorBias||1;this.progressiveLoadFactor=C.progressiveLoadFactor||
1;this.updateCamera(A,q);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(D);this.tmpPoint=b.makeDehydratedPoint(0,0,0,d)}var c=r.prototype;c.updateElevationInfo=function(d){null==d?this._elevationContext=null:(this._elevationContext=k.ElevationContext.fromElevationInfo(d),this._elevationContext.updateFeatureExpressionInfoContext(l.createContextWithoutExpressionSupport(l.extractExpressionInfo(d,!1))))};c.updateCamera=function(d,g){(this._useFrustumCulling=g)&&e.fromMatrix(d.viewMatrix,
d.projectionMatrix,this._frustum);this._screenSizeFactor=1/(d.perScreenPixelRatio/2);this._camPos=d.eye;this.minDistance=Infinity;this.maxDistance=0};c.setPointOfInterest=function(d){this._poi=d};c.updateScreenSpaceErrorBias=function(d){const g=this.screenspaceErrorBias;this.screenspaceErrorBias=d;return g};c.updateExtent=function(d){this.extent=d};c.getRenderMbs=function(d){const g=d.renderMbs;0>g[3]&&(p.copy(g,d.mbs),this._elevationContext&&1E5>g[3]&&(this.tmpPoint.x=g[0],this.tmpPoint.y=g[1],this.tmpPoint.z=
g[2],g[2]=h.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),t.projectBoundingSphere(g,this.indexSR,g,this.engineSR));return g};c.getVisibilityObb=function(d){if(a.isSome(d.visibilityObb))return d.visibilityObb;const g=d.serviceObb;if(!(a.isNone(g)||0>g.halfSize[0]))return d.serviceObbInRenderSR=this._computeRenderObb(g,d.serviceObbInRenderSR,d.mbs[3]),d.serviceObbInRenderSR};c._computeRenderObb=function(d,g,A){a.isNone(g)&&(g=
z.create());if(0>g.halfSize[0]){let q=0;this._elevationContext&&1E5>A&&(this.tmpPoint.x=d.center[0],this.tmpPoint.y=d.center[1],this.tmpPoint.z=d.center[2],q=h.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-d.center[2]);m.transformObb(d,this.indexSR,g,this.engineSR,q)}return g};c.isNodeVisible=function(d){const g=this.getRenderMbs(d);if(!this.isMBSinExtent(g))return!1;if(!this._useFrustumCulling)return!0;d=this.getVisibilityObb(d);
return a.isSome(d)?z.isVisible(d,this._frustum):e.intersectsSphere(this._frustum,n.wrap(g))};c.isGeometryVisible=function(d){if(!this._useFrustumCulling)return!0;const g=d.geometryObb;return a.isSome(g)?z.isVisible(g,this._frustum):this.isNodeVisible(d)};c.isMBSinExtent=function(d){return this.extent?0!==m.intersectBoundingBoxWithMbs(this.extent,d):!0};c.screenSpaceDiameterMbs=function(d,g){var A=this.getRenderMbs(d);d=Math.sqrt(u.squaredDistance(A,this._camPos));A=d-A[3];this._updateMinMaxDistance(d);
return 0>A?.5*Number.MAX_VALUE:g/A*this._screenSizeFactor};c.calcCameraDistance=function(d){return this.calcCameraDistanceToCenter(d)-this.getRenderMbs(d)[3]};c.calcCameraDistanceToCenter=function(d){d=this.getRenderMbs(d);d=u.distance(d,this._camPos);this._updateMinMaxDistance(d);return d};c.calcAngleDependentLoD=function(d){d=this.getRenderMbs(d);const g=d[3];d=(Math.abs(d[0]*(d[0]-this._camPos[0])+d[1]*(d[1]-this._camPos[1])+d[2]*(d[2]-this._camPos[2]))/u.length(d)+g)/u.distance(d,this._camPos);
return Math.min(1,d)};c.hasLOD=function(d){return 0!==d.lodMetric};c.getDistancePlanarMode=function(d,g){var A=d[0]-g[0];const q=d[1]-g[1];d=d[2]-g[2];A=A*A+q*q;g=g[3];if(A<=g*g)return Math.abs(d);g=Math.sqrt(A)-g;return Math.sqrt(d*d+g*g)};c.getDistanceGlobeMode=function(d,g){var A=u.length(g);const q=u.length(d)-A;u.scale(this._tmp0,d,u.dot(d,g)/u.squaredLength(d));var y=u.squaredDistance(g,this._tmp0),x=g[3];if(y<=x*x)return Math.abs(q);g=u.scale(this._tmp0,g,1/A);A=u.scale(this._tmp1,g,A-x*x/
2/A);y=u.subtract(this._tmp2,d,A);y=u.subtract(this._tmp2,y,u.scale(this._tmp3,g,u.dot(g,y)));A=u.add(this._tmp2,A,u.scale(this._tmp2,y,x/u.length(y)));x=u.distance(d,A);2E5<=q&&(d=u.subtract(this._tmp1,d,A),d=u.dot(d,g)/u.length(d),.08>d&&(d=1E-4),x/=d);return x};c.getDistance=function(d,g){return this.engineSR===w.getSphericalPCPF(this.engineSR)?this.getDistanceGlobeMode(d,g):this.getDistancePlanarMode(d,g)};c._updateMinMaxDistance=function(d){0<d?(this.minDistance=Math.min(this.minDistance,d),
this.maxDistance=Math.max(this.maxDistance,d)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-d))};c.getLodLevel=function(d){if(0===d.lodMetric||!d.resources.hasFeatureData)return 0;if(0===d.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this.progressiveLoadFactor){const g=this.screenspaceErrorBias;return this.evaluateLODmetric(d,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(d,g)?2:1:0}return this.evaluateLODmetric(d,this.screenspaceErrorBias)?
this.maxLodLevel:0};c.evaluateLODmetric=function(d,g){switch(d.lodMetric){case 2:{const A=this.getRenderMbs(d),q=this.getDistance(this._camPos,A),y=2*q/this._screenSizeFactor;this._updateMinMaxDistance(q+A[3]);return d.maxError*g<=y}case 1:return g=this.screenSpaceDiameterMbs(d,d.mbs[3]*g),this.options.angleDependentLoD&&(g*=this.calcAngleDependentLoD(d)),g<d.maxError;case 3:return 10>this.screenSpaceDiameterMbs(d,d.maxError)*g;case 4:return this.calcCameraDistance(d)>d.maxError*g}return!1};c.distToPOI=
function(d){d=this.getRenderMbs(d);return u.distance(d,this._poi)-d[3]};c.distCameraToPOI=function(){return u.distance(this._camPos,this._poi)};return r}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c){var d;f=d=function(g){function A(y){y=g.call(this,y)||this;y.geometry=null;y.type="clip";return y}a._inheritsLoose(A,g);var q=A.prototype;q.writeGeometry=function(y,x,D,C){if(C.layer&&C.layer.spatialReference&&!C.layer.spatialReference.equals(this.geometry.spatialReference)){if(!r.canProjectWithoutEngine(y.spatialReference,C.layer.spatialReference)){C&&C.messages&&C.messages.push(new w("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:C.layer.spatialReference,context:C}));return}const B=new c;r.projectPolygon(y,B,C.layer.spatialReference);x[D]=B.toJSON(C)}else x[D]=y.toJSON(C);delete x[D].spatialReference};q.clone=function(){return new d({geometry:t.clone(this.geometry),type:this.type})};return A}(p.JSONSupport);u.__decorate([e.property({type:c}),z.persistable()],f.prototype,"geometry",void 0);u.__decorate([m.writer(["web-scene","portal-item"],"geometry")],f.prototype,"writeGeometry",null);u.__decorate([e.property({type:["clip",
"mask","replace"],nonNullable:!0}),z.persistable()],f.prototype,"type",void 0);return f=d=u.__decorate([l.subclass("esri.layers.support.SceneModification")],f)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k,l){function m(A,q,y){const x=n.getOwnPropertyMetadata(q,y);return{type:String,read:(D,C,B)=>{D=l.read(D,C,B);if(x.type===String)return D;if("function"===typeof x.type)return new x.type({url:D})},write:{writer(D,C,B,v){if(v&&v.resources){var E=p.isNone(D)?null:"string"===typeof D?D:D.url;E=E?l.toJSON(E,{...v,verifyItemRelativeUrls:v&&v.verifyItemRelativeUrls?{writtenUrls:v.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null;var F=x.type!==String&&(!t.isMultiOriginJSONMixin(this)||
v&&v.origin&&this.originIdOf(y)>b.nameToId(v.origin));if(v&&v.portalItem&&p.isSome(E)&&!w.isAbsolute(E))if(F){{F=v.portalItem.resourceFromPath(E);const L=c(D,E,v),N=k.getResourceContentExtension(L),I=w.getPathExtension(F.path);N!==I?z(this,y,D,E,C,B,v,A):(r(this,y,F,L,v.resources.toUpdate),C[B]=E)}}else v.resources.toKeep.push({resource:v.portalItem.resourceFromPath(E)}),C[B]=E;else v&&v.portalItem&&(p.isNone(E)||p.isSome(l.itemIdFromResourceUrl(E))||w.isBlobProtocol(E)||F)?z(this,y,D,E,C,B,v,A):
C[B]=E}else C[B]="string"===typeof D?l.toJSON(D,v):D.write({},v)}}}}function z(A,q,y,x,D,C,B,v){const E=e.generateUUID();y=c(y,x,B);const F=w.join(p.get(v,"prefix"),E);v=`${F}.${k.getResourceContentExtension(y)}`;const L=B.portalItem.resourceFromPath(v);w.isBlobProtocol(x)&&B.resources.pendingOperations.push(d(x).then(N=>{L.path=`${F}.${k.getResourceContentExtension(N)}`;D[C]=L.itemRelativeUrl}).catch(()=>{}));r(A,q,L,y,B.resources.toAdd);D[C]=L.itemRelativeUrl}function r(A,q,y,x,D){D.push({resource:y,
content:x,finish:C=>{"string"===typeof A[q]?A[q]=C.url:A[q].url=C.url}})}function c(A,q,y){return"string"===typeof A?{url:q}:new Blob([JSON.stringify(A.toJSON(y))],{type:"application/json"})}function d(A){return g.apply(this,arguments)}function g(){g=f._asyncToGenerator(function*(A){const q=(yield new Promise(function(y,x){a(["../../../request"],function(D){y(Object.freeze({__proto__:null,"default":D}))},x)})).default;({data:A}=yield q(A,{responseType:"blob"}));return A});return g.apply(this,arguments)}
u.persistable=function(A){const q=p.isSome(A)&&A.origins?A.origins:[void 0];return(y,x)=>{a:if(p.isSome(A)&&"resource"===A.type)var D=m(A,y,x);else{switch(p.isSome(A)&&A.type?A.type:"other"){case "other":D={read:!0,write:!0};break a;case "url":{const {read:C,write:B}=l.persistableUrlUtils;D={read:C,write:B};break a}}D=void 0}for(const C of q){const B=h.propertyJSONMeta(y,C,x);for(const v in D)B[v]=D[v]}}};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/portal/support/resourceExtension":function(){define(["exports",
"../../core/urlUtils"],function(a,u){const f={},p=f["text/plain"],t={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const w in t)f[t[w]]=w;a.getResourceContentExtension=function(w){w instanceof Blob?w=w.type:(w=u.getPathExtension(w.url),w=t[w]||"text/plain");return f[w]||p};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../../../symbols/PointSymbol3D".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y){p=function(C){function B(E){E=C.call(this,E)||this;E.loadedGraphics=new q.LimitGraphicsMap(5E4);E.slicePlaneEnabled=!1;E._renderingInfo={symbol:new y};E._handles=new w;E._graphicsByNode=new Map;E._scaleVisibility=null;return E}a._inheritsLoose(B,C);var v=B.prototype;v.initialize=function(){this._graphicsCore=new d.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,
hasZ:!0,hasM:!1});var E=this.view.basemapTerrain;this._scaleVisibility=new g({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(L,N,I)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(L,N,I),this._graphicsCore,E);E=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});const F=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);
this._graphicsCore.setup({labeler:E,deconflictor:F,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(L,N)=>{z.diff(L,N)&&this._graphicsCore.updateLabelingInfo()})])};v.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),
this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};v.addNodeMeta=function(E,F){let L=0;const N=E.filteredIds,I=E.featureIds.map((G,K)=>{A.boundingBoxTop(K,this.collection,E.objectHandle,D);const H=c.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(D,H);K=F(K,E);let J=!1;e.isNone(N)?J=!0:L<N.length&&G===N[L]&&(J=!0,L++);return{objectId:G,uid:f.generateUID(),attributes:K,visible:J,geometry:H}});this.loadedGraphics.addMany(I);this._graphicsByNode.set(E.node.index,
I)};v.setNodeMetaAttributes=function(E,F){const L=this._graphicsByNode.get(E.node.index),N=Array(L.length);for(let I=0;I<L.length;I++){const G=L[I];G.attributes=F(I,E);N[I]=G.uid}this._graphicsCore.updateLabelingInfo(N)};v.applyFilterChange=function(E){var F=this._graphicsByNode.get(E.node.index);if(F)if(e.isNone(E.filteredIds))for(var L of F)L.visible||(L.visible=!0,x.graphic=L,x.property="visible",x.oldValue=!1,x.newValue=!0,this._graphicsCore.graphicUpdateHandler(x));else{L=0;for(const N of F)F=
N.visible,L<E.filteredIds.length&&N.objectId===E.filteredIds[L]?(N.visible=!0,L++):N.visible=!1,F!==N.visible&&(x.graphic=N,x.property="visible",x.oldValue=F,x.newValue=N.visible,this._graphicsCore.graphicUpdateHandler(x))}};v.removeNodeMeta=function(E){this.loadedGraphics.removeManyByObjectId(E.featureIds)};v.getRenderingInfo=function(){return this._renderingInfo};v.notifyGraphicGeometryChanged=function(){};v.notifyGraphicVisibilityChanged=function(){};a._createClass(B,[{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},
{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return B}(t);u.__decorate([n.property()],p.prototype,"view",void 0);u.__decorate([n.property()],p.prototype,"layer",void 0);u.__decorate([n.property()],p.prototype,"collection",void 0);u.__decorate([n.property()],p.prototype,"loadedGraphics",void 0);u.__decorate([n.property({aliasOf:"_graphicsCore.updating"})],
p.prototype,"updating",void 0);u.__decorate([n.property()],p.prototype,"slicePlaneEnabled",void 0);u.__decorate([n.property()],p.prototype,"_graphicsCore",void 0);p=u.__decorate([m.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],p);const x={graphic:null,property:null,oldValue:null,newValue:null},D=r.create();return p})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),
function(a,u,f,p,t,w){function e(h,k,l,m){h=k.getComponentAabb(l,h,n);k=k.getObjectTransform(l);for(l=0;8>l;++l)b[0]=l&1?h[0]:h[3],b[1]=l&2?h[1]:h[4],b[2]=l&4?h[2]:h[5],f.transformMat3(b,b,k.rotationScale),f.add(b,b,k.position),m[3*l]=b[0],m[3*l+1]=b[1],m[3*l+2]=b[2];return m}const n=w.create(),b=p.create();a.boundingBoxCornerPoints=e;a.boundingBoxTop=function(h,k,l,m){h=k.getComponentAabb(l,h,n);k=k.getObjectTransform(l);m[0]=0;m[1]=0;m[2]=0;for(l=0;8>l;++l)b[0]=l&1?h[0]:h[3],b[1]=l&2?h[1]:h[4],
b[2]=h[5],f.transformMat3(b,b,k.rotationScale),f.add(b,b,k.position),m[0]+=b[0],m[1]+=b[1],m[2]+=b[2];m[0]/=8;m[1]/=8;m[2]/=8;return m};a.createGetFeatureExtent=function(h,k,l){const m=new Float64Array(24);return z=>{var r=z.meta.featureExtents;if(u.isNone(r)){r=new Float64Array(6*z.meta.featureIds.length);z.meta.featureExtents=r;for(let c=0;c<r.length;c+=6)r[c]=Number.POSITIVE_INFINITY}r=new Float64Array(r.buffer,6*z.index*Float64Array.BYTES_PER_ELEMENT,6);r[0]===Number.POSITIVE_INFINITY&&(e(z.index,
l,z.meta.objectHandle,m),t.projectBuffer(m,k,0,m,h,0,8)?(w.set(r,w.NEGATIVE_INFINITY),w.expandWithBuffer(r,m,0,8)):w.set(r,w.ZERO));return r}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,u,f,p,t){f=function(n){function b(k){var l=n.call(this)||this;l._limit=k;l._all=new t.GraphicsMap;l._active=new e(u._assertThisInitialized(l));
l._pending=new Map;l._handle=l._all.on("change",m=>l._handleChanges(m));return l}u._inheritsLoose(b,n);var h=b.prototype;h.destroy=function(){this._handle.remove()};h.toArray=function(){return this._active.toArray()};h.find=function(k){return this._active.find(k)};h.forEach=function(k){this._active.forEach(k)};h.addMany=function(k){this._all.addMany(k)};h.removeManyByObjectId=function(k){this._all.removeManyByObjectId(k)};h._handleChanges=function(k){let l=k.removed;if(0<this._pending.size){l=[];
for(var m of k.removed)this._pending.delete(m.objectId)||l.push(m)}m=this._limit-this._active.length+l.length;m<k.added.length&&(this._active.removeMany(l),l=[],w.reset(1-this._limit/(this._active.length+k.added.length)),this._active.forEach(r=>{w.sample()&&(l.push(r),this._pending.set(r.objectId,r))}),m=this._limit-this._active.length+l.length);let z=k.added;if(m<k.added.length){z=[];w.reset(m/k.added.length);for(const r of k.added)w.sample()?z.push(r):this._pending.set(r.objectId,r)}k=m-z.length;
0<k&&0<this._pending.size&&(w.reset(k/this._pending.size),this._pending.forEach(r=>{w.sample()&&(z.push(r),this._pending.delete(r.objectId))}));this._active.addAndRemove(z,l)};u._createClass(b,[{key:"length",get:function(){return this._active.length}}]);return b}(f);const w=new (function(){function n(){this.percentage=1;this.last=-1;this.index=0}var b=n.prototype;b.reset=function(h){this.percentage=h;this.last=-1};b.sample=function(){const h=Math.floor(this.index*this.percentage);++this.index;if(h===
this.last)return!1;this.last=h;return!0};return n}());let e=function(){function n(h){this._parent=h;this._map=new Map}var b=n.prototype;b.forEach=function(h){this._map.forEach(k=>h(k))};b.find=function(h){let k;p.someMap(this._map,l=>h(l)?(k=l,!0):!1);return k};b.toArray=function(){return[...this._map.values()]};b.addAndRemove=function(h,k){for(const l of h)this._map.set(l.objectId,l);for(const l of k)this._map.delete(l.objectId);(0<h.length||0<k.length)&&this._parent.emit("change",{added:h,removed:k})};
b.removeMany=function(h){for(const k of h)this._map.delete(k.objectId);0<h.length&&this._parent.emit("change",{added:[],removed:h})};u._createClass(n,[{key:"length",get:function(){return this._map.size}}]);return n}();a.LimitGraphicsMap=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,u,f,p){f=function(t){function w(){var n=
t.apply(this,arguments)||this;n._map=new Map;return n}u._inheritsLoose(w,t);var e=w.prototype;e.clear=function(){if(0<this._map.size){const n=this.toArray();this._map.clear();this.emit("change",{added:[],removed:n})}};e.get=function(n){return this._map.get(n)};e.addMany=function(n){if(0!==n.length){var b=new Set;for(let h=0;h<n.length;h++){const k=n[h],l=k.objectId,m=this._map.get(l);m?(b.add(l),k!==m&&(n[h]=m),++m.refCount):(k.refCount=1,this._map.set(l,k))}n=0<b.size?n.filter(h=>!b.has(h.objectId)):
n;0<n.length&&this.emit("change",{added:n,removed:[]})}};e.removeMany=function(n){const b=[];for(const h of n){n=h.objectId;const k=this._map.get(n);null!=k&&0>=--k.refCount&&(this._map.delete(n),b.push(h))}0<b.length&&this.emit("change",{added:[],removed:b})};e.removeManyByObjectId=function(n){const b=[];for(const h of n)n=this._map.get(h),null!=n&&0>=--n.refCount&&(this._map.delete(h),b.push(n));0<b.length&&this.emit("change",{added:[],removed:b})};e.toArray=function(){return[...this._map.values()]};
e.find=function(n){let b;p.someMap(this._map,h=>n(h)?(b=h,!0):!1);return b};e.forEach=function(n){this._map.forEach(b=>n(b))};u._createClass(w,[{key:"length",get:function(){return this._map.size}}]);return w}(f);a.GraphicsMap=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection".split(" "),
function(a,u,f,p,t,w){function e(k,l){b.clear();for(var m of k){var z="clip"===m.type?2:"mask"===m.type?1:0;const c=m.geometry;k=d=>d;if(c.spatialReference){if(!w.canProjectWithoutEngine(c.spatialReference,l)){n.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}k=d=>{w.projectVectorToVector(d,c.spatialReference,h,l);return h}}else c.hasZ||(h[2]=0,k=d=>{h[0]=d[0];h[1]=d[1];return h});b.push(z);b.push(c.rings.length);for(var r of c.rings){b.push(r.length);
for(const d of r)z=k(d),b.push(z[0]),b.push(z[1]),b.push(z[2])}}b.push(3);m=new Float64Array(b.length);for(r=0;r<b.length;++r)m[r]=b.getItemAt(r);return m}const n=f.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");f=function(k){function l(z){return k.call(this,"SceneLayerWorker","process",z,{hasInitialize:!0})||this}u._inheritsLoose(l,k);var m=l.prototype;m.getTransferList=function(z){return[z.geometryBuffer]};m.setModifications=function(z,r,c){z={context:z,modifications:e(r,c),isGeodetic:c.isGeographic};
this.broadcast(z,"setModifications")};m.setLegacySchema=function(z,r){r=JSON.stringify(r);this.broadcast({context:z,jsonSchema:r},"setLegacySchema")};m.destroyContext=function(z){return this.broadcast(z,"destroyContext")};return l}(t.WorkerHandle);const b=new p({deallocator:null}),h=[0,0,0];a.I3SMeshWorkerHandle=f;a.toWasmModification=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerWorker":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/maybe","../../../core/typedArrayUtil","../../../libs/i3s/I3SModule"],function(a,u,f,p,t){function w(){w=u._asyncToGenerator(function*(q){yield c();const y=[q.geometryBuffer];return{result:l(q,y),transferList:y}});return w.apply(this,arguments)}function e(){e=u._asyncToGenerator(function*(q){var y;yield c();const x=[q.geometryBuffer];var {geometryBuffer:D}=q,C=D.byteLength;q=g._malloc(C);C=new Uint8Array(g.HEAPU8.buffer,q,C);C.set(new Uint8Array(D));D=g.dracoDecompressPointCloudData(q,
C.byteLength);g._free(q);if(0<D.error.length)throw`i3s.wasm: ${D.error}`;q=0<(null==(y=D.featureIds)?void 0:y.length)?p.slice(D.featureIds):null;y=p.slice(D.positions);q&&x.push(q.buffer);x.push(y.buffer);return{result:{positions:y,featureIds:q},transferList:x}});return e.apply(this,arguments)}function n(){n=u._asyncToGenerator(function*(q){yield c();m(q);q={buffer:q.buffer};return{result:q,transferList:[q.buffer]}});return n.apply(this,arguments)}function b(){b=u._asyncToGenerator(function*(q){yield c();
k(q)});return b.apply(this,arguments)}function h(){h=u._asyncToGenerator(function*(q){yield c();g.setLegacySchema(q.context,q.jsonSchema)});return h.apply(this,arguments)}function k(q){const y=q.modifications,x=g._malloc(8*y.length),D=new Float64Array(g.HEAPU8.buffer,x,y.length);for(let C=0;C<y.length;++C)D[C]=y[C];g.setModifications(q.context,x,y.length,q.isGeodetic);g._free(x)}function l(q,y){if(!g)return null;const {context:x,localOrigin:D,globalTrafo:C,mbs:B,obb:v,elevationOffset:E,geometryBuffer:F,
geometryDescriptor:L,indexToVertexProjector:N,vertexToRenderProjector:I}=q;var G=g._malloc(F.byteLength),K=g._malloc(33*Float64Array.BYTES_PER_ELEMENT),H=new Uint8Array(g.HEAPU8.buffer,G,F.byteLength);H.set(new Uint8Array(F));var J=new Float64Array(g.HEAPU8.buffer,K,33);r(J,D);var M=J.byteOffset+3*J.BYTES_PER_ELEMENT,O=new Float64Array(J.buffer,M);r(O,C);M+=16*J.BYTES_PER_ELEMENT;O=new Float64Array(J.buffer,M);r(O,B);M+=4*J.BYTES_PER_ELEMENT;f.isSome(v)&&(O=new Float64Array(J.buffer,M),r(O,v.center),
M+=3*J.BYTES_PER_ELEMENT,O=new Float64Array(J.buffer,M),r(O,v.halfSize),M+=3*J.BYTES_PER_ELEMENT,O=new Float64Array(J.buffer,M),r(O,v.quaternion));J={isDraco:!1,isLegacy:!1,color:q.layouts.some(S=>S.some(V=>"color"===V.name)),normal:q.needNormals&&q.layouts.some(S=>S.some(V=>"normalCompressed"===V.name)),uv0:q.layouts.some(S=>S.some(V=>"uv0"===V.name)),uvRegion:q.layouts.some(S=>S.some(V=>"uvRegion"===V.name)),featureIndex:L.featureIndex};H=g.process(x,!!q.obb,G,H.byteLength,L,J,K,E,N,I,q.normalReferenceFrame);
g._free(K);g._free(G);if(0<H.error.length)throw`i3s.wasm: ${H.error}`;if(H.discarded)return null;G=0<H.componentOffsets.length?p.slice(H.componentOffsets):null;K=0<H.featureIds.length?p.slice(H.featureIds):null;J=p.slice(H.interleavedVertedData).buffer;M=1===H.indicesType?p.slice(new Uint16Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/2)):p.slice(new Uint32Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/4));O=p.slice(H.positions);const Q=1===H.positionIndicesType?
p.slice(new Uint16Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/2)):p.slice(new Uint32Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/4));q={layout:q.layouts[0],interleavedVertexData:J,indices:M,hasColors:H.hasColors,hasModifications:H.hasModifications,positionData:{data:O,indices:Q}};K&&y.push(K.buffer);G&&y.push(G.buffer);y.push(J);y.push(M.buffer);y.push(O.buffer);y.push(Q.buffer);return{componentOffsets:G,featureIds:K,
transformedGeometry:q,obb:H.obb}}function m(q){const {context:y,buffer:x}=q;q=g._malloc(x.byteLength);const D=x.byteLength/Float64Array.BYTES_PER_ELEMENT,C=new Float64Array(g.HEAPU8.buffer,q,D),B=new Float64Array(x);C.set(B);g.filterOBBs(y,q,D);B.set(C);g._free(q)}function z(q){g&&g.destroy(q)}function r(q,y){for(let x=0;x<y.length;++x)q[x]=y[x]}function c(){if(g)return Promise.resolve();d||(d=t.get().then(q=>{g=q;d=null}));return d}let d,g;const A={transform:l,destroy:z};a.destroyContext=function(q){z(q)};
a.dracoDecompressPointCloudData=function(q){return e.apply(this,arguments)};a.filterObbsForModifications=function(q){return n.apply(this,arguments)};a.filterObbsForModificationsSync=m;a.initialize=c;a.interpretObbModificationResults=function(q){return 0===q?0:1===q?1:2===q?2:3};a.process=function(q){return w.apply(this,arguments)};a.setLegacySchema=function(q){return h.apply(this,arguments)};a.setModifications=function(q){return b.apply(this,arguments)};a.setModificationsSync=k;a.test=A;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,u,f){function p(w){return f.getAssetUrl(`esri/libs/i3s/${w}`)}let t;u.get=function(){t||(t=(new Promise(w=>(new Promise(function(e,n){a(["../../chunks/i3s"],e,n)})).then(function(e){return e.i3s}).then(({default:e})=>{const n=e({locateFile:p,onRuntimeInitialized:()=>w(n)});delete n.then}))).catch(w=>Promise.reject(w)));return t};Object.defineProperty(u,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils"],function(a){let u=function(){this.ids=new Set;this.paused=!1};return function(){function f({collection:t,forAllFeatures:w,forAllFeaturesOfNode:e}){this.highlights=[];this.collection=t;this.forAllFeatures=w;this.forAllFeaturesOfNode=e}var p=f.prototype;p.destroy=function(){this.highlights.forEach(t=>this.releaseSet(t));this.highlights=null};p.acquireSet=function(){const t=new u;this.highlights.push(t);return{set:t,
handle:{remove:()=>{this.releaseSet(t);a.removeUnordered(this.highlights,t)},pause:()=>{this.releaseSet(t);t.paused=!0},resume:()=>{t.paused=!1;this.initializeSet(t)}}}};p.setFeatureIds=function(t,w){w.forEach(e=>t.ids.add(e));this.initializeSet(t)};p.initializeSet=function(t){this.forAllFeatures((w,e,n)=>{t.ids.has(w)&&this.collection.addComponentHighlight(n.objectHandle,e);return 1})};p.releaseSet=function(t){this.forAllFeatures((w,e,n)=>{t.ids.has(w)&&this.collection.removeComponentHighlight(n.objectHandle,
e);return 1})};p.objectCreated=function(t){this.highlights.forEach(w=>{w.paused||this.forAllFeaturesOfNode(t,(e,n)=>{w.ids.has(e)&&this.collection.addComponentHighlight(t.objectHandle,n);return 1})})};p.objectDeleted=function(t){this.collection.clearHighlights(t.objectHandle)};return f}()})},"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../intl/number ../../../../layers/support/featureQueryAll".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k){const l=e.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");e=function(){function z(c,d){this.layer=c;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=b.createAbortController();this.interactiveEditingSessions=null;this._maximumNumberOfEditOVerrides=5E4;this.memCache=d.getMemCache(`${c.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this.fetchChangedObjectIds(this.pendingFetchAbortController.signal);
this.pendingFetchChangedObjectIds.then(()=>this.pendingFetchAbortController=null)}var r=z.prototype;r.destroy=function(){this.layer=null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};r.createInteractiveEditSession=function(c){this.changedObjectIds.add(c);n.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const d=this.interactiveEditingSessions,
g=new m(c,{rollback:()=>{p.remove(d,g);0===d.length&&(this.interactiveEditingSessions=null)},commit:A=>{for(const [q,y]of A)this.updateValue(c,q,y)}});d.unshift(g);return g};r.apply=function(){var c=u._asyncToGenerator(function*(d,g,A){if(!n.isNone(g)){var {loadedAttributes:q,attributeData:y}=g;if(!n.isNone(q)&&0!==q.length&&!n.isNone(y)&&(yield b.whenOrAbort(this.pendingFetchChangedObjectIds,A),0!==this.changedObjectIds.size)){g={loadedAttributes:q,attributeData:y};var x=this.getOverridesFromCache(d,
g,this.changedObjectIds),{objectIds:D,fieldNames:C}=x;A=yield this.queryOverridesFromAssociatedLayer(D,C,A);n.isNone(A)||this.processOverridesFromAssociatedLayer(d,A,C,g)}}});return function(d,g,A){return c.apply(this,arguments)}}();r.updateValue=function(c,d,g){this.changedObjectIds.add(c);this.cacheValue(c,d,g)};r.cacheValue=function(c,d,g){this.memCache.put(this.getCacheKey(c,d),g,this.memCacheValueSize(g))};r.getOverridesFromCache=function(c,{loadedAttributes:d,attributeData:g},A){const q=new Set,
y=[];for(var x of d)y[x.index]=g[x.name];g=new Set;for(x=0;x<c.length;x++){const D=c[x];if(A.has(D))for(const C of d){const B=this.fromCache(D,C.index);void 0!==B?y[C.index][x]=B:(q.add(D),g.add(C.name))}}return{objectIds:Array.from(q),fieldNames:Array.from(g)}};r.fromCache=function(c,d){const g=this.fromInteractiveEditingSession(c,d);if(void 0!==g)return g;c=this.getCacheKey(c,d);return this.memCache.get(c)};r.fromInteractiveEditingSession=function(c,d){if(!n.isNone(this.interactiveEditingSessions))for(const g of this.interactiveEditingSessions){if(g.objectId!==
c)continue;const A=g.get(d);if(void 0!==A)return A}};r.getCacheKey=function(c,d){return`${c}-${d}`};r.queryOverridesFromAssociatedLayer=function(){var c=u._asyncToGenerator(function*(d,g,A){if(0===d.length||0===g.length)return null;d=d.sort((x,D)=>x-D);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this.logMaximumObjectsExceededWarning());const q=n.unwrap(this.layer.associatedLayer),y=q.createQuery();y.where="1\x3d1";y.returnGeometry=!1;y.outFields=[q.objectIdField,
...g];y.cacheHint=!0;y.objectIds=d;g=k.getMaximumQuerySize(q);d=d.length>g?p.splitIntoChunks(d,g).map(x=>{const D=y.clone();D.objectIds=x;return t.resultOrAbort(k.queryAllJSON(q,D,{signal:A}))}):[t.resultOrAbort(k.queryAllJSON(q,y,{signal:A}))];return(yield Promise.all(d)).reduce((x,D)=>x.concat(D.ok?D.value.features:[]),[])});return function(d,g,A){return c.apply(this,arguments)}}();r.logMaximumObjectsExceededWarning=function(){let c=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${h.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const d=this.layer.portalItem;c=d&&d.loaded?c+` (${d.portal.url}/home/item.html?id=${d.id}#settings)`:c+` (${this.layer.parsedUrl.path})`;l.warn("#queryOverrides()",this.layer.title,`${c}.`)};r.processOverridesFromAssociatedLayer=function(c,d,g,{loadedAttributes:A,attributeData:q}){const y=n.unwrap(this.layer.associatedLayer).objectIdField,x=g.map(C=>q[C]),D=new Map(A.map(C=>[C.name,C.index]));A=g.map(C=>D.get(C));c=new Map(Array.from(c,(C,B)=>[C,B]));for(const C of d){d=C.attributes[y];for(let B=
0;B<g.length;B++){const v=A[B],E=c.get(d),F=C.attributes[g[B]];x[B][E]=F;this.cacheValue(d,v,F)}}};r.memCacheValueSize=function(c){return"string"===typeof c?w.estimateStringByteSize(c):w.estimateNumberByteSize()};r.fetchChangedObjectIds=function(){var c=u._asyncToGenerator(function*(d){var g,A,q,y=this.layer;yield y.load({signal:d});this.changedObjectIds.clear();if(!n.isNone(y.associatedLayer)&&null!=(g=y.associatedLayer.capabilities)&&null!=(A=g.operations)&&A.supportsChangeTracking){g=this.getFetchChangedObjectIdsServerGen();
if(n.isNone(g))return null;A=y.associatedLayer.layerId;d=yield t.result(f(`${y.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${A}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:A,serverGen:g}])},timeout:1E4,signal:d}));d=d.ok&&null!=(q=d.value.data)&&q.edits?n.get(d.value.data.edits[0],"objectIds","updates"):null;if(n.isSome(d))for(q=Math.min(this._maximumNumberOfEditOVerrides,d.length),q<d.length&&(this.warnMaximumChangedObjectsExceeded=
!0),d=d.sort((x,D)=>x-D),y=0;y<q;y++)this.changedObjectIds.add(d[y])}});return function(d){return c.apply(this,arguments)}}();r.getFetchChangedObjectIdsServerGen=function(){var c=this.layer;if(n.isSome(c.serviceUpdateTimeStamp)&&n.isSome(c.serviceUpdateTimeStamp.lastUpdate))return c.serviceUpdateTimeStamp.lastUpdate;c=c.associatedLayer;return n.isSome(c)&&n.isSome(c.serverGens)&&n.isSome(c.serverGens.minServerGen)?c.serverGens.minServerGen:null};u._createClass(z,[{key:"test",get:function(){const c=
this;return{changedObjectIds:Array.from(this.changedObjectIds),pendingFetchChangedObjectIds:this.pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return c._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(d){c._maximumNumberOfEditOVerrides=d}}}}]);return z}();let m=function(){function z(c,d){this.objectId=c;this.options=d;this.updates=new Map;this.state=0}var r=z.prototype;r.get=function(c){return this.updates.get(c)};r.set=function(c,d){this.isActive&&this.updates.set(c,
d)};r.rollback=function(){this.isActive&&(this.state=2,this.options.rollback())};r.commit=function(){this.isActive&&(this.state=1,this.options.commit(this.updates),this.updates.clear())};u._createClass(z,[{key:"isActive",get:function(){return 0===this.state}}]);return z}();a.I3SAttributeOverrides=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],
function(a,u,f,p){function t(){t=u._asyncToGenerator(function*(b,h,k){h=h.clone();b.capabilities.query.supportsMaxRecordCountFactor&&(h.maxRecordCountFactor=n(b));const l=w(b),m=b.capabilities.query.supportsPagination;h.start=0;h.num=l;let z=null;for(;;){const r=yield b.source.queryFeaturesJSON(h,k);f.isNone(z)?z=r:z.features=z.features.concat(r.features);z.exceededTransferLimit=r.exceededTransferLimit;if(!m||!r.exceededTransferLimit)break;h.start+=l}return z});return t.apply(this,arguments)}function w(b){return n(b)*
e(b)}function e(b){return b.capabilities.query.maxRecordCount||2E3}function n(b){return b.capabilities.query.supportsMaxRecordCountFactor?p.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=n;a.getMaximumQuerySize=w;a.getMaximumRecordCount=e;a.queryAllJSON=function(b,h,k){return t.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"../../../../core/scheduling"],function(a,u,f,p){let t=function(){function w(n){this.view=n;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var e=w.prototype;e.stopNodeFading=function(n){null!=n.lodCrossfadeProgress&&(this._numFadingNodes--,n.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=f.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};
e._startNodeFading=function(n,b,h){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=p.addFrameTask({preRender:k=>this._updateAllNodeFading(k)}),this.view.notifyLODUpdate());null==n.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());n.lodCrossfadeSignedDuration=h;n.lodCrossfadeProgress=b};e._updateAllNodeFading=function(n){const b=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((h,k)=>{if(f.isSome(k)&&f.isSome(k.lodCrossfadeProgress)){const l=k.lodCrossfadeSignedDuration,
m=k.lodCrossfadeProgress+Math.abs(n.deltaTime/l),z=!b||1<=m||0===l,r=(0<l?this.view.fullOpacity:0)-(z?0:0<l?1:-1)*(1-m);z?(this.stopNodeFading(k),0>l&&this.view.markNodeToRemove(h)):k.lodCrossfadeProgress=m;this.view.setNodeOpacityByIndex(h,r)}});this.view.removeMarkedNodes()};e.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((n,b)=>{f.isSome(b)&&f.isSome(b.lodCrossfadeProgress)&&(this.stopNodeFading(b),b=b.lodCrossfadeSignedDuration,0>b&&this.view.markNodeToRemove(n),this.view.setNodeOpacityByIndex(n,
0<b?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};e.fadeNode=function(n,b,h,k){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var l=this.view;const m=l.nodeCrossfadingEnabled,z=0===h?l.fullOpacity:0;k=m?k?0===h?l.lodCrossfadeinDuration:l.lodCrossfadeoutDuration:l.lodCrossfadeUncoveredDuration:0;l=this.view.getNodeOpacityByIndex(n);m&&l!==z&&0<k?this._startNodeFading(b,1-Math.abs(z-l),(0===h?1:-1)*k):(this.stopNodeFading(b),this.view.setNodeOpacityByIndex(n,
z),1===h&&this.view.removeNode(n))};e.isNodeFullyFadedIn=function(n){const b=this.view.getNodeCrossfadeMetaData(n);return f.isSome(b)&&null==b.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(n)===this.view.fullOpacity};u._createClass(w,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return w}();a.I3SCrossfadeHelper=t;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=c.empty(),A=m.create(),q=r.create(),y=r.create(),x=r.create(),D=t.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");f=function(C){function B(E){E=C.call(this,E)||this;E.tmpEvent={spatialReference:null,extent:g,context:"scene"};return E}a._inheritsLoose(B,C);var v=B.prototype;v.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new d.Intersector(this.view.state.viewingMode);
this.intersector.options.store=0;const E=this.layerView.i3slayer.fullExtent;this.zmin=E.zmin;this.zmax=E.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};v.getElevation=function(E,F,L,N){q[0]=E;q[1]=F;q[2]=L;if(!this.renderCoordsHelper.toRenderCoords(q,N,q))return D.error("could not project point to compute elevation"),null;E=this.layerView.elevationOffset;F=this.zmin+E;this.renderCoordsHelper.setAltitude(y,this.zmax+E,q);this.renderCoordsHelper.setAltitude(x,F,q);this.intersector.reset(y,
x);this.intersectionHandler.intersect(this.intersector,null,y,x);return this.intersector.results.min.getIntersectionPoint(q)?this.renderCoordsHelper.getAltitude(q):null};v.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};v.objectChanged=function(E){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(E),this.tmpEvent.spatialReference=this.spatialReference,
this.emit("elevation-change",this.tmpEvent))};v.computeObjectExtent=function(E){c.empty(g);this._expandExtent(E,g);return g};v.computeLayerExtent=function(){c.empty(g);for(const E of this.layerView.getVisibleNodes())this._expandExtent(E,g);return g};v._expandExtent=function(E,F){var L=E.visibilityObb||E.serviceObbInRenderSR;if(w.isSome(L))for(l.fromQuat(A,L.quaternion),A[12]=L.center[0],A[13]=L.center[1],A[14]=L.center[2],E=0;8>E;++E)q[0]=E&1?L.halfSize[0]:-L.halfSize[0],q[1]=E&2?L.halfSize[1]:-L.halfSize[1],
q[2]=E&4?L.halfSize[2]:-L.halfSize[2],z.transformMat4(q,q,A),this.renderCoordsHelper.fromRenderCoords(q,q,this.spatialReference),c.expand(F,q);else{var N=E.renderMbs[3];L=z.copy(y,E.renderMbs);L[0]-=N;L[1]-=N;L[2]-=N;E=z.copy(x,E.renderMbs);E[0]+=N;E[1]+=N;E[2]+=N;for(N=0;8>N;++N)q[0]=N&1?L[0]:E[0],q[1]=N&2?L[1]:E[1],q[2]=N&4?L[2]:E[2],this.renderCoordsHelper.fromRenderCoords(q,q,this.spatialReference),c.expand(F,q)}};return B}(p.EventedMixin(f));u.__decorate([e.property({constructOnly:!0})],f.prototype,
"layerView",void 0);u.__decorate([e.property({constructOnly:!0})],f.prototype,"intersectionHandler",void 0);u.__decorate([e.property()],f.prototype,"view",void 0);u.__decorate([e.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],f.prototype,"spatialReference",void 0);return f=u.__decorate([k.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],f)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,u,f,p,t,w,e){function n(h,k,l,m=0){m=h[3]+m;const z=k[0]-h[0],r=k[1]-h[1];h=k[2]-h[2];k=l[0];const c=l[1];l=l[2];const d=k*z+c*r+l*h;return 0<=d*d-(k*k+c*c+l*l)*(z*z+r*r+h*h-m*m)}let b=function(){function h(k){this.type="I3S";this.layerUid=k.layerUid;this.sublayerUid=k.sublayerUid;this.collection=k.collection;this.forEach=k.forEach;this.slicePlane=k.slicePlaneEnabled;this.isGround=k.isGround}h.prototype.intersect=function(k,l,m,z){const r=k.results,c=2===k.options.store,d=k.ray.direction,
g=k.tolerance;let A=x=>x,q=x=>x;const y=e.getVerticalOffsetI3S(k.verticalOffset);f.isSome(y)&&(A=x=>y.applyToMbs(x),q=x=>y.applyToObb(x));this.forEach((x,D)=>{if(f.isSome(x.geometryObb)){if(!t.intersectLine(q(x.geometryObb),m,d,g))return}else if(f.isSome(x.serviceObbInRenderSR)){if(!t.intersectLine(q(x.serviceObbInRenderSR),m,d,g))return}else if(!n(A(x.renderMbs),m,d,g))return;this.collection.intersect(D,m,z,g,y,(C,B,v,E)=>{if(0<=B&&(null==l||l(m,z,B))){var F=L=>{L.intersector=this.type;L.target=
{type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:x.index,componentIndex:C}};L.dist=B;p.copy(L.normal,v);L.triangleNr=E};this.isGround&&(null==r.ground.dist||B<r.ground.dist)&&F(r.ground);if(!k.options.isFiltered&&((null==r.min.dist||B<r.min.dist)&&F(r.min),(null==r.max.dist||B>r.max.dist)&&F(r.max),c)){const L=new w.IntersectorResult(k.ray);F(L);k.results.all.push(L)}}})})};u._createClass(h,[{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);
return h}();a.I3SIntersectionHandler=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Error","../../../../core/maybe","../../../../core/promiseUtils"],function(a,u,f,p,t){function w(b){return new Promise((h,k)=>{b.oncomplete=()=>h();b.onerror=()=>k(b.error);b.onabort=()=>k(b.error)})}function e(b){return new Promise((h,k)=>{"done"===b.readyState?null!=b.error?k(b.error):
h(b.result):(b.onsuccess=()=>h(b.result),b.onerror=()=>k(b.error))})}let n=function(){function b(k,l,m=14){this._version=m;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=k;this._storeName=l}var h=b.prototype;h.init=function(){return Promise.resolve().then(()=>{const k=indexedDB.open(this._dbName,this._version);k.onupgradeneeded=l=>{var m=k.result;const z=k.transaction,
r=m.objectStoreNames.contains(this._storeName)?z.objectStore(this._storeName):m.createObjectStore(this._storeName);m=m.objectStoreNames.contains("last_access")?z.objectStore("last_access"):m.createObjectStore("last_access");m.indexNames.contains("date")||m.createIndex("date","date",{unique:!1});m.indexNames.contains("byteSize")||m.createIndex("byteSize","byteSize",{unique:!1});l.oldVersion<this._version&&(r.clear(),m.clear())};return e(k)}).then(k=>{this._destroyed?k.close():this._db=k})};h.destroy=
function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};h.getHitRate=function(){return this._hit/(this._hit+this._miss)};h.put=function(k,l){return null==this._db?Promise.reject(new f("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(k,l)).catch(m=>{if(m&&"QuotaExceededError"===m.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(z=>
this._removeLeastRecentlyAccessed(l.byteSize+Math.ceil(z*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(k,l));throw m;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(m=>this._removeLeastRecentlyAccessed(m-this.maxByteSize)))})};h.get=function(k,l){if(null==this._db)return Promise.resolve(null);
let m=null;return Promise.resolve().then(()=>{const z=this._db.transaction(this._storeName,"readonly");m=t.onAbort(l,()=>{z.abort()});const r=z.objectStore(this._storeName).get(k);return e(r)}).then(z=>{null==z?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:z.byteSize},k));p.isSome(m)&&m.remove();return z}).catch(()=>{++this._miss;t.throwIfAborted(l);p.isSome(m)&&m.remove();return null})};h.remove=function(k){var l=
this;return null==this._db?Promise.resolve():Promise.resolve().then(u._asyncToGenerator(function*(){const m=l._db.transaction([l._storeName,"last_access"],"readwrite");var z=m.objectStore(l._storeName),r=m.objectStore("last_access");z=z.delete(k);r=r.delete(k);yield Promise.all([e(z),e(r),w(m)])}))};h._put=function(k,l){const m=this._db.transaction([this._storeName,"last_access"],"readwrite");var z=m.objectStore(this._storeName);const r=m.objectStore("last_access");z=z.put(l,k);k=r.put({date:Date.now(),
byteSize:l.byteSize},k);return Promise.all([e(z),e(k),w(m)])};h._removeLeastRecentlyAccessed=function(k){if(!(0>=k)){var l=this._db.transaction([this._storeName,"last_access"],"readwrite"),m=l.objectStore(this._storeName),z=l.objectStore("last_access"),r=0,c=z.index("date").openCursor(null,"next");c.onsuccess=()=>{const d=c.result;null!=d&&(null!=d.value.byteSize&&(r+=d.value.byteSize),m.delete(d.primaryKey),z.delete(d.primaryKey),r<k&&d.continue())};return w(l)}};h._getCacheSize=function(){const k=
this._db.transaction("last_access");let l=0;const m=k.objectStore("last_access").index("byteSize").openKeyCursor();m.onsuccess=()=>{const z=m.result;if(z){var r=z.key;null!=r&&(l+=r);z.continue()}};return w(k).then(()=>l)};u._createClass(b,[{key:"initialized",get:function(){return null!=this._db}}]);return b}();a.IDBCache=n;a.whenRequest=e;a.whenTransaction=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang",
"../../../../core/maybe","../support/attributeUtils"],function(a,u,f,p){function t(h,k){const l=k.edits.updateFeatures;if(!l||0===l.length)return new b;const m=w(k),z=new b;k=new Map;for(let g=0;g<h.attributeStorageInfo.length;g++)k.set(h.attributeStorageInfo[g].name,g);const r=h.fieldsIndex,c=h.objectIdField,d=l.filter(g=>{g=p.attributeLookup(r,g.attributes,c);return m.has(g)});h.forEachNode((g,A)=>{const q=new Set(A);for(const B of d){const v=p.attributeLookup(r,B.attributes,c);if(!q.has(v))continue;
const E=A.indexOf(v);for(const F in B.attributes){var y=h.fieldsIndex.normalizeFieldName(F);var x=z;var D=g.index,C=x.get(D);C?x=C:(C=new n,x.set(D,C),x=C);(D=x.get(y))?y=D:(D=[],x.set(y,D),y=D);y.push({featureIndex:E,featureId:v,value:B.attributes[F]})}}});return z}function w(h){const k=new Set;if(!h.updatedFeatures)return k;for(const l of h.updatedFeatures)null!=l.objectId&&null==l.error&&k.add(l.objectId);return k}const e={setAttribute(){},rollback(){},commit(){}},n=Map,b=Map;a.createInteractiveEditSession=
function(h,k){const l=k.attributes[h.objectIdField];var m=h.sessions.get(l);if(m)return m;const z=u.clone(k.attributes),r=new Set;if(null==l)return e;const c=h.attributeOverrides.createInteractiveEditSession(l),d=new Map;let g=0;m={setAttribute(A,q){if(0===g){var y=h.fieldsIndex.get(A);if(!f.isNone(y)){var x=h.attributeStorageInfo.findIndex(B=>B.name===y.name);if(!(0>x)){c.set(x,q);var D=h.attributeStorageInfo[x],C=!1;r.add(A);h.forEachNode((B,v)=>{var E=d.get(B);null==E?(v=v.indexOf(l),d.set(B,v)):
v=E;if(-1!==v&&(E=h.getAttributeData(B.index))){const F=E[D.name];F&&(F[v]=q,h.setAttributeData(B.index,E,k),C=!0)}});C&&h.clearMemCache()}}}},rollback(){if(0===g){for(const A of r)this.setAttribute(A,z[A]);c.rollback();g=1;h.sessions.delete(l)}},commit(){0===g&&(c.commit(),g=2,h.sessions.delete(l))}};h.sessions.set(l,m);return m};a.processAttributeEdits=function(h,k){k=t(h,k);if(0!==k.size){var l=new Map;for(let z=0;z<h.attributeStorageInfo.length;z++)l.set(h.attributeStorageInfo[z].name,z);var m=
!1;k.forEach((z,r)=>{const c=h.getAttributeData(r);let d=!1;z.forEach((g,A)=>{const q=f.isSome(c)?c[A]:null;A=l.get(A);for(const {featureIndex:y,value:x,featureId:D}of g)q&&(q[y]=x,m=d=!0),h.attributeOverrides.updateValue(D,A,x)});d&&h.setAttributeData(r,c,null)});m&&h.clearMemCache()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/webMercatorUtils ./I3SUtil ../../../layers/support/FeatureFilter ../../../../geometry/SpatialReference".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B){function v(){return E.apply(this,arguments)}function E(){E=f._asyncToGenerator(function*(){return Q?Q:Q=yield new Promise(function(ba,ca){a(["../../../../geometry/geometryEngine"],ba,ca)})});return E.apply(this,arguments)}function F(ba,ca){if(!ba)return null;if("disjoint"===ca&&"polygon"===ba.type){const ha=Array(ba.rings.length);for(ca=0;ca<ba.rings.length;++ca){var da=y.fromValues(Infinity,Infinity,-Infinity,-Infinity);y.expandWithNestedArray(da,
ba.rings[ca]);ha[ca]={type:"polygon",rings:[ba.rings[ca]],spatialReference:ba.spatialReference,aabr:da}}ha.sort((U,Z)=>U.aabr[0]-Z.aabr[0]);const fa=new Set,R=new e.PositionHint;for(ba=0;ba<ha.length;++ba){const U=ha[ba];for(ca=ba+1;ca<ha.length;++ca){da=ha[ca];if(da.aabr[0]>=U.aabr[2])break;fa.add(da)}fa.forEach(Z=>{U!==Z&&(Z.aabr[2]<=U.aabr[0]?fa.delete(Z):Q.intersects(U,Z)&&(U.rings=U.rings.concat(Z.rings),y.expand(U.aabr,Z.aabr),delete U._geVersion,fa.delete(Z),Z=e.indexOf(ha,Z,ha.length,R),ha.splice(Z,
1)))});fa.add(U)}for(const U of ha)delete U.aabr;return ha}return[ba]}function L(ba,ca,da,ha){const fa=G(ba,da);return ca.every(R=>1!==K(R,fa,ha))}function N(ba,ca,da,ha,fa,R,U){const Z=R[0].spatialReference||ha.spatialReference;if(A.projectBoundingSphere(ca.node.mbs,fa,V,Z)){fa=G(V,Z);var T=I(U,ha,Z,da,ca.objectHandle);for(const P of R){if(0===ba.length)break;switch(K(P,fa,U)){case 1:ba.length=0;return;case 0:continue}D.filterInPlace(ba,ca.featureIds,X=>M(P,X,T))}}else O.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}
function I(ba,ca,da,ha,fa){ca=ca.renderSpatialReference;const R=new Map,U={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:da};U.rings[0][3]=U.rings[0][0];let Z,T;switch(ba){case "intersects":Z=(P,X)=>Q.intersects(P,X)?0:2;T=H;break;case "contains":Z=(P,X)=>Q.contains(P,X)?2:1;T=H;break;default:Z=(P,X)=>Q.disjoint(P,X)?2:1,T=J}return{collection:ha,object:fa,type:ba,maskSR:da,renderSR:ca,aabbCache:R,triangle:U,positions:{indices:null,data:null,stride:0,startIndex:0,
endIndex:0},triangleTest:Z,geometryTest:T}}function G(ba,ca){const da={x:ba[0],y:ba[1],hasZ:!1,hasM:!1,type:"point",spatialReference:ca};ba=ca.isWGS84||ca.isWebMercator?Q.geodesicBuffer(da,ba[3],1):Q.buffer(da,ba[3],1);ba.type="polygon";return ba}function K(ba,ca,da){switch(da){case "intersects":case "contains":return H(ba,ca);case "disjoint":return J(ba,ca)}}function H(ba,ca){return Q.intersects(ba,ca)?Q.contains(ba,ca)?0:2:1}function J(ba,ca){return Q.intersects(ba,ca)?Q.contains(ba,ca)?1:2:0}function M(ba,
ca,da){const {collection:ha,object:fa,renderSR:R,maskSR:U,geometryTest:Z,aabbCache:T}=da;var P=T.get(ca);if(!P){P=ha.getObjectTransform(fa);ha.getComponentAabb(fa,ca,W);var X=[[W[0],W[1],0],[W[0],W[4],0],[W[3],W[4],0],[W[3],W[1],0]];for(var aa=0;4>aa;++aa)d.transformMat3(X[aa],X[aa],P.rotationScale),d.add(X[aa],X[aa],P.position),A.projectVectorToVector(X[aa],R,X[aa],U);P={rings:[X],hasZ:!1,hasM:!1,type:"polygon",spatialReference:U};P.rings[0][4]=P.rings[0][0];T.set(ca,P)}switch(Z(ba,P)){case 1:return!1;
case 0:return!0}const {triangle:ja,triangleTest:ia,positions:ka}=da;P=ja.rings[0][0];X=ja.rings[0][1];aa=ja.rings[0][2];const na=ha.getObjectTransform(fa);ha.getComponentPositions(fa,ca,ka);const {indices:ta,data:pa,stride:xa,startIndex:Da,endIndex:Ka}=ka;for(ca=Da;ca<Ka;ca+=3){const Fa=xa*ta[ca+0],Ha=xa*ta[ca+1],ua=xa*ta[ca+2];d.set(P,pa[Fa+0],pa[Fa+1],pa[Fa+2]);d.set(X,pa[Ha+0],pa[Ha+1],pa[Ha+2]);d.set(aa,pa[ua+0],pa[ua+1],pa[ua+2]);d.transformMat3(P,P,na.rotationScale);d.transformMat3(X,X,na.rotationScale);
d.transformMat3(aa,aa,na.rotationScale);d.add(P,P,na.position);d.add(X,X,na.position);d.add(aa,aa,na.position);A.projectVectorToVector(P,R,P,U);A.projectVectorToVector(X,R,X,U);A.projectVectorToVector(aa,R,aa,U);if(!(Math.abs((X[0]-P[0])*(aa[1]-P[1])-(X[1]-P[1])*(aa[0]-P[0]))<Y))switch(delete ja._geVersion,ia(ba,ja)){case 1:return!1;case 0:return!0}}switch(da.type){case "intersects":return!1;default:return!0}}const O=n.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");u.I3SMeshViewFilter=function(ba){function ca(ha){ha=
ba.call(this,ha)||this;ha._projectionEngineLoaded=!1;return ha}f._inheritsLoose(ca,ba);var da=ca.prototype;da.initialize=function(){k.whenOnce(this,"filter.geometry").then(()=>this.loadAsyncModule(v().then(ha=>{this.destroyed||(this._geometryEngine=ha,this.applyFilters())})))};da.addFilters=function(ha,fa,R,U){const Z=this.sortedObjectIds;b.isSome(Z)&&ha.push(P=>D.objectIdFilter(Z,!0,P));this.addSqlFilter(ha,this.parsedWhereClause);const T=this.parsedGeometry;if(b.isSome(T)){const P=this.spatialRelationship;
ha.push((X,aa)=>N(X,aa,U,fa,R,T,P))}};da.isMBSGeoemtryVisible=function(ha,fa,R){const U=this.parsedGeometry;if(b.isSome(U)){const Z=this.spatialRelationship;fa=U[0].spatialReference||fa;return A.projectBoundingSphere(ha,R,V,fa)?L(V,U,fa,Z):(O.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0};ca.checkSupport=function(ha){if(ha.timeExtent)return O.warn("Filters with a timeExtent are not supported for mesh scene layers"),
!1;ha=ha.spatialRelationship;return null!=ha&&0<=S.indexOf(ha)?!0:(O.warn(`Filters with spatialRelationship other than ${S.join(", ")} are not supported for mesh scene layers`),!1)};f._createClass(ca,[{key:"sortedObjectIds",get:function(){if(b.isNone(this.filter.objectIds))return null;const ha=new Float64Array(this.filter.objectIds);ha.sort();return ha}},{key:"parsedWhereClause",get:function(){const ha=b.isSome(this.filter)?this.filter.where:null;if(b.isNone(ha)||!ha)return null;try{return g.WhereClause.create(ha,
this.layerFieldsIndex)}catch(fa){O.error(`Failed to parse filter where clause: ${fa}`)}return null}},{key:"parsedGeometry",get:function(){if(b.isNone(this.filter)||!this._geometryEngine)return null;var {geometry:ha}=this.filter;if(b.isNone(ha))return null;const {distance:fa,units:R}=this.filter,U=this.spatialRelationship;ha="mesh"===ha.type?ha.extent:ha;if(b.isNone(fa)||0===fa)return F(ha,U);const Z=R||h.getUnitString(ha.spatialReference);if(ha.spatialReference.isWGS84)return ha=this._geometryEngine.geodesicBuffer(ha,
fa,Z),F(ha,U);if(x.canProject(ha,B.WGS84))return ha=x.project(this._geometryEngine.geodesicBuffer(x.project(ha,B.WGS84),fa,Z),ha.spatialReference),F(ha,U);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(A.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let T=null;try{T=A.project(ha,B.WGS84)}catch(P){}if(T)try{T=A.project(this._geometryEngine.geodesicBuffer(T,fa,Z),ha.spatialReference)}catch(P){T=null}T||O.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${ha.spatialReference.wkid}) to WGS84.`);
return F(T,U)}},{key:"spatialRelationship",get:function(){return b.isSome(this.filter)?this.filter.spatialRelationship:"intersects"}}]);return ca}(w);p.__decorate([l.property({type:C})],u.I3SMeshViewFilter.prototype,"filter",void 0);p.__decorate([l.property()],u.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);p.__decorate([l.property()],u.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);p.__decorate([l.property()],u.I3SMeshViewFilter.prototype,"applyFilters",void 0);p.__decorate([l.property()],
u.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);p.__decorate([l.property({readOnly:!0})],u.I3SMeshViewFilter.prototype,"sortedObjectIds",null);p.__decorate([l.property({readOnly:!0})],u.I3SMeshViewFilter.prototype,"parsedWhereClause",null);p.__decorate([l.property({readOnly:!0})],u.I3SMeshViewFilter.prototype,"parsedGeometry",null);p.__decorate([l.property({readOnly:!0})],u.I3SMeshViewFilter.prototype,"spatialRelationship",null);p.__decorate([l.property()],u.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",
void 0);p.__decorate([l.property()],u.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);u.I3SMeshViewFilter=p.__decorate([c.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],u.I3SMeshViewFilter);let Q;const S=["contains","intersects","disjoint"],V=[0,0,0,0],Y=2**-32,W=q.create();Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d){const g=r["default"];a.I3SQueryEngine=function(A){function q(x){x=A.call(this,x)||this;x._dataQueryEngineInstance=null;x._handles=new w;return x}u._inheritsLoose(q,A);var y=q.prototype;y.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};y.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};y.executeQueryForCount=function(){var x=u._asyncToGenerator(function*(D,C){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(D),C)});return function(D,C){return x.apply(this,arguments)}}();y.executeQueryForExtent=function(){var x=u._asyncToGenerator(function*(D,C){const {count:B,extent:v}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(D),C);D=z.fromJSON(v);return{count:B,extent:D}});
return function(D,C){return x.apply(this,arguments)}}();y.executeQueryForIds=function(){var x=u._asyncToGenerator(function*(D,C){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(D),C)});return function(D,C){return x.apply(this,arguments)}}();y.executeQuery=function(){var x=u._asyncToGenerator(function*(D,C){D=this._ensureQueryJSON(D);if(D.returnGeometry)throw new t("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(D.returnCentroid)throw new t("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");C=yield this.dataQueryEngine.executeQuery(D,C);C=c.fromJSON(C);C.features.forEach(B=>{B.geometry=null});return C});return function(D,C){return x.apply(this,arguments)}}();y._ensureQueryJSON=function(x){if(e.isNone(x))return this.defaultQueryJSON;const D=x.toJSON();D.outSpatialReference||(x.outSpatialReference=this.spatialReference);return D};y.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const x=this.layer.objectIdField||"OBJECTID",D=this.layer.fields.map(v=>v.toJSON()),C=this.layerView.view.resourceController.scheduler,B=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new g({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:D,timeInfo:null,spatialReference:B,objectIdField:x,featureStore:this.spatialIndex,scheduler:C,priority:this.priority})};u._createClass(q,[{key:"defaultQueryJSON",get:function(){return(new d({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return q}(p);f.__decorate([n.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);f.__decorate([n.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);f.__decorate([n.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);f.__decorate([n.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.I3SQueryEngine.prototype,"spatialReference",
void 0);f.__decorate([n.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],a.I3SQueryEngine.prototype,"layer",void 0);f.__decorate([n.property({readOnly:!0})],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=f.__decorate([m.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);a.default=a.I3SQueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,u,f,p,t,w){let e=function(){function b(k){this.objectIdField=k.objectIdField;this.getFeatureExtent=k.getFeatureExtent}var h=b.prototype;h.getObjectId=function(k){return k.id};h.getAttributes=function(k){const {meta:l,index:m}=k,z={};this.objectIdField&&(z[this.objectIdField]=k.id);k=u.isSome(l.attributeInfo)&&l.attributeInfo.attributeData;if(u.isSome(k))for(const r of Object.keys(k))z[r]=w.getCachedAttributeValue(k[r],m);return z};h.getAttribute=function(k,l){if(l===this.objectIdField)return k.id;
const {meta:m,index:z}=k;k=u.isSome(m.attributeInfo)&&m.attributeInfo.attributeData;return u.isSome(k)?w.getCachedAttributeValue(k[l],z):null};h.getGeometry=function(k){if(k.geometry)return k.geometry;const [l,m,z,r,c]=this.getFeatureExtent(k,n);return new t([5],[l,m,z,r,m,z,r,c,z,l,c,z,l,m,z])};h.getCentroid=function(k,l){if(k.geometry)return p.getCentroidOptimizedGeometry(new t,k.geometry,l.hasZ,l.hasM);const [m,z,r,c,d,g]=this.getFeatureExtent(k,n);return new t([0],[(m+c)/2,(z+d)/2,(r+g)/2])};
h.cloneWithGeometry=function(k,l){const {id:m,index:z,meta:r}=k;return{id:m,index:z,meta:r,geometry:l}};return b}();const n=f.create();a.I3SQueryFeatureAdapter=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r){a.I3SQueryFeatureStore=function(A){function q(x){x=A.call(this,x)||this;x.events=new t;return x}u._inheritsLoose(q,A);var y=q.prototype;y.destroy=function(){};y.forEach=function(x){this.forAllFeatures(D=>{x(D);return 1})};y.forEachBounds=function(x,D,C){const B=this.getFeatureExtent;for(const v of x)D(B(v,C))};y.forEachInBounds=function(x,D){this.forAllFeatures(C=>{const B=this.getFeatureExtent(C,d);r.intersects(x,z.toRect(B,g))&&D(C);return 1},C=>{m.projectBoundingSphere(C.node.mbs,
this.sourceSpatialReference,c,this.viewSpatialReference);if(c[0]>=x[0]&&c[2]<=x[2]&&c[1]>=x[1]&&c[3]<=x[3])return 1;C=c[0]-Math.max(x[0],Math.min(c[0],x[2]));const B=c[1]-Math.max(x[1],Math.min(c[1],x[3]));return C*C+B*B<=c[3]*c[3]?1:2})};return q}(p);f.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);f.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);f.__decorate([w.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);f.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);f.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=f.__decorate([k.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const c=l.create(),d=z.create(),g=r.create();a.default=a.I3SQueryFeatureStore;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,u,f,p,t,w,e,n,b,
h,k){const l=p.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");a.DefinitionExpressionSceneLayerView=m=>{m=function(z){function r(){var d=z.apply(this,arguments)||this;d._definitionExpressionErrors=0;d._maxDefinitionExpressionErrors=20;d.logError=g=>{d._definitionExpressionErrors<d._maxDefinitionExpressionErrors&&l.error("Error while evaluating definitionExpression: "+g);d._definitionExpressionErrors++;d._definitionExpressionErrors===d._maxDefinitionExpressionErrors&&l.error("Further errors are ignored")};
return d}u._inheritsLoose(r,z);var c=r.prototype;c._evaluateClause=function(d,g){try{return d.testFeature(g)}catch(A){return this.logError(A),!1}};c._addDefinitionExpressionToQuery=function(d){if(!this.parsedDefinitionExpression)return d;const g=this.i3slayer.definitionExpression;d=d.clone();d.where=d.where?`(${g}) AND (${d.where})`:g;return d};u._createClass(r,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const d=h.WhereClause.create(this.i3slayer.definitionExpression,
this.i3slayer.fieldsIndex);if(!d.isStandardized)return l.error("definitionExpression is using non standard function"),null;const g=[];k.findFieldsCaseInsensitive(d.fieldNames,this.i3slayer.fields,{missingFields:g});if(0<g.length)return l.error(`definitionExpression references unknown fields: ${g.join(", ")}`),null;this._definitionExpressionErrors=0;return d}catch(d){return l.error("Failed to parse definitionExpression: "+d),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?
this.parsedDefinitionExpression.fieldNames:null}}]);return r}(m);f.__decorate([t.property()],m.prototype,"i3slayer",void 0);f.__decorate([t.property({readOnly:!0})],m.prototype,"parsedDefinitionExpression",null);f.__decorate([t.property({readOnly:!0})],m.prototype,"definitionExpressionFields",null);return m=f.__decorate([b.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],m)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports",
"../../../../layers/support/fieldUtils"],function(a,u){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:f,layer:{fieldsIndex:p},requiredFields:t}=this;return f.outFields?u.fixFields(p,[...u.unpackFieldNames(p,f.outFields),...t]):u.fixFields(p,t)}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m){function z(d){return r.apply(this,arguments)}function r(){r=u._asyncToGenerator(function*(d){const g=new Set;try{return yield d(g),Array.from(g).sort()}catch(A){return c.error(A),null}});return r.apply(this,arguments)}const c=w.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");a.SceneLayerViewRequiredFields=function(d){function g(A){return d.call(this,A)||this}u._inheritsLoose(g,d);g.prototype.initialize=function(){this.layer=this.layerView.layer;
this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const {fieldsIndex:A,renderer:q}=this.layer;return q?z(y=>q.collectRequiredFields(y,A)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:A}=this;return A.labelsVisible?z(q=>m.collectLabelingFields(q,A)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:A,filter:q}=this.layerView;return z(y=>m.collectFilterFields(y,A,q))})])};u._createClass(g,[{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:A},
definitionExpressionFields:q},rendererFields:y,labelingFields:x,viewFilterFields:D}=this;return m.fixFields(A,[...e.unwrapOr(q,[]),...e.unwrapOr(y,[]),...e.unwrapOr(x,[]),...e.unwrapOr(D,[])])}}]);return g}(p.AsyncUpdateMixin(t.HandleOwner));f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",
null);f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);f.__decorate([n.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=f.__decorate([l.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,u,f,p,t,w,e,n){function b(k,l){const m=()=>{if(!z||r)return l();z.clear();r=!0;const c=w.runTracked(z,l);r=!1;return c};let z=new n.SimpleTrackingTarget(()=>{z&&!r&&k(m)}),r=!1;k(m);return{remove:()=>{z&&(z.destroy(),z=null)}}}const h=k=>{k=function(l){function m(){var r=l.apply(this,arguments)||this;r.asyncUpdateState=new Map;return r}u._inheritsLoose(m,l);var z=m.prototype;z.autoUpdateAsync=function(r,c){return b(d=>this.updateAsync(r,d),c)};z.updateAsync=function(){var r=u._asyncToGenerator(function*(c,
d){if(!this.startAsyncUpdate(c)){try{const g=yield d();this._set(c,g)}catch(g){t.getLogger(this.declaredClass).warn(`Async update of "${c}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(c)&&this.updateAsync(c,d)}});return function(c,d){return r.apply(this,arguments)}}();z.startAsyncUpdate=function(r){var c;const d=null!=(c=this.asyncUpdateState.get(r))?c:0;if(d&1)return this.asyncUpdateState.set(r,d|2),!0;this.asyncUpdateState.set(r,d|1);return!1};z.endAsyncUpdate=
function(r){var c;const d=(null!=(c=this.asyncUpdateState.get(r))?c:0)&-2;if(d&2)return this.asyncUpdateState.set(r,d&-3),!0;this.asyncUpdateState.set(r,d);return!1};return m}(k);return k=f.__decorate([e.subclass("esri.core.AsyncUpdate")],k)};a.AsyncUpdate=function(k){function l(){return k.apply(this,arguments)||this}u._inheritsLoose(l,k);return l}(h(p));a.AsyncUpdate=f.__decorate([e.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=h;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/layers/SceneLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/accessorSupport/tracking ./LayerView".split(" "),function(a,u,f,p,t,w,e,n,b,h){p=function(k){function l(){var z=k.apply(this,arguments)||this;z.layer=null;z.filter=null;return z}
a._inheritsLoose(l,k);var m=l.prototype;m.highlight=function(z){throw Error("Not implemented");};m.queryFeatures=function(z,r){throw Error("Not implemented");};m.queryObjectIds=function(z,r){throw Error("Not implemented");};m.queryFeatureCount=function(z,r){throw Error("Not implemented");};m.createQuery=function(){throw Error("Not implemented");};m.queryExtent=function(z,r){throw Error("Not implemented");};a._createClass(l,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",
get:function(){return 0},set:function(z){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return l}(h);u.__decorate([f.property()],p.prototype,"layer",void 0);u.__decorate([f.property()],p.prototype,"availableFields",null);u.__decorate([f.property()],p.prototype,"maximumNumberOfFeatures",null);u.__decorate([f.property({readOnly:!0})],p.prototype,"maximumNumberOfFeaturesExceeded",null);u.__decorate([f.property()],p.prototype,"filter",void 0);return p})},
"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../renderers/support/renderingInfoUtils ../../../rest/query/operations/zscale ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SAttributeOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/FeatureFilter ../../support/Scheduler".split(" "),
function(a,u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y){function W(R){const U=R.attributeInfo;for(let Z=0;Z<R.graphics.length;Z++){const T=R.graphics[Z];T.attributes||(T.attributes={});if(w.isSome(U)&&w.isSome(U.loadedAttributes))for(const {name:P}of U.loadedAttributes)U.attributeData[P]&&(T.attributes[P]=N.getCachedAttributeValue(U.attributeData[P],Z))}}const ba=t.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");t=G.defineFieldProperties();B=function(R){function U(){var T=
R.apply(this,arguments)||this;T.type="scene-layer-graphics-3d";T._nodesAddedToStage=new Map;T.drapeSourceType=1;T._queryEngine=null;T._memCache=null;T._interactiveEditingSessions=new Map;T.loadedGraphics=new M.GraphicsMap;T.holeFilling="always";T.progressiveLoadFactor=1;T.supportsHeightUnitConversion=!0;T._coordinatesOutsideExtentErrors=0;T._maxCoordinatesOutsideExtentErrors=20;return T}u._inheritsLoose(U,R);var Z=U.prototype;Z.initialize=function(){var T;const P=this.layer;this.addResolvingPromise(P.indexInfo);
this._attributeOverrides=new L.I3SAttributeOverrides(this.layer,null==(T=this.view.resourceController)?void 0:T.memoryController);N.checkSpatialReferences(P,this.view.spatialReference,this.view.viewingMode);this.fieldsHelper=new H.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(P,"rangeInfos",X=>this._rangeInfosChanged(X),2);this.updatingHandles.add(P,"renderer",(X,aa)=>this._rendererChange(X,aa));this.updatingHandles.add(this,"parsedDefinitionExpression",()=>this._filterChange());
this.updatingHandles.add(this,"view.floors",()=>this.graphics3d.filterVisibility.filterChanged());this.handles.add(e.init(J,"I3S_TREE_SHOW_TILES",X=>{if(X&&!this._treeDebugger){const aa=this._controller.crsIndex;(new Promise(function(ja,ia){a(["./support/I3STreeDebugger"],ja,ia)})).then(({I3STreeDebugger:ja})=>{!this._treeDebugger&&J.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ja({lv:this,view:this.view,nodeSR:aa}))})}else X||!this._treeDebugger||J.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),
this._treeDebugger=null)}));this._set("graphics3d",new v({owner:this,layer:P,preferredUpdatePolicy:0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:P.fullExtent,updateClippingExtent:X=>this._updateClippingExtent(X)}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",X=>this._invalidateElevation(X));
this.supportsHeightUnitConversion&&(this._verticalScale=x.getGeometryZScaler("point",P.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(P.uid);this._controller=new q({layerView:this,scaleVisibilityEnabled:!1});N.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new C.I3SPointsWorkerHandle(X=>this.view.resourceController.schedule(X)));this.handles.add(this.layer.on("apply-edits",
X=>this.updatingHandles.addPromise(X.result)));this.handles.add(this.layer.on("edits",X=>this._handleEdits(X)));this.when(()=>{this._queryEngine=new E["default"]({layerView:this,priority:Y.TaskPriority.FEATURE_QUERY_ENGINE});this.updatingHandles.add(this,"maximumNumberOfFeatures",X=>this._controller.featureTarget=X,2);this.updatingHandles.add(this,"suspended",X=>{X&&this._removeAllNodeData()})})};Z.destroy=function(){this._treeDebugger=w.destroyMaybe(this._treeDebugger);this._attributeOverrides=w.destroyMaybe(this._attributeOverrides);
this._set("graphics3d",w.destroyMaybe(this.graphics3d));this._controller=w.destroyMaybe(this._controller);this._queryEngine=w.destroyMaybe(this._queryEngine);this._worker=w.destroyMaybe(this._worker);this._memCache=w.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this.fieldsHelper=w.destroyMaybe(this.fieldsHelper)};Z.notifyGraphicGeometryChanged=function(T){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(T)};Z.notifyGraphicVisibilityChanged=function(T){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(T)};
Z.whenGraphicAttributes=function(){var T=u._asyncToGenerator(function*(P,X){return N.whenGraphicAttributes(this.layer,P,this._getObjectIdField(),X,()=>[...this._nodesAddedToStage.values()])});return function(P,X){return T.apply(this,arguments)}}();Z.getGraphicFromGraphicUid=function(T){if(!this.loadedGraphics)return null;const P=A.hydrateGraphic(this.loadedGraphics.find(aa=>aa.uid===T),this.layer),X=this._getObjectIdField();if(!P||!P.attributes||!P.attributes[X])return null;P.layer=this.layer;P.sourceLayer=
this.layer;return P};Z.whenGraphicBounds=function(T,P){return this.graphics3d.graphicsCore.whenGraphicBounds(T,P)};Z.computeAttachmentOrigin=function(T,P){return this.graphics3d.graphicsCore.computeAttachmentOrigin(T,P)};Z.canResume=function(){return R.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};Z.isUpdating=function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};Z.getRenderingInfo=function(T,P,X){T=y.getRenderingInfo(T,
{renderer:P,arcade:X});w.isSome(T)&&T.color&&(P=T.color,P[0]/=255,P[1]/=255,P[2]/=255);return T};Z.getRenderingInfoAsync=function(){var T=u._asyncToGenerator(function*(P,X,aa,ja){return y.getRenderingInfoAsync(P,{renderer:X,arcade:aa,...ja})});return function(P,X,aa,ja){return T.apply(this,arguments)}}();Z.highlight=function(T){return this.graphics3d.highlight(T,this.layer.objectIdField)};Z.createInteractiveEditSession=function(T){return F.createInteractiveEditSession(this.attributeEditingContext,
T)};Z.extractBinaryPointData=function(){var T=u._asyncToGenerator(function*(P,X){P={geometryBuffer:P.geometryBuffer};w.isNone(this._worker)&&(this._worker=new C.I3SPointsWorkerHandle(aa=>this.view.resourceController.schedule(aa)));return this._worker.invoke(P,X).then(aa=>{if(w.isSome(aa))return{positionData:aa.positions,featureIds:aa.featureIds};throw Error("Failed to decompress Draco point data");})});return function(P,X){return T.apply(this,arguments)}}();Z.checkExtent=function(T,P){T&&!d.extentContainsCoords3D(T,
P)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&ba.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&ba.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};Z.addNode=function(){var T=u._asyncToGenerator(function*(P,X,aa){if(!("geometryBuffer"in X&&null!==X.geometryBuffer||"pointData"in X))return Promise.reject();
if(this._nodesAddedToStage.has(P.index))ba.error("I3S node "+P.id+" already added");else{var ja=this.layer.fullExtent,ia;if(ia=ja)ja=ja.clone(),ja.xmin-=.5,ja.ymin-=.5,ja.xmax+=.5,ja.ymax+=.5,ja.hasZ&&(ja.zmin-=.5,ja.zmax+=.5),ja.hasM&&(ja.mmin-=.5,ja.mmax+=.5),ia=ja;ja=ia;ia=this._controller.crsVertex;var ka=[],na={graphics:null,featureIds:null,attributeInfo:X.attributeDataInfo,node:P};"geometryBuffer"in X&&null!==X.geometryBuffer?yield this._addNodeBinaryPointData(P,na,X,ja,ka,aa):"pointData"in
X&&this._addNodeLegacyPointData(P,na,X,ja,ka);yield this._attributeOverrides.apply(na.featureIds,X.attributeDataInfo,aa);P.numFeatures=na.graphics.length;this._updateNodeMemory(P);W(na);0<ka.length&&(this.computeObb(P,ka,ia),this._controller.updateVisibility(P.index));if(!this._controller.isGeometryVisible(P))return this._cacheNodeData(na),Promise.resolve();if(this._verticalScale)for(const ta of na.graphics)this._verticalScale(ta.geometry);this._nodesAddedToStage.set(P.index,na);this.loadedGraphics.addMany(na.graphics);
this._filterNode(na);this._treeDebugger&&this._treeDebugger.update();return Promise.resolve()}});return function(P,X,aa){return T.apply(this,arguments)}}();Z.computeObb=function(T,P,X){const aa=this._controller.crsIndex,ja=aa.isGeographic?this.view.renderSpatialReference:aa;r.projectBuffer(P,X,0,P,ja,0,P.length/3);T.serviceObb=O.compute({data:P,size:3});aa.isGeographic&&r.projectVectorToVector(T.serviceObb.center,ja,T.serviceObb.center,aa)};Z.isNodeLoaded=function(T){return this._nodesAddedToStage.has(T)};
Z.isNodeReloading=function(){return!1};Z.updateNodeState=function(){};Z._addNodeBinaryPointData=function(){var T=u._asyncToGenerator(function*(P,X,aa,ja,ia,ka){var na=yield this.extractBinaryPointData(aa,ka);if(null==na)return Promise.reject();aa=this._getObjectIdField();ka=this._controller.crsVertex;const ta=this.view.spatialReference,pa=this.graphics3d.graphicsCore,{positionData:xa,featureIds:Da}=na;na=xa.length/3;const Ka=[];for(let Ea=0;Ea<na;Ea++){var Fa=w.isSome(P.serviceObb)?P.serviceObb.center:
[0,0,0],Ha=3*Ea,ua=z.fromValues(xa[Ha+0],xa[Ha+1],xa[Ha+2]);m.add(ua,ua,Fa);P.serviceObb||ia.push(ua[0],ua[1],ua[2]);ja&&this.checkExtent(ja,ua);Ha=Da[Ea];Fa={};null!=Ha&&(Fa[aa]=Ha);Ha=null==Ha?p.generateUID():Ha;r.projectBuffer(ua,ka,0,da,ta,0,1);ua=g.makeDehydratedPoint(da[0],da[1],da[2],ta);var Ba=this.loadedGraphics.get(Ha);w.isSome(Ba)?(Ba.level<P.level&&(ha.property="geometry",ha.graphic=Ba,ha.oldValue=w.unwrap(Ba.geometry),ha.newValue=ua,Ba.geometry=ua,pa.graphicUpdateHandler(ha)),Ka.push(Ba)):
(Ba=p.generateUID(),Ka.push({objectId:Ha,uid:Ba,geometry:ua,attributes:Fa,visible:!0,level:P.level}))}X.graphics=Ka;X.featureIds=Da});return function(P,X,aa,ja,ia,ka){return T.apply(this,arguments)}}();Z._addNodeLegacyPointData=function(T,P,X,aa,ja){const ia=this._getObjectIdField(),ka=this._controller.crsVertex,na=this.view.spatialReference,ta=[0,0,0],pa=[],xa=[];for(const Fa of X.pointData){X=Fa.featureDataPosition;const Ha=X.length;var Da=Fa.geometries&&Fa.geometries[0]||ca[Ha];const ua=Fa.featureIds[0];
if("points"!==Da.params.type)continue;aa&&this.checkExtent(aa,X);const Ba={};null!=ua&&(Ba[ia]=ua);const Ea=null==ua?p.generateUID():ua;let Ga;"Embedded"===Da.type&&(Ga=Da.params.vertexAttributes.position);for(Da=0;Da<Ga.length;Da+=Ha){for(var Ka=0;Ka<Ha;Ka++)ta[Ka]=X[Ka]+Ga[Da+Ka];Ka=3===Ha;T.serviceObb||ja.push(ta[0],ta[1],Ka?ta[2]:0);r.projectBuffer(ta,ka,0,da,na,0,1);Ka=g.makeDehydratedPoint(da[0],da[1],Ka?da[2]:void 0,na);const ma=this.loadedGraphics.get(Ea);w.isSome(ma)?xa.push(ma):xa.push({objectId:Ea,
uid:p.generateUID(),geometry:Ka,attributes:Ba,visible:!0})}pa.push(ua)}P.graphics=xa;P.featureIds=pa};Z._updateNodeMemory=function(T){T.memory=4096+(w.isSome(T.numFeatures)?T.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)};Z._cacheNodeData=function(T){const P=T.graphics.reduce((X,aa)=>g.estimateSize(aa)+X,8*T.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(T.node),T,P)};Z._getMemCacheKey=function(T){return`${T.index}`};Z._removeAllNodeData=function(){this._nodesAddedToStage.forEach(T=>
{T&&(this._updateNodeMemory(T.node),this._cacheNodeData(T))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};Z.removeNode=function(T){if(T=this._removeNodeStageData(T))this._updateNodeMemory(T.node),this._cacheNodeData(T)};Z._removeNodeStageData=function(T){const P=this._nodesAddedToStage.get(T);if(!P)return null;this.loadedGraphics.removeMany(P.graphics);this._nodesAddedToStage.delete(T);this._treeDebugger&&this._treeDebugger.update();
return P};Z.loadCachedNodeData=function(){var T=u._asyncToGenerator(function*(P){return this._memCache.pop(this._getMemCacheKey(P))});return function(P){return T.apply(this,arguments)}}();Z.addCachedNodeData=function(){var T=u._asyncToGenerator(function*(P,X,aa,ja){if(this._nodesAddedToStage.has(P.index))ba.error("I3S node "+P.id+" already added");else return this.loadedGraphics.addMany(X.graphics),this._nodesAddedToStage.set(P.index,X),this._updateNodeMemory(P),yield this.updateAttributes(P.index,
aa,ja),this._filterNode(X),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()});return function(P,X,aa,ja){return T.apply(this,arguments)}}();Z.getLoadedNodeIds=function(){const T=[];this._nodesAddedToStage.forEach(P=>T.push(P.node.id));return T.sort()};Z.getVisibleNodes=function(){const T=[];this._nodesAddedToStage.forEach(P=>T.push(P.node));return T};Z.getLoadedNodeIndices=function(T){this._nodesAddedToStage.forEach((P,X)=>T.push(X))};Z.getLoadedAttributes=function(T){if((T=this._nodesAddedToStage.get(T))&&
w.isSome(T.attributeInfo))return T.attributeInfo.loadedAttributes};Z.getAttributeData=function(T){if((T=this._nodesAddedToStage.get(T))&&w.isSome(T.attributeInfo))return T.attributeInfo.attributeData};Z.setAttributeData=function(T,P){(T=this._nodesAddedToStage.get(T))&&!w.isNone(T.attributeInfo)&&(T.attributeInfo.attributeData=P,this._attributeValuesChanged(T))};Z.updateAttributes=function(){var T=u._asyncToGenerator(function*(P,X,aa){if(P=this._nodesAddedToStage.get(P))yield this._attributeOverrides.apply(P.featureIds,
X,aa),P.attributeInfo=X,this._attributeValuesChanged(P)});return function(P,X,aa){return T.apply(this,arguments)}}();Z._attributeValuesChanged=function(T){W(T);this._filterNode(T);this.graphics3d.graphicsCore.labelsEnabled&&(T=T.graphics.map(P=>P.uid),this.graphics3d.graphicsCore.updateLabelingInfo(T))};Z._updateClippingExtent=function(T){this._controller&&this._controller.updateClippingArea(T);return!1};Z._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};Z._rendererChange=
function(){var T=u._asyncToGenerator(function*(P,X){const {layer:{fieldsIndex:aa}}=this,ja=new Set;let ia;P?(yield P.collectRequiredFields(ja,aa),ia=Array.from(ja).sort()):ia=[];ja.clear();let ka;X?(yield X.collectRequiredFields(ja,aa),ka=Array.from(ja).sort()):ka=[];ia.length===ka.length&&ia.every((na,ta)=>ia[ta]===ka[ta])||this._reloadAllNodes()});return function(P,X){return T.apply(this,arguments)}}();Z._rangeInfosChanged=function(T){null!=T&&0<T.length&&ba.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
Z._filterChange=function(){this._nodesAddedToStage.forEach(T=>this._filterNode(T))};Z._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};Z._filterNode=function(T){const P=this.parsedDefinitionExpression;for(const X of T.graphics)T=X.visible,X.visible=P?this._evaluateClause(P,X):!0,T!==X.visible&&(ha.graphic=X,ha.property="visible",ha.oldValue=T,ha.newValue=X.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(ha))};Z._invalidateElevation=
function(T){const P=this._controller.crsIndex;r.projectBoundingRect(T.extent,T.spatialReference,fa,P);this._controller.updateElevationChanged(fa,P)};Z.createQuery=function(){const T={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return w.isSome(this.filter)?this.filter.createQuery(T):new D(T)};Z.queryFeatures=function(T,P){return this._queryEngine.executeQuery(this._ensureQuery(T),null==P?void 0:P.signal)};Z.queryObjectIds=function(T,P){return this._queryEngine.executeQueryForIds(this._ensureQuery(T),
null==P?void 0:P.signal)};Z.queryFeatureCount=function(T,P){return this._queryEngine.executeQueryForCount(this._ensureQuery(T),null==P?void 0:P.signal)};Z.queryExtent=function(T,P){return this._queryEngine.executeQueryForExtent(this._ensureQuery(T),null==P?void 0:P.signal)};Z._ensureQuery=function(T){return this._addDefinitionExpressionToQuery(w.isNone(T)?this.createQuery():D.from(T))};Z.getUsedMemory=function(){const T=this.graphics3d&&this.graphics3d.graphicsCore;return T?T.usedMemory:0};Z.getUnloadedMemory=
function(){const T=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(T?T.unprocessedMemoryEstimate:0))};Z.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};Z._handleEdits=function(T){F.processAttributeEdits(this.attributeEditingContext,T)};u._createClass(U,[{key:"requiredFields",get:function(){var T,P;return null!=(T=null==(P=this.fieldsHelper)?void 0:P.requiredFields)?T:[]}},{key:"maximumNumberOfFeatures",
get:function(){const T=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return T?T.maximumNumberOfFeatures:0},set:function(T){null!=T?(this._override("maximumNumberOfFeatures",T),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leavesReached}},{key:"hasM",
get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"updatePolicy",get:function(){return this.graphics3d.graphicsCore.effectiveUpdatePolicy}},{key:"attributeEditingContext",get:function(){const T=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:T,forEachNode:P=>this._nodesAddedToStage.forEach(X=>P(X.node,X.featureIds)),
attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:P=>this.getAttributeData(P),setAttributeData:(P,X,aa)=>{this.setAttributeData(P,X);P=this._nodesAddedToStage.get(P);w.isSome(aa)?(aa=this.loadedGraphics.get(aa.attributes[T]),w.isSome(aa)&&this.graphics3d.graphicsCore.recreateGraphics([aa])):w.isSome(P)&&this.graphics3d.graphicsCore.recreateGraphics(P.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const T=
{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(T);return T}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}}]);return U}(I.DefinitionExpressionSceneLayerView(K.PopupSceneLayerView(B.LayerView3D(S))));
f.__decorate([n.property()],B.prototype,"graphics3d",void 0);f.__decorate([n.property({type:V})],B.prototype,"filter",void 0);f.__decorate([n.property()],B.prototype,"loadedGraphics",void 0);f.__decorate([n.property({aliasOf:"layer"})],B.prototype,"i3slayer",void 0);f.__decorate([n.property()],B.prototype,"_controller",void 0);f.__decorate([n.property()],B.prototype,"updating",void 0);f.__decorate([n.property()],B.prototype,"suspended",void 0);f.__decorate([n.property()],B.prototype,"holeFilling",
void 0);f.__decorate([n.property(Q.updatingProgress)],B.prototype,"updatingProgress",void 0);f.__decorate([n.property({aliasOf:"_controller.updatingProgress"})],B.prototype,"updatingProgressValue",void 0);f.__decorate([n.property(t.requiredFields)],B.prototype,"requiredFields",null);f.__decorate([n.property(t.availableFields)],B.prototype,"availableFields",void 0);f.__decorate([n.property()],B.prototype,"fieldsHelper",void 0);f.__decorate([n.property({type:Number})],B.prototype,"maximumNumberOfFeatures",
null);f.__decorate([n.property({readOnly:!0})],B.prototype,"maximumNumberOfFeaturesExceeded",null);f.__decorate([n.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],B.prototype,"lodFactor",void 0);f.__decorate([n.property({readOnly:!0})],B.prototype,"hasM",null);f.__decorate([n.property({readOnly:!0})],B.prototype,"hasZ",null);f=B=f.__decorate([l.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],B);const ca={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,
0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},da=z.create(),ha={graphic:null,property:null,oldValue:null,newValue:null},fa=c.create();return f})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,u,f){f=function(p){function t(w){return p.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",w,{hasInitialize:!0})||this}u._inheritsLoose(t,
p);t.prototype.getTransferList=function(w){return[w.geometryBuffer]};return t}(f.WorkerHandle);a.I3SPointsWorkerHandle=f;Object.defineProperty(a,"__esModule",{value:!0})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/workers/workers ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../geometry/HeightModelInfo ../geometry/projection ../geometry/projectionEllipsoid ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../layers/support/layerUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
u,f,p,t,w,e,n,b,h,k,l,m,z,r,c,d,g,A,q,y,x,D,C,B,v,E,F,L,N,I,G,K,H,J,M,O,Q,S,V,Y,W,ba,ca,da,ha,fa,R,U,Z,T,P,X,aa,ja,ia,ka,na,ta,pa,xa,Da,Ka,Fa,Ha,ua,Ba,Ea,Ga,ma,ya,Ma,Ra,ea,Ua,Qa,ra,va,La,Ta,Pa,sa,oa,wa){function za(ab,gb){ab.layerUids||(ab.layerUids=new Set);ab.layerUids.add(gb)}function Ia(ab,gb){ab.graphicUids||(ab.graphicUids=new Set);ab.graphicUids.add(gb)}const Sa=r.getLogger("esri.views.SceneView");t=function(ab){function gb(Ja){var Oa=ab.call(this,Ja)||this;Oa._clippingArea=null;Oa._userClippingArea=
null;Oa._initialDefaultSpatialReference=null;Oa._defaults={};Oa._externallySet={environment:!1};Oa._createGraphicsViewController=null;Oa._resolveWhenReady=[];Oa.propertiesPool=new xa.PropertiesPool({slicePlane:G.BoundedPlaneClass},u._assertThisInitialized(Oa));Oa._resourceController=Fa.newResourceController(u._assertThisInitialized(Oa));Oa._defaultToMapOptions={include:new Set};Oa._defaultHitTestOptions={exclude:new Set};Oa.deconflictor=new R.GraphicsDeconflictor({view:u._assertThisInitialized(Oa)});
Oa.labeler=new U.Labeler({view:u._assertThisInitialized(Oa),deconflictor:Oa.deconflictor.labels});Oa.sharedSymbolResources=null;Oa.basemapTerrain=null;Oa.elevationProvider=null;Oa.camera=null;Oa.canvas=null;Oa.center=null;Oa.constraints=new ca["default"];Oa.environmentManager=new ha["default"];Oa.extent=null;Oa.floors=new b;Oa.windowDevicePixelRatio=1;Oa.fullOpacity=1;Oa.graphicsView=null;Oa.groundView=null;Oa.navigating=!1;Oa.map=null;Oa.screenSizePerspectiveEnabled=!0;Oa.state=new P;Oa.scale=null;
Oa.spatialReference=null;Oa.isHeightModelInfoRequired=!0;Oa.alphaCompositingEnabled=!1;Oa.supersampleScreenhotsEnabled=!0;Oa.type="3d";Oa.ui=new Ta;Oa._numUpdating=0;Oa._lastUpdateTime=0;Oa.updatingProgress=.5;Oa.viewpoint=null;Oa.zoom=null;Oa.highlightOptions=new ta;q.initialize();Ja&&Ja.environment||(Oa._defaults.environment=new da,Oa.environment=Oa._defaults.environment);Ja=Wa=>{c.isSome(Wa)&&4===Wa.type||(Oa.notifyChange("dataExtent"),Oa.updatingChanged(),Oa.map&&Oa.map.allLayers.forEach(function(){var Za=
u._asyncToGenerator(function*(cb){try{yield cb.when()}catch{}Oa.updatingChanged()});return function(cb){return Za.apply(this,arguments)}}()))};Oa.handles.add([A.on(u._assertThisInitialized(Oa),"map.allLayers","after-changes",Ja,Ja,Ja,!0),Oa.allLayerViews.on("after-changes",Wa=>Oa._updateUpdatingMonitors(Wa)),Oa.watch("map",Wa=>{Wa&&Wa.load&&Wa.load().catch(()=>{})})]);Oa.inputManager=new fa({view:u._assertThisInitialized(Oa)});Oa.stateManager=new X({view:u._assertThisInitialized(Oa),updateDevicePixelRatio:()=>
{const Wa=window.devicePixelRatio;Wa!==Oa.windowDevicePixelRatio&&(Oa.windowDevicePixelRatio=Wa,Oa.notifyChange("pixelRatio"))}});return Oa}u._inheritsLoose(gb,ab);var $a=gb.prototype;$a.initialize=function(){this.groundView=new Q({view:this});this._updateUpdatingMonitors();const Ja=()=>this._updateDefaultToMapOptions();this.handles.add(A.on(this,"map.allLayers","after-changes",Ja,Ja,Ja));this.updatingHandles.add(this.qualitySettings,"memoryLimit",Oa=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=
Oa)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",Oa=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Oa)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",Oa=>g.setFrameDuration(0<Oa?1E3/Math.ceil(Oa):0),2);this.updatingHandles.add(ia,"SCENEVIEW_LOCKING_LOG",Oa=>this.defaultsFromMap.logDebugInformation=Oa,2);this.updatingHandles.add(this,"map.ground",Ja,3);this.updatingHandles.add(this,"map.ground.opacity",()=>this._updateDefaultHitTestOptions(),
3);this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))};$a.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=
null,this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null)};$a.installContentCameraReset=function(Ja={sticky:!1}){return this.stateManager.installContentCameraReset(Ja)};$a.castEnvironment=function(Ja){return Ja?Ja instanceof da?Ja:Ja instanceof Pa?
null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ja):da.fromWebsceneEnvironment(Ja):v.ensureType(da,Ja):new da};$a.on=function(Ja,Oa,Wa,Za){return(Wa=this.viewEvents.on(Ja,Oa,Wa,Za))?Wa:ab.prototype.on.call(this,Ja,Oa)};$a.hasEventListener=function(Ja){return ab.prototype.hasEventListener.call(this,Ja)||this.viewEvents.hasHandler(Ja)};$a.toMap=function(Ja,Oa){if(!this.ready)return Sa.error("#toMap()","Scene view cannot be used before it is ready"),null;Oa=Oa?this.externalToInternalIntersectOptions(Oa):
this._defaultToMapOptions;var Wa=c.isSome(Oa.graphics)&&(c.isSome(Oa.graphics.include)||c.isSome(Oa.graphics.exclude));Ja=ra.isSupportedScreenPointEvent(Ja)?ra.createScreenPointFromSupportedEvent(this,Ja):Ja;Ja=y.screenPointObjectToArray(Ja);Oa.enableDraped=Oa.include&&!Oa.include.has(Ra.TERRAIN_ID)||Oa.exclude&&Oa.exclude.has(Ra.TERRAIN_ID);const Za=this.sceneIntersectionHelper,cb=new ya.Intersector(this.state.viewingMode);cb.options.selectionMode=!0;cb.options.store=Wa?2:0;Za.intersectIntersectorScreen(Ja,
cb,Oa);if(Wa){for(const eb of cb.results.all)if(Wa=Ma.toGraphic(eb,this),c.isNone(Wa)||this._testGraphicUidFilter(Oa.graphics,Wa))return this._intersectResultToMapPoint(eb);return null}return this._intersectResultToMapPoint(cb.results.min)};$a.toScreen=function(Ja){if(!this.ready)return Sa.error("#toScreen()","Scene view cannot be used before it is ready"),null;const Oa=c.unwrapOr(null==Ja.z&&na.getElevationAtPoint(this.elevationProvider,Ja),0);L.projectPointToVector(Ja,Xa,this.renderSpatialReference,
Oa);this.state.camera.projectToScreen(Xa,bb);return y.createScreenPoint(bb[0],bb[1])};$a.pixelSizeAt=function(Ja){if(!this.ready)return Sa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ja)return 0;L.projectPointToVector(Ja,Xa,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Xa)};$a.overlayPixelSizeInMapUnits=function(Ja){const Oa=this.basemapTerrain.overlayManager;return Oa?Oa.overlayPixelSizeInMapUnits(Ja):1};$a.hitTest=function(Ja,
Oa){if(!this.ready)return Sa.error("#hitTest()","Scene view cannot be used before it is ready"),null;Ja=ra.isSupportedScreenPointEvent(Ja)?ra.createScreenPointFromSupportedEvent(this,Ja):Ja;var Wa=y.createScreenPointArray(Ja.x,Ja.y),Za=Oa?this.externalToInternalIntersectOptions(Oa):this._defaultHitTestOptions;Za.requiresGroundFeedback=!0;Za.enableDraped=!0;Oa=new ya.Intersector(this.state.viewingMode);Oa.options.selectionMode=!0;Oa.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(Wa,
Oa,Za);Wa=this._intersectResultsToHits(Oa.results.all,Za.graphics);Za=Oa.results.ground;var cb=Ma.toOwner(Za,this);cb=c.isSome(cb)&&"type"in cb&&"integrated-mesh"===cb.type?cb:null;Ja={screenPoint:Ja,results:Wa,ground:{mapPoint:this._intersectResultToMapPoint(Za),distance:Za.hasIntersectionPoint?Za.distanceInRenderSpace:0,layer:cb}};ia.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ja.intersector=Oa);return Promise.resolve(Ja)};$a.popupHitTest=function(Ja){return ea.hitTestSelectSameDistance(this,Ja).then(({results:Oa,
ground:Wa})=>{let Za=null;!(0===Oa.length||1E-5>Math.abs(Oa[0].distance-Wa.distance))||Wa.layer&&"integrated-mesh"===Wa.layer.type||(Za=Wa.mapPoint);return{results:Oa,screenPoint:Ja,mapPoint:Za}})};$a.goTo=function(Ja,Oa){return this.updatingHandles.addPromise(this.stateManager.goTo(Ja,Oa))};$a.whenLayerView=function(Ja){return ab.prototype.whenLayerView.call(this,Ja)};$a.takeScreenshot=function(Ja){return this.whenReady().then(()=>{const Oa=Qa.toRenderSettings(Ja,this);Oa.pixelRatio/=this.pixelRatio;
return this._stage.renderView.takeScreenshot(Qa.screenshotSuperSampleSettings(Oa,this.supersampleScreenhotsEnabled,this.padding))})};$a.addUpdatingPromise=function(Ja){return this.updatingHandles.addPromise(Ja)};$a.importLayerView=function(Ja){return ba.layerView3DImporter.importLayerView(Ja)};$a.hasLayerViewModule=function(Ja){return ba.layerView3DImporter.hasLayerViewModule(Ja)};$a.forceDOMReadyCycle=function(){this.forceReadyCycle()};$a.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||
this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};$a.validate=function(){var Ja=u._asyncToGenerator(function*(){let Oa=La.check();z("safari")&&9>z("safari")&&(Oa=new k("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:z("safari")}));if(c.isSome(Oa))throw Sa.warn("#validate()",Oa.message),Oa;});return function(){return Ja.apply(this,
arguments)}}();$a.isSpatialReferenceSupported=function(Ja,Oa,Wa){var Za=Ja.isGeographic;const cb=Ja.isWebMercator,eb=va.isSpatialReferenceSupported(Ja,"global"),ib="local"===this.viewingMode,sb=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(sb){if(ib&&Za)return Wa?Wa(`Layer ${Oa.id} is ignored because it is GCS and viewing mode is local`):Sa.warnOnce("Geographic coordinate systems are not supported in local viewing mode."),!1;if(!ib&&!eb)return Wa?Wa(`Layer ${Oa.id} is ignored because its spatial reference is not supported in global viewing mode`):
Sa.warnOnce("Spatial reference defined on view not supported in global viewing mode."),!1}else if(Za&&!eb)return Wa?Wa(`Layer ${Oa.id} is ignored because its spatial reference is geographic but unsupported`):Sa.warnOnce("Spatial reference is geographic but not supported."),!1;if(Oa)if(J.isTiledLayer(Oa)){if(sb?Ja=null!=Ga.getTiledLayerInfo(Oa,Ja,W.viewingModeFromString(this.viewingMode)).tileInfo:(Za=Ga.getTiledLayerInfo(Oa,Ja,1),null==Za.tileInfo&&(Za=Ga.getTiledLayerInfo(Oa,Ja,2),null!=Za.tileInfo&&
cb&&!this.ready&&(this.viewingMode="local")),Ja=null!=Za.tileInfo),!Ja)return Wa&&Wa(`Layer ${Oa.id} is ignored because it is tiled but
            its tiling scheme is not supported or compatible with the viewing mode`),!1}else if((Ja.isWGS84||cb)&&!ib)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=Ja),sb||this.ready||(this.viewingMode="global",Wa&&Wa(`Viewing mode locked to global due to reprojectable layer ${Oa.id}`)),Wa&&Wa(`Layer ${Oa.id} is ignored because it supports server-side reprojection`),!1;return!0};$a.whenReady=function(){return new Promise(Ja=>{this.ready?Ja(this):this._resolveWhenReady.push(Ja)})};
$a.computeMapPointFromVec3d=function(Ja,Oa){let Wa=this.spatialReference||sa.WGS84;L.projectVectorToVector(Ja,this.renderSpatialReference,Ja,Wa)||(Wa=sa.WGS84,L.projectVectorToVector(Ja,this.renderSpatialReference,Ja,Wa));Oa?(Oa.x=Ja[0],Oa.y=Ja[1],Oa.z=Ja[2],Oa.spatialReference=Wa):Oa=new oa(Ja,Wa);return Oa};$a.trackGraphicState=function(Ja){if(!Ja.graphic)return Sa.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Oa=this.getViewForGraphic(Ja.graphic);
let Wa=null,Za=!1;const cb=eb=>{!Za&&c.isSome(eb)&&"graphics3d"in eb&&eb.graphics3d&&eb.graphics3d.graphicsCore&&(Wa=eb.graphics3d.graphicsCore.trackGraphicState(Ja))};c.isSome(Oa)?cb(Oa):this.whenViewForGraphic(Ja.graphic,{waitForLayer:!0}).then(eb=>cb(eb),()=>{}).catch(()=>{});return{remove:()=>{Za=!0;c.isSome(Wa)&&(Wa.remove(),Wa=null)}}};$a.highlight=function(Ja){if(Array.isArray(Ja))return m.handlesGroup(Ja.map(Wa=>this.highlight(Wa)));if(b.isCollection(Ja))return m.handlesGroup(Ja.toArray().map(Wa=>
this.highlight(Wa)));const Oa=this.getViewForGraphic(Ja);return Oa&&"highlight"in Oa?Oa.highlight(Ja):m.makeHandle()};$a.maskOccludee=function(Ja){if(!Ja)return Sa.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Oa=this.getViewForGraphic(Ja);let Wa=null,Za=!1;const cb=eb=>{!Za&&c.isSome(eb)&&"graphics3d"in eb&&Ua.occludeesSupported(eb)&&(Wa=eb.maskOccludee(Ja))};c.isSome(Oa)?cb(Oa):this.whenViewForGraphic(Ja,{waitForLayer:!0}).then(eb=>cb(eb),
()=>{}).catch(()=>{});return{remove:()=>{Za=!0;c.isSome(Wa)&&(Wa.remove(),Wa=null)}}};$a.getViewForGraphic=function(Ja){return Ja.layer===this.graphics?this.graphicsView:Ja.layer?this.allLayerViews.find(Oa=>Oa.layer===Ja.layer):null};$a.graphicChanged=function(Ja){c.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Ja)};$a.whenViewForGraphic=function(){var Ja=u._asyncToGenerator(function*(Oa,Wa){if(Oa.layer===this)return yield A.whenOnce(this,"graphicsView"),this.graphicsView;if(!Oa.layer||
!this.map)throw new k("no-view-for-graphic");return Wa&&Wa.waitForLayer&&!this.map.allLayers.includes(Oa.layer)?new Promise((Za,cb)=>{const eb=this.map.allLayers.on("change",ib=>{-1!==ib.added.indexOf(Oa.layer)&&(eb.remove(),this.whenLayerView(Oa.layer).then(Za,cb))})}):this.whenLayerView(Oa.layer)});return function(Oa,Wa){return Ja.apply(this,arguments)}}();$a.externalToInternalIntersectOptions=function(Ja){const Oa=this._externalToInternalRenderItems(Ja.include,0);Ja=this._externalToInternalRenderItems(Ja.exclude,
1);return{include:Oa.layerUids,exclude:Ja.layerUids,graphics:{include:Oa.graphicUids,exclude:Ja.graphicUids}}};$a._intersectResultToMapPoint=function(Ja,Oa){return Ja.getIntersectionPoint(Xa)?(Oa=this.computeMapPointFromVec3d(Xa,Oa),"TerrainRenderer"===Ja.intersector&&this.basemapTerrain&&(Oa.z=c.unwrapOr(na.getElevationAtPoint(this.basemapTerrain,Oa),0)),Oa):null};$a._intersectResultsToHits=function(Ja,Oa){const Wa=[];let Za=null;for(let ib=0;ib<Ja.length;ib++){const sb=Ja[ib];var cb=Ma.toOwner(sb,
this);if(c.isSome(cb)&&(cb===this.map.ground||"type"in cb&&"integrated-mesh"===cb.type))break;cb=Ma.toGraphic(sb,this);if(c.isSome(cb)){c.isNone(Za)&&ib!==Ja.length-1&&(Za=new Set);if(c.isSome(Za)){var eb=this._getGraphicFilterUid(cb);if(Za.has(eb))continue;Za.add(eb)}this._testGraphicUidFilter(Oa,cb)&&(eb=this._intersectResultToMapPoint(sb),Wa.push({graphic:cb,mapPoint:eb,distance:sb.distanceInRenderSpace}))}}return Wa};$a._getGraphicFilterUid=function(Ja){if(Ja.layer&&"objectIdField"in Ja.layer){const Oa=
Ja.attributes[Ja.layer.objectIdField];if(Oa)return`o-${Ja.layer.id}-${Oa}`}return`u-${Ja.uid}`};$a._testGraphicUidFilter=function(Ja,Oa){Oa=this._getGraphicFilterUid(Oa);return c.isNone(Ja)||(c.isNone(Ja.include)||Ja.include.has(Oa))&&(c.isNone(Ja.exclude)||!Ja.exclude.has(Oa))};$a._externalToInternalRenderItems=function(Ja,Oa,Wa={layerUids:null,graphicUids:null}){if(!Ja)return Wa;Ja instanceof w?(Ia(Wa,this._getGraphicFilterUid(Ja)),0===Oa&&(c.isSome(this.graphicsView)&&Ja.layer===this?za(Wa,this.graphicsView.graphics3d.layer.id):
Ja.layer&&za(Wa,Ja.layer.uid))):"forEach"in Ja?Ja.forEach(Za=>{Array.isArray(Za)?this._externalToInternalRenderItems(Za,Oa,Wa):b.isCollection(Za)?Za===this.graphics&&c.isSome(this.graphicsView)?za(Wa,this.graphicsView.graphics3d.layer.id):this._externalToInternalRenderItems(Za,Oa,Wa):Za instanceof e?Za===this.map.ground&&za(Wa,Ra.TERRAIN_ID):this._externalToInternalRenderItems(Za,Oa,Wa)}):za(Wa,Ja.uid);return Wa};$a._initBasemapTerrain=function(){this._set("basemapTerrain",new Ea({view:this}));this._set("elevationProvider",
new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};$a._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};$a._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ba["default"]({view:this}));
this._set("featureTiles",new T["default"]({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ja=()=>{var Oa=this.basemapTerrain&&this.basemapTerrain.extent;this.clippingArea||Oa?Oa&&this.basemapTerrain.spatialReference?(Oa=I.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),
this.featureTiles.filterExtent=this.clippingArea?Oa.intersection(this.clippingArea):Oa):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(ia,"FEATURE_TILE_TREE_SHOW_TILES",Oa=>{Oa&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise(function(Wa,Za){a(["./3d/layers/support/FeatureTileTree3DDebugger"],Wa,Za)})).then(({FeatureTileTree3DDebugger:Wa})=>{!this.featureTreeDebugger&&ia.FEATURE_TILE_TREE_SHOW_TILES&&
(this.featureTreeDebugger=new Wa({view:this}))}):Oa||!this.featureTreeDebugger||ia.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",Ja,3),this.updatingHandles.add(this,"basemapTerrain.extent",Ja,3)],"feature-tiles");this.stateManager.init()};$a._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),
this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};$a._initCoordinateSystem=function(){if(this.spatialReference){var Ja=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ja)||this._set("mapCoordsHelper",new pa.MapCoordsHelper(this.map,Ja));const Oa=this.state.isGlobal;Ja=Oa?N.getSphericalPCPF(Ja):Ja;Ja!==this.renderSpatialReference&&(this._set("renderCoordsHelper",
Ka.RenderCoordsHelper.create(this.state.viewingMode,Ja)),Oa||this.handles.add(this.watch("basemapTerrain.extent",Wa=>{if(0!==Wa[0]||0!==Wa[1]||0!==Wa[2]||0!==Wa[3])this.renderCoordsHelper.extent=Wa},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(ya.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};$a._exitCoordinateSystem=function(){this.mapCoordsHelper&&
(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};$a.updatingChanged=function(){this.notifyChange("updating")};$a._updateUpdatingMonitors=function(Ja=null){c.isSome(Ja)&&4===Ja.type||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Oa=>{Oa.destroyed||(this.handles.add([Oa.watch(["updating","updatingProgress"],()=>this.updatingChanged(),!0)],"updatingMonitors"),Oa.when(()=>this.updatingChanged(),()=>this.updatingChanged()))}),
this.updatingChanged())};$a._renderScreenshotOverlay=function(Ja,Oa){if(!this.overlay||!this.overlay.hasVisibleItems)return Oa;const Wa=Ja.getContext("2d");Wa.putImageData(Oa,0,0);this.overlay.renderCanvas(Ja);return Wa.getImageData(0,0,Oa.width,Oa.height)};$a._initStage=function(){var Ja={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(ib,
sb)=>this._renderScreenshotOverlay(ib,sb)}};const Oa=new aa.SceneIntersectionHelper(this.state.viewingMode,{forEachLayer:ib=>this._stage.layers.forAll(ib)},this);this._set("sceneIntersectionHelper",Oa);const Wa=h.byId(this.surface),{resourceController:Za,state:cb,renderSpatialReference:eb}=this;this._stage=new ma.Stage({resourceController:Za,container:Wa,options:Ja,state:cb,sceneIntersectionHelper:Oa,renderSR:eb});this._lostWebGLContextHandle=l.on(this._stage.renderView.canvas,"webglcontextlost",
()=>this.fatalError=new k("webgl-context-lost"));this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})},2),this.updatingHandles.add(this.qualitySettings,"highQualityTransparency",()=>{this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency})},2),A.init(this,"magnifier",ib=>this._stage.renderView.magnifier=
ib,!0)],"stage");Ja=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:ta.toEngineOptions(this.highlightOptions)})};for(const ib of"highlightOptions highlightOptions.color highlightOptions.haloColor highlightOptions.haloOpacity highlightOptions.fillOpacity highlightOptions.shadowOpacity highlightOptions.shadowColor highlightOptions.shadowDifference".split(" "))this.handles.add(this.updatingHandles.add(this,ib,Ja),"stage");Ja();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(ya.Intersector.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};$a._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};$a._initSurface=function(Ja){this._exitSurface();this.state.init(Ja,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new ua.SharedSymbolResources({view:this,
viewingMode:Ja,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Z.ObjectResourceCache})};$a._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};$a._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");
this._createGraphicsViewController=d.createAbortController();var Ja=()=>{this._createGraphicsViewController=null;this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ja,Ja);this.updatingChanged()}};$a._createGraphicsViewAsync=function(){var Ja=u._asyncToGenerator(function*(Oa){const Wa=(yield new Promise(function(Za,cb){a(["./3d/layers/GraphicsView3D"],function(eb){Za(Object.freeze({__proto__:null,"default":eb}))},cb)})).default;d.throwIfAborted(Oa);
yield A.whenTrueOnce(this.basemapTerrain,"ready",Oa);this._set("graphicsView",new Wa({view:this}))});return function(Oa){return Ja.apply(this,arguments)}}();$a._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");c.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.graphics3d.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};$a._startup=
function(){var Ja=W.viewingModeFromString(this.viewingMode);1===Ja&&(this._clippingArea=null);this._set("ready",!0);this._initSurface(Ja);this.handles.add(A.on(this,"graphics","after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ja=this.get("map.initialViewProperties.environment"))&&(this.environment=Ja);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Ja=this._resolveWhenReady;
this._resolveWhenReady=[];Ja.forEach(Oa=>Oa(this))};$a._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};$a._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ra.TERRAIN_ID);for(const Ja of this.map.allLayers.items)"integrated-mesh"===
Ja.type&&this._defaultToMapOptions.include.add(Ja.uid)}};$a._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ra.TERRAIN_ID);for(const Ja of this.map.allLayers.items)"integrated-mesh"===Ja.type&&1>Ja.opacity&&this._defaultToMapOptions.exclude.add(Ja.uid)}};u._createClass(gb,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},
{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Ja=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!Ja)return this._clippingArea=null;if(!(Ja instanceof wa))return Sa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!H.canProject(Ja.spatialReference,
this.spatialReference))return Sa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ja=H.project(Ja,this.spatialReference)}return this._clippingArea&&Ja&&this._clippingArea.equals(Ja)?this._clippingArea:this._clippingArea=Ja},set:function(Ja){this.ready&&"global"===this.viewingMode&&Ja?Sa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=Ja,this.notifyChange("clippingArea"))}},{key:"dataExtent",
get:function(){const Ja=this.spatialReference||sa.WGS84;let Oa,Wa=this.clippingArea;Wa&&(Wa=H.project(Wa,Ja));const Za=eb=>{if(eb=H.project(eb,Ja)){if(Wa&&(eb=eb.intersection(Wa),!eb))return;c.isSome(Oa)?Oa.union(eb):Oa=eb}},cb=this.basemapTerrain;cb&&cb.spatialReference&&Za(new wa({xmin:cb.extent[0],ymin:cb.extent[1],zmin:0,xmax:cb.extent[2],ymax:cb.extent[3],zmax:0,spatialReference:cb.spatialReference}));this.map&&this.map.allLayers.forEach(eb=>{!eb.fullExtent||"graphics"===eb.type&&eb.internal||
Za(eb.fullExtent)});if(c.isNone(Oa))return new wa({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:Ja});Oa.hasZ?(Oa.zmin=Math.min(0,Oa.zmin),Oa.zmax=Math.max(0,Oa.zmax)):(Oa.zmin=0,Oa.zmax=0);return Oa}},{key:"environment",set:function(Ja){Ja!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ja)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(Ja){c.isSome(Ja)?this._override("pixelRatio",
Ja):this._clearOverride("pixelRatio")}},{key:"maximumPixelRatio",get:function(){let Ja=Infinity;const {maximumPixelRatio:Oa,maximumRenderResolution:Wa}=this.qualitySettings;null!=Oa&&(Ja=Math.min(Ja,Oa));null!=Wa&&(Ja=Math.min(Ja,Wa/Math.max(this.width,this.height)));return Ja},set:function(Ja){c.isSome(Ja)?this._override("maximumPixelRatio",Ja):this._clearOverride("maximumPixelRatio")}},{key:"groundExtent",get:function(){const Ja=this._get("basemapTerrain");if(Ja&&Ja.spatialReference){const Oa=Ja.extent;
return new wa({xmin:Oa[0],ymin:Oa[1],xmax:Oa[2],ymax:Oa[3],spatialReference:Ja.spatialReference})}return new wa({spatialReference:this.spatialReference||sa.WGS84})}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"interacting",get:function(){return this.navigating||c.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(c.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||
ka.getDefaultProfile()},set:function(Ja){ka.isValidProfile(Ja)&&(ka.apply(Ja,this.qualitySettings),this._set("qualityProfile",Ja))}},{key:"slicePlane",set:function(Ja){this._stage.renderView.setRenderParameters({slicePlane:Ja});if(c.isNone(Ja))this._set("slicePlane",null);else{var Oa=this.propertiesPool.get("slicePlane");G.copy(Ja,Oa);this._set("slicePlane",Oa)}}},{key:"resolution",get:function(){return null!=this.spatialReference?K.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"heightModelInfo",
get:function(){const Ja=this.getDefaultHeightModelInfo();return null!=Ja?F.deriveUnitFromSR(Ja,this.spatialReference):null}},{key:"updating",get:function(){var Ja,Oa,Wa;let Za=0,cb=this.layerViewManager.updating,eb=cb?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(ib=>{ib.isFulfilled()?ib.updating&&(cb=!0,ib.suspended||Ga.isSurfaceLayerView(ib)||(++eb,Za="updatingProgress"in ib?Za+ib.updatingProgress:Za+.5)):++eb});for(const ib of[this.graphicsView,this.basemapView,this._resourceController,
this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager])c.isSome(ib)&&ib.updating&&(eb+=.1,Za+=.05);for(const ib of[this.deconflictor,this.labeler,this.basemapTerrain])c.isSome(ib)&&ib.updating&&(++eb,Za+=ib.updatingProgress);(cb=!!(cb||0<eb||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Ja=this.inputManager)&&Ja.hasPendingInputs||null!=(Oa=this.map)&&null!=(Wa=
Oa.allLayers)&&Wa.some(ib=>!ib.isFulfilled())))?(this._numUpdating=Math.max(eb,this._numUpdating),Za+=this._numUpdating-eb):this._numUpdating=0;Za=0<this._numUpdating?Za/this._numUpdating:cb?0:1;this._get("updatingProgress")!==Za&&(Ja=this._resourceController.scheduler.now,1>Za&&(Oa=Math.min((Ja-this._lastUpdateTime)/2E3,1),Za=this.updatingProgress*(1-Oa)+Za*Oa),this._set("updatingProgress",Za),this._lastUpdateTime=cb&&1>Za?Ja:0);return cb}},{key:"viewingMode",get:function(){var Ja=this.get("map.initialViewProperties.viewingMode");
if(Ja)return Ja;Ja=this.spatialReference;return!Ja||va.isSpatialReferenceSupported(Ja,"global")?"global":"local"},set:function(Ja){this.ready?Sa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(Ja)?this._override("viewingMode",Ja):void 0===Ja&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Ha(this)}}]);return gb}(M.BreakpointsOwner(O.DOMContainer(S.PopupView(V))));
f.__decorate([x.property()],t.prototype,"_resourceController",void 0);f.__decorate([x.property()],t.prototype,"_stage",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"deconflictor",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"labeler",void 0);f.__decorate([x.property({type:Y,readOnly:!0,aliasOf:"state.animation"})],t.prototype,"animation",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"basemapTerrain",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,
"elevationProvider",void 0);f.__decorate([x.property({type:p,aliasOf:"stateManager.camera"})],t.prototype,"camera",void 0);f.__decorate([x.property({type:p,aliasOf:"stateManager.contentCamera"})],t.prototype,"contentCamera",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"canvas",void 0);f.__decorate([x.property({type:oa,aliasOf:"stateManager.center"})],t.prototype,"center",void 0);f.__decorate([x.property({type:wa,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],
t.prototype,"clippingArea",null);f.__decorate([x.property({type:ca["default"]})],t.prototype,"constraints",void 0);f.__decorate([x.property({type:wa,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],t.prototype,"dataExtent",null);f.__decorate([x.property({value:null,type:da})],t.prototype,"environment",null);f.__decorate([D.cast("environment")],t.prototype,"castEnvironment",null);f.__decorate([x.property({readOnly:!0})],t.prototype,"environmentManager",void 0);f.__decorate([x.property({type:wa,
aliasOf:"stateManager.extent"})],t.prototype,"extent",void 0);f.__decorate([x.property()],t.prototype,"floors",void 0);f.__decorate([x.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],t.prototype,"screenCenter",void 0);f.__decorate([x.property({type:Number})],t.prototype,"pixelRatio",null);f.__decorate([x.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],t.prototype,"maximumPixelRatio",null);f.__decorate([x.property({aliasOf:"stateManager.frustum"})],
t.prototype,"frustum",void 0);f.__decorate([x.property({type:Number,readOnly:!0})],t.prototype,"fullOpacity",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"graphicsView",void 0);f.__decorate([x.property({type:wa,dependsOn:["basemapTerrain.extent"],readOnly:!0})],t.prototype,"groundExtent",null);f.__decorate([x.property()],t.prototype,"groundView",void 0);f.__decorate([x.property({type:Boolean})],t.prototype,"initialExtentRequired",null);f.__decorate([x.property({type:Boolean,readOnly:!0})],
t.prototype,"interacting",null);f.__decorate([x.property()],t.prototype,"stationary",null);f.__decorate([x.property({aliasOf:"state.navigating"})],t.prototype,"navigating",void 0);f.__decorate([x.property()],t.prototype,"map",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"mapCoordsHelper",void 0);f.__decorate([x.property({aliasOf:"stateManager.padding"})],t.prototype,"padding",void 0);f.__decorate([x.property({type:Ba["default"],readOnly:!0})],t.prototype,"pointsOfInterest",void 0);
f.__decorate([x.property({type:T["default"],readOnly:!0})],t.prototype,"featureTiles",void 0);f.__decorate([x.property()],t.prototype,"featureTreeDebugger",void 0);f.__decorate([x.property({type:Boolean})],t.prototype,"screenSizePerspectiveEnabled",void 0);f.__decorate([x.property({constructOnly:!0})],t.prototype,"deactivatedWebGLExtensions",void 0);f.__decorate([x.property({constructOnly:!0})],t.prototype,"debugWebGLExtensions",void 0);f.__decorate([x.property({constructOnly:!0})],t.prototype,"renderCanvas",
void 0);f.__decorate([x.property({constructOnly:!0})],t.prototype,"state",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"inputManager",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"stateManager",void 0);f.__decorate([x.property({type:["low","medium","high"]})],t.prototype,"qualityProfile",null);f.__decorate([x.property({type:Da,get(){let ab=this._get("qualitySettings");ab||(ab=new Da,ka.apply(this.qualityProfile,ab));return ab}})],t.prototype,"qualitySettings",void 0);
f.__decorate([x.property()],t.prototype,"slicePlane",null);f.__decorate([x.property({dependsOn:["viewingMode"]})],t.prototype,"preconditionsReady",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"renderCoordsHelper",void 0);f.__decorate([x.property({readOnly:!0})],t.prototype,"sceneIntersectionHelper",void 0);f.__decorate([x.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],t.prototype,"resolution",null);f.__decorate([x.property({type:Number,aliasOf:"stateManager.scale"})],
t.prototype,"scale",void 0);f.__decorate([x.property({dependsOn:[]})],t.prototype,"heightModelInfo",null);f.__decorate([x.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],t.prototype,"spatialReference",void 0);f.__decorate([x.property({type:Boolean,constructOnly:!0})],t.prototype,"alphaCompositingEnabled",void 0);f.__decorate([x.property({type:Boolean})],t.prototype,"supersampleScreenhotsEnabled",void 0);f.__decorate([x.property({readOnly:!0})],
t.prototype,"type",void 0);f.__decorate([x.property({type:Ta})],t.prototype,"ui",void 0);f.__decorate([x.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating".split(" ")})],
t.prototype,"updating",null);f.__decorate([x.property({type:Number,readOnly:!0,dependsOn:["updating"]})],t.prototype,"updatingProgress",void 0);f.__decorate([x.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],t.prototype,"viewingMode",null);f.__decorate([x.property({type:n,aliasOf:"stateManager.viewpoint"})],t.prototype,"viewpoint",void 0);f.__decorate([x.property({type:Number,aliasOf:"stateManager.zoom"})],t.prototype,"zoom",void 0);f.__decorate([x.property({type:ta})],
t.prototype,"highlightOptions",void 0);t=f.__decorate([B.subclass("esri.views.SceneView")],t);const Xa=E.create(),bb=y.createScreenPointArray();return t});