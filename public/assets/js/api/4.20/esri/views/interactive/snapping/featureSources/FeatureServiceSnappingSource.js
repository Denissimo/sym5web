// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/trackingUtils ../../../../geometry/Point ../../../2d/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiles2D ../../../3d/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiles3D ./queryEngineUtils ./WorkerTileTreeDebugger ./featureServiceSource/FeatureServiceSnappingSourceWorkerHandle ./featureServiceSource/FeatureServiceTilesSimple ../../../support/debugFlags".split(" "),
function(c,k,d,q,r,m,n,t,e,E,F,G,H,u,v,w,x,y,z,A,l,B,C){c.FeatureServiceSnappingSource=function(p){function f(b){return p.call(this,b)||this}k._inheritsLoose(f,p);var g=f.prototype;g.initialize=function(){const b=this.view;if(n.isSome(b))switch(b.type){case "2d":this.tilesOfInterest=new x.FeatureServiceTiles2D({view:b,layer:this.layer});this.workerHandle=new l.FeatureServiceSnappingSourceWorkerHandle;break;case "3d":{const a=b.resourceController;this.tilesOfInterest=new y.FeatureServiceTiles3D({view:b});
this.workerHandle=new l.FeatureServiceSnappingSourceWorkerHandle({schedule:h=>a.schedule(h)})}}else this.tilesOfInterest=new B.FeatureServiceTilesSimple({layer:this.layer}),this.workerHandle=new l.FeatureServiceSnappingSourceWorkerHandle;this.handles.add([m.destroyHandle(this.workerHandle)]);this.workerHandle.setup({layer:this.layer,spatialReference:this.spatialReference,configuration:this.configuration},null);this.updatingHandles.add(this,"updateTilesParameters",()=>this.workerHandle.updateTiles(this.updateTilesParameters,
null),2);this.handles.add([v.reaction(()=>this.configuration,a=>this.workerHandle.configure(a,null))]);n.isSome(b)&&this.handles.add(t.init(C,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",a=>{a&&!this.debug?(this.debug=new A.WorkerTileTreeDebugger({view:b,handle:this.workerHandle}),this.handles.add(m.destroyHandle(this.debug),"debug")):!a&&this.debug&&this.handles.remove("debug")}));this.handles.add(this.layerSource.layer.on("apply-edits",a=>{this.workerHandle.applyEdits(a,null)}))};g.refresh=
function(){this.workerHandle.refresh(null)};g.fetchCandidates=function(){var b=k._asyncToGenerator(function*(a,h){this.tilesOfInterest.pointOfInterest=a.coordinateHelper.toPoint(a.point,new w);return(yield this.workerHandle.fetchCandidates({...a,filter:null},h)).candidates.map(D=>z.convertSnappingCandidate(D,a.coordinateHelper))});return function(a,h){return b.apply(this,arguments)}}();g.getDebugInfo=function(b){return this.workerHandle.getDebugInfo(b)};k._createClass(f,[{key:"updateTilesParameters",
get:function(){return{tiles:this.tilesOfInterest.tiles,tileInfo:this.tilesOfInterest.tileInfo,tileSize:this.tilesOfInterest.tileSize}}},{key:"updating",get:function(){return this.workerHandle.updating||this.updatingHandles.updating}},{key:"configuration",get:function(){return{filter:this.layer.createQuery(),customParameters:this.layer.customParameters}}},{key:"availability",get:function(){return this.workerHandle.availability}},{key:"layer",get:function(){return this.layerSource.layer}}]);return f}(r.HandleOwnerMixin(q));
d.__decorate([e.property({constructOnly:!0})],c.FeatureServiceSnappingSource.prototype,"spatialReference",void 0);d.__decorate([e.property({constructOnly:!0})],c.FeatureServiceSnappingSource.prototype,"layerSource",void 0);d.__decorate([e.property({constructOnly:!0})],c.FeatureServiceSnappingSource.prototype,"view",void 0);d.__decorate([e.property()],c.FeatureServiceSnappingSource.prototype,"tilesOfInterest",void 0);d.__decorate([e.property({readOnly:!0})],c.FeatureServiceSnappingSource.prototype,
"updateTilesParameters",null);d.__decorate([e.property({readOnly:!0})],c.FeatureServiceSnappingSource.prototype,"updating",null);d.__decorate([e.property({readOnly:!0})],c.FeatureServiceSnappingSource.prototype,"configuration",null);d.__decorate([e.property({readOnly:!0})],c.FeatureServiceSnappingSource.prototype,"availability",null);c.FeatureServiceSnappingSource=d.__decorate([u.subclass("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],c.FeatureServiceSnappingSource);
Object.defineProperty(c,"__esModule",{value:!0})});