// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../rest/support/FeatureSet ./FeatureLayerView2D ./support/util".split(" "),function(m,k,p,l,n,h,z,A,B,r,t,u,v){function q(e,f){if(l.isNone(e)&&l.isNone(f))return null;const c={};
l.isSome(f)&&(c.geometry=f.toJSON());l.isSome(e)&&(c.where=e);return c}h=function(e){function f(){var a=e.apply(this,arguments)||this;a._enabledDataReceived=!1;a.errorString=null;a.connectionStatus="disconnected";return a}m._inheritsLoose(f,e);var c=f.prototype;c.initialize=function(){this.handles.add([this.layer.watch("purgeOptions",()=>this._update())])};c.destroy=function(){this.connectionStatus="disconnected"};c.on=function(a,b){"data-received"===a&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",
!0));const d=e.prototype.on.call(this,a,b),g=this;return{remove(){d.remove();"data-received"===a&&(g._proxy.closed||g.hasEventListener("data-received")||g._proxy.enableEvent("data-received",!1))}}};c.queryLatestObservations=function(a,b){if(!this.layer.timeInfo.endField&&!this.layer.timeInfo.startField)throw new p("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(a),b).then(d=>
{d=t.fromJSON(d);d.features.forEach(g=>{g.layer=this.layer;g.sourceLayer=this.layer});return d})};c._createClientOptions=function(){return{...e.prototype._createClientOptions.call(this),setProperty:a=>{this.set(a.propertyName,a.value)}}};c._createTileRendererHash=function(a){var b=JSON.stringify(this.layer.purgeOptions);const d=JSON.stringify(q(this.layer.definitionExpression,this.layer.geometryDefinition));b=`${b}.${d})`;return e.prototype._createTileRendererHash.call(this,a)+b};c._createServiceOptions=
function(){var a=m._asyncToGenerator(function*(){var b=this.layer;const {objectIdField:d}=b,g=b.fields.map(w=>w.toJSON()),x=v.toJSONGeometryType(b.geometryType),y=b.timeInfo&&b.timeInfo.toJSON()||null;b=b.spatialReference?b.spatialReference.toJSON():null;return{type:"stream",fields:g,geometryType:x,objectIdField:d,timeInfo:y,source:this.layer.parsedUrl,serviceFilter:q(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,
spatialReference:b,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval}});return function(){return a.apply(this,arguments)}}();m._createClass(f,[{key:"connectionError",get:function(){if(this.errorString)return new p("stream-controller",this.errorString)}}]);return f}(u);k.__decorate([n.property()],h.prototype,"errorString",void 0);k.__decorate([n.property({readOnly:!0})],h.prototype,"connectionError",
null);k.__decorate([n.property()],h.prototype,"connectionStatus",void 0);return h=k.__decorate([r.subclass("esri.views.2d.layers.StreamLayerView2D")],h)});