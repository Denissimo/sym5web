// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["../expression/expression","../expression/types"],function(e,f){return function(){function b(a){this._expression=a}b.prototype.filter=function(a,c){if(!this._expression)return!0;try{return this._expression.evaluate(a,c)}catch(d){return console.log(d.message),!0}};b.createFilter=function(a){if(!a)return null;this.isLegacyFilter(a)&&(a=this.convertLegacyFilter(a));try{const c=e.createExpression(a,null,f.BooleanType);return new b(c)}catch(c){return console.log(c.message),null}};b.isLegacyFilter=
function(a){if(!Array.isArray(a)||0===a.length)return!0;switch(a[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);case "in":return 3<=a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);case "!in":return!0;case "any":case "all":for(let c=1;c<a.length;c++)if(!this.isLegacyFilter(a[1]))return!1;return!0;case "none":return!0;case "has":return 2===a.length&&("$id"===a[1]||"$type"===a[1]);case "!has":return!0;
default:return!1}};b.convertLegacyFilter=function(a){if(!Array.isArray(a)||0===a.length)return!0;const c=a[0];if(1===a.length)return"any"!==c;switch(c){case "\x3d\x3d":return b.convertComparison("\x3d\x3d",a[1],a[2]);case "!\x3d":return b.negate(b.convertComparison("\x3d\x3d",a[1],a[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return b.convertComparison(c,a[1],a[2]);case "in":return b.convertIn(a[1],a.slice(2));case "!in":return b.negate(b.convertIn(a[1],a.slice(2)));case "any":case "all":case "none":return b.convertCombining(c,
a.slice(1));case "has":return b.convertHas(a[1]);case "!has":return b.negate(b.convertHas(a[1]));default:throw Error("Unexpected legacy filter.");}};b.convertComparison=function(a,c,d){switch(c){case "$type":return[a,["geometry-type"],d];case "$id":return[a,["id"],d];default:return[a,["get",c],d]}};b.convertIn=function(a,c){switch(a){case "$type":return["in",["geometry-type"],["literal",c]];case "$id":return["in",["id"],["literal",c]];default:return["in",["get",a],["literal",c]]}};b.convertHas=function(a){switch(a){case "$type":return!0;
case "$id":return["has-id"];default:return["has",a]}};b.convertCombining=function(a,c){return[a].concat(c.map(this.convertLegacyFilter))};b.negate=function(a){return["!",a]};return b}()});