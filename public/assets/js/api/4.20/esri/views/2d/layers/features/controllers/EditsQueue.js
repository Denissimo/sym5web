// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass".split(" "),function(d,l,q,x,m,t,C,D,E,F,y){d.EditsQueue=function(u){function n(a){a=u.call(this,a)||this;
a._queue=[];a._onGoingRequest=null;a._abortController=m.createAbortController();return a}l._inheritsLoose(n,u);var p=n.prototype;p.destroy=function(){this.clear()};p.clear=function(){if(this.destroyed)throw Error("instance is already destroyed");let a=this._queue.pop();for(;a;)a.resolver.reject(m.createAbortError()),a=this._queue.pop();this._queue.length=0;this._abortController.abort();this._abortController=m.createAbortController()};p.push=function(){var a=l._asyncToGenerator(function*(e){if(this.destroyed)throw Error("instance is already destroyed");
const f=m.createResolver();this._queue.push({event:e,resolver:f});this.notifyChange("updating");Promise.resolve().then(()=>{this._processNext()});return f.promise});return function(e){return a.apply(this,arguments)}}();p._processNext=function(){var a=l._asyncToGenerator(function*(){if(!this._onGoingRequest){for(var e=[],f=new Set,g=new Set,h=new Set,r=this._queue.shift();r;){const {event:{addedFeatures:c,deletedFeatures:z,updatedFeatures:A},resolver:B}=r;e.push(B);for(const {objectId:b,error:k}of c)k||
(f.add(b),g.add(b),h.delete(b));for(const {objectId:b,error:k}of A)k||(g.add(b),h.delete(b));for(const {objectId:b,error:k}of z)k||(f.has(b)?f.delete(b):h.add(b),g.delete(b));r=this._queue.shift()}if(g.size||h.size){var v=[],w=[];g.size&&g.forEach(c=>{v.push(c)});h.size&&h.forEach(c=>{w.push(c)});this._onGoingRequest=Promise.resolve().then(()=>this.processEdits(v,w,{signal:this._abortController.signal})).catch(()=>{});this.notifyChange("updating");yield this._onGoingRequest;this._onGoingRequest=null;
this.notifyChange("updating");e.forEach(c=>c());0<this._queue.length&&this._processNext()}else this.notifyChange("updating"),e.forEach(c=>c())}});return function(){return a.apply(this,arguments)}}();l._createClass(n,[{key:"updating",get:function(){return!this.destroyed&&(0<this._queue.length||null!=this._onGoingRequest)}}]);return n}(x);q.__decorate([t.property({constructOnly:!0})],d.EditsQueue.prototype,"processEdits",void 0);q.__decorate([t.property({readOnly:!0})],d.EditsQueue.prototype,"updating",
null);d.EditsQueue=q.__decorate([y.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],d.EditsQueue);Object.defineProperty(d,"__esModule",{value:!0})});