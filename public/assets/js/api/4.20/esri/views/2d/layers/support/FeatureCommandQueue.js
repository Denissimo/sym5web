// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),function(r,t,h,w,z,A,B,C,x,y){function l(b){return b.some(d=>d.globalId)}function k(b){return b.filter(d=>!d.error).map(d=>{var f;
return null!=(f=d.objectId)?f:d.globalId})}function u(b,d){b=new Set(b);for(const f of d.values())b.add(f);return b}function v(b,d){b=new Set(b);for(const f of d.values())b.delete(f);return b}h=function(b){function d(a){var c=b.call(this)||this;c._hasGlobalIds=!1;c._queueProcessor=new y.QueueProcessor({concurrency:1,process:a.process});return c}r._inheritsLoose(d,b);var f=d.prototype;f.destroy=function(){this._queueProcessor.clear()};f.push=function(a){const c=this._queueProcessor;var e=c.last();
switch(a.type){case "update":case "refresh":if((null==e?void 0:e.type)===a.type)return;c.push(a).finally(()=>this.notifyChange("updating"));break;case "edit":(e="processed-edit"===(null==e?void 0:e.type)?e:null)&&c.popLast();a=this._mergeEdits(e,a);for(const g of a)c.push(g).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};f._mergeEdits=function(a,c){var e,g;const {addedFeatures:m,deletedFeatures:n,updatedFeatures:p}=c.edits;if(this._hasGlobalIds=this._hasGlobalIds||l(m)||
l(p)||l(n))return c=[...m,...p],[a,{type:"processed-edit",edits:{addOrModified:c,removed:n}}];c=new Set(k(null!=(e=null==a?void 0:a.edits.addOrModified)?e:[]));a=new Set(k(null!=(g=null==a?void 0:a.edits.removed)?g:[]));g=new Set([...k(m),...k(p)]);e=new Set(k(n));c=Array.from(u(v(c,e),g)).map(q=>({objectId:q}));a=Array.from(u(v(a,g),e)).map(q=>({objectId:q}));return[{type:"processed-edit",edits:{addOrModified:c,removed:a}}]};r._createClass(d,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);
return d}(h);t.__decorate([w.property({readOnly:!0})],h.prototype,"updating",null);return h=t.__decorate([x.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],h)});