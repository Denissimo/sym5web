// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),function(z,G,n,w,y,H,K,u,L,A){const M=Math.PI/180;let F=function(){function k(a,d,b,c){this._rotationT=w.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const f=b.rect,e=new Float32Array(8);
a*=c;d*=c;const m=b.code?f.width*c:b.metrics.width,h=b.code?f.height*c:b.metrics.height;e[0]=a;e[1]=d;e[2]=a+m;e[3]=d;e[4]=a;e[5]=d+h;e[6]=a+m;e[7]=d+h;this._data=e;this._setTextureCoords(f);this._scale=c;this._mosaic=b;this.x=a;this.y=d;this.maxOffset=Math.max(a+m,d+h)}var g=k.prototype;g.setTransform=function(a){this._T=a;this._offsets=null};g._setOffsets=function(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const d=this._offsets,b=new Float32Array(8),c=
n.multiply(w.create(),this._rotationT,this._T);w.transformMany(b,a,c);d.upperLeft=u.i1616to32(8*b[0],8*b[1]);d.upperRight=u.i1616to32(8*b[2],8*b[3]);d.lowerLeft=u.i1616to32(8*b[4],8*b[5]);d.lowerRight=u.i1616to32(8*b[6],8*b[7])};g._setTextureCoords=function({x:a,y:d,width:b,height:c}){this._texcoords={upperLeft:u.i1616to32(a,d),upperRight:u.i1616to32(a+b,d),lowerLeft:u.i1616to32(a,d+c),lowerRight:u.i1616to32(a+b,d+c)}};G._createClass(k,[{key:"width",get:function(){return this._mosaic.metrics.width*
this._scale}},{key:"mosaic",get:function(){return this._mosaic}},{key:"angle",get:function(){return this._angle},set:function(a){this._angle=a;n.identity(this._rotationT);n.rotate(this._rotationT,this._rotationT,-a);this._setOffsets(this._data)}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},
{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},{key:"offsets",get:function(){this._offsets||this._setOffsets(this._data);return this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){if(!this._bounds){const {height:f,width:e}=this._mosaic.metrics;var a=e*this._scale,d=Math.abs(f)*this._scale,b=new Float32Array(8);b[0]=this.x;b[1]=this.y;b[2]=this.x+a;b[3]=
this.y;b[4]=this.x;b[5]=this.y+d;b[6]=this.x+a;b[7]=this.y+d;a=n.multiply(w.create(),this._rotationT,this._T);w.transformMany(b,b,a);d=a=Infinity;let m=0;var c=0;for(let h=0;4>h;h++){const l=b[2*h],q=b[2*h+1];a=Math.min(a,l);d=Math.min(d,q);m=Math.max(m,l);c=Math.max(c,q)}b=m-a;c-=d;this._bounds=new A(a+b/2,d+c/2,b,c)}return this._bounds}}]);return k}();const N=(k,g)=>({code:0,page:0,sdf:!0,rect:new L(0,0,11,8),textureBinding:g,metrics:{advance:0,height:4,width:k,left:0,top:0}});let I=function(){function k(a,
d,b){this._rotation=0;this._decorate(a,d,b);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<d.length;this._hasRotation=0!==b.angle;this._T=this._createGlyphTransform(this.bounds,b);for(const c of a)c.setTransform(this._T)}var g=k.prototype;g.setRotation=function(a){if(0!==a||0!==this._rotation){this._rotation=a;var d=this._T;a=n.fromRotation(w.create(),a);n.multiply(d,a,d);for(const b of this.glyphs)b.setTransform(this._T)}};g._decorate=function(a,d,b){if(b.decoration&&"none"!==
b.decoration&&a.length){var c=b.scale;b="underline"===b.decoration?30:20;var f=a[0].textureBinding;for(const e of d)a.push(new F(e.startX*c,e.startY*c+b*c,N((e.width+e.glyphWidthEnd)*c,f),1))}};g._createBounds=function(a){let d=Infinity,b=Infinity,c=0;var f=0;for(const e of a)d=Math.min(d,e.xTopLeft),b=Math.min(b,e.yTopLeft),c=Math.max(c,e.xTopLeft+e.width),f=Math.max(f,e.yBottomRight);a=c-d;f-=b;return new A(d+a/2,b+f/2,a,f)};g._createGlyphTransform=function(a,d){const b=M*d.angle,c=w.create(),f=
H.create();n.translate(c,c,y.set(f,d.xOffset,-d.yOffset));d.isCIM?n.rotate(c,c,b):(n.translate(c,c,y.set(f,a.x,a.y)),n.rotate(c,c,b),n.translate(c,c,y.set(f,-a.x,-a.y)));return c};G._createClass(k,[{key:"boundsT",get:function(){var a=this.bounds;const d=y.set(H.create(),a.x,a.y);y.transformMat2d(d,d,this._T);return this._hasRotation?(a=Math.max(a.width,a.height),new A(d[0],d[1],a,a)):new A(d[0],d[1],a.width,a.height)}}]);return k}(),B=function(k,g,a,d,b,c){this.startY=this.startX=this.glyphWidthEnd=
0;this.start=Math.max(0,Math.min(g,a));this.end=Math.max(0,Math.max(g,a));this.end<k.length&&(this.glyphWidthEnd=k[this.end].metrics.width);this.width=d;this.yMin=b;this.yMax=c};z.ShapedGlyph=F;z.ShapingInfo=I;z.shapeGlyphs=function(k,g,a){const d=a.scale,b=[];{var c=[];var f=1/a.scale*a.maxLineWidth;var e=g?k.length-1:0;var m=g?-1:k.length;g=g?-1:1;var h=e,l=0,q=0;let p=h,v=p,C=0,r=Infinity,t=0;for(;h!==m;){const {code:D,metrics:x}=k[h];var E=Math.abs(x.top);10!==D&&32!==D&&(r=Math.min(r,E),t=Math.max(t,
E+x.height));10===D?(h!==e&&(c.push(new B(k,p,h-g,l,r,t)),r=Infinity,t=0),l=0,p=h+g,v=h+g,q=0):32===D?(v=h+g,q=0,C=x.advance,l+=x.advance):(l>f&&(v!==p?(E=v-2*g,l-=C,c.push(new B(k,p,E,l-q,r,t)),r=Infinity,t=0,p=v,l=q):(c.push(new B(k,p,h-g,l,r,t)),r=Infinity,t=0,v=p=h,l=0)),l+=x.advance,q+=x.advance);h+=g}f=new B(k,p,h-g,l,r,t);0<=f.start&&f.end<k.length&&c.push(f)}for(f=0;f<c.length;f++);f=e=c[0].yMin;e=c[c.length-1].yMax+a.lineHeight*(c.length-1)+("underline"===a.decoration?4:0)-e;const {vAlign:J,
hAlign:O}=a;m=J===K.VAlign.Baseline?1:0;f=(1-m)*-f+e/2*(m?0:J-1)+-26*(m?1:0);for(e=0;e<c.length;e++){const {start:p,end:v,width:C}=c[e];m=C/2*(O+1)*-1-3;g=e*a.lineHeight+f-3;c[e].startX=m;c[e].startY=g;for(h=p;h<=v;h++)l=k[h],10!==l.code&&(q=new F(m+l.metrics.left,g-l.metrics.top,l,d),m+=l.metrics.advance,b.push(q))}return new I(b,c,a)};Object.defineProperty(z,"__esModule",{value:!0})});