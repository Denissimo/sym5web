// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../definitions ../enums ../number ./WGLBrush".split(" "),function(F,L,y,A,C,M,D){const G=1/65536;D=function(H){function E(){var c=H.apply(this,arguments)||this;c._fillProgramOptions={id:!1,pattern:!1};c._outlineProgramOptions={id:!1};return c}L._inheritsLoose(E,H);var B=E.prototype;B.dispose=function(){};B.drawMany=function(c,u){const {displayLevel:k,drawPhase:b,renderPass:h,spriteMosaic:e,styleLayerUID:m}=c;
var a=!1;for(var n of u)if(n.layerData.has(m)){var q=n.layerData.get(m);if(0<q.fillIndexCount||0<q.outlineIndexCount){a=!0;break}}if(a){a=c.styleLayer;var f=a.getPaintProperty("fill-pattern");q=(n=void 0!==f)&&f.isDataDriven;if(n&&!q){var r=f.getValue(k);r=e.getMosaicItemPosition(r,!0)}f=!n&&a.getPaintValue("fill-antialias",k);var x=!0,v=1;if(!n){var d=a.getPaintProperty("fill-color"),w=a.getPaintProperty("fill-opacity");null!=d&&d.isDataDriven||null!=w&&w.isDataDriven||(v=a.getPaintValue("fill-color",
k),v=a.getPaintValue("fill-opacity",k)*v[3],1<=v&&(x=!1))}if(!x||"opaque"!==h){var l;b===C.WGLDrawPhase.HITTEST&&(l=M.u32to4Xu8(m+1));d=a.getPaintValue("fill-translate",k);w=a.getPaintValue("fill-translate-anchor",k);(x||"translucent"!==h)&&this._drawFill(c,m,a,u,d,w,n,r,q,l);r=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&1>v;f&&"opaque"!==h&&!r&&this._drawOutline(c,m,a,u,d,w,l)}}};B._drawFill=function(c,u,k,b,h,e,m,a,n,q){if(!m||!y.isNone(a)){var {context:f,displayLevel:r,state:x,drawPhase:v,
painter:d,pixelRatio:w,spriteMosaic:l}=c;c=k.fillMaterial;var g=d.vectorTilesMaterialManager,t=w>A.VTL_HIGH_RES_CUTOFF?2:1,I=v===C.WGLDrawPhase.HITTEST,z=this._fillProgramOptions;z.id=I;z.pattern=m;g=g.getMaterialProgram(f,c,z);f.useProgram(g);y.isSome(a)&&({page:a}=a,z=l.getPageSize(a),y.isSome(z)&&(l.bind(f,9729,a,A.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.setUniform2fv("u_mosaicSize",z),g.setUniform1i("u_texture",A.VTL_TEXTURE_BINDING_UNIT_SPRITES)));g.setUniformMatrix3fv("u_displayMat3",1===e?x.displayMat3:
x.displayViewMat3);g.setUniform2fv("u_fillTranslation",h);g.setUniform1f("u_depth",k.z+G);I&&g.setUniform4fv("u_id",q);h=-1;for(const p of b)if(p.layerData.has(u)&&(p.key.level!==h&&(h=p.key.level,c.setDataUniforms(g,r,k,h,l)),b=p.layerData.get(u),b.fillIndexCount&&(b.prepareForRendering(f),e=b.fillVertexArrayObject,!y.isNone(e)))){f.bindVAO(e);g.setUniformMatrix3fv("u_dvsMat3",p.transforms.dvs);f.setStencilFunction(514,p.stencilRef,255);m&&g.setUniform1f("u_patternFactor",p.coordRange[0]/(t*p.size[0]*
Math.max(2**(Math.round(r)-p.key.level),1)));if(n){e=b.patternMap;if(!e)continue;for(const [J,K]of e)e=l.getPageSize(J),y.isSome(e)&&(l.bind(f,9729,J,A.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.setUniform2fv("u_mosaicSize",e),g.setUniform1i("u_texture",A.VTL_TEXTURE_BINDING_UNIT_SPRITES),f.drawElements(4,K[1],5125,Uint32Array.BYTES_PER_ELEMENT*K[0]))}else f.drawElements(4,b.fillIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*b.fillIndexStart);p.triangleCount+=b.fillIndexCount/3}}};B._drawOutline=function(c,
u,k,b,h,e,m){const {context:a,displayLevel:n,state:q,drawPhase:f,painter:r,pixelRatio:x,spriteMosaic:v}=c;c=k.outlineMaterial;var d=r.vectorTilesMaterialManager;const w=.75/x,l=f===C.WGLDrawPhase.HITTEST,g=this._outlineProgramOptions;g.id=l;d=d.getMaterialProgram(a,c,g);a.useProgram(d);d.setUniformMatrix3fv("u_displayMat3",1===e?q.displayMat3:q.displayViewMat3);d.setUniform2fv("u_fillTranslation",h);d.setUniform1f("u_depth",k.z+G);d.setUniform1f("u_outline_width",w);l&&d.setUniform4fv("u_id",m);h=
-1;for(const t of b)t.layerData.has(u)&&(t.key.level!==h&&(h=t.key.level,c.setDataUniforms(d,n,k,h,v)),b=t.layerData.get(u),b.prepareForRendering(a),b.outlineIndexCount&&(e=b.outlineVertexArrayObject,y.isNone(e)||(a.bindVAO(e),d.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),a.setStencilFunction(514,t.stencilRef,255),a.drawElements(4,b.outlineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*b.outlineIndexStart),t.triangleCount+=b.outlineIndexCount/3)))};return E}(D);F.WGLBrushVTLFill=D;Object.defineProperty(F,
"__esModule",{value:!0})});