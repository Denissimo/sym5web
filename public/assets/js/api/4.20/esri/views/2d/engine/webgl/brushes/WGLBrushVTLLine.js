// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../definitions ../enums ../number ./WGLBrush".split(" "),function(A,H,r,t,I,J,x){x=function(B){function y(){var b=B.apply(this,arguments)||this;b._programOptions={id:!1,pattern:!1,sdf:!1};return b}H._inheritsLoose(y,B);var C=y.prototype;C.dispose=function(){};C.drawMany=function(b,e){const {context:g,displayLevel:l,state:z,drawPhase:K,painter:L,pixelRatio:D,spriteMosaic:m,styleLayerUID:u}=b;if(e.some(f=>{var n,
p;return null!=(n=null==(p=f.layerData.get(u))?void 0:p.lineIndexCount)?n:!1})){b=b.styleLayer;var E=b.lineMaterial,M=L.vectorTilesMaterialManager,d=b.getPaintValue("line-translate",l),c=b.getPaintValue("line-translate-anchor",l),h=b.getPaintProperty("line-pattern"),v=void 0!==h,F=v&&h.isDataDriven;if(v&&!F){h=h.getValue(l);var k=m.getMosaicItemPosition(h)}var a;h=!1;if(!v){var q=b.getPaintProperty("line-dasharray");h=(a=void 0!==q)&&q.isDataDriven;a&&!h&&(k=q.getValue(l),k=b.getDashKey(k,b.getLayoutValue("line-cap",
l)),k=m.getMosaicItemPosition(k))}q=1/D;var G=K===I.WGLDrawPhase.HITTEST,w=this._programOptions;w.id=G;w.pattern=v;w.sdf=a;a=M.getMaterialProgram(g,E,w);g.useProgram(a);a.setUniformMatrix3fv("u_displayViewMat3",z.displayViewMat3);a.setUniformMatrix3fv("u_displayMat3",1===c?z.displayMat3:z.displayViewMat3);a.setUniform2fv("u_lineTranslation",d);a.setUniform1f("u_depth",b.z);a.setUniform1f("u_antialiasing",q);G&&(d=J.u32to4Xu8(u+1),a.setUniform4fv("u_id",d));k&&r.isSome(k)&&({page:d}=k,c=m.getPageSize(d),
r.isSome(c)&&(m.bind(g,9729,d,t.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",t.VTL_TEXTURE_BINDING_UNIT_SPRITES)));d=-1;for(const f of e)if(f.layerData.has(u)&&(f.key.level!==d&&(d=f.key.level,E.setDataUniforms(a,l,b,d,m)),a.setUniform1f("u_zoomFactor",2**(l-d)/D),e=f.layerData.get(u),e.lineIndexCount&&(e.prepareForRendering(g),c=e.lineVertexArrayObject,!r.isNone(c)))){g.bindVAO(c);a.setUniformMatrix3fv("u_dvsMat3",f.transforms.dvs);g.setStencilFunction(514,
f.stencilRef,255);if(F||h){c=e.patternMap;if(!c)continue;for(const [n,p]of c)c=m.getPageSize(n),r.isSome(c)&&(m.bind(g,9729,n,t.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",t.VTL_TEXTURE_BINDING_UNIT_SPRITES),g.drawElements(4,p[1],5125,Uint32Array.BYTES_PER_ELEMENT*p[0]))}else g.drawElements(4,e.lineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart);f.triangleCount+=e.lineIndexCount/3}}};return y}(x);A.WGLBrushVTLLine=x;Object.defineProperty(A,
"__esModule",{value:!0})});