// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/global","../../core/mathUtils"],function(m,r,n){function t(a,b,c,f,d){a=new Uint32Array(a*a);b="buffer"in b?b:new Float64Array(b);c="buffer"in c?new Uint32Array(c.buffer):new Uint32Array((new Uint8Array(c)).buffer);d=c.length/(d-f);for(let h=0;h<b.length;h++)a[h]=c[n.clamp(Math.floor((b[h]-f)*d),0,c.length-1)];return a.buffer}function w(a){const b=Math.round(3*a),c=2*a*a,f=new Float64Array(2*b+1);for(let d=
0;d<=f.length;d++)f[d]=Math.exp(-((d-b)**2)/c)/Math.sqrt(2*Math.PI)*(a/2);return f}function C(a,b){return"function"===typeof a?a:a?"string"===typeof b?c=>-1*+c[a]:c=>+c[a]+b:()=>1}function D(a,b){return null!=a?"string"===typeof b?c=>-1*+c.readAttribute(a):c=>+c.readAttribute(a)+b:c=>1}const E=(()=>{if(!("document"in r))return()=>null;const a=document.createElement("canvas"),b=a.getContext("2d");a.height=512;a.width=1;return c=>{b.clearRect(0,0,1,a.height);const f=b.createLinearGradient(0,0,0,a.height);
for(const {ratio:d,color:h}of c.colorStops)f.addColorStop(Math.max(d,.001),`rgba(${h[0]}, ${h[1]}, ${h[2]}, ${h[3]})`);b.fillStyle=f;b.fillRect(0,0,1,a.height);return b.getImageData(0,0,1,a.height).data}})();m.calculateHeatmapIntensityInfo=function(a,b,c,f){const {blurRadius:d,fieldOffset:h,field:k}=b;b=new Float64Array(c*f);const e=w(d),g=Math.round(3*d);let p=Number.NEGATIVE_INFINITY;const v=C(k,h);for(const {geometry:u,attributes:q}of a){a=u.x-g;const x=u.y-g,H=Math.max(0,a);var l=Math.max(0,x);
const F=Math.min(f,u.y+g),G=Math.min(c,u.x+g),I=+v(q);for(let y=l;y<F;y++){const z=e[y-x];for(let A=H;A<G;A++)l=b[y*c+A]+=z*e[A-a]*I,l>p&&(p=l)}}return{matrix:b.buffer,max:p}};m.calculateHeatmapIntensityInfoReaders=function(a,b,c,f){const {blurRadius:d,fieldOffset:h,field:k}=b;b=new Float64Array(c*f);const e=w(d),g=Math.round(3*d);let p=Number.NEGATIVE_INFINITY;const v=D(k,h),l=new Set;for(const H of a)for(a=H.getCursor();a.next();){var u=a.getObjectId();if(l.has(u))continue;l.add(u);var q=a.readLegacyPointGeometry();
if(-128>q.x||q.x>=c+128||-128>q.y||q.y>f+128)continue;u=+v(a);const F=Math.round(q.x)-g,G=Math.round(q.y)-g,I=Math.max(0,F);var x=Math.max(0,G);const y=Math.min(f,Math.round(q.y)+g);q=Math.min(c,Math.round(q.x)+g);for(let z=x;z<y;z++){const A=e[z-G];for(let B=I;B<q;B++)x=b[z*c+B]+=A*e[B-F]*u,x>p&&(p=x)}}return{matrix:b.buffer,max:p}};m.createHeatmapImageData=t;m.createKernel=w;m.createValueFunction=C;m.createValueFunctionCursor=D;m.drawHeatmap=function(a,b,c,f,d,h){a.canvas.width=a.canvas.height=
b;a.clearRect(0,0,b,b);const k=a.getImageData(0,0,b,b);c&&f&&k.data.set(new Uint8ClampedArray(t(b,c,f,d,h)));a.putImageData(k,0,0)};m.generateGradient=E;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(m,r,n,t,w,C,D,E,a){n=function(b){function c(d){d=b.call(this,d)||this;d.tiles=new Map;return d}m._inheritsLoose(c,b);var f=c.prototype;f.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};f.acquireTile=function(d){const h=this.createTile(d);h.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(d.id,h);return h};f.forceAttributeTextureUpload=function(){};f.forEachTile=function(d){this.tiles.forEach(d)};f.releaseTile=function(d){this.tiles.delete(d.key.id);
this.disposeTile(d)};f.isUpdating=function(){let d=!0;this.tiles.forEach(h=>{d=d&&h.isReady});return!d};f.setHighlight=function(){};f.invalidateLabels=function(){};f.requestUpdate=function(){this.layerView.requestUpdate()};m._createClass(c,[{key:"updating",get:function(){return this.isUpdating()}}]);return c}(n.HandleOwner);r.__decorate([t.property()],n.prototype,"layer",void 0);r.__decorate([t.property()],n.prototype,"layerView",void 0);r.__decorate([t.property()],n.prototype,"tileInfoView",void 0);
r.__decorate([t.property()],n.prototype,"updating",null);return n=r.__decorate([a.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],n)})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["exports","../../../../../../renderers/support/heatmapUtils"],function(m,r){let n=function(){function t(){this.gradient=null;this.width=this.height=512}t.prototype.render=function(w){r.drawHeatmap(w,512,this.intensities,this.gradient,this.minPixelIntensity,
this.maxPixelIntensity)};return t}();m.HeatmapSource=n;Object.defineProperty(m,"__esModule",{value:!0})})},"*noref":1}});
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/Logger ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapTileContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(m,r,n,t,w,C,D,E,a,b,c,f){n=function(d){function h(e){var g=
d.call(this,e)||this;g._intensityInfo={minPixelIntensity:0,maxPixelIntensity:0};g.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}};g._container=new b.BitmapTileContainer(e.tileInfoView);return g}m._inheritsLoose(h,d);var k=h.prototype;k.createTile=function(e){const g=this._container.createTile(e);this.tileInfoView.getTileCoords(g.bitmap,e);g.bitmap.resolution=this.tileInfoView.getTileResolution(e);return g};k.onConfigUpdate=function(){const e=this.layer.renderer;
if("heatmap"===e.type){const {minPixelIntensity:g,maxPixelIntensity:p}=e;this._intensityInfo.minPixelIntensity=g;this._intensityInfo.maxPixelIntensity=p;this._gradient=a.generateGradient(e.toJSON());this.tiles.forEach(v=>{const l=v.bitmap.source;l&&(l.minPixelIntensity=g,l.maxPixelIntensity=p,l.gradient=this._gradient,v.bitmap.invalidateTexture())})}};k.hitTest=function(){return Promise.resolve([])};k.install=function(e){e.addChild(this._container)};k.uninstall=function(e){this._container.removeAllChildren();
e.removeChild(this._container)};k.disposeTile=function(e){this._container.removeChild(e);e.destroy()};k.supportsRenderer=function(e){return e&&"heatmap"===e.type};k.onTileData=function(e){const g=this.tiles.get(e.tileKey);if(g){e=e.intensityInfo;var {minPixelIntensity:p,maxPixelIntensity:v}=this._intensityInfo,l=g.bitmap.source||new f.HeatmapSource;l.intensities=e&&e.matrix||null;l.minPixelIntensity=p;l.maxPixelIntensity=v;l.gradient=this._gradient;g.bitmap.source=l;this._container.addChild(g);this.requestUpdate()}};
k.onTileError=function(e){console.error(e)};k.lockGPUUploads=function(){};k.unlockGPUUploads=function(){};return h}(c);return n=r.__decorate([E.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],n)});