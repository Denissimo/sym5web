// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","./Effect"],function(r,w,x,y,n){n=function(t){function p(){var a=t.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._lastSize=0;return a}w._inheritsLoose(p,t);var g=p.prototype;g.dispose=function(){x.isSome(this._fbo)&&this._fbo.dispose()};g.bind=function({context:a,painter:h}){const {width:e,height:k}=a.getViewport();h=h.getFbos(e,k).effect0;a.bindFramebuffer(h);
a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};g.unbind=function(){};g.draw=function({context:a,state:h,pixelRatio:e},k,z=y.HITTEST_SEARCH_SIZE){const A=a.getBoundFramebufferObject(),B=h.size[1]*e,b=Math.round(z*e),u=b/2,v=b/2;this._ensureBuffer(b);k.forEach((C,q)=>{var f=new Map;A.readPixels(Math.floor(q[0]*e-b/2),Math.floor(B-q[1]*e-b/2),b,b,6408,5121,this._buf);for(let c=0;c<this._buf32.length;c++){const d=this._buf32[c];if(4294967295!==d&&0!==d){var l=c%b,
m=b-Math.floor(c/b);l=(u-l)*(u-l)+(v-m)*(v-m);m=f.has(d)?f.get(d):4294967295;f.set(d,Math.min(l,m))}}f=Array.from(f).sort((c,d)=>c[1]-d[1]).map(c=>c[0]);C.resolve(f);k.delete(q)})};g._ensureBuffer=function(a){this._lastSize!==a&&(this._lastSize=a,this._buf=new Uint8Array(4*a*a),this._buf32=new Uint32Array(this._buf.buffer))};return p}(n.Effect);r.HittestEffect=n;Object.defineProperty(r,"__esModule",{value:!0})});