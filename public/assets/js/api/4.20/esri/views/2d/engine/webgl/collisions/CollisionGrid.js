// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../definitions","../../../layers/features/support/StaticBitSet"],function(k,h,p,q){let u=function(){function l(a,b){this.width=a;this.height=b;a=Math.ceil(a/1);b=Math.ceil(b/1);this._cols=a;this._rows=b;this._cells=q.StaticBitSet.create(a*b)}var e=l.prototype;e.insertMetrics=function(a){const b=this._hasCollision(a);0===b&&this._markMetrics(a);return b};e.getCellId=function(a,b){return a+b*this._cols};e.has=function(a){return this._cells.has(a)};
e.hasRange=function(a,b){return this._cells.hasRange(a,b)};e.set=function(a){this._cells.set(a)};e.setRange=function(a,b){this._cells.setRange(a,b)};e._hasCollision=function(a){const b=a.id;let c=0,d=0;a.save();do{const g=a.boundsCount;c+=g;for(let f=0;f<g;f++){const m=a.boundsComputedAnchorX(f),n=a.boundsComputedAnchorY(f),r=a.boundsWidth(f)+2,t=a.boundsHeight(f)+2;switch(this._collide(m,n,r,t)){case 2:return 2;case 1:d++}}}while(a.peekId()===b&&a.next());a.restore();return c===d?1:0};e._collide=
function(a,b,c,d){var g=a-c/2;a+=c/2;c=b-d/2;b+=d/2;if(0>a||0>b||g>this.width||c>this.height)return 1;g=h.clamp(Math.floor(g/1),0,this._cols);d=h.clamp(Math.floor(c/1),0,this._rows);a=h.clamp(Math.ceil(a/1),0,this._cols);for(b=h.clamp(Math.ceil(b/1),0,this._rows);d<=b;d++)for(c=g;c<=a;c++){const f=this.getCellId(c,d);if(this.has(f))return 2}return 0};e._mark=function(a,b,c,d){var g=a+c/2,f=b-d/2;b+=d/2;a=h.clamp(Math.floor(a-c/2),0,this._cols);c=h.clamp(Math.floor(f/1),0,this._rows);g=h.clamp(Math.ceil(g/
1),0,this._cols);f=h.clamp(Math.ceil(b/1),0,this._rows);for(b=c;b<=f;b++)for(c=a;c<=g;c++)d=this.getCellId(c,b),this.set(d);return!1};e._markMetrics=function(a){const b=a.id;do{const c=a.boundsCount;for(let d=0;d<c;d++){const g=a.boundsComputedAnchorX(d),f=a.boundsComputedAnchorY(d),m=a.boundsWidth(d)+2,n=a.boundsHeight(d)+2;this._mark(g,f,m,n)}}while(a.peekId()===b&&a.next())};return l}(),v=function(){function l(a,b=2){this._bucketSize=a;this._rowsLength=p.TILE_SIZE/a;this._colsLength=p.TILE_SIZE/
a;this._elementsPerBucket=b;this._grid=this._initGrid()}var e=l.prototype;e.checkOverlap=function(a,b){a=Math.floor(a/this._bucketSize);b=Math.floor(b/this._bucketSize);return 0>a||a>=this._rowsLength||0>b||b>=this._colsLength?!0:this._grid[b*this._colsLength+a]>=this._elementsPerBucket};e.markUsed=function(a,b){this._grid[Math.floor(b/this._bucketSize)*this._colsLength+Math.floor(a/this._bucketSize)]+=1};e.reset=function(){this._grid=this._initGrid()};e._initGrid=function(){return new Uint8Array(this._rowsLength*
this._colsLength)};return l}();k.CollisionBitsetGrid=u;k.CollisionGrid=v;k.HAS_COLLISION=2;k.NONE=0;k.OUTSIDE_EXTENT=1;Object.defineProperty(k,"__esModule",{value:!0})});