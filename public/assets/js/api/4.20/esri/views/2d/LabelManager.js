// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),function(g,d,b,l,m,n,p,e,u,v,w,q,r){const t=n.getLogger("esri.views.2d.layers.labels.LabelManager");b=function(k){function f(a){a=
k.call(this,a)||this;a._applyVisibilityPassThrottled=p.throttle(a._applyVisibilityPass,32,g._assertThisInitialized(a));a.lastUpdateId=-1;a.updateRequested=!1;a.view=null;return a}g._inheritsLoose(f,k);var c=f.prototype;c.initialize=function(){this.collisionEngine=new r.CollisionEngine};c.destroy=function(){this.collisionEngine=null;this._applyVisibilityPassThrottled.remove();this._applyVisibilityPassThrottled=null};c.update=function(a){this._applyVisibilityPassThrottled(a)};c.viewChange=function(){this.requestUpdate()};
c.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};c.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.updateRequested=!1,this.update(a))};c._applyVisibilityPass=function(a){try{const h=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,a,h)}catch(h){t.error(new l("mapview-labeling","Encountered an error during label decluttering",h))}};
g._createClass(f,[{key:"updating",get:function(){return this.updateRequested}}]);return f}(m.HandleOwnerMixin(b));d.__decorate([e.property()],b.prototype,"updateRequested",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"updateParameters",void 0);d.__decorate([e.property()],b.prototype,"updating",null);d.__decorate([e.property()],b.prototype,"view",void 0);return b=d.__decorate([q.subclass("esri.views.2d.layers.labels.LabelManager")],b)});