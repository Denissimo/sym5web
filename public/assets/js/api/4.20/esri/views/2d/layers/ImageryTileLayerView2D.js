// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),function(E,J,z,H,C,G,F,K,I,x,A,y){var w;const b=F.getLogger("esri.layers.support.PixelBlock");z=w=
function(f){function h(c){c=f.call(this,c)||this;c.width=null;c.height=null;c.pixelType="f32";c.validPixelCount=null;c.mask=null;c.maskIsAlpha=!1;c.pixels=null;c.statistics=null;return c}E._inheritsLoose(h,f);h.createEmptyBand=function(c,e){return new (w.getPixelArrayConstructor(c))(e)};h.getPixelArrayConstructor=function(c){let e;switch(c){case "u1":case "u2":case "u4":case "u8":e=Uint8Array;break;case "u16":e=Uint16Array;break;case "u32":e=Uint32Array;break;case "s8":e=Int8Array;break;case "s16":e=
Int16Array;break;case "s32":e=Int32Array;break;case "u32":e=Uint32Array;break;case "f32":e=Float32Array;break;case "f64":e=Float64Array;break;case "c64":case "c128":case "unknown":e=Float32Array}return e};var k=h.prototype;k.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();-1<["u1","u2","u4"].indexOf(c)?c="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(c)&&(c="f32");return c};k.getPlaneCount=function(){return this.pixels&&this.pixels.length};k.addData=function(c){if(!c.pixels||
c.pixels.length!==this.width*this.height)throw new H("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics||{minValue:null,maxValue:null})};k.getAsRGBA=function(){const c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);
break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};k.getAsRGBAFloat=function(){const c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};k.updateStatistics=function(){this.statistics=this.pixels.map(n=>this._calculateBandStatistics(n,this.mask));const c=this.mask;let e=0;if(c)for(let n=0;n<c.length;n++)c[n]&&e++;else e=this.width*this.height;this.validPixelCount=e};k.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c){switch(c){case "u8":var e=[0,255];break;case "u16":e=
[0,65535];break;case "u32":e=[0,4294967295];break;case "s8":e=[-128,127];break;case "s16":e=[-32768,32767];break;case "s32":e=[-2147483648,2147483647];break;default:e=[-3.4*1E39,3.4*1E39]}var [n,p]=e;e=this.pixels;var g=this.width*this.height,l=e.length,a=[];for(let r=0;r<l;r++){var d=w.createEmptyBand(c,g);var q=e[r];for(let t=0;t<g;t++){var m=q[t];d[t]=m>p?p:m<n?n:m}a.push(d)}this.pixels=a;this.pixelType=c}};k.extractBands=function(c){if(K.isNone(c)||0===c.length||null==this.pixels||0===this.pixels.length)return this;
var e=this.pixels.length;const n=c.some(p=>p>=this.pixels.length);e=e===c.length&&!c.some((p,g)=>p!==g);return n||e?this:new w({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:c.map(p=>this.pixels[p]),statistics:this.statistics&&c.map(p=>this.statistics[p])})};k.clone=function(){const c=new w({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});
this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let e;const n=w.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){c.pixels=[];const p=this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)c.pixels[e]=p?this.pixels[e].slice(0,this.pixels[e].length):new n(this.pixels[e])}if(this.statistics)for(c.statistics=[],e=0;e<this.statistics.length;e++)c.statistics[e]=G.clone(this.statistics[e]);return c};k._fillFrom8Bit=function(c){const {mask:e,
maskIsAlpha:n,pixels:p}=this;if(c&&p&&p.length){var g,l;var a=g=l=p[0];3<=p.length?(g=p[1],l=p[2]):2===p.length&&(g=p[1]);var d=new Uint32Array(c),q=this.width*this.height;if(a.length!==q)b.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(e&&e.length===q)if(n)for(c=0;c<q;c++)e[c]&&(d[c]=e[c]<<24|l[c]<<16|g[c]<<8|a[c]);else for(c=0;c<q;c++)e[c]&&(d[c]=-16777216|l[c]<<16|g[c]<<8|a[c]);else for(c=0;c<q;c++)d[c]=-16777216|l[c]<<16|g[c]<<8|a[c]}else b.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};k._fillFromNon8Bit=function(c){const {pixels:e,mask:n,statistics:p}=this;if(c&&e&&e.length){var g=this.pixelType,l=1,a=0;l=1;p&&0<p.length?(a=p.map(t=>t.minValue).reduce((t,u)=>Math.min(t,u)),l=p.map(t=>t.maxValue-t.minValue).reduce((t,u)=>Math.max(t,u)),l=255/l):(l=255,"s8"===g?(a=-128,l=127):"u16"===g?l=65535:"s16"===g?(a=-32768,l=32767):"u32"===g?l=4294967295:"s32"===g?(a=-2147483648,l=2147483647):"f32"===g?(a=-3.4*1E39,l=3.4*1E39):
"f64"===g&&(a=-Number.MAX_VALUE,l=Number.MAX_VALUE),l=255/(l-a));c=new Uint32Array(c);g=this.width*this.height;var d,q,m;var r=d=q=e[0];if(r.length!==g)return b.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=e.length)if(d=e[1],3<=e.length&&(q=e[2]),n&&n.length===g)for(m=0;m<g;m++)n[m]&&(c[m]=-16777216|(q[m]-a)*l<<16|(d[m]-a)*l<<8|(r[m]-a)*l);else for(m=0;m<g;m++)c[m]=-16777216|(q[m]-a)*l<<16|(d[m]-a)*l<<8|(r[m]-a)*l;else if(n&&n.length===g)for(m=0;m<g;m++)d=(r[m]-
a)*l,n[m]&&(c[m]=-16777216|d<<16|d<<8|d);else for(m=0;m<g;m++)d=(r[m]-a)*l,c[m]=-16777216|d<<16|d<<8|d}else b.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};k._fillFrom32Bit=function(c){const {pixels:e,mask:n}=this;if(!c||!e||!e.length)return b.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let p,g,l,a;p=g=l=e[0];3<=e.length?(g=e[1],l=e[2]):2===e.length&&(g=e[1]);const d=this.width*this.height;if(p.length!==d)return b.error("getAsRGBAFloat()",
"Unable to convert to RGBA. The pixelblock is invalid.");let q=0;if(n&&n.length===d)for(a=0;a<d;a++)c[q++]=p[a],c[q++]=g[a],c[q++]=l[a],c[q++]=n[a]&1;else for(a=0;a<d;a++)c[q++]=p[a],c[q++]=g[a],c[q++]=l[a],c[q++]=1};k._calculateBandStatistics=function(c,e){let n=Infinity,p=-Infinity;const g=c.length;let l,a=0;if(e)for(l=0;l<g;l++)e[l]&&(a=c[l],n=a<n?a:n,p=a>p?a:p);else for(l=0;l<g;l++)a=c[l],n=a<n?a:n,p=a>p?a:p;return{minValue:n,maxValue:p}};return h}(C.JSONSupport);J.__decorate([I.property({json:{write:!0}})],
z.prototype,"width",void 0);J.__decorate([I.property({json:{write:!0}})],z.prototype,"height",void 0);J.__decorate([I.property({json:{write:!0}})],z.prototype,"pixelType",void 0);J.__decorate([x.cast("pixelType")],z.prototype,"castPixelType",null);J.__decorate([I.property({json:{write:!0}})],z.prototype,"validPixelCount",void 0);J.__decorate([I.property({json:{write:!0}})],z.prototype,"mask",void 0);J.__decorate([I.property({json:{write:!0}})],z.prototype,"maskIsAlpha",void 0);J.__decorate([I.property({json:{write:!0}})],
z.prototype,"pixels",void 0);J.__decorate([I.property({json:{write:!0}})],z.prototype,"statistics",void 0);return z=w=J.__decorate([y.subclass("esri.layers.support.PixelBlock")],z)})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),function(E,J,z,H,C,G){function F(x,A){if(!K.has(x))return null;x=K.get(x);return null==x[A]?null:x[A]}
const K=new Map,I=new H;E.decreaseRefCount=function(x,A,y){if(!K.has(x))return null==A?I.decreaseRefCount(x,y):0;const w=K.get(x);if(null==w[A])return I.decreaseRefCount(x,y);A=w[A].cache;if(A.has(y)){x=A.get(y);x.refCount--;if(0===x.refCount){A.delete(y);for(A=0;A<w.length;A++)w[A]&&w[A].cache.has(y)&&w[A].cache.delete(y);x.controller&&x.controller.abort()}return x.refCount}return 0};E.deleteBlock=function(x,A,y){if(K.has(x)){var w=K.get(x);null==w[A]?I.deleteBlock(x,y):w[A].cache.delete(y)}else null==
A&&I.deleteBlock(x,y)};E.deleteRaster=function(x){K.delete(x)};E.getBlock=function(x,A,y){if(!K.has(x))return null==A?I.getBlock(x,y):null;var w=K.get(x);if(null==w[A]){for(A=0;A<w.length;A++)if(w[A]&&w[A].cache.has(y))return y=w[A].cache.get(y),y.refCount++,y.block;return I.getBlock(x,y)}x=w[A].cache;if(x.has(y))return y=x.get(y),y.refCount++,y.block;for(let b=0;b<w.length;b++)if(b!==A&&w[b]&&w[b]&&w[b].cache.has(y))return w=w[b].cache.get(y),w.refCount++,x.set(y,w),w.block;return null};E.getRasterId=
function(x,A){return null==A?x:`${x}?sliceId=${A}`};E.putBlock=function(x,A,y,w,b=null){if(K.has(x)){var f=K.get(x);if(null==f[A])I.putBlock(x,y,w,b);else{var h={refCount:1,block:w,isResolved:!1,isRejected:!1,controller:b};w.then(()=>h.isResolved=!0).catch(()=>h.isRejected=!0);f[A].cache.set(y,h)}}else null==A&&I.putBlock(x,y,w,b)};E.register=function(x,A){A={extent:null,rasterInfo:A,cache:new Map};if(K.has(x))return x=K.get(x),x.push(A),x.length-1;K.set(x,[A]);return 0};E.unregister=function(x,A){if(K.has(x)){const y=
K.get(x);y[A]=null;y.some(w=>null!=w)||K.delete(x)}};E.update=function(x,A,y,w,b,f,h=null){x=F(x,A);A=x.extent;const {cache:k,rasterInfo:c}=x;if(!A||A.xmin!==y.xmin||A.xmax!==y.xmax||A.ymin!==y.ymin||A.ymax!==y.ymax){A=y.clone().normalize();var {spatialReference:e,transform:n}=c,p=new Set;for(let m=0;m<A.length;m++){var g=A[m];if(g.xmax-g.xmin<=w||g.ymax-g.ymin<=w)continue;var l=C.projectExtent(g,e,h);z.isSome(n)&&(l=n.inverseTransform(l));var a=new G({x:w,y:w,spatialReference:g.spatialReference});
if(null==b&&(b=C.projectResolution(a,e,g,h),!b))return;const {pyramidLevel:r,pyramidResolution:t,excessiveReading:u}=C.snapPyramid(b,c,f||"closest");if(u)return;({storageInfo:g}=c);var {origin:d}=g;a=Math.max(0,Math.floor((l.xmin-d.x)/t.x));d=Math.max(0,Math.floor((d.y-l.ymax)/t.y));const D=0<r?g.pyramidBlockWidth:g.blockWidth,L=0<r?g.pyramidBlockHeight:g.blockHeight;g=Math.max(0,Math.floor(a/D)-1);var q=Math.max(0,Math.floor(d/L)-1);a=Math.floor((a+Math.ceil((l.xmax-l.xmin)/t.x-.1)-1)/D)+1;l=Math.floor((d+
Math.ceil((l.ymax-l.ymin)/t.y-.1)-1)/L)+1;for(d=q;d<=l;d++)for(q=g;q<=a;q++)p.add(`${r}/${d}/${q}`)}k.forEach((m,r)=>{p.has(r)||(m=k.get(r),(null==m||m.isResolved||m.isRejected)&&k.delete(r))});x.extent={xmin:y.xmin,ymin:y.ymin,xmax:y.xmax,ymax:y.ymax}}};Object.defineProperty(E,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function E(z=15E3,H=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=
z;this._interval=Math.min(z,H)}var J=E.prototype;J.decreaseRefCount=function(z,H){z=z+"/"+H;H=this._cachedBlocks;if(H.has(z)){const C=H.get(z);C.refCount--;0>=C.refCount&&(H.delete(z),C.controller&&C.controller.abort());return C.refCount}return 0};J.getBlock=function(z,H){z=z+"/"+H;H=this._cachedBlocks;if(H.has(z)){const C=H.get(z);C.ts=Date.now();C.refCount++;H.delete(z);H.set(z,C);return C.block}return null};J.putBlock=function(z,H,C,G=null){const F=this._cachedBlocks;z=z+"/"+H;F.has(z)?(C=F.get(z),
C.ts=Date.now(),C.refCount++):F.set(z,{block:C,ts:Date.now(),refCount:1,controller:G});this.trim();this.updateTimer()};J.deleteBlock=function(z,H){const C=this._cachedBlocks;z=z+"/"+H;C.has(z)&&C.delete(z)};J.updateMaxSize=function(z){this._size=z;this.trim()};J.empty=function(){this._cachedBlocks.clear();this.clearTimer()};J.getCurrentSize=function(){return this._cachedBlocks.size};J.updateTimer=function(){if(null==this._timer){var z=this._cachedBlocks;this._timer=setInterval(()=>{const H=Array.from(z),
C=Date.now();for(let G=0;G<H.length;G++)if(H[G][1].ts<=C-this._duration)z.delete(H[G][0]);else break;0===z.size&&this.clearTimer()},this._interval)}};J.trim=function(){const z=this._cachedBlocks;if(!(-1===this._size||this._size>=z.size)){var H=Array.from(z);for(let C=0;C<H.length-this._size;C++)z.delete(H[C][0])}};J.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return E}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/webMercatorUtils ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(E,J,z,H,C,G,F,K,I,x){function A(){A=J._asyncToGenerator(function*(){if(F.isLoaded()||!F.isSupported())return null;yield F.load()});return A.apply(this,arguments)}function y(a,d,q,m=null){if(a.spatialReference.equals(d))return a;const r=g(a.spatialReference,d);if(r&&!F.isLoaded())throw new H("rasterprojectionhelper-projectResolution","projection engine is not loaded");q=q.center;a=new I({xmin:q.x-a.x/2,xmax:q.x+a.x/2,ymin:q.y-a.y/2,ymax:q.y+a.y/2,spatialReference:a.spatialReference});d=r?
F.project(a,d,m):K.project(a,d);return null==d?null:{x:d.xmax-d.xmin,y:d.ymax-d.ymin}}function w(a,d=.01){return G.getMetersPerUnitForSR(a)?d/G.getMetersPerUnitForSR(a):0}function b(a,d,q=null,m=!0){const r=a.spatialReference;if(r.equals(d))return a;const t=g(r,d);if(t&&!F.isLoaded())throw new H("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((q=t?F.project(a,d,q):K.project(a,d))&&m&&d.isGeographic){const [u,D]=e(r,!0);(d=w(r))&&null!=u&&null!=D&&(Math.abs(a.x-u)<
d&&5E-4>Math.abs(180-q.x)?q.x-=360:Math.abs(a.x-D)<d&&5E-4>Math.abs(180+q.x)&&(q.x+=360))}return q}function f(a){const d=c(a[0].spatialReference);if(2>a.length||!C.isSome(d))return a[0];let {xmin:q,xmax:m,ymin:r,ymax:t}=a[0];for(let u=1;u<a.length;u++){const D=a[u];m=D.xmax+d*u;r=Math.min(r,D.ymin);t=Math.max(t,D.ymax)}return new I({xmin:q,xmax:m,ymin:r,ymax:t,spatialReference:a[0].spatialReference})}function h(a,d,q=null,m=!0){if(a.spatialReference.equals(d))return a;const r=p(a),t=c(a.spatialReference,
!0);if(!C.isSome(t)||0===r)return k(a,d,q,m);a=a.clone().normalize().map(u=>k(u,d,q,m));return f(a)}function k(a,d,q=null,m=!0){const r=a.spatialReference;if(r.equals(d))return a;var t=g(r,d);if(t&&!F.isLoaded())throw new H("rasterprojectionhelper-projectExtent","projection engine is not loaded");t=t?F.project(a,d,q):K.project(a,d);let [u,D]=e(r,!0);t&&m&&r.isWebMercator&&d.isGeographic&&null!=u&&null!=D&&(.001>Math.abs(a.xmin-u)&&1E3<Math.abs(D-a.xmax)&&5E-4>Math.abs(180-t.xmax)&&(t.xmin=-180,m=
[],m.push(new x(a.xmax,a.ymin,r)),m.push(new x(a.xmax,(a.ymin+a.ymax)/2,r)),m.push(new x(a.xmax,a.ymax,r)),m=m.map(L=>b(L,d,q)).filter(L=>!isNaN(null==L?void 0:L.x)).map(L=>L.x),t.xmax=Math.max.apply(null,m)),.001>Math.abs(a.xmax-D)&&1E3<Math.abs(u-a.xmin)&&5E-4>Math.abs(180+t.xmin)&&(t.xmax=180,m=[],m.push(new x(a.xmin,a.ymin,r)),m.push(new x(a.xmin,(a.ymin+a.ymax)/2,r)),m.push(new x(a.xmin,a.ymax,r)),a=m.map(L=>b(L,d,q)).filter(L=>!isNaN(null==L?void 0:L.x)).map(L=>L.x),t.xmin=Math.min.apply(null,
a)));[u,D]=e(d,!0);(a=w(d))&&null!=u&&null!=D&&(Math.abs(t.xmin-u)<a&&(t.xmin=u),Math.abs(t.xmax-D)<a&&(t.xmax=D));return t}function c(a,d=!1){return a.isWebMercator?2*(d?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*l[a.wkid]||null}function e(a,d=!1){const q=[];a=c(a,d);C.isSome(a)&&(q.push(-a/2),q.push(a/2));return q}function n(a,d,q,m){a=(a-d)/q;0!==a-Math.floor(a)?a=Math.floor(a):m&&--a;return a}function p(a,d=!1){const q=c(a.spatialReference);if(!C.isSome(q))return 0;const m=
d?0:-(q/2);d=n(a.xmax,m,q,!0);a=n(a.xmin,m,q,!1);return d-a}const g=function(a,d){const q=(a.isWGS84||a.isWebMercator)&&(d.isWGS84||d.isWebMercator);return!(a.equals(d)||q)},l={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,
53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,
54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};E.computeProjectedScales=function(a,d,q=512,m=!0){const {extent:r,spatialReference:t,pixelSize:u}=a,D=y(new x({x:u.x,y:u.y,spatialReference:t}),d,r);if(null==D)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var L=(D.x+D.y)/2,
M=G.getMetersPerUnitForSR(d);L=L*M*96*39.37;const R=d.isGeographic?256/q*2.958287637958547E8:256/q*5.91657527591555E8;q=!1;const U=h(r,d);m&&(d.isGeographic||d.isWebMercator)&&(q=0>U.xmin*U.xmax);m=L;if(q)m=R,a=d.isGeographic?1.341104507446289E-6:.29858214164761665,M=96*a*M*39.37,d=y(new x({x:a,y:a,spatialReference:{wkid:d.isGeographic?4326:3857}}),t,U),d.x*=m/M,d.y*=m/M;else{d={x:u.x,y:u.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(M=0;m<.5005*R&&M<a;)M++,m*=2,d.x*=2,d.y*=
2;1.001>=Math.max(m,R)/Math.min(m,R)&&(m=R)}a=[m];M=[{x:d.x,y:d.y}];for(L=Math.min(70.5310735,L)/1.001;m>=L;)m/=2,d.x/=2,d.y/=2,a.push(m),M.push({x:d.x,y:d.y});return{projectedPixelSize:D,scales:a,srcResolutions:M,isCustomTilingScheme:!q}};E.defaultGridSpacing=32;E.getDefaultDatumTransformationForDataset=function(a,d,q){if(!g(a.spatialReference,d))return null;if(!F.isLoaded())throw new H("rasterprojectionhelper-projectResolution","projection engine is not loaded");return q?F.getTransformation(d,a.spatialReference,
a):F.getTransformation(a.spatialReference,d,a)};E.getProjectionOffsetGrid=function(a,d,q,m=null,r=null,t=!1,u=[32,32]){if(g(a.spatialReference,d.spatialReference)&&!F.isLoaded())throw new H("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&d&&q))return null;const {xmin:D,ymin:L,xmax:M,ymax:R}=a;var U=a.spatialReference,Q=d.spatialReference,v=c(Q);t=t||"gcs-shift"===(null==r?void 0:r.type);var B=u[0]*q.x,O=u[1]*q.y;q=Math.ceil((M-D)/B-.1)+1;a=Math.ceil((R-L)/O-.1)+
1;const N=[];let W=!1;for(var P=0;P<q;P++){var S=[];for(var T=0;T<a;T++){var V=new x({x:D+B*P,y:R-O*T,spatialReference:U});V=b(V,Q,m);r&&(V=r.inverseTransform(V));S.push(V);0<P&&t&&V&&X[T]&&C.isSome(v)&&V.x<X[T].x&&(V.x+=v);V?(N.push((V.x-d.xmin)/(d.xmax-d.xmin)),N.push((d.ymax-V.y)/(d.ymax-d.ymin))):(N.push(NaN),N.push(NaN),W=!0)}var X=S}d=[Math.abs((N[0]+N[4]+N[4*q]+N[4*q+4])/4-N[2*a+2]),Math.abs((N[1]+N[5]+N[4*a+1]+N[4*a+5])/4-N[2*a+3])];m=new Float32Array((q-1)*(a-1)*12);r=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]);t=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(X=0;X<q-1;X++){for(U=0;U<a-1;U++){S=X*a*2+2*U;B=N[S];Q=N[S+1];var Y=N[S+2],Z=N[S+3];S+=2*a;O=N[S];v=N[S+1];P=N[S+2];S=N[S+3];T=0;V=12*(U*(q-1)+X);for(let aa=0;3>aa;aa++)m[V++]=r[T++]*B+r[T++]*Y+r[T++]*P;T=0;for(Y=0;3>Y;Y++)m[V++]=r[T++]*Q+r[T++]*Z+r[T++]*S;T=0;for(Z=0;3>Z;Z++)m[V++]=t[T++]*B+t[T++]*O+t[T++]*P;T=0;for(B=0;3>B;B++)m[V++]=t[T++]*Q+t[T++]*v+t[T++]*S}if(W)for(U=0;U<m.length;U++)isNaN(m[U])&&(m[U]=-1)}return{offsets:N,
error:d,coefficients:m,spacing:u,size:[q-1,a-1]}};E.getRasterDatasetAlignmentInfo=function(a){const d=a.storageInfo.origin.x,q=c(a.spatialReference,!0);if(!C.isSome(q))return{originX:d,halfWorldWidth:null,pyramidsInfo:null};const m=q/2,{nativePixelSize:r,storageInfo:t,extent:u}=a,{maximumPyramidLevel:D,blockWidth:L,pyramidScalingFactor:M}=t;let R=r.x;const U=[];a=C.isSome(a.transform)&&"gcs-shift"===a.transform.type;const Q=d+m,v=a?q-d:m-d;for(let B=0;B<=D;B++){const O=(u.xmax-d)/R/L,N=(q/2-d)/R/
L;U.push({resolutionX:R,blockWidth:L,datsetColumnCount:0===O-Math.floor(O)?O:Math.ceil(O),worldColumnCountFromOrigin:0===N-Math.floor(N)?N:Math.ceil(N),leftMargin:Math.round(Q/R)%L,rightPadding:(L-Math.round(v/R)%L)%L,originColumnOffset:Math.floor(Q/R/L)});R*=M}return{originX:d,halfWorldWidth:m,pyramidsInfo:U,hasGCSSShiftTransform:a}};E.getWorldWrapCount=p;E.load=function(){return A.apply(this,arguments)};E.projectExtent=h;E.projectPoint=b;E.projectResolution=y;E.snapExtent=function(a){a=a.clone().normalize();
return 1===a.length?a[0]:f(a)};E.snapPyramid=function(a,d,q){const {storageInfo:m,pixelSize:r}=d;let t=!1;var {pyramidResolutions:u}=m;if(C.isSome(u)&&u.length){a=(a.x+a.y)/2;var D=u[u.length-1];D=(D.x+D.y)/2;var L=(r.x+r.y)/2;if(a<=L)var M=0;else if(a>=D)M=u.length,t=8<a/D;else{D=L;for(let R=1;R<=u.length;R++){L=(u[R-1].x+u[R-1].y)/2;if(a<=L){a===L?M=R:"down"===q?(M=R-1,t=8<a/D):M="up"===q?R:a-D>L-a||2<a/D?R:R-1;break}D=L}}q=0===M?r:u[M-1];return{pyramidLevel:M,pyramidResolution:new x({x:q.x,y:q.y,
spatialReference:d.spatialReference}),excessiveReading:t}}M=Math.log(a.x/r.x)/Math.LN2;a=Math.log(a.y/r.y)/Math.LN2;u=d.storageInfo.maximumPyramidLevel||0;M="down"===q?Math.floor(Math.min(M,a)):"up"===q?Math.ceil(Math.max(M,a)):Math.round((M+a)/2);0>M?M=0:M>u&&(t=M>u+3,M=u);q=2**M;d=new x({x:q*d.nativePixelSize.x,y:q*d.nativePixelSize.y,spatialReference:d.spatialReference});return{pyramidLevel:M,pyramidResolution:d,excessiveReading:t}};Object.defineProperty(E,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports",
"../PixelBlock"],function(E,J){function z(b,f){b=Math.min(Math.max(b,-100),100);f=Math.min(Math.max(f,-100),100);let h,k;const c=new Uint8Array(256);for(h=0;256>h;h++)0<b&&100>b?k=(200*h-25500+510*f)/(2*(100-b))+128:0>=b&&-100<b?k=(200*h-25500+510*f)*(100+b)/2E4+128:100===b?(k=200*h-25500+256*(100-b)+510*f,k=0<k?255:0):-100===b&&(k=128),c[h]=255<k?255:0>k?0:k;return c}function H(b,f,h,k,c,e,n,p){return{xmin:c<=h*b?0:c<h*b+b?c-h*b:b,ymin:e<=k*f?0:e<k*f+f?e-k*f:f,xmax:c+n<=h*b?0:c+n<h*b+b?c+n-h*b:b,
ymax:e+p<=k*f?0:e+p<k*f+f?e+p-k*f:f}}function C(b,f,h,k,c,e){const {width:n,height:p}=h.block,{x:g,y:l}=h.offset,{width:a,height:d}=h.mosaic;h=H(n,p,k,c,g,l,a,d);let q=0;var m=0;if(e){var r=e.hasGCSSShiftTransform?360:e.halfWorldWidth,t=n*e.resolutionX,u=e.startX+k*t;t=u+t;u<r&&t>r?m=e.rightPadding:u>=r&&(q=e.leftMargin-e.rightPadding,m=0)}h.xmax-=m;if("number"===typeof f)for(e=h.ymin;e<h.ymax;e++)for(m=(c*p+e-l)*a+(k*n-g)+q,r=h.xmin;r<h.xmax;r++)b[m+r]=f;else for(e=h.ymin;e<h.ymax;e++)for(m=(c*p+
e-l)*a+(k*n-g)+q,r=e*n,u=h.xmin;u<h.xmax;u++)b[m+u]=f[r+u]}function G(b,f,h,k,c){var e=b.filter(t=>w(t))[0];if(null==e)return null;const n=k?k.width:f.width,p=k?k.height:f.height;var g=e.width,l=e.height;const a=f.width/g,d=f.height/l;f={offset:h||{x:0,y:0},mosaic:k||f,block:{width:g,height:l}};h=e.pixelType;k=J.getPixelArrayConstructor(h);g=e.pixels.length;e=[];for(var q=0;q<g;q++){l=new k(n*p);for(let t=0;t<d;t++)for(let u=0;u<a;u++){var m=b[t*a+u];w(m)&&(m=m.pixels[q],C(l,m,f,u,t,c))}e.push(l)}let r;
if(b.some(t=>null==t||t.mask&&0<t.mask.length))for(r=new Uint8Array(n*p),k=0;k<d;k++)for(g=0;g<a;g++)(q=(l=b[k*a+g])?l.mask:null)?C(r,q,f,g,k,c):l?C(r,1,f,g,k,c):C(r,0,f,g,k,c);b=new J({width:n,height:p,pixels:e,pixelType:h,mask:r});b.updateStatistics();return b}function F(b){if(!w(b))return null;const f=b.clone(),{width:h,height:k,pixels:c,mask:e}=b;var n=c[0];b=f.pixels[0];for(let l=2;l<k-1;l++){const a=new Map;for(var p=l-2;p<l+2;p++)for(var g=0;4>g;g++){const d=p*h+g;x(a,n[d],e?e[d]:1)}b[l*h]=
K(a);b[l*h+1]=b[l*h+2]=b[l*h];for(p=3;p<h-1;p++)g=(l-2)*h+p+1,x(a,n[g],e?e[g]:1),g=(l-1)*h+p+1,x(a,n[g],e?e[g]:1),g=l*h+p+1,x(a,n[g],e?e[g]:1),g=(l+1)*h+p+1,x(a,n[g],e?e[g]:1),g=(l-2)*h+p-3,I(a,n[g],e?e[g]:1),g=(l-1)*h+p-3,I(a,n[g],e?e[g]:1),g=l*h+p-3,I(a,n[g],e?e[g]:1),g=(l+1)*h+p-3,I(a,n[g],e?e[g]:1),b[l*h+p]=K(a);b[l*h+p+1]=b[l*h+p]}for(n=0;n<h;n++)b[n]=b[h+n]=b[2*h+n],b[(k-1)*h+n]=b[(k-2)*h+n];f.updateStatistics();return f}function K(b){if(0===b.size)return 0;let f=0,h=-1,k=0;const c=b.keys();
let e=c.next();for(;!e.done;)k=b.get(e.value),k>f&&(h=e.value,f=k),e=c.next();return h}function I(b,f,h){0!==h&&(h=b.get(f),1===h?b.delete(f):b.set(f,h-1))}function x(b,f,h){0!==h&&b.set(f,b.has(f)?b.get(f)+1:1)}function A(b,f,h){let {x:k,y:c}=f;const {width:e,height:n}=h;if(0===k&&0===c&&n===b.height&&e===b.width)return b;const {width:p,height:g}=b;f=Math.max(0,c);const l=Math.max(0,k),a=Math.min(k+e,p),d=Math.min(c+n,g);if(0>a||0>d||!w(b))return null;k=Math.max(0,-k);c=Math.max(0,-c);const {pixels:q,
mask:m}=b;var r=e*n,t=q.length;const u=[];for(var D=0;D<t;D++){var L=q[D],M=J.createEmptyBand(b.pixelType,r);for(let R=f;R<d;R++){const U=R*p;let Q=(R+c-f)*e+k;for(let v=l;v<a;v++)M[Q++]=L[U+v]}u.push(M)}r=new Uint8Array(r);for(t=f;t<d;t++)for(D=t*p,L=(t+c-f)*e+k,M=l;M<a;M++)r[L++]=m?m[D+M]:1;b=new J({width:h.width,height:h.height,pixelType:b.pixelType,pixels:u,mask:r});b.updateStatistics();return b}function y(b,f=!0){if(!w(b))return null;const {pixels:h,width:k,height:c,mask:e,pixelType:n}=b;b=[];
const p=Math.round(k/2),g=Math.round(c/2),l=c-1,a=k-1;for(var d=0;d<h.length;d++){var q=h[d],m=J.createEmptyBand(n,p*g),r=0;for(var t=0;t<c;t+=2)for(var u=0;u<k;u+=2){var D=q[t*k+u];if(f){var L=u===a?D:q[t*k+u+1];const M=t===l?D:q[t*k+u+k],R=u===a?M:t===l?L:q[t*k+u+k+1];m[r++]=(D+L+M+R)/4}else m[r++]=D}b.push(m)}d=null;if(e)for(d=new Uint8Array(p*g),q=0,m=0;m<c;m+=2)for(r=0;r<k;r+=2)t=e[m*k+r],f?(u=r===a?t:e[m*k+r+1],D=m===l?t:e[m*k+r+k],L=r===a?D:m===l?u:e[m*k+r+k+1],d[q++]=t*u*D*L?1:0):d[q++]=t;
return new J({width:p,height:g,pixelType:n,pixels:b,mask:d})}const w=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};E.approximateTransform=function(b,f,h,k,c="nearest"){if(!w(b))return null;"majority"===c&&(b=F(b));const {pixels:e,mask:n,pixelType:p}=b,g=b.width;var l=b.height;b=J.getPixelArrayConstructor(p);var a=e.length;const {width:d,height:q}=f;f=k.cols;var m=k.rows;const r=Math.ceil(d/f),t=Math.ceil(q/m);k=!1;for(var u=0;u<h.length;u+=
3)-1===h[u]&&-1===h[u+1]&&-1===h[u+2]&&(k=!0);let D,L,M,R,U,Q;const v=new Float32Array(d*q),B=new Float32Array(d*q);u=0;let O,N;const W="majority"===c?0:.5;for(let T=0;T<t;T++)for(let V=0;V<r;V++){D=12*(T*r+V);c=h[D];L=h[D+1];M=h[D+2];R=h[D+3];U=h[D+4];Q=h[D+5];for(var P=0;P<m;P++){u=(T*m+P)*d+V*f;N=(P+.5)/m;for(var S=0;S<P;S++)O=(S+.5)/f,v[u+S]=Math.round((c*O+L*N+M)*g-W),B[u+S]=Math.round((R*O+U*N+Q)*l-W)}D+=6;c=h[D];L=h[D+1];M=h[D+2];R=h[D+3];U=h[D+4];Q=h[D+5];for(P=0;P<m;P++)for(u=(T*m+P)*d+V*
f,N=(P+.5)/m,S=P;S<f;S++)O=(S+.5)/f,v[u+S]=Math.round((c*O+L*N+M)*g-W),B[u+S]=Math.round((R*O+U*N+Q)*l-W)}h=(T,V)=>{for(let X=0;X<q;X++){D=X*d;for(let Y=0;Y<d;Y++)T[D]=0>v[D]||0>B[D]?0:V[v[D]+B[D]*g],D++}};l=[];for(m=0;m<a;m++)f=new b(d*q),h(f,e[m]),l.push(f);b=new J({width:d,height:q,pixelType:p,pixels:l});if(n)b.mask=new Uint8Array(d*q),h(b.mask,n);else if(k)for(b.mask=new Uint8Array(d*q),a=0;a<d*q;a++)b.mask[a]=0>v[a]||0>B[a]?0:1;b.updateStatistics();return b};E.clip=A;E.colorize=function(b,f){if(!w(b)||
!f&&(f.indexedColormap||f.indexed2DColormap))return b;const h=b.clone();var k=h.pixels;let c=h.mask;const e=h.width*h.height;if(1!==k.length)return b;const {indexedColormap:n,indexed2DColormap:p,offset:g,alphaSpecified:l}=f;f=n.length-1;b=0;k=k[0];const a=new Uint8Array(k.length),d=new Uint8Array(k.length),q=new Uint8Array(k.length);let m=0;if(n)if(c)for(b=0;b<e;b++)c[b]&&(m=4*(k[b]-g),m<g||m>f?c[b]=0:(a[b]=n[m],d[b]=n[m+1],q[b]=n[m+2],c[b]=n[m+3]));else{c=new Uint8Array(e);for(b=0;b<e;b++)m=4*(k[b]-
g),m<g||m>f?c[b]=0:(a[b]=n[m],d[b]=n[m+1],q[b]=n[m+2],c[b]=n[m+3]);h.mask=c}else if(c)for(b=0;b<e;b++)c[b]&&(f=p[k[b]],a[b]=f[0],d[b]=f[1],q[b]=f[2],c[b]=f[3]);else{c=new Uint8Array(e);for(b=0;b<e;b++)f=p[k[b]],a[b]=f[0],d[b]=f[1],q[b]=f[2],c[b]=f[3];h.mask=c}h.pixels=[a,d,q];h.statistics=null;h.pixelType="u8";h.maskIsAlpha=l;return h};E.createColormapLUT=function(b){if(b){var f=b.colormap;if(f&&0!==f.length){f=f.sort((l,a)=>l[0]-a[0]);var h=0;0>f[0][0]&&(h=f[0][0]);var k=Math.max(256,f[f.length-
1][0]-h+1),c=new Uint8Array(4*k),e=[],n=0,p=0,g=5===f[0].length;if(65536<k)return f.forEach(l=>{e[l[0]-h]=g?l.slice(1):l.slice(1).concat([255])}),{indexed2DColormap:e,offset:h,alphaSpecified:g};if(b.fillUnspecified)for(b=f[p],n=b[0]-h;n<k;n++)c[4*n]=b[1],c[4*n+1]=b[2],c[4*n+2]=b[3],c[4*n+3]=g?b[4]:255,n===b[0]-h&&(b=p===f.length-1?b:f[++p]);else for(n=0;n<f.length;n++)b=f[n],p=4*(b[0]-h),c[p]=b[1],c[p+1]=b[2],c[p+2]=b[3],c[p+3]=g?b[4]:255;return{indexedColormap:c,offset:h,alphaSpecified:g}}}};E.createContrastBrightnessLUT=
z;E.createHistogramEqualizationLUT=function(b,f=256){f=Math.min(f,256);const {size:h,counts:k}=b;b=new Uint8Array(h);var c=k.reduce((l,a)=>l+a/f,0);let e=0;var n=0;let p=0,g=c;for(let l=0;l<h;l++)if(p+=k[l],!(l<h-1&&p+k[l+1]<g)){for(;e<f-1&&g<p;)e++,g+=c;for(;n<=l;n++)b[n]=e;n=l+1}for(c=n;c<h;c++)b[c]=f-1;return b};E.createStretchLUT=function(b){const {minCutOff:f,maxCutOff:h,gamma:k,pixelType:c}=b,e=b.outMin||0,n=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(c))return null;const p=f.length;
let g;let l=0;"s8"===c?l=-127:"s16"===c&&(l=-32767);let a=256;-1<["u16","s16"].indexOf(c)&&(a=65536);const d=[],q=n-e;for(g=0;g<p;g++)d[g]=h[g]-f[g];var m=k&&k.length>=p;const r=[];if(m)for(g=0;g<p;g++)r[g]=1<k[g]?2<k[g]?6.5+(k[g]-2)**2.5:6.5+100*(2-k[g])**4:1;let t;const u=[];let D,L,M;if(m)for(g=0;g<p;g++){M=[];for(m=0;m<a;m++)D=m+l,t=(D-f[g])/d[g],L=1,1<k[g]&&(L-=(1/q)**(t*r[g])),M[m]=D<h[g]&&D>f[g]?Math.floor(L*q*t**(1/k[g]))+e:D>=h[g]?n:e;u[g]=M}else for(g=0;g<p;g++){M=[];for(m=0;m<a;m++)D=m+
l,M[m]=D<=f[g]?e:D>=h[g]?n:Math.floor((D-f[g])/d[g]*q)+e;u[g]=M}if(null!=b.contrastOffset)for(b=z(b.contrastOffset,b.brightnessOffset),g=0;g<p;g++)for(M=u[g],m=0;m<a;m++)M[m]=b[M[m]];return{lut:u,offset:l}};E.estimateStatisticsFromHistograms=function(b){const f=[];for(let e=0;e<b.length;e++){const {min:n,max:p,size:g,counts:l}=b[e];let a=0;var h=0;for(var k=0;k<g;k++)a+=l[k],h+=k*l[k];h/=a;k=0;for(var c=0;c<g;c++)k+=l[c]*(c-h)**2;c=(p-n)/g;f.push({min:n,max:p,avg:(h+.5)*c+n,stddev:Math.sqrt(k/(a-
1))*c})}return f};E.estimateStatisticsHistograms=function(b){if(!w(b))return null;b.statistics||b.updateStatistics();const {pixels:f,mask:h,pixelType:k,statistics:c}=b;b=b.width*b.height;const e=f.length;let n,p;let g;var l;const a=[],d=[];for(g=0;g<e;g++){var q=new Uint32Array(256);var m=f[g];if("u8"===k)if(n=-.5,p=255.5,h)for(l=0;l<b;l++)h[l]&&q[m[l]]++;else for(l=0;l<b;l++)q[m[l]]++;else{n=c[g].minValue;p=c[g].maxValue;var r=(p-n)/256;var t=new Uint32Array(257);if(h)for(l=0;l<b;l++)h[l]&&t[Math.floor((m[l]-
n)/r)]++;else for(l=0;l<b;l++)t[Math.floor((m[l]-n)/r)]++;for(l=0;255>l;l++)q[l]=t[l];q[255]=t[255]+t[256]}a.push({min:n,max:p,size:256,counts:q});for(l=m=t=r=0;256>l;l++)r+=q[l],t+=l*q[l];t/=r;for(l=0;256>l;l++)m+=q[l]*(l-t)**2;q=Math.sqrt(m/(r-1));r=(p-n)/256;l=(t+.5)*r+n;q*=r;d.push({min:n,max:p,avg:l,stddev:q})}return{statistics:d,histograms:a}};E.extractBands=function(b,f){if(null==f||!f.length||!w(b))return b;const h=b.pixels.length;return f&&f.some(k=>k>=h)||1===h&&1===f.length&&0===f[0]||
h===f.length&&!f.some((k,c)=>k!==c)?b:new J({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:f.map(k=>b.pixels[k]),statistics:b.statistics&&f.map(k=>b.statistics[k])})};E.getClipBounds=H;E.lookupPixels=function(b,f){if(!w(b))return null;const {pixels:h,mask:k}=b,c=b.width*b.height,e=h.length;let n=f.lut;({offset:f}=f);let p,g;n&&1===n[0].length&&(n=h.map(()=>n));const l=[];let a,d,q;if(f)if(null==k)for(p=0;p<e;p++){a=
h[p];d=n[p];q=new Uint8Array(c);for(g=0;g<c;g++)q[g]=d[a[g]-f];l.push(q)}else for(p=0;p<e;p++){a=h[p];d=n[p];q=new Uint8Array(c);for(g=0;g<c;g++)k[g]&&(q[g]=d[a[g]-f]);l.push(q)}else if(null==k)for(p=0;p<e;p++){a=h[p];d=n[p];q=new Uint8Array(c);for(g=0;g<c;g++)q[g]=d[a[g]];l.push(q)}else for(p=0;p<e;p++){a=h[p];d=n[p];q=new Uint8Array(c);for(g=0;g<c;g++)k[g]&&(q[g]=d[a[g]]);l.push(q)}b=new J({width:b.width,height:b.height,pixels:l,mask:k,pixelType:"u8"});b.updateStatistics();return b};E.mosaic=G;
E.mosaicPixelData=function(b,f){if(!b||0===b.length)return null;var h=b.filter(d=>d.pixelBlock)[0];if(!h)return null;var k=(h.extent.xmax-h.extent.xmin)/h.pixelBlock.width;const c=(h.extent.ymax-h.extent.ymin)/h.pixelBlock.height,e=.01*Math.min(k,c),n=b.sort((d,q)=>Math.abs(d.extent.ymax-q.extent.ymax)>e?q.extent.ymax-d.extent.ymax:Math.abs(d.extent.xmin-q.extent.xmin)>e?d.extent.xmin-q.extent.xmin:0);var p=Math.min.apply(null,n.map(d=>d.extent.xmin));const g=Math.min.apply(null,n.map(d=>d.extent.ymin)),
l=Math.max.apply(null,n.map(d=>d.extent.xmax)),a=Math.max.apply(null,n.map(d=>d.extent.ymax));b={x:Math.round((f.xmin-p)/k),y:Math.round((a-f.ymax)/c)};p={width:Math.round((l-p)/k),height:Math.round((a-g)/c)};k={width:Math.round((f.xmax-f.xmin)/k),height:Math.round((f.ymax-f.ymin)/c)};if(Math.round(p.width/h.pixelBlock.width)*Math.round(p.height/h.pixelBlock.height)!==n.length||0>b.x||0>b.y||p.width<k.width||p.height<k.height)return null;h=n.map(d=>d.pixelBlock);h=G(h,p,b,k);return{extent:f,pixelBlock:h}};
E.remapColor=function(b,f){if(!w(b))return null;b=b.clone();var {pixels:h}=b;const k=b.width*b.height,c=f.length,e=Math.floor(c/2),n=f[Math.floor(e)];h=h[0];let p,g,l,a,d,q,m=!1;const r=new Uint8Array(k),t=new Uint8Array(k),u=new Uint8Array(k);let D=b.mask;const L=4===f[0].mappedColor.length;D||(D=new Uint8Array(k),D.fill(L?255:1),b.mask=D);for(d=0;d<k;d++)if(D[d]){p=h[d];m=!1;q=e;g=n;l=0;for(a=c-1;1<a-l;){if(p===g.value){m=!0;break}p>g.value?l=q:a=q;q=Math.floor((l+a)/2);g=f[Math.floor(q)]}m||(p===
f[l].value?(g=f[l],m=!0):p===f[a].value?(g=f[a],m=!0):p<f[l].value?(m=!1,g=null):p>f[l].value&&(p<f[a].value?(g=f[l],m=!0):a===c-1?(m=!1,g=null):(g=f[a],m=!0)));m?(r[d]=g.mappedColor[0],t[d]=g.mappedColor[1],u[d]=g.mappedColor[2],D[d]=g.mappedColor[3]):r[d]=t[d]=u[d]=D[d]=0}b.pixels=[r,t,u];b.mask=D;b.pixelType="u8";b.maskIsAlpha=L;return b};E.resampleByMajority=F;E.setValidBoundary=function(b,f,h){if(!w(b))return null;const {width:k,height:c}=b,e=f.x;f=f.y;const n=h.width+e;h=h.height+f;if(0>e||
0>f||n>k||h>c||0===e&&0===f&&n===k&&h===c)return b;b.mask||(b.mask=new Uint8Array(k*c));const p=b.mask;for(let g=0;g<c;g++){const l=g*k;for(let a=0;a<k;a++)p[l+a]=g<f||g>=h||a<e||a>=n?0:1}b.updateStatistics();return b};E.split=function(b,f,h){if(!w(b))return null;const {width:k,height:c}=f;let {width:e,height:n}=b;const p=new Map,g={x:0,y:0};h=null==h?1:1+h;for(let l=0;l<h;l++){const a=Math.ceil(e/k),d=Math.ceil(n/c);for(let q=0;q<d;q++){g.y=q*c;for(let m=0;m<a;m++){g.x=m*k;const r=A(b,g,f);p.set(`${l}/${q}/${m}`,
r)}}l<h-1&&(b=y(b));e=Math.round(e/2);n=Math.round(n/2)}return p};E.stretch=function(b,f){if(!w(b))return null;b=b.clone();const {pixels:h,mask:k}=b,{minCutOff:c,maxCutOff:e,gamma:n}=f,p=f.outMin||0;f=f.outMax||255;const g=b.width*b.height,l=h.length;let a;let d,q,m;const r=f-p,t=[];for(a=0;a<l;a++)t[a]=e[a]-c[a];var u=n&&n.length>=l;const D=[];if(u)for(a=0;a<l;a++)D[a]=1<n[a]?2<n[a]?6.5+(n[a]-2)**2.5:6.5+100*(2-n[a])**4:1;if(u)if(null!=k)for(u=0;u<g;u++){if(k[u])for(a=0;a<l;a++)d=h[a][u],m=(d-c[a])/
t[a],q=1,1<n[a]&&(q-=(1/r)**(m*D[a])),h[a][u]=d<e[a]&&d>c[a]?Math.floor(q*r*m**(1/n[a]))+p:d>=e[a]?f:p}else for(u=0;u<g;u++)for(a=0;a<l;a++)d=h[a][u],m=(d-c[a])/t[a],q=1,1<n[a]&&(q-=(1/r)**(m*D[a])),h[a][u]=d<e[a]&&d>c[a]?Math.floor(q*r*m**(1/n[a]))+p:d>=e[a]?f:p;else if(null!=k)for(u=0;u<g;u++){if(k[u])for(a=0;a<l;a++)d=h[a][u],h[a][u]=d<e[a]&&d>c[a]?Math.floor((d-c[a])/t[a]*r)+p:d>=e[a]?f:p}else for(u=0;u<g;u++)for(a=0;a<l;a++)d=h[a][u],h[a][u]=d<e[a]&&d>c[a]?Math.floor((d-c[a])/t[a]*r)+p:d>=e[a]?
f:p;b.pixelType="u8";b.updateStatistics();return b};Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ../viewpointUtils ./brushes ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),function(E,J,z,H,C,G,F,K){K=function(I){function x(){var y=I.apply(this,arguments)||this;y.isCustomTilingScheme=!1;return y}J._inheritsLoose(x,I);var A=x.prototype;
A.createTile=function(y){const w=this._getTileBounds(y);return new G.RasterTile(y,w,this._tileInfoView.tileInfo.size)};A.destroyTile=function(){};A.prepareRenderPasses=function(y){const w=y.registerRenderPass({name:"bitmap (tile)",brushes:[C.brushes.raster],target:()=>this.children.map(b=>b.bitmap),drawPhase:F.WGLDrawPhase.MAP});return[...I.prototype.prepareRenderPasses.call(this,y),w]};A.doRender=function(y){this.visible&&y.drawPhase===F.WGLDrawPhase.MAP&&I.prototype.doRender.call(this,y)};A._getTileBounds=
function(y){const w=this._tileInfoView.getTileBounds(z.create(),y);if(this.isCustomTilingScheme&&y.world){var {tileInfo:b}=this._tileInfoView,f=H.getWorldWidth(b.spatialReference);if(f){const {resolution:h}=b.lodAt(y.level);b=(f=f/h%b.size[0])?(b.size[0]-f)*h:0;w[0]-=b*y.world;w[2]-=b*y.world}}return w};return x}(K["default"]);E.RasterTileContainer=K;Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"./RasterBitmap","./webgl/TiledDisplayObject"],function(E,J,z,H){H=function(C){function G(K,I,x,A=null){var y=C.call(this,K,I,x)||this;y.bitmap=new z.RasterBitmap(A,null,null);y.bitmap.coordScale=x;y.bitmap.once("isReady",()=>y.ready());return y}J._inheritsLoose(G,C);var F=G.prototype;F.destroy=function(){C.prototype.destroy.call(this);this.bitmap.destroy();this.stage=this.bitmap=null};F.getMemoryUsage=function(){return this.bitmap.getMemoryUsage()};F.setTransform=function(K,I){C.prototype.setTransform.call(this,
K,I);this.bitmap.transforms.dvs=this.transforms.dvs};F.onAttach=function(){this.bitmap.stage=this.stage};F.onDetach=function(){this.bitmap.stage=null};J._createClass(G,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(K){this.bitmap.stencilRef=K}}]);return G}(H.TiledDisplayObject);E.RasterTile=H;Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterBitmap":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ../../../layers/support/rasterFunctions/pixelUtils ./DisplayObject ../../webgl/rasterUtils".split(" "),
function(E,J,z,H,C,G,F,K,I){const x={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};K=function(A){function y(b=null,f=null,h=null){var k=A.call(this)||this;k._textureInvalidated=!0;k._memoryUsed=null;k._supportsBilinear=!0;k.stencilRef=0;k.coordScale=[1,1];k._symbolizerParameters=null;k.height=null;k.isRendereredSource=!1;k.pixelRatio=1;k.resolution=
0;k.rotation=0;k._source=null;k.rawPixelData=null;k._suspended=!1;k._bandIds=null;k._interpolation=null;k._transformGrid=null;k.width=null;k.x=0;k.y=0;k.transforms={dvs:C.create()};k.source=b;k.transformGrid=f;k.interpolation=h;return k}J._inheritsLoose(y,A);var w=y.prototype;w.destroy=function(){const b=this.getTextures();null==b?void 0:b.textures.forEach(f=>f.dispose());this._colormapTexture=this._transformGridTexture=this._rasterTexture=null};w.invalidateTexture=function(){this._textureInvalidated||
(this._textureInvalidated=!0,this.requestRender())};w.setTransform=function(b){const f=H.identity(this.transforms.dvs),[h,k]=b.toScreenNoRotation([0,0],this.x,this.y);var c=this.resolution/this.pixelRatio/b.resolution;const e=c*this.width;c*=this.height;const n=Math.PI*this.rotation/180;H.translate(f,f,G.fromValues(h,k));H.translate(f,f,G.fromValues(e/2,c/2));H.rotate(f,f,-n);H.translate(f,f,G.fromValues(-e/2,-c/2));H.scaleByVec2(f,f,G.fromValues(e,c));H.multiply(this.transforms.dvs,b.displayViewMat3,
f)};w.getTextures=function(){if(!this._rasterTexture)return null;const b=[],f=[];this._transformGridTexture&&(f.push(this._transformGridTexture),b.push("u_transformGrid"));this._rasterTexture&&(f.push(this._rasterTexture),b.push("u_image"));this._colormapTexture&&(f.push(this._colormapTexture),b.push("u_colormap"));return{names:b,textures:f}};w.getMemoryUsage=function(){if(z.isNone(this._memoryUsed)){const b=this.getTextures();if(null==b)return 0;this._memoryUsed=b.textures.map(f=>f.descriptor.width*
f.descriptor.height*4).reduce((f,h)=>f+h)}return this._memoryUsed};w.onAttach=function(){this.invalidateTexture()};w.onDetach=function(){this.invalidateTexture()};w.updateTexture=function({context:b}){if(this.stage)this._textureInvalidated&&(this._textureInvalidated=!1,f=(f=this.source)&&f.pixels&&0<f.pixels.length,this._createOrDestroyRasterTexture(b),this._rasterTexture&&(f?(this._updateColormapTexture(b),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=I.createTransformTexture(b,
this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()));else{var f,h,k;null==(f=this._rasterTexture)?void 0:f.dispose();null==(h=this._transformGridTexture)?void 0:h.dispose();null==(k=this._colormapTexture)?void 0:k.dispose();this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null}};w._createOrDestroyRasterTexture=function(b){var f,h;const k=this.source?F.extractBands(this.source,this.bandIds):null;
if(k&&k.pixels&&0<k.pixels.length){var c=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(c)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}c=this.interpolation||"nearest";var e=this.isRendereredSource||!(null!=(f=b.capabilities.textureFloat)&&f.textureFloat);this._rasterTexture=I.createRasterTexture(b,k,c,e);this._supportsBilinear=
null==(h=b.capabilities.textureFloat)?void 0:h.textureFloatLinear;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};w._updateColormapTexture=function(b){const f=this._colormap,h=this.symbolizerParameters.colormap;if(!h)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!f)this._colormapTexture=I.createColormapTexture(b,
h),this._colormap=h;else if(h.length!==f.length||h.some((k,c)=>k!==f[c]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=I.createColormapTexture(b,h),this._colormap=h};J._createClass(y,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||x},set:function(b){this._symbolizerParameters=b}},{key:"source",get:function(){return this._source},set:function(b){this._source=b;this._rasterTexture&&(this._rasterTexture.dispose(),
this._memoryUsed=this._rasterTextureBandIds=this._rasterTexture=null)}},{key:"suspended",get:function(){return this._suspended},set:function(b){this._suspended&&!b&&this.stage&&(this.ready(),this.requestRender());this._suspended=b}},{key:"bandIds",get:function(){return this._bandIds},set:function(b){this._bandIds=b;this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(b){this._interpolation=b;this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||
"bilinear"!==b&&"cubic"!==b?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(b){this._transformGrid=b;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}}]);return y}(K.DisplayObject);E.RasterBitmap=K;Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(E,J,z,H,C,G,F,K,I,x,A,y,w,b,f,h,k){const c=H.ofType({key:"type",base:b,typeMap:{rect:f,path:k,geometry:h}});E.LayerView2DMixin=e=>{e=function(n){function p(){var l=n.apply(this,arguments)||this;l.clips=new c;l.moving=!1;l.attached=!1;l.lastUpdateId=-1;l.updateRequested=!1;return l}J._inheritsLoose(p,n);var g=p.prototype;g.initialize=function(){var l;this.container||(this.container=new w.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([G.init(this,"suspended",a=>{this.container&&(this.container.visible=!a);this.view&&!a&&this.updateRequested&&this.view.requestUpdate()},!0),G.init(this,["layer.opacity","container"],()=>{if(this.container){var a,d;this.container.opacity=null!=(a=null==(d=this.layer)?void 0:d.opacity)?a:1}},!0),G.init(this,["layer.blendMode"],a=>{this.container&&(this.container.blendMode=a)},!0),G.init(this,["layer.effect"],a=>{this.container&&(this.container.effect=a)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(l=this.view)&&l.whenLayerView?this.view.whenLayerView(this.layer).then(a=>{a!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};g.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};g.isVisibleAtScale=
function(l){var a=!0,d=this.layer;const q=d.minScale;d=d.maxScale;if(null!=q&&null!=d){a=!q;let m=!d;!a&&l<=q&&(a=!0);!m&&l>=d&&(m=!0);a=a&&m}return a};g.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};g.processUpdate=function(l){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",l),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(l)))};g.isUpdating=
function(){return!1};g.isRendering=function(){return!1};g.canResume=function(){return n.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};J._createClass(p,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return p}(e);z.__decorate([F.property({type:c,set(n){n=C.referenceSetter(n,this._get("clips"),c);this._set("clips",n)}})],e.prototype,"clips",void 0);z.__decorate([F.property()],e.prototype,"moving",void 0);
z.__decorate([F.property()],e.prototype,"attached",void 0);z.__decorate([F.property()],e.prototype,"container",void 0);z.__decorate([F.property()],e.prototype,"suspended",void 0);z.__decorate([F.property({readOnly:!0})],e.prototype,"updateParameters",void 0);z.__decorate([F.property()],e.prototype,"updateRequested",void 0);z.__decorate([F.property()],e.prototype,"updating",null);z.__decorate([F.property()],e.prototype,"view",void 0);return e=z.__decorate([y.subclass("esri.views.2d.layers.LayerView2D")],
e)};Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(E,J,z,H,C,G,F,K,I){z=function(x){function A(){return x.apply(this,arguments)||
this}E._inheritsLoose(A,x);return A}(z.JSONSupport);return z=J.__decorate([I.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(E,J,z,H,C,G,
F,K,I){var x;H=x=function(A){function y(){var w=A.apply(this,arguments)||this;w.type="rect";w.left=null;w.right=null;w.top=null;w.bottom=null;return w}E._inheritsLoose(y,A);y.prototype.clone=function(){return new x({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};E._createClass(y,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return y}(I);J.__decorate([z.property({type:[Number,String],json:{write:!0}})],H.prototype,"left",void 0);J.__decorate([z.property({type:[Number,
String],json:{write:!0}})],H.prototype,"right",void 0);J.__decorate([z.property({type:[Number,String],json:{write:!0}})],H.prototype,"top",void 0);J.__decorate([z.property({type:[Number,String],json:{write:!0}})],H.prototype,"bottom",void 0);J.__decorate([z.property({readOnly:!0})],H.prototype,"version",null);return H=x=J.__decorate([K.subclass("esri.views.layers.support.ClipRect")],H)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(E,J,z,H,C,G,F,K,I,x,A,y,w,b){var f;z={base:x,key:"type",typeMap:{extent:w,polygon:b}};y=f=function(h){function k(){var c=h.apply(this,arguments)||this;c.type="geometry";c.geometry=null;return c}E._inheritsLoose(k,h);k.prototype.clone=function(){return new f({geometry:this.geometry.clone()})};E._createClass(k,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return k}(y);J.__decorate([H.property({types:z,json:{read:A.fromJSON,write:!0}})],y.prototype,"geometry",void 0);
J.__decorate([H.property({readOnly:!0})],y.prototype,"version",null);return y=f=J.__decorate([I.subclass("esri.views.layers.support.Geometry")],y)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(E,
J,z,H,C,G,F,K,I){H=function(x){function A(){var y=x.apply(this,arguments)||this;y.type="path";y.path=[];return y}E._inheritsLoose(A,x);E._createClass(A,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return A}(I);J.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],H.prototype,"path",void 0);J.__decorate([z.property({readOnly:!0})],H.prototype,"version",null);return H=J.__decorate([K.subclass("esri.views.layers.support.Path")],H)})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(E,J,z,H,C,G,F,K,I,x,A,y,w,b){K=f=>{f=function(h){function k(){var e=h.apply(this,arguments)||this;e._rasterFieldPrefix="Raster.";e.layer=null;e.view=null;e.fullExtent=null;e.tileInfo=null;e.datumTransformation=null;return e}J._inheritsLoose(k,h);var c=k.prototype;c.fetchPopupFeatures=function(){var e=J._asyncToGenerator(function*(n,p){const {layer:g}=this;if(!n)return Promise.reject(new C("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:g}));var {popupEnabled:l}=
g;p=b.getFetchPopupTemplate(g,p);if(!l||!G.isSome(p))throw new C("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:l,popupTemplate:p});l=[];({value:n}=yield g.identify(n));let a="";if(n&&n.length){var d,q;a="imagery-tile"===g.type&&g.hasStandardTime()&&null!=n[0]?n.map(r=>g.getStandardTimeValue(r)).join(", "):n.join(", ");n={ObjectId:0};n["Raster.ServicePixelValue"]=this._formatAttributeValue(a,"Raster.ServicePixelValue");if((p=null==(d=g.rasterInfo)?
void 0:null==(q=d.attributeTable)?void 0:q.features)&&0<p.length&&(d=p.filter(r=>String(r.attributes.value||r.attributes.Value||r.attributes.VALUE)===a),0<d.length&&(d=d[0])))for(var m in d.attributes)d.attributes.hasOwnProperty(m)&&(q=this._rasterFieldPrefix+m,n[q]=this._formatAttributeValue(d.attributes[m],q));m=new H(this.fullExtent.clone(),null,n);m.layer=g;m.sourceLayer=m.layer;l.push(m)}return l});return function(n,p){return e.apply(this,arguments)}}();c.updateFullExtent=function(){var e=this.layer.tileInfo;
let n;e&&e.spatialReference||(n=new C("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));e=w.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!1);e=w.projectExtent(this.layer.fullExtent,this.view.spatialReference,e);null==e&&(n=new C("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",e);this.datumTransformation||
(this.datumTransformation=w.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0));return n?Promise.reject(n):Promise.resolve()};c._formatAttributeValue=function(e,n){if("string"===typeof e&&(n=(n=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n))&&n.format)){let p,g;return-1<e.trim().indexOf(",")?(p=",",g=p+" ",this._formatDelimitedString(e,p,g,n)):-1<e.trim().indexOf(" ")?(p=g=" ",this._formatDelimitedString(e,p,g,n)):this._formatNumberFromString(e,
n)}return e};c._getFieldInfo=function(e,n){if(e&&e.length&&n){var p=n.toLowerCase(),g=void 0;e.some(l=>!l.fieldName||l.fieldName.toLowerCase()!==p&&l.fieldName.toLowerCase()!==p.replace(/ /g,"_")?!1:(g=l,!0));return g}};c._formatDelimitedString=function(e,n,p,g){return e&&n&&p&&g?e.trim().split(n).map(l=>this._formatNumberFromString(l,g)).join(p):e};c._formatNumberFromString=function(e,n){if(!e||!n)return e;const p=Number(e);return isNaN(p)?e:n.format(p)};J._createClass(k,[{key:"hasTilingEffects",
get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return k}(f);z.__decorate([F.property()],f.prototype,"layer",void 0);z.__decorate([F.property()],f.prototype,"view",void 0);z.__decorate([F.property()],f.prototype,"fullExtent",void 0);z.__decorate([F.property()],f.prototype,"tileInfo",void 0);z.__decorate([F.property({readOnly:!0})],f.prototype,"hasTilingEffects",null);return f=z.__decorate([y.subclass("esri.views.layers.ImageryTileLayerView")],
f)};E.ImageryTileLayerView=K;E.default=K;Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(E,J,z,H){function C(){C=J._asyncToGenerator(function*(G,F=G.popupTemplate){if(!z.isSome(F))return[];const K=yield F.getRequiredFields(G.fieldsIndex);({lastEditInfoEnabled:F}=F);const {objectIdField:I,typeIdField:x,globalIdField:A,
relationships:y}=G;if(K.includes("*"))return["*"];F=F?yield H.getFeatureEditFields(G):[];const w=H.fixFields(G.fieldsIndex,[...K,...F]);x&&w.push(x);w&&I&&G.fieldsIndex.has(I)&&-1===w.indexOf(I)&&w.push(I);w&&A&&G.fieldsIndex.has(A)&&-1===w.indexOf(A)&&w.push(A);y&&y.forEach(b=>{({keyField:b}=b);w&&b&&G.fieldsIndex.has(b)&&-1===w.indexOf(b)&&w.push(b)});return w});return C.apply(this,arguments)}E.getFetchPopupTemplate=function(G,F){return G.popupTemplate?G.popupTemplate:z.isSome(F)&&F.defaultPopupTemplateEnabled&&
z.isSome(G.defaultPopupTemplate)?G.defaultPopupTemplate:null};E.getRequiredFields=function(G){return C.apply(this,arguments)};Object.defineProperty(E,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(E,J,z,H,C,G){function F(I,x,A,y=new G){let w;if("2d"===A.type)w=x*A.resolution;else if("3d"===A.type){var b=A.overlayPixelSizeInMapUnits(I),
f=A.basemapSpatialReference;w=z.isSome(f)&&!f.equals(A.spatialReference)?H.getMetersPerUnitForSR(f)/H.getMetersPerUnitForSR(A.spatialReference):x*b}x=I.x-w;b=I.y-w;f=I.x+w;I=I.y+w;({spatialReference:A}=A);y.xmin=Math.min(x,f);y.ymin=Math.min(b,I);y.xmax=Math.max(x,f);y.ymax=Math.max(b,I);y.spatialReference=A;return y}const K=new G;E.createQueryGeometry=F;E.intersectsDrapedGeometry=function(I,x,A){I=A.toMap(I);if(z.isNone(I))return!1;const y=C.calculateTolerance();return F(I,y,A,K).intersects(x)};
Object.defineProperty(E,"__esModule",{value:!0})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(E){function J(C,G){return G?"xoffset"in G&&G.xoffset?Math.max(C,Math.abs(G.xoffset)):"yoffset"in G&&G.yoffset?Math.max(C,Math.abs(G.yoffset||0)):C:C}function z(C,G){if("number"===typeof C)return C;if(C&&C.stops&&C.stops.length){{C=C.stops;let F=G=0;for(let K=0;K<C.length;K++){const I=C[K].size;"number"===typeof I&&(G+=I,F++)}C=G/F}return C}return G}function H(C,G){if(!G)return C;
G=G.filter(I=>"size"===I.type).map(I=>{const {maxSize:x,minSize:A}=I;return(z(x,C)+z(A,C))/2});let F=0;const K=G.length;if(0===K)return C;for(let I=0;I<K;I++)F+=G[I];return Math.max(Math.floor(F/K),C)}E.calculateTolerance=function(C){const G=C&&C.renderer;C="touch"===(C&&C.event&&C.event.pointerType)?9:6;if(!G)return C;C="visualVariables"in G?H(C,G.visualVariables):C;if("simple"===G.type)return J(C,G.symbol);if("unique-value"===G.type){let F=C;G.uniqueValueInfos.forEach(K=>{F=J(F,K.symbol)});return F}if("class-breaks"===
G.type){let F=C;G.classBreakInfos.forEach(K=>{F=J(F,K.symbol)});return F}return C};Object.defineProperty(E,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../layers/support/PixelBlock ../../../layers/support/TileInfo ../../../layers/support/rasterDatasets/RawBlockCache ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ../engine/RasterTileContainer ./LayerView2D ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../support/drapedUtils ../../webgl/capabilities ../../../geometry/Extent ../../../geometry/Point".split(" "),function(E,
J,z,H,C,G,F,K,I,x,A,y,w,b,f,h,k,c,e,n,p,g,l,a,d,q,m,r,t,u,D){const L=C.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),M=[0,0];z=function(R){function U(){var v=R.apply(this,arguments)||this;v._tileStrategy=null;v._tileInfoView=null;v._fetchQueue=null;v._blockCacheRegistryUrl=null;v._blockCacheRegistryId=null;v._bitmapView=null;v._emptyTilePixelBlock=null;v._srcResolutions=null;v._previousLOD=null;v._needBlockCacheUpdate=!1;v._globalSymbolizerParams=null;v._symbolizerParams=null;v._abortController=
null;v._globalUpdateRequested=!1;v._isCustomTilingScheme=!1;v.useWebGLForProcessing=!0;v._redrawOrRefreshDebounced=F.debounce((B,O)=>B?(v._set("refreshTimestamp",Date.now()),v.doRefresh()):v._redrawImage(O));return v}E._inheritsLoose(U,R);var Q=U.prototype;Q.initialize=function(){const v=this.updateFullExtent();this.addResolvingPromise(v)};Q.hitTest=function(v,B){if(this.suspended)return Promise.resolve(null);v=this.view.toMap(K.createScreenPoint(v,B));return Promise.resolve(new H({attributes:{},
geometry:v}))};Q.update=function(v){this._fetchQueue.pause();this._fetchQueue.state=v.state;this._tileStrategy.update(v);this._fetchQueue.resume();const {extent:B,resolution:O,scale:N}=v.state;v=this._tileInfoView.getClosestInfoForScale(N);if(this.layer.raster){var W;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const P=this._srcResolutions[v.level],S=B.toJSON?B:u.fromJSON(B);k.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,S,O,P,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=
!1;(null==(W=this._previousLOD)?void 0:W.level)!==v.level&&(this._previousLOD=v,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")};Q.attach=function(){this.layer.increaseRasterJobHandlerUsage();t().supportsTextureFloat||(this.useWebGLForProcessing=!1);this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0);this._initializeTileInfo();this._tileInfoView=new g(this.tileInfo,this.fullExtent);var v=this._computeFetchConcurrency();
this._fetchQueue=new l({tileInfoView:this._tileInfoView,concurrency:v,process:(B,O)=>this.fetchTile(B,O)});v=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new a({cachePolicy:"purge",acquireTile:B=>this.acquireTile(B),releaseTile:B=>this.releaseTile(B),cacheSize:v,tileInfoView:this._tileInfoView});this._bitmapView=new n.RasterTileContainer(this._tileInfoView);this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme;this.container.addChild(this._bitmapView);this.handles.add([I.watch(this.layer,
["bandIds","renderer","interpolation","multidimensionalDefinition"],(B,O,N)=>{const W="multidimensionalDefinition"===N;B="interpolation"===N&&("majority"===B||"majority"===O)&&this._canUseMajorityInterpolationOnDataSource();this._redrawOrRefreshDebounced(W||B).catch(P=>{F.isAbortError(P)||L.error(P)})})],"attach");this._updateBlockCacheRegistry()};Q.detach=function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();
this._fetchQueue=this._tileStrategy=this._tileInfoView=null;k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};Q.moveStart=function(){this.requestUpdate()};Q.viewChange=function(){this.requestUpdate()};Q.moveEnd=function(){if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=F.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=
!1;this.requestUpdate()});const v=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(v);this.requestUpdate()};Q.createFetchPopupFeaturesQueryGeometry=function(v,B){return r.createQueryGeometry(v,B,this.view)};Q.doRefresh=function(){var v=E._asyncToGenerator(function*(){if(!this.suspended){this.layer.updateRenderer();this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var B=[];this._tileStrategy.tiles.forEach(O=>B.push(this._enqueueTileFetch(O)));
yield F.eachAlways(B);this.notifyChange("updating")}});return function(){return v.apply(this,arguments)}}();Q.isUpdating=function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};Q.acquireTile=function(v){v=this._bitmapView.createTile(v);const B=v.bitmap;[B.x,B.y]=this._tileInfoView.getTileCoords(M,v.key);B.resolution=this._tileInfoView.getTileResolution(v.key);[B.width,B.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(v);this.requestUpdate();this._needBlockCacheUpdate=
!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;return v};Q.releaseTile=function(v){this._fetchQueue.abort(v.key.id);this._bitmapView.removeChild(v);v.once("detach",()=>{v.destroy();this.requestUpdate()});this.requestUpdate()};Q.fetchTile=function(v,B){B=!G.isNone(B)&&B.signal;const O=this._canUseWebGLForProcessing();B={tileInfo:this.tileInfo,signal:G.unwrap(B),registryId:this._blockCacheRegistryId,requestRawData:O,srcResolution:this._srcResolutions[v.level],datumTransformation:this.datumTransformation,
interpolation:O?"nearest":this.layer.interpolation};return this.layer.fetchTile(v.level,v.row,v.col,B)};Q._canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};Q._getCacheSize=function(v){return v?40:0};Q._initializeTileInfo=function(){var v=this.view.spatialReference;const B=new D({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:v}),{scales:O,
srcResolutions:N,isCustomTilingScheme:W}=e.computeProjectedScales(this.layer.rasterInfo,v);v=h.create({spatialReference:v,size:512,scales:O});if(0===v.origin.x||v.origin.x>B.x)v.origin=B;this._isCustomTilingScheme=W;this._set("tileInfo",v);this._srcResolutions=null!=N?N:[]};Q._computeFetchConcurrency=function(){var {blockBoundary:v}=this.layer.rasterInfo.storageInfo;v=v[v.length-1];return 64<(v.maxCol-v.minCol+1)*(v.maxRow-v.minRow+1)?2:10};Q._enqueueTileFetch=function(){var v=E._asyncToGenerator(function*(B,
O){if(!this._fetchQueue.has(B.key.id)){try{const N=yield this._fetchQueue.push(B.key),{bandIds:W}=this.layer;let P=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){P=!1;try{yield this._redrawImage(this._abortController&&this._abortController.signal)}catch(T){F.isAbortError(T)&&L.error(T)}this._globalUpdateRequested=!1}const S=this._canUseWebGLForProcessing();S&&!this.hasTilingEffects&&null==
this._symbolizerParams&&this._updateSymbolizerParams();if(N&&N.pixelBlock){const T={extent:N.extent,pixelBlock:N.pixelBlock};B.bitmap.rawPixelData=T;if(S)B.bitmap.source=N.pixelBlock,B.bitmap.isRendereredSource=!1;else{const V=yield this.layer.applyRenderer(T,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);B.bitmap.source=V;B.bitmap.isRendereredSource=!0}B.bitmap.symbolizerParameters=S?this._globalSymbolizerParams||
this._symbolizerParams:null;S?B.bitmap.transformGrid||(B.bitmap.transformGrid=N.transformGrid):B.bitmap.transformGrid=null}else{const T=this._createEmptyTilePixelBlock();B.bitmap.source=T;B.bitmap.symbolizerParameters=S?this._symbolizerParams:null;B.bitmap.transformGrid=null}B.bitmap.bandIds=W;B.bitmap.width=this._tileInfoView.tileInfo.size[0];B.bitmap.height=this._tileInfoView.tileInfo.size[1];B.bitmap.interpolation=this._getLayerInterpolation();B.bitmap.suspended=P;B.bitmap.invalidateTexture();
B.once("attach",()=>this.requestUpdate());this._bitmapView.addChild(B)}catch(N){F.isAbortError(N)||L.error(N)}this.requestUpdate()}});return function(B,O){return v.apply(this,arguments)}}();Q._redrawImage=function(){var v=E._asyncToGenerator(function*(B){var O=this;this.layer.updateRenderer();this.hasTilingEffects?yield this._updateGlobalSymbolizerParams(B):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const {bandIds:N}=this.layer;B=this._bitmapView.children.map(function(){var W=
E._asyncToGenerator(function*(P){const S=O._canUseWebGLForProcessing();!S&&P.bitmap.rawPixelData?(P.bitmap.source=yield O.layer.applyRenderer(P.bitmap.rawPixelData,O.hasTilingEffects&&O._globalSymbolizerParams&&"stretch"===O._globalSymbolizerParams.type?O._globalSymbolizerParams:null),P.bitmap.isRendereredSource=!0):(P.bitmap.isRendereredSource&&P.bitmap.rawPixelData&&(P.bitmap.source=P.bitmap.rawPixelData.pixelBlock),P.bitmap.isRendereredSource=!1);P.bitmap.symbolizerParameters=S?O._globalSymbolizerParams||
O._symbolizerParams:null;P.bitmap.bandIds=N;P.bitmap.interpolation=O._getLayerInterpolation();P.bitmap.suspended=!1});return function(P){return W.apply(this,arguments)}}());yield F.eachAlways(B);this.container.requestRender()});return function(B){return v.apply(this,arguments)}}();Q._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){const v=this._tileInfoView.tileInfo.size[0],B=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new f({width:v,height:B,pixels:[new Uint8Array(v*
B)],mask:new Uint8Array(v*B),pixelType:"u8"})}return this._emptyTilePixelBlock};Q._updateGlobalSymbolizerParams=function(){var v=E._asyncToGenerator(function*(B){(B=yield this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,{srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:B}))&&B.pixelBlock&&(B=this.layer.symbolizer.generateWebGLParameters({pixelBlock:c.extractBands(B.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,
resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&B&&"stretch"===B.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(B.factor=B.factor.map(O=>255*O),B.outMin=Math.round(255*B.outMin),B.outMax=Math.round(255*B.outMax)),this._globalSymbolizerParams=B)});return function(B){return v.apply(this,arguments)}}();Q._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,
isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})};Q._updateBlockCacheRegistry=function(v=!1){const {url:B,rasterInfo:O,multidimensionalDefinition:N,raster:W}=this.layer;var P=null!=O&&O.multidimensionalInfo?W.getSliceIndex(N):null;P=k.getRasterId(B,P);P!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=
k.register(P,this.layer.raster.rasterInfo),v&&(v=this._tileInfoView.getClosestInfoForScale(this.view.scale),k.update(P,this._blockCacheRegistryId,this.view.extent,this.view.resolution,this._srcResolutions[v.level],this.layer.raster.ioConfig.sampling)),this._blockCacheRegistryUrl=P)};Q._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:v,attributeTable:B,colormap:O,pixelType:N}=this.layer.rasterInfo;return 1===v&&(null!=B||null!=O||"u8"===N||"s8"===N)};Q._getLayerInterpolation=function(){var v=
this.layer.renderer.type;if("raster-colormap"===v||"unique-value"===v||"class-breaks"===v)return"nearest";({renderer:v}=this.layer);return"raster-stretch"===v.type&&null!=v.colorRamp?"nearest":this.layer.interpolation};E._createClass(U,[{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(v){if(this._tileStrategy&&this.useProgressiveUpdate!==v){this._tileStrategy.destroy();this._bitmapView.removeAllChildren();
const B=this._getCacheSize(v);this._tileStrategy=new a({cachePolicy:"purge",acquireTile:O=>this.acquireTile(O),releaseTile:O=>this.releaseTile(O),cacheSize:B,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",v);this.requestUpdate()}}}]);return U}(d.ImageryTileLayerView(m.RefreshableLayerView(p.LayerView2DMixin(q))));J.__decorate([x.property()],z.prototype,"useProgressiveUpdate",null);return z=J.__decorate([b.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],z)});