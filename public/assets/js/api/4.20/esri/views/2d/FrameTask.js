// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["../../core/maybe","../../core/scheduling"],function(g,k){return function(){function h(a){this.view=a;this._frameTaskHandle=null;this._updateRequested=!1;this.updateEnabled=this.stationary=!0;this.animationInProgress=!1;this.prepare=()=>{this._updateParameters.state=this.view.state;this._updateParameters.stationary=this.view.stationary;this._updateParameters.pixelRatio=window.devicePixelRatio;this._updateParameters.renderingOptions=this.view.renderingOptions};this.update=()=>{this._updateRequested=
!1;if(this.updateEnabled){var {basemapView:e,graphicsView:b,labelManager:c,layerViews:l,state:{id:f}}=this.view;e.baseLayerViews.forEach(this._updateLayerView,this);l.forEach(this._updateLayerView,this);e.referenceLayerViews.forEach(this._updateLayerView,this);g.isSome(c)&&(c.lastUpdateId!==f&&(c.viewChange(),c.lastUpdateId=f),c.updateRequested&&c.processUpdate(this._updateParameters));g.isSome(b)&&(b.lastUpdateId!==f&&(b.viewChange(),b.lastUpdateId=f),b.updateRequested&&b.processUpdate(this._updateParameters));
this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause()}}}var d=h.prototype;d.destroy=function(){this.stop()};d.start=function(){this.stationary=this.view.stationary;this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions};this._stationaryHandle=this.view.watch("stationary",a=>{this.stationary=a;this.requestFrame()});this._frameTaskHandle=k.addFrameTask(this)};d.stop=function(){this._frameTaskHandle&&
(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)};d.requestUpdate=function(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())};d.requestFrame=function(){this._frameTaskHandle&&this._frameTaskHandle.resume()};d._updateLayerView=function(a){const e=this.view.state,b=a.lastUpdateId;if(null==b||!this.stationary&&!a.moving)a.moving=!0,a.moveStart();
b!==e.id&&a.viewChange();this.stationary&&a.moving&&(a.moving=!1,a.moveEnd());a.lastUpdateId=e.id;a.updateRequested&&a.processUpdate(this._updateParameters);"layerViews"in a&&a.layerViews.forEach(this._updateLayerView,this)};return h}()});