// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/ArrayPool ../../../../../chunks/earcut ./BaseBucket ../../webgl/Geometry ../../webgl/mesh/Tesselator".split(" "),function(C,D,E,G,B,H){const A=new H;return function(F){function z(a,c,b,d,q,h,e){a=F.call(this,a,c,b)||this;a.type=1;a._patternMap=new Map;a._fillVertexBuffer=d;a._fillIndexBuffer=q;a._outlineVertexBuffer=h;a._outlineIndexBuffer=e;return a}C._inheritsLoose(z,F);var x=z.prototype;x.getResources=function(a,c,b){a=
this.zoom;if(b=this.layer.getPaintProperty("fill-pattern"))if(b.isDataDriven)for(const d of this._features)c.add({name:b.getValue(a,d),repeat:!0});else c.add({name:b.getValue(a),repeat:!0})};x.processFeatures=function(a){this._fillIndexStart=3*this._fillIndexBuffer.index;this._fillIndexCount=0;this._outlineIndexStart=3*this._outlineIndexBuffer.index;this._outlineIndexCount=0;const c=this.layer,b=this.zoom,{fillMaterial:d,outlineMaterial:q,hasDataDrivenFill:h,hasDataDrivenOutline:e}=c;a&&a.setExtent(this.layerExtent);
var p=c.getPaintProperty("fill-pattern"),f=null==p?void 0:p.isDataDriven;let k=!p&&c.getPaintValue("fill-antialias",b);if(c.outlineUsesFillColor){if(k&&!c.hasDataDrivenOpacity){var l=c.getPaintValue("fill-opacity",b),m=c.getPaintValue("fill-opacity",b+1);1>l&&1>m&&(k=!1)}k&&!c.hasDataDrivenColor&&(l=c.getPaintValue("fill-color",b),m=c.getPaintValue("fill-color",b+1),1>l[3]&&1>m[3]&&(k=!1))}m=this._features;l=null==a?void 0:a.validateTessellation;if(f){var g=[];for(var n of m){f=p.getValue(b,n);f=
this._spriteInfo[f];if(!f||!f.rect)continue;m=d.encodeAttributes(n,b,c,f);const t=k&&e?q.encodeAttributes(n,b,c):[],w=n.getGeometry(a);g.push({ddFillAttributes:m,ddOutlineAttributes:t,page:f.page,geometry:w});g.sort((y,r)=>y.page-r.page);for(const {ddFillAttributes:y,ddOutlineAttributes:r,page:v,geometry:u}of g)this._processFeature(u,k,c.outlineUsesFillColor,y,r,l,v)}}else for(g of m)p=h?d.encodeAttributes(g,b,c):null,n=k&&e?q.encodeAttributes(g,b,c):null,f=g.getGeometry(a),this._processFeature(f,
k,c.outlineUsesFillColor,p,n,l)};x.serialize=function(){var a=10+this.layerUIDs.length;a+=this._fillVertexBuffer.array.length;a+=this._fillIndexBuffer.array.length;a+=this._outlineVertexBuffer.array.length;a+=this._outlineIndexBuffer.array.length;a+=3*this._patternMap.size+1;a=new Uint32Array(a);var c=new Int32Array(a.buffer);let b=0;a[b++]=this.type;a[b++]=this.layerUIDs.length;for(var d=0;d<this.layerUIDs.length;d++)a[b++]=this.layerUIDs[d];a[b++]=this._fillIndexStart;a[b++]=this._fillIndexCount;
a[b++]=this._outlineIndexStart;a[b++]=this._outlineIndexCount;d=this._patternMap;const q=d.size;a[b++]=q;if(0<q)for(const [h,[e,p]]of d)a[b++]=h,a[b++]=e,a[b++]=p;a[b++]=this._fillVertexBuffer.array.length;for(d=0;d<this._fillVertexBuffer.array.length;d++)c[b++]=this._fillVertexBuffer.array[d];a[b++]=this._fillIndexBuffer.array.length;for(d=0;d<this._fillIndexBuffer.array.length;d++)a[b++]=this._fillIndexBuffer.array[d];a[b++]=this._outlineVertexBuffer.array.length;for(d=0;d<this._outlineVertexBuffer.array.length;d++)c[b++]=
this._outlineVertexBuffer.array[d];a[b++]=this._outlineIndexBuffer.array.length;for(c=0;c<this._outlineIndexBuffer.array.length;c++)a[b++]=this._outlineIndexBuffer.array[c];return a.buffer};x._processFeature=function(a,c,b,d,q,h,e){if(a){var p=a.length,f=!q||0===q.length;if(c&&(!b||f))for(c=0;c<p;c++)this._processOutline(a[c],q);for(q=0;q<p;q++)if(c=z._area(a[q]),32<c){void 0!==k&&this._processFill(a,k,d,h,e);var k=[q]}else-32>c&&void 0!==k&&k.push(q);void 0!==k&&this._processFill(a,k,d,h,e)}};x._processOutline=
function(a,c){const b=this._outlineVertexBuffer,d=this._outlineIndexBuffer,q=d.index;var h;let e,p;const f=new B.Point(0,0),k=new B.Point(0,0),l=new B.Point(0,0);let m=-1,g=-1;var n=-1;let t=-1,w=-1,y=!1,r=a.length;if(!(2>r)){var v=a[0];for(h=a[r-1];r&&h.isEqual(v);)--r,h=a[r-1];if(!(2>r-0)){for(v=0;v<r;++v){0===v?(h=a[r-1],e=a[0],p=a[1],f.assignSub(e,h),f.normalize(),f.rightPerpendicular()):(h=e,e=p,p=v!==r-1?a[v+1]:a[0],f.assign(k));h=this._isClipEdge(h,e);-1===t&&(y=h);k.assignSub(p,e);k.normalize();
k.rightPerpendicular();n=f.x*k.y-f.y*k.x;l.assignAdd(f,k);l.normalize();var u=-l.x*-f.x+-l.y*-f.y;u=Math.abs(0!==u?1/u:1);8<u&&(u=8);0<=n?(n=b.add(e.x,e.y,f.x,f.y,0,1,c),-1===t&&(t=n),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),g=b.add(e.x,e.y,u*-l.x,u*-l.y,0,-1,c),-1===w&&(w=g),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),m=g,g=n,n=b.add(e.x,e.y,l.x,l.y,0,1,c),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),g=b.add(e.x,e.y,k.x,k.y,0,1,c)):(n=b.add(e.x,e.y,u*l.x,u*l.y,0,1,c),-1===t&&(t=n),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),g=b.add(e.x,
e.y,-f.x,-f.y,0,-1,c),-1===w&&(w=g),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),m=g,g=n,n=b.add(e.x,e.y,-l.x,-l.y,0,-1,c),0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n),m=b.add(e.x,e.y,-k.x,-k.y,0,-1,c));0<=m&&0<=g&&0<=n&&!h&&d.add(m,g,n)}0<=m&&0<=g&&0<=t&&!y&&d.add(m,g,t);0<=m&&0<=t&&0<=w&&!y&&d.add(m,w,t);this._outlineIndexCount+=3*(d.index-q)}}};x._processFill=function(a,c,b,d,q){d=!0;var h;1<c.length&&(h=[]);var e=0;for(var p of c)0!==e&&h.push(e),e+=a[p].length;p=2*e;e=D.acquire();for(var f of c){var k=a[f];const m=
k.length;for(let g=0;g<m;++g)e.push(k[g].x,k[g].y)}f=E.earcut(e,h,2);if(d&&0<E.earcut.deviation(e,h,2,f)){d=[];p=[];A.beginPolygon(d,p);for(var l of c)if(c=a[l],!(3>c.length)){A.beginContour();for(h=0;h<c.length;++h)f=c[h].x,k=c[h].y,f=[f,k,0],A.addVertex(f,f);A.endContour()}A.endPolygon();if(0<p.length){a=this._fillVertexBuffer.index;for(l=0;l<d.length;)this._fillVertexBuffer.add(d[l++],d[l++],b);for(b=0;b<p.length;)this._fillIndexBuffer.add(a+p[b+0],a+p[b+1],a+p[b+2]),b+=3;void 0!==q&&(b=this._patternMap,
(a=b.get(q))?a[1]+=p.length:b.set(q,[this._fillIndexStart+this._fillIndexCount,p.length]));this._fillIndexCount+=p.length}}else if(a=f.length,0<a){l=this._fillVertexBuffer.index;for(c=0;c<p;)this._fillVertexBuffer.add(e[c++],e[c++],b);for(b=0;b<a;)this._fillIndexBuffer.add(l+f[b++],l+f[b++],l+f[b++]);void 0!==q&&(b=this._patternMap,(l=b.get(q))?l[1]+=a:b.set(q,[this._fillIndexStart+this._fillIndexCount,a]));this._fillIndexCount+=a}D.release(e)};x._isClipEdge=function(a,c){return a.x===c.x?-64>=a.x||
4160<=a.x:a.y===c.y?-64>=a.y||4160<=a.y:!1};z._area=function(a){let c=0;const b=a.length-1;for(let d=0;d<b;d++)c+=(a[d].x-a[d+1].x)*(a[d].y+a[d+1].y);c+=(a[b].x-a[0].x)*(a[b].y+a[0].y);return.5*c};C._createClass(z,[{key:"fillIndexStart",get:function(){return this._fillIndexStart}},{key:"fillIndexCount",get:function(){return this._fillIndexCount}},{key:"outlineIndexStart",get:function(){return this._outlineIndexStart}},{key:"outlineIndexCount",get:function(){return this._outlineIndexCount}}]);return z}(G)});