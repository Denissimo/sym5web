// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../layers/graphics/featureConversionUtils","./FeatureSetReader"],function(l,m,k,h,n){function q({coords:g,lengths:d}){let b=0;for(const a of d){for(d=1;d<a;d++)g[2*(b+d)]+=g[2*(b+d)-2],g[2*(b+d)+1]+=g[2*(b+d)-1];b+=a}}let r=function(g){function d(a,c,e){a=g.call(this,a)||this;a._featureIndex=-1;a._dateFields=new Set;a._geometryType=e;a._features=c;return a}m._inheritsLoose(d,g);d.fromFeatures=
function(a,c,e){e=h.convertFromFeatures([],a,c,!1,!1,e);for(let f=0;f<e.length;f++)e[f].displayId=a[f].displayId;return d.fromOptimizedFeatures(e,c)};d.fromFeatureSet=function(a,c){a=h.convertFromFeatureSet(a,c);return d.fromOptimizedFeatureSet(a)};d.fromOptimizedFeatureSet=function(a){const {features:c,geometryType:e}=a,f=d.fromOptimizedFeatures(c,e);f._exceededTransferLimit=a.exceededTransferLimit;f._transform=a.transform;for(const p of a.fields)"esriFieldTypeDate"===p.type&&f._dateFields.add(p.name);
return f};d.fromOptimizedFeatures=function(a,c,e){const f=n.FeatureSetReader.createInstance();a=new d(f,a,c);a._transform=e;return a};var b=d.prototype;b.removeIds=function(a){const c=new Set(a);this._features=this._features.filter(e=>!c.has(e.objectId))};b.append=function(a){for(const c of a)this._features.push(c)};b.getSize=function(){return this._features.length};b.getCursor=function(){return this.copy()};b.getQuantizationTransform=function(){return this._transform};b.getAttributeHash=function(){let a=
"";for(const c in this._current.attributes)a+=this._current.attributes[c];return a};b.getIndex=function(){return this._featureIndex};b.setIndex=function(a){this._featureIndex=a};b.getObjectId=function(){return this._current.objectId};b.getDisplayId=function(){return this._current.displayId};b.setDisplayId=function(a){this._current.displayId=a};b.getGroupId=function(){return this._current.groupId};b.setGroupId=function(a){this._current.groupId=a};b.copy=function(){const a=new d(this.instance,this._features,
this.geometryType);this.copyInto(a);return a};b.next=function(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length};b.readLegacyFeature=function(){return h.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)};b.readOptimizedFeature=function(){return this._current};b.readLegacyPointGeometry=function(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null};b.readLegacyGeometry=function(){const a=this.readGeometry();
return h.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM)};b.readLegacyCentroid=function(){const a=this.readCentroid();return a?{x:a.coords[0]*this._sx+this._tx,y:a.coords[1]*this._sy+this._ty}:null};b.readGeometryArea=function(){return h.getQuantizedArea(this._current.geometry,2)};b.readUnquantizedGeometry=function(){var a=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!a)return a;a=a.clone();q(a);return a};b.readHydratedGeometry=function(){var a=this._current.geometry;
if(!a)return null;a=a.clone();k.isSome(this._transform)&&h.unquantizeOptimizedGeometry(a,a,this.hasZ,this.hasM,this._transform);return a};b.getXHydrate=function(){const a=this._current.geometry.coords[0],c=this.getQuantizationTransform();return k.isNone(c)?a:a*c.scale[0]+c.translate[0]};b.getYHydrate=function(){const a=this._current.geometry.coords[1],c=this.getQuantizationTransform();return k.isNone(c)?a:c.translate[1]-a*c.scale[1]};b.getX=function(){return this._current.geometry.coords[0]*this._sx+
this._tx};b.getY=function(){return this._current.geometry.coords[1]*this._sy+this._ty};b.readGeometry=function(){if(!this._current.hasGeometry)return null;const a=this._current.geometry.clone();if(a.isPoint)return a.coords[0]=a.coords[0]*this._sx+this._tx,a.coords[1]=a.coords[1]*this._sy+this._ty,a;let c=0;for(const e of a.lengths)a.coords[2*c]=a.coords[2*c]*this._sx+this._tx,a.coords[2*c+1]=a.coords[2*c+1]*this._sy+this._ty,c+=e;return a};b.readCentroid=function(){if(!this._current.hasGeometry)return null;
if(!this._current.centroid){var a=this._computeCentroid();if(!a)return null;a.coords[0]=(a.coords[0]-this._tx)/this._sx;a.coords[1]=(a.coords[1]-this._ty)/this._sy;this._current.centroid=a}a=this._current.centroid.clone();a.coords[0]=a.coords[0]*this._sx+this._tx;a.coords[1]=a.coords[1]*this._sx+this._ty;return a};b._readAttribute=function(a,c){var e=this._current.attributes[a];if(void 0!==e)return null!=e&&c&&this._dateFields.has(a)?new Date(e):e;e=this.readAttributes();a=a.toLocaleLowerCase().trim();
for(const f in e)if(f.toLocaleLowerCase().trim()===a)return a=this._current.attributes[f],null!=a&&c&&this._dateFields.has(f)?new Date(a):a};b.copyInto=function(a){g.prototype.copyInto.call(this,a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._dateFields=this._dateFields};b._readAttributes=function(){return this._current.attributes};m._createClass(d,[{key:"_current",get:function(){return this._features[this._featureIndex]}},{key:"geometryType",get:function(){return this._geometryType}},
{key:"hasFeatures",get:function(){return!!this._features.length}},{key:"hasNext",get:function(){return this._featureIndex+1<this._features.length}},{key:"exceededTransferLimit",get:function(){return this._exceededTransferLimit}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}}]);return d}(n.FeatureSetReader);l.FeatureSetReaderJSON=r;Object.defineProperty(l,"__esModule",{value:!0})});