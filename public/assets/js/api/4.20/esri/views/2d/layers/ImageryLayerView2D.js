// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b,n,l,q){const e=D.ofType({key:"type",base:b,typeMap:{rect:n,path:q,geometry:l}});z.LayerView2DMixin=g=>{g=function(m){function p(){var h=m.apply(this,arguments)||this;h.clips=new e;h.moving=!1;h.attached=!1;h.lastUpdateId=-1;h.updateRequested=!1;return h}y._inheritsLoose(p,m);var f=p.prototype;f.initialize=function(){var h;this.container||(this.container=new B.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=this.clips;
this.handles.add([H.init(this,"suspended",a=>{this.container&&(this.container.visible=!a);this.view&&!a&&this.updateRequested&&this.view.requestUpdate()},!0),H.init(this,["layer.opacity","container"],()=>{if(this.container){var a,c;this.container.opacity=null!=(a=null==(c=this.layer)?void 0:c.opacity)?a:1}},!0),H.init(this,["layer.blendMode"],a=>{this.container&&(this.container.blendMode=a)},!0),H.init(this,["layer.effect"],a=>{this.container&&(this.container.effect=a)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(h=this.view)&&h.whenLayerView?this.view.whenLayerView(this.layer).then(a=>{a!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};f.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};f.isVisibleAtScale=
function(h){var a=!0,c=this.layer;const d=c.minScale;c=c.maxScale;if(null!=d&&null!=c){a=!d;let k=!c;!a&&h<=d&&(a=!0);!k&&h>=c&&(k=!0);a=a&&k}return a};f.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};f.processUpdate=function(h){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",h),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(h)))};f.isUpdating=
function(){return!1};f.isRendering=function(){return!1};f.canResume=function(){return m.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};y._createClass(p,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return p}(g);x.__decorate([G.property({type:e,set(m){m=E.referenceSetter(m,this._get("clips"),e);this._set("clips",m)}})],g.prototype,"clips",void 0);x.__decorate([G.property()],g.prototype,"moving",void 0);
x.__decorate([G.property()],g.prototype,"attached",void 0);x.__decorate([G.property()],g.prototype,"container",void 0);x.__decorate([G.property()],g.prototype,"suspended",void 0);x.__decorate([G.property({readOnly:!0})],g.prototype,"updateParameters",void 0);x.__decorate([G.property()],g.prototype,"updateRequested",void 0);x.__decorate([G.property()],g.prototype,"updating",null);x.__decorate([G.property()],g.prototype,"view",void 0);return g=x.__decorate([J.subclass("esri.views.2d.layers.LayerView2D")],
g)};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass".split(" "),function(z,y,x,D,E,H,G,L,w){x=function(A){function I(){return A.apply(this,arguments)||
this}z._inheritsLoose(I,A);return I}(x.JSONSupport);return x=y.__decorate([w.subclass("esri.views.layers.support.ClipArea")],x)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(z,y,x,D,E,H,
G,L,w){var A;D=A=function(I){function J(){var B=I.apply(this,arguments)||this;B.type="rect";B.left=null;B.right=null;B.top=null;B.bottom=null;return B}z._inheritsLoose(J,I);J.prototype.clone=function(){return new A({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};z._createClass(J,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return J}(w);y.__decorate([x.property({type:[Number,String],json:{write:!0}})],D.prototype,"left",void 0);y.__decorate([x.property({type:[Number,
String],json:{write:!0}})],D.prototype,"right",void 0);y.__decorate([x.property({type:[Number,String],json:{write:!0}})],D.prototype,"top",void 0);y.__decorate([x.property({type:[Number,String],json:{write:!0}})],D.prototype,"bottom",void 0);y.__decorate([x.property({readOnly:!0})],D.prototype,"version",null);return D=A=y.__decorate([L.subclass("esri.views.layers.support.ClipRect")],D)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b){var n;x={base:A,key:"type",typeMap:{extent:B,polygon:b}};J=n=function(l){function q(){var e=l.apply(this,arguments)||this;e.type="geometry";e.geometry=null;return e}z._inheritsLoose(q,l);q.prototype.clone=function(){return new n({geometry:this.geometry.clone()})};z._createClass(q,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return q}(J);y.__decorate([D.property({types:x,json:{read:I.fromJSON,write:!0}})],J.prototype,"geometry",void 0);
y.__decorate([D.property({readOnly:!0})],J.prototype,"version",null);return J=n=y.__decorate([w.subclass("esri.views.layers.support.Geometry")],J)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(z,
y,x,D,E,H,G,L,w){D=function(A){function I(){var J=A.apply(this,arguments)||this;J.type="path";J.path=[];return J}z._inheritsLoose(I,A);z._createClass(I,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return I}(w);y.__decorate([x.property({type:[[[Number]]],json:{write:!0}})],D.prototype,"path",void 0);y.__decorate([x.property({readOnly:!0})],D.prototype,"version",null);return D=y.__decorate([L.subclass("esri.views.layers.support.Path")],D)})},"esri/views/2d/layers/imagery/ImageryGraphicsView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../../../support/GraphicsCollection ../../engine/Container ../graphics/GraphicContainer ../graphics/GraphicsView2D".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b,n,l,q,e,g,m,p){const f=H.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");E=function(h){function a(){var d=h.apply(this,arguments)||this;d.attached=!1;d.container=new g.Container;d.updateRequested=!1;d._graphicsView=null;d._projectFullExtentPromise=null;d._previousExtents=[];d._previousSymbolTileResolution=0;d._previousRendererSignature="";d.type="Graphics";d._graphics=new e["default"];d._updateGraphics=L.debounce(function(){var k=z._asyncToGenerator(function*(t,
u){if(t.stationary){var r=t.state;r=new n({xmin:r.extent.xmin,ymin:r.extent.ymin,xmax:r.extent.xmax,ymax:r.extent.ymax,spatialReference:r.spatialReference});var [v,F]=t.state.size,C={};C.timeExtent=d.timeExtent;C.requestAsImageElement=!1;C.signal=u;null==d._projectFullExtentPromise&&(d._projectFullExtentPromise=d._getProjectedFullExtent(r.spatialReference));u="vector-field"===d.layer.renderer.type?d.layer.renderer.symbolTileSize:50;var K=yield d._projectFullExtentPromise,{extent:N,resolution:Q,width:U,
height:T}=q.snapImageToSymbolTile(r,v,F,u,K);r=yield d.layer.fetchImage(N,U,T,C);C=d.layer.renderer;if("vector-field"===C.type){u=r.pixelData.pixelBlock;K=C.sizeVariables[0];K.minDataValue&&K.maxDataValue||(K.minDataValue=u.statistics[0].minValue,K.maxDataValue=u.statistics[0].maxValue);d._pixelData={extent:N,pixelBlock:r.pixelData.pixelBlock};u=JSON.stringify(d.layer.renderer);K=d._previousRendererSignature===u;const V=.01>Math.abs(d._previousSymbolTileResolution-Q)/Q,M=N.clone().normalize(),X=d._previousExtents.some(P=>
M.some(O=>P.intersects(O))),S=K&&V&&X?d._previousExtents:[];r=yield C.getGraphicsFromPixelData(r.pixelData,"vector-uv"===d.layer.rasterInfo.dataType,S);S.length?(C=d._graphics.items.filter(P=>G.isSome(P.geometry)&&S.some(O=>O.intersects(P.geometry))&&!M.some(O=>O.intersects(P.geometry))),d._graphics.removeMany(C),d._graphics.addMany(r)):d._graphics.set("items",r);d._graphicsView.update(t);d._previousExtents=M;d._previousRendererSignature=u;d._previousSymbolTileResolution=Q}}});return function(t,u){return k.apply(this,
arguments)}}());return d}z._inheritsLoose(a,h);var c=a.prototype;c.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};c.update=function(d){this._updateGraphics(d).catch(k=>{L.isAbortError(k)||f.error(k)})};c.hitTest=function(d,k){d=this.view.toMap(w.createScreenPoint(d,k));return Promise.resolve(new x({attributes:{},geometry:d,layer:this.layer}))};c.attach=function(){this._graphicsView=new p({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>
this.requestUpdate(),container:new m(this.view.featuresTilingScheme)});this.attached=!0};c.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);this._graphicsView=null};c.moveStart=function(){};c.viewChange=function(){};c.moveEnd=function(){};c.install=function(d){this.container.addChild(this._graphicsView.container);d.addChild(this.container)};c.uninstall=function(d){this.container.removeChild(this._graphicsView.container);
d.removeChild(this.container)};c.isUpdating=function(){return this._graphicsView.updating||this.updateRequested};c.getPixelData=function(){return this.updating?null:this._pixelData};c.redraw=function(){};c.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};c._getProjectedFullExtent=function(){var d=z._asyncToGenerator(function*(k){try{return yield l.projectExtent(this.layer.fullExtent,k)}catch(t){try{const u=(yield D(this.layer.url,{query:{option:"footprints",
outSR:k.wkid||JSON.stringify(k.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return u?n.fromJSON(u):null}catch{return null}}});return function(k){return d.apply(this,arguments)}}();z._createClass(a,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return a}(E);y.__decorate([A.property()],E.prototype,"attached",void 0);y.__decorate([A.property()],E.prototype,"container",void 0);y.__decorate([A.property()],E.prototype,"layer",void 0);y.__decorate([A.property()],
E.prototype,"timeExtent",void 0);y.__decorate([A.property()],E.prototype,"view",void 0);y.__decorate([A.property()],E.prototype,"updateRequested",void 0);y.__decorate([A.property()],E.prototype,"updating",null);y.__decorate([B.enumeration({graphics:"Graphics"})],E.prototype,"type",void 0);return E=y.__decorate([b.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],E)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/webMercatorUtils ../../../geometry/Extent ../../../geometry/Point".split(" "),
function(z,y,x,D,E,H,G,L,w,A){function I(){I=y._asyncToGenerator(function*(){if(G.isLoaded()||!G.isSupported())return null;yield G.load()});return I.apply(this,arguments)}function J(a,c,d,k=null){if(a.spatialReference.equals(c))return a;const t=f(a.spatialReference,c);if(t&&!G.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");d=d.center;a=new w({xmin:d.x-a.x/2,xmax:d.x+a.x/2,ymin:d.y-a.y/2,ymax:d.y+a.y/2,spatialReference:a.spatialReference});c=t?
G.project(a,c,k):L.project(a,c);return null==c?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function B(a,c=.01){return H.getMetersPerUnitForSR(a)?c/H.getMetersPerUnitForSR(a):0}function b(a,c,d=null,k=!0){const t=a.spatialReference;if(t.equals(c))return a;const u=f(t,c);if(u&&!G.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((d=u?G.project(a,c,d):L.project(a,c))&&k&&c.isGeographic){const [r,v]=g(t,!0);(c=B(t))&&null!=r&&null!=v&&(Math.abs(a.x-r)<
c&&5E-4>Math.abs(180-d.x)?d.x-=360:Math.abs(a.x-v)<c&&5E-4>Math.abs(180+d.x)&&(d.x+=360))}return d}function n(a){const c=e(a[0].spatialReference);if(2>a.length||!E.isSome(c))return a[0];let {xmin:d,xmax:k,ymin:t,ymax:u}=a[0];for(let r=1;r<a.length;r++){const v=a[r];k=v.xmax+c*r;t=Math.min(t,v.ymin);u=Math.max(u,v.ymax)}return new w({xmin:d,xmax:k,ymin:t,ymax:u,spatialReference:a[0].spatialReference})}function l(a,c,d=null,k=!0){if(a.spatialReference.equals(c))return a;const t=p(a),u=e(a.spatialReference,
!0);if(!E.isSome(u)||0===t)return q(a,c,d,k);a=a.clone().normalize().map(r=>q(r,c,d,k));return n(a)}function q(a,c,d=null,k=!0){const t=a.spatialReference;if(t.equals(c))return a;var u=f(t,c);if(u&&!G.isLoaded())throw new D("rasterprojectionhelper-projectExtent","projection engine is not loaded");u=u?G.project(a,c,d):L.project(a,c);let [r,v]=g(t,!0);u&&k&&t.isWebMercator&&c.isGeographic&&null!=r&&null!=v&&(.001>Math.abs(a.xmin-r)&&1E3<Math.abs(v-a.xmax)&&5E-4>Math.abs(180-u.xmax)&&(u.xmin=-180,k=
[],k.push(new A(a.xmax,a.ymin,t)),k.push(new A(a.xmax,(a.ymin+a.ymax)/2,t)),k.push(new A(a.xmax,a.ymax,t)),k=k.map(F=>b(F,c,d)).filter(F=>!isNaN(null==F?void 0:F.x)).map(F=>F.x),u.xmax=Math.max.apply(null,k)),.001>Math.abs(a.xmax-v)&&1E3<Math.abs(r-a.xmin)&&5E-4>Math.abs(180+u.xmin)&&(u.xmax=180,k=[],k.push(new A(a.xmin,a.ymin,t)),k.push(new A(a.xmin,(a.ymin+a.ymax)/2,t)),k.push(new A(a.xmin,a.ymax,t)),a=k.map(F=>b(F,c,d)).filter(F=>!isNaN(null==F?void 0:F.x)).map(F=>F.x),u.xmin=Math.min.apply(null,
a)));[r,v]=g(c,!0);(a=B(c))&&null!=r&&null!=v&&(Math.abs(u.xmin-r)<a&&(u.xmin=r),Math.abs(u.xmax-v)<a&&(u.xmax=v));return u}function e(a,c=!1){return a.isWebMercator?2*(c?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*h[a.wkid]||null}function g(a,c=!1){const d=[];a=e(a,c);E.isSome(a)&&(d.push(-a/2),d.push(a/2));return d}function m(a,c,d,k){a=(a-c)/d;0!==a-Math.floor(a)?a=Math.floor(a):k&&--a;return a}function p(a,c=!1){const d=e(a.spatialReference);if(!E.isSome(d))return 0;const k=
c?0:-(d/2);c=m(a.xmax,k,d,!0);a=m(a.xmin,k,d,!1);return c-a}const f=function(a,c){const d=(a.isWGS84||a.isWebMercator)&&(c.isWGS84||c.isWebMercator);return!(a.equals(c)||d)},h={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,
53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,
54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};z.computeProjectedScales=function(a,c,d=512,k=!0){const {extent:t,spatialReference:u,pixelSize:r}=a,v=J(new A({x:r.x,y:r.y,spatialReference:u}),c,t);if(null==v)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var F=(v.x+v.y)/2,
C=H.getMetersPerUnitForSR(c);F=F*C*96*39.37;const K=c.isGeographic?256/d*2.958287637958547E8:256/d*5.91657527591555E8;d=!1;const N=l(t,c);k&&(c.isGeographic||c.isWebMercator)&&(d=0>N.xmin*N.xmax);k=F;if(d)k=K,a=c.isGeographic?1.341104507446289E-6:.29858214164761665,C=96*a*C*39.37,c=J(new A({x:a,y:a,spatialReference:{wkid:c.isGeographic?4326:3857}}),u,N),c.x*=k/C,c.y*=k/C;else{c={x:r.x,y:r.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(C=0;k<.5005*K&&C<a;)C++,k*=2,c.x*=2,c.y*=
2;1.001>=Math.max(k,K)/Math.min(k,K)&&(k=K)}a=[k];C=[{x:c.x,y:c.y}];for(F=Math.min(70.5310735,F)/1.001;k>=F;)k/=2,c.x/=2,c.y/=2,a.push(k),C.push({x:c.x,y:c.y});return{projectedPixelSize:v,scales:a,srcResolutions:C,isCustomTilingScheme:!d}};z.defaultGridSpacing=32;z.getDefaultDatumTransformationForDataset=function(a,c,d){if(!f(a.spatialReference,c))return null;if(!G.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");return d?G.getTransformation(c,a.spatialReference,
a):G.getTransformation(a.spatialReference,c,a)};z.getProjectionOffsetGrid=function(a,c,d,k=null,t=null,u=!1,r=[32,32]){if(f(a.spatialReference,c.spatialReference)&&!G.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&c&&d))return null;const {xmin:v,ymin:F,xmax:C,ymax:K}=a;var N=a.spatialReference,Q=c.spatialReference,U=e(Q);u=u||"gcs-shift"===(null==t?void 0:t.type);var T=r[0]*d.x,V=r[1]*d.y;d=Math.ceil((C-v)/T-.1)+1;a=Math.ceil((K-F)/V-.1)+
1;const M=[];let X=!1;for(var S=0;S<d;S++){var P=[];for(var O=0;O<a;O++){var R=new A({x:v+T*S,y:K-V*O,spatialReference:N});R=b(R,Q,k);t&&(R=t.inverseTransform(R));P.push(R);0<S&&u&&R&&W[O]&&E.isSome(U)&&R.x<W[O].x&&(R.x+=U);R?(M.push((R.x-c.xmin)/(c.xmax-c.xmin)),M.push((c.ymax-R.y)/(c.ymax-c.ymin))):(M.push(NaN),M.push(NaN),X=!0)}var W=P}c=[Math.abs((M[0]+M[4]+M[4*d]+M[4*d+4])/4-M[2*a+2]),Math.abs((M[1]+M[5]+M[4*a+1]+M[4*a+5])/4-M[2*a+3])];k=new Float32Array((d-1)*(a-1)*12);t=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]);u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(W=0;W<d-1;W++){for(N=0;N<a-1;N++){P=W*a*2+2*N;T=M[P];Q=M[P+1];var Y=M[P+2],Z=M[P+3];P+=2*a;V=M[P];U=M[P+1];S=M[P+2];P=M[P+3];O=0;R=12*(N*(d-1)+W);for(let aa=0;3>aa;aa++)k[R++]=t[O++]*T+t[O++]*Y+t[O++]*S;O=0;for(Y=0;3>Y;Y++)k[R++]=t[O++]*Q+t[O++]*Z+t[O++]*P;O=0;for(Z=0;3>Z;Z++)k[R++]=u[O++]*T+u[O++]*V+u[O++]*S;O=0;for(T=0;3>T;T++)k[R++]=u[O++]*Q+u[O++]*U+u[O++]*P}if(X)for(N=0;N<k.length;N++)isNaN(k[N])&&(k[N]=-1)}return{offsets:M,
error:c,coefficients:k,spacing:r,size:[d-1,a-1]}};z.getRasterDatasetAlignmentInfo=function(a){const c=a.storageInfo.origin.x,d=e(a.spatialReference,!0);if(!E.isSome(d))return{originX:c,halfWorldWidth:null,pyramidsInfo:null};const k=d/2,{nativePixelSize:t,storageInfo:u,extent:r}=a,{maximumPyramidLevel:v,blockWidth:F,pyramidScalingFactor:C}=u;let K=t.x;const N=[];a=E.isSome(a.transform)&&"gcs-shift"===a.transform.type;const Q=c+k,U=a?d-c:k-c;for(let T=0;T<=v;T++){const V=(r.xmax-c)/K/F,M=(d/2-c)/K/
F;N.push({resolutionX:K,blockWidth:F,datsetColumnCount:0===V-Math.floor(V)?V:Math.ceil(V),worldColumnCountFromOrigin:0===M-Math.floor(M)?M:Math.ceil(M),leftMargin:Math.round(Q/K)%F,rightPadding:(F-Math.round(U/K)%F)%F,originColumnOffset:Math.floor(Q/K/F)});K*=C}return{originX:c,halfWorldWidth:k,pyramidsInfo:N,hasGCSSShiftTransform:a}};z.getWorldWrapCount=p;z.load=function(){return I.apply(this,arguments)};z.projectExtent=l;z.projectPoint=b;z.projectResolution=J;z.snapExtent=function(a){a=a.clone().normalize();
return 1===a.length?a[0]:n(a)};z.snapPyramid=function(a,c,d){const {storageInfo:k,pixelSize:t}=c;let u=!1;var {pyramidResolutions:r}=k;if(E.isSome(r)&&r.length){a=(a.x+a.y)/2;var v=r[r.length-1];v=(v.x+v.y)/2;var F=(t.x+t.y)/2;if(a<=F)var C=0;else if(a>=v)C=r.length,u=8<a/v;else{v=F;for(let K=1;K<=r.length;K++){F=(r[K-1].x+r[K-1].y)/2;if(a<=F){a===F?C=K:"down"===d?(C=K-1,u=8<a/v):C="up"===d?K:a-v>F-a||2<a/v?K:K-1;break}v=F}}d=0===C?t:r[C-1];return{pyramidLevel:C,pyramidResolution:new A({x:d.x,y:d.y,
spatialReference:c.spatialReference}),excessiveReading:u}}C=Math.log(a.x/t.x)/Math.LN2;a=Math.log(a.y/t.y)/Math.LN2;r=c.storageInfo.maximumPyramidLevel||0;C="down"===d?Math.floor(Math.min(C,a)):"up"===d?Math.ceil(Math.max(C,a)):Math.round((C+a)/2);0>C?C=0:C>r&&(u=C>r+3,C=r);d=2**C;c=new A({x:d*c.nativePixelSize.x,y:d*c.nativePixelSize.y,spatialReference:c.spatialReference});return{pyramidLevel:C,pyramidResolution:c,excessiveReading:u}};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports",
"../../../core/maybe","../PixelBlock"],function(z,y,x){function D(w,A="geographic"){const [I,J]=w;w=Math.sqrt(I*I+J*J);let B=Math.atan2(J,I)*H;B=(360+B)%360;"geographic"===A&&(B=(450-B)%360);return[w,B]}function E(w,A="geographic"){let I=w[1];"geographic"===A&&(I=(450-I)%360);I%=360;w=w[0];return[w*Math.cos(I/H),w*Math.sin(I/H)]}const H=180/Math.PI,G=function(w){return w&&"esri.layers.support.PixelBlock"===w.declaredClass&&w.pixels&&0<w.pixels.length},L=new Map;L.set("meter-per-second",1);L.set("kilometer-per-hour",
.277778);L.set("knots",.514444);L.set("feet-per-second",.3048);L.set("mile-per-hour",.44704);z.convertVectorFieldData=function(w,A,I="geographic",J=1){if(!G(w))return w;const {pixels:B,width:b,height:n}=w;var l=b*n;const q=B[0],e=B[1],g=x.createEmptyBand(w.pixelType,l);l=x.createEmptyBand(w.pixelType,l);let m=0;for(let p=0;p<n;p++)for(let f=0;f<b;f++)"vector-uv"===A?([g[m],l[m]]=D([q[m],e[m]],I),g[m]*=J):([g[m],l[m]]=E([q[m],e[m]],I),g[m]*=J,l[m]*=J),m++;w=new x({pixelType:w.pixelType,width:w.width,
height:w.height,mask:w.mask,validPixelCount:w.validPixelCount,maskIsAlpha:w.maskIsAlpha,pixels:[g,l]});w.updateStatistics();return w};z.convertVectorFieldUnit=function(w,A,I=1){if(1===I||!G(w))return w;w=w.clone();const {pixels:J,width:B,height:b}=w,n=J[0],l=J[1];let q=0;for(let e=0;e<b;e++)for(let g=0;g<B;g++)"vector-uv"===A?(n[q]*=I,l[q]*=I):n[q]*=I,q++;w.updateStatistics();return w};z.getUnitConversionFactor=function(w,A){return L.get(w)/L.get(A)||1};z.isValidPixelBlock=G;z.snapImageToSymbolTile=
function(w,A,I,J,B){if(!y.isSome(B)||!B.spatialReference.equals(w.spatialReference))return{extent:w,width:A,height:I,resolution:w.width/A};const b=B.xmin;B=B.ymax;J=Math.max(J||0,30);A=((w.xmax-w.xmin)/Math.ceil(1/J*A)+(w.ymax-w.ymin)/Math.ceil(1/J*I))/2;w.xmin=b+Math.floor((w.xmin-b)/A)*A;w.xmax=b+Math.ceil((w.xmax-b)/A)*A;w.ymin=B+Math.floor((w.ymin-B)/A)*A;w.ymax=B+Math.ceil((w.ymax-B)/A)*A;return{extent:w,width:Math.round(w.width/A),height:Math.round(w.height/A),resolution:A}};Object.defineProperty(z,
"__esModule",{value:!0})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),function(z,y,x,D,E,H,G,L,w,A,I,J){var B;const b=G.getLogger("esri.layers.support.PixelBlock");
x=B=function(n){function l(e){e=n.call(this,e)||this;e.width=null;e.height=null;e.pixelType="f32";e.validPixelCount=null;e.mask=null;e.maskIsAlpha=!1;e.pixels=null;e.statistics=null;return e}z._inheritsLoose(l,n);l.createEmptyBand=function(e,g){return new (B.getPixelArrayConstructor(e))(g)};l.getPixelArrayConstructor=function(e){let g;switch(e){case "u1":case "u2":case "u4":case "u8":g=Uint8Array;break;case "u16":g=Uint16Array;break;case "u32":g=Uint32Array;break;case "s8":g=Int8Array;break;case "s16":g=
Int16Array;break;case "s32":g=Int32Array;break;case "u32":g=Uint32Array;break;case "f32":g=Float32Array;break;case "f64":g=Float64Array;break;case "c64":case "c128":case "unknown":g=Float32Array}return g};var q=l.prototype;q.castPixelType=function(e){if(!e)return"f32";e=e.toLowerCase();-1<["u1","u2","u4"].indexOf(e)?e="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(e)&&(e="f32");return e};q.getPlaneCount=function(){return this.pixels&&this.pixels.length};q.addData=function(e){if(!e.pixels||
e.pixels.length!==this.width*this.height)throw new D("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(e.pixels);this.statistics.push(e.statistics||{minValue:null,maxValue:null})};q.getAsRGBA=function(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(e);
break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)};q.getAsRGBAFloat=function(){const e=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(e);return e};q.updateStatistics=function(){this.statistics=this.pixels.map(m=>this._calculateBandStatistics(m,this.mask));const e=this.mask;let g=0;if(e)for(let m=0;m<e.length;m++)e[m]&&g++;else g=this.width*this.height;this.validPixelCount=g};q.clamp=function(e){if(e&&"f64"!==e&&"f32"!==e){switch(e){case "u8":var g=[0,255];break;case "u16":g=
[0,65535];break;case "u32":g=[0,4294967295];break;case "s8":g=[-128,127];break;case "s16":g=[-32768,32767];break;case "s32":g=[-2147483648,2147483647];break;default:g=[-3.4*1E39,3.4*1E39]}var [m,p]=g;g=this.pixels;var f=this.width*this.height,h=g.length,a=[];for(let t=0;t<h;t++){var c=B.createEmptyBand(e,f);var d=g[t];for(let u=0;u<f;u++){var k=d[u];c[u]=k>p?p:k<m?m:k}a.push(c)}this.pixels=a;this.pixelType=e}};q.extractBands=function(e){if(L.isNone(e)||0===e.length||null==this.pixels||0===this.pixels.length)return this;
var g=this.pixels.length;const m=e.some(p=>p>=this.pixels.length);g=g===e.length&&!e.some((p,f)=>p!==f);return m||g?this:new B({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map(p=>this.pixels[p]),statistics:this.statistics&&e.map(p=>this.statistics[p])})};q.clone=function(){const e=new B({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});
this.mask&&(e.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let g;const m=B.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){e.pixels=[];const p=this.pixels[0].slice;for(g=0;g<this.pixels.length;g++)e.pixels[g]=p?this.pixels[g].slice(0,this.pixels[g].length):new m(this.pixels[g])}if(this.statistics)for(e.statistics=[],g=0;g<this.statistics.length;g++)e.statistics[g]=H.clone(this.statistics[g]);return e};q._fillFrom8Bit=function(e){const {mask:g,
maskIsAlpha:m,pixels:p}=this;if(e&&p&&p.length){var f,h;var a=f=h=p[0];3<=p.length?(f=p[1],h=p[2]):2===p.length&&(f=p[1]);var c=new Uint32Array(e),d=this.width*this.height;if(a.length!==d)b.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(g&&g.length===d)if(m)for(e=0;e<d;e++)g[e]&&(c[e]=g[e]<<24|h[e]<<16|f[e]<<8|a[e]);else for(e=0;e<d;e++)g[e]&&(c[e]=-16777216|h[e]<<16|f[e]<<8|a[e]);else for(e=0;e<d;e++)c[e]=-16777216|h[e]<<16|f[e]<<8|a[e]}else b.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};q._fillFromNon8Bit=function(e){const {pixels:g,mask:m,statistics:p}=this;if(e&&g&&g.length){var f=this.pixelType,h=1,a=0;h=1;p&&0<p.length?(a=p.map(u=>u.minValue).reduce((u,r)=>Math.min(u,r)),h=p.map(u=>u.maxValue-u.minValue).reduce((u,r)=>Math.max(u,r)),h=255/h):(h=255,"s8"===f?(a=-128,h=127):"u16"===f?h=65535:"s16"===f?(a=-32768,h=32767):"u32"===f?h=4294967295:"s32"===f?(a=-2147483648,h=2147483647):"f32"===f?(a=-3.4*1E39,h=3.4*1E39):
"f64"===f&&(a=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-a));e=new Uint32Array(e);f=this.width*this.height;var c,d,k;var t=c=d=g[0];if(t.length!==f)return b.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=g.length)if(c=g[1],3<=g.length&&(d=g[2]),m&&m.length===f)for(k=0;k<f;k++)m[k]&&(e[k]=-16777216|(d[k]-a)*h<<16|(c[k]-a)*h<<8|(t[k]-a)*h);else for(k=0;k<f;k++)e[k]=-16777216|(d[k]-a)*h<<16|(c[k]-a)*h<<8|(t[k]-a)*h;else if(m&&m.length===f)for(k=0;k<f;k++)c=(t[k]-
a)*h,m[k]&&(e[k]=-16777216|c<<16|c<<8|c);else for(k=0;k<f;k++)c=(t[k]-a)*h,e[k]=-16777216|c<<16|c<<8|c}else b.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};q._fillFrom32Bit=function(e){const {pixels:g,mask:m}=this;if(!e||!g||!g.length)return b.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let p,f,h,a;p=f=h=g[0];3<=g.length?(f=g[1],h=g[2]):2===g.length&&(f=g[1]);const c=this.width*this.height;if(p.length!==c)return b.error("getAsRGBAFloat()",
"Unable to convert to RGBA. The pixelblock is invalid.");let d=0;if(m&&m.length===c)for(a=0;a<c;a++)e[d++]=p[a],e[d++]=f[a],e[d++]=h[a],e[d++]=m[a]&1;else for(a=0;a<c;a++)e[d++]=p[a],e[d++]=f[a],e[d++]=h[a],e[d++]=1};q._calculateBandStatistics=function(e,g){let m=Infinity,p=-Infinity;const f=e.length;let h,a=0;if(g)for(h=0;h<f;h++)g[h]&&(a=e[h],m=a<m?a:m,p=a>p?a:p);else for(h=0;h<f;h++)a=e[h],m=a<m?a:m,p=a>p?a:p;return{minValue:m,maxValue:p}};return l}(E.JSONSupport);y.__decorate([w.property({json:{write:!0}})],
x.prototype,"width",void 0);y.__decorate([w.property({json:{write:!0}})],x.prototype,"height",void 0);y.__decorate([w.property({json:{write:!0}})],x.prototype,"pixelType",void 0);y.__decorate([A.cast("pixelType")],x.prototype,"castPixelType",null);y.__decorate([w.property({json:{write:!0}})],x.prototype,"validPixelCount",void 0);y.__decorate([w.property({json:{write:!0}})],x.prototype,"mask",void 0);y.__decorate([w.property({json:{write:!0}})],x.prototype,"maskIsAlpha",void 0);y.__decorate([w.property({json:{write:!0}})],
x.prototype,"pixels",void 0);y.__decorate([w.property({json:{write:!0}})],x.prototype,"statistics",void 0);return x=B=y.__decorate([J.subclass("esri.layers.support.PixelBlock")],x)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b,n,l,q){const e=E.getLogger("esri.views.2d.layers.imagery.ImageryView2D");D=function(g){function m(){var f=g.apply(this,arguments)||this;f.attached=!1;f.container=new n.Container;f.updateRequested=!1;f.type="Imagery";f._bitmapView=null;return f}z._inheritsLoose(m,g);var p=m.prototype;p.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};p.update=function(f){this.strategy.update(f).catch(h=>{H.isAbortError(h)||e.error(h)})};
p.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren()};p.hitTest=function(f,h){f=this.view.toMap(G.createScreenPoint(f,h));return Promise.resolve(new x({attributes:{},geometry:f,layer:this.layer}))};p.attach=function(){const f=10<=this.layer.version,h=10.1<=this.layer.version?this.layer.imageMaxHeight:2048,a=10.1<=this.layer.version?this.layer.imageMaxWidth:2048;this._bitmapView=new b.BitmapContainer;this.strategy=new q({container:this._bitmapView,
imageNormalizationSupported:f,imageMaxHeight:h,imageMaxWidth:a,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()});this.attached=!0};p.moveStart=function(){};p.viewChange=function(){};p.moveEnd=function(){};p.install=function(f){this.container.addChild(this._bitmapView);f.addChild(this.container)};p.uninstall=function(f){this.container.removeChild(this._bitmapView);f.removeChild(this.container)};p.redraw=function(){this.strategy.updateExports(f=>{f.source instanceof HTMLImageElement?
f.requestRender():this.layer.applyRenderer({pixelBlock:f.source.pixelBlock}).then(h=>{const a=f.source;a.pixelBlock=h.pixelBlock;a.filter=c=>this.layer.applyFilter(c);this.container.requestRender()})})};p.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};p.isUpdating=function(){return this.strategy.updating||this.updateRequested};p.getPixelData=function(){if(this.updating)return null;var f=this.strategy.bitmaps;if(1===f.length&&f[0].source)return{extent:f[0].source.extent,
pixelBlock:f[0].source.originalPixelBlock};if(1<f.length){const h=this.view.extent;f=f.map(a=>a.source).filter(a=>a.extent&&a.extent.intersects(h)).map(a=>({extent:a.extent,pixelBlock:a.originalPixelBlock}));return(f=B.mosaicPixelData(f,h))?{extent:f.extent,pixelBlock:f.pixelBlock}:null}return null};p._fetchImage=function(f,h,a,c){c=c||{};c.timeExtent=this.timeExtent;c.requestAsImageElement=!0;return this.layer.fetchImage(f,h,a,c).then(d=>d.imageElement?d.imageElement:this.layer.applyRenderer(d.pixelData,
{signal:c.signal}).then(k=>{k=new l(k.pixelBlock,k.extent.clone(),d.pixelData.pixelBlock);k.filter=t=>this.layer.applyFilter(t);return k}))};z._createClass(m,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return m}(D);y.__decorate([L.property()],D.prototype,"attached",void 0);y.__decorate([L.property()],D.prototype,"container",void 0);y.__decorate([L.property()],D.prototype,"layer",void 0);y.__decorate([L.property()],D.prototype,"strategy",void 0);y.__decorate([L.property()],
D.prototype,"timeExtent",void 0);y.__decorate([L.property()],D.prototype,"view",void 0);y.__decorate([L.property()],D.prototype,"updateRequested",void 0);y.__decorate([L.property()],D.prototype,"updating",null);y.__decorate([I.enumeration({imagery:"Imagery"})],D.prototype,"type",void 0);return D=y.__decorate([J.subclass("esri.views.2d.layers.imagery.ImageryView2D")],D)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock"],function(z,y){function x(b,n){b=
Math.min(Math.max(b,-100),100);n=Math.min(Math.max(n,-100),100);let l,q;const e=new Uint8Array(256);for(l=0;256>l;l++)0<b&&100>b?q=(200*l-25500+510*n)/(2*(100-b))+128:0>=b&&-100<b?q=(200*l-25500+510*n)*(100+b)/2E4+128:100===b?(q=200*l-25500+256*(100-b)+510*n,q=0<q?255:0):-100===b&&(q=128),e[l]=255<q?255:0>q?0:q;return e}function D(b,n,l,q,e,g,m,p){return{xmin:e<=l*b?0:e<l*b+b?e-l*b:b,ymin:g<=q*n?0:g<q*n+n?g-q*n:n,xmax:e+m<=l*b?0:e+m<l*b+b?e+m-l*b:b,ymax:g+p<=q*n?0:g+p<q*n+n?g+p-q*n:n}}function E(b,
n,l,q,e,g){const {width:m,height:p}=l.block,{x:f,y:h}=l.offset,{width:a,height:c}=l.mosaic;l=D(m,p,q,e,f,h,a,c);let d=0;var k=0;if(g){var t=g.hasGCSSShiftTransform?360:g.halfWorldWidth,u=m*g.resolutionX,r=g.startX+q*u;u=r+u;r<t&&u>t?k=g.rightPadding:r>=t&&(d=g.leftMargin-g.rightPadding,k=0)}l.xmax-=k;if("number"===typeof n)for(g=l.ymin;g<l.ymax;g++)for(k=(e*p+g-h)*a+(q*m-f)+d,t=l.xmin;t<l.xmax;t++)b[k+t]=n;else for(g=l.ymin;g<l.ymax;g++)for(k=(e*p+g-h)*a+(q*m-f)+d,t=g*m,r=l.xmin;r<l.xmax;r++)b[k+
r]=n[t+r]}function H(b,n,l,q,e){var g=b.filter(u=>B(u))[0];if(null==g)return null;const m=q?q.width:n.width,p=q?q.height:n.height;var f=g.width,h=g.height;const a=n.width/f,c=n.height/h;n={offset:l||{x:0,y:0},mosaic:q||n,block:{width:f,height:h}};l=g.pixelType;q=y.getPixelArrayConstructor(l);f=g.pixels.length;g=[];for(var d=0;d<f;d++){h=new q(m*p);for(let u=0;u<c;u++)for(let r=0;r<a;r++){var k=b[u*a+r];B(k)&&(k=k.pixels[d],E(h,k,n,r,u,e))}g.push(h)}let t;if(b.some(u=>null==u||u.mask&&0<u.mask.length))for(t=
new Uint8Array(m*p),q=0;q<c;q++)for(f=0;f<a;f++)(d=(h=b[q*a+f])?h.mask:null)?E(t,d,n,f,q,e):h?E(t,1,n,f,q,e):E(t,0,n,f,q,e);b=new y({width:m,height:p,pixels:g,pixelType:l,mask:t});b.updateStatistics();return b}function G(b){if(!B(b))return null;const n=b.clone(),{width:l,height:q,pixels:e,mask:g}=b;var m=e[0];b=n.pixels[0];for(let h=2;h<q-1;h++){const a=new Map;for(var p=h-2;p<h+2;p++)for(var f=0;4>f;f++){const c=p*l+f;A(a,m[c],g?g[c]:1)}b[h*l]=L(a);b[h*l+1]=b[h*l+2]=b[h*l];for(p=3;p<l-1;p++)f=(h-
2)*l+p+1,A(a,m[f],g?g[f]:1),f=(h-1)*l+p+1,A(a,m[f],g?g[f]:1),f=h*l+p+1,A(a,m[f],g?g[f]:1),f=(h+1)*l+p+1,A(a,m[f],g?g[f]:1),f=(h-2)*l+p-3,w(a,m[f],g?g[f]:1),f=(h-1)*l+p-3,w(a,m[f],g?g[f]:1),f=h*l+p-3,w(a,m[f],g?g[f]:1),f=(h+1)*l+p-3,w(a,m[f],g?g[f]:1),b[h*l+p]=L(a);b[h*l+p+1]=b[h*l+p]}for(m=0;m<l;m++)b[m]=b[l+m]=b[2*l+m],b[(q-1)*l+m]=b[(q-2)*l+m];n.updateStatistics();return n}function L(b){if(0===b.size)return 0;let n=0,l=-1,q=0;const e=b.keys();let g=e.next();for(;!g.done;)q=b.get(g.value),q>n&&(l=
g.value,n=q),g=e.next();return l}function w(b,n,l){0!==l&&(l=b.get(n),1===l?b.delete(n):b.set(n,l-1))}function A(b,n,l){0!==l&&b.set(n,b.has(n)?b.get(n)+1:1)}function I(b,n,l){let {x:q,y:e}=n;const {width:g,height:m}=l;if(0===q&&0===e&&m===b.height&&g===b.width)return b;const {width:p,height:f}=b;n=Math.max(0,e);const h=Math.max(0,q),a=Math.min(q+g,p),c=Math.min(e+m,f);if(0>a||0>c||!B(b))return null;q=Math.max(0,-q);e=Math.max(0,-e);const {pixels:d,mask:k}=b;var t=g*m,u=d.length;const r=[];for(var v=
0;v<u;v++){var F=d[v],C=y.createEmptyBand(b.pixelType,t);for(let K=n;K<c;K++){const N=K*p;let Q=(K+e-n)*g+q;for(let U=h;U<a;U++)C[Q++]=F[N+U]}r.push(C)}t=new Uint8Array(t);for(u=n;u<c;u++)for(v=u*p,F=(u+e-n)*g+q,C=h;C<a;C++)t[F++]=k?k[v+C]:1;b=new y({width:l.width,height:l.height,pixelType:b.pixelType,pixels:r,mask:t});b.updateStatistics();return b}function J(b,n=!0){if(!B(b))return null;const {pixels:l,width:q,height:e,mask:g,pixelType:m}=b;b=[];const p=Math.round(q/2),f=Math.round(e/2),h=e-1,a=
q-1;for(var c=0;c<l.length;c++){var d=l[c],k=y.createEmptyBand(m,p*f),t=0;for(var u=0;u<e;u+=2)for(var r=0;r<q;r+=2){var v=d[u*q+r];if(n){var F=r===a?v:d[u*q+r+1];const C=u===h?v:d[u*q+r+q],K=r===a?C:u===h?F:d[u*q+r+q+1];k[t++]=(v+F+C+K)/4}else k[t++]=v}b.push(k)}c=null;if(g)for(c=new Uint8Array(p*f),d=0,k=0;k<e;k+=2)for(t=0;t<q;t+=2)u=g[k*q+t],n?(r=t===a?u:g[k*q+t+1],v=k===h?u:g[k*q+t+q],F=t===a?v:k===h?r:g[k*q+t+q+1],c[d++]=u*r*v*F?1:0):c[d++]=u;return new y({width:p,height:f,pixelType:m,pixels:b,
mask:c})}const B=function(b){return b&&"esri.layers.support.PixelBlock"===b.declaredClass&&b.pixels&&0<b.pixels.length};z.approximateTransform=function(b,n,l,q,e="nearest"){if(!B(b))return null;"majority"===e&&(b=G(b));const {pixels:g,mask:m,pixelType:p}=b,f=b.width;var h=b.height;b=y.getPixelArrayConstructor(p);var a=g.length;const {width:c,height:d}=n;n=q.cols;var k=q.rows;const t=Math.ceil(c/n),u=Math.ceil(d/k);q=!1;for(var r=0;r<l.length;r+=3)-1===l[r]&&-1===l[r+1]&&-1===l[r+2]&&(q=!0);let v,
F,C,K,N,Q;const U=new Float32Array(c*d),T=new Float32Array(c*d);r=0;let V,M;const X="majority"===e?0:.5;for(let O=0;O<u;O++)for(let R=0;R<t;R++){v=12*(O*t+R);e=l[v];F=l[v+1];C=l[v+2];K=l[v+3];N=l[v+4];Q=l[v+5];for(var S=0;S<k;S++){r=(O*k+S)*c+R*n;M=(S+.5)/k;for(var P=0;P<S;P++)V=(P+.5)/n,U[r+P]=Math.round((e*V+F*M+C)*f-X),T[r+P]=Math.round((K*V+N*M+Q)*h-X)}v+=6;e=l[v];F=l[v+1];C=l[v+2];K=l[v+3];N=l[v+4];Q=l[v+5];for(S=0;S<k;S++)for(r=(O*k+S)*c+R*n,M=(S+.5)/k,P=S;P<n;P++)V=(P+.5)/n,U[r+P]=Math.round((e*
V+F*M+C)*f-X),T[r+P]=Math.round((K*V+N*M+Q)*h-X)}l=(O,R)=>{for(let W=0;W<d;W++){v=W*c;for(let Y=0;Y<c;Y++)O[v]=0>U[v]||0>T[v]?0:R[U[v]+T[v]*f],v++}};h=[];for(k=0;k<a;k++)n=new b(c*d),l(n,g[k]),h.push(n);b=new y({width:c,height:d,pixelType:p,pixels:h});if(m)b.mask=new Uint8Array(c*d),l(b.mask,m);else if(q)for(b.mask=new Uint8Array(c*d),a=0;a<c*d;a++)b.mask[a]=0>U[a]||0>T[a]?0:1;b.updateStatistics();return b};z.clip=I;z.colorize=function(b,n){if(!B(b)||!n&&(n.indexedColormap||n.indexed2DColormap))return b;
const l=b.clone();var q=l.pixels;let e=l.mask;const g=l.width*l.height;if(1!==q.length)return b;const {indexedColormap:m,indexed2DColormap:p,offset:f,alphaSpecified:h}=n;n=m.length-1;b=0;q=q[0];const a=new Uint8Array(q.length),c=new Uint8Array(q.length),d=new Uint8Array(q.length);let k=0;if(m)if(e)for(b=0;b<g;b++)e[b]&&(k=4*(q[b]-f),k<f||k>n?e[b]=0:(a[b]=m[k],c[b]=m[k+1],d[b]=m[k+2],e[b]=m[k+3]));else{e=new Uint8Array(g);for(b=0;b<g;b++)k=4*(q[b]-f),k<f||k>n?e[b]=0:(a[b]=m[k],c[b]=m[k+1],d[b]=m[k+
2],e[b]=m[k+3]);l.mask=e}else if(e)for(b=0;b<g;b++)e[b]&&(n=p[q[b]],a[b]=n[0],c[b]=n[1],d[b]=n[2],e[b]=n[3]);else{e=new Uint8Array(g);for(b=0;b<g;b++)n=p[q[b]],a[b]=n[0],c[b]=n[1],d[b]=n[2],e[b]=n[3];l.mask=e}l.pixels=[a,c,d];l.statistics=null;l.pixelType="u8";l.maskIsAlpha=h;return l};z.createColormapLUT=function(b){if(b){var n=b.colormap;if(n&&0!==n.length){n=n.sort((h,a)=>h[0]-a[0]);var l=0;0>n[0][0]&&(l=n[0][0]);var q=Math.max(256,n[n.length-1][0]-l+1),e=new Uint8Array(4*q),g=[],m=0,p=0,f=5===
n[0].length;if(65536<q)return n.forEach(h=>{g[h[0]-l]=f?h.slice(1):h.slice(1).concat([255])}),{indexed2DColormap:g,offset:l,alphaSpecified:f};if(b.fillUnspecified)for(b=n[p],m=b[0]-l;m<q;m++)e[4*m]=b[1],e[4*m+1]=b[2],e[4*m+2]=b[3],e[4*m+3]=f?b[4]:255,m===b[0]-l&&(b=p===n.length-1?b:n[++p]);else for(m=0;m<n.length;m++)b=n[m],p=4*(b[0]-l),e[p]=b[1],e[p+1]=b[2],e[p+2]=b[3],e[p+3]=f?b[4]:255;return{indexedColormap:e,offset:l,alphaSpecified:f}}}};z.createContrastBrightnessLUT=x;z.createHistogramEqualizationLUT=
function(b,n=256){n=Math.min(n,256);const {size:l,counts:q}=b;b=new Uint8Array(l);var e=q.reduce((h,a)=>h+a/n,0);let g=0;var m=0;let p=0,f=e;for(let h=0;h<l;h++)if(p+=q[h],!(h<l-1&&p+q[h+1]<f)){for(;g<n-1&&f<p;)g++,f+=e;for(;m<=h;m++)b[m]=g;m=h+1}for(e=m;e<l;e++)b[e]=n-1;return b};z.createStretchLUT=function(b){const {minCutOff:n,maxCutOff:l,gamma:q,pixelType:e}=b,g=b.outMin||0,m=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(e))return null;const p=n.length;let f;let h=0;"s8"===e?h=-127:"s16"===
e&&(h=-32767);let a=256;-1<["u16","s16"].indexOf(e)&&(a=65536);const c=[],d=m-g;for(f=0;f<p;f++)c[f]=l[f]-n[f];var k=q&&q.length>=p;const t=[];if(k)for(f=0;f<p;f++)t[f]=1<q[f]?2<q[f]?6.5+(q[f]-2)**2.5:6.5+100*(2-q[f])**4:1;let u;const r=[];let v,F,C;if(k)for(f=0;f<p;f++){C=[];for(k=0;k<a;k++)v=k+h,u=(v-n[f])/c[f],F=1,1<q[f]&&(F-=(1/d)**(u*t[f])),C[k]=v<l[f]&&v>n[f]?Math.floor(F*d*u**(1/q[f]))+g:v>=l[f]?m:g;r[f]=C}else for(f=0;f<p;f++){C=[];for(k=0;k<a;k++)v=k+h,C[k]=v<=n[f]?g:v>=l[f]?m:Math.floor((v-
n[f])/c[f]*d)+g;r[f]=C}if(null!=b.contrastOffset)for(b=x(b.contrastOffset,b.brightnessOffset),f=0;f<p;f++)for(C=r[f],k=0;k<a;k++)C[k]=b[C[k]];return{lut:r,offset:h}};z.estimateStatisticsFromHistograms=function(b){const n=[];for(let g=0;g<b.length;g++){const {min:m,max:p,size:f,counts:h}=b[g];let a=0;var l=0;for(var q=0;q<f;q++)a+=h[q],l+=q*h[q];l/=a;q=0;for(var e=0;e<f;e++)q+=h[e]*(e-l)**2;e=(p-m)/f;n.push({min:m,max:p,avg:(l+.5)*e+m,stddev:Math.sqrt(q/(a-1))*e})}return n};z.estimateStatisticsHistograms=
function(b){if(!B(b))return null;b.statistics||b.updateStatistics();const {pixels:n,mask:l,pixelType:q,statistics:e}=b;b=b.width*b.height;const g=n.length;let m,p;let f;var h;const a=[],c=[];for(f=0;f<g;f++){var d=new Uint32Array(256);var k=n[f];if("u8"===q)if(m=-.5,p=255.5,l)for(h=0;h<b;h++)l[h]&&d[k[h]]++;else for(h=0;h<b;h++)d[k[h]]++;else{m=e[f].minValue;p=e[f].maxValue;var t=(p-m)/256;var u=new Uint32Array(257);if(l)for(h=0;h<b;h++)l[h]&&u[Math.floor((k[h]-m)/t)]++;else for(h=0;h<b;h++)u[Math.floor((k[h]-
m)/t)]++;for(h=0;255>h;h++)d[h]=u[h];d[255]=u[255]+u[256]}a.push({min:m,max:p,size:256,counts:d});for(h=k=u=t=0;256>h;h++)t+=d[h],u+=h*d[h];u/=t;for(h=0;256>h;h++)k+=d[h]*(h-u)**2;d=Math.sqrt(k/(t-1));t=(p-m)/256;h=(u+.5)*t+m;d*=t;c.push({min:m,max:p,avg:h,stddev:d})}return{statistics:c,histograms:a}};z.extractBands=function(b,n){if(null==n||!n.length||!B(b))return b;const l=b.pixels.length;return n&&n.some(q=>q>=l)||1===l&&1===n.length&&0===n[0]||l===n.length&&!n.some((q,e)=>q!==e)?b:new y({pixelType:b.pixelType,
width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:n.map(q=>b.pixels[q]),statistics:b.statistics&&n.map(q=>b.statistics[q])})};z.getClipBounds=D;z.lookupPixels=function(b,n){if(!B(b))return null;const {pixels:l,mask:q}=b,e=b.width*b.height,g=l.length;let m=n.lut;({offset:n}=n);let p,f;m&&1===m[0].length&&(m=l.map(()=>m));const h=[];let a,c,d;if(n)if(null==q)for(p=0;p<g;p++){a=l[p];c=m[p];d=new Uint8Array(e);for(f=0;f<e;f++)d[f]=c[a[f]-n];h.push(d)}else for(p=
0;p<g;p++){a=l[p];c=m[p];d=new Uint8Array(e);for(f=0;f<e;f++)q[f]&&(d[f]=c[a[f]-n]);h.push(d)}else if(null==q)for(p=0;p<g;p++){a=l[p];c=m[p];d=new Uint8Array(e);for(f=0;f<e;f++)d[f]=c[a[f]];h.push(d)}else for(p=0;p<g;p++){a=l[p];c=m[p];d=new Uint8Array(e);for(f=0;f<e;f++)q[f]&&(d[f]=c[a[f]]);h.push(d)}b=new y({width:b.width,height:b.height,pixels:h,mask:q,pixelType:"u8"});b.updateStatistics();return b};z.mosaic=H;z.mosaicPixelData=function(b,n){if(!b||0===b.length)return null;var l=b.filter(c=>c.pixelBlock)[0];
if(!l)return null;var q=(l.extent.xmax-l.extent.xmin)/l.pixelBlock.width;const e=(l.extent.ymax-l.extent.ymin)/l.pixelBlock.height,g=.01*Math.min(q,e),m=b.sort((c,d)=>Math.abs(c.extent.ymax-d.extent.ymax)>g?d.extent.ymax-c.extent.ymax:Math.abs(c.extent.xmin-d.extent.xmin)>g?c.extent.xmin-d.extent.xmin:0);var p=Math.min.apply(null,m.map(c=>c.extent.xmin));const f=Math.min.apply(null,m.map(c=>c.extent.ymin)),h=Math.max.apply(null,m.map(c=>c.extent.xmax)),a=Math.max.apply(null,m.map(c=>c.extent.ymax));
b={x:Math.round((n.xmin-p)/q),y:Math.round((a-n.ymax)/e)};p={width:Math.round((h-p)/q),height:Math.round((a-f)/e)};q={width:Math.round((n.xmax-n.xmin)/q),height:Math.round((n.ymax-n.ymin)/e)};if(Math.round(p.width/l.pixelBlock.width)*Math.round(p.height/l.pixelBlock.height)!==m.length||0>b.x||0>b.y||p.width<q.width||p.height<q.height)return null;l=m.map(c=>c.pixelBlock);l=H(l,p,b,q);return{extent:n,pixelBlock:l}};z.remapColor=function(b,n){if(!B(b))return null;b=b.clone();var {pixels:l}=b;const q=
b.width*b.height,e=n.length,g=Math.floor(e/2),m=n[Math.floor(g)];l=l[0];let p,f,h,a,c,d,k=!1;const t=new Uint8Array(q),u=new Uint8Array(q),r=new Uint8Array(q);let v=b.mask;const F=4===n[0].mappedColor.length;v||(v=new Uint8Array(q),v.fill(F?255:1),b.mask=v);for(c=0;c<q;c++)if(v[c]){p=l[c];k=!1;d=g;f=m;h=0;for(a=e-1;1<a-h;){if(p===f.value){k=!0;break}p>f.value?h=d:a=d;d=Math.floor((h+a)/2);f=n[Math.floor(d)]}k||(p===n[h].value?(f=n[h],k=!0):p===n[a].value?(f=n[a],k=!0):p<n[h].value?(k=!1,f=null):p>
n[h].value&&(p<n[a].value?(f=n[h],k=!0):a===e-1?(k=!1,f=null):(f=n[a],k=!0)));k?(t[c]=f.mappedColor[0],u[c]=f.mappedColor[1],r[c]=f.mappedColor[2],v[c]=f.mappedColor[3]):t[c]=u[c]=r[c]=v[c]=0}b.pixels=[t,u,r];b.mask=v;b.pixelType="u8";b.maskIsAlpha=F;return b};z.resampleByMajority=G;z.setValidBoundary=function(b,n,l){if(!B(b))return null;const {width:q,height:e}=b,g=n.x;n=n.y;const m=l.width+g;l=l.height+n;if(0>g||0>n||m>q||l>e||0===g&&0===n&&m===q&&l===e)return b;b.mask||(b.mask=new Uint8Array(q*
e));const p=b.mask;for(let f=0;f<e;f++){const h=f*q;for(let a=0;a<q;a++)p[h+a]=f<n||f>=l||a<g||a>=m?0:1}b.updateStatistics();return b};z.split=function(b,n,l){if(!B(b))return null;const {width:q,height:e}=n;let {width:g,height:m}=b;const p=new Map,f={x:0,y:0};l=null==l?1:1+l;for(let h=0;h<l;h++){const a=Math.ceil(g/q),c=Math.ceil(m/e);for(let d=0;d<c;d++){f.y=d*e;for(let k=0;k<a;k++){f.x=k*q;const t=I(b,f,n);p.set(`${h}/${d}/${k}`,t)}}h<l-1&&(b=J(b));g=Math.round(g/2);m=Math.round(m/2)}return p};
z.stretch=function(b,n){if(!B(b))return null;b=b.clone();const {pixels:l,mask:q}=b,{minCutOff:e,maxCutOff:g,gamma:m}=n,p=n.outMin||0;n=n.outMax||255;const f=b.width*b.height,h=l.length;let a;let c,d,k;const t=n-p,u=[];for(a=0;a<h;a++)u[a]=g[a]-e[a];var r=m&&m.length>=h;const v=[];if(r)for(a=0;a<h;a++)v[a]=1<m[a]?2<m[a]?6.5+(m[a]-2)**2.5:6.5+100*(2-m[a])**4:1;if(r)if(null!=q)for(r=0;r<f;r++){if(q[r])for(a=0;a<h;a++)c=l[a][r],k=(c-e[a])/u[a],d=1,1<m[a]&&(d-=(1/t)**(k*v[a])),l[a][r]=c<g[a]&&c>e[a]?Math.floor(d*
t*k**(1/m[a]))+p:c>=g[a]?n:p}else for(r=0;r<f;r++)for(a=0;a<h;a++)c=l[a][r],k=(c-e[a])/u[a],d=1,1<m[a]&&(d-=(1/t)**(k*v[a])),l[a][r]=c<g[a]&&c>e[a]?Math.floor(d*t*k**(1/m[a]))+p:c>=g[a]?n:p;else if(null!=q)for(r=0;r<f;r++){if(q[r])for(a=0;a<h;a++)c=l[a][r],l[a][r]=c<g[a]&&c>e[a]?Math.floor((c-e[a])/u[a]*t)+p:c>=g[a]?n:p}else for(r=0;r<f;r++)for(a=0;a<h;a++)c=l[a][r],l[a][r]=c<g[a]&&c>e[a]?Math.floor((c-e[a])/u[a]*t)+p:c>=g[a]?n:p;b.pixelType="u8";b.updateStatistics();return b};Object.defineProperty(z,
"__esModule",{value:!0})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/Logger ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b,n,l,q,e){const g=J.create(),m=[0,0],p=new e(0,0,0,0);x=function(f){function h(c){var d=f.call(this,c)||this;d._imagePromise=null;d.bitmaps=[];d.hidpi=!1;d.imageMaxWidth=2048;d.imageMaxHeight=2048;d.imageRotationSupported=!1;d.imageNormalizationSupported=!1;d.update=D.debounce(function(){var k=z._asyncToGenerator(function*(t,u){if(!t.stationary||d.destroyed)return null;const r=t.state;var v=B.getInfo(r.spatialReference);t=d.hidpi?t.pixelRatio:1;var F=d.imageNormalizationSupported&&
r.worldScreenWidth&&r.worldScreenWidth<r.size[0];F?(m[0]=r.worldScreenWidth,m[1]=r.size[1]):d.imageRotationSupported?(m[0]=r.size[0],m[1]=r.size[1]):n.getOuterSize(m,r);v=v&&(r.extent.xmin<v.valid[0]||r.extent.xmax>v.valid[1]);v=!d.imageNormalizationSupported&&v;const C=d.imageRotationSupported?r.rotation:0;Math.floor(m[0]*t)>d.imageMaxWidth||Math.floor(m[1]*t)>d.imageMaxHeight||v?(F=Math.min(d.imageMaxWidth,d.imageMaxHeight),v&&(F=Math.min(r.worldScreenWidth,F)),d._imagePromise=d._tiledExport(r,
F,C,t,u)):d._imagePromise=d._singleExport(r,m,F?r.paddedViewState.center:r.center,r.resolution,C,t,u);return d._imagePromise.then(function(){var K=z._asyncToGenerator(function*(N){d._imagePromise=null;if(!d.destroyed){d.bitmaps=null!=N?N:[];for(const Q of d.container.children)N.includes(Q)||Q.fadeOut().then(()=>{Q.remove()});for(const Q of N)d.container.addChild(Q),Q.fadeIn()}});return function(N){return K.apply(this,arguments)}}()).catch(K=>{d._imagePromise=null;throw K;})});return function(t,u){return k.apply(this,
arguments)}}(),5E3);return d}z._inheritsLoose(h,f);var a=h.prototype;a.destroy=function(){this.bitmaps=[]};a.updateExports=function(c){for(const d of this.container.children){if(!d.visible||!d.stage)break;c(d);d.invalidateTexture();d.requestRender()}};a._export=function(){var c=z._asyncToGenerator(function*(d,k,t,u,r,v){t=yield this.fetchSource(d,Math.floor(k*r),Math.floor(t*r),{rotation:u,pixelRatio:r,signal:v});t=new l.Bitmap(t,"additive");t.x=d.xmin;t.y=d.ymax;t.resolution=d.width/k;t.rotation=
u;t.pixelRatio=r;return t});return function(d,k,t,u,r,v){return c.apply(this,arguments)}}();a._singleExport=function(){var c=z._asyncToGenerator(function*(d,k,t,u,r,v,F){n.getBBox(g,t,u,k);d=new I(g[0],g[1],g[2],g[3],d.spatialReference);return[yield this._export(d,k[0],k[1],r,v,F)]});return function(d,k,t,u,r,v,F){return c.apply(this,arguments)}}();a._tiledExport=function(c,d,k,t,u){var r=b.create({size:d,spatialReference:c.spatialReference,scales:[c.scale]});const v=new q(r);r=v.getTileCoverage(c);
if(!r)return null;const F=[];r.forEach((C,K,N,Q)=>{p.set(C,K,N,Q);v.getTileBounds(g,p);C=new I(g[0],g[1],g[2],g[3],c.spatialReference);F.push(this._export(C,d,d,k,t,u))});return Promise.all(F)};z._createClass(h,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return h}(x);y.__decorate([E.property()],x.prototype,"_imagePromise",void 0);y.__decorate([E.property()],x.prototype,"bitmaps",void 0);y.__decorate([E.property()],x.prototype,"container",void 0);y.__decorate([E.property()],
x.prototype,"fetchSource",void 0);y.__decorate([E.property()],x.prototype,"hidpi",void 0);y.__decorate([E.property()],x.prototype,"imageMaxWidth",void 0);y.__decorate([E.property()],x.prototype,"imageMaxHeight",void 0);y.__decorate([E.property()],x.prototype,"imageRotationSupported",void 0);y.__decorate([E.property()],x.prototype,"imageNormalizationSupported",void 0);y.__decorate([E.property()],x.prototype,"requestUpdate",void 0);y.__decorate([E.property()],x.prototype,"updating",null);return x=y.__decorate([A.subclass("esri.views.2d.layers.support.ExportStrategy")],
x)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(z){const y=Math.PI/180;z.bboxIntersects=function(x,D){const [E,H,G,L]=x,[w,A,I,J]=D;return!(E>I||G<w||H>J||L<A)};z.getBBox=function(x,D,E,H){const [G,L]=D,[w,A]=H;D=.5*E;x[0]=G-D*w;x[1]=L-D*A;x[2]=G+D*w;x[3]=L+D*A;return x};z.getOuterSize=function(x,D){var E=D.rotation*y;const H=Math.abs(Math.cos(E));E=Math.abs(Math.sin(E));const [G,L]=D.size;x[0]=Math.round(L*E+G*H);x[1]=Math.round(L*H+G*E);return x};z.snapToPixel=function(x,
D,E){const {resolution:H,size:G}=E;x[0]=H*(Math.round(D[0]/H)+G[0]%2*.5);x[1]=H*(Math.round(D[1]/H)+G[1]%2*.5);return x};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/ImageryLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(z,y,x,D,E,H,G,L,w,A,I,J,B,b,n){G=l=>{l=function(q){function e(){var m=q.apply(this,arguments)||this;m.view=null;return m}y._inheritsLoose(e,q);var g=e.prototype;g.fetchPopupFeatures=function(){var m=y._asyncToGenerator(function*(p,f){const {layer:h}=this;if(!p)throw new D("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:h});var {popupEnabled:a}=h;const c=n.getFetchPopupTemplate(h,f);if(!a||!E.isSome(c))throw new D("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:a,popupTemplate:c});const d=yield c.getRequiredFields();a=new b;a.timeExtent=this.timeExtent;a.geometry=p;a.outFields=d;a.outSpatialReference=p.spatialReference;p=this.view.resolution;p="2d"===this.view.type?new J(p,p,this.view.spatialReference):new J(.5*p,.5*p,this.view.spatialReference);const {returnTopmostRaster:k,showNoDataRecords:t}=c.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};f={returnDomainValues:!0,returnTopmostRaster:k,pixelSize:p,showNoDataRecords:t,signal:E.isSome(f)?
f.signal:null};return h.queryVisibleRasters(a,f).then(u=>u)});return function(p,f){return m.apply(this,arguments)}}();g.canResume=function(){var m;return!q.prototype.canResume.call(this)||null!=(m=this.timeExtent)&&m.isEmpty?!1:!0};return e}(l);x.__decorate([H.property()],l.prototype,"layer",void 0);x.__decorate([H.property()],l.prototype,"suspended",void 0);x.__decorate([H.property(B.combinedViewLayerTimeExtentProperty)],l.prototype,"timeExtent",void 0);x.__decorate([H.property()],l.prototype,"view",
void 0);return l=x.__decorate([I.subclass("esri.views.layers.ImageryLayerView")],l)};z.ImageryLayerView=G;z.default=G;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(z,y,x,D){function E(){E=y._asyncToGenerator(function*(H,G=H.popupTemplate){if(!x.isSome(G))return[];const L=yield G.getRequiredFields(H.fieldsIndex);({lastEditInfoEnabled:G}=
G);const {objectIdField:w,typeIdField:A,globalIdField:I,relationships:J}=H;if(L.includes("*"))return["*"];G=G?yield D.getFeatureEditFields(H):[];const B=D.fixFields(H.fieldsIndex,[...L,...G]);A&&B.push(A);B&&w&&H.fieldsIndex.has(w)&&-1===B.indexOf(w)&&B.push(w);B&&I&&H.fieldsIndex.has(I)&&-1===B.indexOf(I)&&B.push(I);J&&J.forEach(b=>{({keyField:b}=b);B&&b&&H.fieldsIndex.has(b)&&-1===B.indexOf(b)&&B.push(b)});return B});return E.apply(this,arguments)}z.getFetchPopupTemplate=function(H,G){return H.popupTemplate?
H.popupTemplate:x.isSome(G)&&G.defaultPopupTemplateEnabled&&x.isSome(H.defaultPopupTemplate)?H.defaultPopupTemplate:null};z.getRequiredFields=function(H){return E.apply(this,arguments)};Object.defineProperty(z,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./imagery/ImageryGraphicsView2D ./imagery/ImageryView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(z,y,x,D,E,H,G,L,w,A,
I,J,B,b,n){E=function(l){function q(){var g=l.apply(this,arguments)||this;g._exportImageVersion=-1;return g}z._inheritsLoose(q,l);var e=q.prototype;e.initialize=function(){this.handles.add(x.init(this,["layer.blendMode"],g=>{this.subview&&(this.subview.container.blendMode=g)},!0))};e.hitTest=function(g,m){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(g,m)};e.update=function(g){var m;null==(m=this.subview)?void 0:m.update(g)};e.attach=function(){this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.handles.add([x.init(this,"layer.exportImageServiceParameters.version",g=>{this._exportImageVersion!==g&&(this._exportImageVersion=g,this.requestUpdate())}),this.watch("timeExtent",()=>{this.subview.timeExtent=this.timeExtent;this.requestUpdate()}),this.layer.on("redraw",()=>this.subview.redraw()),x.watch(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")};e.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.subview.destroy();this.handles.remove("imagerylayerview-update");
this._exportImageVersion=-1};e.moveStart=function(){};e.viewChange=function(){};e.moveEnd=function(){this.requestUpdate()};e.doRefresh=function(){var g=z._asyncToGenerator(function*(){this.requestUpdate()});return function(){return g.apply(this,arguments)}}();e.isUpdating=function(){return!this.subview||!this.suspended&&this.subview.isUpdating()};e._setSubView=function(){var g;let m="Imagery";"vector-field"===(null==(g=this.layer.renderer)?void 0:g.type)&&"lerc"===this.layer.format&&(m="Graphics");
if(!this.subview||this.subview.type!==m){var p,f;null==(p=this.subview)?void 0:p.uninstall(this.container);null==(f=this.subview)?void 0:f.destroy();this.subview="Imagery"===m?new J({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new I({layer:this.layer,view:this.view,timeExtent:this.timeExtent});this.subview.attach();this.subview.install(this.container);this.subview.container.blendMode=this.layer.blendMode}this.requestUpdate()};z._createClass(q,[{key:"pixelData",get:function(){return this.updating?
null:this.subview.getPixelData()}},{key:"updating",get:function(){return!(this.subview&&!this.subview.updating)}}]);return q}(B.ImageryLayerView(n.RefreshableLayerView(A.LayerView2DMixin(b))));y.__decorate([D.property()],E.prototype,"pixelData",null);y.__decorate([D.property({readOnly:!0})],E.prototype,"updating",null);y.__decorate([D.property()],E.prototype,"subview",void 0);return E=y.__decorate([w.subclass("esri.views.2d.layers.ImageryLayerView2D")],E)});