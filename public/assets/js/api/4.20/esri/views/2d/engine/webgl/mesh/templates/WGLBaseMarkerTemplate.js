// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../../../../../layers/graphics/featureConversionUtils ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../enums ../../number".split(" "),function(w,q,x,n,y,g,r,t,z,A,k){const u=3.14159265359/180;return B=>function(v){function p(...a){a=
v.call(this,...a)||this;a.angle=0;a.xOffset=0;a.yOffset=0;a.width=0;a.height=0;a.boundsType="square";a._anchorX=0;a._anchorY=0;a._computedWidth=0;a._computedHeight=0;a._vertexBoundsScaleX=1;a._vertexBoundsScaleY=1;a._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0};a.geometryType=A.WGLGeometryType.MARKER;return a}w._inheritsLoose(p,v);var h=p.prototype;h._write=function(a,b,c){const f=b.getDisplayId();a.recordStart(f,this._materialKey,
this.geometryType,!1,!0);this._writeGeometry(a,b,f,c);a.recordEnd()};h._writeGeometry=function(a,b,c,f){if(q.isSome(this._markerPlacement))return this._writePlacedMarkers(a,b,f);if(b=f?t.deltaDecodeGeometry(t.convertFromGeometry(f),2):"esriGeometryPolygon"===b.geometryType?b.readCentroid():b.readUnquantizedGeometry()){if(b.isPoint){const [e,d]=b.coords;return!a.hasAggregates&&a.hasPixelBufferEnabled&&(-1>e||513<=e||-1>d||513<=d)?void 0:this._writeVertices(a,c,this._getPos(e,d),e,d)}b.forEachVertex((e,
d)=>this._writeVertices(a,c,this._getPos(e,d),e,d))}};h._writePlacedMarkers=function(a,b,c){c=null!=c?c:b.readLegacyGeometry();if(c=z.CIMMarkerPlacementHelper.getPlacement(c,q.unwrap(this._markerPlacement),x.pt2px(1))){b=b.getDisplayId();for(var f=r.create(),e=y.create(),d=c.next();null!=d;){const {tx:l,ty:m}=d;-128<=l&&640>=l&&-128<=m&&640>=m&&(this._applyTransformation(e,f,d.getAngle()/u),this._writeVertices(a,b,this._getPos(l,m),l,m));d=c.next()}}};h._writeVertices=function(a,b,c,f,e){const d=
a.vertexCount();a.vertexBounds(f+this.xOffset,e-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);a.vertexWrite(c);a.vertexWrite(this._offsetUpperLeft);a.vertexWrite(this._texUpperLeft);a.vertexWrite(this._bitestAndDistRatio);a.vertexWrite(b);a.vertexWrite(this._fillColor);a.vertexWrite(this._outlineColor);a.vertexWrite(this._sizeOutlineWidth);a.vertexWrite(this._minMaxZoom);a.vertexEnd();a.vertexWrite(c);a.vertexWrite(this._offsetUpperRight);
a.vertexWrite(this._texUpperRight);a.vertexWrite(this._bitestAndDistRatio);a.vertexWrite(b);a.vertexWrite(this._fillColor);a.vertexWrite(this._outlineColor);a.vertexWrite(this._sizeOutlineWidth);a.vertexWrite(this._minMaxZoom);a.vertexEnd();a.vertexWrite(c);a.vertexWrite(this._offsetBottomLeft);a.vertexWrite(this._texBottomLeft);a.vertexWrite(this._bitestAndDistRatio);a.vertexWrite(b);a.vertexWrite(this._fillColor);a.vertexWrite(this._outlineColor);a.vertexWrite(this._sizeOutlineWidth);a.vertexWrite(this._minMaxZoom);
a.vertexEnd();a.vertexWrite(c);a.vertexWrite(this._offsetBottomRight);a.vertexWrite(this._texBottomRight);a.vertexWrite(this._bitestAndDistRatio);a.vertexWrite(b);a.vertexWrite(this._fillColor);a.vertexWrite(this._outlineColor);a.vertexWrite(this._sizeOutlineWidth);a.vertexWrite(this._minMaxZoom);a.vertexEnd();a.indexWrite(d+0);a.indexWrite(d+1);a.indexWrite(d+2);a.indexWrite(d+1);a.indexWrite(d+3);a.indexWrite(d+2)};h._applyTransformation=function(a,b,c=0){n.identity(a);n.translate(a,a,r.fromValues(this.xOffset,
-this.yOffset));0!==this.angle+c&&n.rotate(a,a,u*(this.angle+c));c=this._computedWidth;const f=this._computedHeight,e=(this._anchorX-.5)*c,d=(this._anchorY-.5)*f;g.set(b,e,d);g.transformMat2d(b,b,a);this._offsetUpperLeft=k.i1616to32(16*b[0],16*b[1]);this._offsets.xUpperLeft=b[0];this._offsets.yUpperLeft=b[1];g.set(b,e+c,d);g.transformMat2d(b,b,a);this._offsetUpperRight=k.i1616to32(16*b[0],16*b[1]);this._offsets.xUpperRight=b[0];this._offsets.yUpperRight=b[1];g.set(b,e,d+f);g.transformMat2d(b,b,a);
this._offsetBottomLeft=k.i1616to32(16*b[0],16*b[1]);this._offsets.xBottomLeft=b[0];this._offsets.yBottomLeft=b[1];g.set(b,e+c,d+f);g.transformMat2d(b,b,a);this._offsetBottomRight=k.i1616to32(16*b[0],16*b[1]);this._offsets.xBottomRight=b[0];this._offsets.yBottomRight=b[1]};h._getPos=function(a,b){return k.i1616to32(Math.round(8*a),Math.round(8*b))};return p}(B)});