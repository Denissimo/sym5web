// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/workers/workers ../../../../../../layers/graphics/featureConversionUtils ../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../rest/query/operations/query ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderPBF".split(" "),function(l,g,q,m,p,n,h,r){let k=function(){function c(d){this.service=d}c.prototype.destroy=function(){};return c}(),t=function(c){function d(b){var a=c.call(this,b)||
this;a._portsOpen=q.openWithPorts(b.source).then(f=>a.client=f);return a}g._inheritsLoose(d,c);var e=d.prototype;e.destroy=function(){this.client.close();this.client=null};e.executeQuery=function(){var b=g._asyncToGenerator(function*(a,f){yield this._portsOpen;a=yield this.client.invoke("queryFeatures",a.toJSON(),f);return h.FeatureSetReaderJSON.fromFeatureSet(a,this.service.objectIdField)});return function(a,f){return b.apply(this,arguments)}}();return d}(k),u=function(c){function d(){return c.apply(this,
arguments)||this}g._inheritsLoose(d,c);d.prototype.executeQuery=function(){var e=g._asyncToGenerator(function*(b,a){({data:a}=yield n.executeQueryPBFBuffer(this.service.source,b,{...a,query:{...this.service.customParameters,...null==a?void 0:a.query}}));return r.FeatureSetReaderPBF.fromBuffer(a,this.service.geometryType,!b.quantizationParameters)});return function(b,a){return e.apply(this,arguments)}}();return d}(k),y=function(c){function d(){return c.apply(this,arguments)||this}g._inheritsLoose(d,
c);d.prototype.executeQuery=function(){var e=g._asyncToGenerator(function*(b,a){const {source:f,capabilities:v,spatialReference:w,objectIdField:x}=this.service;if(b.quantizationParameters&&!v.query.supportsQuantization)return b=b.clone(),b.quantizationParameters=null,{data:b}=yield n.executeQuery(f,b,w,{...a,query:{...this.service.customParameters,...null==a?void 0:a.query}}),b=m.convertFromFeatureSet(b,x),m.quantizeOptimizedFeatureSet(a.transform,b),h.FeatureSetReaderJSON.fromOptimizedFeatureSet(b);
({data:a}=yield n.executeQuery(f,b,this.service.spatialReference,{...a,query:{...this.service.customParameters,...null==a?void 0:a.query}}));return h.FeatureSetReaderJSON.fromFeatureSet(a,this.service.objectIdField)});return function(b,a){return e.apply(this,arguments)}}();return d}(k),z=function(c){function d(){return c.apply(this,arguments)||this}g._inheritsLoose(d,c);d.prototype.executeQuery=function(){var e=g._asyncToGenerator(function*(b,a){const {capabilities:f}=this.service;if(b.quantizationParameters&&
!f.query.supportsQuantization)return b.clone().quantizationParameters=null,b=yield p.queryOptimizedFeatureSet(this.service.source,b,a),m.quantizeOptimizedFeatureSet(a.transform,b),h.FeatureSetReaderJSON.fromOptimizedFeatureSet(b);a=yield p.queryOptimizedFeatureSet(this.service.source,b,a);return h.FeatureSetReaderJSON.fromOptimizedFeatureSet(a)});return function(b,a){return e.apply(this,arguments)}}();return d}(k);l.SourceAdapter=k;l.createSourceAdapter=function(c){const {capabilities:d}=c;var e=
c.source;return e&&e.capabilities&&e.collectionId&&e.layerDefinition&&e.url?new z(c):Array.isArray(c.source)?new t(c):d.query.supportsFormatPBF?new u(c):new y(c)};Object.defineProperty(l,"__esModule",{value:!0})});