// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../core/has ../../../../../chunks/rbush ./Tile ../../../tiling/TileCoverage ../../../tiling/TileKey".split(" "),function(q,r,t,u,n,v,w){const f={added:[],removed:[]},l=new Set,x=new w(0,0,0,0);return function(p){function m(a){var c=p.call(this)||this;c._tiles=new Map;c._index=u.rbush(9,t("csp-restrictions")?b=>({minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}):[".bounds[0]",".bounds[1]",
".bounds[2]",".bounds[3]"]);c.tiles=[];c.tileScheme=a;return c}q._inheritsLoose(m,p);var g=m.prototype;g.destroy=function(){this.clear()};g.clear=function(){this.tiles.length=0;this._tiles.clear();this._index.clear()};g.has=function(a){return this._tiles.has(a)};g.get=function(a){return this._tiles.get(a)};g.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})};g.updateTiles=function(a){const c={added:[],removed:[]};for(const b of a.added)if(!this.has(b)){const d=
new n.Tile(this.tileScheme,b);this._tiles.set(b,d);this._index.insert(d);c.added.push(d)}for(const b of a.removed)this.has(b)&&(a=this.get(b),this._tiles.delete(b),this._index.remove(a),c.removed.push(a));this.tiles.length=0;this._tiles.forEach(b=>this.tiles.push(b));(c.added.length||c.removed.length)&&this.emit("update",c)};g.setViewState=function(a){if(a=this.tileScheme.getTileCoverage(a,0)){var {spans:c,lodInfo:b}=a,{level:d}=b;if(0<c.length)for(const {row:y,colFrom:z,colTo:A}of c)for(var e=z;e<=
A;e++){const h=x.set(d,y,b.normalizeCol(e),b.getWorldForColumn(e)).id;l.add(h);if(!this.has(h)){const k=new n.Tile(this.tileScheme,h);this._tiles.set(h,k);this._index.insert(k);this.tiles.push(k);f.added.push(k)}}for(d=this.tiles.length-1;0<=d;d--)e=this.tiles[d],l.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(d,1),this._index.remove(e),f.removed.push(e));(f.added.length||f.removed.length)&&this.emit("update",f);v.pool.release(a);l.clear();f.added.length=0;f.removed.length=0}};return m}(r)});