// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../brushes","./shaders/VTLMaterialManager"],function(k,l,m,n){return function(){function h(a,c){this.spriteMosaic=a;this.glyphMosaic=c;this._brushCache=new Map;this._vtlMaterialManager=new n}var g=h.prototype;g.dispose=function(){this._brushCache&&(this._brushCache.forEach(a=>a.dispose()),this._brushCache=null);this._vtlMaterialManager=l.disposeMaybe(this._vtlMaterialManager);this.spriteMosaic.dispose();this.glyphMosaic.dispose()};
g.drawTile=function(a,c,d){const {context:b}=a,e=d.layers;0<d.backgroundBucketIds.length&&(a.renderPass="background",d.backgroundBucketIds.forEach(p=>this._renderStyleLayer(d.getLayerById(p),a,c,!0)));b.setBlendingEnabled(!1);b.setDepthTestEnabled(!0);b.setDepthWriteEnabled(!0);b.setDepthFunction(515);a.renderPass="opaque";for(var f=e.length-1;0<=f;f--)this._renderStyleLayer(e[f],a,c,!1);b.setDepthWriteEnabled(!1);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(1,771,1,771);a.renderPass="translucent";
for(f=0;f<e.length;f++)this._renderStyleLayer(e[f],a,c,!1);b.setDepthTestEnabled(!1);a.renderPass="symbol";for(f=0;f<e.length;f++)this._renderStyleLayer(e[f],a,c,!1);b.bindVAO()};g._renderStyleLayer=function(a,c,d,b=!1){if(b||a&&d.layerData.has(a.uid))if(b=a.getLayoutProperty("visibility"),!b||1!==b.getValue()){({renderPass:b}=c);switch(a.type){case 0:if("background"!==b)return;var e="vtlBackground";break;case 1:if("opaque"!==b&&"translucent"!==c.renderPass)return;e="vtlFill";break;case 2:if("translucent"!==
b)return;e="vtlLine";break;case 4:if("symbol"!==b)return;e="vtlCircle";break;case 3:if("symbol"!==b)return;e="vtlSymbol"}b=c.displayLevel;void 0!==a.minzoom&&a.minzoom>b+1E-6||void 0!==a.maxzoom&&a.maxzoom<=b-1E-6||(c.styleLayerUID=a.uid,c.styleLayer=a,this.drawWithBrush(c,d,e))}};g.drawWithBrush=function(a,c,d){this._brushCache.has(d)||this._brushCache.set(d,new m.vtlBrushes[d]);this._brushCache.get(d).drawMany(a,[c])};k._createClass(h,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}}]);
return h}()});