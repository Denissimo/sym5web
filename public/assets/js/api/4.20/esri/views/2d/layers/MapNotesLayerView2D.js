// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(m,v,w,x,k,l,p,C,D,E,F,y,
z,r,t,A){const B=Object.freeze({remove(){},pause(){},resume(){}});p=function(u){function q(){return u.apply(this,arguments)||this}m._inheritsLoose(q,u);var d=q.prototype;d.fetchPopupFeatures=function(){var a=m._asyncToGenerator(function*(c){return(yield Promise.all(Array.from(this.graphicsViews(),b=>b.searchFeatures(c).then(e=>e.filter(f=>!!f.popupTemplate))))).flat()});return function(c){return a.apply(this,arguments)}}();d.graphicsViews=function*(){k.isSome(this._graphicsViewsFeatureCollectionMap)?
yield*this._graphicsViewsFeatureCollectionMap.keys():k.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};d.hitTest=function(){var a=m._asyncToGenerator(function*(c,b){var e=this;if(this.suspended)return null;const f=Array.from(this.graphicsViews(),function(){var g=m._asyncToGenerator(function*(h){const n=yield h.hitTest(c,b);return n?(k.isSome(e._graphicsViewsFeatureCollectionMap)&&(h=e._graphicsViewsFeatureCollectionMap.get(h),!n.popupTemplate&&h.popupTemplate&&(n.popupTemplate=h.popupTemplate)),
n):null});return function(h){return g.apply(this,arguments)}}());return(yield Promise.all(f)).filter(g=>!!g)[0]||null});return function(c,b){return a.apply(this,arguments)}}();d.highlight=function(a){let c;"number"===typeof a?c=[a]:a instanceof w?c=[a.uid]:Array.isArray(a)&&0<a.length?c="number"===typeof a[0]?a:a.map(b=>b&&b.uid):x.isCollection(a)&&(c=a.map(b=>b&&b.uid).toArray());c=c.filter(b=>null!=b);if(!c.length)return B;for(const b of this.graphicsViews())b.addHighlight(c);return{remove:()=>
{for(const b of this.graphicsViews())b.removeHighlight(c)}}};d.update=function(a){for(const c of this.graphicsViews())c.processUpdate(a)};d.attach=function(){const a=this.view,c=()=>this.requestUpdate();var b=this.layer.featureCollections;if(k.isSome(b)&&b.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const e of b){b=new r(this.view.featuresTilingScheme);b.fadeTransitionEnabled=!0;const f=new t({view:a,graphics:e.source,renderer:e.renderer,requestUpdateCallback:c,container:b});this._graphicsViewsFeatureCollectionMap.set(f,
e);this.container.addChild(f.container);this.handles.add([l.init(e,"visible",g=>f.container.visible=g),l.init(f,"updating",()=>this.notifyChange("updating"))],"layerView")}}else k.isSome(this.layer.sublayers)&&this.handles.add(l.on(this.layer,"sublayers","change",()=>this._createGraphicsViews(),()=>this._createGraphicsViews(),()=>this._destroyGraphicsViews()),"sublayers")};d.detach=function(){this._destroyGraphicsViews();this.handles.remove("sublayers")};d.moveStart=function(){};d.moveEnd=function(){};
d.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};d.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};d._destroyGraphicsViews=function(){this.container.removeAllChildren();this.handles.remove("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};d._createGraphicsViews=function(){this._destroyGraphicsViews();if(!k.isNone(this.layer.sublayers)){var a=[],c=this.view,
b=()=>this.requestUpdate();for(const e of this.layer.sublayers){const f=new r(this.view.featuresTilingScheme);f.fadeTransitionEnabled=!0;const g=new t({view:c,graphics:e.graphics,requestUpdateCallback:b,container:f});this.handles.add([e.on("graphic-update",g.graphicUpdateHandler),l.init(e,"visible",h=>g.container.visible=h),l.init(g,"updating",()=>this.notifyChange("updating"))],"layerView");this.container.addChild(g.container);a.push(g)}this._graphicsViews=a}};return q}(z.LayerView2DMixin(A));return p=
v.__decorate([y.subclass("esri.views.2d.layers.MapNotesLayerView2D")],p)});