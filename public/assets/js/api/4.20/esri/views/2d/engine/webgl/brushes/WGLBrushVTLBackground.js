// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../../../../webgl/BufferObject ../../../../webgl/FramebufferObject ../../../../webgl/Program ../../../../webgl/ProgramCache ../../../../webgl/Renderbuffer ../../../../webgl/RenderingContext ../../../../webgl/ShaderCompiler ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../definitions ../enums ../number ./WGLBrush".split(" "),
function(v,F,w,x,G,H,I,y,Q,R,S,T,U,V,J,n,K,L,M){y=function(z){function p(){var a=z.apply(this,arguments)||this;a._color=H.fromValues(1,0,0,1);a._patternMatrix=G.create();a._programOptions={id:!1,pattern:!1};return a}F._inheritsLoose(p,z);var q=p.prototype;q.dispose=function(){this._vao&&(this._vao.dispose(),this._vao=null)};q.drawMany=function(a,g){const {context:f,painter:h,styleLayerUID:N}=a;this._loadWGLResources(a);const k=a.displayLevel;var c=a.styleLayer,b=c.backgroundMaterial;const O=h.vectorTilesMaterialManager;
var d=c.getPaintValue("background-color",k);const A=c.getPaintValue("background-opacity",k),B=c.getPaintValue("background-pattern",k),r=void 0!==B,l=d[3]*A,t=a.spriteMosaic;let C,D;const P=(window.devicePixelRatio|1)>n.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===K.WGLDrawPhase.HITTEST;const u=this._programOptions;u.id=a;u.pattern=r;b=O.getMaterialProgram(f,b,u);f.bindVAO(this._vao);f.useProgram(b);if(r){d=t.getMosaicItemPosition(B,!0);if(x.isSome(d)){const {tl:e,br:m,page:E}=d;C=m[0]-e[0];D=m[1]-e[1];
d=t.getPageSize(E);x.isSome(d)&&(t.bind(f,9729,E,n.VTL_TEXTURE_BINDING_UNIT_SPRITES),b.setUniform4f("u_tlbr",e[0],e[1],m[0],m[1]),b.setUniform2fv("u_mosaicSize",d),b.setUniform1i("u_texture",n.VTL_TEXTURE_BINDING_UNIT_SPRITES))}b.setUniform1f("u_opacity",A)}else this._color[0]=l*d[0],this._color[1]=l*d[1],this._color[2]=l*d[2],this._color[3]=l,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",c.z||0);a&&(c=L.u32to4Xu8(N+1),b.setUniform4fv("u_id",c));for(const e of g)b.setUniform1f("u_coord_range",
e.coordRange[0]),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),r&&(c=P*e.size[0]*Math.max(2**(Math.round(k)-e.key.level),1),g=c/w.nextPowerOfTwo(C),c/=w.nextPowerOfTwo(D),this._patternMatrix[0]=g,this._patternMatrix[4]=c,b.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),f.setStencilFunction(514,e.stencilRef,255),f.drawArrays(5,0,4)};q._loadWGLResources=function(a){if(!this._vao){var {context:g,styleLayer:f}=a;a=f.backgroundMaterial;var h=new Int8Array([0,0,1,0,0,1,1,1]);h=I.createVertex(g,
35044,h);this._vao=new J(g,a.getAttributeLocations(),a.getLayoutInfo(),{geometry:h})}};return p}(M);v.WGLBrushVTLBackground=y;Object.defineProperty(v,"__esModule",{value:!0})});