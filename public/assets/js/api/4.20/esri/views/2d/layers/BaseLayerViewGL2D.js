// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../chunks/earcut ../../../geometry/support/aaBoundingRect ../../../geometry/support/coordsUtils ../../../geometry/support/normalizeUtilsSync ../../../layers/graphics/data/projectionSupport ../tiling/PagedTileQueue ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/definitions ../engine/webgl/TurboLine ./LayerView2D ./support/DisplayGL ./support/util ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(n,t,x,q,U,V,W,D,E,F,G,H,z,X,I,Y,Z,aa,J,K,L,M,A,N,O){const y=new Set,u=[],v=[];let P=function(w,r,g,c,a,b,d,e=[0,0],f=F.create()){this.id=w;this.level=r;this.row=g;this.col=c;this.world=a;this.resolution=b;this.scale=d;this.coords=e;this.bounds=f};q=function(w){function r(c){c=w.call(this,c)||this;c._tileMap=new Map;c.container=new M.DisplayGL(n._assertThisInitialized(c));c.layer=null;c.tiles=[];c._renderTarget={framebuffer:null,viewport:[0,0,0,0]};return c}n._inheritsLoose(r,w);var g=r.prototype;
g.attach=function(){};g.detach=function(){};g.requestRender=function(){this.container.requestRender()};g.tilesChanged=function(c,a){};g.doRefresh=function(){var c=n._asyncToGenerator(function*(){});return function(){return c.apply(this,arguments)}}();g.isUpdating=function(){return!1};g.update=function(c){var a=this._tileInfoView;const b=this.tiles;if(a){c=a.getTileCoverage(c.state,0);const {spans:e,lodInfo:f}=c;({level:c}=f);if(e.length)for(const {row:h,colFrom:l,colTo:k}of e)for(a=l;a<=k;a++){var d=
f.normalizeCol(a);const p=f.getWorldForColumn(a),m=`${c}/${h}/${d}/${p}`;this._tileMap.has(m)||(d=new P(m,c,h,d,p,f.resolution,f.scale),f.getTileCoords(d.coords,d,!1),f.getTileBounds(d.bounds,d,!0),this._tileMap.set(m,d),b.push(d),u.push(d));y.add(m)}}for(c=b.length-1;0<=c;c--)a=b[c],y.has(a.id)||(b.splice(c,1),v.push(a),this._tileMap.delete(a.id));if(u.length||v.length)this.tilesChanged(u,v),u.length=v.length=0;y.clear();this.requestRender()};g.moveStart=function(){};g.viewChange=function(){this.requestUpdate()};
g.moveEnd=function(){};g.bindRenderTarget=function(){this.context.bindFramebuffer(this.context.FRAMEBUFFER,this._renderTarget.framebuffer);this.context.viewport(this._renderTarget.viewport[0],this._renderTarget.viewport[1],this._renderTarget.viewport[2],this._renderTarget.viewport[3])};g.getRenderTarget=function(){return this._renderTarget};g.tessellateExtent=function(){var c=n._asyncToGenerator(function*(a){const b={vertices:[],indices:[]};a=yield this._projectAndNormalizeGeometry(a);const d=b.vertices.length;
b.vertices.push({x:a.xmin,y:a.ymin,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:0,distance:0});b.vertices.push({x:a.xmax,y:a.ymin,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:0,distance:0});b.vertices.push({x:a.xmin,y:a.ymax,xOffset:0,yOffset:0,uTexcoord:0,vTexcoord:1,distance:0});b.vertices.push({x:a.xmax,y:a.ymax,xOffset:0,yOffset:0,uTexcoord:1,vTexcoord:1,distance:0});b.indices.push(d+0,d+1,d+2,d+1,d+3,d+2);return b});return function(a){return c.apply(this,arguments)}}();g.tessellatePoint=function(){var c=
n._asyncToGenerator(function*(a,b){a=yield this._projectAndNormalizeGeometry(a);return this._tessellatePoints([a],b)});return function(a,b){return c.apply(this,arguments)}}();g.tessellateMultipoint=function(){var c=n._asyncToGenerator(function*(a,b){const d=yield this._projectAndNormalizeGeometry(a);a=d.points.map(e=>({x:e[0],y:e[1],spatialReference:d.spatialReference}));return this._tessellatePoints(a,b)});return function(a,b){return c.apply(this,arguments)}}();g._tessellatePoints=function(){var c=
n._asyncToGenerator(function*(a,b){const d={vertices:[],indices:[]};for(const e of a)a=d.vertices.length,d.vertices.push({x:e.x,y:e.y,xOffset:b.x,yOffset:b.y+b.height,uTexcoord:0,vTexcoord:0,distance:0}),d.vertices.push({x:e.x,y:e.y,xOffset:b.x+b.width,yOffset:b.y+b.height,uTexcoord:1,vTexcoord:0,distance:0}),d.vertices.push({x:e.x,y:e.y,xOffset:b.x,yOffset:b.y,uTexcoord:0,vTexcoord:1,distance:0}),d.vertices.push({x:e.x,y:e.y,xOffset:b.x+b.width,yOffset:b.y,uTexcoord:1,vTexcoord:1,distance:0}),d.indices.push(a+
0,a+1,a+2,a+1,a+3,a+2);return d});return function(a,b){return c.apply(this,arguments)}}();g.tessellatePolyline=function(){var c=n._asyncToGenerator(function*(a,b){const d={vertices:[],indices:[]};var e=(yield this._projectAndNormalizeGeometry(a)).paths;if(!e||!e.length)return d;let f;a=new K.LineTessellation((h,l,k,p,m,B,Q,R,ba,S,C)=>{k=d.vertices.length;d.vertices.push({x:h,y:-l,xOffset:Q*b/2,yOffset:R*b/2,uTexcoord:C/f,vTexcoord:(S+1)/2,distance:C});return k},(h,l,k)=>{d.indices.push(h,l,k)},!0);
for(const h of e){f=0;for(e=1;e<h.length;++e){const l=h[e][0]-h[e-1][0],k=h[e][1]-h[e-1][1];f+=Math.sqrt(l*l+k*k)}e=h.map(l=>({x:l[0],y:-l[1]}));a.tessellate(e,T)}return d});return function(a,b){return c.apply(this,arguments)}}();g.tessellatePolygon=function(){var c=n._asyncToGenerator(function*(a){const b={vertices:[],indices:[]};a=yield this._projectAndNormalizeGeometry(a);const d=a.rings;if(!d||!d.length)return b;G.closeRings(a);for(const k of a.rings)for(const p of k)p[1]=-p[1];let e=Infinity,
f=Infinity,h=-Infinity,l=-Infinity;A.analyzeRings(a.rings,()=>{},(k,p,m)=>{for(;k<p;k+=2)e=Math.min(e,m[k]),f=Math.min(f,m[k+1]),h=Math.max(h,m[k]),l=Math.max(l,m[k+1])});A.analyzeRings(a.rings,()=>{},(k,p,m,B)=>{this._invokeEarcut(b,k,p,m,B,[e,f,h,l])});return b});return function(a){return c.apply(this,arguments)}}();g._invokeEarcut=function(c,a,b,d,e,f){a=d.slice(a,b);e=E.earcut(a,e,2);b=c.vertices.length;for(d=0;d<a.length;d+=2){const h=a[d],l=a[d+1];c.vertices.push({x:h,y:-l,xOffset:0,yOffset:0,
uTexcoord:(h-f[0])/(f[2]-f[0]),vTexcoord:1-(l-f[1])/(f[3]-f[1]),distance:0})}for(f=0;f<e.length;++f)c.indices.push(b+e[f])};g._projectAndNormalizeGeometry=function(){var c=n._asyncToGenerator(function*(a){yield z.checkProjectionSupport(a.spatialReference,this.view.spatialReference);const b=H.normalizeCentralMeridianSync(a);return z.project(b,a.spatialReference,this.view.spatialReference)});return function(a){return c.apply(this,arguments)}}();n._createClass(r,[{key:"_tileInfoView",get:function(){const c=
this.layer&&this.layer.tileInfo;return c?new I(c):null}},{key:"context",get:function(){return this.view._stage.context.gl}}]);return r}(O.RefreshableLayerView(L.LayerView2DMixin(N)));t.__decorate([x.property()],q.prototype,"_tileInfoView",null);t.__decorate([x.property()],q.prototype,"layer",void 0);t.__decorate([x.property()],q.prototype,"context",null);q=t.__decorate([D.subclass("esri.views.2d.layers.BaseLayerViewGL2D")],q);const T={pixelCoordRatio:1,wrapDistance:1E11,halfWidth:J.THIN_LINE_HALF_WIDTH_THRESHOLD+
1,initialDistance:0,textured:!0,offset:0};return q});