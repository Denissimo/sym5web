// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./definitions","./Geometry","./GeometryUtils"],function(w,y,z,q,u){let v=function(m,d,a){this.ratio=m;this.x=d;this.y=a},B=function(){function m(a,b,e,f=8,c=8){this.lines=[];this.starts=[];this.validateTessellation=!0;this.pixelRatio=f;this.pixelMargin=c;this.tileSize=z.TILE_SIZE*f;this.dz=a;this.yPos=b;this.xPos=e}var d=m.prototype;d.setPixelMargin=function(a){a!==this.pixelMargin&&(this.pixelMargin=a,this.setExtent(this._extent))};
d.setExtent=function(a){this._extent=a;this.finalRatio=this.tileSize/a*(1<<this.dz);let b=this.pixelRatio*this.pixelMargin;b/=this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};d.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};d.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new q.Point(a,
b);this._firstPt=new q.Point(a,b);this._dist=0};d.lineTo=function(a,b){const e=this._isIn(a,b),f=new q.Point(a,b),c=q.Point.distance(this._prevPt,f);if(e)if(this._prevIsIn)this._lineTo(a,b,!0);else{var g=this._prevPt;var h=f;a=this._intersect(h,g);this.start=this._dist+c*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(h.x,h.y,!0)}else if(this._prevIsIn)h=this._prevPt,g=f,a=this._intersect(h,g),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!1);else{const k=this._prevPt;if(!(k.x<=this.xmin&&f.x<=
this.xmin||k.x>=this.xmax&&f.x>=this.xmax||k.y<=this.ymin&&f.y<=this.ymin||k.y>=this.ymax&&f.y>=this.ymax)){a=[];if(k.x<this.xmin&&f.x>this.xmin||k.x>this.xmin&&f.x<this.xmin){b=(this.xmin-k.x)/(f.x-k.x);var l=k.y+b*(f.y-k.y);l<=this.ymin?h=!1:l>=this.ymax?h=!0:a.push(new v(b,this.xmin,l))}if(k.x<this.xmax&&f.x>this.xmax||k.x>this.xmax&&f.x<this.xmax)b=(this.xmax-k.x)/(f.x-k.x),l=k.y+b*(f.y-k.y),l<=this.ymin?h=!1:l>=this.ymax?h=!0:a.push(new v(b,this.xmax,l));if(k.y<this.ymin&&f.y>this.ymin||k.y>
this.ymin&&f.y<this.ymin)b=(this.ymin-k.y)/(f.y-k.y),l=k.x+b*(f.x-k.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:a.push(new v(b,l,this.ymin));if(k.y<this.ymax&&f.y>this.ymax||k.y>this.ymax&&f.y<this.ymax)b=(this.ymax-k.y)/(f.y-k.y),l=k.x+b*(f.x-k.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:a.push(new v(b,l,this.ymax));if(0===a.length)g?h?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>
a[1].ratio)this.start=this._dist+c*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+c*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=c;this._prevIsIn=e;this._prevPt=f};d.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),
a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};d.result=function(a=!0){this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&A.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};d.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();const a=this.lines,b=a.length;if(0===b)return null;const e=[];for(let f=0;f<b;f++)e.push({line:a[f],start:this.starts[f]||0});return e};d._isIn=function(a,b){return a>=this.xmin&&
a<=this.xmax&&b>=this.ymin&&b<=this.ymax};d._intersect=function(a,b){let e,f,c;if(b.x>=this.xmin&&b.x<=this.xmax)f=b.y<=this.ymin?this.ymin:this.ymax,c=(f-a.y)/(b.y-a.y),e=a.x+c*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)e=b.x<=this.xmin?this.xmin:this.xmax,c=(e-a.x)/(b.x-a.x),f=a.y+c*(b.y-a.y);else{f=b.y<=this.ymin?this.ymin:this.ymax;e=b.x<=this.xmin?this.xmin:this.xmax;const g=(e-a.x)/(b.x-a.x),h=(f-a.y)/(b.y-a.y);g<h?(c=g,f=a.y+g*(b.y-a.y)):(c=h,e=a.x+h*(b.x-a.x))}this._r=c;return new q.Point(e,
f)};d._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};d._moveTo=function(a,b,e){3!==this.type?e&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),
this.line.push(new q.Point(a,b))):(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new q.Point(a,b)),this._is_v=this._is_h=!1)};d._lineTo=function(a,b,e){if(3!==this.type)if(e){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&
(e=this.line[this.line.length-1],e.equals(a,b)))return;this.line.push(new q.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){e=this.line[this.line.length-1];const f=e.x===a,c=e.y===b;f&&c||(this._is_h&&f?(e.x=a,e.y=b,
e=this.line[this.line.length-2],e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):this._is_v&&c?(e.x=a,e.y=b,e=this.line[this.line.length-2],e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):(this.line.push(new q.Point(a,
b)),this._is_h=f,this._is_v=c))}else this.line.push(new q.Point(a,b))};return m}(),C=function(){function m(){}var d=m.prototype;d.setExtent=function(a){this._ratio=4096===a?1:4096/a};d.reset=function(a){this.lines=[];this.line=null};d.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];const e=this._ratio;this.line.push(new q.Point(a*e,b*e))};d.lineTo=function(a,b){const e=this._ratio;this.line.push(new q.Point(a*e,b*e))};d.close=function(){const a=this.line;a&&!a[0].isEqual(a[a.length-
1])&&a.push(a[0])};d.result=function(){this.line&&this.lines.push(this.line);return 0===this.lines.length?null:this.lines};y._createClass(m,[{key:"validateTessellation",get:function(){return 1>this._ratio}}]);return m}(),A=function(){function m(){}m.simplify=function(d,a,b){if(b){var e=-a,f=d+a,c=-a,g=d+a;d=[];a=[];var h=b.length;for(let l=0;l<h;++l){const k=b[l];if(!k||2>k.length)continue;let p=k[0],r;const t=k.length;for(let n=1;n<t;++n)r=k[n],p.x===r.x&&(p.x<=e&&(p.y>r.y?(d.push(l),d.push(n),d.push(0),
d.push(-1)):(a.push(l),a.push(n),a.push(0),a.push(-1))),p.x>=f&&(p.y<r.y?(d.push(l),d.push(n),d.push(1),d.push(-1)):(a.push(l),a.push(n),a.push(1),a.push(-1)))),p.y===r.y&&(p.y<=c&&(p.x<r.x?(d.push(l),d.push(n),d.push(2),d.push(-1)):(a.push(l),a.push(n),a.push(2),a.push(-1))),p.y>=g&&(p.x>r.x?(d.push(l),d.push(n),d.push(3),d.push(-1)):(a.push(l),a.push(n),a.push(3),a.push(-1)))),p=r}0!==d.length&&0!==a.length&&(m.fillParent(b,a,d),m.fillParent(b,d,a),e=[],m.calcDeltas(e,a,d),m.calcDeltas(e,d,a),m.addDeltas(e,
b))}};m.fillParent=function(d,a,b){const e=b.length,f=a.length;for(let k=0;k<f;k+=4){var c=a[k],g=a[k+1];const p=a[k+2],r=d[c][g-1];c=d[c][g];g=8092;let t=-1;for(let n=0;n<e;n+=4){if(b[n+2]!==p)continue;var h=b[n];const x=b[n+1];var l=d[h][x-1];h=d[h][x];switch(p){case 0:case 1:u.between(r.y,l.y,h.y)&&u.between(c.y,l.y,h.y)&&(l=Math.abs(h.y-l.y),l<g&&(g=l,t=n));break;case 2:case 3:u.between(r.x,l.x,h.x)&&u.between(c.x,l.x,h.x)&&(l=Math.abs(h.x-l.x),l<g&&(g=l,t=n))}}a[k+3]=t}};m.calcDeltas=function(d,
a,b){const e=a.length;for(let f=0;f<e;f+=4){const c=m.calcDelta(f,a,b,[]);d.push(a[f]);d.push(a[f+1]);d.push(a[f+2]);d.push(c)}};m.calcDelta=function(d,a,b,e){d=a[d+3];if(-1===d)return 0;const f=e.length;if(1<f&&e[f-2]===d)return 0;e.push(d);return m.calcDelta(d,b,a,e)+1};m.addDeltas=function(d,a){const b=d.length;let e=0;for(var f=0;f<b;f+=4){var c=d[f+3];c>e&&(e=c)}for(f=0;f<b;f+=4){c=a[d[f]];const g=d[f+1],h=e-d[f+3];switch(d[f+2]){case 0:c[g-1].x-=h;c[g].x-=h;1===g&&(c[c.length-1].x-=h);g===c.length-
1&&(c[0].x-=h);break;case 1:c[g-1].x+=h;c[g].x+=h;1===g&&(c[c.length-1].x+=h);g===c.length-1&&(c[0].x+=h);break;case 2:c[g-1].y-=h;c[g].y-=h;1===g&&(c[c.length-1].y-=h);g===c.length-1&&(c[0].y-=h);break;case 3:c[g-1].y+=h,c[g].y+=h,1===g&&(c[c.length-1].y+=h),g===c.length-1&&(c[0].y+=h)}}};return m}();w.SimpleBuilder=C;w.TileClipper=B;Object.defineProperty(w,"__esModule",{value:!0})});