// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../renderers/support/lengthUtils ./definitions ./Utils ../../../webgl/capabilities".split(" "),function(q,t,u,k,m,v,w,x,n,y){function p(g,d){const a=d.length;if(g<d[0].value||1===a)return d[0].size;for(let b=1;b<a;b++)if(g<d[b].value)return d[b-1].size+(g-d[b-1].value)/(d[b].value-d[b-1].value)*(d[b].size-d[b-1].size);return d[a-1].size}
function r(g,d,a=0){if(k.isNone(d))g[a+0]=0,g[a+1]=0,g[a+2]=0,g[a+3]=0;else{var {r:b,g:c,b:e,a:f}=d;g[a+0]=b*f/255;g[a+1]=c*f/255;g[a+2]=e*f/255;g[a+3]=f}}let z=function(){function g(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);
this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}var d=g.prototype;d.getSizeVVFieldStops=function(a){const b=this._vvSizeFieldStops;switch(b.type){case "static":return b;case "level-dependent":return k.unwrapOr(b.levels[a],()=>{var c=Infinity,e=0;for(var f in b.levels){const h=parseFloat(f),l=Math.abs(a-h);l<c&&(c=l,e=h)}if(Infinity===c)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,
0,0])};c=2**((a-e)/2);e=k.unwrap(b.levels[e]);f=new Float32Array(e.values);f[2]*=c;f[3]*=c;return{sizes:k.unwrap(e.sizes),values:f}})}};d.update=function(a){k.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,a)};d.setInfo=function(a,b,c){k.isSome(c)&&c.forEach(e=>this._updateEffects(e));this._vvInfo=b;switch(a.type){case "dot-density":this._updateDotDensityInfo(a)}};d.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,
oesTextureFloat:y().supportsTextureFloat}};d.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1};d._updateEffects=function(a){k.isSome(a)&&a.filter&&a.filter.enabled&&(this.outsideLabelsVisible=a.excludedLabelsVisible)};d._updateVisualVariables=function(a,b){const c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(a){var e=a.size;if(e){c.vvSizeEnabled=!0;if(e.minMaxValue){const h=e.minMaxValue;
let l;if(n.isDefined(h.minSize)&&n.isDefined(h.maxSize))if(n.isNumber(h.minSize)&&n.isNumber(h.maxSize)){l=m.pt2px(h.minSize);var f=m.pt2px(h.maxSize)}else f=b.scale,l=m.pt2px(p(f,h.minSize.stops)),f=m.pt2px(p(f,h.maxSize.stops));this.vvSizeMinMaxValue.set([h.minDataValue,h.maxDataValue,l,f])}e.scaleStops&&(this.vvSizeScaleStopsValue=m.pt2px(p(b.scale,e.scaleStops.stops)));e.unitValue&&(this.vvSizeUnitValueToPixelsRatio=v.getMetersPerUnitForSR(b.spatialReference)/w.meterIn[e.unitValue.unit]/b.resolution);
e.fieldStops&&(this._vvSizeFieldStops=e.fieldStops)}if(b=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)c.vvRotationEnabled=!0,c.vvRotationType=a.type}};d._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=
a.seed;for(let c=0;c<x.DOT_DENSITY_MAX_FIELDS;c++){const e=c>=b.length?new u([0,0,0,0]):b[c].color;r(this.ddColors,e,4*c)}for(b=0;8>b;b++)this.ddActiveDots[b]=b<a.attributes.length?1:0;r(this.ddBackgroundColor,a.backgroundColor)};t._createClass(g,[{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}}]);return g}();q.WGLRendererInfo=z;Object.defineProperty(q,"__esModule",{value:!0})});