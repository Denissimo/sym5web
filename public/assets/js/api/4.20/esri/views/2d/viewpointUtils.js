// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/Ellipsoid ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils".split(" "),function(k,S,H,fa,z,T,v,t,D,g,n,U,ha,I,ia,
E,J,w){function V(a,b,c,d){return d&&c&&!d.equals(c)&&w.canProject(d,c)&&d.isWebMercator?(d.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(v.toRadian(c)),a=g.set(a,v.toRadian(b[0])*E.earth.radius,.5*E.earth.radius*Math.log((1+c)/(1-c)))):(c=v.toDegree(b[0]/E.earth.radius),a=g.set(a,c-360*Math.floor((c+180)/360),v.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/E.earth.radius))))),a):g.copy(a,b)}function F(a){return a.wkid?a:a.spatialReference||ia.WGS84}function A(a,
b){return b.type?g.set(a,b.x,b.y):g.copy(a,b)}function y(a,b){return Math.max(a.width/b[0],a.height/b[1])*W(a.spatialReference)}function B(a,b,c,d){return K.apply(this,arguments)}function K(){K=S._asyncToGenerator(function*(a,b,c,d){if(!a||Array.isArray(a)&&!a.length)return null;fa.isCollection(a)&&(a=a.toArray());if(Array.isArray(a)&&a.length&&"object"===typeof a[0]){var e=a.every(p=>"attributes"in p);var f=a.some(p=>!p.geometry),m=a;if(e&&f&&b&&b.allLayerViews){e=new Map;for(var q of a)a=q.layer,
f=e.get(a)||[],m=q.attributes[a.objectIdField],null!=m&&f.push(m),e.set(a,f);const p=[];e.forEach((r,X)=>{const Y=b.allLayerViews.find(C=>C.layer.id===X.id);if("queryFeatures"in Y){const C=X.createQuery();C.objectIds=r;C.returnGeometry=!0;p.push(Y.queryFeatures(C))}});q=yield Promise.all(p);a=[];for(var h of q)if(h&&h.features&&h.features.length)for(var l of h.features)z.isSome(l.geometry)&&a.push(l.geometry);m=a}for(const p of m)d=yield B(p,b,c,d);return d}if(Array.isArray(a)&&2===a.length&&"number"===
typeof a[0]&&"number"===typeof a[1])e=new I(a);else if(a instanceof ha)e=a;else if("geometry"in a)if(a.geometry)e=a.geometry;else if(a.layer){const p=a.layer;h=b.allLayerViews.find(r=>r.layer.id===p.id);"queryFeatures"in h&&(l=p.createQuery(),l.objectIds=[a.attributes[p.objectIdField]],l.returnGeometry=!0,h=yield h.queryFeatures(l),e=z.get(h,"features",0,"geometry"))}if(z.isNone(e))return null;h="point"===e.type?new U({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference}):e.extent;
if(!h)return null;l=w.canProject(h,c);if(!h.spatialReference.equals(c)&&l)h=w.project(h,c);else if(!l)return null;return d=d?d.union(h):h.clone()});return K.apply(this,arguments)}function ja(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&a.every(c=>"layer"in c)){let c=b=0;for(const d of a)(a=
d.layer)&&a.minScale&&a.maxScale&&(b=a.minScale<b?a.minScale:b,c=a.maxScale>c?a.maxScale:c);return b&&c?{min:b,max:c}:null}}}function Z(a,b){return L.apply(this,arguments)}function L(){L=S._asyncToGenerator(function*(a,b){if(!a||!b)return new H({targetGeometry:new I,scale:0,rotation:0});let c=b.spatialReference;const {constraints:d,padding:e,viewpoint:f,size:m}=b,q=[e?m[0]-e.left-e.right:m[0],e?m[1]-e.top-e.bottom:m[1]];let h=null;a instanceof H?h=a:a.viewpoint?h=a.viewpoint:a.target&&"esri.Viewpoint"===
a.target.declaredClass&&(h=a.target);let l=null;if(h&&h.targetGeometry)l=h.targetGeometry;else if(a instanceof U)l=a;else if(a||a&&("center"in a||"extent"in a||"target"in a))l=(yield B(a.center,b,c))||(yield B(a.extent,b,c))||(yield B(a.target,b,c))||(yield B(a,b,c));!l&&f&&f.targetGeometry?l=f.targetGeometry:!l&&b.extent&&(l=b.extent);var p=F(l);c||(c=F(b.spatialReference||b.extent||l));if(!w.canProject(l,c)&&p&&!p.equals(c))return null;var r=A(n.create(),l.center?l.center:l);p=new I(V(r,r,p,c),
c);r=null;r=h&&z.isSome(h.targetGeometry)&&"point"===h.targetGeometry.type?h.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&d&&d.effectiveLODs?d.zoomToScale(a.zoom):Array.isArray(l)||"point"===l.type||"extent"===l.type&&0===l.width&&0===l.height?b.extent&&w.canProject(b.extent,c)?y(w.project(b.extent,c),q):b.extent?y(b.extent,q):f.scale:w.canProject(l.extent,c)?y(w.project(l.extent,c),q):y(l.extent,q);if(b=ja(a))b.min&&b.min>r?r=b.min:b.max&&b.max<r&&(r=b.max);
b=0;h?b=h.rotation:a.hasOwnProperty("rotation")?b=a.rotation:f&&(b=f.rotation);a=new H({targetGeometry:p,scale:r,rotation:b});d&&(a=d.fit(a),d.constrainByGeometry(a),d.rotationEnabled||(a.rotation=b));return a});return L.apply(this,arguments)}function u(a,b){const c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function aa(a,b,c){return c?g.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):g.scale(a,
b,.5)}function ka(a,b,c,d){M(a,b,c,d);return t.invert(a,a)}function x(a){var b=a.scale;a=a.targetGeometry;a=z.isSome(a)&&J.isValid(a.spatialReference)?1/(39.37*T.getMetersPerUnitForSR(a.spatialReference)*96):1;return b*a}function W(a){return J.isValid(a)?39.37*T.getMetersPerUnitForSR(a)*96:1}function ba(a){return a.isWrappable?(a=J.getInfo(a),a.valid[1]-a.valid[0]):0}const la=180/Math.PI,ma=function(){const a=n.create();return function(b,c,d){const e=c.targetGeometry;A(a,e);c=.5*x(c);b.xmin=a[0]-
c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}(),N=function(){const a=n.create();return function(b,c,d){return g.sub(b,g.scale(b,c,.5),aa(a,c,d))}}(),O=function(){const a=D.create(),b=n.create();return function(c,d,e,f){const m=x(d);d=v.toRadian(d.rotation)||0;g.set(b,m,m);t.fromScaling(a,b);t.rotate(a,a,d);t.translate(a,a,N(b,e,f));t.translate(a,a,[0,f.top-f.bottom]);return g.set(c,a[4],a[5])}}(),P=function(){const a=n.create(),b=
n.create(),c=n.create();return function(d,e,f,m,q,h){g.negate(a,e);g.scale(b,f,.5*h);g.set(c,1/m*h,-1/m*h);t.identity(d);t.translate(d,d,b);q&&t.rotate(d,d,q);t.scale(d,d,c);t.translate(d,d,a);return d}}(),M=function(){const a=n.create();return function(b,c,d,e){const f=x(c),m=v.toRadian(c.rotation)||0;A(a,c.targetGeometry);return P(b,a,d,f,m,e)}}(),na=function(){const a=n.create();return function(b,c,d,e){const f=x(c);A(a,c.targetGeometry);return P(b,a,d,f,0,e)}}(),oa=function(){const a=n.create(),
b=n.create(),c=[0,0,0];return function(d,e,f){g.subtract(a,d,e);g.normalize(a,a);g.subtract(b,d,f);g.normalize(b,b);g.cross(c,a,b);d=Math.acos(g.dot(a,b)/(g.length(a)*g.length(b)))*la;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}(),pa=function(){const a=n.create();return function(b,c,d,e){const f=b.targetGeometry;u(b,c);O(a,c,d,e);f.x+=a[0];f.y+=a[1];return b}}(),qa=function(){const a=n.create();return function(b,c,d,e){const f=b.targetGeometry;u(b,c);O(a,c,d,e);f.x-=a[0];f.y-=a[1];return b}}(),ca=function(){const a=
n.create();return function(b,c,d){u(b,c);c=b.targetGeometry;const e=F(d),f=F(c);A(a,d);V(a,a,e,f);c.x=a[0];c.y=a[1];return b}}(),ra=function(){const a=n.create();return function(b,c,d,e,f){f||(f="center");g.sub(a,d,e);g.scale(a,a,.5);d=a[0];e=a[1];switch(f){case "center":g.set(a,0,0);break;case "left":g.set(a,-d,0);break;case "top":g.set(a,0,e);break;case "right":g.set(a,d,0);break;case "bottom":g.set(a,0,-e);break;case "top-left":g.set(a,-d,e);break;case "bottom-left":g.set(a,-d,-e);break;case "top-right":g.set(a,
d,e);break;case "bottom-right":g.set(a,d,-e)}G(b,c,a);return b}}(),da=function(){const a=n.create();return function(b,c,d,e,f){u(b,c);isNaN(d)||0===d||(Q(a,e,c,f),b.scale=c.scale*d,R(a,a,b,f),G(b,b,g.set(a,a[0]-e[0],e[1]-a[1])));return b}}(),ea=function(){const a=n.create();return function(b,c,d,e,f,m){u(b,c);isNaN(d)||0===d||(Q(a,f,c,m),b.scale=c.scale*d,b.rotation+=e,R(a,a,b,m),G(b,b,g.set(a,a[0]-f[0],f[1]-a[1])));return b}}(),sa=function(){const a=n.create(),b=n.create();return function(c,d,e,
f,m,q,h){N(b,q,h);g.add(a,m,b);return f?ea(c,d,e,f,a,q):da(c,d,e,a,q)}}(),Q=function(){const a=D.create();return function(b,c,d,e){return g.transformMat2d(b,c,ka(a,d,e,1))}}(),R=function(){const a=D.create();return function(b,c,d,e){return g.transformMat2d(b,c,M(a,d,e,1))}}(),G=function(){const a=n.create(),b=D.create();return function(c,d,e){u(c,d);const f=x(d),m=c.targetGeometry;t.fromRotation(b,v.toRadian(d.rotation)||0);t.scale(b,b,n.fromValues(f,f));g.transformMat2d(a,e,b);m.x+=a[0];m.y+=a[1];
return c}}();k.addPadding=pa;k.angleBetween=oa;k.centerAt=ca;k.copy=u;k.create=Z;k.createAsync=function(a,b){return Z(a,b)};k.extentToScale=y;k.getAnchor=aa;k.getExtent=ma;k.getMatrix=P;k.getOuterSize=function(a,b,c){var d=v.toRadian(b.rotation)||0;b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return g.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))};k.getPaddingMapTranslation=O;k.getPaddingScreenTranslation=N;k.getResolution=x;k.getResolutionToScaleFactor=W;k.getTransform=M;k.getTransformNoRotation=
na;k.getWorldScreenWidth=function(a,b){return Math.round(ba(a)/b)};k.getWorldWidth=ba;k.padAndScaleAndRotateBy=sa;k.pixelSize=function(a){return x(a)};k.removePadding=qa;k.resize=ra;k.rotateBy=function(a,b,c){u(a,b);a.rotation+=c;return a};k.rotateTo=function(a,b,c){u(a,b);a.rotation=c;return a};k.scaleAndRotateBy=ea;k.scaleBy=da;k.scaleTo=function(a,b,c){u(a,b);a.scale=c;return a};k.setExtent=function(a,b,c,d,e){ca(a,b,c.center);a.scale=y(c,d);e&&e.constraints&&e.constraints.constrain(a);return a};
k.toMap=Q;k.toScreen=R;k.translateBy=G;Object.defineProperty(k,"__esModule",{value:!0})});