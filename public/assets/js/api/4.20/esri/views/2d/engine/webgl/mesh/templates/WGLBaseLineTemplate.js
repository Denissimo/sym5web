// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../definitions ../../enums ../../number ../../TurboLine ../../materialKey/MaterialKey ./templateUtils".split(" "),function(r,n,t,u,m,v,w,x){const A=(d,l,k)=>(g,a,b,e,f,c,h,p,q,y,z)=>{b=m.i1616to32(z,Math.ceil(1024*d._halfWidth));h=m.i8888to32(Math.round(31*h),Math.round(31*p),Math.round(31*q),Math.round(31*y));f=m.i8888to32(31*f,31*c,0,d._bitset);c=d.out;c.vertexBounds(g,a,l,k);c.vertexWrite(m.i1616to32(8*g,
8*a));c.vertexWrite(d.id);c.vertexWrite(d._fillColor);c.vertexWrite(h);c.vertexWrite(b);c.vertexWrite(d._tl);c.vertexWrite(d._br);c.vertexWrite(f);c.vertexWrite(m.i1616to32(Math.ceil(1024*d._halfReferenceWidth),0));c.vertexWrite(d.minMaxZoom);c.vertexEnd();return d.offset+d.vertexCount++},B=d=>(l,k,g)=>{const a=d.out;a.indexWrite(l);a.indexWrite(k);a.indexWrite(g);d.indexCount+=3};return d=>function(l){function k(...a){a=l.call(this,...a)||this;a.tessellationProperties={};a._tessellationOptions={halfWidth:0,
pixelCoordRatio:1,offset:0};a.geometryType=u.WGLGeometryType.LINE;return a}r._inheritsLoose(k,l);var g=k.prototype;g._initializeTessellator=function(a){var b=w.LineMaterialKey.load(this._materialKey),e=this._tessellationOptions;b=b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue;const f=this.tessellationProperties._halfWidth<t.THIN_LINE_HALF_WIDTH_THRESHOLD;this.tessellationProperties.minMaxZoom=this._minMaxZoom;a=f&&!a&&!b;e.wrapDistance=65535;e.textured=this._isDashed||
this._hasPattern;e.offset=this.tessellationProperties.offset;e.halfWidth=this.tessellationProperties._halfWidth;e=a?0:1;this._lineTessellator=new v.LineTessellation(A(this.tessellationProperties,e,e),B(this.tessellationProperties),a)};g._write=function(a,b,e){const f="esriGeometryPoint"===b.geometryType;a.recordStart(b.getDisplayId(),this._materialKey,this.geometryType,!1,f);this._writeGeometry(a,b,e,f);a.recordEnd()};g._writeGeometry=function(a,b,e,f){e=null!=e?e:b.readLegacyGeometry();f=this._getLines(e,
f);n.isNone(f)||this._writeVertices(a,b,f)};g._getLines=function(a,b){if(n.isNone(a))return null;a=a.paths||a.rings;return n.isNone(a)?null:x.clipLinesMarshall(a,b?256:16)};g._writeVertices=function(a,b,e){b=b.getDisplayId();const f=a.vertexCount(),c=this.tessellationProperties,h=this._tessellationOptions;c.out=a;c.id=b;c.indexCount=0;c.vertexCount=0;c.offset=f;h.capType=this._capType;h.joinType=this._joinType;for(const {line:p,start:q}of e)h.initialDistance=q%65535,this._lineTessellator.tessellate(p,
h)};return k}(d)});