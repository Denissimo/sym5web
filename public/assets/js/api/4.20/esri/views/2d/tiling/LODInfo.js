// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(r,t){function q(h,e,a){h[0]=e;h[1]=a;return h}const g=new t("0/0/0/0");return function(){function h(a,b,c,d,f,k,l,m,n,p,u,v){this.level=a;this.resolution=b;this.scale=c;this.origin=d;this.first=f;this.last=k;this.size=l;this.norm=m;this.worldStart=n;this.worldEnd=p;this.worldSize=u;this.wrap=v}h.create=function(a,b,c){var d=r.getInfo(a.spatialReference);const f=[a.origin.x,a.origin.y],k=[a.size[0]*b.resolution,a.size[1]*
b.resolution],l=[-Infinity,-Infinity],m=[Infinity,Infinity],n=[Infinity,Infinity];c&&(q(l,Math.max(0,Math.floor((c.xmin-f[0])/k[0])),Math.max(0,Math.floor((f[1]-c.ymax)/k[1]))),q(m,Math.max(0,Math.floor((c.xmax-f[0])/k[0])),Math.max(0,Math.floor((f[1]-c.ymin)/k[1]))),q(n,m[0]-l[0]+1,m[1]-l[1]+1));let p;a.isWrappable?(a=[Math.ceil(Math.round((d.valid[1]-d.valid[0])/b.resolution)/a.size[0]),n[1]],d=[Math.floor((d.origin[0]-f[0])/k[0]),l[1]],c=[a[0]+d[0]-1,m[1]],p=!0):(d=l,c=m,a=n,p=!1);return new h(b.level,
b.resolution,b.scale,f,l,m,n,k,d,c,a,p)};var e=h.prototype;e.normalizeCol=function(a){if(!this.wrap)return a;const b=this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b};e.denormalizeCol=function(a,b){return this.wrap?this.worldSize[0]*b+a:a};e.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):0};e.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]};e.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+this.size[0]-1};
e.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]};e.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]};e.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]};e.getYForRow=function(a){return this.origin[1]-a*this.norm[1]};e.getTileBounds=function(a,b,c=!1){g.set(b);var d=c?g.col:this.denormalizeCol(g.col,g.world),f=g.row;b=this.getXForColumn(d);c=this.getYForRow(f+1);d=this.getXForColumn(d+1);f=this.getYForRow(f);a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a};e.getTileCoords=
function(a,b,c=!1){g.set(b);b=c?g.col:this.denormalizeCol(g.col,g.world);Array.isArray(a)?q(a,this.getXForColumn(b),this.getYForRow(g.row)):(a.x=this.getXForColumn(b),a.y=this.getYForRow(g.row));return a};return h}()});