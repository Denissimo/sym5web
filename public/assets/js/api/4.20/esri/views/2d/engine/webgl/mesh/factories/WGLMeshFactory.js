// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/promiseUtils ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore ../../../../layers/features/support/AttributeStore".split(" "),function(u,q,v,n,w,x,y,p,z){v=function(){function r(c,a,b){this._geometryType=c;this._idField=a;this._templateStore=b}var m=r.prototype;m.update=function(c,a){n.isSome(c.mesh.labels)&&(this._labelTemplates=
this._createLabelTemplates(c.mesh.labels,a))};m._createLabelTemplates=function(c,a){const b=new Map;if("simple"===c.type){for(var e of c.classes)c=x.fromLabelClass(e,a),b.set(e.index,c);return b}for(const g in c.classes){e=c.classes[g];for(const d of e)e=x.fromLabelClass(d,a),b.set(d.index,e)}return b};m.analyze=function(){var c=q._asyncToGenerator(function*(a,b,e,g,d,f){if(!w.isAborted(f)){var l;"dictionary"===b.type&&(l=yield b.analyze(this._idField,a.copy(),g,d,f));for(var h=0;a.next();){var k=
void 0;k=l?l[h++]:n.isSome(e)&&z.isAggregateId(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?e.match(this._idField,a,this._geometryType,g,d):b.match(this._idField,a,this._geometryType,g,d);a.setGroupId(k);if(p.isDynamicId(k)){k=this._templateStore.getDynamicTemplateGroup(k);for(const t of k)t&&t.analyze&&t.analyze(this._templateStore,a,g,d)}}return this._templateStore.finalize(f)}});return function(a,b,e,g,d,f){return c.apply(this,arguments)}}();m.analyzeGraphics=function(){var c=q._asyncToGenerator(function*(a,
b,e,g,d){if(!w.isAborted(d)){a=a.getCursor();for(b&&(yield b.analyze(this._idField,a.copy(),e,g,d));a.next();){let f=a.getGroupId();if(null==f||-1===f)f=b.match(this._idField,a,a.geometryType,e,g),a.setGroupId(f);if(p.isDynamicId(f)){const l=this._templateStore.getDynamicTemplateGroup(f);for(const h of l)h&&h.analyze&&h.analyze(this._templateStore,a,e,g)}a.setGroupId(f)}return this._templateStore.finalize(d)}});return function(a,b,e,g,d){return c.apply(this,arguments)}}();m.writeGraphic=function(c,
a,b){const e=a.getGroupId(),g=a.getDisplayId(),d=this._templateStore.getTemplateGroup(e);c.featureStart(a.insertAfter);if(null!=g){if(p.isDynamicId(e))for(const f of d)f.bindFeature(a,null,null);if(d){for(const f of d)f&&f.write(c,a,b);c.featureEnd()}}};m.writeCursor=function(c,a,b,e,g,d){const f=a.getGroupId(),l=a.getDisplayId(),h=this._templateStore.getTemplateGroup(f);a.getObjectId();if(null!=l&&h){if(p.isDynamicId(f))for(const k of h)k.bindFeature(a,b,e);for(const k of h)k.write(c,a,g);n.isSome(d)&&
c.hasRecords&&(b=d&&this._findLabelRef(h),this._writeLabels(c,a,d,b,g))}};m._findLabelRef=function(c){for(const a of c)if(a instanceof y)return a;return null};m._writeLabels=function(c,a,b,e,g){for(const d of b)if(n.isSome(d)&&d){const {glyphs:f,rtl:l,index:h}=d;b=this._labelTemplates.get(h);b.setZoomLevel(g);b.bindReferenceTemplate(e);b.bindTextInfo(f,l);b.write(c,a,null)}};q._createClass(r,[{key:"templates",get:function(){return this._templateStore}}]);return r}();u.WGLMeshFactory=v;Object.defineProperty(u,
"__esModule",{value:!0})});