// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../symbols ../../../core/Evented ../../../core/Handles ../../../core/lang ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../layers/GraphicsLayer ./drawUtils ./layerUtils ./input/GraphicMoverEvents ../../input/InputManager ../../interactive/GraphicManipulator ../../support/screenUtils ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol".split(" "),
function(z,h,g,E,A,F,r,B,l,N,O,P,Q,G,H,C,I,k,n,J,t,u,K,L){g=function(D){function v(a){a=D.call(this,a)||this;a._activeGraphic=null;a._indicators=[];a._dragEvent=null;a._handles=new A;a._hoverGraphic=null;a._initialDragGeometry=null;a._viewHandles=new A;a._manipulators=[];a.type="graphic-mover";a.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}};
a.enableMoveAllGraphics=!1;a.graphics=[];a.indicatorsEnabled=!0;a.layer=new H({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"});a.view=null;return a}z._inheritsLoose(v,D);var f=v.prototype;f.initialize=function(){I.addUniqueLayer(this.view,this.layer);this.refresh();this._handles.add([B.watch(this,["graphics","graphics.length"],()=>this.refresh()),B.whenOnce(this,"view.ready",()=>{this._viewHandles.add([this.view.on("immediate-click",a=>this._clickHandler(a),n.ViewEventPriorities.TOOL),
this.view.on("double-click",a=>this._doubleClickHandler(a),n.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>this._pointerDownHandler(a),n.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>this._pointerMoveHandler(a),n.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>this._pointerUpHandler(a),n.ViewEventPriorities.TOOL),this.view.on("drag",a=>this._dragHandler(a),n.ViewEventPriorities.TOOL),this.view.on("key-down",a=>this._keyDownHandler(a),n.ViewEventPriorities.TOOL)])})])};
f.destroy=function(){var a;this._removeIndicators();null==(a=this.view.map)?void 0:a.remove(this.layer);this.layer.destroy();this.reset();this._manipulators.forEach(b=>b.destroy());this._manipulators=null;this._handles=r.destroyMaybe(this._handles);this._viewHandles=r.destroyMaybe(this._viewHandles)};f.refresh=function(){this._setUpIndicators();this._setUpManipulators()};f.reset=function(){this._dragEvent=this._hoverGraphic=this._activeGraphic=null};f.updateGeometry=function(a,b){if(a=this.graphics[a])a.set("geometry",
b),this._setUpIndicators()};f._clickHandler=function(a){const b=this._findTargetGraphic(t.createScreenPointFromEvent(a));b&&(a=new k.GraphicClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-click",a),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(a))};f._doubleClickHandler=function(a){const b=this._findTargetGraphic(t.createScreenPointFromEvent(a));b&&(a=new k.GraphicDoubleClickEvent(b,this.graphics.indexOf(b),a.x,a.y,a),this.emit("graphic-double-click",a),this.callbacks.onGraphicDoubleClick&&
this.callbacks.onGraphicDoubleClick(a))};f._pointerDownHandler=function(a){const b=this._findTargetGraphic(t.createScreenPointFromEvent(a));if(b){this._activeGraphic=b;const {x:c,y:e}=a;a=new k.GraphicPointerDownEvent(b,this.graphics.indexOf(b),c,e,a);this.emit("graphic-pointer-down",a);this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(a)}else this._activeGraphic=null};f._pointerUpHandler=function(a){if(this._activeGraphic){const {x:b,y:c}=a,e=this.graphics.indexOf(this._activeGraphic);
a=new k.GraphicPointerUpEvent(this._activeGraphic,e,b,c,a);this.emit("graphic-pointer-up",a);this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(a)}};f._pointerMoveHandler=function(a){if(!this._dragEvent){var b=this._findTargetGraphic(t.createScreenPointFromEvent(a));if(b){const {x:e,y:d}=a;if(this._hoverGraphic){if(this._hoverGraphic===b)return;var c=this.graphics.indexOf(this._hoverGraphic);c=new k.GraphicPointerOutEvent(this.graphics[c],c,e,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",
c);this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(c)}c=this.graphics.indexOf(b);a=new k.GraphicPointerOverEvent(b,c,e,d,a);this._hoverGraphic=b;this.emit("graphic-pointer-over",a);this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(a)}else if(this._hoverGraphic){const {x:e,y:d}=a;b=this.graphics.indexOf(this._hoverGraphic);a=new k.GraphicPointerOutEvent(this.graphics[b],b,e,d,a);this._hoverGraphic=null;this.emit("graphic-pointer-out",a);this.callbacks.onGraphicPointerOut&&
this.callbacks.onGraphicPointerOut(a)}}};f._dragHandler=function(a){if(("start"===a.action||this._dragEvent)&&this._activeGraphic&&this._activeGraphic.geometry){"start"===a.action&&this._removeIndicators();a.stopPropagation();var {action:b,x:c,y:e}=a,d=this.graphics.indexOf(this._activeGraphic),m=this._activeGraphic.geometry,p=this._dragEvent?c-this._dragEvent.x:0,q=this._dragEvent?e-this._dragEvent.y:0,w=c-a.origin.x,x=e-a.origin.y,M=C.cloneMove(m,p,q,this.view);this._activeGraphic.geometry=M;this.enableMoveAllGraphics&&
this.graphics.forEach(y=>{y!==this._activeGraphic&&(y.geometry=C.cloneMove(y.geometry,p,q,this.view))});this._dragEvent=a;"start"===b?(this._initialDragGeometry=F.clone(m),d=new k.GraphicMoveStartEvent(this._activeGraphic,this.graphics,d,c,e,p,q,w,x,a),this.emit("graphic-move-start",d),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(d),d.defaultPrevented&&this._activeGraphic.set("geometry",m)):"update"===b?(d=new k.GraphicMoveEvent(this._activeGraphic,this.graphics,d,c,e,p,q,
w,x,a),this.emit("graphic-move",d),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(d),d.defaultPrevented&&(this._activeGraphic.geometry=m)):(m=new k.GraphicMoveStopEvent(this._activeGraphic,this.graphics,d,c,e,p,q,w,x,a),this._activeGraphic=this._dragEvent=null,this._setUpIndicators(),this.emit("graphic-move-stop",m),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(m),m.defaultPrevented&&(this.graphics[d].set("geometry",this._initialDragGeometry),this._setUpIndicators()),
this._initialDragGeometry=null)}};f._keyDownHandler=function(a){"a"!==a.key&&"d"!==a.key&&"n"!==a.key||"moving"!==this.state||a.stopPropagation()};f._findTargetGraphic=function(a){let b=null,c=Number.MAX_VALUE;this._manipulators.forEach(e=>{const d=e.intersectionDistance(a);r.isSome(d)&&d<c&&(c=d,b=e.graphic)});return b};f._setUpManipulators=function(){const {graphics:a,view:b}=this;this._manipulators.forEach(c=>c.destroy());this._manipulators=null!=a&&a.length?a.map(c=>new J.GraphicManipulator({graphic:c,
view:b})):[]};f._setUpIndicators=function(){var a;this._removeIndicators();this.indicatorsEnabled&&(this._indicators=(null==(a=this.graphics)?void 0:a.map(b=>{const c=b.clone();c.symbol=this._getSymbolForIndicator(b);return c}))||[],this.layer.addMany(this._indicators))};f._removeIndicators=function(){this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach(a=>a.destroy()),this._indicators=[])};f._getSymbolForIndicator=function(a){if(r.isNone(a.symbol))return null;
switch(a.symbol.type){case "cim":return new u({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case "picture-marker":{const {xoffset:b,yoffset:c,height:e,width:d}=a.symbol;return new u({xoffset:b,yoffset:c,size:e===d?d:Math.max(e,d),style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case "simple-marker":{const {xoffset:b,yoffset:c,size:e,style:d}=a.symbol;return new u({xoffset:b,yoffset:c,style:"circle"===d?"circle":"square",size:e+2,color:[0,0,0,
0],outline:{color:[255,127,0,1],width:1}})}case "simple-fill":return new L({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case "simple-line":return new K({color:[255,127,0,1],style:"dash",width:1});case "text":{const {xoffset:b,yoffset:c}=a.symbol;return new u({xoffset:b,yoffset:c,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}};z._createClass(v,[{key:"state",get:function(){const a=!!this.get("view.ready"),b=!!this.get("graphics.length"),
c=this._activeGraphic;return a&&b?c?"moving":"active":a?"ready":"disabled"}}]);return v}(E.EventedAccessor);h.__decorate([l.property()],g.prototype,"_activeGraphic",void 0);h.__decorate([l.property({readOnly:!0})],g.prototype,"type",void 0);h.__decorate([l.property()],g.prototype,"callbacks",void 0);h.__decorate([l.property()],g.prototype,"enableMoveAllGraphics",void 0);h.__decorate([l.property()],g.prototype,"graphics",void 0);h.__decorate([l.property()],g.prototype,"indicatorsEnabled",void 0);h.__decorate([l.property()],
g.prototype,"layer",void 0);h.__decorate([l.property({readOnly:!0})],g.prototype,"state",null);h.__decorate([l.property()],g.prototype,"view",void 0);return g=h.__decorate([G.subclass("esri.views.draw.support.GraphicMover")],g)});