// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../portal/schemas/webScene ./utils".split(" "),function(J,r,h,E,n,p){function K(a,b){if(b.properties){if("layerType"in b.properties)return b.properties.layerType.enum[0];if("type"in b.properties)return b.properties.type.enum[0]}switch(a){case "multipoint_geometry_schema.json":return"multipoint";case "point_geometry_schema.json":return"point";case "polyline_geometry_schema.json":return"polyline";case "polygon_geometry_schema.json":return"polygon";
case "extent_schema.json":return"extent"}}function F(a){return"array"===a.type?`${F(a.items)}[]`:a.type}function L(a){const b={count:a.length,refsCount:0,typesCount:0,distinctTypes:[],type:null},e=new Set;for(const c in a){const d=a[c];d.$ref?b.refsCount++:d.type&&(b.typesCount++,e.add(F(d)))}e.forEach(c=>b.distinctTypes.push(c));b.distinctTypes.sort();b.refsCount===b.count?b.type="refs":2===b.count&&0<b.refsCount&&1===b.distinctTypes.length&&"null"===b.distinctTypes[0]?b.type="refsAndNull":b.typesCount===
b.count?(b.type="types",b.distinctTypes=b.distinctTypes):b.type="mix";return b}function t(a,b,e,c,d){return u.apply(this,arguments)}function u(){u=h._asyncToGenerator(function*(a,b,e,c,d){d.schemaStack.push(a);var f=K(a,e);c=c?c.replace("\x3c?TYPE?\x3e",f?`<${f}>`:""):null;if("array"===e.type||!("properties"in e))return(a=d.currentClass?null:{type:a,name:a,id:`${a}--${b}`,typeValue:b,properties:[]})&&d.push(null,a),yield m(e,c,d),d.schemaStack.pop(),a;d.hasFilteredProperties?(f=d.filteredPropertiesArray.join("/"),
f=`${a}--${b}--${f}`):f=`${a}--${b}`;const g="drawingInfo_schema.json"!==a&&"layer_schema.json"!==a&&d.seen.get(f);if(g&&c)return d.addProperty({name:c,type:g}),d.schemaStack.pop(),g;a={type:a,name:a,id:f,typeValue:b,properties:[]};c&&d.addProperty({name:c,type:a});d.push(c,a);yield m(e,"",d);d.schemaStack.pop();return d.pop()});return u.apply(this,arguments)}function G(a,b,e){return v.apply(this,arguments)}function v(){v=h._asyncToGenerator(function*(a,b,e){a=yield e.requestSchema(a.$ref);var c=
a.schema;c="layerDefinition"===c.title?null:(c=c.properties&&c.properties.type)&&c.enum?c.enum:null;if(c)for(var d of c){c={...a.schema};c.properties={...c.properties,type:{type:"string",enum:[d]}};const f=-1===b.indexOf("\x3c?TYPE?\x3e")?`${b}<?TYPE?>`:b;yield t(a.schemaId,d,c,f,e)}else d="layer_schema.json"===a.schemaId&&e.schemaStack.length?e.schemaStack[e.schemaStack.length-1].replace(/_schema\.json/,""):null,yield t(a.schemaId,d,a.schema,b,e)});return v.apply(this,arguments)}function M(a,b){if(!q(a))return!1;
a=a.stack.map(e=>e.klass.type).join("/");return/.*pointCloudLayer_schema\.json\/layerDefinition_schema\.json\/drawingInfo_schema\.json$/.test(a)&&"renderer"===b}function N(a,b){if(!q(a))return!1;a=a.stack.map(e=>e.klass.type).join("/");return/.*(imageServiceLayer|tiledImageServiceLayer)_schema\.json\/layerDefinition_schema\.json\/drawingInfo_schema\.json$/.test(a)&&"renderer"===b}function q(a){return a.currentClass&&"drawingInfo_schema.json"===a.currentClass.name}function O(a,b,e){if(q(e)){const c=
M(e,b),d=N(e,b);return a.filter(f=>{if(/uniqueValueFromStyleRenderer_schema\.json$/.test(f.$ref))return!1;if(d)return P.test(f.$ref)&&!Q.test(f.$ref);if(R.test(f.$ref))return!1;f=/pointCloud.*Renderer/.test(f.$ref);return c===f})}a:{switch(e.schemaStack[e.schemaStack.length-1]){case "operationalLayers_schema.json":case "elevationLayers_schema.json":case "baseMapLayer_schema.json":b=!0;break a}b=!1}if(b){const c=["kmlLayer","rasterDataElevationLayer","rasterDataLayer"];return a.filter(d=>!c.some(f=>
d.$ref.replace(/.*\//,"")===`${f}_schema.json`))}return a}function S(a,b,e){return w.apply(this,arguments)}function w(){w=h._asyncToGenerator(function*(a,b,e){yield m(a.items,`${b}[]`,e)});return w.apply(this,arguments)}function T(a,b,e){return x.apply(this,arguments)}function x(){x=h._asyncToGenerator(function*(a,b,e){for(const c in a.properties)if("webscene_schema.json"!==e.currentClass.name||"tables"!==c&&"mapRangeInfo"!==c&&"widgets"!==c)if("baseMap_schema.json"!==e.currentClass.name||"elevationLayers"!==
c){if(q(e)){const d=e.stack.map(f=>f.klass.type).join("/");if(/imageServiceLayer|tiledImageServiceLayer/.test(d)&&"transparency"===c)continue}yield e.withFilter(c,h._asyncToGenerator(function*(){yield m(a.properties[c],b?`${b}.${c}`:c,e)}))}});return x.apply(this,arguments)}function H(a,b="",e=new Set){for(const c of a)if("properties"in c)for(const d in c.properties){a=c.properties[d];const f=b?`${b}.${d}`:d,g=Object.keys(a);if(0===g.length||1===g.length&&"$ref"===g[0])e.add(f);else if(1===g.length&&
"allOf"===g[0])e.add(f),H(a.allOf,f,e);else throw Error(`unexpected allOf filter construct: ${JSON.stringify(a)}`);}return e}function U(a,b,e){return y.apply(this,arguments)}function y(){y=h._asyncToGenerator(function*(a,b,e){let c=null;for(const d of a.allOf)if("$ref"in d){if(c)throw Error("Cannot process more than 1 ref in an allOf construct");c=d}else if(!("properties"in d))throw Error("allOf construct only allows simple top-level property filters");a=H(a.allOf);yield e.addFilter(a,()=>G(c,b,e))});
return y.apply(this,arguments)}function V(a,b,e){return z.apply(this,arguments)}function z(){z=h._asyncToGenerator(function*(a,b,e){const c=L(a.oneOf);if("refs"===c.type||"refsAndNull"===c.type){a=O(a.oneOf,b,e);for(const d of a)"null"!==d.type&&(yield m(d,`${b||""}`+(1!==a.length?"\x3c?TYPE?\x3e":""),e))}else if("types"===c.type)e.addProperty({name:b,type:p.sorted(c.distinctTypes).join("|")});else for(const d in a.oneOf)yield m(a.oneOf[d],`${b}${`.oneOf[${d}]`}`,e)});return z.apply(this,arguments)}
function W(a,b,e){return A.apply(this,arguments)}function A(){A=h._asyncToGenerator(function*(a,b,e){yield G(a,b,e)});return A.apply(this,arguments)}function X(a,b,e){return B.apply(this,arguments)}function B(){B=h._asyncToGenerator(function*(a,b,e){let c="unknown";a.type&&(c=Array.isArray(a.type)?p.sorted(a.type).join("|"):a.type.replace(/ /g,"").split(",").join("|"));b={name:b,type:c,default:a.default};a.enum&&(b.enum=p.sorted(a.enum).map(d=>"string"===typeof d?`"${d}"`:`${d}`).join("|"));e.addProperty(b)});
return B.apply(this,arguments)}function m(a,b,e){return C.apply(this,arguments)}function C(){C=h._asyncToGenerator(function*(a,b,e){return"array"===a.type?S(a,b,e):"properties"in a?T(a,b,e):"allOf"in a?U(a,b,e):"oneOf"in a?V(a,b,e):"$ref"in a?W(a,b,e):X(a,b,e)});return C.apply(this,arguments)}function I(a){return 0===a.indexOf("#/definitions/")?a.slice(14):a}function D(){D=h._asyncToGenerator(function*(a,b){b=yield Y.create(a,b);return t(`${a||"webscene"}_schema.json`,null,b.schemaRoot,null,b)});
return D.apply(this,arguments)}const R=/raster.*Renderer|vectorFieldRenderer/,P=/(uniqueValueRenderer|classBreaksRenderer|raster.*Renderer|vectorFieldRenderer)/,Q=/(rasterUniqueValueRenderer|rasterClassBreaksRenderer)/;let Y=function(a){function b(c,d,f){var g=a.call(this)||this;g.definitions=c;g.schemaRoot=d;g.requestSchema=f;g.filteredProperties=null;g.schemaStack=[];g.requestSchema.bind(h._assertThisInitialized(g));return g}h._inheritsLoose(b,a);var e=b.prototype;e.withFilter=function(){var c=
h._asyncToGenerator(function*(d,f){if(!this.hasFilteredProperties)return f();if(this.filteredProperties.has(d)){var g=this.filteredProperties;this.filteredProperties=null;var l=k=>{this.filteredProperties||(this.filteredProperties=new Set);this.filteredProperties.add(k)};g.forEach(k=>{k=k.split(".",2);1<k.length&&k[0]===d&&l(k[1])});yield f();this.filteredProperties=g}});return function(d,f){return c.apply(this,arguments)}}();e.addFilter=function(){var c=h._asyncToGenerator(function*(d,f){const g=
this.filteredProperties;this.filteredProperties=null;const l=k=>{this.filteredProperties||(this.filteredProperties=new Set);this.filteredProperties.add(k)};g&&g.forEach(l);d&&d.forEach(l);d=yield f();this.filteredProperties=g;return d});return function(d,f){return c.apply(this,arguments)}}();b.create=function(){var c=h._asyncToGenerator(function*(d,f){return f&&f.useRemoteSchema?b.createRemote(d,f.baseUrl):b.createLocal(d)});return function(d,f){return c.apply(this,arguments)}}();b.createLocal=function(c){return new b(n.json.definitions,
c&&"webscene"!==c?n.json.definitions[`${c}_schema.json`]:n.json,b.getLocalSchemaRequest())};b.createRemote=function(){var c=h._asyncToGenerator(function*(d,f){f=yield b.getRemoteSchemaRequest(f);const g=new b({},null,f);d=(yield g.requestSchema(`${d||"webscene"}_schema.json`)).schema;return new b(g.definitions,d,f)});return function(d,f){return c.apply(this,arguments)}}();b.getLocalSchemaRequest=function(){return function(c){c=I(c);const d=this.definitions[c];return d?Promise.resolve({schemaId:c,
schema:d}):Promise.reject(new E("spec-certification:spec-invalid-local-schema","Schema reference is not a local reference"))}};b.getRemoteSchemaRequest=function(){var c=h._asyncToGenerator(function*(d){if(!d)return Promise.reject(new E("spec-certification:spec-missing-base-url","The base url of the remote schema directory must be specified when using a remote schema"));const f=b.getLocalSchemaRequest(),g=(yield new Promise(function(l,k){J(["../../request"],function(Z){l(Object.freeze({__proto__:null,
"default":Z}))},k)})).default;return function(l){return f.call(this,l).catch(()=>g(`${d}/${l}`,{responseType:"json"}).then(k=>{this.definitions[I(l)]=k.data;return{schemaId:l,schema:k.data}}))}});return function(d){return c.apply(this,arguments)}}();h._createClass(b,[{key:"hasFilteredProperties",get:function(){return this.filteredProperties&&0<this.filteredProperties.size}},{key:"filteredPropertiesArray",get:function(){const c=[];this.filteredProperties.forEach(d=>c.push(d));return c}}]);return b}(p.ScanContext);
const aa=Object.keys(n.json.definitions).map(a=>a.replace(/_schema\.json$/,""));r.scan=function(a,b){return D.apply(this,arguments)};r.schemaDefinitions=aa;Object.defineProperty(r,"__esModule",{value:!0})});