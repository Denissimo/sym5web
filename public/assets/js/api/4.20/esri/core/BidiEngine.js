// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["./bidiEngineTables"],function(g){function x(d,f,a,h,b){var c=d;void 0===f&&(f=b.defInFormat);void 0===a&&(a=b.defOutFormat);void 0===h&&(h=b.defSwap);if(f!==a){var e=f.substring(0,1),k=a.substring(0,1);var l=f.substring(1,4);var m=a.substring(1,4);"C"===l.charAt(0)&&(l=z(c),l="ltr"===l||"rtl"===l?l.toUpperCase():"L"===f.charAt(2)?"LTR":"RTL",f=e+l);"C"===m.charAt(0)&&(l=z(c),"rtl"===l?m="RTL":"ltr"===l?(c=c.split(""),c.reverse(),l=z(c.join("")),m=l.toUpperCase()):m="L"===a.charAt(2)?"LTR":
"RTL",a=k+m)}if(f===a)return d;k=f.substring(0,1);c=f.substring(1,4);e=a.substring(0,1);m=a.substring(1,4);b.inFormat=f;b.outFormat=a;b.swap=h;if("L"===k&&"VLTR"===a){if("LTR"===c)return b.dir=0,w(d,b);if("RTL"===c)return b.dir=1,w(d,b)}if("V"===k&&"V"===e)return b.dir="RTL"===c?1:0,D(d,b);if("L"===k&&"VRTL"===a)return b.dir="LTR"===c?0:1,d=w(d,b),D(d);if("VLTR"===f&&"LLTR"===a)return b.dir=0,w(d,b);if("V"===k&&"L"===e&&c!==m)return d=D(d),"RTL"===c?x(d,"LLTR","VLTR",h,b):x(d,"LRTL","VRTL",h,b);if("VRTL"===
f&&"LRTL"===a)return x(d,"LRTL","VRTL",h,b);"L"===k&&"L"===e&&(f=b.swap,b.swap=f.substr(0,1)+"N","RTL"===c?(b.dir=1,d=w(d,b),b.swap="N"+f.substr(1,2),b.dir=0,d=w(d,b)):(b.dir=0,d=w(d,b),b.swap="N"+f.substr(1,2),d=x(d,"VLTR","LRTL",b.swap,b)));return d}function z(d){return(d=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(d))?"z">=d[0]?"ltr":"rtl":""}function w(d,f){d=d.split("");const a=[];F(d,a,f);if(0!==f.hiLevel&&f.swap.substr(0,1)!==f.swap.substr(1,2))for(let c=
0;c<d.length;c++)if(1===a[c]){var h=c;b:{let e=void 0;var b=d[c];let k=0,l=g.SwapTable.length-1;for(;k<=l;)if(e=Math.floor((k+l)/2),b<g.SwapTable[e][0])l=e-1;else if(b>g.SwapTable[e][0])k=e+1;else{b=g.SwapTable[e][1];break b}}d[h]=b}G(2,d,a,f);G(1,d,a,f);A=a;return d.join("")}function F(d,f,a){const h=d.length;var b=a.dir?g.impTabRtl:g.impTabLtr,c=0,e=-1;const k=[],l=[];a.hiLevel=a.dir;a.lastArabic=!1;a.hasUbatAl=!1;a.hasUbatB=!1;a.hasUbatS=!1;for(var m=0;m<h;m++){var p=m;{var r=d[m].charCodeAt(0);
const n=g.PrimaryTable[r>>8];r=n<g.TBBASE?n:g.UnicodeTable[n-g.TBBASE][r&255]}k[p]=r}for(p=0;p<h;p++){m=O(d,k,l,p,a);l[p]=m;c=b[c][m];r=c&240;c&=15;m=b[c][5];f[p]=m;if(0<r){if(16===r)for(;e<p;e++)f[e]=1;e=-1}if(b[c][6])-1===e&&(e=p);else if(-1<e){for(;e<p;e++)f[e]=m;e=-1}k[p]===g.UBAT_B&&(f[p]=0);a.hiLevel|=m}if(a.hasUbatS)for(d=0;d<h;d++)if(k[d]===g.UBAT_S)for(f[d]=a.dir,b=d-1;0<=b;b--)if(k[b]===g.UBAT_WS)f[b]=a.dir;else break}function D(d,f){d=d.split("");if(f){const a=[];F(d,a,f);A=a}d.reverse();
t.reverse();return d.join("")}function H(d){for(let f=0;f<g.ArabicAlefBetIntervalsBegine.length;f++)if(d>=g.ArabicAlefBetIntervalsBegine[f]&&d<=g.ArabicAlefBetIntervalsEnd[f])return!0;return!1}function I(d,f,a,h){for(;f*a<h&&y(d[f]);)f+=a;return f*a<h&&H(d[f])?!0:!1}function G(d,f,a,h){if(!(h.hiLevel<d))if(1!==d||1!==h.dir||h.hasUbatB){h=f.length;for(var b=0,c,e,k;b<h;){if(a[b]>=d){for(c=b+1;c<h&&a[c]>=d;)c++;for(e=c-1;b<e;b++,e--)k=f[b],f[b]=f[e],f[e]=k,k=t[b],t[b]=t[e],t[e]=k;b=c}b++}}else f.reverse(),
t.reverse()}function O(d,f,a,h,b){return{UBAT_L:()=>{b.lastArabic=!1;return g.UBAT_L},UBAT_R:()=>{b.lastArabic=!1;return g.UBAT_R},UBAT_ON:()=>g.UBAT_ON,UBAT_AN:()=>g.UBAT_AN,UBAT_EN:()=>b.lastArabic?g.UBAT_AN:g.UBAT_EN,UBAT_AL:()=>{b.lastArabic=!0;b.hasUbatAl=!0;return g.UBAT_R},UBAT_WS:()=>g.UBAT_ON,UBAT_CS:()=>{let c,e;if(1>h||h+1>=f.length||(c=a[h-1])!==g.UBAT_EN&&c!==g.UBAT_AN||(e=f[h+1])!==g.UBAT_EN&&e!==g.UBAT_AN)return g.UBAT_ON;b.lastArabic&&(e=g.UBAT_AN);return e===c?e:g.UBAT_ON},UBAT_ES:()=>
(0<h?a[h-1]:g.UBAT_B)===g.UBAT_EN&&h+1<f.length&&f[h+1]===g.UBAT_EN?g.UBAT_EN:g.UBAT_ON,UBAT_ET:()=>{if(0<h&&a[h-1]===g.UBAT_EN)return g.UBAT_EN;if(b.lastArabic)return g.UBAT_ON;let c=h+1;const e=f.length;for(;c<e&&f[c]===g.UBAT_ET;)c++;return c<e&&f[c]===g.UBAT_EN?g.UBAT_EN:g.UBAT_ON},UBAT_NSM:()=>{if("VLTR"===b.inFormat){for(var c=f.length,e=h+1;e<c&&f[e]===g.UBAT_NSM;)e++;if(e<c&&(c=d[h].charCodeAt[0],e=f[e],(1425<=c&&2303>=c||64286===c)&&(e===g.UBAT_R||e===g.UBAT_AL)))return g.UBAT_R}return 1>
h||f[h-1]===g.UBAT_B?g.UBAT_ON:a[h-1]},UBAT_B:()=>{b.lastArabic=!0;b.hasUbatB=!0;return b.dir},UBAT_S:()=>{b.hasUbatS=!0;return g.UBAT_ON},UBAT_LRE:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_RLE:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_LRO:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_RLO:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_PDF:()=>{b.lastArabic=!1;return g.UBAT_ON},UBAT_BN:()=>g.UBAT_ON}[g.TYPES_NAMES[f[h]]]()}function E(d,f){for(let a=0;a<g.BaseForm.length;a++)if(d===g.BaseForm[a])return f[a];
return d}function y(d){return"\u064b"<=d&&"\u0655">=d?!0:!1}function J(d){return"L"===d?"LTR":"R"===d?"RTL":"C"===d?"CLR":"D"===d?"CRL":""}function K(d,f){for(let a=0;a<g.AlefTable.length;a++)if(d===g.AlefTable[a])return f[a];return d}function L(d,f,a,h){for(let b=0;b<d.length;b++)if(d[b]>f||!a&&d[b]===f)d[b]+=h}let t=[],B=[],A=[];const C={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,
defOutFormat:""},M=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,P=/[\u0591-\u06ff\ufb1d-\ufefc]/;return function(){function d(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}var f=d.prototype;f.bidiTransform=function(a,h,b){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var c=this.sourceToTarget,e=this.targetToSource,k=a.length;t=[];A=[];for(var l=0;l<k;l++)c[l]=l,e[l]=l,t[l]=l;if(!this.checkParameters(h,b))return a;h=this.inputFormat;
b=this.outputFormat;c=a;k=J(h.charAt(1));c=J(b.charAt(1));l="I"===h.charAt(0)?"L":h.charAt(0);e="I"===b.charAt(0)?"L":b.charAt(0);k=l+k;c=e+c;e=h.charAt(2)+b.charAt(2);C.defInFormat=k;C.defOutFormat=c;C.defSwap=e;a=x(a,k,c,e,C);c=!1;if("R"===b.charAt(1))c=!0;else if("C"===b.charAt(1)||"D"===b.charAt(1))c="rtl"===this.checkContextual(a);e=this.sourceToTarget=t;k=Array(e.length);for(l=0;l<e.length;l++)k[e[l]]=l;B=this.targetToSource=e=k;if(h.charAt(3)===b.charAt(3))c=a;else if("S"===b.charAt(3))if(h=
c,b=!0,0===a.length)c="";else{void 0===h&&(h=!0);void 0===b&&(b=!0);a=String(a);a=a.split("");k=0;c=1;e=a.length;h||(k=a.length-1,c=-1,e=1);var m=k;k=b;var p=0;l=[];for(var r=0;m*c<e;m+=c)if(H(a[m])||y(a[m])){var n;if(n="\u0644"===a[m])b:{for(var q=a,u=m+c,v=c,N=e;u*v<N&&y(q[u]);)u+=v;n=" ";if(u*v<N)for(n=q[u],q=0;q<g.AlefTable.length;q++)if(g.AlefTable[q]===n){n=!0;break b}n=!1}if(n){a[m]=0===p?K(a[m+c],g.LamAlefInialTableFE):K(a[m+c],g.LamAlefMedialTableFE);m+=c;p=a;n=m;q=c;for(u=e;n*q<u&&y(p[n]);)n+=
q;n*q<u&&(p[n]=" ");k&&(l[r]=m,r++);p=0}else{n=a[m];if(1===p){q=m;if(I(a,m+c,c,e))b:for(u=a[m],v=0;v<g.BaseForm.length;v++){if(u===g.BaseForm[v]){u=g.MedialForm[v];break b}}else u=E(a[m],g.FinalForm);a[q]=u}else!0===I(a,m+c,c,e)?a[m]=E(a[m],g.InitialForm):a[m]=E(a[m],g.IsolatedForm);y(n)||(p=1);b:{for(q=0;q<g.StandAlonForm.length;q++)if(g.StandAlonForm[q]===n){n=!0;break b}n=!1}!0===n&&(p=0)}}else p=0;c=l;e="";for(k=0;k<a.length;k++){if(l=b){b:{for(l=0;l<c.length;l++)if(c[l]===k)break b;l=-1}l=-1<
l}l?(L(B,k,!h,-1),t.splice(k,1)):e+=a[k]}c=e}else if(h=a,b=c,a=!0,0===h.length)c="";else for(void 0===a&&(a=!0),void 0===b&&(b=!0),h=String(h),c="",e=h.split(""),k=0;k<h.length;k++)l=!1,"\ufe70"<=e[k]&&"\ufeff">e[k]?(r=h.charCodeAt(k),"\ufef5"<=e[k]&&"\ufefc">=e[k]?(b?(0<k&&a&&" "===e[k-1]?c=c.substring(0,c.length-1)+"\u0644":(c+="\u0644",l=!0),c+=g.AlefTable[(r-65269)/2]):(c+=g.AlefTable[(r-65269)/2],c+="\u0644",k+1<h.length&&a&&" "===e[k+1]?k++:l=!0),l&&(L(B,k,!0,1),t.splice(k,0,t[k]))):c+=g.FETo06Table[r-
65136]):c+=e[k];this.sourceToTarget=t;this.targetToSource=B;this.levels=A;return c};f._inputFormatSetter=function(a){if(!M.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a};f._outputFormatSetter=function(a){if(!M.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a};f.checkParameters=function(a,h){a?this._inputFormatSetter(a):a=this.inputFormat;h?this._outputFormatSetter(h):h=this.outputFormat;return a===
h?!1:!0};f.checkContextual=function(a){a=z(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(h){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a};f.hasBidiChar=function(a){return P.test(a)};return d}()});