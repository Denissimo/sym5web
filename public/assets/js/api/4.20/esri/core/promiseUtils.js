// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ./clock ./Error ./events ./Logger ./maybe".split(" "),function(g,H,A,B,I,k){function C(a){return new Promise((b,c)=>{try{a(b,c)}catch(d){Promise.resolve().then(()=>c(d))}})}function m(a="Aborted"){return new A("AbortError",a)}function r(){return new AbortController}function D(a,b="Aborted"){if(E(a))throw m(b);}function t(a){return k.isSome(a)?"aborted"in a?a:a.signal:a}function E(a){a=t(a);return k.isSome(a)&&a.aborted}function u(a,b){a=t(a);if(!k.isNone(a))if(a.aborted)b();else return B.once(a,
"abort",()=>b())}function q(a){return a&&"AbortError"===a.name}function w(){let a=null;const b=new Promise((c,d)=>{a={promise:void 0,resolve:c,reject:d}});a.promise=b;return a}function x(a){if(a){if("function"!==typeof a.forEach){const b=Object.keys(a),c=b.map(d=>a[d]);return x(c).then(d=>{const e={};b.forEach((f,h)=>e[f]=d[h]);return e})}return C(b=>{const c=[];let d=a.length;0===d&&b(c);a.forEach(e=>{const f={promise:e||Promise.resolve(e)};c.push(f);f.promise.then(h=>{f.value=h}).catch(h=>{f.error=
h}).then(()=>{--d;0===d&&b(c)})})})}}function F(a,b,c){const d=r();u(c,()=>d.abort());return new Promise((e,f)=>{let h=setTimeout(()=>{h=0;e(b)},a);u(d,()=>{h&&(clearTimeout(h),f(m()))})})}function y(a){return G(a)?a:Promise.resolve(a)}function G(a){return a&&"object"===typeof a&&"then"in a&&"function"===typeof a.then}g.after=F;g.all=function(a){return Promise.all(a)};g.always=function(a,b){return a.then(b,b)};g.create=C;g.createAbortController=r;g.createAbortError=m;g.createDeferred=w;g.createResolver=
function(){let a,b;const c=new Promise((e,f)=>{a=e;b=f}),d=e=>{a(e)};d.resolve=e=>a(e);d.reject=e=>b(e);d.timeout=(e,f)=>H["default"].setTimeout(()=>d.reject(f),e);d.promise=c;return d};g.createTask=function(a){let b=r();a=a(b.signal);let c={promise:a,finished:!1,abort:()=>{b&&(b.abort(),b=null)}};const d=()=>{c&&(c.finished=!0,c=null);b=null};a.then(d,d);return c};g.debounce=function(a,b=-1){let c,d,e,f,h=null;const p=(...l)=>{if(c){d=l;f&&f.reject(m());f=w();l=k.assumeNonNull(f.promise);if(h){var v=
h;h=null;v.abort()}return l}e=f||w();f=null;if(0<b){const n=r(),J=c=y(a(...l,n.signal));F(b).then(()=>{c===J&&(f?n.abort():h=n)})}else c=1,c=y(a(...l));l=()=>{const n=d;d=e=c=h=null;null!=n&&p(...n)};v=c;const z=e;v.then(l,l);v.then(z.resolve,z.reject);return k.assumeNonNull(z.promise)};return p};g.eachAlways=x;g.eachAlwaysValues=function(a){return x(a).then(b=>b.filter(c=>!!c.value).map(c=>c.value))};g.filter=function(a,b){const c=a.slice();return Promise.all(a.map((d,e)=>b(d,e))).then(d=>c.filter((e,
f)=>d[f]))};g.ignoreAbortErrors=function(a){return a.catch(b=>{if(!q(b))throw b;})};g.isAbortError=q;g.isAborted=E;g.isPromise=G;g.isPromiseLike=function(a){return a&&"function"===typeof a.then};g.logOnError=function(a,b=I.getLogger("esri")){return a.catch(c=>{q(c)||b.error(c)})};g.onAbort=u;g.onAbortOrThrow=function(a,b){a=t(a);if(!k.isNone(a))return D(a),B.once(a,"abort",()=>b(m()))};g.reject=function(a){return Promise.reject(a)};g.resolve=function(a){return Promise.resolve(a)};g.throwIfAbortError=
function(a){if(q(a))throw a;};g.throwIfAborted=D;g.throwIfNotAbortError=function(a){if(!q(a))throw a;};g.timeout=function(a,b,c,d){const e=c&&"abort"in c?c:null;null!=d||e||(d=c);let f=setTimeout(()=>{f=0;e&&e.abort()},b);const h=()=>{throw d||new A("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");};return a.then(p=>{if(0===f)throw h();clearTimeout(f);return p},p=>{clearTimeout(f);throw 0===f?h():p;})};g.when=y;g.whenOrAbort=function(a,b){const c=t(b);return k.isNone(c)?
a:new Promise((d,e)=>{let f=u(b,()=>e(m()));const h=()=>f=k.removeMaybe(f);a.then(h,h);a.then(d,e)})};Object.defineProperty(g,"__esModule",{value:!0})});