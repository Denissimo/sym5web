// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["./has","./ObjectPool"],function(g,m){const l=g("esri-text-decoder")?new TextDecoder("utf-8"):null,n=g("safari")||g("ios")?6:g("ff")?12:32;g=function(){function h(a,b,e=0,c=a?a.byteLength:0){this._tag=0;this._dataType=99;this.init(a,b,e,c)}var d=h.prototype;d.init=function(a,b,e,c){this._data=a;this._dataView=b;this._pos=e;this._end=c};d.clone=function(){return new h(this._data,this._dataView,this._pos,this._end)};d.pos=function(){return this._pos};d.move=function(a){this._pos=a};d.nextTag=
function(a){for(;;){if(this._pos===this._end)return!1;const b=this._decodeVarint();this._tag=b>>3;this._dataType=b&7;if(!a||a===this._tag)break;this.skip()}return!0};d.next=function(){if(this._pos===this._end)return!1;const a=this._decodeVarint();this._tag=a>>3;this._dataType=a&7;return!0};d.empty=function(){return this._pos>=this._end};d.tag=function(){return this._tag};d.getInt32=function(){return this._decodeVarint()};d.getInt64=function(){return this._decodeVarint()};d.getUInt32=function(){let a=
4294967295;a=(this._data[this._pos]&127)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<7)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<14)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&127)<<21)>>>0;if(128>this._data[this._pos++])return a;a=(a|(this._data[this._pos]&15)<<28)>>>0;if(128>this._data[this._pos++])return a};d.getUInt64=function(){return this._decodeVarint()};d.getSInt32=function(){const a=this.getUInt32();
return a>>>1^-(a&1)|0};d.getSInt64=function(){return this._decodeSVarint()};d.getBool=function(){const a=0!==this._data[this._pos];this._skip(1);return a};d.getEnum=function(){return this._decodeVarint()};d.getFixed64=function(){var a=this._dataView;const b=this._pos;a=a.getUint32(b,!0)+4294967296*a.getUint32(b+4,!0);this._skip(8);return a};d.getSFixed64=function(){var a=this._dataView;const b=this._pos;a=a.getUint32(b,!0)+4294967296*a.getInt32(b+4,!0);this._skip(8);return a};d.getDouble=function(){const a=
this._dataView.getFloat64(this._pos,!0);this._skip(8);return a};d.getFixed32=function(){const a=this._dataView.getUint32(this._pos,!0);this._skip(4);return a};d.getSFixed32=function(){const a=this._dataView.getInt32(this._pos,!0);this._skip(4);return a};d.getFloat=function(){const a=this._dataView.getFloat32(this._pos,!0);this._skip(4);return a};d.getString=function(){const a=this._getLength();var b=this._pos;b=this._toString(this._data,b,b+a);this._skip(a);return b};d.getBytes=function(){const a=
this._getLength();var b=this._pos;b=this._toBytes(this._data,b,b+a);this._skip(a);return b};d.getLength=function(){return this._getLengthUnsafe()};d.processMessageWithArgs=function(a,b,e,c){const f=this.getMessage();a=a(f,b,e,c);f.release();return a};d.processMessage=function(a){const b=this.getMessage();a=a(b);b.release();return a};d.getMessage=function(){const a=this._getLength(),b=h.pool.acquire();b.init(this._data,this._dataView,this._pos,this._pos+a);this._skip(a);return b};d.release=function(){h.pool.release(this)};
d.dataType=function(){return this._dataType};d.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw Error("Invalid data type!");}};d.skipLen=function(a){this._skip(a)};d._skip=function(a){if(this._pos+a>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=a};d._decodeVarint=function(){const a=this._data;let b=this._pos,e=0,c;if(10<=this._end-b){if(c=
a[b++],e|=c&127,0!==(c&128)&&(c=a[b++],e|=(c&127)<<7,0!==(c&128)&&(c=a[b++],e|=(c&127)<<14,0!==(c&128)&&(c=a[b++],e|=(c&127)<<21,0!==(c&128)&&(c=a[b++],e+=268435456*(c&127),0!==(c&128)&&(c=a[b++],e+=34359738368*(c&127),0!==(c&128)&&(c=a[b++],e+=4398046511104*(c&127),0!==(c&128)&&(c=a[b++],e+=562949953421312*(c&127),0!==(c&128)&&(c=a[b++],e+=72057594037927936*(c&127),0!==(c&128)&&(c=a[b++],e+=0x7fffffffffffffff*(c&127),0!==(c&128)))))))))))throw Error("Varint too long!");}else{let f=1;for(;b!==this._end;){c=
a[b];if(0===(c&128))break;++b;e+=(c&127)*f;f*=128}if(b===this._end)throw Error("Varint overrun!");++b;e+=c*f}this._pos=b;return e};d._decodeSVarint=function(){const a=this._decodeVarint();return a%2?-(a+1)/2:a/2};d._getLength=function(){if(2!==this._dataType)throw Error("Not a delimited data type!");return this._decodeVarint()};d._getLengthUnsafe=function(){return this.getUInt32()};d._toString=function(a,b,e){e=Math.min(this._end,e);if(e-b>n&&l)return a=a.subarray(b,e),l.decode(a);let c="",f="";for(;b<
e;++b){const k=a[b];k&128?f+="%"+k.toString(16):(c+=decodeURIComponent(f)+String.fromCharCode(k),f="")}f.length&&(c+=decodeURIComponent(f));return c};d._toBytes=function(a,b,e){e=Math.min(this._end,e);return new Uint8Array(a.buffer,b,e-b)};return h}();g.pool=new m(g,null,h=>{h._data=null;h._dataView=null});return g});