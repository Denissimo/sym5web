// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["require","../../chunks/_rollupPluginBabelHelpers","../global","./RemoteClient","./utils"],function(q,k,e,l,g){function r(c){if(c&&c.__esModule)return c;var b=Object.create(null);c&&Object.keys(c).forEach(function(a){if("default"!==a){var d=Object.getOwnPropertyDescriptor(c,a);Object.defineProperty(b,a,d.get?d:{enumerable:!0,get:function(){return c[a]}})}});b["default"]=c;return Object.freeze(b)}let t=function(){const c=document.createDocumentFragment();["addEventListener","dispatchEvent",
"removeEventListener"].forEach(b=>{this[b]=(...a)=>c[b](...a)})};const m=e.MutationObserver||e.WebKitMutationObserver,n=function(){let c;if(e.process&&e.process.nextTick)c=b=>{e.process.nextTick(b)};else if(e.Promise)c=b=>{e.Promise.resolve().then(b)};else if(m){const b=[],a=document.createElement("div");(new m(()=>{for(;0<b.length;)b.shift()()})).observe(a,{attributes:!0});c=d=>{b.push(d);a.setAttribute("queueStatus","1")}}return c}(),p=(()=>{const c=e.MessageEvent;try{new c("message",{data:null})}catch{return(b,
a={})=>{const {data:d,bubbles:f=!1,cancelable:h=!1}=a;a=document.createEvent("Event");a.initEvent(b,f,h);a.data=d;return a}}return(b,a)=>new c(b,a)})();return function(){function c(){this._dispatcher=new t;this._workerPostMessage({type:g.MessageType.HANDSHAKE})}var b=c.prototype;b.terminate=function(){};b.postMessage=function(a){n(()=>{this._workerMessageHandler(p("message",{data:a}))})};b.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};b.addEventListener=function(a,d,f){this._dispatcher.addEventListener(a,
d,f)};b.removeEventListener=function(a,d,f){this._dispatcher.removeEventListener(a,d,f)};b._workerPostMessage=function(a){n(()=>{this.dispatchEvent(p("message",{data:a}))})};b._workerMessageHandler=function(){var a=k._asyncToGenerator(function*(d){if((d=g.receiveMessage(d))&&d.type===g.MessageType.OPEN){const {modulePath:f,jobId:h}=d;(d=yield l.loadWorker(f))||(d=yield new Promise(function(u,v){q([f],function(w){u(r(w))},v)}));d=l.connect(d);this._workerPostMessage({type:g.MessageType.OPENED,jobId:h,
data:d})}});return function(d){return a.apply(this,arguments)}}();k._createClass(c,[{key:"onmessage",get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)}},{key:"onmessageerror",get:function(){return this._onmessageerrorHandler},set:function(a){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler);(this._onmessageerrorHandler=
a)&&this.addEventListener("messageerror",a)}},{key:"onerror",get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)}}]);return c}()});