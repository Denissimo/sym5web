// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../config ./Error ./global ./Logger ./maybe".split(" "),function(e,L,Z,x,aa,p){function m(a){const b={path:null,query:null},c=new n(a),d=a.indexOf("?");null===c.query?b.path=a:(b.path=a.substring(0,d),b.query=D(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1))));return b}function D(a){var b=a.split("\x26");a={};for(const d of b){if(!d)continue;var c=d.indexOf("\x3d");0>c?(b=decodeURIComponent(d),c=""):(b=decodeURIComponent(d.slice(0,
c)),c=decodeURIComponent(d.slice(c+1)));let f=a[b];"string"===typeof f&&(f=a[b]=[f]);Array.isArray(f)?f.push(c):a[b]=c}return a}function M(a){return a&&"object"===typeof a&&"toJSON"in a&&"function"===typeof a.toJSON}function t(a,b){return a?b&&"function"===typeof b?Object.keys(a).map(c=>encodeURIComponent(c)+"\x3d"+encodeURIComponent(b(c,a[c]))).join("\x26"):Object.keys(a).map(c=>{const d=a[c];if(null==d)return"";const f=encodeURIComponent(c)+"\x3d";return(c=b&&b[c])?f+encodeURIComponent(c(d)):Array.isArray(d)?
d.map(g=>M(g)?f+encodeURIComponent(JSON.stringify(g)):f+encodeURIComponent(g)).join("\x26"):M(d)?f+encodeURIComponent(JSON.stringify(d)):f+encodeURIComponent(d)}).filter(c=>c).join("\x26"):""}function E(a){const b=a.indexOf("?");-1!==b?(u.path=a.slice(0,b),u.query=a.slice(b+1)):(u.path=a,u.query=null);return u}function N(a){a=E(a).path;a&&"/"===a[a.length-1]||(a=`${a}/`);a=y(a,!0);return a=a.toLowerCase()}function z(a){const b=q.proxyRules;a=N(a);for(let c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}
function O(a){a=v(a);const b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function F(a,b,c=!1){a=G(a);b=G(b);return!c&&a.scheme!==b.scheme||null==a.host||null==b.host?!1:a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port}function A(a,b=H,c){return k(a)?c&&c.preserveProtocolRelative?a:"http"===h.scheme&&h.authority===P(a).slice(2)?`http:${a}`:`https:${a}`:B(a)?a:p.assumeNonNull(Q("/"===a[0]?ba(b):b,a))}function v(a){a=a.trim();a=A(a);if(/^https?:\/\//i.test(a)){const b=
E(a);a=b.path.replace(/\/{2,}/g,"/");a=a.replace("/","//");b.query&&(a+=`?${b.query}`)}a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");return a=ca(a)}function Q(...a){var b=a.filter(p.isSome);if(b&&b.length){a=[];if(r(b[0])){var c=b[0],d=c.indexOf("//");-1!==d&&(a.push(c.slice(0,d+1)),da.test(b[0])&&(a[0]+="/"),b[0]=c.slice(d+2))}else"/"===b[0][0]&&a.push("");b=b.reduce((f,g)=>g?f.concat(g.split("/")):f,[]);for(c=0;c<b.length;c++)d=b[c],".."===d&&0<a.length&&".."!==a[a.length-1]?a.pop():(!d&&
c===b.length-1||d&&("."!==d||0===a.length))&&a.push(d);return a.join("/")}}function P(a,b=!1){if(R(a)||S(a))return null;var c=a.indexOf("://");if(-1===c&&k(a))c=2;else if(-1!==c)c+=3;else return null;c=a.indexOf("/",c);-1!==c&&(a=a.slice(0,c));b&&(a=y(a,!0));return a}function r(a){return k(a)||B(a)}function R(a){return null!=a&&"blob:"===a.slice(0,5)}function S(a){return"data:"===a.slice(0,5)}function T(a){a=I(a);if(!a||!a.isBase64)return null;a=atob(a.data);const b=new Uint8Array(a.length);for(let c=
0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}function I(a){a=a.match(ea);if(!a)return null;const [,b,c,d]=a;return{mediaType:b,isBase64:!!c,data:d}}function J(a){const b=T(a);if(!b)return null;a=I(a);return new Blob([b],{type:a.mediaType})}function k(a){return null!=a&&void 0!==a&&"/"===a[0]&&"/"===a[1]}function B(a){return U.test(a)}function V(a){return W.test(a)||"https"===h.scheme&&k(a)}function fa(a){return X.test(a)||"http"===h.scheme&&k(a)}function K(a){return k(a)?`https:${a}`:a.replace(X,
"https:")}function C(){return"https"===h.scheme}function y(a,b=!1){if(k(a))return a.slice(2);a=a.replace(U,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function ba(a){var b=a.indexOf("//");b=a.indexOf("/",b+2);return-1===b?a:a.slice(0,b)}function ca(a){const b=q.httpsDomains;if(!fa(a))return a;const c=a.indexOf("/",7);let d;d=-1===c?a:a.slice(0,c);d=d.toLowerCase().slice(7);if(ha.test(d))if(d.endsWith(":80"))d=d.slice(0,-3),a=a.replace(":80","");else return a;if("http"===h.scheme&&
d===h.authority&&!ia.test(a))return a;if(C()&&d===h.authority||b&&b.some(f=>d===f||d.endsWith(`.${f}`))||C()&&!z(a))a=K(a);return a}function G(a){if("string"===typeof a)return new n(A(a));a.scheme||(a.scheme=h.scheme);return a}const ja=aa.getLogger("esri.core.urlUtils"),q=L.request,U=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,X=/^\s*http:/i,W=/^\s*https:/i,da=/^\s*file:/i,ha=/:\d+$/,ia=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,ka=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,la=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/;
let n=function(){function a(b=""){this.uri=b;this.port=this.host=this.password=this.user=this.fragment=this.query=this.path=this.authority=this.scheme=null;b=p.assumeNonNull(this.uri.match(ka));this.scheme=b[2]||(b[1]?"":null);this.authority=b[4]||(b[3]?"":null);this.path=b[5];this.query=b[7]||(b[6]?"":null);this.fragment=b[9]||(b[8]?"":null);null!=this.authority&&(b=p.assumeNonNull(this.authority.match(la)),this.user=b[3]||null,this.password=b[4]||null,this.host=b[6]||b[7],this.port=b[9]||null)}
a.prototype.toString=function(){return this.uri};return a}();const h=new n(L.applicationUrl),w={},H=(()=>{var a=p.assumeNonNull(h.path);a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return`${`${h.scheme}://${h.host}${null!=h.port?`:${h.port}`:""}`}${a}`})(),u={path:"",query:""},ea=/^data:(.*?)(;base64)?,(.*)$/,ma=/.*?\.([^\/]*)$/,na=/(^data:image\/svg|\.svg$)/i;e.Url=n;e.addProxy=function(a){var b=z(a),c=void 0;if(b){var d=E(b.proxyUrl);c=d.path;d=d.query?D(d.query):null}c&&
(b=m(a),a=c+"?"+b.path,(c=t({...d,...b.query}))&&(a=`${a}?${c}`));return a};e.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:N(a.urlPrefix)};const b=q.proxyRules,c=a.urlPrefix;let d=b.length;for(let f=0;f<b.length;f++){const g=b[f].urlPrefix;if(0===c.indexOf(g)){if(c.length===g.length)return-1;d=f;break}0===g.indexOf(c)&&(d=f+1)}b.splice(d,0,a);return d};e.addQueryParameter=function(a,b,c){a=m(a);const d=a.query||{};d[b]=String(c);return`${a.path}?${t(d)}`};e.addQueryParameters=function(a,
b){a=m(a);const c=a.query||{};for(const d in b)c[d]=b[d];return(b=t(c))?`${a.path}?${b}`:a.path};e.appBaseUrl=H;e.appUrl=h;e.changeDomain=function(a,b,c){if(!(b&&c&&a&&r(a)))return a;const d=a.indexOf("//");var f=a.indexOf("/",d+2);const g=a.indexOf(":",d+2);f=Math.min(0>f?a.length:f,0>g?a.length:g);if(a.slice(d+2,f).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,d+2);a=a.slice(f);return`${b}${c}${a}`};e.dataComponents=I;e.dataToArrayBuffer=T;e.dataToBlob=J;e.downloadDataAsFile=function(a,b){a:{var c=
document.createElement("a");if("download"in c){var d=null;if(x.URL&&x.URL.createObjectURL){d=J(a);if(!d){c=!1;break a}d=x.URL.createObjectURL(d)}c.download=b;c.href=d||a;c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c);d&&x.URL.revokeObjectURL(d);c=void 0}else c=!1}c||window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(J(a),b)};e.getFilename=function(a,b){if(!a)return"";a=m(a).path.replace(/\/+$/,"");a=a.substring(a.lastIndexOf("/")+1);if(null==
b||!b.length)return a;b=new RegExp(`\.(${b.join("|")})$`,"ig");return a.replace(b,"")};e.getInterceptor=function(a){const b=d=>null==d||d instanceof RegExp&&d.test(a)||"string"===typeof d&&a.startsWith(d),c=q.interceptors;if(c)for(const d of c)if(Array.isArray(d.urls)){if(d.urls.some(b))return d}else if(b(d.urls))return d;return null};e.getOrigin=P;e.getPathExtension=function(a){return p.isNone(a)?null:(a=a.match(ma))?a[1]:null};e.getProxyRule=z;e.getProxyUrl=function(a=!1){let b,c=q.proxyUrl;if("string"===
typeof a){if(b=V(a),a=z(a))c=a.proxyUrl}else b=!!a;if(!c)throw ja.warn("esri/config: esriConfig.request.proxyUrl is not set."),new Z("urlutils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set.");b&&C()&&(c=K(c));return m(c)};e.hasProtocol=B;e.hasSameOrigin=F;e.hasSamePortal=function(a,b){a=O(a);b=O(b);return y(a)===y(b)};e.isAbsolute=r;e.isAppHTTPS=C;e.isBlobProtocol=R;e.isDataProtocol=S;e.isHTTPSProtocol=V;e.isProtocolRelative=k;e.isSVG=function(a){return na.test(a)};e.isTrustedServer=
function(a){if("string"===typeof a)if(r(a))a=G(a);else return!0;if(F(a,h))return!0;const b=q.trustedServers||[];for(let d=0;d<b.length;d++){var c=b[d];w[c]||(B(c)||k(c)?w[c]=[new n(A(c))]:w[c]=[new n(`http://${c}`),new n(`https://${c}`)]);c=w[c];for(let f=0;f<c.length;f++)if(F(a,c[f]))return!0}return!1};e.join=Q;e.makeAbsolute=A;e.makeData=function(a){return a.isBase64?`data:${a.mediaType};base64,${a.data}`:`data:${a.mediaType},${a.data}`};e.makeRelative=function(a,b=H,c){if(!r(a))return a;var d=
v(a),f=d.toLowerCase();b=v(b).toLowerCase().replace(/\/+$/,"");if((c=c?v(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;var g=f.indexOf("//")+2;g=f.indexOf("/",g);var l=-1===g?f.length:g;for(g=-1;f.slice(0,l+1)===b.slice(0,l)+"/";){g=l+1;if(l===f.length)break;var Y=f;l+=1;l=Y.indexOf("/",l);l=-1===l?Y.length:l}if(-1===g||c&&g<c.length)return a;a=d.slice(g);d=b.slice(g-1).replace(/[^/]+/g,"").length;if(0<d)for(f=0;f<d;f++)a=`../${a}`;else a=`./${a}`;return a};e.normalize=v;e.objectToQuery=
t;e.queryToObject=D;e.removeFile=function(a){let b=0;if(r(a)){var c=a.indexOf("//");-1!==c&&(b=c+2)}c=a.lastIndexOf("/");return c<b?a:a.slice(0,c+1)};e.removeQueryParameter=function(a,b){const {path:c,query:d}=m(a);if(!d)return a;delete d[b];return(a=t(d))?`${c}?${a}`:c};e.removeQueryParameters=function(a,b){a=m(a);const c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${c.join(", ")}.`);
return a.path};e.removeTrailingSlash=function(a){return a.replace(/\/+$/,"")};e.toHTTP=function(a){return k(a)?`http:${a}`:a.replace(W,"http:")};e.toHTTPS=K;e.trustedServersUrlCache=w;e.urlToObject=m;Object.defineProperty(e,"__esModule",{value:!0})});