// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ./maybe ./nextTick ./PerformanceSampler ./PooledArray ./promiseUtils ./time".split(" "),function(c,H,w,x,y,q,d){function z(){const a=performance.now();m=null;m=0<f.length?requestAnimationFrame(z):null;h.executeFrameTasks(a)}function A(){f.forAll(a=>{a.removed&&n.push(a)});f.removeUnorderedMany(n.data,n.length);n.clear()}function B(){for(;r.length;){const a=H.assumeNonNull(r.shift());a.isActive&&a.callback()}h.willDispatch=!1}let I=function(a){this.phases=a;this.paused=!1;this.ticks=
-1;this.removed=!1},J=function(){function a(b){this.callback=b;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),t=0,u=0;const k={time:d.Milliseconds(0),deltaTime:d.Milliseconds(0),elapsedFrameTime:d.Milliseconds(0),frameDuration:d.Milliseconds(0)},v=["prepare","preRender","render","postRender","update"],r=[],f=new y;let C=function(){function a(e){this._task=e}var b=a.prototype;b.remove=function(){this._task.removed=!0};b.pause=function(){this._task.paused=!0};b.resume=
function(){this._task.paused=!1};return a}();const h={frameTasks:f,willDispatch:!1,clearFrameTasks:function(a=!1){f.forAll(b=>{b.removed=!0});a&&A()},dispatch:B,executeFrameTasks:function(a){const b=d.Milliseconds(a-t);t=a;const e=0<u?u:1E3/60,p=Math.max(0,b-e);for(let l=0;l<v.length;l++){const K=performance.now(),D=v[l];f.forAll(g=>{var E;g.paused||g.removed||(0===l&&g.ticks++,g.phases[D]&&(k.time=a,k.deltaTime=0===g.ticks?d.Milliseconds(0):b,k.elapsedFrameTime=d.Milliseconds(performance.now()-a),
k.frameDuration=d.Milliseconds(e-p),null==(E=g.phases[D])?void 0:E.call(g,k)))});F[l].record(performance.now()-K)}A();G.record(performance.now()-a)}};let m=null;const n=new y,F=v.map(a=>new x(a)),G=new x("total");c.FrameTaskHandle=C;c.addFrameTask=function(a){a=new I(a);f.push(a);null==m&&(t=performance.now(),m=requestAnimationFrame(z));return new C(a)};c.debug=h;c.performanceInfo=F;c.performanceTotal=G;c.schedule=function(a){a=new J(a);r.push(a);h.willDispatch||(h.willDispatch=!0,w(B));return a};
c.setFrameDuration=function(a){u=Math.max(0,a)};c.waitTicks=function(a=1,b){const e=q.createResolver(),p=()=>{q.isAborted(b)?e.reject(q.createAbortError()):0===a?e():(--a,w(()=>p()))};p();return e.promise};Object.defineProperty(c,"__esModule",{value:!0})});