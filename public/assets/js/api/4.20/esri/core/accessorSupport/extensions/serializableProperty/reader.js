// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../Logger ../../../object ../../../Warning ../../metadata ./type".split(" "),function(p,B,C,D,E,F){function w(a){var b;const c=null!=(b=a.ndimArray)?b:0;if(1<c)return G(a);if(1===c)return x(a);if("type"in a&&y(a.type)){var g,e;b=null==(g=a.type.prototype)?void 0:null==(e=g.itemType)?void 0:e.Type;const f=x("function"===typeof b?{type:b}:{types:b});return(h,d,l)=>(h=f(h,d,l))?new a.type(h):h}return q(a)}function q(a){return"type"in a?H(a.type):I(a.types)}function H(a){return a.prototype.read?
(b,c,g)=>{if(null==b)return b;c=typeof b;if("object"!==c)r.error(`Expected JSON value of type 'object' to deserialize type '${a.prototype.declaredClass}', but got '${c}'`);else return c=new a,c.read(b,g),c}:a.fromJSON}function z(a,b,c,g){return 0!==g&&Array.isArray(b)?b.map(e=>z(a,e,c,g-1)):a(b,void 0,c)}function G(a){var b;const c=q(a),g=z.bind(null,c),e=null!=(b=a.ndimArray)?b:0;return(f,h,d)=>{if(null==f)return f;f=g(f,d,e);h=e;for(d=f;0<h&&Array.isArray(d);)h--,d=d[0];if(void 0!==d)for(d=0;d<
h;d++)f=[f];return f}}function x(a){const b=q(a);return(c,g,e)=>{if(null==c)return c;if(Array.isArray(c)){g=[];for(const f of c)c=b(f,void 0,e),void 0!==c&&g.push(c);return g}e=b(c,void 0,e);return void 0!==e?[e]:void 0}}function y(a){return F.isCollection(a)?(a=a.prototype.itemType)&&a.Type?"function"===typeof a.Type?t(a.Type):A(a.Type):!1:!1}function t(a){return Array.isArray(a)?!1:!!a&&a.prototype&&("read"in a.prototype||"fromJSON"in a||y(a))}function A(a){for(const b in a.typeMap)if(!t(a.typeMap[b]))return!1;
return!0}function I(a){var b;let c=null;const g=null!=(b=a.errorContext)?b:"type";return(e,f,h)=>{if(null==e)return e;f=typeof e;if("object"!==f)r.error(`Expected JSON value of type 'object' to deserialize, but got '${f}'`);else{if(!c){f={};for(const u in a.typeMap){var d,l;const n=a.typeMap[u];var k=E.getOwnClassMetadata(n.prototype);if("function"===typeof a.key)continue;k=k.properties[a.key];if(!k)continue;null!=(d=k.json)&&d.type&&Array.isArray(k.json.type)&&1===k.json.type.length&&"string"===
typeof k.json.type[0]&&(f[k.json.type[0]]=n);k=null==(l=k.json)?void 0:l.write;if(!k||!k.writer){f[u]=n;continue}var m=k.target;m="string"===typeof m?m:a.key;const v={};k.writer(u,v,m);v[m]&&(f[v[m]]=n)}c=f}d=a.key;if("string"===typeof d){if(l=(d=e[d])?c[d]:a.defaultKeyValue?a.typeMap[a.defaultKeyValue]:void 0)return d=new l,d.read(e,h),d;d=`Type '${d||"unknown"}' is not supported`;h&&h.messages&&e&&h.messages.push(new D(`${g}:unsupported`,d,{definition:e,context:h}));r.error(d)}}}}const r=B.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");
p.create=function(a,b,c){var g,e;!a||!c&&!b.read||null!=(g=b.read)&&g.reader||!1===(null==(e=b.read)?void 0:e.enabled)||(c="types"in a?A(a.types):t(a.type),c&&C.setDeepValue("read.reader",w(a),b))};p.createTypeReader=w;Object.defineProperty(p,"__esModule",{value:!0})});