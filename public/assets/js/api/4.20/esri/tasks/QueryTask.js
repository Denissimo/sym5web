// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/has ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ../layers/support/source/DataLayerSource ../rest/query/executeAttachmentQuery ../rest/query/executeForCount ../rest/query/executeForExtent ../rest/query/executeForIds ../rest/query/executeQueryJSON ../rest/query/executeQueryPBF ../rest/query/executeRelationshipQuery ../rest/query/executeTopFeaturesQuery ../rest/query/executeForTopIds ../rest/query/executeForTopExtents ../rest/query/executeForTopCount ../rest/support/FeatureSet ../rest/support/Query ../rest/support/RelationshipQuery ./Task".split(" "),
function(w,p,h,x,y,k,z,l,f,W,X,A,r,B,C,D,E,F,G,t,H,I,J,K,L,M,u,N){f=function(v){function q(a){a=v.call(this,a)||this;a.dynamicDataSource=null;a.fieldsIndex=null;a.format="json";a.gdbVersion=null;a.infoFor3D=null;a.sourceSpatialReference=null;return a}p._inheritsLoose(q,v);var d=q.prototype;d.execute=function(a,b){return this.executeJSON(a,b).then(c=>this.featureSetFromJSON(a,c,b))};d.executeJSON=function(){var a=p._asyncToGenerator(function*(b,c){var e;c={...this.requestOptions,...c};const m=this._normalizeQuery(b);
b=null!=(null==(e=b.outStatistics)?void 0:e[0]);e=y("featurelayer-pbf-statistics");e=!b||e;let g;if("pbf"===this.format&&e)try{g=yield G.executeRawQueryPBF(this.url,m,c)}catch(n){if("query:parsing-pbf"===n.name)this.format="json";else throw n;}"json"!==this.format&&e||(g=yield F.executeRawQueryJSON(this.url,m,c));this._normalizeFields(g.fields);return g});return function(b,c){return a.apply(this,arguments)}}();d.featureSetFromJSON=function(){var a=p._asyncToGenerator(function*(b,c,e){if(!(this._queryIs3DObjectFormat(b)&&
k.isSome(this.infoFor3D)&&c.features&&c.features.length))return L.fromJSON(c);({meshFeatureSetFromJSON:e}=yield z.whenOrAbort(new Promise(function(m,g){w(["../rest/support/meshFeatureSet"],m,g)}),e));return e(b,this.infoFor3D,c)});return function(b,c,e){return a.apply(this,arguments)}}();d.executeForCount=function(a,b){b={...this.requestOptions,...b};a=this._normalizeQuery(a);return C.executeForCount(this.url,a,b)};d.executeForExtent=function(a,b){b={...this.requestOptions,...b};a=this._normalizeQuery(a);
return D.executeForExtent(this.url,a,b)};d.executeForIds=function(a,b){b={...this.requestOptions,...b};a=this._normalizeQuery(a);return E.executeForIds(this.url,a,b)};d.executeRelationshipQuery=function(a,b){a=u.from(a);b={...this.requestOptions,...b};if(this.gdbVersion||this.dynamicDataSource)a=a.clone(),a.gdbVersion=a.gdbVersion||this.gdbVersion,a.dynamicDataSource=a.dynamicDataSource||this.dynamicDataSource;return t.executeRelationshipQuery(this.url,a,b)};d.executeRelationshipQueryForCount=function(a,
b){a=u.from(a);b={...this.requestOptions,...b};if(this.gdbVersion||this.dynamicDataSource)a=a.clone(),a.gdbVersion=a.gdbVersion||this.gdbVersion,a.dynamicDataSource=a.dynamicDataSource||this.dynamicDataSource;return t.executeRelationshipQueryForCount(this.url,a,b)};d.executeAttachmentQuery=function(a,b){return B.executeAttachmentQuery(this.url,a,{...this.requestOptions,...b})};d.executeTopFeaturesQuery=function(a,b){return H.executeTopFeaturesQuery(this.parsedUrl,a,this.sourceSpatialReference,{...this.requestOptions,
...b})};d.executeForTopIds=function(a,b){return I.executeForTopIds(this.parsedUrl,a,{...this.requestOptions,...b})};d.executeForTopExtents=function(a,b){return J.executeForTopExtents(this.parsedUrl,a,{...this.requestOptions,...b})};d.executeForTopCount=function(a,b){return K.executeForTopCount(this.parsedUrl,a,{...this.requestOptions,...b})};d._normalizeQuery=function(a){let b=M.from(a);b.sourceSpatialReference=b.sourceSpatialReference||this.sourceSpatialReference;if(this.gdbVersion||this.dynamicDataSource)b=
b===a?b.clone():b,b.gdbVersion=a.gdbVersion||this.gdbVersion,b.dynamicDataSource=a.dynamicDataSource?r.DataLayerSource.from(a.dynamicDataSource):this.dynamicDataSource;if(k.isSome(this.infoFor3D)&&this._queryIs3DObjectFormat(a)){b=b===a?b.clone():b;b.formatOf3DObjects=null;for(const c of this.infoFor3D.queryFormats){if("3D_glb"===c.id){b.formatOf3DObjects=c.id;break}"3D_gltf"!==c.id||b.formatOf3DObjects||(b.formatOf3DObjects=c.id)}if(!b.formatOf3DObjects)throw new x("query:unsupported-3d-query-formats",
"Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(k.isNone(b.outFields)||!b.outFields.includes("*")){b=b===a?b.clone():b;k.isNone(b.outFields)&&(b.outFields=[]);const {originX:c,originY:e,originZ:m,translationX:g,translationY:n,translationZ:O,scaleX:P,scaleY:Q,scaleZ:R,rotationX:S,rotationY:T,rotationZ:U,rotationDeg:V}=this.infoFor3D.transformFieldRoles;b.outFields.push(c,e,m,g,n,O,P,Q,R,S,T,U,V)}}return b};d._normalizeFields=function(a){if(k.isSome(this.fieldsIndex)&&
k.isSome(a))for(const b of a)(a=this.fieldsIndex.get(b.name))&&Object.assign(b,a.toJSON())};d._queryIs3DObjectFormat=function(a){return k.isSome(this.infoFor3D)&&a.returnGeometry&&"xyFootprint"!==a.multipatchOption&&!a.outStatistics};return q}(N);h.__decorate([l.property({type:r.DataLayerSource})],f.prototype,"dynamicDataSource",void 0);h.__decorate([l.property()],f.prototype,"fieldsIndex",void 0);h.__decorate([l.property()],f.prototype,"format",void 0);h.__decorate([l.property()],f.prototype,"gdbVersion",
void 0);h.__decorate([l.property()],f.prototype,"infoFor3D",void 0);h.__decorate([l.property()],f.prototype,"sourceSpatialReference",void 0);return f=h.__decorate([A.subclass("esri.tasks.QueryTask")],f)});