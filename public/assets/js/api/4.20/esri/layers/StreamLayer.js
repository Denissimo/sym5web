// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../symbols ../core/Error ../core/global ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/extensions/serializableProperty/reader ../geometry/support/typeUtils ./Layer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ./support/featureReductionUtils ./support/fieldProperties ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/PurgeOptions ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../symbols/support/ElevationInfo ../geometry/Extent ../geometry/SpatialReference".split(" "),
function(n,c,p,D,fa,ha,ia,ja,ka,E,F,q,x,G,H,l,I,J,K,b,L,e,la,y,ma,r,M,t,N,z,O,P,Q,R,S,T,U,V,k,u,W,v,X,Y,A,Z,aa,ba,ca,da,B){const ea=J.getLogger("esri.layers.StreamLayer");p=W.defineFieldProperties();b=function(C){function m(...a){a=C.call(this,...a)||this;a.copyright=null;a.definitionExpression=null;a.displayField=null;a.elevationInfo=null;a.featureReduction=null;a.fields=null;a.fieldsIndex=null;a.geometryDefinition=null;a.geometryType=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;
a.maxReconnectionAttempts=0;a.maxReconnectionInterval=20;a.maxScale=0;a.minScale=0;a.objectIdField=null;a.operationalLayerType="ArcGISStreamLayer";a.popupEnabled=!0;a.popupTemplate=null;a.purgeOptions=new A;a.screenSizePerspectiveEnabled=!0;a.sourceJSON=null;a.spatialReference=B.WGS84;a.type="stream";a.url=null;a.updateInterval=300;a.webSocketUrl=null;return a}n._inheritsLoose(m,C);var h=m.prototype;h.normalizeCtorArgs=function(a,d){return"string"===typeof a?{url:a,...d}:a};h.load=function(a){if(!("WebSocket"in
I))return this.addResolvingPromise(Promise.reject(new l("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))),Promise.resolve(this);const d=K.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service","Feed"]},a).catch(L.throwIfAbortError).then(()=>this._fetchService(d)));return Promise.resolve(this)};h.readFeatureReduction=function(a,d){return u.read(a,
d)};h.writeWebSceneFeatureReduction=function(a,d,f,g){u.writeTarget(a,d,"layerDefinition.featureReduction",g)};h.readRenderer=function(a,d,f){d=d.layerDefinition||d;if(a=d.drawingInfo&&d.drawingInfo.renderer||void 0)return(a=q.read(a,d,f)||void 0)||ea.error("Failed to create renderer",{rendererDefinition:d.drawingInfo.renderer,layer:this,context:f}),a;if(d.defaultSymbol)return d.types&&d.types.length?new F({defaultSymbol:w(d.defaultSymbol,d,f),field:d.typeIdField,uniqueValueInfos:d.types.map(g=>({id:g.id,
symbol:w(g.symbol,g,f)}))}):new E({symbol:w(d.defaultSymbol,d,f)})};h.writeRenderer=function(a,d,f,g){q.write(a,d,f,g)};h.writeWebSceneRenderer=function(a,d,f,g){q.write(a,d,"layerDefinition.drawingInfo.renderer",g)};h.createPopupTemplate=function(a){return ba.createPopupTemplate(this,a)};h.createQuery=function(){const a=new aa;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};h.getFieldDomain=function(a,d){if(!this.fields)return null;let f=null;this.fields.some(g=>
{g.name===a&&(f=g.domain);return!!f});return f};h.getField=function(a){return this.fieldsIndex.get(a)};h._fetchService=function(){var a=n._asyncToGenerator(function*(d){var f;if(this.webSocketUrl){var g;if(null==(g=this.timeInfo)||!g.trackIdField)throw new l("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField)throw new l("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");if(!this.fields)throw new l("stream-layer:missing-metadata",
"The stream layer fields must be specified.");if(!this.geometryType)throw new l("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.url=this.webSocketUrl}else this.sourceJSON||({data:d}=yield G(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:d}),this.sourceJSON=d);this.sourceJSON={...null!=(f=this.sourceJSON)?f:{},objectIdField:"__esri_stream_id__"};this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});v.fixRendererFields(this.renderer,
this.fieldsIndex);v.fixTimeInfoFields(this.timeInfo,this.fieldsIndex);return Z.loadStyleRenderer(this,{origin:"service"})});return function(d){return a.apply(this,arguments)}}();n._createClass(m,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){v.fixRendererFields(a,this.fieldsIndex);this._set("renderer",a)}}]);return m}(Q.BlendLayer(V.TemporalLayer(U.ScaleRangeLayer(T.RefreshableLayer(P.ArcGISService(R.OperationalLayer(S.PortalLayer(b.MultiOriginJSONMixin(O)))))))));
c.__decorate([e.property({type:String})],b.prototype,"copyright",void 0);c.__decorate([e.property({readOnly:!0})],b.prototype,"defaultPopupTemplate",null);c.__decorate([e.property({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],b.prototype,"definitionExpression",void 0);c.__decorate([e.property({type:String})],b.prototype,"displayField",void 0);c.__decorate([e.property({type:ca})],b.prototype,"elevationInfo",void 0);c.__decorate([r.reader("featureReduction",
["layerDefinition.featureReduction"])],b.prototype,"readFeatureReduction",null);c.__decorate([t.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:u.webSceneFeatureReductionTypes}})],b.prototype,"writeWebSceneFeatureReduction",null);c.__decorate([e.property(p.fields)],b.prototype,"fields",void 0);c.__decorate([e.property(p.fieldsIndex)],b.prototype,"fieldsIndex",void 0);c.__decorate([e.property({type:da})],b.prototype,"geometryDefinition",void 0);c.__decorate([e.property({type:z.featureGeometryTypeKebabDictionary.apiValues,
json:{read:{reader:z.featureGeometryTypeKebabDictionary.read}}})],b.prototype,"geometryType",void 0);c.__decorate([e.property(k.labelsVisible)],b.prototype,"labelsVisible",void 0);c.__decorate([e.property({type:[X],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Y.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);c.__decorate([e.property(k.legendEnabled)],b.prototype,"legendEnabled",void 0);c.__decorate([e.property({type:["show",
"hide"]})],b.prototype,"listMode",void 0);c.__decorate([e.property({type:y.Integer})],b.prototype,"maxReconnectionAttempts",void 0);c.__decorate([e.property({type:y.Integer})],b.prototype,"maxReconnectionInterval",void 0);c.__decorate([e.property(k.maxScale)],b.prototype,"maxScale",void 0);c.__decorate([e.property(k.minScale)],b.prototype,"minScale",void 0);c.__decorate([e.property({type:String})],b.prototype,"objectIdField",void 0);c.__decorate([e.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],
b.prototype,"operationalLayerType",void 0);c.__decorate([e.property(k.popupEnabled)],b.prototype,"popupEnabled",void 0);c.__decorate([e.property({type:D,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],b.prototype,"popupTemplate",void 0);c.__decorate([e.property({type:A})],b.prototype,"purgeOptions",void 0);c.__decorate([e.property({types:x.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],
b.prototype,"renderer",null);c.__decorate([r.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),r.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],b.prototype,"readRenderer",null);c.__decorate([t.writer("renderer")],b.prototype,"writeRenderer",null);c.__decorate([t.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:x.webSceneRendererTypes}})],b.prototype,"writeWebSceneRenderer",null);c.__decorate([e.property(k.screenSizePerspectiveEnabled)],
b.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([e.property({type:B,json:{origins:{service:{read:{source:"spatialReference"}}}}})],b.prototype,"spatialReference",void 0);c.__decorate([e.property({json:{read:!1}})],b.prototype,"type",void 0);c.__decorate([e.property(k.url)],b.prototype,"url",void 0);c.__decorate([e.property({type:Number})],b.prototype,"updateInterval",void 0);c.__decorate([e.property({type:String})],b.prototype,"webSocketUrl",void 0);b=c.__decorate([M.subclass("esri.layers.StreamLayer")],
b);const w=N.createTypeReader({types:H.symbolTypesRenderer});return b});