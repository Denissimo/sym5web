// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(q,m){function c(d,n){n=m.getMetersPerUnitForSR(n);return d/(n*m.inchesPerMeter*96)}q.getExtentForScale=function(d,n){const e=d.extent;d=d.width;n=c(n,e.spatialReference);return e.clone().expand(n*d/e.width)};q.getResolutionForScale=c;q.getScale=function(d,n){n=n||d.extent;d=d.width;const e=m.getMetersPerUnitForSR(n&&n.spatialReference);return n&&d?n.width/d*e*m.inchesPerMeter*96:0};q.getScaleForResolution=
function(d,n){n=m.getMetersPerUnitForSR(n);return d*n*m.inchesPerMeter*96};Object.defineProperty(q,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(q,m,c,d,n,e,y,F,da,T,H,ma,fa,U,aa,V,ba){q.ArcGISMapService=g=>{g=function(B){function M(){var u=B.apply(this,arguments)||this;u.capabilities=void 0;u.copyright=null;u.fullExtent=null;u.legendEnabled=!0;u.spatialReference=null;u.version=null;return u}m._inheritsLoose(M,B);var v=M.prototype;v.readCapabilities=function(u,t){var A=t.capabilities&&t.capabilities.split(",").map(ca=>ca.toLowerCase().trim());if(!A)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var l=this.type;u=-1!==A.indexOf("query");const h=-1!==A.indexOf("map"),x=!!t.exportTilesAllowed;A=-1!==A.indexOf("tilemap");const K="tile"!==l&&!!t.supportsDynamicLayers,R="tile"!==l&&(!t.tileInfo||K),O="tile"!==l&&(!t.tileInfo||K);l="tile"!==l;const N=t.cimVersion?y.Version.parse(t.cimVersion).since(1,4):!1;return{operations:{supportsQuery:u,supportsExportMap:h,supportsExportTiles:x,supportsTileMap:A},exportMap:h?{supportsArcadeExpressionForLabeling:N,supportsSublayersChanges:l,
supportsDynamicLayers:K,supportsSublayerVisibility:R,supportsSublayerDefinitionExpression:O}:null,exportTiles:x?{maxExportTilesCount:+t.maxExportTilesCount}:null}};v.readVersion=function(u,t){(u=t.currentVersion)||(u=t.hasOwnProperty("capabilities")||t.hasOwnProperty("tables")?10:t.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return u};v.fetchSublayerInfo=function(){var u=m._asyncToGenerator(function*(t,A){yield this.fetchAllLayersAndTables(A);return this._allLayersAndTablesMap.get(t)});
return function(t,A){return u.apply(this,arguments)}}();v.fetchAllLayersAndTables=function(){var u=m._asyncToGenerator(function*(t){yield this.load(t);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=d(e.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(l=>{this._allLayersAndTablesMap=new Map;for(const h of l.data.layers)this._allLayersAndTablesMap.set(h.id,h);return{result:l.data}},l=>({error:l})));const A=
yield this._allLayersAndTablesPromise;n.throwIfAborted(t);if("result"in A)return A.result;throw A.error;});return function(t){return u.apply(this,arguments)}}();return M}(g);c.__decorate([F.property({readOnly:!0})],g.prototype,"capabilities",void 0);c.__decorate([fa.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],g.prototype,"readCapabilities",null);c.__decorate([F.property({json:{read:{source:"copyrightText"}}})],g.prototype,
"copyright",void 0);c.__decorate([F.property({type:aa})],g.prototype,"fullExtent",void 0);c.__decorate([F.property(ba.id)],g.prototype,"id",void 0);c.__decorate([F.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],g.prototype,"legendEnabled",void 0);c.__decorate([F.property(ba.popupEnabled)],g.prototype,"popupEnabled",void 0);c.__decorate([F.property({type:V})],g.prototype,"spatialReference",void 0);c.__decorate([F.property()],
g.prototype,"version",void 0);c.__decorate([fa.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],g.prototype,"readVersion",null);return g=c.__decorate([U.subclass("esri.layers.mixins.ArcGISMapService")],g)};Object.defineProperty(q,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(q,m){let c=function(){function d(e,y,F=""){this.major=e;this.minor=y;this._context=F}var n=d.prototype;n.lessThan=function(e,y){return this.major<
e||e===this.major&&this.minor<y};n.since=function(e,y){return!this.lessThan(e,y)};n.validate=function(e){if(this.major!==e.major)throw new m((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e});};n.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(e,y=""){const [F,da]=e.split(".");var T=/^\s*\d+\s*$/;if(!F||!F.match||!F.match(T))throw new m((y&&
y+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!da||!da.match||!da.match(T))throw new m((y&&y+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});e=parseInt(F,10);T=parseInt(da,10);return new d(e,T,y)};return d}();q.Version=c;Object.defineProperty(q,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(q,m,c,d,n,e,y,F,da,T,H,ma,fa,U,aa,V){function ba(v,u){const t=[],A={};if(!v)return t;v.forEach(l=>{const h=new aa;h.read(l,u);A[h.id]=h;null!=l.parentLayerId&&-1!==l.parentLayerId?(l=A[l.parentLayerId],l.sublayers||(l.sublayers=[]),l.sublayers.unshift(h)):t.unshift(h)});return t}function g(v,u){v&&v.forEach(t=>{u(t);t.sublayers&&t.sublayers.length&&g(t.sublayers,u)})}const B=y.getLogger("esri.layers.TileLayer"),M=d.ofType(aa);q.SublayersOwner=v=>{v=function(u){function t(...l){var h=u.call(this,
...l)||this;h.allSublayers=new n({getCollections:()=>[h.sublayers],getChildrenFunction(x){return x.sublayers}});h.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};h.handles.add(h.watch("sublayers",(x,K)=>h._handleSublayersChange(x,K),!0));return h}m._inheritsLoose(t,u);var A=t.prototype;A.readSublayers=function(l,h){if(h&&l){var {sublayersSourceJSON:x}=this,K=U.nameToId(h.origin);if(!(2>K||(x[K]={context:h,visibleLayers:l.visibleLayers||x[K].visibleLayers,layers:l.layers||x[K].layers},2<K))){this._set("serviceSublayers",
this.createSublayersForOrigin("service").sublayers);var {sublayers:R,origin:O}=this.createSublayersForOrigin("web-document");l=T.getProperties(this);l.setDefaultOrigin(O);this._set("sublayers",new M(R));l.setDefaultOrigin("user")}}};A.findSublayerById=function(l){return this.allSublayers.find(h=>h.id===l)};A.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};A.createSublayersForOrigin=function(l){const h="web-document"===l?U.nameToId("web-map"):U.nameToId(l);
let x=2;l=this.sublayersSourceJSON[2].layers;let K=this.sublayersSourceJSON[2].context,R=null;var O=[3,4,5].filter(I=>I<=h);for(var N of O)O=this.sublayersSourceJSON[N],V.isSublayerOverhaul(O.layers)&&(x=N,l=O.layers,K=O.context,O.visibleLayers&&(R={visibleLayers:O.visibleLayers,context:O.context}));N=[3,4,5].filter(I=>I>x&&I<=h);let ca=null;for(var W of N){const {layers:I,visibleLayers:ia,context:ja}=this.sublayersSourceJSON[W];I&&(ca={layers:I,context:ja});ia&&(R={visibleLayers:ia,context:ja})}W=
ba(l,K);const X=new Map,ka=new Set;if(ca)for(const I of ca.layers)X.set(I.id,I);if(R)for(const I of R.visibleLayers)ka.add(I);g(W,I=>{ca&&I.read(X.get(I.id),ca.context);R&&I.read({defaultVisibility:ka.has(I.id)},R.context)});return{origin:U.idToName(x),sublayers:new M({items:W})}};A.read=function(l,h){u.prototype.read.call(this,l,h);this.readSublayers(l,h)};A._handleSublayersChange=function(l,h){h&&(h.forEach(x=>{x.parent=null;x.layer=null}),this.handles.remove("sublayers-owner"));l&&(l.forEach(x=>
{x.parent=this;x.layer=this}),this.handles.add([l.on("after-add",({item:x})=>{x.parent=this;x.layer=this}),l.on("after-remove",({item:x})=>{x.parent=null;x.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(l.on("before-changes",x=>{B.error(new e("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));x.preventDefault()}),"sublayers-owner"))};return t}(v);c.__decorate([F.property({readOnly:!0})],v.prototype,"allSublayers",
void 0);c.__decorate([F.property({readOnly:!0,type:d.ofType(aa)})],v.prototype,"serviceSublayers",void 0);c.__decorate([F.property({value:null,type:M,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],v.prototype,"sublayers",void 0);c.__decorate([F.property({readOnly:!0})],v.prototype,"sublayersSourceJSON",void 0);return v=c.__decorate([fa.subclass("esri.layers.mixins.SublayersOwner")],v)};q.forEachSublayer=g;Object.defineProperty(q,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/has ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./FeatureType ./Field ./FieldsIndex ./LabelClass ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent".split(" "),
function(q,m,c,d,n,e,y,F,da,T,H,ma,fa,U,aa,V,ba,g,B,M,v,u,t,A,l,h,x,K,R,O,N,ca,W,X,ka,I,ia,ja,na,Y,k,z,G,J){function E(C){return C&&"esriSMS"===C.type}function Z(C,P,p){var a;C=this.originIdOf(P)>=ka.nameToId(p.origin);return{ignoreOrigin:!0,allowNull:C,enabled:p?"map-image"===(null==(a=p.layer)?void 0:a.type)&&(p.writeSublayerStructure||C):!1}}function S(C,P,p){var a;return{enabled:p?"tile"===(null==(a=p.layer)?void 0:a.type)&&this._isOverridden(P):!1}}function w(C,P,p){return{ignoreOrigin:!0,enabled:p&&
p.writeSublayerStructure||!1}}function L(C,P,p){return{ignoreOrigin:!0,enabled:p?p.writeSublayerStructure||this.originIdOf(P)>=ka.nameToId(p.origin):!1}}var ha;const pa=t.getLogger("esri.layers.support.Sublayer");let ra=0;const la=new Set;la.add("layer");la.add("parent");la.add("loaded");la.add("loadStatus");la.add("loadError");la.add("loadWarnings");d=ha=function(C){function P(a){a=C.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;
a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}m._inheritsLoose(P,C);var p=P.prototype;p.load=function(){var a=m._asyncToGenerator(function*(b){var f=this;this.addResolvingPromise(m._asyncToGenerator(function*(){var r;if(!f.layer&&!f.url)throw new g("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:f});let D=null;if(!f.layer||2<f.originIdOf("url")||"data-layer"===(null==(r=
f.source)?void 0:r.type))D=(yield aa(f.url,{responseType:"json",query:{f:"json"},...b})).data;else{var Q;r=f.id;"map-layer"===(null==(Q=f.source)?void 0:Q.type)&&(r=f.source.mapLayerId);D=yield f.layer.fetchSublayerInfo(r,b)}D&&(f.sourceJSON=D,f.read({layerDefinition:D},{origin:"service"}))})());return this});return function(b){return a.apply(this,arguments)}}();p.readCapabilities=function(a,b){b=b.layerDefinition||b;a=(a=b.capabilities||a)?a.toLowerCase().split(",").map(f=>f.trim()):[];return{exportMap:{supportsModification:!!b.canModifyLayer},
operations:{supportsQuery:-1!==a.indexOf("query")}}};p.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(const f of b.fields)if("esriFieldTypeGlobalID"===f.type)return f.name};p.writeLabelingInfo=function(a,b,f,r){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(D=>D.write({},r))}})};p.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};p.readMaxScale=function(a,b){return b.maxScale||
b.layerDefinition&&b.layerDefinition.maxScale||0};p.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(const f of b.fields)if("esriFieldTypeOID"===f.type)return f.name};p.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};p.writeOpacity=function(a,b,f,r){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};p.writeParent=function(a,b){b.parentLayerId=
this.parent&&this.parent!==this.layer?X.ensureInteger(this.parent.id):-1};p.castSublayers=function(a){return X.ensureType(ba.ofType(ha),a)};p.writeSublayers=function(a,b,f){this.get("sublayers.length")&&(b[f]=this.sublayers.map(r=>r.id).toArray().reverse())};p.readTypeIdField=function(a,b){b=b.layerDefinition||b;let f=b.typeIdField;f&&b.fields&&(f=f.toLowerCase(),a=b.fields.find(r=>r.name.toLowerCase()===f))&&(f=a.name);return null};p.writeVisible=function(a,b,f,r){b[f]=this.getAtOrigin("defaultVisibility",
"service")||a};p.clone=function(){const {store:a}=x.getProperties(this),b=new ha;x.getProperties(b).store=a.clone(la);this.commitProperty("url");b._lastParsedUrl=this._lastParsedUrl;return b};p.createPopupTemplate=function(a){return G.createPopupTemplate(this,a)};p.createQuery=function(){return new z({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};p.createFeatureLayer=function(){var a=m._asyncToGenerator(function*(){var b,f;if(this.hasOwnProperty("sublayers"))return null;const r=null==
(b=this.layer)?void 0:b.parsedUrl;b=new (yield new Promise(function(D,Q){q(["../FeatureLayer"],function(ea){D(Object.freeze({__proto__:null,"default":ea}))},Q)})).default({url:r.path});r&&this.source&&("map-layer"===this.source.type?b.layerId=this.source.mapLayerId:b.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(b.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(b.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&(b.labelingInfo=
v.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(b.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(b.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(b.visible=this.visible);0<this.originIdOf("minScale")&&(b.minScale=this.minScale);0<this.originIdOf("maxScale")&&(b.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(b.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(b.popupTemplate=v.clone(this.popupTemplate));2<this.originIdOf("renderer")&&
(b.renderer=v.clone(this.renderer));"data-layer"===(null==(f=this.source)?void 0:f.type)&&(b.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(b.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(b.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(b.customParameters=this.layer.customParameters);return b});return function(){return a.apply(this,arguments)}}();p.getFeatureType=
function(a){const {typeIdField:b,types:f}=this;if(!b||!a)return null;const r=a.attributes?a.attributes[b]:void 0;if(null==r)return null;let D=null;f.some(Q=>{const {id:ea}=Q;if(null==ea)return!1;ea.toString()===r.toString()&&(D=Q);return!!D});return D};p.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};p.queryFeatures=function(){var a=m._asyncToGenerator(function*(b=this.createQuery(),f){var r,D,
Q,ea;yield this.load();if(!this.get("capabilities.operations.supportsQuery"))throw new g("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:sa},{default:ta}]=yield Promise.all([new Promise(function(oa,qa){q(["../../rest/query/operations/query"],oa,qa)}),new Promise(function(oa,qa){q(["../../rest/support/FeatureSet"],function(ua){oa(Object.freeze({__proto__:null,"default":ua}))},qa)})]);b=yield sa(this.url,z.from(b),null!=(r=null==(D=this.layer)?void 0:D.spatialReference)?
r:null,{...f,query:{...null==(Q=this.layer)?void 0:Q.customParameters,token:null==(ea=this.layer)?void 0:ea.apiKey}});r=ta.fromJSON(b.data);if(null!=r&&r.features)for(const oa of r.features)oa.sourceLayer=this;return r});return function(){return a.apply(this,arguments)}}();p.toExportImageJSON=function(){var a;const b={id:this.id,source:(null==(a=this.source)?void 0:a.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(b.definitionExpression=this.definitionExpression);const f=
["renderer","labelingInfo","opacity","labelsVisible"].reduce((r,D)=>{r[D]=this.originIdOf(D);return r},{});Object.keys(f).some(r=>2<f[r])&&(a=b.drawingInfo={},2<f.renderer&&(a.renderer=this.renderer?this.renderer.toJSON():null),2<f.labelsVisible&&(a.showLabels=this.labelsVisible),this.labelsVisible&&2<f.labelingInfo&&(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(r=>r.write({},{origin:"service",layer:this.layer})):null,a.showLabels=!0),2<f.opacity&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));
return b};p._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,b=>{b.color||"esriSMSX"!==b.style&&"esriSMSCross"!==b.style||(b.color=b.outline&&b.outline.color?b.outline.color:[0,0,0,0])})};p._forEachSimpleMarkerSymbols=function(a,b){if(a){const f="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const r of f)E(r.symbol)&&b(r.symbol);"symbol"in a&&E(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&E(a.defaultSymbol)&&b(a.defaultSymbol)}};p._setAndNotifyLayer=
function(a,b){const f=this.layer,r=this._get(a);let D,Q;switch(a){case "definitionExpression":D="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":D="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":D="supportsDynamicLayers",Q="supportsModification"}const ea=x.getProperties(this).getDefaultOrigin();if("service"!==ea){if(D&&!1===this.get(`layer.capabilities.exportMap.${D}`)){this._logLockedError(a,
`capability not available 'layer.capabilities.exportMap.${D}'`);return}if(Q&&!1===this.get(`capabilities.exportMap.${Q}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${Q}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==ea&&r!==b&&f&&f.emit&&f.emit("sublayer-update",{propertyName:a,target:this}))};p._handleSublayersChange=function(a,b){b&&(b.forEach(f=>
{f.parent=null;f.layer=null}),this.handles.removeAll());a&&(a.forEach(f=>{f.parent=this;f.layer=this.layer}),this.handles.add([a.on("after-add",({item:f})=>{f.parent=this;f.layer=this.layer}),a.on("after-remove",({item:f})=>{f.parent=null;f.layer=null}),a.on("before-changes",f=>{const r=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==r||r||(pa.error(new g("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,
layer:this.layer})),f.preventDefault())})]))};p._logLockedError=function(a,b){pa.error(new g("sublayer:locked",`Property '${a}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:b,sublayer:this,layer:this.layer}))};p._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};m._createClass(P,[{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new ja(this.fields||[])}},{key:"id",
get:function(){const a=this._get("id");return null==a?ra++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",
a);this.sublayers&&this.sublayers.forEach(b=>b.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const b of a.getSymbols())if(V.isSymbol3D(b)){pa.warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new k.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){var a,b;const f=null!=(a=null==(b=this.layer)?void 0:b.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!f)return null;this._lastParsedUrl=f;if("map-layer"===(null==
a?void 0:a.type))return`${f.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${f.path}/dynamicLayer?${l.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return P}(B.HandleOwnerMixin(A.MultiOriginJSONMixin(M.IdentifiableMixin(u))));d.test={isMapImageLayerOverridePolicy:C=>C===w||C===Z,isTileImageLayerOverridePolicy:C=>C===S};c.__decorate([h.property({readOnly:!0})],
d.prototype,"capabilities",void 0);c.__decorate([N.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);c.__decorate([h.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{overridePolicy:Z}}})],d.prototype,"definitionExpression",null);c.__decorate([h.property({type:[ia],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],d.prototype,"fields",void 0);c.__decorate([h.property({readOnly:!0})],
d.prototype,"fieldsIndex",null);c.__decorate([h.property({type:J,json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);c.__decorate([h.property({type:String})],d.prototype,"globalIdField",void 0);c.__decorate([N.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);c.__decorate([h.property({type:X.Integer,json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);c.__decorate([h.property({value:null,
type:[na],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:w}}})],d.prototype,"labelingInfo",null);c.__decorate([W.writer("labelingInfo")],d.prototype,"writeLabelingInfo",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:w}}})],d.prototype,"labelsVisible",null);c.__decorate([h.property({value:null})],
d.prototype,"layer",null);c.__decorate([h.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:L}}})],d.prototype,"legendEnabled",void 0);c.__decorate([h.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);c.__decorate([h.property({type:Number,value:0,json:{write:{overridePolicy:w}}})],d.prototype,"minScale",
null);c.__decorate([N.reader("minScale",["minScale","layerDefinition.minScale"])],d.prototype,"readMinScale",null);c.__decorate([h.property({type:Number,value:0,json:{write:{overridePolicy:w}}})],d.prototype,"maxScale",null);c.__decorate([N.reader("maxScale",["maxScale","layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);c.__decorate([h.property({type:String})],d.prototype,"objectIdField",void 0);c.__decorate([N.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
d.prototype,"readObjectIdFieldFromService",null);c.__decorate([h.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:w}}})],d.prototype,"opacity",null);c.__decorate([N.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],d.prototype,"readOpacity",null);c.__decorate([W.writer("opacity")],d.prototype,"writeOpacity",null);c.__decorate([h.property({json:{type:X.Integer,write:{target:"parentLayerId",allowNull:!0,
overridePolicy:w}}})],d.prototype,"parent",void 0);c.__decorate([W.writer("parent")],d.prototype,"writeParent",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(C,P){return!P.disablePopup}},write:{target:"disablePopup",overridePolicy:L,writer(C,P,p){P[p]=!C}}}})],d.prototype,"popupEnabled",void 0);c.__decorate([h.property({type:n,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:L}}})],d.prototype,"popupTemplate",void 0);c.__decorate([h.property({readOnly:!0})],
d.prototype,"defaultPopupTemplate",null);c.__decorate([h.property({types:U.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:w},origins:{"web-scene":{types:U.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:w}}}}})],d.prototype,"renderer",null);c.__decorate([h.property({types:{key:"type",base:null,typeMap:{"data-layer":Y.DataLayerSource,"map-layer":k.MapLayerSource}},cast(C){if(C){if("mapLayerId"in C)return X.ensureClass(k.MapLayerSource,
C);if("dataSource"in C)return X.ensureClass(Y.DataLayerSource,C)}return C},json:{name:"layerDefinition.source",write:{overridePolicy:w}}})],d.prototype,"source",null);c.__decorate([h.property()],d.prototype,"sourceJSON",void 0);c.__decorate([h.property({value:null,json:{type:[X.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:w}}})],d.prototype,"sublayers",null);c.__decorate([K.cast("sublayers")],d.prototype,"castSublayers",null);c.__decorate([W.writer("sublayers")],d.prototype,"writeSublayers",
null);c.__decorate([h.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:L}}})],d.prototype,"title",void 0);c.__decorate([h.property({type:String})],d.prototype,"typeIdField",void 0);c.__decorate([N.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);c.__decorate([h.property({type:[I],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],d.prototype,"types",void 0);c.__decorate([h.property({type:String,
json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:S}}})],d.prototype,"url",null);c.__decorate([h.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:w}}})],d.prototype,"visible",null);c.__decorate([W.writer("visible")],d.prototype,"writeVisible",null);return d=ha=c.__decorate([ca.subclass("esri.layers.support.Sublayer")],d)})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(q){function m(c,
d){if(!c||!c.length)return!0;d=d.slice().reverse().flatten(({sublayers:y})=>y&&y.toArray().reverse()).map(y=>y.id).toArray();if(c.length>d.length)return!1;let n=0;const e=d.length;for(const {id:y}of c){for(;n<e&&d[n]!==y;)n++;if(n>=e)return!1}return!0}q.isExportDynamic=function(c,d,n){return c.some(e=>{const y=e.source;return!(!y||"map-layer"===y.type&&y.mapLayerId===e.id&&(!y.gdbVersion||y.gdbVersion===n.gdbVersion))||2<e.originIdOf("renderer")||2<e.originIdOf("labelingInfo")||2<e.originIdOf("opacity")||
2<e.originIdOf("labelsVisible")})?!0:!m(c,d)};q.isSublayerOverhaul=function(c){return!!c&&c.some(d=>null!=d.minScale||d.layerDefinition&&null!=d.layerDefinition.minScale)};q.shouldWriteSublayerStructure=function(c,d,n){return d.flatten(({sublayers:e})=>e).length!==c.length||c.some(e=>e.originIdOf("minScale")>n||e.originIdOf("maxScale")>n||e.originIdOf("renderer")>n||e.originIdOf("labelingInfo")>n||e.originIdOf("opacity")>n||e.originIdOf("labelsVisible")>n||e.originIdOf("source")>n)?!0:!m(c,d)};Object.defineProperty(q,
"__esModule",{value:!0})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./commonProperties ./sublayerUtils".split(" "),function(q,m,c,d,n,e,y,F,da,T,H,ma,fa){const U={visible:"visibleSublayers",
definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};q.ExportImageParameters=function(aa){function V(g){g=aa.call(this,g)||this;g.scale=0;return g}m._inheritsLoose(V,aa);var ba=V.prototype;ba.destroy=function(){this.layer=null};ba.toJSON=function(){var g=this.layer;g={dpi:g.dpi,format:g.imageFormat,transparent:g.imageTransparency,
gdbVersion:g.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?g.dynamicLayers=this.dynamicLayers:g={...g,layers:this.layers,layerDefs:this.layerDefs};return g};m._createClass(V,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const g=this.visibleSublayers.map(B=>B.toExportImageJSON());return g.length?JSON.stringify(g):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&fa.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},
{key:"layer",set:function(g){this._get("layer")!==g&&(this._set("layer",g),this.handles.remove("layer"),g&&this.handles.add([g.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),g.on("sublayer-update",B=>this.notifyChange(U[B.propertyName]))],"layer"))}},{key:"layers",get:function(){const g=this.visibleSublayers;return g?g.length?"show:"+g.map(B=>B.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){const g=this.visibleSublayers.filter(B=>null!=B.definitionExpression);
return g.length?JSON.stringify(g.reduce((B,M)=>{B[M.id]=M.definitionExpression;return B},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");this.commitProperty("timeExtent");const g=this.layer;g&&(g.commitProperty("dpi"),g.commitProperty("imageFormat"),g.commitProperty("imageTransparency"),g.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const g=[];if(!this.layer)return g;
var B=this.layer.sublayers;const M=v=>{const u=this.scale,t=0===v.minScale||u<=v.minScale,A=0===v.maxScale||u>=v.maxScale;v.visible&&(0===u||t&&A)&&(v.sublayers?v.sublayers.forEach(M):g.unshift(v))};B&&B.forEach(M);B=this._get("visibleSublayers");return!B||B.length!==g.length||B.some((v,u)=>g[u]!==v)?g:B}}]);return V}(n.HandleOwnerMixin(d));c.__decorate([e.property({readOnly:!0})],q.ExportImageParameters.prototype,"dynamicLayers",null);c.__decorate([e.property({readOnly:!0})],q.ExportImageParameters.prototype,
"hasDynamicLayers",null);c.__decorate([e.property()],q.ExportImageParameters.prototype,"layer",null);c.__decorate([e.property({readOnly:!0})],q.ExportImageParameters.prototype,"layers",null);c.__decorate([e.property({readOnly:!0})],q.ExportImageParameters.prototype,"layerDefs",null);c.__decorate([e.property({type:Number})],q.ExportImageParameters.prototype,"scale",void 0);c.__decorate([e.property(ma.combinedViewLayerTimeExtentProperty)],q.ExportImageParameters.prototype,"timeExtent",void 0);c.__decorate([e.property({readOnly:!0})],
q.ExportImageParameters.prototype,"version",null);c.__decorate([e.property({readOnly:!0})],q.ExportImageParameters.prototype,"visibleSublayers",null);q.ExportImageParameters=c.__decorate([H.subclass("esri.layers.mixins.ExportImageParameters")],q.ExportImageParameters);Object.defineProperty(q,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../TimeExtent ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/Sublayer ./support/sublayerUtils".split(" "),function(q,
m,c,d,n,e,y,F,da,T,H,ma,fa,U,aa,V,ba,g,B,M,v,u,t,A,l,h,x,K,R,O,N,ca,W,X,ka,I,ia){e=function(ja){function na(...k){k=ja.call(this,...k)||this;k.alwaysRefetch=!1;k.dpi=96;k.gdbVersion=null;k.imageFormat="png24";k.imageMaxHeight=2048;k.imageMaxWidth=2048;k.imageTransparency=!0;k.isReference=null;k.labelsVisible=!1;k.operationalLayerType="ArcGISMapServiceLayer";k.sourceJSON=null;k.sublayers=null;k.type="map-image";k.url=null;return k}q._inheritsLoose(na,ja);var Y=na.prototype;Y.normalizeCtorArgs=function(k,
z){return"string"===typeof k?{url:k,...z}:k};Y.load=function(k){const z=F.isSome(k)?k.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},k).catch(T.throwIfAbortError).then(()=>this._fetchService(z)));return Promise.resolve(this)};Y.readImageFormat=function(k,z){return(k=z.supportedImageFormatTypes)&&-1<k.indexOf("PNG32")?"png32":"png24"};Y.writeSublayers=function(k,z,G,J){if(this.loaded&&k){k=k.slice().reverse().flatten(({sublayers:w})=>w&&w.toArray().reverse()).toArray();
G=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const w=B.nameToId(J.origin);3===w?(G=this.createSublayersForOrigin("service").sublayers,G=ia.shouldWriteSublayerStructure(k,G,2)):3<w&&(G=this.createSublayersForOrigin("portal-item"),G=ia.shouldWriteSublayerStructure(k,G.sublayers,B.nameToId(G.origin)))}var E=[],Z={writeSublayerStructure:G,...J},S=G;k.forEach(w=>{const L=w.write({},Z);E.push(L);S=S||"user"===w.originOf("visible")});
E.some(w=>1<Object.keys(w).length)&&(z.layers=E);S&&(z.visibleLayers=k.filter(w=>w.visible).map(w=>w.id))}};Y.createExportImageParameters=function(k,z,G,J){var E=J&&J.pixelRatio||1;k&&10<=this.version&&(k=k.clone().shiftCentralMeridian());var Z=new ka.ExportImageParameters({layer:this,scale:v.getScale({extent:k,width:z})*E});const S=Z.toJSON();Z.destroy();Z=!J||!J.rotation||10.3>this.version?{}:{rotation:-J.rotation};var w=k&&k.spatialReference;w=w.wkid||JSON.stringify(w.toJSON());S.dpi*=E;E={};if(null!=
J&&J.timeExtent){const {start:L,end:ha}=J.timeExtent.toJSON();E.time=L&&ha&&L===ha?""+L:`${null==L?"null":L},${null==ha?"null":ha}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(E.time="null,null");return{bbox:k&&k.xmin+","+k.ymin+","+k.xmax+","+k.ymax,bboxSR:w,imageSR:w,size:z+","+G,...S,...Z,...E}};Y.fetchImage=function(){var k=q._asyncToGenerator(function*(z,G,J,E){var Z,S;z={responseType:"image",signal:null!=(Z=null==E?void 0:E.signal)?Z:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(z,
G,J,E),f:"image",_ts:this.alwaysRefetch?Date.now():null!=(S=null==E?void 0:E.timestamp)?S:null,...this.customParameters,token:this.apiKey}};const w=this.parsedUrl.path+"/export";return null==z.query.dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers?c(w,z).then(L=>L.data).catch(L=>{if(T.isAbortError(L))throw L;throw new n("mapimagelayer:image-fetch-error",`Unable to load image: ${w}`,{error:L});}):Promise.reject(new n("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,
{query:z.query}))});return function(z,G,J,E){return k.apply(this,arguments)}}();Y.fetchRecomputedExtents=function(){var k=q._asyncToGenerator(function*(z={}){({data:z}=yield c(this.url,{...z,query:{returnUpdates:!0,f:"json"}}));const {extent:G,fullExtent:J,timeExtent:E}=z;z=G||J;return{fullExtent:z&&M.fromJSON(z),timeExtent:E&&d.fromJSON({start:E[0],end:E[1]})}});return function(){return k.apply(this,arguments)}}();Y.loadAll=function(){return y.loadAll(this,k=>{k(this.allSublayers)})};Y._fetchService=
function(){var k=q._asyncToGenerator(function*(z){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:G,ssl:J}=yield c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:z});J&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=G;this.read(G,{origin:"service",url:this.parsedUrl})}});return function(z){return k.apply(this,arguments)}}();return na}(h.BlendLayer(W.TemporalLayer(N.ScaleRangeLayer(O.RefreshableLayer(ca.SublayersOwner(A.ArcGISMapService(l.ArcGISService(K.OperationalLayer(R.PortalLayer(da.MultiOriginJSONMixin(t.APIKeyMixin(x.CustomParametersMixin(e.HandleOwnerMixin(u))))))))))))));
m.__decorate([H.property()],e.prototype,"alwaysRefetch",void 0);m.__decorate([H.property()],e.prototype,"dpi",void 0);m.__decorate([H.property()],e.prototype,"gdbVersion",void 0);m.__decorate([H.property()],e.prototype,"imageFormat",void 0);m.__decorate([V.reader("imageFormat",["supportedImageFormatTypes"])],e.prototype,"readImageFormat",null);m.__decorate([H.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],e.prototype,"imageMaxHeight",void 0);m.__decorate([H.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],
e.prototype,"imageMaxWidth",void 0);m.__decorate([H.property()],e.prototype,"imageTransparency",void 0);m.__decorate([H.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);m.__decorate([H.property({json:{read:!1,write:!1}})],e.prototype,"labelsVisible",void 0);m.__decorate([H.property({type:["ArcGISMapServiceLayer"]})],e.prototype,"operationalLayerType",void 0);m.__decorate([H.property({json:{read:!1,write:!1}})],e.prototype,
"popupEnabled",void 0);m.__decorate([H.property()],e.prototype,"sourceJSON",void 0);m.__decorate([H.property({json:{write:{ignoreOrigin:!0}}})],e.prototype,"sublayers",void 0);m.__decorate([g.writer("sublayers",{layers:{type:[I]},visibleLayers:{type:[fa.Integer]}})],e.prototype,"writeSublayers",null);m.__decorate([H.property({type:["show","hide","hide-children"]})],e.prototype,"listMode",void 0);m.__decorate([H.property({json:{read:!1},readOnly:!0,value:"map-image"})],e.prototype,"type",void 0);m.__decorate([H.property(X.url)],
e.prototype,"url",void 0);return e=m.__decorate([ba.subclass("esri.layers.MapImageLayer")],e)});