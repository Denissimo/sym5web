// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../Graphic ../symbols ../core/Collection ../core/Error ../core/lang ../core/maybe ../core/MultiOriginJSONSupport ../core/object ../core/Warning ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/has ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/projection ../geometry/support/normalizeUtils ../geometry/support/spatialReferenceUtils ./FeatureLayer ./GraphicsLayer ./Layer ./graphics/objectIdUtils ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/Field ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../symbols/TextSymbol ../geometry/Extent ../geometry/SpatialReference".split(" "),
function(w,d,e,M,fa,D,N,E,r,O,P,H,k,ha,ia,ja,ka,t,I,Q,z,R,S,T,U,V,W,X,Y,Z,aa,J,ba,ca,K,da,F,x){function A(u){return u.layers.some(q=>null!=q.layerDefinition.visibilityField)}const L=new J({name:"OBJECTID",alias:"OBJECTID",type:"oid",nullable:!1,editable:!1}),ea=new J({name:"title",alias:"Title",type:"string",nullable:!0,editable:!0});let v=function(u){function q(){var h=u.apply(this,arguments)||this;h.visibilityMode="inherited";return h}w._inheritsLoose(q,u);q.prototype.initialize=function(){for(const h of this.graphics)h.sourceLayer=
this.layer;this.graphics.on("after-add",h=>{h.item.sourceLayer=this.layer});this.graphics.on("after-remove",h=>{h.item.sourceLayer=null})};w._createClass(q,[{key:"sublayers",get:function(){return this.graphics}}]);return q}(U);d.__decorate([k.property({readOnly:!0})],v.prototype,"sublayers",null);d.__decorate([k.property()],v.prototype,"layer",void 0);d.__decorate([k.property({readOnly:!0})],v.prototype,"visibilityMode",void 0);v=d.__decorate([I.subclass("esri.layers.MapNotesLayer.MapNotesSublayer")],
v);const G=[{geometryType:"polygon",geometryTypeJSON:"esriGeometryPolygon",layerId:"polygonLayer",title:"Polygons",identifyingSymbol:(new ba).toJSON()},{geometryType:"polyline",geometryTypeJSON:"esriGeometryPolyline",layerId:"polylineLayer",title:"Polylines",identifyingSymbol:(new ca).toJSON()},{geometryType:"multipoint",geometryTypeJSON:"esriGeometryMultipoint",layerId:"multipointLayer",title:"Multipoints",identifyingSymbol:(new K).toJSON()},{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",
layerId:"pointLayer",title:"Points",identifyingSymbol:(new K).toJSON()},{geometryType:"point",geometryTypeJSON:"esriGeometryPoint",layerId:"textLayer",title:"Text",identifyingSymbol:(new da).toJSON()}];e=function(u){function q(b){var a=u.call(this,b)||this;a.capabilities={operations:{supportsMapNotesEditing:!0}};a.featureCollections=null;a.featureCollectionJSON=null;a.featureCollectionType="notes";a.legendEnabled=!1;a.minScale=0;a.maxScale=0;a.spatialReference=x.WGS84;a.sublayers=new D(G.map(c=>new v({id:c.layerId,
title:c.title,layer:w._assertThisInitialized(a)})));a.title="Map Notes";a.type="map-notes";a.visibilityMode="inherited";return a}w._inheritsLoose(q,u);var h=q.prototype;h.readCapabilities=function(b,a,c){return{operations:{supportsMapNotesEditing:!A(a)&&"portal-item"!==(null==c?void 0:c.origin)}}};h.readFeatureCollections=function(b,a,c){if(!A(a))return null;b=a.layers.map(f=>{const g=new T;g.read(f,c);return g});return new D({items:b})};h.readLegacyfeatureCollectionJSON=function(b,a){return A(a)?
E.clone(a.featureCollection):null};h.readFullExtent=function(b,a){if(!a.layers.length)return new F({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:x.WGS84});b=x.fromJSON(a.layers[0].layerDefinition.spatialReference);return a.layers.reduce((c,f)=>(f=f.layerDefinition.extent)?F.fromJSON(f).union(c):c,new F({spatialReference:b}))};h.readMinScale=function(b,a){for(const c of a.layers)if(null!=c.layerDefinition.minScale)return c.layerDefinition.minScale;return 0};h.readMaxScale=function(b,a){for(const c of a.layers)if(null!=
c.layerDefinition.maxScale)return c.layerDefinition.maxScale;return 0};h.readSpatialReference=function(b,a){return a.layers.length?x.fromJSON(a.layers[0].layerDefinition.spatialReference):x.WGS84};h.readSublayers=function(b,a,c){if(A(a))return null;b=[];for(c=0;c<a.layers.length;c++){var f;const {layerDefinition:l,featureSet:m}=a.layers[c],p=null!=(f=l.geometryType)?f:m.geometryType;var g=G.find(n=>{var y,B,C;return p===n.geometryTypeJSON&&(null==(y=l.drawingInfo)?void 0:null==(B=y.renderer)?void 0:
null==(C=B.symbol)?void 0:C.type)===n.identifyingSymbol.type});g&&(g=new v({id:g.layerId,title:l.name,layer:this,graphics:m.features.map(({geometry:n,symbol:y,attributes:B,popupInfo:C})=>M.fromJSON({attributes:B,geometry:n,symbol:y,popupTemplate:C}))}),b.push(g))}return new D(b)};h.writeSublayers=function(b,a,c,f){const {minScale:g,maxScale:l}=this;if(!r.isNone(b))if(c=b.some(n=>0<n.graphics.length),this.capabilities.operations.supportsMapNotesEditing){var m=[];c=this.spatialReference.toJSON();a:for(var p of b)for(const n of p.graphics)if(r.isSome(n.geometry)){c=
n.geometry.spatialReference.toJSON();break a}for(const n of G)p=b.find(y=>n.layerId===y.id),this._writeMapNoteSublayer(m,p,n,g,l,c,f);P.setDeepValue("featureCollection.layers",m,a)}else c&&(null==f?void 0:null==(m=f.messages)?void 0:m.push(new N("map-notes-layer:editing-not-supported","New map notes cannot be added to this layer")))};h.load=function(b){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Collection"]},b));return Promise.resolve(this)};h.read=function(b,a){"featureCollection"in
b&&(b=E.clone(b),Object.assign(b,b.featureCollection));u.prototype.read.call(this,b,a)};h.beforeSave=function(){var b=w._asyncToGenerator(function*(){if(!r.isNone(this.sublayers)){var a=null,c=[];for(const g of this.sublayers)for(const l of g.graphics)if(r.isSome(l.geometry)){const m=l.geometry;a?S.equals(m.spatialReference,a)||(z.canProjectWithoutEngine(m.spatialReference,a)||z.isLoaded()||(yield z.load()),l.geometry=z.project(m,a)):a=m.spatialReference;c.push(l)}var f=yield R.normalizeCentralMeridian(c.map(g=>
g.geometry));c.forEach((g,l)=>g.geometry=f[l])}});return function(){return b.apply(this,arguments)}}();h._findSublayer=function(b){var a,c;return r.isNone(this.sublayers)?null:null!=(a=null==(c=this.sublayers)?void 0:c.find(f=>f.id===b))?a:null};h._writeMapNoteSublayer=function(b,a,c,f,g,l,m){const p=[];if(!r.isNone(a)){for(const n of a.graphics)this._writeMapNote(p,n,c.geometryType,m);this._normalizeObjectIds(p,L);b.push({layerDefinition:{name:a.title,drawingInfo:{renderer:{type:"simple",symbol:E.clone(c.identifyingSymbol)}},
geometryType:c.geometryTypeJSON,minScale:f,maxScale:g,objectIdField:"OBJECTID",fields:[L.toJSON(),ea.toJSON()],spatialReference:l},featureSet:{features:p,geometryType:c.geometryTypeJSON}})}};h._writeMapNote=function(b,a,c,f){if(!r.isNone(a)){var {geometry:g,symbol:l,popupTemplate:m}=a;if(!r.isNone(g))if(g.type!==c){var p;null==f?void 0:null==(p=f.messages)?void 0:p.push(new H("map-notes-layer:invalid-geometry-type",`Geometry "${g.type}" cannot be saved in "${c}" layer`,{graphic:a}))}else if(r.isNone(l)){var n;
null==f?void 0:null==(n=f.messages)?void 0:n.push(new H("map-notes-layer:no-symbol","Skipping map notes with no symbol",{graphic:a}))}else a={attributes:{...a.attributes},geometry:g.toJSON(),symbol:l.toJSON()},r.isSome(m)&&(a.popupInfo=m.toJSON()),b.push(a)}};h._normalizeObjectIds=function(b,a){a=a.name;let c=W.findLastObjectIdFromFeatures(a,b)+1;const f=new Set;for(const g of b){g.attributes||(g.attributes={});({attributes:b}=g);if(null==b[a]||f.has(b[a]))b[a]=c++;f.add(b[a])}};w._createClass(q,
[{key:"multipointLayer",get:function(){return this._findSublayer("multipointLayer")}},{key:"pointLayer",get:function(){return this._findSublayer("pointLayer")}},{key:"polygonLayer",get:function(){return this._findSublayer("polygonLayer")}},{key:"polylineLayer",get:function(){return this._findSublayer("polylineLayer")}},{key:"textLayer",get:function(){return this._findSublayer("textLayer")}}]);return q}(X.BlendLayer(aa.ScaleRangeLayer(Y.OperationalLayer(Z.PortalLayer(O.MultiOriginJSONMixin(V))))));
d.__decorate([k.property({readOnly:!0})],e.prototype,"capabilities",void 0);d.__decorate([t.reader(["portal-item","web-map"],"capabilities",["layers"])],e.prototype,"readCapabilities",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"featureCollections",void 0);d.__decorate([t.reader(["web-map","portal-item"],"featureCollections",["layers"])],e.prototype,"readFeatureCollections",null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{enabled:!0,target:"featureCollection"}}}}})],
e.prototype,"featureCollectionJSON",void 0);d.__decorate([t.reader(["web-map","portal-item"],"featureCollectionJSON",["featureCollection"])],e.prototype,"readLegacyfeatureCollectionJSON",null);d.__decorate([k.property({readOnly:!0,json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],e.prototype,"featureCollectionType",void 0);d.__decorate([k.property({json:{write:!1}})],e.prototype,"fullExtent",void 0);d.__decorate([t.reader(["web-map","portal-item"],"fullExtent",["layers"])],e.prototype,"readFullExtent",
null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{target:"featureCollection.showLegend",overridePolicy(){return{enabled:null!=this.featureCollectionJSON}}}}}}})],e.prototype,"legendEnabled",void 0);d.__decorate([k.property({type:["show","hide"]})],e.prototype,"listMode",void 0);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!1}})],e.prototype,"minScale",void 0);d.__decorate([t.reader(["web-map","portal-item"],"minScale",["layers"])],e.prototype,"readMinScale",
null);d.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!1}})],e.prototype,"maxScale",void 0);d.__decorate([t.reader(["web-map","portal-item"],"maxScale",["layers"])],e.prototype,"readMaxScale",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"multipointLayer",null);d.__decorate([k.property({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],e.prototype,"operationalLayerType",void 0);d.__decorate([k.property({readOnly:!0})],e.prototype,"pointLayer",null);d.__decorate([k.property({readOnly:!0})],
e.prototype,"polygonLayer",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"polylineLayer",null);d.__decorate([k.property({type:x})],e.prototype,"spatialReference",void 0);d.__decorate([t.reader(["web-map","portal-item"],"spatialReference",["layers"])],e.prototype,"readSpatialReference",null);d.__decorate([k.property({readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],e.prototype,"sublayers",void 0);d.__decorate([t.reader("web-map","sublayers",["layers"])],e.prototype,
"readSublayers",null);d.__decorate([Q.writer("web-map","sublayers")],e.prototype,"writeSublayers",null);d.__decorate([k.property({readOnly:!0})],e.prototype,"textLayer",null);d.__decorate([k.property()],e.prototype,"title",void 0);d.__decorate([k.property({readOnly:!0,json:{read:!1}})],e.prototype,"type",void 0);return e=d.__decorate([I.subclass("esri.layers.MapNotesLayer")],e)});