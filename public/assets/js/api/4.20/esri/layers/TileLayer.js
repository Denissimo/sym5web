// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(p,
q,e,h,y,t,E,u,N,z,A,R,G,a){p.ArcGISCachedService=b=>{b=function(n){function J(){var M=n.apply(this,arguments)||this;M.copyright=null;M.minScale=0;M.maxScale=0;M.spatialReference=null;M.tileInfo=null;M.tilemapCache=null;return M}q._inheritsLoose(J,n);var x=J.prototype;x.readMinScale=function(M,L){return null!=L.minLOD&&null!=L.maxLOD?M:0};x.readMaxScale=function(M,L){return null!=L.minLOD&&null!=L.maxLOD?M:0};x.readTilemapCache=function(M,L){return L.capabilities&&-1<L.capabilities.indexOf("Tilemap")?
new G.TilemapCache({layer:this}):null};q._createClass(J,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return J}(b);e.__decorate([y.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);e.__decorate([y.property()],b.prototype,"minScale",void 0);e.__decorate([z.reader("service","minScale")],b.prototype,"readMinScale",null);e.__decorate([y.property()],b.prototype,"maxScale",void 0);e.__decorate([z.reader("service","maxScale")],b.prototype,"readMaxScale",
null);e.__decorate([y.property({type:a})],b.prototype,"spatialReference",void 0);e.__decorate([y.property({readOnly:!0})],b.prototype,"supportsBlankTile",null);e.__decorate([y.property(R.serviceTileInfoProperty)],b.prototype,"tileInfo",void 0);e.__decorate([y.property()],b.prototype,"tilemapCache",void 0);e.__decorate([z.reader("service","tilemapCache",["capabilities"])],b.prototype,"readTilemapCache",null);e.__decorate([y.property()],b.prototype,"version",void 0);return b=e.__decorate([A.subclass("esri.layers.mixins.ArcGISCachedService")],
b)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(p,q){function e(y,t,E,u){if(!y)return null;const {minScale:N,maxScale:z,minLOD:A,maxLOD:R}=t;if(null!=A&&null!=R)return u&&u.ignoreMinMaxLOD?q.fromJSON(y):q.fromJSON({...y,lods:y.lods.filter(({level:G})=>null!=G&&G>=A&&G<=R)});if(0!==N&&0!==z){const G=N?Math.round(1E4*N)/1E4:Infinity,a=z?Math.round(1E4*z)/1E4:-Infinity;return q.fromJSON({...y,lods:y.lods.filter(b=>
{b=Math.round(1E4*b.scale)/1E4;return b<=G&&b>=a})})}return q.fromJSON(y)}const h={type:q,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:e}}}}};p.readServiceTileInfo=e;p.serviceTileInfoProperty=h;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(p,q,e,h,y,t,E,u,N,z,A,R,G,a,b,n,J,x){var M;e=new e.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});h=M=function(L){function H(f){f=L.call(this,f)||this;f.dpi=96;f.format=null;f.origin=null;f.minScale=0;f.maxScale=0;f.size=null;f.spatialReference=null;return f}p._inheritsLoose(H,L);H.create=function(f=
{}){const {resolutionFactor:m=1,scales:k,size:c=256,spatialReference:l=a.WebMercator,numLODs:B=24}=f;if(!n.isValid(l)){f=[];if(k)for(var v=0;v<k.length;v++){var D=k[v];f.push({level:v,scale:D,resolution:D})}else for(v=5E-4,D=B-1;0<=D;D--)f.unshift({level:D,scale:v,resolution:v}),v*=2;return new M({dpi:96,lods:f,origin:new G(0,0,l),size:[c,c],spatialReference:l})}v=n.getInfo(l);f=f.origin?new G({x:f.origin.x,y:f.origin.y,spatialReference:l}):v?new G({x:v.origin[0],y:v.origin[1],spatialReference:l}):
new G({x:0,y:0,spatialReference:l});v=1/(39.37*y.getMetersPerUnitForSR(l)*96);D=[];if(k)for(var O=0;O<k.length;O++){var T=k[O];D.push({level:O,scale:T,resolution:T*v})}else{var P=n.isGeographic(l)?512/c*5.916575275917094E8:256/c*5.91657527591555E8;O=Math.ceil(B/m);D.push({level:0,scale:P,resolution:P*v});for(T=1;T<O;T++)P/=2**m,D.push({level:T,scale:P,resolution:P*v})}return new M({dpi:96,lods:D,origin:f,size:[c,c],spatialReference:l})};var C=H.prototype;C.readOrigin=function(f,m){return G.fromJSON({spatialReference:m.spatialReference,
...f})};C.readSize=function(f,m){return[m.cols,m.rows]};C.writeSize=function(f,m){m.cols=f[0];m.rows=f[0]};C.zoomToScale=function(f){const m=this.scales;if(0>=f)return m[0];if(f>=m.length-1)return m[m.length-1];{const k=Math.floor(f);return m[k]/(m[k]/m[k+1])**(f-k)}};C.scaleToZoom=function(f){const m=this.scales,k=m.length-1;let c=0;for(;c<k;c++){const l=m[c],B=m[c+1];if(l<=f)break;if(B===f)return c+1;if(l>f&&B<f)return c+Math.log(l/f)/Math.log(l/B)}return c};C.snapScale=function(f,m=.95){f=this.scaleToZoom(f);
return f%Math.floor(f)>=m?this.zoomToScale(Math.ceil(f)):this.zoomToScale(Math.floor(f))};C.tileAt=function(f,m,k,c){var l=this.lodAt(f);if(!l)return null;let B;if("number"===typeof m)B=m,m=k;else{if(n.equals(m.spatialReference,this.spatialReference))B=m.x,m=m.y;else{c=J.project(m,this.spatialReference);if(!c)return null;B=c.x;m=c.y}c=k}k=l.resolution*this.size[0];l=l.resolution*this.size[1];c||(c={id:null,level:0,row:0,col:0,extent:b.create()});c.level=f;c.row=Math.floor((this.origin.y-m)/l+.001);
c.col=Math.floor((B-this.origin.x)/k+.001);this.updateTileInfo(c);return c};C.updateTileInfo=function(f,m=0){var k=this.lodAt(f.level);k||1!==m||(m=this.lods[this.lods.length-1],m.level<f.level&&(k=m));if(k){var c=f.level-k.level;m=k.resolution*this.size[0]/2**c;k=k.resolution*this.size[1]/2**c;f.id=`${f.level}/${f.row}/${f.col}`;f.extent||(f.extent=b.create());f.extent[0]=this.origin.x+f.col*m;f.extent[1]=this.origin.y-(f.row+1)*k;f.extent[2]=f.extent[0]+m;f.extent[3]=f.extent[1]+k}};C.upsampleTile=
function(f){const m=this._upsampleLevels[f.level];if(!m||-1===m.parentLevel)return!1;f.level=m.parentLevel;f.row=Math.floor(f.row/m.factor+.001);f.col=Math.floor(f.col/m.factor+.001);this.updateTileInfo(f);return!0};C.getTileBounds=function(f,m){var {resolution:k}=this.lodAt(m.level);const c=k*this.size[0];k*=this.size[1];f[0]=this.origin.x+m.col*c;f[1]=this.origin.y-(m.row+1)*k;f[2]=f[0]+c;f[3]=f[1]+k;return f};C.lodAt=function(f){return this._levelToLOD&&this._levelToLOD[f]||null};C.clone=function(){return M.fromJSON(this.write({}))};
C._initializeUpsampleLevels=function(){const f=this.lods;this._upsampleLevels=[];let m=null;for(let k=0;k<f.length;k++){const c=f[k];this._upsampleLevels[c.level]={parentLevel:m?m.level:-1,factor:m?m.resolution/c.resolution:0};m=c}};p._createClass(H,[{key:"isWrappable",get:function(){const {spatialReference:f,origin:m}=this;if(f&&m){const k=n.getInfo(f);return f.isWrappable&&Math.abs(k.origin[0]-m.x)<=k.dx}return!1}},{key:"lods",set:function(f){let m=0,k=0;const c=[];this._levelToLOD={};f&&(m=-Infinity,
k=Infinity,f.forEach(l=>{c.push(l.scale);m=l.scale>m?l.scale:m;k=l.scale<k?l.scale:k;this._levelToLOD[l.level]=l}));this._set("scales",c);this._set("minScale",m);this._set("maxScale",k);this._set("lods",f);this._initializeUpsampleLevels()}}]);return H}(h.JSONSupport);q.__decorate([t.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);q.__decorate([t.property({type:Number,json:{write:!0}})],h.prototype,"dpi",void 0);q.__decorate([t.property({type:String,json:{read:e.read,
write:e.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);q.__decorate([t.property({readOnly:!0})],h.prototype,"isWrappable",null);q.__decorate([t.property({type:G,json:{write:!0}})],h.prototype,"origin",void 0);q.__decorate([z.reader("origin")],h.prototype,"readOrigin",null);q.__decorate([t.property({type:[x],value:null,json:{write:!0}})],h.prototype,"lods",null);q.__decorate([t.property({readOnly:!0})],h.prototype,"minScale",void 0);q.__decorate([t.property({readOnly:!0})],
h.prototype,"maxScale",void 0);q.__decorate([t.property({readOnly:!0})],h.prototype,"scales",void 0);q.__decorate([t.property({cast:L=>Array.isArray(L)?L:"number"===typeof L?[L,L]:[256,256]})],h.prototype,"size",void 0);q.__decorate([z.reader("size",["rows","cols"])],h.prototype,"readSize",null);q.__decorate([R.writer("size",{cols:{type:u.Integer},rows:{type:u.Integer}})],h.prototype,"writeSize",null);q.__decorate([t.property({type:a,json:{write:!0}})],h.prototype,"spatialReference",void 0);return h=
M=q.__decorate([A.subclass("esri.layers.support.TileInfo")],h)})},"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../../core/maybe","../Extent"],function(p,q,e,h){function y(a=G){return[a[0],a[1],a[2],a[3]]}function t(a){return a[0]>=a[2]?0:a[2]-a[0]}function E(a){return a[1]>=a[3]?0:a[3]-a[1]}function u(a,b,n){return b>=a[0]&&n>=a[1]&&b<=a[2]&&n<=a[3]}function N(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a}function z(a){return 4===a.length}function A(a,
b,n){return a<b?b:a>n?n:a}const R=[Infinity,Infinity,-Infinity,-Infinity],G=[0,0,0,0];p.NEGATIVE_INFINITY=R;p.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];p.UNIT=[0,0,1,1];p.ZERO=G;p.allFinite=function(a){for(let b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};p.area=function(a){return t(a)*E(a)};p.center=function(a,b=[0,0]){b[0]=(a[0]+a[2])/2;b[1]=(a[1]+a[3])/2;return b};p.clone=function(a){return[a[0],a[1],a[2],a[3]]};p.contains=function(a,b){return b[0]>=a[0]&&b[2]<=a[2]&&b[1]>=
a[1]&&b[3]<=a[3]};p.containsPoint=function(a,b){return u(a,b[0],b[1])};p.containsPointObject=function(a,b){return u(a,b.x,b.y)};p.containsPointWithMargin=function(a,b,n){return b[0]>=a[0]-n&&b[1]>=a[1]-n&&b[0]<=a[2]+n&&b[1]<=a[3]+n};p.containsXY=u;p.create=y;p.diameter=function(a){const b=t(a);a=E(a);return Math.sqrt(b*b+a*a)};p.distance=function(a,b){const n=(a[1]+a[3])/2,J=Math.max(Math.abs(b[0]-(a[0]+a[2])/2)-t(a)/2,0);a=Math.max(Math.abs(b[1]-n)-E(a)/2,0);return Math.sqrt(J*J+a*a)};p.empty=function(a){return a?
N(a,R):y(R)};p.equals=function(a,b,n){if(e.isNone(a)||e.isNone(b))return a===b;if(!z(a)||!z(b))return!1;if(n)for(let J=0;J<a.length;J++){if(!n(a[J],b[J]))return!1}else for(n=0;n<a.length;n++)if(a[n]!==b[n])return!1;return!0};p.expand=function(a,b,n=a){if("length"in b)if(z(b))n[0]=Math.min(a[0],b[0]),n[1]=Math.min(a[1],b[1]),n[2]=Math.max(a[2],b[2]),n[3]=Math.max(a[3],b[3]);else{if(2===b.length||3===b.length)n[0]=Math.min(a[0],b[0]),n[1]=Math.min(a[1],b[1]),n[2]=Math.max(a[2],b[0]),n[3]=Math.max(a[3],
b[1])}else switch(b.type){case "extent":n[0]=Math.min(a[0],b.xmin);n[1]=Math.min(a[1],b.ymin);n[2]=Math.max(a[2],b.xmax);n[3]=Math.max(a[3],b.ymax);break;case "point":n[0]=Math.min(a[0],b.x),n[1]=Math.min(a[1],b.y),n[2]=Math.max(a[2],b.x),n[3]=Math.max(a[3],b.y)}return n};p.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])};p.expandWithNestedArray=function(a,b,n=a){const J=b.length;let x=a[0],M=a[1],L=a[2];a=a[3];for(let H=
0;H<J;H++){const C=b[H];x=Math.min(x,C[0]);M=Math.min(M,C[1]);L=Math.max(L,C[0]);a=Math.max(a,C[1])}n[0]=x;n[1]=M;n[2]=L;n[3]=a;return n};p.fromExtent=function(a,b=y()){b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;return b};p.fromValues=function(a,b,n,J,x=y()){x[0]=a;x[1]=b;x[2]=n;x[3]=J;return x};p.height=E;p.intersection=function(a,b,n=a){const J=b[0],x=b[1],M=b[2];b=b[3];n[0]=A(a[0],J,M);n[1]=A(a[1],x,b);n[2]=A(a[2],J,M);n[3]=A(a[3],x,b);return n};p.intersects=function(a,b){return Math.max(b[0],
a[0])<=Math.min(b[2],a[2])&&Math.max(b[1],a[1])<=Math.min(b[3],a[3])};p.is=z;p.isPoint=function(a){return(0===t(a)||!isFinite(a[0]))&&(0===E(a)||!isFinite(a[1]))};p.offset=function(a,b,n,J=a){J[0]=a[0]+b;J[1]=a[1]+n;J[2]=a[2]+b;J[3]=a[3]+n;return J};p.pad=function(a,b,n=a){n[0]=a[0]-b;n[1]=a[1]-b;n[2]=a[2]+b;n[3]=a[3]+b;return n};p.set=N;p.setMax=function(a,b,n=a){n[2]=b[0];n[3]=b[1];n!==a&&(n[0]=a[0],n[1]=a[1]);return a};p.setMin=function(a,b,n=a){n[0]=b[0];n[1]=b[1];n!==a&&(n[2]=a[2],n[3]=a[3]);
return n};p.size=function(a,b){b[0]=a[2]-a[0];b[1]=a[3]-a[1]};p.toExtent=function(a,b){return new h({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:b})};p.width=t;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/subclass".split(" "),
function(p,q,e,h,y,t,E,u,N){var z;e=z=function(A){function R(G){G=A.call(this,G)||this;G.level=0;G.levelValue=null;G.resolution=0;G.scale=0;return G}p._inheritsLoose(R,A);R.prototype.clone=function(){return new z({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return R}(e.JSONSupport);q.__decorate([h.property({type:t.Integer,json:{write:!0}})],e.prototype,"level",void 0);q.__decorate([h.property({type:String,json:{write:!0}})],e.prototype,"levelValue",void 0);
q.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"resolution",void 0);q.__decorate([h.property({type:Number,json:{write:!0}})],e.prototype,"scale",void 0);return e=z=q.__decorate([N.subclass("esri.layers.support.LOD")],e)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(p,q,e,h,y,t,E,u,N,z,A,R,G,a,b,n,J,x,M,L){var H;const C=u.getLogger("esri.layers.support.TilemapCache");p.TilemapCache=H=function(f){function m(c){c=f.call(this,c)||this;c._handles=new E;c._pendingTilemapRequests={};c._availableLevels={};c.levels=5;c.cacheByteSize=2097152;c.request=h;c._prefetchingEnabled=!0;return c}q._inheritsLoose(m,f);var k=m.prototype;k.initialize=function(){this._tilemapCache=new N(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),a.init(this,"layer.tileInfo.lods",c=>this._initializeAvailableLevels(c),!0)]);this._initializeTilemapDefinition()};k.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};k.castLevels=function(c){return 2>=c?(C.error("Minimum levels for Tilemap is 3, but got ",c),3):c};k.fetchTilemap=function(c,l,B,v){if(!this._availableLevels[c])return Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${c} is unavailable in the service`));
const D=this._tmpTilemapDefinition;if(c=this._tilemapFromCache(c,l,B,D))return Promise.resolve(c);const O=v&&v.signal;v={...v,signal:null};return new Promise((T,P)=>{A.onAbort(O,()=>P(A.createAbortError()));const V=L.tilemapDefinitionId(D);let X=this._pendingTilemapRequests[V];if(!X){X=L.Tilemap.fromDefinition(D,v).then(da=>{this._tilemapCache.put(V,da,da.byteSize);return da});const Q=()=>delete this._pendingTilemapRequests[V];this._pendingTilemapRequests[V]=X;X.then(Q,Q)}X.then(T,P)})};k.getAvailability=
function(c,l,B){return this._availableLevels[c]?(c=this._tilemapFromCache(c,l,B,this._tmpTilemapDefinition))?c.getAvailability(l,B):"unknown":"unavailable"};k.getAvailabilityUpsample=function(c,l,B,v){v.level=c;v.row=l;v.col=B;c=this.layer.tileInfo;for(c.updateTileInfo(v);;)if(l=this.getAvailability(v.level,v.row,v.col),"unavailable"===l){if(!c.upsampleTile(v))return"unavailable"}else return l};k.fetchAvailability=function(c,l,B,v){return this._availableLevels[c]?this.fetchTilemap(c,l,B,v).catch(D=>
D).then(D=>{if(D instanceof L.Tilemap)return D=D.getAvailability(l,B),"unavailable"===D?Promise.reject(new t("tile-map:tile-unavailable","Tile is not available",{level:c,row:l,col:B})):D;if(A.isAbortError(D))throw D;return"unknown"}):Promise.reject(new t("tilemap-cache:level-unavailable",`Level ${c} is unavailable in the service`))};k.fetchAvailabilityUpsample=function(c,l,B,v,D){v.level=c;v.row=l;v.col=B;const O=this.layer.tileInfo;O.updateTileInfo(v);const T=this.fetchAvailability(c,l,B,D).catch(P=>
{if(A.isAbortError(P))throw P;if(O.upsampleTile(v))return this.fetchAvailabilityUpsample(v.level,v.row,v.col,v);throw P;});this._fetchAvailabilityUpsamplePrefetch(v.id,c,l,B,D,T);return T};k._fetchAvailabilityUpsamplePrefetch=function(){var c=q._asyncToGenerator(function*(l,B,v,D,O,T){if(this._prefetchingEnabled){var P=`prefetch-${l}`;if(!this._handles.has(P)){var V=A.createAbortController();T.then(()=>V.abort(),()=>V.abort());var X=!1;this._handles.add({remove(){X||(X=!0,V.abort())}},P);yield R.waitTicks(10,
V.signal).catch(()=>{});X||(X=!0,this._handles.remove(P));if(!A.isAborted(V))for(l={id:l,level:B,row:v,col:D},O={...O,signal:V.signal},B=this.layer.tileInfo,v=0;H._prefetches.length<H._maxPrefetch&&B.upsampleTile(l);++v){const Q=this.fetchAvailability(l.level,l.row,l.col,O);H._prefetches.push(Q);D=()=>{H._prefetches.removeUnordered(Q)};Q.then(D,D)}}}});return function(l,B,v,D,O,T){return c.apply(this,arguments)}}();k._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var c=this.layer.parsedUrl,
l=c.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:c.path,query:l?G.objectToQuery(l):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};k._tilemapFromCache=function(c,l,B,v){v.level=c;v.row=l-l%this.size;v.col=B-B%this.size;c=L.tilemapDefinitionId(v);return this._tilemapCache.get(c)};k._initializeAvailableLevels=function(c){this._availableLevels={};c&&c.forEach(l=>this._availableLevels[l.level]=
!0)};q._createClass(m,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const c=this;return{get prefetchingEnabled(){return c._prefetchingEnabled},set prefetchingEnabled(l){c._prefetchingEnabled=l},hasTilemap(l,B,v){return!!c._tilemapFromCache(l,B,v,c._tmpTilemapDefinition)}}}}]);return m}(y);p.TilemapCache._maxPrefetch=4;p.TilemapCache._prefetches=new z({initialSize:H._maxPrefetch});e.__decorate([b.property({constructOnly:!0,type:Number})],p.TilemapCache.prototype,"levels",
void 0);e.__decorate([J.cast("levels")],p.TilemapCache.prototype,"castLevels",null);e.__decorate([b.property({readOnly:!0,type:Number})],p.TilemapCache.prototype,"size",null);e.__decorate([b.property({constructOnly:!0,type:Number})],p.TilemapCache.prototype,"cacheByteSize",void 0);e.__decorate([b.property({constructOnly:!0})],p.TilemapCache.prototype,"layer",void 0);e.__decorate([b.property({constructOnly:!0})],p.TilemapCache.prototype,"request",void 0);p.TilemapCache=H=e.__decorate([M.subclass("esri.layers.support.TilemapCache")],
p.TilemapCache);Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(p,q,e,h,y){function t(u){if("vector-tile"===u.service.type)var N=`${u.service.url}/tilemap/${u.level}/${u.row}/${u.col}/${u.width}/${u.height}`;else N=u.service.tileServers,N=`${N&&N.length?N[u.row%N.length]:u.service.url}/tilemap/${u.level}/${u.row}/${u.col}/${u.width}/${u.height}`;(u=
u.service.query)&&(N=`${N}?${u}`);return N}let E=function(){function u(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var N=u.prototype;N.getAvailability=function(z,A){if("unknown"!==this._allAvailability)return this._allAvailability;z=(z-this.location.top)*this.location.width+(A-this.location.left);A=z>>3;const R=this._tileAvailabilityBitSet;return 0>A||A>R.length?"unknown":R[A]&1<<z%8?"available":"unavailable"};N._updateFromData=function(z){let A=
!0,R=!0;const G=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let a=0;for(let b=0;b<z.length;b++){const n=b%8;z[b]?(R=!1,G[a]|=1<<n):A=!1;7===n&&++a}R?this._allAvailability="unavailable":A?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=G,this.byteSize+=G.length)};u.fromDefinition=function(z,A){const R=z.service.request||q,{row:G,col:a,width:b,height:n}=z,J={query:{f:"json"}};A=A?{...J,...A}:J;return R(t(z),A).then(x=>x.data).catch(x=>
{if(x&&x.details&&422===x.details.httpStatus)return{location:{top:G,left:a,width:b,height:n},valid:!0,data:e.constant(b*n,0)};throw x;}).then(x=>{if(x.location&&(x.location.top!==G||x.location.left!==a||x.location.width!==b||x.location.height!==n))throw new h("tilemap:location-mismatch","Tilemap response for different location than requested",{response:x,definition:{top:G,left:a,width:b,height:n}});return u.fromJSON(x)})};u.fromJSON=function(z){u.validateJSON(z);const A=new u;A.location=Object.freeze(y.clone(z.location));
A._updateFromData(z.data);return Object.freeze(A)};u.validateJSON=function(z){if(!z||!z.location)throw new h("tilemap:missing-location","Location missing from tilemap response");if(!1===z.valid)throw new h("tilemap:invalid","Tilemap response was marked as invalid");if(!z.data)throw new h("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(z.data))throw new h("tilemap:data-mismatch","Data must be an array of numbers");if(z.data.length!==z.location.width*z.location.height)throw new h("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return u}();p.Tilemap=E;p.default=E;p.tilemapDefinitionId=function(u){return`${u.level}/${u.row}/${u.col}/${u.width}/${u.height}`};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/ensureType ../../core/Logger ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(p,q,e,h,y,t,E,u,N,z,A,R,G,a,b,n,J){p.ArcGISMapService=x=>{x=function(M){function L(){var C=M.apply(this,arguments)||this;C.capabilities=void 0;C.copyright=null;C.fullExtent=null;C.legendEnabled=!0;C.spatialReference=null;C.version=null;return C}q._inheritsLoose(L,M);var H=L.prototype;H.readCapabilities=function(C,f){var m=f.capabilities&&f.capabilities.split(",").map(T=>T.toLowerCase().trim());if(!m)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var k=this.type;C=-1!==m.indexOf("query");const c=-1!==m.indexOf("map"),l=!!f.exportTilesAllowed;m=-1!==m.indexOf("tilemap");const B="tile"!==k&&!!f.supportsDynamicLayers,v="tile"!==k&&(!f.tileInfo||B),D="tile"!==k&&(!f.tileInfo||B);k="tile"!==k;const O=f.cimVersion?E.Version.parse(f.cimVersion).since(1,4):!1;return{operations:{supportsQuery:C,supportsExportMap:c,supportsExportTiles:l,supportsTileMap:m},exportMap:c?{supportsArcadeExpressionForLabeling:O,supportsSublayersChanges:k,
supportsDynamicLayers:B,supportsSublayerVisibility:v,supportsSublayerDefinitionExpression:D}:null,exportTiles:l?{maxExportTilesCount:+f.maxExportTilesCount}:null}};H.readVersion=function(C,f){(C=f.currentVersion)||(C=f.hasOwnProperty("capabilities")||f.hasOwnProperty("tables")?10:f.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return C};H.fetchSublayerInfo=function(){var C=q._asyncToGenerator(function*(f,m){yield this.fetchAllLayersAndTables(m);return this._allLayersAndTablesMap.get(f)});
return function(f,m){return C.apply(this,arguments)}}();H.fetchAllLayersAndTables=function(){var C=q._asyncToGenerator(function*(f){yield this.load(f);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=h(t.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(k=>{this._allLayersAndTablesMap=new Map;for(const c of k.data.layers)this._allLayersAndTablesMap.set(c.id,c);return{result:k.data}},k=>({error:k})));const m=
yield this._allLayersAndTablesPromise;y.throwIfAborted(f);if("result"in m)return m.result;throw m.error;});return function(f){return C.apply(this,arguments)}}();return L}(x);e.__decorate([u.property({readOnly:!0})],x.prototype,"capabilities",void 0);e.__decorate([G.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],x.prototype,"readCapabilities",null);e.__decorate([u.property({json:{read:{source:"copyrightText"}}})],x.prototype,
"copyright",void 0);e.__decorate([u.property({type:b})],x.prototype,"fullExtent",void 0);e.__decorate([u.property(J.id)],x.prototype,"id",void 0);e.__decorate([u.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],x.prototype,"legendEnabled",void 0);e.__decorate([u.property(J.popupEnabled)],x.prototype,"popupEnabled",void 0);e.__decorate([u.property({type:n})],x.prototype,"spatialReference",void 0);e.__decorate([u.property()],
x.prototype,"version",void 0);e.__decorate([G.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],x.prototype,"readVersion",null);return x=e.__decorate([a.subclass("esri.layers.mixins.ArcGISMapService")],x)};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(p,q){let e=function(){function h(t,E,u=""){this.major=t;this.minor=E;this._context=u}var y=h.prototype;y.lessThan=function(t,E){return this.major<
t||t===this.major&&this.minor<E};y.since=function(t,E){return!this.lessThan(t,E)};y.validate=function(t){if(this.major!==t.major)throw new q((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t});};y.clone=function(){return new h(this.major,this.minor,this._context)};h.parse=function(t,E=""){const [u,N]=t.split(".");var z=/^\s*\d+\s*$/;if(!u||!u.match||!u.match(z))throw new q((E&&
E+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!N||!N.match||!N.match(z))throw new q((E&&E+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});t=parseInt(u,10);z=parseInt(N,10);return new h(t,z,E)};return h}();p.Version=e;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(p,q,e,h,y,t,E,u,N,z,A,R,G,a,b,n){function J(H,C){const f=[],m={};if(!H)return f;H.forEach(k=>{const c=new b;c.read(k,C);m[c.id]=c;null!=k.parentLayerId&&-1!==k.parentLayerId?(k=m[k.parentLayerId],k.sublayers||(k.sublayers=[]),k.sublayers.unshift(c)):f.unshift(c)});return f}function x(H,C){H&&H.forEach(f=>{C(f);f.sublayers&&f.sublayers.length&&x(f.sublayers,C)})}const M=E.getLogger("esri.layers.TileLayer"),L=h.ofType(b);p.SublayersOwner=H=>{H=function(C){function f(...k){var c=C.call(this,
...k)||this;c.allSublayers=new y({getCollections:()=>[c.sublayers],getChildrenFunction(l){return l.sublayers}});c.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};c.handles.add(c.watch("sublayers",(l,B)=>c._handleSublayersChange(l,B),!0));return c}q._inheritsLoose(f,C);var m=f.prototype;m.readSublayers=function(k,c){if(c&&k){var {sublayersSourceJSON:l}=this,B=a.nameToId(c.origin);if(!(2>B||(l[B]={context:c,visibleLayers:k.visibleLayers||l[B].visibleLayers,layers:k.layers||l[B].layers},2<B))){this._set("serviceSublayers",
this.createSublayersForOrigin("service").sublayers);var {sublayers:v,origin:D}=this.createSublayersForOrigin("web-document");k=z.getProperties(this);k.setDefaultOrigin(D);this._set("sublayers",new L(v));k.setDefaultOrigin("user")}}};m.findSublayerById=function(k){return this.allSublayers.find(c=>c.id===k)};m.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};m.createSublayersForOrigin=function(k){const c="web-document"===k?a.nameToId("web-map"):a.nameToId(k);
let l=2;k=this.sublayersSourceJSON[2].layers;let B=this.sublayersSourceJSON[2].context,v=null;var D=[3,4,5].filter(Q=>Q<=c);for(var O of D)D=this.sublayersSourceJSON[O],n.isSublayerOverhaul(D.layers)&&(l=O,k=D.layers,B=D.context,D.visibleLayers&&(v={visibleLayers:D.visibleLayers,context:D.context}));O=[3,4,5].filter(Q=>Q>l&&Q<=c);let T=null;for(var P of O){const {layers:Q,visibleLayers:da,context:Y}=this.sublayersSourceJSON[P];Q&&(T={layers:Q,context:Y});da&&(v={visibleLayers:da,context:Y})}P=J(k,
B);const V=new Map,X=new Set;if(T)for(const Q of T.layers)V.set(Q.id,Q);if(v)for(const Q of v.visibleLayers)X.add(Q);x(P,Q=>{T&&Q.read(V.get(Q.id),T.context);v&&Q.read({defaultVisibility:X.has(Q.id)},v.context)});return{origin:a.idToName(l),sublayers:new L({items:P})}};m.read=function(k,c){C.prototype.read.call(this,k,c);this.readSublayers(k,c)};m._handleSublayersChange=function(k,c){c&&(c.forEach(l=>{l.parent=null;l.layer=null}),this.handles.remove("sublayers-owner"));k&&(k.forEach(l=>{l.parent=
this;l.layer=this}),this.handles.add([k.on("after-add",({item:l})=>{l.parent=this;l.layer=this}),k.on("after-remove",({item:l})=>{l.parent=null;l.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(k.on("before-changes",l=>{M.error(new t("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));l.preventDefault()}),"sublayers-owner"))};return f}(H);e.__decorate([u.property({readOnly:!0})],H.prototype,"allSublayers",
void 0);e.__decorate([u.property({readOnly:!0,type:h.ofType(b)})],H.prototype,"serviceSublayers",void 0);e.__decorate([u.property({value:null,type:L,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],H.prototype,"sublayers",void 0);e.__decorate([u.property({readOnly:!0})],H.prototype,"sublayersSourceJSON",void 0);return H=e.__decorate([G.subclass("esri.layers.mixins.SublayersOwner")],H)};p.forEachSublayer=x;Object.defineProperty(p,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/has ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./FeatureType ./Field ./FieldsIndex ./LabelClass ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent".split(" "),
function(p,q,e,h,y,t,E,u,N,z,A,R,G,a,b,n,J,x,M,L,H,C,f,m,k,c,l,B,v,D,O,T,P,V,X,Q,da,Y,w,K,W,Z,ea,ja){function ca(S){return S&&"esriSMS"===S.type}function pa(S,aa,F){var d;S=this.originIdOf(aa)>=X.nameToId(F.origin);return{ignoreOrigin:!0,allowNull:S,enabled:F?"map-image"===(null==(d=F.layer)?void 0:d.type)&&(F.writeSublayerStructure||S):!1}}function qa(S,aa,F){var d;return{enabled:F?"tile"===(null==(d=F.layer)?void 0:d.type)&&this._isOverridden(aa):!1}}function fa(S,aa,F){return{ignoreOrigin:!0,enabled:F&&
F.writeSublayerStructure||!1}}function la(S,aa,F){return{ignoreOrigin:!0,enabled:F?F.writeSublayerStructure||this.originIdOf(aa)>=X.nameToId(F.origin):!1}}var ma;const na=f.getLogger("esri.layers.support.Sublayer");let ra=0;const ia=new Set;ia.add("layer");ia.add("parent");ia.add("loaded");ia.add("loadStatus");ia.add("loadError");ia.add("loadWarnings");h=ma=function(S){function aa(d){d=S.call(this,d)||this;d.capabilities=void 0;d.fields=null;d.fullExtent=null;d.globalIdField=null;d.legendEnabled=
!0;d.objectIdField=null;d.popupEnabled=!0;d.popupTemplate=null;d.sourceJSON=null;d.title=null;d.typeIdField=null;d.types=null;return d}q._inheritsLoose(aa,S);var F=aa.prototype;F.load=function(){var d=q._asyncToGenerator(function*(g){var r=this;this.addResolvingPromise(q._asyncToGenerator(function*(){var I;if(!r.layer&&!r.url)throw new x("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:r});let U=null;if(!r.layer||2<r.originIdOf("url")||"data-layer"===(null==
(I=r.source)?void 0:I.type))U=(yield b(r.url,{responseType:"json",query:{f:"json"},...g})).data;else{var ba;I=r.id;"map-layer"===(null==(ba=r.source)?void 0:ba.type)&&(I=r.source.mapLayerId);U=yield r.layer.fetchSublayerInfo(I,g)}U&&(r.sourceJSON=U,r.read({layerDefinition:U},{origin:"service"}))})());return this});return function(g){return d.apply(this,arguments)}}();F.readCapabilities=function(d,g){g=g.layerDefinition||g;d=(d=g.capabilities||d)?d.toLowerCase().split(",").map(r=>r.trim()):[];return{exportMap:{supportsModification:!!g.canModifyLayer},
operations:{supportsQuery:-1!==d.indexOf("query")}}};F.readGlobalIdFieldFromService=function(d,g){g=g.layerDefinition||g;if(g.globalIdField)return g.globalIdField;if(g.fields)for(const r of g.fields)if("esriFieldTypeGlobalID"===r.type)return r.name};F.writeLabelingInfo=function(d,g,r,I){d&&d.length&&(g.layerDefinition={drawingInfo:{labelingInfo:d.map(U=>U.write({},I))}})};F.readMinScale=function(d,g){return g.minScale||g.layerDefinition&&g.layerDefinition.minScale||0};F.readMaxScale=function(d,g){return g.maxScale||
g.layerDefinition&&g.layerDefinition.maxScale||0};F.readObjectIdFieldFromService=function(d,g){g=g.layerDefinition||g;if(g.objectIdField)return g.objectIdField;if(g.fields)for(const r of g.fields)if("esriFieldTypeOID"===r.type)return r.name};F.readOpacity=function(d,g){d=g.layerDefinition;return 1-.01*(null!=d.transparency?d.transparency:d.drawingInfo.transparency)};F.writeOpacity=function(d,g,r,I){g.layerDefinition={drawingInfo:{transparency:100-100*d}}};F.writeParent=function(d,g){g.parentLayerId=
this.parent&&this.parent!==this.layer?V.ensureInteger(this.parent.id):-1};F.castSublayers=function(d){return V.ensureType(J.ofType(ma),d)};F.writeSublayers=function(d,g,r){this.get("sublayers.length")&&(g[r]=this.sublayers.map(I=>I.id).toArray().reverse())};F.readTypeIdField=function(d,g){g=g.layerDefinition||g;let r=g.typeIdField;r&&g.fields&&(r=r.toLowerCase(),d=g.fields.find(I=>I.name.toLowerCase()===r))&&(r=d.name);return null};F.writeVisible=function(d,g,r,I){g[r]=this.getAtOrigin("defaultVisibility",
"service")||d};F.clone=function(){const {store:d}=l.getProperties(this),g=new ma;l.getProperties(g).store=d.clone(ia);this.commitProperty("url");g._lastParsedUrl=this._lastParsedUrl;return g};F.createPopupTemplate=function(d){return ea.createPopupTemplate(this,d)};F.createQuery=function(){return new Z({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};F.createFeatureLayer=function(){var d=q._asyncToGenerator(function*(){var g,r;if(this.hasOwnProperty("sublayers"))return null;const I=
null==(g=this.layer)?void 0:g.parsedUrl;g=new (yield new Promise(function(U,ba){p(["../FeatureLayer"],function(ha){U(Object.freeze({__proto__:null,"default":ha}))},ba)})).default({url:I.path});I&&this.source&&("map-layer"===this.source.type?g.layerId=this.source.mapLayerId:g.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(g.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(g.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&
(g.labelingInfo=H.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(g.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(g.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(g.visible=this.visible);0<this.originIdOf("minScale")&&(g.minScale=this.minScale);0<this.originIdOf("maxScale")&&(g.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(g.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(g.popupTemplate=H.clone(this.popupTemplate));2<this.originIdOf("renderer")&&
(g.renderer=H.clone(this.renderer));"data-layer"===(null==(r=this.source)?void 0:r.type)&&(g.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(g.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(g.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(g.customParameters=this.layer.customParameters);return g});return function(){return d.apply(this,arguments)}}();F.getFeatureType=
function(d){const {typeIdField:g,types:r}=this;if(!g||!d)return null;const I=d.attributes?d.attributes[g]:void 0;if(null==I)return null;let U=null;r.some(ba=>{const {id:ha}=ba;if(null==ha)return!1;ha.toString()===I.toString()&&(U=ba);return!!U});return U};F.getFieldDomain=function(d,g){return(g=this.getFeatureType(g&&g.feature))&&(g=g.domains&&g.domains[d])&&"inherited"!==g.type?g:this._getLayerDomain(d)};F.queryFeatures=function(){var d=q._asyncToGenerator(function*(g=this.createQuery(),r){var I,
U,ba,ha;yield this.load();if(!this.get("capabilities.operations.supportsQuery"))throw new x("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:sa},{default:ta}]=yield Promise.all([new Promise(function(ka,oa){p(["../../rest/query/operations/query"],ka,oa)}),new Promise(function(ka,oa){p(["../../rest/support/FeatureSet"],function(ua){ka(Object.freeze({__proto__:null,"default":ua}))},oa)})]);g=yield sa(this.url,Z.from(g),null!=(I=null==(U=this.layer)?void 0:U.spatialReference)?
I:null,{...r,query:{...null==(ba=this.layer)?void 0:ba.customParameters,token:null==(ha=this.layer)?void 0:ha.apiKey}});I=ta.fromJSON(g.data);if(null!=I&&I.features)for(const ka of I.features)ka.sourceLayer=this;return I});return function(){return d.apply(this,arguments)}}();F.toExportImageJSON=function(){var d;const g={id:this.id,source:(null==(d=this.source)?void 0:d.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(g.definitionExpression=this.definitionExpression);const r=
["renderer","labelingInfo","opacity","labelsVisible"].reduce((I,U)=>{I[U]=this.originIdOf(U);return I},{});Object.keys(r).some(I=>2<r[I])&&(d=g.drawingInfo={},2<r.renderer&&(d.renderer=this.renderer?this.renderer.toJSON():null),2<r.labelsVisible&&(d.showLabels=this.labelsVisible),this.labelsVisible&&2<r.labelingInfo&&(d.labelingInfo=this.labelingInfo?this.labelingInfo.map(I=>I.write({},{origin:"service",layer:this.layer})):null,d.showLabels=!0),2<r.opacity&&(d.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(d.renderer));
return g};F._assignDefaultSymbolColors=function(d){this._forEachSimpleMarkerSymbols(d,g=>{g.color||"esriSMSX"!==g.style&&"esriSMSCross"!==g.style||(g.color=g.outline&&g.outline.color?g.outline.color:[0,0,0,0])})};F._forEachSimpleMarkerSymbols=function(d,g){if(d){const r="uniqueValueInfos"in d?d.uniqueValueInfos:"classBreakInfos"in d?d.classBreakInfos:[];for(const I of r)ca(I.symbol)&&g(I.symbol);"symbol"in d&&ca(d.symbol)&&g(d.symbol);"defaultSymbol"in d&&ca(d.defaultSymbol)&&g(d.defaultSymbol)}};
F._setAndNotifyLayer=function(d,g){const r=this.layer,I=this._get(d);let U,ba;switch(d){case "definitionExpression":U="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":U="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":U="supportsDynamicLayers",ba="supportsModification"}const ha=l.getProperties(this).getDefaultOrigin();if("service"!==ha){if(U&&!1===this.get(`layer.capabilities.exportMap.${U}`)){this._logLockedError(d,
`capability not available 'layer.capabilities.exportMap.${U}'`);return}if(ba&&!1===this.get(`capabilities.exportMap.${ba}`)){this._logLockedError(d,`capability not available 'capabilities.exportMap.${ba}'`);return}}"source"===d&&"not-loaded"!==this.loadStatus?this._logLockedError(d,"'source' can't be changed after calling sublayer.load()"):(this._set(d,g),"service"!==ha&&I!==g&&r&&r.emit&&r.emit("sublayer-update",{propertyName:d,target:this}))};F._handleSublayersChange=function(d,g){g&&(g.forEach(r=>
{r.parent=null;r.layer=null}),this.handles.removeAll());d&&(d.forEach(r=>{r.parent=this;r.layer=this.layer}),this.handles.add([d.on("after-add",({item:r})=>{r.parent=this;r.layer=this.layer}),d.on("after-remove",({item:r})=>{r.parent=null;r.layer=null}),d.on("before-changes",r=>{const I=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==I||I||(na.error(new x("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,
layer:this.layer})),r.preventDefault())})]))};F._logLockedError=function(d,g){na.error(new x("sublayer:locked",`Property '${d}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:g,sublayer:this,layer:this.layer}))};F._getLayerDomain=function(d){return(d=this.fieldsIndex.get(d))?d.domain:null};q._createClass(aa,[{key:"definitionExpression",set:function(d){this._setAndNotifyLayer("definitionExpression",d)}},{key:"fieldsIndex",get:function(){return new Y(this.fields||[])}},{key:"id",
get:function(){const d=this._get("id");return null==d?ra++:d},set:function(d){this._get("id")!==d&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",d))}},{key:"labelingInfo",set:function(d){this._setAndNotifyLayer("labelingInfo",d)}},{key:"labelsVisible",set:function(d){this._setAndNotifyLayer("labelsVisible",d)}},{key:"layer",set:function(d){this._set("layer",
d);this.sublayers&&this.sublayers.forEach(g=>g.layer=d)}},{key:"listMode",set:function(d){this._set("listMode",d)}},{key:"minScale",set:function(d){this._setAndNotifyLayer("minScale",d)}},{key:"maxScale",set:function(d){this._setAndNotifyLayer("maxScale",d)}},{key:"opacity",set:function(d){this._setAndNotifyLayer("opacity",d)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(d){if(d)for(const g of d.getSymbols())if(n.isSymbol3D(g)){na.warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",d)}},{key:"source",get:function(){return this._get("source")||new W.MapLayerSource({mapLayerId:this.id})},set:function(d){this._setAndNotifyLayer("source",d)}},{key:"sublayers",set:function(d){this._handleSublayersChange(d,this._get("sublayers"));this._set("sublayers",d)}},{key:"url",get:function(){var d,g;const r=null!=(d=null==(g=this.layer)?void 0:g.parsedUrl)?d:this._lastParsedUrl;d=this.source;if(!r)return null;this._lastParsedUrl=r;if("map-layer"===(null==
d?void 0:d.type))return`${r.path}/${d.mapLayerId}`;d={layer:JSON.stringify({source:this.source})};return`${r.path}/dynamicLayer?${k.objectToQuery(d)}`},set:function(d){d?this._override("url",d):this._clearOverride("url")}},{key:"visible",set:function(d){this._setAndNotifyLayer("visible",d)}}]);return aa}(M.HandleOwnerMixin(m.MultiOriginJSONMixin(L.IdentifiableMixin(C))));h.test={isMapImageLayerOverridePolicy:S=>S===fa||S===pa,isTileImageLayerOverridePolicy:S=>S===qa};e.__decorate([c.property({readOnly:!0})],
h.prototype,"capabilities",void 0);e.__decorate([O.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],h.prototype,"readCapabilities",null);e.__decorate([c.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{overridePolicy:pa}}})],h.prototype,"definitionExpression",null);e.__decorate([c.property({type:[da],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],h.prototype,"fields",void 0);e.__decorate([c.property({readOnly:!0})],
h.prototype,"fieldsIndex",null);e.__decorate([c.property({type:ja,json:{read:{source:"layerDefinition.extent"}}})],h.prototype,"fullExtent",void 0);e.__decorate([c.property({type:String})],h.prototype,"globalIdField",void 0);e.__decorate([O.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],h.prototype,"readGlobalIdFieldFromService",null);e.__decorate([c.property({type:V.Integer,json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);e.__decorate([c.property({value:null,
type:[w],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:fa}}})],h.prototype,"labelingInfo",null);e.__decorate([P.writer("labelingInfo")],h.prototype,"writeLabelingInfo",null);e.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:fa}}})],h.prototype,"labelsVisible",null);e.__decorate([c.property({value:null})],
h.prototype,"layer",null);e.__decorate([c.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:la}}})],h.prototype,"legendEnabled",void 0);e.__decorate([c.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],h.prototype,"listMode",null);e.__decorate([c.property({type:Number,value:0,json:{write:{overridePolicy:fa}}})],h.prototype,"minScale",
null);e.__decorate([O.reader("minScale",["minScale","layerDefinition.minScale"])],h.prototype,"readMinScale",null);e.__decorate([c.property({type:Number,value:0,json:{write:{overridePolicy:fa}}})],h.prototype,"maxScale",null);e.__decorate([O.reader("maxScale",["maxScale","layerDefinition.maxScale"])],h.prototype,"readMaxScale",null);e.__decorate([c.property({type:String})],h.prototype,"objectIdField",void 0);e.__decorate([O.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
h.prototype,"readObjectIdFieldFromService",null);e.__decorate([c.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:fa}}})],h.prototype,"opacity",null);e.__decorate([O.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],h.prototype,"readOpacity",null);e.__decorate([P.writer("opacity")],h.prototype,"writeOpacity",null);e.__decorate([c.property({json:{type:V.Integer,write:{target:"parentLayerId",allowNull:!0,
overridePolicy:fa}}})],h.prototype,"parent",void 0);e.__decorate([P.writer("parent")],h.prototype,"writeParent",null);e.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(S,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:la,writer(S,aa,F){aa[F]=!S}}}})],h.prototype,"popupEnabled",void 0);e.__decorate([c.property({type:y,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:la}}})],h.prototype,"popupTemplate",void 0);e.__decorate([c.property({readOnly:!0})],
h.prototype,"defaultPopupTemplate",null);e.__decorate([c.property({types:a.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:fa},origins:{"web-scene":{types:a.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:fa}}}}})],h.prototype,"renderer",null);e.__decorate([c.property({types:{key:"type",base:null,typeMap:{"data-layer":K.DataLayerSource,"map-layer":W.MapLayerSource}},cast(S){if(S){if("mapLayerId"in S)return V.ensureClass(W.MapLayerSource,
S);if("dataSource"in S)return V.ensureClass(K.DataLayerSource,S)}return S},json:{name:"layerDefinition.source",write:{overridePolicy:fa}}})],h.prototype,"source",null);e.__decorate([c.property()],h.prototype,"sourceJSON",void 0);e.__decorate([c.property({value:null,json:{type:[V.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:fa}}})],h.prototype,"sublayers",null);e.__decorate([B.cast("sublayers")],h.prototype,"castSublayers",null);e.__decorate([P.writer("sublayers")],h.prototype,
"writeSublayers",null);e.__decorate([c.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:la}}})],h.prototype,"title",void 0);e.__decorate([c.property({type:String})],h.prototype,"typeIdField",void 0);e.__decorate([O.reader("typeIdField",["layerDefinition.typeIdField"])],h.prototype,"readTypeIdField",null);e.__decorate([c.property({type:[Q],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],h.prototype,"types",void 0);e.__decorate([c.property({type:String,
json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:qa}}})],h.prototype,"url",null);e.__decorate([c.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:fa}}})],h.prototype,"visible",null);e.__decorate([P.writer("visible")],h.prototype,"writeVisible",null);return h=ma=e.__decorate([T.subclass("esri.layers.support.Sublayer")],h)})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(p){function q(e,
h){if(!e||!e.length)return!0;h=h.slice().reverse().flatten(({sublayers:E})=>E&&E.toArray().reverse()).map(E=>E.id).toArray();if(e.length>h.length)return!1;let y=0;const t=h.length;for(const {id:E}of e){for(;y<t&&h[y]!==E;)y++;if(y>=t)return!1}return!0}p.isExportDynamic=function(e,h,y){return e.some(t=>{const E=t.source;return!(!E||"map-layer"===E.type&&E.mapLayerId===t.id&&(!E.gdbVersion||E.gdbVersion===y.gdbVersion))||2<t.originIdOf("renderer")||2<t.originIdOf("labelingInfo")||2<t.originIdOf("opacity")||
2<t.originIdOf("labelsVisible")})?!0:!q(e,h)};p.isSublayerOverhaul=function(e){return!!e&&e.some(h=>null!=h.minScale||h.layerDefinition&&null!=h.layerDefinition.minScale)};p.shouldWriteSublayerStructure=function(e,h,y){return h.flatten(({sublayers:t})=>t).length!==e.length||e.some(t=>t.originIdOf("minScale")>y||t.originIdOf("maxScale")>y||t.originIdOf("renderer")>y||t.originIdOf("labelingInfo")>y||t.originIdOf("opacity")>y||t.originIdOf("labelsVisible")>y||t.originIdOf("source")>y)?!0:!q(e,h)};Object.defineProperty(p,
"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/cast ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer ../geometry/SpatialReference".split(" "),function(p,
q,e,h,y,t,E,u,N,z,A,R,G,a,b,n,J,x,M,L,H,C,f,m,k,c,l,B,v,D,O,T,P,V){const X="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");e=function(Q){function da(...w){w=
Q.call(this,...w)||this;w.listMode="show";w.isReference=null;w.operationalLayerType="ArcGISTiledMapServiceLayer";w.resampling=!0;w.sourceJSON=null;w.spatialReference=null;w.path=null;w.sublayers=null;w.type="tile";w.url=null;return w}p._inheritsLoose(da,Q);var Y=da.prototype;Y.normalizeCtorArgs=function(w,K){return"string"===typeof w?{url:w,...K}:w};Y.load=function(w){const K=E.isSome(w)?w.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},w).catch(N.throwIfAbortError).then(()=>
this._fetchService(K)));return Promise.resolve(this)};Y.readSpatialReference=function(w,K){return(w=w||K.tileInfo&&K.tileInfo.spatialReference)&&V.fromJSON(w)};Y.writeSublayers=function(w,K,W,Z){if(this.loaded&&w){w=w.slice().reverse().flatten(({sublayers:ca})=>ca&&ca.toArray().reverse()).toArray();var ea=[],ja={writeSublayerStructure:!1,...Z};w.forEach(ca=>{ca=ca.write({},ja);ea.push(ca)});ea.some(ca=>1<Object.keys(ca).length)&&(K.layers=ea)}};Y.castTileServers=function(w){return Array.isArray(w)?
w.map(K=>z.urlToObject(K).path):null};Y.fetchTile=function(w,K,W,Z={}){const {signal:ea,timestamp:ja}=Z;w=this.getTileUrl(w,K,W);K={responseType:"image",signal:ea};null!=ja&&(K.query={_ts:Z.timestamp});return h(w,K).then(ca=>ca.data)};Y.getTileUrl=function(w,K,W){const Z=z.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ea=this.tileServers;return`${ea&&ea.length?ea[K%ea.length]:this.parsedUrl.path}/tile/${w}/${K}/${W}${Z?
"?"+Z:""}`};Y._fetchService=function(w){return(new Promise((K,W)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new y("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");K({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new y("tile-layer:undefined-url","layer's url is not defined");var Z=O.parse(this.parsedUrl.path);if(E.isSome(Z)&&"ImageServer"===Z.serverType)throw new y("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
h(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:w}).then(K,W)}})).then(K=>{K.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=K.data;this.read(K.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!O.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,w).then(W=>{this.read({currentVersion:W})}).catch(()=>{})})};Y._fetchServerVersion=function(w,K){if(!O.isArcGISUrl(w))return Promise.reject();
w=w.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return h(w,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:K}).then(W=>{if(W.data&&W.data.currentVersion)return W.data.currentVersion;throw new y("tile-layer:version-not-available");})};Y._getMapName=function(w){return(w=w.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&w[2]};Y._getDefaultAttribution=
function(w){if(w){w=w.toLowerCase();for(let W=0,Z=X.length;W<Z;W++){var K=X[W];if(-1<K.toLowerCase().indexOf(w))return z.makeAbsolute("//static.arcgis.com/attribution/"+K)}}};Y._getDefaultTileServers=function(w){const K=-1!==w.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),W=-1!==w.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return K||W?[w,w.replace(K?/server\.arcgisonline/i:/services\.arcgisonline/i,K?"services.arcgisonline":"server.arcgisonline")]:[]};p._createClass(da,[{key:"attributionDataUrl",
get:function(){var w;const K=null==(w=this.parsedUrl)?void 0:w.path.toLowerCase();return K&&this._getDefaultAttribution(this._getMapName(K))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return da}(m.BlendLayer(D.SublayersOwner(v.ScaleRangeLayer(B.RefreshableLayer(c.OperationalLayer(l.PortalLayer(H.ArcGISCachedService(C.ArcGISMapService(f.ArcGISService(u.MultiOriginJSONMixin(t.HandleOwnerMixin(L.APIKeyMixin(k.CustomParametersMixin(M))))))))))))));
q.__decorate([A.property({readOnly:!0})],e.prototype,"attributionDataUrl",null);q.__decorate([A.property({type:["show","hide","hide-children"]})],e.prototype,"listMode",void 0);q.__decorate([A.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);q.__decorate([A.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],e.prototype,"operationalLayerType",void 0);q.__decorate([A.property({type:Boolean})],e.prototype,"resampling",
void 0);q.__decorate([A.property()],e.prototype,"sourceJSON",void 0);q.__decorate([A.property({type:V})],e.prototype,"spatialReference",void 0);q.__decorate([n.reader("spatialReference",["spatialReference","tileInfo"])],e.prototype,"readSpatialReference",null);q.__decorate([A.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],e.prototype,"path",void 0);q.__decorate([A.property({readOnly:!0})],e.prototype,"sublayers",void 0);q.__decorate([x.writer("sublayers",{layers:{type:[P]}})],
e.prototype,"writeSublayers",null);q.__decorate([A.property({json:{read:!1,write:!1}})],e.prototype,"popupEnabled",void 0);q.__decorate([A.property()],e.prototype,"tileServers",null);q.__decorate([G.cast("tileServers")],e.prototype,"castTileServers",null);q.__decorate([A.property({readOnly:!0,json:{read:!1}})],e.prototype,"type",void 0);q.__decorate([A.property(T.url)],e.prototype,"url",void 0);e=q.__decorate([J.subclass("esri.layers.TileLayer")],e);e.prototype.fetchTile.__isDefault__=!0;return e});