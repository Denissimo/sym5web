// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),function(y,q,z,D,E,g,F){function t(){t=q._asyncToGenerator(function*(a,c){const b={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[d,f]="string"===typeof a?[a,null]:[null,a.jsonUrl],e=d?
g.urlToObject(d):null;yield m(b,"esri",a,f,c);a={layerDefinition:b.validatedSource,url:d,parsedUrl:e,serviceUrl:b.sourceUrl,style:b.style,styleUrl:b.styleUrl,spriteUrl:b.style.sprite&&n(b.styleBase,b.style.sprite),spriteFormat:b.spriteFormat,glyphsUrl:b.style.glyphs&&n(b.styleBase,b.style.glyphs),sourceNameToSource:b.sourceNameToSource,primarySourceName:b.primarySourceName};p(a.spriteUrl);p(a.glyphsUrl);return a});return t.apply(this,arguments)}function p(a){a&&(a=g.getOrigin(a),u&&-1===u.indexOf(a)&&
u.push(a))}function n(...a){let c=void 0;for(let b=0;b<a.length;++b)g.isProtocolRelative(a[b])?c&&(c=c.split("://")[0]+":"+a[b].trim()):c=g.isAbsolute(a[b])?a[b]:g.join(c,a[b]);return g.removeTrailingSlash(c)}function m(a,c,b,d,f){return v.apply(this,arguments)}function v(){v=q._asyncToGenerator(function*(a,c,b,d,f){E.throwIfAborted(f);if("string"===typeof b){d=g.normalize(b);p(d);var e=g.urlToObject(d);e=yield D(e.path,{query:{f:"json"},responseType:"json",...f});b=d}else e={data:b},b=b.jsonUrl||
null;const h=e.data;e.ssl&&(b&&(b=b.replace(/^http:/i,"https:")),d&&(d=d.replace(/^http:/i,"https:")));return h.sources?(a.styleUrl=b||null,G(a,h,d,f)):h.sources?Promise.reject("You must specify the URL or the JSON for a service or for a style."):a.sourceUrl?A(a,h,d,!1,c,f):(a.sourceUrl=b||null,A(a,h,d,!0,c,f))});return v.apply(this,arguments)}function G(a,c,b,d){return w.apply(this,arguments)}function w(){w=q._asyncToGenerator(function*(a,c,b,d){b=b?g.removeFile(b):g.appBaseUrl;a.styleBase=b;a.style=
c;a.styleUrl&&p(a.styleUrl);c["sprite-format"]&&"webp"===c["sprite-format"].toLowerCase()&&(a.spriteFormat="webp");const f=[];if(c.sources&&c.sources.esri){const e=c.sources.esri;e.url?yield m(a,"esri",n(b,e.url),void 0,d):f.push(m(a,"esri",e,b,d))}for(const e of Object.keys(c.sources))"esri"!==e&&"vector"===c.sources[e].type&&(c.sources[e].url?f.push(m(a,e,n(b,c.sources[e].url),void 0,d)):c.sources[e].tiles&&f.push(m(a,e,c.sources[e],b,d)));yield Promise.all(f)});return w.apply(this,arguments)}function A(a,
c,b,d,f,e){return x.apply(this,arguments)}function x(){x=q._asyncToGenerator(function*(a,c,b,d,f,e){b=b?g.removeTrailingSlash(b)+"/":g.appBaseUrl;if(c.hasOwnProperty("tileInfo"))var h=c;else{var k={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},l=78271.51696400007,B=2.958287637957775E8,C=[],H=c.hasOwnProperty("minzoom")?parseFloat(c.minzoom):0,I=c.hasOwnProperty("maxzoom")?parseFloat(c.maxzoom):22;for(let r=
0;r<=I;r++)r>=H&&C.push({level:r,scale:B,resolution:l}),l/=2,B/=2;for(h of c.tiles)p(n(b,h));h={capabilities:"TilesOnly",initialExtent:k,fullExtent:k,minScale:0,maxScale:0,tiles:c.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:C,spatialReference:{wkid:102100}}}}k=new F(f,b,h);if(!d&&a.primarySourceName in a.sourceNameToSource){l=a.sourceNameToSource[a.primarySourceName];if(!l.isCompatibleWith(k))return Promise.resolve();null!=k.fullExtent&&
(null!=l.fullExtent?l.fullExtent.union(k.fullExtent):l.fullExtent=k.fullExtent.clone());l.tileInfo.lods.length<k.tileInfo.lods.length&&(l.tileInfo=k.tileInfo)}d?(a.sourceBase=b,a.source=c,a.validatedSource=h,a.primarySourceName=f,a.sourceUrl&&p(a.sourceUrl)):p(b);a.sourceNameToSource[f]=k;if(!a.style)return null==c.defaultStyles?Promise.reject():"string"===typeof c.defaultStyles?m(a,"",n(b,c.defaultStyles,"root.json"),void 0,e):m(a,"",c.defaultStyles,n(b,"root.json"),e)});return x.apply(this,arguments)}
const u=z.defaults&&z.defaults.io.corsEnabledServers;y.loadMetadata=function(a,c){return t.apply(this,arguments)};Object.defineProperty(y,"__esModule",{value:!0})});