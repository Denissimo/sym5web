// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ./BaseRaster ./InMemoryRaster ./pamParser ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ../rasterTransforms/PolynomialTransform ../../../geometry/SpatialReference ../../../geometry/Extent".split(" "),
function(h,q,k,v,w,r,x,J,K,L,M,y,z,A,B,C,D,E,F,G){k=function(t){function p(){return t.apply(this,arguments)||this}h._inheritsLoose(p,t);var l=p.prototype;l.open=function(){var g=h._asyncToGenerator(function*(a){yield this.init();var b=yield this._fetchData(a);let {spatialReference:c,statistics:d,histograms:e,transform:f}=yield this._fetchAuxiliaryData(a);(a=!c)&&(c=new F({wkid:3857}));null!=e&&e.length&&null==d&&(d=D.estimateStatisticsFromHistograms(e));const {width:H,height:I}=b;let m=new G({xmin:-.5,
ymin:.5-I,xmax:H-.5,ymax:.5,spatialReference:c});const u=f?f.forwardTransform(m):m;var n=!0;f&&(n=(n=f.forwardCoefficients)&&0===n[1]&&0===n[2])&&(f=null,m=u);b=new A({data:{extent:u,nativeExtent:m,transform:f,pixelBlock:b,statistics:d,histograms:e,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:a}});yield b.open();this._set("rasterInfo",b.rasterInfo);this._inMemoryRaster=b});return function(a){return g.apply(this,arguments)}}();l.fetchRawTile=function(g,a,b,c={}){return this._inMemoryRaster.fetchRawTile(g,
a,b,c)};l._fetchData=function(){var g=h._asyncToGenerator(function*(a){({data:a}=yield this.request(this.url,{responseType:"array-buffer",signal:null==a?void 0:a.signal}));const b=C.getFormat(a).toUpperCase();if("JPG"===b||"PNG"===b||"GIF"===b||"BMP"===b)this._set("datasetFormat",b);else throw new v("image-aux-raster:open","the data is not a supported format");return yield this.decodePixelBlock(a,{format:"jpg",width:1,height:1,useCanvas:!0})});return function(a){return g.apply(this,arguments)}}();
l._fetchAuxiliaryData=function(){var g=h._asyncToGenerator(function*(a){var b,c;a=w.unwrap(null==a?void 0:a.signal);var d=null!=(b=this.ioConfig.skipExtensions)?b:[];b=-1<d.indexOf("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:a});var e=this.datasetFormat;e="JPG"===e?"jgw":"PNG"===e?"pgw":"BMP"===e?"bpw":null;d=-1<d.indexOf(e)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+e,{responseType:"text",signal:a});d=yield r.eachAlways([b,d]);if(null!=a&&a.aborted)throw r.createAbortError();
a=B.parsePAMInfo(null==(c=d[0].value)?void 0:c.data);a.transform||(c=d[1].value?d[1].value.data.split("\n").slice(0,6).map(f=>Number(f)):null,a.transform=6===(null==c?void 0:c.length)?new E({forwardCoefficients:[c[4],c[5],c[0],-c[1],c[2],-c[3]]}):null);return a});return function(a){return g.apply(this,arguments)}}();return p}(z);q.__decorate([x.property({type:String,json:{write:!0}})],k.prototype,"datasetFormat",void 0);return k=q.__decorate([y.subclass("esri.layers.support.rasterDatasets.ImageAuxRaster")],
k)});