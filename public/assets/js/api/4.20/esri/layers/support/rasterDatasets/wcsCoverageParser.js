// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/Extent ../../../geometry/Polygon ../RasterInfo ../wmsUtils ./xmlUtilities".split(" "),function(H,B,N,I,O,a){function P(b){const e=a.getElementValues(b,"requestResponseCRSs").map(c=>c.split(":")[1]);b=a.getElementValues(b,"nativeCRSs").map(c=>c.split(":")[1]);return{requestResponseCRSs:e,nativeCRSs:b}}function K(b,e){const c=a.getElementValues(b,"1.0.0"===e?"interpolationMethod":"InterpolationMethod"),k="1.0.0"===e?b.getAttribute("default"):a.getElementValue(b,"InterpolationMethods/Default");
return null!=k?[k].concat(c.filter(h=>h.toLowerCase()!==k.toLowerCase())):c}function J(b){return null==b?["nearest"]:b.map(e=>{e=e.toLowerCase();return-1<e.indexOf("nearest")?"nearest":-1<e.indexOf("linear")?"bilinear":-1<e.indexOf("cubic")?"cubic":null}).filter(e=>!!e)}function Q(b=null){if(!b)return{resolution:null,units:null};let e=b.toUpperCase();var c=["Y","M","D"];const k=["H","M","S"];b="Years Months Days Hours Minutes Seconds".split(" ");let h;-1===e.indexOf("PT")?(e=e.slice(1),c=c.findIndex(g=>
-1<e.indexOf(g)),-1<c&&(h=b[c])):(e=e.slice(2),c=k.findIndex(g=>-1<e.indexOf(g)),h=b[3+c]);return{resolution:parseFloat(e.substring(0,e.length-1)),units:h}}function G(b){var e=a.getElements(b,"timeposition");if(0<e.length){b=[];for(var c=0;c<e.length;c++)b.push(new Date(a.getElementValue(e[c])));return{begin:b[0],end:b[b.length-1],values:b}}return(c=a.getElement(b,"timePeriod")||a.getElement(b,"TimePeriod"))?(e=new Date(a.getElementValue(c,"beginPosition")||a.getElementValue(c,"BeginPosition")),b=
new Date(a.getElementValue(c,"endPosition")||a.getElementValue(c,"EndPosition")),c=a.getElementValue(c,"timeResolution")||a.getElementValue(c,"TimeResolution"),c=Q(c),{begin:e,end:b,...c}):null}function R(b,e){b=b.filter(k=>-1===k.identifier.toLowerCase().indexOf("field_1")&&!k.axis.some(h=>"band"===h.identifier.toLowerCase()));const c=[];b.length&&b.forEach(k=>{var h,g;const f=k.axis.map(d=>{const l=d.values.map(n=>"ISO8601"===d.uom?(n=n.trim(),-1===n.toLowerCase().indexOf("z")?(new Date(n+"Z")).getTime():
(new Date(n)).getTime()):parseFloat(n.trim())),m=[Math.min.apply(null,l),Math.max.apply(null,l)];return{name:d.identifier.trim(),description:"",field:d.identifier.trim(),unit:d.uom?d.uom.trim():"",hasRegularIntervals:!1,values:l,extent:m}});c.push({name:k.identifier.trim(),description:null!=(h=null==(g=k.description)?void 0:g.trim())?h:"",unit:"",dimensions:f})});if(e.temporalDomain){const {begin:k,end:h,values:g,units:f,resolution:d}=e.temporalDomain;c.some(l=>l.dimensions.some(m=>"stdtime"===m.name.toLowerCase()))||
c.forEach(l=>{l.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null==g?void 0:g.map(m=>m.getTime()),hasRegularIntervals:!g,interval:d,intervalUnit:f,extent:[k.getTime(),h.getTime()]})})}return c.length?{variables:c}:null}function S(b){var e,c=a.getElement(b,"SpatialDomain"),k=a.getElement(c,"GridCRS"),h=a.getElementValue(k,"GridBaseCRS"),g=a.getElementValue(k,"GridOrigin");g=null!=(e=null==g?void 0:g.split(" ").map(u=>parseFloat(u)))?e:[0,0];e=a.getSpaceDelimitedNumericValues(k,
"GridOffsets");c=a.getElements(c,"BoundingBox");let f;for(k=0;k<c.length;k++){var d,l=null==(d=c[k].getAttribute("crs"))?void 0:d.toLowerCase();if(null!=l)if(-1<l.indexOf("imagecrs")){var m=a.getSpaceDelimitedNumericValues(c[k],"LowerCorner");l=a.getSpaceDelimitedNumericValues(c[k],"UpperCorner");f=l[0]-m[0]+1;m=l[1]-m[1]+1}else if(0<l.indexOf("epsg")){var n=l.split(":");n=parseInt(n[n.length-1],10);var p=a.getSpaceDelimitedNumericValues(c[k],"LowerCorner");l=a.getSpaceDelimitedNumericValues(c[k],
"UpperCorner");p=new B({xmin:p[0],ymin:p[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:n}})}}d=f>m;c=p.xmax-p.xmin>p.ymax-p.ymin;k=!1;O.coordsReversedForWKID(n)&&(d===c?k=!1:(k=!0,p=new B({xmin:p.ymin,ymin:p.xmin,xmax:p.ymax,ymax:p.xmax,spatialReference:{wkid:n}})));h={columns:f,rows:m,origin:{x:g[0],y:g[1]},offset:{x:e[0],y:e[1]},gridBaseCRS:h,envelope:p,useEPSGAxis:k};b=(b=a.getElement(b,"temporalDomain")||a.getElement(b,"TemporalDomain"))?G(b):null;return{spatialDomain:h,temporalDomain:b}}function T(b){const e=
a.getElement(b,"Envelope")||a.getElement(b,"EnvelopeWithTimePeriod");var c=e.getAttribute("srsName"),k=c.slice(c.lastIndexOf("/")+1);const h=e.getAttribute("axisLabels").split(" ").map(m=>m.trim()).filter(m=>""!==m.trim());var g=a.getSpaceDelimitedNumericValues(e,"lowerCorner"),f=a.getSpaceDelimitedNumericValues(e,"upperCorner");c=!"y lat latitude north nor n b".split(" ").some(m=>m===h[0].toLowerCase());k=parseInt(k,10);k=isNaN(k)?null:{wkid:k};k=c?new B({xmin:g[0],ymin:g[1],xmax:f[0],ymax:f[1],
spatialReference:k}):new B({xmin:g[1],ymin:g[0],xmax:f[1],ymax:f[0],spatialReference:k});g={mins:g,maxs:f};f=e.getAttribute("uomLabels").trim().split(" ");let d,l;a.isSameTagIgnoreNS(e,"EnvelopeWithTimePeriod")&&(d=new Date(a.getElementValue(b,"beginPosition")||a.getElementValue(b,"BeginPosition")),l=new Date(a.getElementValue(b,"endPosition")||a.getElementValue(b,"EndPosition")));return{envelope:k,axisLabels:h,uomLabels:f.length?f:null,envelopeAllDims:g,beginPosition:d,endPosition:l,isEastFirst:c}}
function U(b){let e=1,c="";Math.abs(b-1/24)<1/24*.01?c="Hours":.01>Math.abs(b-1)?c="Days":1>b?(e=Math.round(24*b),c="Hours"):27.99<b&&31.01>b?c="Months":12>Math.round(b/30)?c="Months":364.99<b&&366.01>b&&(c="Years");return{interval:e,intervalUnit:c}}function V(b,e,c){const k=[];for(var h=0;h<b.length;h++){var g=b[h];for(var f=0;f<g.length;f++)-1===g[f].name.toLowerCase().indexOf("band")&&k.push(g[f])}const d=[];if(k.length){const l=[];for(b=2;b<c.axisLabels.length;b++){f=(e.uomLabels&&e.uomLabels.length)>
b?e.uomLabels[b]:"";(h=-1<c.axisLabels[b].toLowerCase().indexOf("time")||"iso8601"===f.toLowerCase()||"oledatetime"===f.toLowerCase())?(f=U(c.offset[b]),g=f.interval,f=f.intervalUnit):g=c.offset[b];const m=[];h?(m.push((new Date).setTime(864E5*(e.envelopeAllDims.mins[b]-25569))),m.push((new Date).setTime(864E5*(e.envelopeAllDims.maxs[b]-25569)))):(m.push(e.envelopeAllDims.mins[b]),m.push(e.envelopeAllDims.maxs[b]));l.push({name:c.axisLabels[b].trim(),description:c.axisLabels[b].trim(),unit:e.uomLabels&&
e.uomLabels.length>b?e.uomLabels[b].trim():"",hasRegularIntervals:!0,extent:m,interval:g,intervalUnit:f})}k.forEach(m=>{var n,p;return d.push({name:m.name.trim(),description:null!=(n=null==(p=m.description)?void 0:p.trim())?n:"",unit:m.uom.trim(),dimensions:l})});if(d.length)return{variables:d}}return null}function W(b,e){var c=a.getElement(b,"RectifiedGrid"),k=a.getSpaceDelimitedNumericValues(c,"low"),h=a.getSpaceDelimitedNumericValues(c,"high");b=[];for(var g=0;g<k.length;g++)b.push(h[g]-k[g]+1);
k=a.getElementValue(c,"axisLabels").split(" ");h=a.getSpaceDelimitedNumericValues(c,"origin/pos");g=a.getElements(c,"offsetVector");c=[];for(var f=0;f<g.length;f++){const l=a.getSpaceDelimitedNumericValues(g[f]),m=l.findIndex(n=>0!==n);c[m]=l[m]}const d=e||k;"y lat latitude north nor n b".split(" ").some(l=>l===d[0].toLowerCase())?(e=b[1],g=b[0],f={y:Math.abs(c[0]),x:Math.abs(c[1])}):(e=b[0],g=b[1],f={x:Math.abs(c[0]),y:Math.abs(c[1])});return{columns:e,rows:g,origin:h,offset:c,resolution:f,gridSamples:b,
axisLabels:k}}function X(b){var e=a.getElement(b,"EarthObservation");if(!e)return null;var c=a.getElement(e,"phenomenonTime");c=c?G(c):null;var k=a.getElement(e,"phenomenonTime");k=k?G(k):null;var h=a.getElementValue(e,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");e=null;if(h&&(h=h.split(" ").map(f=>f.trim()).filter(f=>null!=f&&""!==f),h.length)){e=[];for(var g=0;g<h.length/2;g+=2)e.push(h[g],h[g+1]);e=new N({rings:[e],spatialReference:{wkid:4326}})}h=
a.getElementValue(b,"metaDataProperty/EarthObservationMetaData/identifier");g=a.getElementValue(b,"metaDataProperty/EarthObservationMetaData/acquisitionType");b=a.getElementValue(b,"metaDataProperty/EarthObservationMetaData/status");return{observation:{phonomenonTime:c,resultTime:k,footprint:e,identifier:h,acquisitionType:g,status:b}}}H.parseCoverages=function(b,e){let c=null;c="string"===typeof b?(new DOMParser).parseFromString(b,"text/xml"):b;if("1.0.0"===e)return a.getElements(c,"CoverageOffering").map(k=>
{{var h={version:"1.0"};var g=[];for(var f=0;f<k.childNodes.length;f++){var d=k.childNodes[f];if(1===d.nodeType)if(a.isSameTagIgnoreNS(d,"description"))h.description=a.getElementValue(d);else if(a.isSameTagIgnoreNS(d,"name"))h.name=a.getElementValue(d);else if(a.isSameTagIgnoreNS(d,"label"))h.label=a.getElementValue(d);else if(a.isSameTagIgnoreNS(d,"supportedFormats"))h.supportedFormats=a.getElementValues(d,"formats");else if(a.isSameTagIgnoreNS(d,"supportedCRSs"))h.supportedCRSs=P(d);else if(a.isSameTagIgnoreNS(d,
"supportedInterpolations"))h.supportedInterpolations=K(d,"1.0.0");else if(a.isSameTagIgnoreNS(d,"lonLatEnvelope")){var l=a.getElements(d,"pos");d=a.getSpaceDelimitedNumericValues(l[0]);l=a.getSpaceDelimitedNumericValues(l[1]);d=new B({xmin:d[0],ymin:d[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:4326}});h.lonLatEnvelope=d}else if(a.isSameTagIgnoreNS(d,"rangeSet")){g=[];d=a.getElements(d,"RangeSet");l=[];for(var m=0;m<d.length;m++){var n=a.getElementValue(d[m],"name"),p=a.getElementValue(d[m],"label"),
u=[],r=a.getElements(d[m],"AxisDescription");for(let v=0;v<r.length;v++){const C=a.getElementValue(r[v],"name"),F=a.getElementValue(r[v],"label"),x=a.getElementValues(r[v],"singleValue");if(0===x.length){var q=a.getElementValue(r[v],"min");const z=a.getElementValue(r[v],"max"),A=Number(a.getElementValue(r[v],"res"))||1;if(null!==q&&null!==z)for(q=parseInt(q,10);q<=parseInt(z,10);q+=A)x.push(q.toString())}"band"===C.toLowerCase()&&(l=x);u.push({name:C,label:F,values:x})}g.push({name:n,label:p,axis:u})}g=
{rangeSet:g,bandNames:l};h.rangeSet=g.rangeSet;g=g.bandNames}else a.isSameTagIgnoreNS(d,"domainSet")&&(l=a.getElement(d,"spatialDomain"),m=a.getElement(l,"Envelope")||a.getElement(l,"EnvelopeWithTimePeriod"),n=m.getAttribute("srsName").split(":"),n=n[n.length-1],p=a.getElements(m,"pos"),m=a.getSpaceDelimitedNumericValues(p[0]),p=a.getSpaceDelimitedNumericValues(p[1]),n=parseInt(n,10),n=isNaN(n)?null:{wkid:n},m=new B({xmin:m[0],ymin:m[1],xmax:p[0],ymax:p[1],spatialReference:n}),n=a.getElement(l,"RectifiedGrid"),
p=a.getElementValue(n,"low").split(" "),u=a.getElementValue(n,"high").split(" "),n=parseInt(u[0],10)-parseInt(p[0],10)+1,p=parseInt(u[1],10)-parseInt(p[1],10)+1,u=a.getSpaceDelimitedNumericValues(l,"origin/pos"),r=a.getElements(l,"offsetVector"),l=parseFloat(a.getElementValue(r[0]).split(" ")[0]),r=parseFloat(a.getElementValue(r[1]).split(" ")[1]),l={envelope:m,columns:n,rows:p,offset:{x:l,y:r},origin:{x:u[0],y:u[1]}},d=(d=a.getElement(d,"temporalDomain")||a.getElement(d,"TemporalDomain"))?G(d):null,
d={spatialDomain:l,temporalDomain:d},h.domainSet=d)}k=J(h.supportedInterpolations);const {name:D,description:t,label:y,lonLatEnvelope:E,supportedFormats:w}=h;({spatialDomain:f}=h.domainSet);f=new I({width:f.columns,height:f.rows,pixelSize:{x:Math.abs(f.offset.x),y:Math.abs(f.offset.y)},extent:f.envelope,spatialReference:f.envelope.spatialReference,bandCount:g.length||1});h={id:D,title:h.name,description:t||y,lonLatEnvelope:E,rasterInfo:f,bandNames:g,supportedFormats:w,supportedInterpolations:k,coverageDescription:h,
version:"1.0.0",useEPSGAxis:!1}}return h});b=a.getElements(c,"CoverageDescription");return"1.1.0"===e||"1.1.1"===e||"1.1.2"===e?b.map(k=>{{var h=[];var g=[];const n={supportedFormats:h,supportedCRSs:g,version:"1.1"};for(var f=0;f<k.childNodes.length;f++){var d=k.childNodes[f];if(1===d.nodeType){var l=a.getNodeNameIgnoreNS(d).toLowerCase();switch(l){case "title":case "abstract":case "identifier":n[l]=a.getElementValue(d);break;case "supportedformat":d=a.getElementValue(d);-1===h.indexOf(d)&&h.push(d);
break;case "supportedcrs":d=a.getElementValue(d);-1===g.indexOf(d)&&g.push(d);break;case "range":var m=[];d=a.getElements(d,"Field");l=[];for(let t=0;t<d.length;t++){const y=a.getElementValue(d[t],"Identifier"),E=a.getElementValue(d[t],"Description"),w=a.getElementValue(d[t],"Definition"),v=a.getElementValue(d[t],"Abstract"),C=a.getElementValue(d[t],"Title"),F=K(d[t],"1.1.0"),x=[],z=a.getElements(d[t],"Axis");for(let A=0;A<z.length;A++){const L=z[A].getAttribute("identifier"),Y=a.getElementValue(z[A],
"UOM"),Z=a.getElementValue(z[A],"DataType"),M=a.getElementValues(z[A],"Key");"band"===L.toLowerCase()&&(l=M);x.push({identifier:L,uom:Y,dataType:Z,values:M})}m.push({identifier:y,description:E,definition:w,abstract:v,title:C,supportedInterpolations:F,axis:x})}m={rangeSet:m,bandNames:l};n.range=m.rangeSet;m=m.bandNames;break;case "domain":n.domain=S(d)}}}k=J(n.range[0].supportedInterpolations);const {identifier:p,abstract:u,title:r,domain:q,range:D}=n;g={x:Math.abs(q.spatialDomain.offset.x),y:Math.abs(q.spatialDomain.offset.y)};
f=R(D,q);g=new I({width:q.spatialDomain.columns,height:q.spatialDomain.rows,pixelSize:g,extent:q.spatialDomain.envelope,spatialReference:q.spatialDomain.envelope.spatialReference,bandCount:m.length||1,multidimensionalInfo:f});h={id:p,title:n.title,description:u||r,lonLatEnvelope:null,bandNames:m,rasterInfo:g,supportedFormats:h,supportedInterpolations:k,coverageDescription:n,version:e,useEPSGAxis:q.spatialDomain.useEPSGAxis}}return h}):b.map(k=>{{var h={version:"2.0"};var g=[];for(let q=0;q<k.childNodes.length;q++){var f=
k.childNodes[q];if(1===f.nodeType)if(a.isSameTagIgnoreNS(f,"coverageId"))h.coverageId=a.getElementValue(f);else if(a.isSameTagIgnoreNS(f,"ServiceParameters"))h.serviceParameters={supportedFormats:a.getElementValues(f,"nativeFormat")};else if(a.isSameTagIgnoreNS(f,"boundedBy"))h.boundedBy=T(f);else if(a.isSameTagIgnoreNS(f,"rangeType")){{g=[];f=a.getElements(f,"DataRecord");const D=[];for(let t=0;t<f.length;t++){const y=a.getElements(f[t],"field"),E=[];for(let w=0;w<y.length;w++){var d;const v=y[w].getAttribute("name"),
C=a.getElementValue(y[w],"description")||"",F=(null==(d=a.getElement(y[w],"uom"))?void 0:d.getAttribute("code"))||"",x=a.getSpaceDelimitedNumericValues(y[w],"interval");-1<v.toLowerCase().indexOf("band")&&D.push(v);E.push({name:v,description:C,uom:F,allowedValues:x})}g.push(E)}g={rangeType:g,bandNames:D}}h.rangeType=g.rangeType;g=g.bandNames}else if(a.isSameTagIgnoreNS(f,"domainSet")){var l;h.domainSet=W(f,null==(l=h.boundedBy)?void 0:l.axisLabels)}else a.isSameTagIgnoreNS(f,"metadata")&&(f=a.getElement(f,
"EOMetadata"),h.eoMetadata=f?X(f):null)}const {coverageId:m,boundedBy:n,domainSet:p,rangeType:u,serviceParameters:r}=h;k=V(u,n,p);k=new I({width:p.columns,height:p.rows,pixelSize:p.resolution,extent:n.envelope,spatialReference:n.envelope.spatialReference,bandCount:g.length||1,multidimensionalInfo:k});h={id:m,title:m,description:m,lonLatEnvelope:null,bandNames:g,rasterInfo:k,supportedFormats:r.supportedFormats,supportedInterpolations:null,coverageDescription:h,version:"2.0.1",useEPSGAxis:!1}}return h})};
H.standardizeInterpolations=J;Object.defineProperty(H,"__esModule",{value:!0})});