// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/webMercatorUtils ../../../geometry/Extent ../../../geometry/Point".split(" "),function(u,Y,aa,F,z,K,v,L,P,w){function M(){M=Y._asyncToGenerator(function*(){if(v.isLoaded()||!v.isSupported())return null;yield v.load()});return M.apply(this,arguments)}function N(a,b,c,d=null){if(a.spatialReference.equals(b))return a;
const e=G(a.spatialReference,b);if(e&&!v.isLoaded())throw new F("rasterprojectionhelper-projectResolution","projection engine is not loaded");c=c.center;a=new P({xmin:c.x-a.x/2,xmax:c.x+a.x/2,ymin:c.y-a.y/2,ymax:c.y+a.y/2,spatialReference:a.spatialReference});b=e?v.project(a,b,d):L.project(a,b);return null==b?null:{x:b.xmax-b.xmin,y:b.ymax-b.ymin}}function Q(a,b=.01){return K.getMetersPerUnitForSR(a)?b/K.getMetersPerUnitForSR(a):0}function H(a,b,c=null,d=!0){const e=a.spatialReference;if(e.equals(b))return a;
const f=G(e,b);if(f&&!v.isLoaded())throw new F("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((c=f?v.project(a,b,c):L.project(a,b))&&d&&b.isGeographic){const [g,k]=O(e,!0);(b=Q(e))&&null!=g&&null!=k&&(Math.abs(a.x-g)<b&&5E-4>Math.abs(180-c.x)?c.x-=360:Math.abs(a.x-k)<b&&5E-4>Math.abs(180+c.x)&&(c.x+=360))}return c}function R(a){const b=D(a[0].spatialReference);if(2>a.length||!z.isSome(b))return a[0];let {xmin:c,xmax:d,ymin:e,ymax:f}=a[0];for(let g=1;g<a.length;g++){const k=
a[g];d=k.xmax+b*g;e=Math.min(e,k.ymin);f=Math.max(f,k.ymax)}return new P({xmin:c,xmax:d,ymin:e,ymax:f,spatialReference:a[0].spatialReference})}function S(a,b,c=null,d=!0){if(a.spatialReference.equals(b))return a;const e=T(a),f=D(a.spatialReference,!0);if(!z.isSome(f)||0===e)return U(a,b,c,d);a=a.clone().normalize().map(g=>U(g,b,c,d));return R(a)}function U(a,b,c=null,d=!0){const e=a.spatialReference;if(e.equals(b))return a;var f=G(e,b);if(f&&!v.isLoaded())throw new F("rasterprojectionhelper-projectExtent",
"projection engine is not loaded");f=f?v.project(a,b,c):L.project(a,b);let [g,k]=O(e,!0);f&&d&&e.isWebMercator&&b.isGeographic&&null!=g&&null!=k&&(.001>Math.abs(a.xmin-g)&&1E3<Math.abs(k-a.xmax)&&5E-4>Math.abs(180-f.xmax)&&(f.xmin=-180,d=[],d.push(new w(a.xmax,a.ymin,e)),d.push(new w(a.xmax,(a.ymin+a.ymax)/2,e)),d.push(new w(a.xmax,a.ymax,e)),d=d.map(h=>H(h,b,c)).filter(h=>!isNaN(null==h?void 0:h.x)).map(h=>h.x),f.xmax=Math.max.apply(null,d)),.001>Math.abs(a.xmax-k)&&1E3<Math.abs(g-a.xmin)&&5E-4>
Math.abs(180+f.xmin)&&(f.xmax=180,d=[],d.push(new w(a.xmin,a.ymin,e)),d.push(new w(a.xmin,(a.ymin+a.ymax)/2,e)),d.push(new w(a.xmin,a.ymax,e)),a=d.map(h=>H(h,b,c)).filter(h=>!isNaN(null==h?void 0:h.x)).map(h=>h.x),f.xmin=Math.min.apply(null,a)));[g,k]=O(b,!0);(a=Q(b))&&null!=g&&null!=k&&(Math.abs(f.xmin-g)<a&&(f.xmin=g),Math.abs(f.xmax-k)<a&&(f.xmax=k));return f}function D(a,b=!1){return a.isWebMercator?2*(b?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*Z[a.wkid]||null}function O(a,
b=!1){const c=[];a=D(a,b);z.isSome(a)&&(c.push(-a/2),c.push(a/2));return c}function V(a,b,c,d){a=(a-b)/c;0!==a-Math.floor(a)?a=Math.floor(a):d&&--a;return a}function T(a,b=!1){const c=D(a.spatialReference);if(!z.isSome(c))return 0;const d=b?0:-(c/2);b=V(a.xmax,d,c,!0);a=V(a.xmin,d,c,!1);return b-a}const G=function(a,b){const c=(a.isWGS84||a.isWebMercator)&&(b.isWGS84||b.isWebMercator);return!(a.equals(b)||c)},Z={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,
3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,
54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};u.computeProjectedScales=function(a,
b,c=512,d=!0){const {extent:e,spatialReference:f,pixelSize:g}=a,k=N(new w({x:g.x,y:g.y,spatialReference:f}),b,e);if(null==k)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var h=(k.x+k.y)/2,l=K.getMetersPerUnitForSR(b);h=h*l*96*39.37;const n=b.isGeographic?256/c*2.958287637958547E8:256/c*5.91657527591555E8;c=!1;const q=S(e,b);d&&(b.isGeographic||b.isWebMercator)&&(c=0>q.xmin*q.xmax);d=h;if(c)d=n,a=b.isGeographic?1.341104507446289E-6:.29858214164761665,l=96*
a*l*39.37,b=N(new w({x:a,y:a,spatialReference:{wkid:b.isGeographic?4326:3857}}),f,q),b.x*=d/l,b.y*=d/l;else{b={x:g.x,y:g.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(l=0;d<.5005*n&&l<a;)l++,d*=2,b.x*=2,b.y*=2;1.001>=Math.max(d,n)/Math.min(d,n)&&(d=n)}a=[d];l=[{x:b.x,y:b.y}];for(h=Math.min(70.5310735,h)/1.001;d>=h;)d/=2,b.x/=2,b.y/=2,a.push(d),l.push({x:b.x,y:b.y});return{projectedPixelSize:k,scales:a,srcResolutions:l,isCustomTilingScheme:!c}};u.defaultGridSpacing=32;u.getDefaultDatumTransformationForDataset=
function(a,b,c){if(!G(a.spatialReference,b))return null;if(!v.isLoaded())throw new F("rasterprojectionhelper-projectResolution","projection engine is not loaded");return c?v.getTransformation(b,a.spatialReference,a):v.getTransformation(a.spatialReference,b,a)};u.getProjectionOffsetGrid=function(a,b,c,d=null,e=null,f=!1,g=[32,32]){if(G(a.spatialReference,b.spatialReference)&&!v.isLoaded())throw new F("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&b&&c))return null;
const {xmin:k,ymin:h,xmax:l,ymax:n}=a;var q=a.spatialReference,A=b.spatialReference,E=D(A);f=f||"gcs-shift"===(null==e?void 0:e.type);var x=g[0]*c.x,y=g[1]*c.y;c=Math.ceil((l-k)/x-.1)+1;a=Math.ceil((n-h)/y-.1)+1;const m=[];let W=!1;for(var B=0;B<c;B++){var t=[];for(var p=0;p<a;p++){var r=new w({x:k+x*B,y:n-y*p,spatialReference:q});r=H(r,A,d);e&&(r=e.inverseTransform(r));t.push(r);0<B&&f&&r&&C[p]&&z.isSome(E)&&r.x<C[p].x&&(r.x+=E);r?(m.push((r.x-b.xmin)/(b.xmax-b.xmin)),m.push((b.ymax-r.y)/(b.ymax-
b.ymin))):(m.push(NaN),m.push(NaN),W=!0)}var C=t}b=[Math.abs((m[0]+m[4]+m[4*c]+m[4*c+4])/4-m[2*a+2]),Math.abs((m[1]+m[5]+m[4*a+1]+m[4*a+5])/4-m[2*a+3])];d=new Float32Array((c-1)*(a-1)*12);e=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(C=0;C<c-1;C++){for(q=0;q<a-1;q++){t=C*a*2+2*q;x=m[t];A=m[t+1];var I=m[t+2],J=m[t+3];t+=2*a;y=m[t];E=m[t+1];B=m[t+2];t=m[t+3];p=0;r=12*(q*(c-1)+C);for(let X=0;3>X;X++)d[r++]=e[p++]*x+e[p++]*I+e[p++]*B;p=0;for(I=0;3>I;I++)d[r++]=
e[p++]*A+e[p++]*J+e[p++]*t;p=0;for(J=0;3>J;J++)d[r++]=f[p++]*x+f[p++]*y+f[p++]*B;p=0;for(x=0;3>x;x++)d[r++]=f[p++]*A+f[p++]*E+f[p++]*t}if(W)for(q=0;q<d.length;q++)isNaN(d[q])&&(d[q]=-1)}return{offsets:m,error:b,coefficients:d,spacing:g,size:[c-1,a-1]}};u.getRasterDatasetAlignmentInfo=function(a){const b=a.storageInfo.origin.x,c=D(a.spatialReference,!0);if(!z.isSome(c))return{originX:b,halfWorldWidth:null,pyramidsInfo:null};const d=c/2,{nativePixelSize:e,storageInfo:f,extent:g}=a,{maximumPyramidLevel:k,
blockWidth:h,pyramidScalingFactor:l}=f;let n=e.x;const q=[];a=z.isSome(a.transform)&&"gcs-shift"===a.transform.type;const A=b+d,E=a?c-b:d-b;for(let x=0;x<=k;x++){const y=(g.xmax-b)/n/h,m=(c/2-b)/n/h;q.push({resolutionX:n,blockWidth:h,datsetColumnCount:0===y-Math.floor(y)?y:Math.ceil(y),worldColumnCountFromOrigin:0===m-Math.floor(m)?m:Math.ceil(m),leftMargin:Math.round(A/n)%h,rightPadding:(h-Math.round(E/n)%h)%h,originColumnOffset:Math.floor(A/n/h)});n*=l}return{originX:b,halfWorldWidth:d,pyramidsInfo:q,
hasGCSSShiftTransform:a}};u.getWorldWrapCount=T;u.load=function(){return M.apply(this,arguments)};u.projectExtent=S;u.projectPoint=H;u.projectResolution=N;u.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:R(a)};u.snapPyramid=function(a,b,c){const {storageInfo:d,pixelSize:e}=b;let f=!1;var {pyramidResolutions:g}=d;if(z.isSome(g)&&g.length){a=(a.x+a.y)/2;var k=g[g.length-1];k=(k.x+k.y)/2;var h=(e.x+e.y)/2;if(a<=h)var l=0;else if(a>=k)l=g.length,f=8<a/k;else{k=h;for(let n=1;n<=
g.length;n++){h=(g[n-1].x+g[n-1].y)/2;if(a<=h){a===h?l=n:"down"===c?(l=n-1,f=8<a/k):l="up"===c?n:a-k>h-a||2<a/k?n:n-1;break}k=h}}c=0===l?e:g[l-1];return{pyramidLevel:l,pyramidResolution:new w({x:c.x,y:c.y,spatialReference:b.spatialReference}),excessiveReading:f}}l=Math.log(a.x/e.x)/Math.LN2;a=Math.log(a.y/e.y)/Math.LN2;g=b.storageInfo.maximumPyramidLevel||0;l="down"===c?Math.floor(Math.min(l,a)):"up"===c?Math.ceil(Math.max(l,a)):Math.round((l+a)/2);0>l?l=0:l>g&&(f=l>g+3,l=g);c=2**l;b=new w({x:c*b.nativePixelSize.x,
y:c*b.nativePixelSize.y,spatialReference:b.spatialReference});return{pyramidLevel:l,pyramidResolution:b,excessiveReading:f}};Object.defineProperty(u,"__esModule",{value:!0})});