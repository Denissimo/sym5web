// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(function(){return function(){function g(a=15E3,b=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=a;this._interval=Math.min(a,b)}var d=g.prototype;d.decreaseRefCount=function(a,b){a=a+"/"+b;b=this._cachedBlocks;if(b.has(a)){const c=b.get(a);c.refCount--;0>=c.refCount&&(b.delete(a),c.controller&&c.controller.abort());return c.refCount}return 0};d.getBlock=function(a,b){a=a+"/"+b;b=this._cachedBlocks;if(b.has(a)){const c=b.get(a);c.ts=Date.now();c.refCount++;b.delete(a);
b.set(a,c);return c.block}return null};d.putBlock=function(a,b,c,e=null){const f=this._cachedBlocks;a=a+"/"+b;f.has(a)?(c=f.get(a),c.ts=Date.now(),c.refCount++):f.set(a,{block:c,ts:Date.now(),refCount:1,controller:e});this.trim();this.updateTimer()};d.deleteBlock=function(a,b){const c=this._cachedBlocks;a=a+"/"+b;c.has(a)&&c.delete(a)};d.updateMaxSize=function(a){this._size=a;this.trim()};d.empty=function(){this._cachedBlocks.clear();this.clearTimer()};d.getCurrentSize=function(){return this._cachedBlocks.size};
d.updateTimer=function(){if(null==this._timer){var a=this._cachedBlocks;this._timer=setInterval(()=>{const b=Array.from(a),c=Date.now();for(let e=0;e<b.length;e++)if(b[e][1].ts<=c-this._duration)a.delete(b[e][0]);else break;0===a.size&&this.clearTimer()},this._interval)}};d.trim=function(){const a=this._cachedBlocks;if(!(-1===this._size||this._size>=a.size)){var b=Array.from(a);for(let c=0;c<b.length-this._size;c++)a.delete(b[c][0])}};d.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),
this._timer=null)};return g}()});