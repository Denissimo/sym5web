// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),function(F,l,m,G,H,I,J,K,L,n,M,k,p,q){function D(a,b,e,c=a.hasZ,f=a.hasM){const g=a.hasZ&&c,h=a.hasM&&f;return e?(a=
k.quantizeOptimizedGeometry(u,b,a.hasZ,a.hasM,"esriGeometryPoint",e,c,f),k.convertToPoint(a,g,h)):k.convertToPoint(b,g,h)}function v(){v=m._asyncToGenerator(function*(a,b,e){const {outFields:c,orderByFields:f,groupByFieldsForStatistics:g,outStatistics:h}=a;if(c)for(var d=0;d<c.length;d++)c[d]=c[d].trim();if(f)for(d=0;d<f.length;d++)f[d]=f[d].trim();if(g)for(d=0;d<g.length;d++)g[d]=g[d].trim();if(h)for(d=0;d<h.length;d++)h[d].onStatisticField&&(h[d].onStatisticField=h[d].onStatisticField.trim());a.geometry&&
!a.outSR&&(a.outSR=a.geometry.spatialReference);return w(a,b,e)});return v.apply(this,arguments)}function x(){x=m._asyncToGenerator(function*(a,b,e){return w(a,b,e)});return x.apply(this,arguments)}function w(a,b,e){return y.apply(this,arguments)}function y(){y=m._asyncToGenerator(function*(a,b,e){if(!a)return null;var {where:c}=a;a.where=c=c&&c.trim();if(!c||/^1 *= *1$/.test(c)||b&&b===c)a.where=null;if(!a.geometry)return a;b=yield N(a);a.distance=0;a.units=null;"esriSpatialRelEnvelopeIntersects"===
a.spatialRel&&({spatialReference:c}=a.geometry,b=J.getGeometryExtent(b),b.spatialReference=c);a.geometry=b;yield q.checkProjectionSupport(b.spatialReference,e);b=(yield L.normalizeCentralMeridian(K.fromJSON(b)))[0];if(H.isNone(b))throw z;b=b.toJSON();b=yield q.project(b,b.spatialReference,e);if(!b)throw z;b.spatialReference=e;a.geometry=b;return a});return y.apply(this,arguments)}function N(a){return A.apply(this,arguments)}function A(){A=m._asyncToGenerator(function*(a){const {geometry:b,distance:e,
units:c}=a;if(null==e||"vertexAttributes"in b)return b;var f=b.spatialReference;a=c?O.fromJSON(c):I.getUnitString(f);f=f&&(n.isGeographic(f)||n.isWebMercator(f))?b:yield q.checkProjectionSupport(f,n.WGS84).then(()=>q.project(b,n.WGS84));return(yield P())(f.spatialReference,f,e,a)});return A.apply(this,arguments)}function P(){return B.apply(this,arguments)}function B(){B=m._asyncToGenerator(function*(){return(yield new Promise(function(a,b){F(["../../../geometry/geometryEngineJSON"],a,b)})).geodesicBuffer});
return B.apply(this,arguments)}const O=new G.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),z=Object.freeze({}),E=new p,Q=new p,u=new p,C={esriGeometryPoint:k.convertToPoint,esriGeometryPolyline:k.convertToPolyline,esriGeometryPolygon:k.convertToPolygon,esriGeometryMultipoint:k.convertToMultipoint},R=(a,b)=>"_geVersion"!==a?b:void 0;l.QUERY_ENGINE_EMPTY_RESULT=
z;l.cleanFromGeometryEngine=function(a){return a&&"_geVersion"in a?JSON.parse(JSON.stringify(a,R)):a};l.getCentroid=function(a,b,e){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=M.getCentroidOptimizedGeometry(new p,b.geometry,a.hasZ,a.hasM));return D(a,b.centroid,e)};l.getGeometry=function(a,b,e,c,f,g,h=b,d=e){const r=b&&h,t=e&&d;c=c?"coords"in c?c:c.geometry:null;if(!c)return null;if(f)return b=k.generalizeOptimizedGeometry(Q,c,b,e,a,
f,h,d),g&&(b=k.quantizeOptimizedGeometry(u,b,r,t,a,g)),C[a](b,r,t);if(g)return g=k.quantizeOptimizedGeometry(u,c,b,e,a,g,h,d),C[a](g,r,t);k.removeZMValues(E,c,b,e,h,d);return C[a](E,r,t)};l.normalizeFilter=function(a,b,e){return x.apply(this,arguments)};l.normalizeQuery=function(a,b,e){return v.apply(this,arguments)};l.normalizeQueryLike=w;l.transformCentroid=D;Object.defineProperty(l,"__esModule",{value:!0})});