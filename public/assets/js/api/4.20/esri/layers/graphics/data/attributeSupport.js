// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(d,e,r){function n(b,a){return b?m.get(b,a):null}function l(b,a,f,k=!0){const g=[];for(const h of a)if("*"!==h&&!b.has(h))if(k){a=p(h);try{const c=n(a,b);if(!c)throw new e("feature-store:unsupported-query","invalid SQL expression",{where:a});if(!c.isStandardized)throw new e("feature-store:unsupported-query","expression is not standard",{clause:c});l(b,c.fieldNames,"expression contains missing fields")}catch(c){if((a=
c&&c.details)&&(a.clause||a.where))throw c;a&&a.missingFields?g.push(...a.missingFields):g.push(h)}}else g.push(h);if(g.length)throw new e("feature-store:unsupported-query",f,{missingFields:g});}function p(b){return b.split(" as ")[0]}const m=new r.WhereClauseCache(50,500),t=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));d.getAliasFromFieldName=function(b){return b.split(" as ")[1]};
d.getExpressionFromFieldName=p;d.getWhereClause=n;d.hasInvalidFieldType=function(b,a){return(b=a.get(b))?!t.has(b.type):!1};d.validateFields=l;d.validateHaving=function(b,a,f){if(!a)return!0;const k=m.get(a,b);if(!k)throw new e("feature-store:unsupported-query","invalid SQL expression",{having:a});if(!k.isAggregate)throw new e("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:a});l(b,k.fieldNames,"having contains missing fields");if(!k.getExpressions().every(g=>
{const {aggregateType:h,field:c}=g,u=b.has(c)&&b.get(c).name;return f.some(v=>{const {onStatisticField:q,statisticType:w}=v;return(b.has(q)&&b.get(q).name)===u&&w.toLowerCase().trim()===h})}))throw new e("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:a});return!0};d.validateWhere=function(b,a){if(!a)return!0;const f=m.get(a,b);if(!f)throw new e("feature-store:unsupported-query","invalid SQL expression",{where:a});if(!f.isStandardized)throw new e("feature-store:unsupported-query",
"where clause is not standard",{where:a});l(b,f.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(d,"__esModule",{value:!0})});