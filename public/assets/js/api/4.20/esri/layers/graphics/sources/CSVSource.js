// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/has ../../../core/Loadable ../../../core/maybe ../../../core/workers/workers ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/Logger ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../rest/support/FeatureSet ../../../geometry/Extent".split(" "),function(k,d,c,m,n,p,q,e,v,w,x,r,t,u){c=function(l){function h(a){a=
l.call(this,a)||this;a.type="csv";return a}k._inheritsLoose(h,l);var f=h.prototype;f.load=function(a){a=p.isSome(a)?a.signal:null;this.addResolvingPromise(this._startWorker(a));return Promise.resolve(this)};f.destroy=function(){var a;null==(a=this._connection)?void 0:a.close();this._connection=null};f.openPorts=function(){return this.load().then(()=>this._connection.openPorts())};f.queryFeatures=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryFeatures",a?a.toJSON():null,
b)).then(g=>t.fromJSON(g))};f.queryFeaturesJSON=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryFeatures",a?a.toJSON():null,b))};f.queryFeatureCount=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryFeatureCount",a?a.toJSON():null,b))};f.queryObjectIds=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryObjectIds",a?a.toJSON():null,b))};f.queryExtent=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("queryExtent",
a?a.toJSON():null,b)).then(g=>({count:g.count,extent:u.fromJSON(g.extent)}))};f.querySnapping=function(a,b={}){return this.load(b).then(()=>this._connection.invoke("querySnapping",a,b))};f._startWorker=function(){var a=k._asyncToGenerator(function*(b){this._connection=yield q.open("CSVSourceWorker",{strategy:m("feature-layers-workers")?"dedicated":"local",signal:b});b=yield this._connection.invoke("load",{url:this.url,parsing:{columnDelimiter:this.delimiter,fields:this.fields&&this.fields.map(g=>
g.toJSON()),latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference&&this.spatialReference.toJSON(),timeInfo:this.timeInfo&&this.timeInfo.toJSON()}},{signal:b});this.locationInfo=b.locationInfo;this.sourceJSON=b.layerDefinition;this.columnDelimiter=b.columnDelimiter});return function(b){return a.apply(this,arguments)}}();return h}(n);d.__decorate([e.property()],c.prototype,"type",void 0);d.__decorate([e.property()],c.prototype,"url",void 0);d.__decorate([e.property()],
c.prototype,"delimiter",void 0);d.__decorate([e.property()],c.prototype,"fields",void 0);d.__decorate([e.property()],c.prototype,"latitudeField",void 0);d.__decorate([e.property()],c.prototype,"longitudeField",void 0);d.__decorate([e.property()],c.prototype,"spatialReference",void 0);d.__decorate([e.property()],c.prototype,"timeInfo",void 0);d.__decorate([e.property()],c.prototype,"locationInfo",void 0);d.__decorate([e.property()],c.prototype,"sourceJSON",void 0);d.__decorate([e.property()],c.prototype,
"columnDelimiter",void 0);return c=d.__decorate([r.subclass("esri.layers.graphics.sources.CSVSource")],c)});