// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.20/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/Logger ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ../support/LayersMixin ../support/TablesMixin ../webdoc/support/writeUtils".split(" "),
function(n,f,q,r,c,g,E,t,F,G,H,u,v,w,x,y,z,A,B,C,D){c=function(p){function m(a){a=p.call(this,a)||this;a._visibilityHandles={};a.fullExtent=void 0;a.operationalLayerType="GroupLayer";a.spatialReference=void 0;a.type="group";a._visibilityWatcher=a._visibilityWatcher.bind(n._assertThisInitialized(a));return a}n._inheritsLoose(m,p);var e=m.prototype;e.initialize=function(){this._enforceVisibility(this.visibilityMode,this.visible);this.watch("visible",this._visibleWatcher.bind(this),!0)};e._writeLayers=
function(a,b,k,d){const h=[];if(!a)return h;a.forEach(l=>{l=D.getLayerJSON(l,d.webmap?d.webmap.getLayerJSONFromResourceInfo(l):null,d);r.isSome(l)&&l.layerType&&h.push(l)});b.layers=h};e.load=function(a){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},a));return Promise.resolve(this)};e.loadAll=function(){return q.loadAll(this,a=>{a(this.layers)})};e.layerAdded=function(a){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):
"inherited"===this.visibilityMode&&(a.visible=this.visible);this._visibilityHandles[a.uid]=a.watch("visible",this._visibilityWatcher,!0)};e.layerRemoved=function(a){const b=this._visibilityHandles[a.uid];b&&(b.remove(),delete this._visibilityHandles[a.uid]);this._enforceVisibility(this.visibilityMode,this.visible)};e._turnOffOtherLayers=function(a){this.layers.forEach(b=>{b!==a&&(b.visible=!1)})};e._enforceVisibility=function(a,b){if(t.getProperties(this).initialized){var k=this.layers,d=k.find(h=>
h.visible);switch(a){case "exclusive":k.length&&!d&&(d=k.getItemAt(0),d.visible=!0);this._turnOffOtherLayers(d);break;case "inherited":k.forEach(h=>{h.visible=b})}}};e._visibleWatcher=function(a){"inherited"===this.visibilityMode&&this.layers.forEach(b=>{b.visible=a})};e._visibilityWatcher=function(a,b,k,d){switch(this.visibilityMode){case "exclusive":a?this._turnOffOtherLayers(d):this._isAnyLayerVisible()||(d.visible=!0);break;case "inherited":d.visible=this.visible}};e._isAnyLayerVisible=function(){return this.layers.some(a=>
a.visible)};n._createClass(m,[{key:"portalItem",set:function(a){this._set("portalItem",a)}},{key:"visibilityMode",set:function(a){const b=this._get("visibilityMode")!==a;this._set("visibilityMode",a);b&&this._enforceVisibility(a,this.visible)}}]);return m}(x.BlendLayer(A.ScaleRangeLayer(y.OperationalLayer(z.PortalLayer(C.TablesMixin(B.LayersMixin(c.MultiOriginJSONMixin(w))))))));f.__decorate([g.property()],c.prototype,"fullExtent",void 0);f.__decorate([g.property({json:{read:!1,write:{ignoreOrigin:!0}}})],
c.prototype,"layers",void 0);f.__decorate([v.writer("layers")],c.prototype,"_writeLayers",null);f.__decorate([g.property({type:["GroupLayer"]})],c.prototype,"operationalLayerType",void 0);f.__decorate([g.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"portalItem",null);f.__decorate([g.property()],c.prototype,"spatialReference",void 0);f.__decorate([g.property({json:{read:!1},readOnly:!0,value:"group"})],c.prototype,"type",void 0);f.__decorate([g.property({type:["independent",
"inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],c.prototype,"visibilityMode",null);return c=f.__decorate([u.subclass("esri.layers.GroupLayer")],c)});